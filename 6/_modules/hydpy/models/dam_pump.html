<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>hydpy.models.dam_pump &#8212; HydPy 6.1.5 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../_static/classic.css?v=127cebf3" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=4ae1632d" />
    
    <script src="../../../_static/documentation_options.js?v=3b4955ce"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">HydPy 6.1.5 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">hydpy.models.dam_pump</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/HydPy_Logo.png" alt="Logo"/>
            </a></p>
  <div>
    <h3><a href="../../../index.html">Table of Contents</a></h3>
    <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../example_projects.html">Example Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user_guide.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer_guide.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference_manual.html">Reference Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../zbibliography.html">Bibliography</a></li>
</ul>

  </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for hydpy.models.dam_pump</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># pylint: disable=line-too-long, unused-wildcard-import</span>
<span class="sd">&quot;&quot;&quot;|dam_pump| is a simple model for modelling pumping stations draining low-land areas.</span>
<span class="sd">Users can define a relationship between the highest possible pumping rate and the</span>
<span class="sd">difference between current inner and outer water levels</span>
<span class="sd">(|WaterLevelDifference2MaxForcedDischarge|).  Actual pumping happens when the inner</span>
<span class="sd">water level reaches the given target level (|WaterLevelMaximumThreshold|) as</span>
<span class="sd">long as the water level at a remote location does not exceed another defined threshold</span>
<span class="sd">(|RemoteWaterLevelMaximumThreshold|).  The latter restriction helps to prevent further</span>
<span class="sd">increasing high flow conditions in downstream areas. If the |MaxForcedDischarge| is</span>
<span class="sd">negative, the pumping process is carried out in the reverse direction (e.g. for</span>
<span class="sd">modelling irrigation processes).</span>

<span class="sd">By default, |dam_pump| neither takes precipitation nor evaporation into account, but</span>
<span class="sd">you can add submodels that comply with the |PrecipModel_V2| or |PETModel_V1| interface</span>
<span class="sd">that supply this information.</span>

<span class="sd">Integration tests</span>
<span class="sd">=================</span>

<span class="sd">.. how_to_understand_integration_tests::</span>

<span class="sd">We prepare a simulation period of 20 days:</span>

<span class="sd">&gt;&gt;&gt; from hydpy import IntegrationTest, Element, Node, pub, round_</span>
<span class="sd">&gt;&gt;&gt; pub.timegrids = &quot;2000-01-01&quot;, &quot;2000-01-21&quot;, &quot;1d&quot;</span>

<span class="sd">Besides the standard inlet and outlet nodes, |dam_pump| requires connections with two</span>
<span class="sd">receiver nodes.  One of these nodes should inform about the water level immediately</span>
<span class="sd">downstream.  The other one should provide water levels from a &quot;sensible&quot; location where</span>
<span class="sd">a certain water level should not be exceeded.  We connect these nodes via the remote</span>
<span class="sd">sequences |dam_receivers.OWL| (outer water level) and |dam_receivers.RWL| (remote water</span>
<span class="sd">level):</span>

<span class="sd">&gt;&gt;&gt; from hydpy.aliases import dam_receivers_OWL, dam_receivers_RWL</span>
<span class="sd">&gt;&gt;&gt; inflow = Node(&quot;inflow&quot;)</span>
<span class="sd">&gt;&gt;&gt; outflow = Node(&quot;outflow&quot;)</span>
<span class="sd">&gt;&gt;&gt; outer = Node(&quot;outer&quot;, variable=dam_receivers_OWL)</span>
<span class="sd">&gt;&gt;&gt; remote = Node(&quot;remote&quot;, variable=dam_receivers_RWL)</span>
<span class="sd">&gt;&gt;&gt; dam = Element(&quot;dam&quot;, inlets=inflow, outlets=outflow, receivers=(outer, remote))</span>

<span class="sd">Next, we prepare a |dam_pump| instance and connect it to the |Element| instance:</span>

<span class="sd">&gt;&gt;&gt; from hydpy.models.dam_pump import *</span>
<span class="sd">&gt;&gt;&gt; parameterstep()</span>
<span class="sd">&gt;&gt;&gt; dam.model = model</span>

<span class="sd">Parameterising |dam_pump| works similarly to parameterising other |dam| models.  Please</span>
<span class="sd">read the documentation on |dam_v001|, which provides in-depth information and should</span>
<span class="sd">help understand the following settings:</span>

<span class="sd">&gt;&gt;&gt; surfacearea(1.44)</span>
<span class="sd">&gt;&gt;&gt; catchmentarea(86.4)</span>
<span class="sd">&gt;&gt;&gt; watervolume2waterlevel(PPoly.from_data(xs=[0.0, 1.0], ys=[0.0, 1.0]))</span>
<span class="sd">&gt;&gt;&gt; waterleveldifference2maxforceddischarge(PPoly.from_data(xs=[0.0], ys=[1.0]))</span>
<span class="sd">&gt;&gt;&gt; waterlevelmaximumthreshold(1.0)</span>
<span class="sd">&gt;&gt;&gt; waterlevelmaximumtolerance(0.1)</span>
<span class="sd">&gt;&gt;&gt; remotewaterlevelmaximumthreshold(2.0)</span>
<span class="sd">&gt;&gt;&gt; remotewaterlevelmaximumtolerance(0.1)</span>
<span class="sd">&gt;&gt;&gt; correctionprecipitation(1.0)</span>
<span class="sd">&gt;&gt;&gt; correctionevaporation(1.0)</span>
<span class="sd">&gt;&gt;&gt; weightevaporation(0.8)</span>
<span class="sd">&gt;&gt;&gt; thresholdevaporation(0.0)</span>
<span class="sd">&gt;&gt;&gt; toleranceevaporation(0.001)</span>

<span class="sd">We add |meteo_precip_io| and |evap_ret_io| submodels that can supply predefined time</span>
<span class="sd">series of precipitation and potential evaporation:</span>

<span class="sd">&gt;&gt;&gt; with model.add_precipmodel_v2(&quot;meteo_precip_io&quot;):</span>
<span class="sd">...     precipitationfactor(1.0)</span>
<span class="sd">&gt;&gt;&gt; with model.add_pemodel_v1(&quot;evap_ret_io&quot;):</span>
<span class="sd">...     evapotranspirationfactor(1.0)</span>

<span class="sd">Now, we prepare an |IntegrationTest| object and register zero initial conditions for</span>
<span class="sd">all state and log sequences:</span>

<span class="sd">&gt;&gt;&gt; test = IntegrationTest(dam)</span>
<span class="sd">&gt;&gt;&gt; test.dateformat = &quot;%d.%m.&quot;</span>
<span class="sd">&gt;&gt;&gt; test.plotting_options.axis1 = fluxes.inflow, fluxes.outflow</span>
<span class="sd">&gt;&gt;&gt; test.plotting_options.axis2 = factors.waterlevel, factors.outerwaterlevel, factors.remotewaterlevel</span>
<span class="sd">&gt;&gt;&gt; test.inits = [(states.watervolume, 0.0),</span>
<span class="sd">...               (logs.loggedadjustedevaporation, 0.0),</span>
<span class="sd">...               (logs.loggedouterwaterlevel, 0.0),</span>
<span class="sd">...               (logs.loggedremotewaterlevel, 0.0)]</span>
<span class="sd">&gt;&gt;&gt; test.reset_inits()</span>
<span class="sd">&gt;&gt;&gt; conditions = model.conditions</span>

<span class="sd">We set the time series of precipitation, evaporation, inflow, and the outer water level</span>
<span class="sd">to constant values and let the remote water level increase constantly over the entire</span>
<span class="sd">simulation period:</span>

<span class="sd">&gt;&gt;&gt; model.precipmodel.sequences.inputs.precipitation.series = 2.0</span>
<span class="sd">&gt;&gt;&gt; model.pemodel.sequences.inputs.referenceevapotranspiration.series = 1.0</span>
<span class="sd">&gt;&gt;&gt; inflow.sequences.sim.series = 2.0</span>
<span class="sd">&gt;&gt;&gt; outer.sequences.sim.series = 0.0</span>
<span class="sd">&gt;&gt;&gt; remote.sequences.sim.series = numpy.linspace(0.0, 3.0, 20)</span>

<span class="sd">.. _dam_pump_drainage:</span>

<span class="sd">drainage</span>
<span class="sd">________</span>

<span class="sd">The following test run shows that the pumping starts when the inner water level reaches</span>
<span class="sd">the defined threshold of 1 m.  The outflow gradually becomes closer to the constant</span>
<span class="sd">inflow until the remote water level reaches the other defined threshold of 2 m:</span>

<span class="sd">.. integration-test::</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;dam_pump_drainage&quot;)</span>
<span class="sd">    |   date | waterlevel | outerwaterlevel | remotewaterlevel | waterleveldifference | precipitation | adjustedprecipitation | potentialevaporation | adjustedevaporation | actualevaporation | inflow | maxforceddischarge | forceddischarge |  outflow | watervolume | inflow | outer |  outflow |   remote |</span>
<span class="sd">    ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span>
<span class="sd">    | 01.01. |   0.174533 |             0.0 |              0.0 |             0.174533 |           2.0 |              0.033333 |                  1.0 |            0.013333 |          0.013278 |    2.0 |                1.0 |             0.0 |      0.0 |    0.174533 |    2.0 |   0.0 |      0.0 |      0.0 |</span>
<span class="sd">    | 02.01. |    0.34883 |             0.0 |              0.0 |              0.34883 |           2.0 |              0.033333 |                  1.0 |               0.016 |             0.016 |    2.0 |                1.0 |             0.0 |      0.0 |     0.34883 |    2.0 |   0.0 |      0.0 | 0.157895 |</span>
<span class="sd">    | 03.01. |   0.523082 |             0.0 |         0.157895 |             0.523082 |           2.0 |              0.033333 |                  1.0 |            0.016533 |          0.016533 |    2.0 |                1.0 |             0.0 |      0.0 |    0.523082 |    2.0 |   0.0 |      0.0 | 0.315789 |</span>
<span class="sd">    | 04.01. |   0.697324 |             0.0 |         0.315789 |             0.697324 |           2.0 |              0.033333 |                  1.0 |             0.01664 |           0.01664 |    2.0 |                1.0 |             0.0 |      0.0 |    0.697324 |    2.0 |   0.0 |      0.0 | 0.473684 |</span>
<span class="sd">    | 05.01. |   0.871535 |             0.0 |         0.473684 |             0.871534 |           2.0 |              0.033333 |                  1.0 |            0.016661 |          0.016661 |    2.0 |                1.0 |        0.000342 | 0.000342 |    0.871535 |    2.0 |   0.0 | 0.000342 | 0.631579 |</span>
<span class="sd">    | 06.01. |   1.025268 |             0.0 |         0.631579 |             1.025276 |           2.0 |              0.033333 |                  1.0 |            0.016666 |          0.016666 |    2.0 |                1.0 |        0.237348 | 0.237348 |    1.025268 |    2.0 |   0.0 | 0.237348 | 0.789474 |</span>
<span class="sd">    | 07.01. |   1.118228 |             0.0 |         0.789474 |             1.118229 |           2.0 |              0.033333 |                  1.0 |            0.016666 |          0.016666 |    2.0 |                1.0 |         0.94074 |  0.94074 |    1.118228 |    2.0 |   0.0 |  0.94074 | 0.947368 |</span>
<span class="sd">    | 08.01. |    1.20616 |             0.0 |         0.947368 |             1.206165 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    2.0 |                1.0 |        0.998939 | 0.998939 |     1.20616 |    2.0 |   0.0 | 0.998939 | 1.105263 |</span>
<span class="sd">    | 09.01. |   1.294004 |             0.0 |         1.105263 |             1.294007 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    2.0 |                1.0 |        0.999961 | 0.999961 |    1.294004 |    2.0 |   0.0 | 0.999961 | 1.263158 |</span>
<span class="sd">    | 10.01. |   1.381844 |             0.0 |         1.263158 |             1.381844 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    2.0 |                1.0 |        0.999999 | 0.999999 |    1.381844 |    2.0 |   0.0 | 0.999999 | 1.421053 |</span>
<span class="sd">    | 11.01. |   1.469684 |             0.0 |         1.421053 |             1.469684 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    2.0 |                1.0 |             1.0 |      1.0 |    1.469684 |    2.0 |   0.0 |      1.0 | 1.578947 |</span>
<span class="sd">    | 12.01. |   1.557524 |             0.0 |         1.578947 |             1.557524 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    2.0 |                1.0 |             1.0 |      1.0 |    1.557524 |    2.0 |   0.0 |      1.0 | 1.736842 |</span>
<span class="sd">    | 13.01. |   1.645364 |             0.0 |         1.736842 |             1.645364 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    2.0 |                1.0 |        0.999994 | 0.999994 |    1.645364 |    2.0 |   0.0 | 0.999994 | 1.894737 |</span>
<span class="sd">    | 14.01. |   1.733884 |             0.0 |         1.894737 |             1.733884 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    2.0 |                1.0 |        0.992131 | 0.992131 |    1.733884 |    2.0 |   0.0 | 0.992131 | 2.052632 |</span>
<span class="sd">    | 15.01. |   1.901059 |             0.0 |         2.052632 |             1.901059 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    2.0 |                1.0 |        0.081774 | 0.081774 |    1.901059 |    2.0 |   0.0 | 0.081774 | 2.210526 |</span>
<span class="sd">    | 16.01. |   2.075293 |             0.0 |         2.210526 |             2.075293 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    2.0 |                1.0 |        0.000063 | 0.000063 |    2.075293 |    2.0 |   0.0 | 0.000063 | 2.368421 |</span>
<span class="sd">    | 17.01. |   2.249533 |             0.0 |         2.368421 |             2.249533 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    2.0 |                1.0 |             0.0 |      0.0 |    2.249533 |    2.0 |   0.0 |      0.0 | 2.526316 |</span>
<span class="sd">    | 18.01. |   2.423773 |             0.0 |         2.526316 |             2.423773 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    2.0 |                1.0 |             0.0 |      0.0 |    2.423773 |    2.0 |   0.0 |      0.0 | 2.684211 |</span>
<span class="sd">    | 19.01. |   2.598013 |             0.0 |         2.684211 |             2.598013 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    2.0 |                1.0 |             0.0 |      0.0 |    2.598013 |    2.0 |   0.0 |      0.0 | 2.842105 |</span>
<span class="sd">    | 20.01. |   2.772253 |             0.0 |         2.842105 |             2.772253 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    2.0 |                1.0 |             0.0 |      0.0 |    2.772253 |    2.0 |   0.0 |      0.0 |      3.0 |</span>

<span class="sd">There is no indication of an error in the water balance:</span>

<span class="sd">&gt;&gt;&gt; round_(model.check_waterbalance(conditions))</span>
<span class="sd">0.0</span>

<span class="sd">.. _dam_pump_irrigation:</span>

<span class="sd">irrigation</span>
<span class="sd">__________</span>

<span class="sd">The following test run shows that the pumping (in reversed direction) starts when</span>
<span class="sd">the inner water level is lower than the defined threshold of 1 m and the remote</span>
<span class="sd">water level is above the defined threshold of 2 m. When the water level rises</span>
<span class="sd">above 1 meter, the pumping rate quickly decreases to 0.</span>

<span class="sd">&gt;&gt;&gt; waterleveldifference2maxforceddischarge(PPoly.from_data(xs=[0.0], ys=[-1.0]))</span>
<span class="sd">&gt;&gt;&gt; remote.sequences.sim.series = numpy.linspace(1.0, 4.0, 20)</span>
<span class="sd">&gt;&gt;&gt; waterlevelmaximumthreshold(2.0)</span>

<span class="sd">.. integration-test::</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;dam_pump_irrigation&quot;)</span>
<span class="sd">    |   date | waterlevel | outerwaterlevel | remotewaterlevel | waterleveldifference | precipitation | adjustedprecipitation | potentialevaporation | adjustedevaporation | actualevaporation | inflow | maxforceddischarge | forceddischarge |   outflow | watervolume | inflow | outer |   outflow |   remote |</span>
<span class="sd">    --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span>
<span class="sd">    | 01.01. |   0.174533 |             0.0 |              0.0 |             0.174533 |           2.0 |              0.033333 |                  1.0 |            0.013333 |          0.013278 |    2.0 |               -1.0 |             0.0 |       0.0 |    0.174533 |    2.0 |   0.0 |       0.0 |      1.0 |</span>
<span class="sd">    | 02.01. |    0.34883 |             0.0 |              1.0 |              0.34883 |           2.0 |              0.033333 |                  1.0 |               0.016 |             0.016 |    2.0 |               -1.0 |             0.0 |       0.0 |     0.34883 |    2.0 |   0.0 |       0.0 | 1.157895 |</span>
<span class="sd">    | 03.01. |   0.523082 |             0.0 |         1.157895 |             0.523082 |           2.0 |              0.033333 |                  1.0 |            0.016533 |          0.016533 |    2.0 |               -1.0 |             0.0 |       0.0 |    0.523082 |    2.0 |   0.0 |       0.0 | 1.315789 |</span>
<span class="sd">    | 04.01. |   0.697324 |             0.0 |         1.315789 |             0.697324 |           2.0 |              0.033333 |                  1.0 |             0.01664 |           0.01664 |    2.0 |               -1.0 |             0.0 |       0.0 |    0.697324 |    2.0 |   0.0 |       0.0 | 1.473684 |</span>
<span class="sd">    | 05.01. |   0.871565 |             0.0 |         1.473684 |             0.871565 |           2.0 |              0.033333 |                  1.0 |            0.016661 |          0.016661 |    2.0 |               -1.0 |             0.0 |       0.0 |    0.871565 |    2.0 |   0.0 |       0.0 | 1.631579 |</span>
<span class="sd">    | 06.01. |   1.045805 |             0.0 |         1.631579 |             1.045805 |           2.0 |              0.033333 |                  1.0 |            0.016666 |          0.016666 |    2.0 |               -1.0 |             0.0 |       0.0 |    1.045805 |    2.0 |   0.0 |       0.0 | 1.789474 |</span>
<span class="sd">    | 07.01. |    1.22005 |             0.0 |         1.789474 |              1.22005 |           2.0 |              0.033333 |                  1.0 |            0.016666 |          0.016666 |    2.0 |               -1.0 |       -0.000063 | -0.000063 |     1.22005 |    2.0 |   0.0 | -0.000063 | 1.947368 |</span>
<span class="sd">    | 08.01. |   1.401356 |             0.0 |         1.947368 |             1.401356 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    2.0 |               -1.0 |       -0.081774 | -0.081774 |    1.401356 |    2.0 |   0.0 | -0.081774 | 2.105263 |</span>
<span class="sd">    | 09.01. |   1.661316 |             0.0 |         2.105263 |             1.661316 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    2.0 |               -1.0 |       -0.992131 | -0.992131 |    1.661316 |    2.0 |   0.0 | -0.992131 | 2.263158 |</span>
<span class="sd">    | 10.01. |   1.921758 |             0.0 |         2.263158 |             1.921753 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    2.0 |               -1.0 |       -0.997715 | -0.997715 |    1.921758 |    2.0 |   0.0 | -0.997715 | 2.421053 |</span>
<span class="sd">    | 11.01. |    2.12494 |             0.0 |         2.421053 |             2.124942 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    2.0 |               -1.0 |       -0.334972 | -0.334972 |     2.12494 |    2.0 |   0.0 | -0.334972 | 2.578947 |</span>
<span class="sd">    | 12.01. |   2.299214 |             0.0 |         2.578947 |             2.299216 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    2.0 |               -1.0 |       -0.000401 | -0.000401 |    2.299214 |    2.0 |   0.0 | -0.000401 | 2.736842 |</span>
<span class="sd">    | 13.01. |   2.473454 |             0.0 |         2.736842 |             2.473455 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    2.0 |               -1.0 |       -0.000001 | -0.000001 |    2.473454 |    2.0 |   0.0 | -0.000001 | 2.894737 |</span>
<span class="sd">    | 14.01. |   2.647694 |             0.0 |         2.894737 |             2.647694 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    2.0 |               -1.0 |             0.0 |       0.0 |    2.647694 |    2.0 |   0.0 |       0.0 | 3.052632 |</span>
<span class="sd">    | 15.01. |   2.821934 |             0.0 |         3.052632 |             2.821934 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    2.0 |               -1.0 |             0.0 |       0.0 |    2.821934 |    2.0 |   0.0 |       0.0 | 3.210526 |</span>
<span class="sd">    | 16.01. |   2.996174 |             0.0 |         3.210526 |             2.996174 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    2.0 |               -1.0 |             0.0 |       0.0 |    2.996174 |    2.0 |   0.0 |       0.0 | 3.368421 |</span>
<span class="sd">    | 17.01. |   3.170414 |             0.0 |         3.368421 |             3.170414 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    2.0 |               -1.0 |             0.0 |       0.0 |    3.170414 |    2.0 |   0.0 |       0.0 | 3.526316 |</span>
<span class="sd">    | 18.01. |   3.344654 |             0.0 |         3.526316 |             3.344654 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    2.0 |               -1.0 |             0.0 |       0.0 |    3.344654 |    2.0 |   0.0 |       0.0 | 3.684211 |</span>
<span class="sd">    | 19.01. |   3.518894 |             0.0 |         3.684211 |             3.518894 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    2.0 |               -1.0 |             0.0 |       0.0 |    3.518894 |    2.0 |   0.0 |       0.0 | 3.842105 |</span>
<span class="sd">    | 20.01. |   3.693134 |             0.0 |         3.842105 |             3.693134 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    2.0 |               -1.0 |             0.0 |       0.0 |    3.693134 |    2.0 |   0.0 |       0.0 |      4.0 |</span>

<span class="sd">There is no indication of an error in the water balance:</span>

<span class="sd">&gt;&gt;&gt; round_(model.check_waterbalance(conditions))</span>
<span class="sd">0.0</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1"># import...</span>
<span class="c1"># ...from HydPy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">hydpy</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.auxs.anntools</span><span class="w"> </span><span class="kn">import</span> <span class="n">ANN</span>  <span class="c1"># pylint: disable=unused-import</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.auxs.ppolytools</span><span class="w"> </span><span class="kn">import</span> <span class="n">Poly</span><span class="p">,</span> <span class="n">PPoly</span>  <span class="c1"># pylint: disable=unused-import</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">modeltools</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.core.typingtools</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.interfaces</span><span class="w"> </span><span class="kn">import</span> <span class="n">petinterfaces</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.interfaces</span><span class="w"> </span><span class="kn">import</span> <span class="n">precipinterfaces</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.exe.modelimports</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>

<span class="c1"># ...from dam</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.dam</span><span class="w"> </span><span class="kn">import</span> <span class="n">dam_model</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.dam</span><span class="w"> </span><span class="kn">import</span> <span class="n">dam_solver</span>


<div class="viewcode-block" id="Model">
<a class="viewcode-back" href="../../../dam_pump.html#hydpy.models.dam_pump.Model">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Model</span><span class="p">(</span><span class="n">dam_model</span><span class="o">.</span><span class="n">Main_PrecipModel_V2</span><span class="p">,</span> <span class="n">dam_model</span><span class="o">.</span><span class="n">Main_PEModel_V1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;|dam_pump.DOCNAME.complete|.&quot;&quot;&quot;</span>

    <span class="n">DOCNAME</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">DocName</span><span class="p">(</span><span class="n">short</span><span class="o">=</span><span class="s2">&quot;Dam-Pump&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;pumping station model&quot;</span><span class="p">)</span>
    <span class="n">__HYDPY_ROOTMODEL__</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">SOLVERPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">dam_solver</span><span class="o">.</span><span class="n">AbsErrorMax</span><span class="p">,</span>
        <span class="n">dam_solver</span><span class="o">.</span><span class="n">RelErrorMax</span><span class="p">,</span>
        <span class="n">dam_solver</span><span class="o">.</span><span class="n">RelDTMin</span><span class="p">,</span>
        <span class="n">dam_solver</span><span class="o">.</span><span class="n">RelDTMax</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">SOLVERSEQUENCES</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">INLET_METHODS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">dam_model</span><span class="o">.</span><span class="n">Calc_Precipitation_V1</span><span class="p">,</span>
        <span class="n">dam_model</span><span class="o">.</span><span class="n">Calc_PotentialEvaporation_V1</span><span class="p">,</span>
        <span class="n">dam_model</span><span class="o">.</span><span class="n">Calc_AdjustedEvaporation_V1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RECEIVER_METHODS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">dam_model</span><span class="o">.</span><span class="n">Pick_LoggedOuterWaterLevel_V1</span><span class="p">,</span>
        <span class="n">dam_model</span><span class="o">.</span><span class="n">Pick_LoggedRemoteWaterLevel_V1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ADD_METHODS</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">PART_ODE_METHODS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">dam_model</span><span class="o">.</span><span class="n">Calc_AdjustedPrecipitation_V1</span><span class="p">,</span>
        <span class="n">dam_model</span><span class="o">.</span><span class="n">Pic_Inflow_V1</span><span class="p">,</span>
        <span class="n">dam_model</span><span class="o">.</span><span class="n">Calc_WaterLevel_V1</span><span class="p">,</span>
        <span class="n">dam_model</span><span class="o">.</span><span class="n">Calc_OuterWaterLevel_V1</span><span class="p">,</span>
        <span class="n">dam_model</span><span class="o">.</span><span class="n">Calc_RemoteWaterLevel_V1</span><span class="p">,</span>
        <span class="n">dam_model</span><span class="o">.</span><span class="n">Calc_WaterLevelDifference_V1</span><span class="p">,</span>
        <span class="n">dam_model</span><span class="o">.</span><span class="n">Calc_MaxForcedDischarge_V1</span><span class="p">,</span>
        <span class="n">dam_model</span><span class="o">.</span><span class="n">Calc_ForcedDischarge_V1</span><span class="p">,</span>
        <span class="n">dam_model</span><span class="o">.</span><span class="n">Calc_ActualEvaporation_V1</span><span class="p">,</span>
        <span class="n">dam_model</span><span class="o">.</span><span class="n">Calc_Outflow_V3</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">FULL_ODE_METHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">dam_model</span><span class="o">.</span><span class="n">Update_WaterVolume_V1</span><span class="p">,)</span>
    <span class="n">OUTLET_METHODS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">dam_model</span><span class="o">.</span><span class="n">Calc_WaterLevel_V1</span><span class="p">,</span>
        <span class="n">dam_model</span><span class="o">.</span><span class="n">Calc_OuterWaterLevel_V1</span><span class="p">,</span>
        <span class="n">dam_model</span><span class="o">.</span><span class="n">Calc_RemoteWaterLevel_V1</span><span class="p">,</span>
        <span class="n">dam_model</span><span class="o">.</span><span class="n">Pass_Outflow_V1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">SENDER_METHODS</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">SUBMODELINTERFACES</span> <span class="o">=</span> <span class="p">(</span><span class="n">precipinterfaces</span><span class="o">.</span><span class="n">PrecipModel_V2</span><span class="p">,</span> <span class="n">petinterfaces</span><span class="o">.</span><span class="n">PETModel_V1</span><span class="p">)</span>
    <span class="n">SUBMODELS</span> <span class="o">=</span> <span class="p">()</span>

    <span class="n">precipmodel</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelProperty</span><span class="p">(</span>
        <span class="n">precipinterfaces</span><span class="o">.</span><span class="n">PrecipModel_V2</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="n">pemodel</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelProperty</span><span class="p">(</span><span class="n">petinterfaces</span><span class="o">.</span><span class="n">PETModel_V1</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<div class="viewcode-block" id="Model.check_waterbalance">
<a class="viewcode-back" href="../../../dam_pump.html#hydpy.models.dam_pump.Model.check_waterbalance">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_waterbalance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initial_conditions</span><span class="p">:</span> <span class="n">ConditionsModel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Determine the water balance error of the previous simulation run in million</span>
<span class="sd">        m³.</span>

<span class="sd">        Method |Model.check_waterbalance| calculates the balance error as follows:</span>

<span class="sd">        :math:`Seconds \cdot 10^{-6} \cdot \sum_{t=t0}^{t1}</span>
<span class="sd">        \big( AdjustedPrecipitation_t - ActualEvaporation_t + Inflow_t - Outflow_t \big)</span>
<span class="sd">        + \big( WaterVolume_{t0}^k - WaterVolume_{t1}^k \big)`</span>

<span class="sd">        The returned error should always be in scale with numerical precision so</span>
<span class="sd">        that it does not affect the simulation results in any relevant manner.</span>

<span class="sd">        Pick the required initial conditions before starting the simulation via</span>
<span class="sd">        property |Sequences.conditions|.  See the integration tests of the application</span>
<span class="sd">        model |dam_v001| for some examples.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fluxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span>
        <span class="n">first</span> <span class="o">=</span> <span class="n">initial_conditions</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">][</span><span class="s2">&quot;states&quot;</span><span class="p">]</span>
        <span class="n">last</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">timegrids</span><span class="o">.</span><span class="n">stepsize</span><span class="o">.</span><span class="n">seconds</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
            <span class="nb">sum</span><span class="p">(</span><span class="n">fluxes</span><span class="o">.</span><span class="n">adjustedprecipitation</span><span class="o">.</span><span class="n">series</span><span class="p">)</span>
            <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">fluxes</span><span class="o">.</span><span class="n">actualevaporation</span><span class="o">.</span><span class="n">series</span><span class="p">)</span>
            <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="n">fluxes</span><span class="o">.</span><span class="n">inflow</span><span class="o">.</span><span class="n">series</span><span class="p">)</span>
            <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">fluxes</span><span class="o">.</span><span class="n">outflow</span><span class="o">.</span><span class="n">series</span><span class="p">)</span>
        <span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">last</span><span class="o">.</span><span class="n">watervolume</span> <span class="o">-</span> <span class="n">first</span><span class="p">[</span><span class="s2">&quot;watervolume&quot;</span><span class="p">])</span></div>
</div>



<span class="n">tester</span> <span class="o">=</span> <span class="n">Tester</span><span class="p">()</span>
<span class="n">cythonizer</span> <span class="o">=</span> <span class="n">Cythonizer</span><span class="p">()</span>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">HydPy 6.1.5 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">hydpy.models.dam_pump</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2013-2025, HydPy Developers.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.2.3.
    </div>
  </body>
</html>