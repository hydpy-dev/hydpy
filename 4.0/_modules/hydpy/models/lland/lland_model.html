
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>hydpy.models.lland.lland_model &#8212; HydPy 4.0.1 documentation</title>
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/graphviz.css" />
    
    <script id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
    <script src="../../../../_static/jquery.js"></script>
    <script src="../../../../_static/underscore.js"></script>
    <script src="../../../../_static/doctools.js"></script>
    
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">HydPy 4.0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">hydpy.models.lland.lland_model</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for hydpy.models.lland.lland_model</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">.. _`solar time`: https://en.wikipedia.org/wiki/Solar_time</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1"># imports...</span>
<span class="c1"># ...from HydPy</span>
<span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="kn">import</span> <span class="n">modeltools</span>
<span class="kn">from</span> <span class="nn">hydpy.auxs</span> <span class="kn">import</span> <span class="n">roottools</span>
<span class="kn">from</span> <span class="nn">hydpy.cythons</span> <span class="kn">import</span> <span class="n">modelutils</span>

<span class="c1"># ...from lland</span>
<span class="kn">from</span> <span class="nn">hydpy.models.lland</span> <span class="kn">import</span> <span class="n">lland_control</span>
<span class="kn">from</span> <span class="nn">hydpy.models.lland</span> <span class="kn">import</span> <span class="n">lland_derived</span>
<span class="kn">from</span> <span class="nn">hydpy.models.lland</span> <span class="kn">import</span> <span class="n">lland_fixed</span>
<span class="kn">from</span> <span class="nn">hydpy.models.lland</span> <span class="kn">import</span> <span class="n">lland_inlets</span>
<span class="kn">from</span> <span class="nn">hydpy.models.lland</span> <span class="kn">import</span> <span class="n">lland_inputs</span>
<span class="kn">from</span> <span class="nn">hydpy.models.lland</span> <span class="kn">import</span> <span class="n">lland_fluxes</span>
<span class="kn">from</span> <span class="nn">hydpy.models.lland</span> <span class="kn">import</span> <span class="n">lland_states</span>
<span class="kn">from</span> <span class="nn">hydpy.models.lland</span> <span class="kn">import</span> <span class="n">lland_logs</span>
<span class="kn">from</span> <span class="nn">hydpy.models.lland</span> <span class="kn">import</span> <span class="n">lland_aides</span>
<span class="kn">from</span> <span class="nn">hydpy.models.lland</span> <span class="kn">import</span> <span class="n">lland_outlets</span>
<span class="kn">from</span> <span class="nn">hydpy.models.lland.lland_constants</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">WASSER</span><span class="p">,</span>
    <span class="n">FLUSS</span><span class="p">,</span>
    <span class="n">SEE</span><span class="p">,</span>
    <span class="n">VERS</span><span class="p">,</span>
    <span class="n">LAUBW</span><span class="p">,</span>
    <span class="n">MISCHW</span><span class="p">,</span>
    <span class="n">NADELW</span><span class="p">,</span>
<span class="p">)</span>


<div class="viewcode-block" id="Pick_QZ_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Pick_QZ_V1">[docs]</a><span class="k">class</span> <span class="nc">Pick_QZ_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Query the current inflow from all inlet nodes.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`QZ = \\sum Q_{inlets}`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_inlets</span><span class="o">.</span><span class="n">Q</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QZ</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">inl</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">inlets</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">qz</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">inl</span><span class="o">.</span><span class="n">len_q</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">qz</span> <span class="o">+=</span> <span class="n">inl</span><span class="o">.</span><span class="n">q</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span></div>


<div class="viewcode-block" id="Calc_QZH_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_QZH_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_QZH_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the inflow in mm.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">       :math:`QZH = QZ / QFactor`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; derived.qfactor(2.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qz = 6.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qzh_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qzh</span>
<span class="sd">        qzh(3.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">QFactor</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QZ</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QZH</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">qzh</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">qz</span> <span class="o">/</span> <span class="n">der</span><span class="o">.</span><span class="n">qfactor</span></div>


<div class="viewcode-block" id="Update_LoggedTemL_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Update_LoggedTemL_V1">[docs]</a><span class="k">class</span> <span class="nc">Update_LoggedTemL_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Log the air temperature values of the last 24 hours.</span>

<span class="sd">    Example:</span>

<span class="sd">        The following example shows that each new method call successively</span>
<span class="sd">        moves the three memorised values to the right and stores the</span>
<span class="sd">        respective new value on the most left position:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; derived.nmblogentries(3)</span>
<span class="sd">        &gt;&gt;&gt; logs.loggedteml.shape = 3</span>
<span class="sd">        &gt;&gt;&gt; logs.loggedteml = 0.0</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import UnitTest</span>
<span class="sd">        &gt;&gt;&gt; test = UnitTest(model,</span>
<span class="sd">        ...                 model.update_loggedteml_v1,</span>
<span class="sd">        ...                 last_example=4,</span>
<span class="sd">        ...                 parseqs=(inputs.teml,</span>
<span class="sd">        ...                          logs.loggedteml))</span>
<span class="sd">        &gt;&gt;&gt; test.nexts.teml = 0.0, 6.0, 3.0, 3.0</span>
<span class="sd">        &gt;&gt;&gt; del test.inits.loggedteml</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. | teml |           loggedteml |</span>
<span class="sd">        -------------------------------------</span>
<span class="sd">        |   1 |  0.0 | 0.0  0.0         0.0 |</span>
<span class="sd">        |   2 |  6.0 | 6.0  0.0         0.0 |</span>
<span class="sd">        |   3 |  3.0 | 3.0  6.0         0.0 |</span>
<span class="sd">        |   4 |  3.0 | 3.0  3.0         6.0 |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">NmbLogEntries</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_inputs</span><span class="o">.</span><span class="n">TemL</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_logs</span><span class="o">.</span><span class="n">LoggedTemL</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">logs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">nmblogentries</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">loggedteml</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">log</span><span class="o">.</span><span class="n">loggedteml</span><span class="p">[</span><span class="n">idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">log</span><span class="o">.</span><span class="n">loggedteml</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">inp</span><span class="o">.</span><span class="n">teml</span></div>


<div class="viewcode-block" id="Calc_TemLTag_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_TemLTag_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_TemLTag_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the average air temperature of the last 24 hours.</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; derived.nmblogentries(3)</span>
<span class="sd">        &gt;&gt;&gt; logs.loggedteml.shape = 3</span>
<span class="sd">        &gt;&gt;&gt; logs.loggedteml = 1.0, 5.0, 3.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_temltag_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.temltag</span>
<span class="sd">        temltag(3.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">NmbLogEntries</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_logs</span><span class="o">.</span><span class="n">LoggedTemL</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TemLTag</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">logs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">temltag</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">nmblogentries</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">temltag</span> <span class="o">+=</span> <span class="n">log</span><span class="o">.</span><span class="n">loggedteml</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">temltag</span> <span class="o">/=</span> <span class="n">der</span><span class="o">.</span><span class="n">nmblogentries</span></div>


<div class="viewcode-block" id="Update_LoggedRelativeHumidity_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Update_LoggedRelativeHumidity_V1">[docs]</a><span class="k">class</span> <span class="nc">Update_LoggedRelativeHumidity_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Log the sunshine duration values of the last 24 hours.</span>

<span class="sd">    Example:</span>

<span class="sd">        The following example shows that each new method call successively</span>
<span class="sd">        moves the three memorised values to the right and stores the</span>
<span class="sd">        respective new value on the most left position:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; derived.nmblogentries(3)</span>
<span class="sd">        &gt;&gt;&gt; logs.loggedrelativehumidity.shape = 3</span>
<span class="sd">        &gt;&gt;&gt; logs.loggedrelativehumidity = 0.0</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import UnitTest</span>
<span class="sd">        &gt;&gt;&gt; method = (</span>
<span class="sd">        ...     model.update_loggedrelativehumidity_v1)</span>
<span class="sd">        &gt;&gt;&gt; test = UnitTest(model,</span>
<span class="sd">        ...                method,</span>
<span class="sd">        ...                 last_example=4,</span>
<span class="sd">        ...                 parseqs=(inputs.relativehumidity,</span>
<span class="sd">        ...                          logs.loggedrelativehumidity))</span>
<span class="sd">        &gt;&gt;&gt; test.nexts.relativehumidity = 0.0, 6.0, 3.0, 3.0</span>
<span class="sd">        &gt;&gt;&gt; del test.inits.loggedrelativehumidity</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. | relativehumidity |           loggedrelativehumidity |</span>
<span class="sd">        -------------------------------------------------------------</span>
<span class="sd">        |   1 |              0.0 | 0.0  0.0                     0.0 |</span>
<span class="sd">        |   2 |              6.0 | 6.0  0.0                     0.0 |</span>
<span class="sd">        |   3 |              3.0 | 3.0  6.0                     0.0 |</span>
<span class="sd">        |   4 |              3.0 | 3.0  3.0                     6.0 |</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">NmbLogEntries</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_inputs</span><span class="o">.</span><span class="n">RelativeHumidity</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_logs</span><span class="o">.</span><span class="n">LoggedRelativeHumidity</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">logs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">nmblogentries</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">loggedrelativehumidity</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">log</span><span class="o">.</span><span class="n">loggedrelativehumidity</span><span class="p">[</span><span class="n">idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">log</span><span class="o">.</span><span class="n">loggedrelativehumidity</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">inp</span><span class="o">.</span><span class="n">relativehumidity</span></div>


<div class="viewcode-block" id="Calc_DailyRelativeHumidity_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_DailyRelativeHumidity_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_DailyRelativeHumidity_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the average relative humidity of the last 24 hours.</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; derived.nmblogentries(3)</span>
<span class="sd">        &gt;&gt;&gt; logs.loggedrelativehumidity.shape = 3</span>
<span class="sd">        &gt;&gt;&gt; logs.loggedrelativehumidity = 1.0, 5.0, 3.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_dailyrelativehumidity_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailyrelativehumidity</span>
<span class="sd">        dailyrelativehumidity(3.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">NmbLogEntries</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_logs</span><span class="o">.</span><span class="n">LoggedRelativeHumidity</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">DailyRelativeHumidity</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">logs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">dailyrelativehumidity</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">nmblogentries</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">dailyrelativehumidity</span> <span class="o">+=</span> <span class="n">log</span><span class="o">.</span><span class="n">loggedrelativehumidity</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">dailyrelativehumidity</span> <span class="o">/=</span> <span class="n">der</span><span class="o">.</span><span class="n">nmblogentries</span></div>


<div class="viewcode-block" id="Update_LoggedWindSpeed2m_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Update_LoggedWindSpeed2m_V1">[docs]</a><span class="k">class</span> <span class="nc">Update_LoggedWindSpeed2m_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Log the wind speed values 2 meters above ground of the last 24 hours.</span>

<span class="sd">    Example:</span>

<span class="sd">        The following example shows that each new method call successively</span>
<span class="sd">        moves the three memorised values to the right and stores the</span>
<span class="sd">        respective new value on the most left position:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; derived.nmblogentries(3)</span>
<span class="sd">        &gt;&gt;&gt; logs.loggedwindspeed2m.shape = 3</span>
<span class="sd">        &gt;&gt;&gt; logs.loggedwindspeed2m = 0.0</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import UnitTest</span>
<span class="sd">        &gt;&gt;&gt; test = UnitTest(model,</span>
<span class="sd">        ...                 model.update_loggedwindspeed2m_v1,</span>
<span class="sd">        ...                 last_example=4,</span>
<span class="sd">        ...                 parseqs=(fluxes.windspeed2m,</span>
<span class="sd">        ...                          logs.loggedwindspeed2m))</span>
<span class="sd">        &gt;&gt;&gt; test.nexts.windspeed2m = 1.0, 3.0, 2.0, 4.0</span>
<span class="sd">        &gt;&gt;&gt; del test.inits.loggedwindspeed2m</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. | windspeed2m |           loggedwindspeed2m |</span>
<span class="sd">        ---------------------------------------------------</span>
<span class="sd">        |   1 |         1.0 | 1.0  0.0                0.0 |</span>
<span class="sd">        |   2 |         3.0 | 3.0  1.0                0.0 |</span>
<span class="sd">        |   3 |         2.0 | 2.0  3.0                1.0 |</span>
<span class="sd">        |   4 |         4.0 | 4.0  2.0                3.0 |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">NmbLogEntries</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WindSpeed2m</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_logs</span><span class="o">.</span><span class="n">LoggedWindSpeed2m</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">logs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">nmblogentries</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">loggedwindspeed2m</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">log</span><span class="o">.</span><span class="n">loggedwindspeed2m</span><span class="p">[</span><span class="n">idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">log</span><span class="o">.</span><span class="n">loggedwindspeed2m</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">windspeed2m</span></div>


<div class="viewcode-block" id="Calc_DailyWindSpeed2m_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_DailyWindSpeed2m_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_DailyWindSpeed2m_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the average wind speed 2 meters above ground of the last</span>
<span class="sd">    24 hours.</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; derived.nmblogentries(3)</span>
<span class="sd">        &gt;&gt;&gt; logs.loggedwindspeed2m.shape = 3</span>
<span class="sd">        &gt;&gt;&gt; logs.loggedwindspeed2m = 1.0, 5.0, 3.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_dailywindspeed2m_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailywindspeed2m</span>
<span class="sd">        dailywindspeed2m(3.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">NmbLogEntries</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_logs</span><span class="o">.</span><span class="n">LoggedWindSpeed2m</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">DailyWindSpeed2m</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">logs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">dailywindspeed2m</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">nmblogentries</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">dailywindspeed2m</span> <span class="o">+=</span> <span class="n">log</span><span class="o">.</span><span class="n">loggedwindspeed2m</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">dailywindspeed2m</span> <span class="o">/=</span> <span class="n">der</span><span class="o">.</span><span class="n">nmblogentries</span></div>


<div class="viewcode-block" id="Update_LoggedSunshineDuration_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Update_LoggedSunshineDuration_V1">[docs]</a><span class="k">class</span> <span class="nc">Update_LoggedSunshineDuration_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Log the sunshine duration values of the last 24 hours.</span>

<span class="sd">    Example:</span>

<span class="sd">        The following example shows that each new method call successively</span>
<span class="sd">        moves the three memorised values to the right and stores the</span>
<span class="sd">        respective new value on the most left position:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; derived.nmblogentries(3)</span>
<span class="sd">        &gt;&gt;&gt; logs.loggedsunshineduration.shape = 3</span>
<span class="sd">        &gt;&gt;&gt; logs.loggedsunshineduration = 0.0</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import UnitTest</span>
<span class="sd">        &gt;&gt;&gt; test = UnitTest(model,</span>
<span class="sd">        ...                 model.update_loggedsunshineduration_v1,</span>
<span class="sd">        ...                 last_example=4,</span>
<span class="sd">        ...                 parseqs=(inputs.sunshineduration,</span>
<span class="sd">        ...                          logs.loggedsunshineduration))</span>
<span class="sd">        &gt;&gt;&gt; test.nexts.sunshineduration = 1.0, 3.0, 2.0, 4.0</span>
<span class="sd">        &gt;&gt;&gt; del test.inits.loggedsunshineduration</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. | sunshineduration |           loggedsunshineduration |</span>
<span class="sd">        -------------------------------------------------------------</span>
<span class="sd">        |   1 |              1.0 | 1.0  0.0                     0.0 |</span>
<span class="sd">        |   2 |              3.0 | 3.0  1.0                     0.0 |</span>
<span class="sd">        |   3 |              2.0 | 2.0  3.0                     1.0 |</span>
<span class="sd">        |   4 |              4.0 | 4.0  2.0                     3.0 |</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">NmbLogEntries</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_inputs</span><span class="o">.</span><span class="n">SunshineDuration</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_logs</span><span class="o">.</span><span class="n">LoggedSunshineDuration</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">logs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">nmblogentries</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">loggedsunshineduration</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">log</span><span class="o">.</span><span class="n">loggedsunshineduration</span><span class="p">[</span><span class="n">idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">log</span><span class="o">.</span><span class="n">loggedsunshineduration</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">inp</span><span class="o">.</span><span class="n">sunshineduration</span></div>


<div class="viewcode-block" id="Calc_DailySunshineDuration_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_DailySunshineDuration_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_DailySunshineDuration_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the sunshine duration sum of the last 24 hours.</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; derived.nmblogentries(3)</span>
<span class="sd">        &gt;&gt;&gt; logs.loggedsunshineduration.shape = 3</span>
<span class="sd">        &gt;&gt;&gt; logs.loggedsunshineduration = 1.0, 5.0, 3.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_dailysunshineduration_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailysunshineduration</span>
<span class="sd">        dailysunshineduration(9.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">NmbLogEntries</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_logs</span><span class="o">.</span><span class="n">LoggedSunshineDuration</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">DailySunshineDuration</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">logs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">dailysunshineduration</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">nmblogentries</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">dailysunshineduration</span> <span class="o">+=</span> <span class="n">log</span><span class="o">.</span><span class="n">loggedsunshineduration</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span></div>


<div class="viewcode-block" id="Calc_NKor_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_NKor_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_NKor_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Adjust the given precipitation value :cite:`ref-LARSIM`.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`NKor = KG \\cdot Nied`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(3)</span>
<span class="sd">        &gt;&gt;&gt; kg(0.8, 1.0, 1.2)</span>
<span class="sd">        &gt;&gt;&gt; inputs.nied = 10.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_nkor_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.nkor</span>
<span class="sd">        nkor(8.0, 10.0, 12.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">KG</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_inputs</span><span class="o">.</span><span class="n">Nied</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NKor</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">nkor</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">kg</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">inp</span><span class="o">.</span><span class="n">nied</span></div>


<div class="viewcode-block" id="Calc_TKor_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_TKor_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_TKor_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Adjust the given air temperature value.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`TKor = KT + TemL`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(3)</span>
<span class="sd">        &gt;&gt;&gt; kt(-2.0, 0.0, 2.0)</span>
<span class="sd">        &gt;&gt;&gt; inputs.teml(1.0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_tkor_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkor</span>
<span class="sd">        tkor(-1.0, 1.0, 3.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">KT</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_inputs</span><span class="o">.</span><span class="n">TemL</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TKor</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">tkor</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">kt</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">inp</span><span class="o">.</span><span class="n">teml</span></div>


<div class="viewcode-block" id="Calc_TKorTag_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_TKorTag_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_TKorTag_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Adjust the given daily air temperature value.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`TKorTag = KT + TemLTag`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(3)</span>
<span class="sd">        &gt;&gt;&gt; kt(-2.0, 0.0, 2.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.temltag(1.0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_tkortag_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkortag</span>
<span class="sd">        tkortag(-1.0, 1.0, 3.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">KT</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TemLTag</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TKorTag</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">tkortag</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">kt</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">temltag</span></div>


<div class="viewcode-block" id="Return_AdjustedWindSpeed_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Return_AdjustedWindSpeed_V1">[docs]</a><span class="k">class</span> <span class="nc">Return_AdjustedWindSpeed_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Adjust and return the measured wind speed to the given defined</span>
<span class="sd">    height above the ground :cite:`ref-LARSIM`.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`WindSpeed \\cdot</span>
<span class="sd">      \\frac{ln(newheight/Z0)}{ln(MeasuringHeightWindSpeed/Z0)}`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(1)</span>
<span class="sd">        &gt;&gt;&gt; measuringheightwindspeed(10.0)</span>
<span class="sd">        &gt;&gt;&gt; inputs.windspeed = 5.0</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_adjustedwindspeed_v1(2.0))</span>
<span class="sd">        4.007956</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_adjustedwindspeed_v1(0.5))</span>
<span class="sd">        3.153456</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">MeasuringHeightWindSpeed</span><span class="p">,)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fixed</span><span class="o">.</span><span class="n">Z0</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_inputs</span><span class="o">.</span><span class="n">WindSpeed</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span>
        <span class="n">newheight</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">return</span> <span class="n">inp</span><span class="o">.</span><span class="n">windspeed</span> <span class="o">*</span> <span class="p">(</span>
            <span class="n">modelutils</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">newheight</span> <span class="o">/</span> <span class="n">fix</span><span class="o">.</span><span class="n">z0</span><span class="p">)</span>
            <span class="o">/</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">measuringheightwindspeed</span> <span class="o">/</span> <span class="n">fix</span><span class="o">.</span><span class="n">z0</span><span class="p">)</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Calc_WindSpeed2m_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_WindSpeed2m_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_WindSpeed2m_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Adjust the measured wind speed to a height of 2 meters above the ground.</span>

<span class="sd">    Method |Calc_WindSpeed2m_V1| uses method |Return_AdjustedWindSpeed_V1|</span>
<span class="sd">    to adjust the wind speed of all hydrological response units.</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(1)</span>
<span class="sd">        &gt;&gt;&gt; measuringheightwindspeed(10.0)</span>
<span class="sd">        &gt;&gt;&gt; inputs.windspeed = 5.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_windspeed2m_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.windspeed2m</span>
<span class="sd">        windspeed2m(4.007956)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Return_AdjustedWindSpeed_V1</span><span class="p">,)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">MeasuringHeightWindSpeed</span><span class="p">,)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fixed</span><span class="o">.</span><span class="n">Z0</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_inputs</span><span class="o">.</span><span class="n">WindSpeed</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WindSpeed2m</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">windspeed2m</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_adjustedwindspeed_v1</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span></div>


<div class="viewcode-block" id="Calc_ReducedWindSpeed2m_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_ReducedWindSpeed2m_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_ReducedWindSpeed2m_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the landuse-use-specific wind speed at height of 2 meters</span>
<span class="sd">    :cite:`ref-LARSIM` (based on :cite:`ref-LUBW2006a`,</span>
<span class="sd">    :cite:`ref-LUBWLUWG2015`).</span>


<span class="sd">    Basic equation (for forests):</span>
<span class="sd">      :math:`ReducedWindSpeed2m = \</span>
<span class="sd">      max(P1Wind - P2Wind \\cdot LAI, 0) \\cdot WindSpeed2m`</span>

<span class="sd">    Example:</span>

<span class="sd">        The basic equation given above holds for forests (hydrological</span>
<span class="sd">        response units of type |LAUBW|, |MISCHW|, and |NADELW| only.</span>
<span class="sd">        For all other landuse-use types method |Calc_ReducedWindSpeed2m_V1|</span>
<span class="sd">        maintains the given wind speed for grass:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2019-05-30&quot;, &quot;2019-06-03&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(4)</span>
<span class="sd">        &gt;&gt;&gt; lnk(OBSTB, LAUBW, MISCHW, NADELW)</span>
<span class="sd">        &gt;&gt;&gt; lai.obstb_mai = 0.0</span>
<span class="sd">        &gt;&gt;&gt; lai.laubw_mai = 2.0</span>
<span class="sd">        &gt;&gt;&gt; lai.mischw_mai = 4.0</span>
<span class="sd">        &gt;&gt;&gt; lai.nadelw_mai = 7.0</span>
<span class="sd">        &gt;&gt;&gt; p1wind(0.5)</span>
<span class="sd">        &gt;&gt;&gt; p2wind(0.1)</span>
<span class="sd">        &gt;&gt;&gt; derived.moy.update()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.windspeed2m = 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.idx_sim = pub.timegrids.init[&quot;2019-05-31&quot;]</span>
<span class="sd">        &gt;&gt;&gt; model.calc_reducedwindspeed2m_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.reducedwindspeed2m</span>
<span class="sd">        reducedwindspeed2m(2.0, 0.6, 0.2, 0.0)</span>

<span class="sd">        &gt;&gt;&gt; lai.obstb_jun = 0.0</span>
<span class="sd">        &gt;&gt;&gt; lai.laubw_jun = 3.0</span>
<span class="sd">        &gt;&gt;&gt; lai.mischw_jun = 6.0</span>
<span class="sd">        &gt;&gt;&gt; lai.nadelw_jun = 10.0</span>
<span class="sd">        &gt;&gt;&gt; model.idx_sim = pub.timegrids.init[&quot;2019-06-01&quot;]</span>
<span class="sd">        &gt;&gt;&gt; model.calc_reducedwindspeed2m_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.reducedwindspeed2m</span>
<span class="sd">        reducedwindspeed2m(2.0, 0.4, 0.0, 0.0)</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">LAI</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">P1Wind</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">P2Wind</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">MOY</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WindSpeed2m</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ReducedWindSpeed2m</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">LAUBW</span><span class="p">,</span> <span class="n">MISCHW</span><span class="p">,</span> <span class="n">NADELW</span><span class="p">):</span>
                <span class="n">d_lai</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">lai</span><span class="p">[</span><span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">der</span><span class="o">.</span><span class="n">moy</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">idx_sim</span><span class="p">]]</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">reducedwindspeed2m</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="nb">max</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">p1wind</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">p2wind</span> <span class="o">*</span> <span class="n">d_lai</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">windspeed2m</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">reducedwindspeed2m</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">windspeed2m</span></div>


<div class="viewcode-block" id="Calc_WindSpeed10m_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_WindSpeed10m_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_WindSpeed10m_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Adjust the measured wind speed to a height of 10 meters above the ground.</span>

<span class="sd">    Method |Calc_WindSpeed10m_V1| uses method |Return_AdjustedWindSpeed_V1|</span>
<span class="sd">    to adjust the wind speed of all hydrological response units.</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(1)</span>
<span class="sd">        &gt;&gt;&gt; measuringheightwindspeed(3.0)</span>
<span class="sd">        &gt;&gt;&gt; inputs.windspeed = 5.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_windspeed10m_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.windspeed10m</span>
<span class="sd">        windspeed10m(5.871465)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Return_AdjustedWindSpeed_V1</span><span class="p">,)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">MeasuringHeightWindSpeed</span><span class="p">,)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fixed</span><span class="o">.</span><span class="n">Z0</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_inputs</span><span class="o">.</span><span class="n">WindSpeed</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WindSpeed10m</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">windspeed10m</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_adjustedwindspeed_v1</span><span class="p">(</span><span class="mf">10.0</span><span class="p">)</span></div>


<div class="viewcode-block" id="Calc_SolarDeclination_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_SolarDeclination_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_SolarDeclination_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="c1"># noinspection PyUnresolvedReferences</span>
    <span class="sd">&quot;&quot;&quot;Calculate the solar declination (:cite:`ref-LARSIM`).</span>

<span class="sd">    Additional requirements:</span>
<span class="sd">      |Model.idx_sim|</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`SolarDeclination = 0.41 \\cdot cos \\left(</span>
<span class="sd">      \\frac{2 \\cdot Pi \\cdot (DOY - 171)}{365} \\right)`</span>

<span class="sd">    Examples:</span>

<span class="sd">        We define an initialisation period covering both a leap year (2000)</span>
<span class="sd">        and a non-leap year (2001):</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import pub, round_</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-01&quot;, &quot;2002-01-01&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; derived.doy.update()</span>

<span class="sd">        The following convenience function applies method</span>
<span class="sd">        |Calc_SolarDeclination_V1| for the given dates and prints the results:</span>

<span class="sd">        &gt;&gt;&gt; def test(*dates):</span>
<span class="sd">        ...     for date in dates:</span>
<span class="sd">        ...         model.idx_sim = pub.timegrids.init[date]</span>
<span class="sd">        ...         model.calc_solardeclination_v1()</span>
<span class="sd">        ...         print(date, end=&quot;: &quot;)</span>
<span class="sd">        ...         round_(fluxes.solardeclination.value)</span>

<span class="sd">        The results are identical for both years, due to :</span>

<span class="sd">        &gt;&gt;&gt; test(&quot;2000-01-01&quot;, &quot;2000-02-28&quot;, &quot;2000-02-29&quot;,</span>
<span class="sd">        ...      &quot;2000-03-01&quot;, &quot;2000-12-31&quot;)</span>
<span class="sd">        2000-01-01: -0.401992</span>
<span class="sd">        2000-02-28: -0.149946</span>
<span class="sd">        2000-02-29: -0.143355</span>
<span class="sd">        2000-03-01: -0.136722</span>
<span class="sd">        2000-12-31: -0.401992</span>

<span class="sd">        &gt;&gt;&gt; test(&quot;2001-01-01&quot;, &quot;2001-02-28&quot;,</span>
<span class="sd">        ...      &quot;2001-03-01&quot;, &quot;2001-12-31&quot;)</span>
<span class="sd">        2001-01-01: -0.401992</span>
<span class="sd">        2001-02-28: -0.149946</span>
<span class="sd">        2001-03-01: -0.136722</span>
<span class="sd">        2001-12-31: -0.401992</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">DOY</span><span class="p">,)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fixed</span><span class="o">.</span><span class="n">Pi</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SolarDeclination</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">solardeclination</span> <span class="o">=</span> <span class="mf">0.41</span> <span class="o">*</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span>
            <span class="mf">2.0</span> <span class="o">*</span> <span class="n">fix</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">doy</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">idx_sim</span><span class="p">]</span> <span class="o">-</span> <span class="mf">171.0</span><span class="p">)</span> <span class="o">/</span> <span class="mf">365.0</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Calc_TSA_TSU_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_TSA_TSU_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_TSA_TSU_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate time of sunrise and sunset of the current day</span>
<span class="sd">    :cite:`ref-LARSIM` (based on :cite:`ref-Thompson1981`).</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      :math:`TSA^* = \\frac{12}{Pi} \\cdot acos \\left(</span>
<span class="sd">      tan(SolarDeclination) \\cdot tan(LatitudeRad) +</span>
<span class="sd">      \\frac{0.0145}{cos(SolarDeclination) \\cdot cos(LatitudeRad)} \\right)`</span>

<span class="sd">      :math:`\\delta = \\frac{4 \\cdot (UTCLongitude - Longitude)}{60}`</span>

<span class="sd">      :math:`TSA = TSA^* + \\delta`</span>

<span class="sd">      :math:`TSU = 24 - TSA^* + \\delta`</span>

<span class="sd">    Examples:</span>

<span class="sd">        We calculate the local time of sunrise and sunset for a latitude of</span>
<span class="sd">        approximately 52°N and a longitude of 10°E, which is 5° west of the</span>
<span class="sd">        longitude defining the local time zone:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; longitude(10.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.utclongitude(15.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.latituderad(0.9)</span>

<span class="sd">        The sunshine duration varies between seven hours at winter solstice</span>
<span class="sd">        and 16 hours at summer solstice:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.solardeclination = -0.41</span>
<span class="sd">        &gt;&gt;&gt; model.calc_tsa_tsu_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tsa</span>
<span class="sd">        tsa(8.432308)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tsu</span>
<span class="sd">        tsu(16.234359)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.solardeclination = 0.41</span>
<span class="sd">        &gt;&gt;&gt; model.calc_tsa_tsu_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tsa</span>
<span class="sd">        tsa(4.002041)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tsu</span>
<span class="sd">        tsu(20.664625)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">Longitude</span><span class="p">,)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">LatitudeRad</span><span class="p">,</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">UTCLongitude</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fixed</span><span class="o">.</span><span class="n">Pi</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SolarDeclination</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TSA</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TSU</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">tsa</span> <span class="o">=</span> <span class="p">(</span>
            <span class="mf">12.0</span>
            <span class="o">/</span> <span class="n">fix</span><span class="o">.</span><span class="n">pi</span>
            <span class="o">*</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span>
                <span class="n">modelutils</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">solardeclination</span><span class="p">)</span> <span class="o">*</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">latituderad</span><span class="p">)</span>
                <span class="o">+</span> <span class="mf">0.0145</span>
                <span class="o">/</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">solardeclination</span><span class="p">)</span>
                <span class="o">/</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">latituderad</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">tsu</span> <span class="o">=</span> <span class="mf">24.0</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">tsa</span>
        <span class="n">d_dt</span> <span class="o">=</span> <span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">utclongitude</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">longitude</span><span class="p">)</span> <span class="o">*</span> <span class="mf">4.0</span> <span class="o">/</span> <span class="mf">60.0</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">tsa</span> <span class="o">+=</span> <span class="n">d_dt</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">tsu</span> <span class="o">+=</span> <span class="n">d_dt</span></div>


<div class="viewcode-block" id="Calc_EarthSunDistance_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_EarthSunDistance_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_EarthSunDistance_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the relative inverse distance between the earth and the sun.</span>

<span class="sd">    Basic equation (:cite:`ref-Allen1998`, equation 23):</span>

<span class="sd">      :math:`EarthSunDistance = 1 + 0.033 \\cdot cos \\bigl(</span>
<span class="sd">      2 \\cdot Pi / 366 \\cdot (DOY + 1) \\bigr)`</span>

<span class="sd">    Note that this equation differs a little from the one given by Allen</span>
<span class="sd">    :cite:`ref-Allen1998`.</span>
<span class="sd">    The following examples show that |Calc_EarthSunDistance_V1| calculates</span>
<span class="sd">    the same distance value for a specific &quot;day&quot; (e.g. the 1st March) both</span>
<span class="sd">    for leap years and non-leap years.  Hence, there is a tiny &quot;jump&quot;</span>
<span class="sd">    between the 28th February and the 1st March for non-leap years.</span>

<span class="sd">    Examples:</span>

<span class="sd">        We define an initialisation period covering both a leap year (2000)</span>
<span class="sd">        and a non-leap year (2001):</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import pub, round_</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-01&quot;, &quot;2002-01-01&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; derived.doy.update()</span>

<span class="sd">        The following convenience function applies method</span>
<span class="sd">        |Calc_EarthSunDistance_V1| for the given dates and prints the results:</span>

<span class="sd">        &gt;&gt;&gt; def test(*dates):</span>
<span class="sd">        ...     for date in dates:</span>
<span class="sd">        ...         model.idx_sim = pub.timegrids.init[date]</span>
<span class="sd">        ...         model.calc_earthsundistance_v1()</span>
<span class="sd">        ...         print(date, end=&quot;: &quot;)</span>
<span class="sd">        ...         round_(fluxes.earthsundistance.value)</span>

<span class="sd">        The results are identical for both years:</span>

<span class="sd">        &gt;&gt;&gt; test(&quot;2000-01-01&quot;, &quot;2000-02-28&quot;, &quot;2000-02-29&quot;,</span>
<span class="sd">        ...      &quot;2000-03-01&quot;, &quot;2000-07-01&quot;, &quot;2000-12-31&quot;)</span>
<span class="sd">        2000-01-01: 1.032995</span>
<span class="sd">        2000-02-28: 1.017471</span>
<span class="sd">        2000-02-29: 1.016988</span>
<span class="sd">        2000-03-01: 1.0165</span>
<span class="sd">        2000-07-01: 0.967</span>
<span class="sd">        2000-12-31: 1.033</span>

<span class="sd">        &gt;&gt;&gt; test(&quot;2001-01-01&quot;, &quot;2001-02-28&quot;,</span>
<span class="sd">        ...      &quot;2001-03-01&quot;, &quot;2001-07-01&quot;, &quot;2001-12-31&quot;)</span>
<span class="sd">        2001-01-01: 1.032995</span>
<span class="sd">        2001-02-28: 1.017471</span>
<span class="sd">        2001-03-01: 1.0165</span>
<span class="sd">        2001-07-01: 0.967</span>
<span class="sd">        2001-12-31: 1.033</span>

<span class="sd">        The following calculation agrees with example 8 of Allen</span>
<span class="sd">        :cite:`ref-Allen1998`:</span>

<span class="sd">        &gt;&gt;&gt; derived.doy(246)</span>
<span class="sd">        &gt;&gt;&gt; model.idx_sim = 0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_earthsundistance_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.earthsundistance</span>
<span class="sd">        earthsundistance(0.984993)</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">DOY</span><span class="p">,)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fixed</span><span class="o">.</span><span class="n">Pi</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">EarthSunDistance</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">earthsundistance</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="mf">0.033</span> <span class="o">*</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span>
            <span class="mi">2</span> <span class="o">*</span> <span class="n">fix</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">366.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">doy</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">idx_sim</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Calc_ExtraterrestrialRadiation_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_ExtraterrestrialRadiation_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_ExtraterrestrialRadiation_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the amount of extraterrestrial radiation of the current day</span>
<span class="sd">    :cite:`ref-LARSIM` (based on :cite:`ref-Thompson1981`).</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`ExternalTerrestrialRadiation =</span>
<span class="sd">      \\frac{Sol \\cdot EarthSunDistance \\cdot (</span>
<span class="sd">      SunsetHourAngle \\cdot sin(LatitudeRad) \\cdot sin(SolarDeclination) +</span>
<span class="sd">      cos(LatitudeRad) \\cdot cos(SolarDeclination) \\cdot sin(SunsetHourAngle)</span>
<span class="sd">      )}{PI}`</span>

<span class="sd">      :math:`SunsetHourAngle = (TSU-TSA) \\cdot \\frac{Pi}{24}`</span>

<span class="sd">    Examples:</span>

<span class="sd">        First, we calculate the extraterrestrial radiation for a latitude of</span>
<span class="sd">        approximately 52°N:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; derived.latituderad(0.9)</span>

<span class="sd">        The sunshine duration varies between seven hours at winter solstice</span>
<span class="sd">        and 16 hours at summer solstice, which corresponds to a daily sum of</span>
<span class="sd">        extraterrestrial radiation of 6.1 and 44.4 MJ/m², respectively:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.solardeclination = -0.41</span>
<span class="sd">        &gt;&gt;&gt; fluxes.earthsundistance = 0.97</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tsa = 8.4</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tsu = 15.6</span>
<span class="sd">        &gt;&gt;&gt; model.calc_extraterrestrialradiation_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.extraterrestrialradiation</span>
<span class="sd">        extraterrestrialradiation(6.087605)</span>

<span class="sd">        &gt;&gt;&gt; fluxes.solardeclination = 0.41</span>
<span class="sd">        &gt;&gt;&gt; fluxes.earthsundistance = 1.03</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tsa = 4.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tsu = 20.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_extraterrestrialradiation_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.extraterrestrialradiation</span>
<span class="sd">        extraterrestrialradiation(44.44131)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">LatitudeRad</span><span class="p">,)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">Pi</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">Sol</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SolarDeclination</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">EarthSunDistance</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TSA</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TSU</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ExtraterrestrialRadiation</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">d_sunsethourangle</span> <span class="o">=</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">tsu</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">tsa</span><span class="p">)</span> <span class="o">*</span> <span class="n">fix</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">24.0</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">extraterrestrialradiation</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">fix</span><span class="o">.</span><span class="n">sol</span>
            <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">earthsundistance</span>
            <span class="o">/</span> <span class="n">fix</span><span class="o">.</span><span class="n">pi</span>
            <span class="o">*</span> <span class="p">(</span>
                <span class="n">d_sunsethourangle</span>
                <span class="o">*</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">solardeclination</span><span class="p">)</span>
                <span class="o">*</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">latituderad</span><span class="p">)</span>
                <span class="o">+</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">solardeclination</span><span class="p">)</span>
                <span class="o">*</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">latituderad</span><span class="p">)</span>
                <span class="o">*</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">d_sunsethourangle</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Calc_PossibleSunshineDuration_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_PossibleSunshineDuration_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_PossibleSunshineDuration_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the possible astronomical sunshine duration</span>
<span class="sd">    :cite:`ref-LARSIM`.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`PossibleSunshineDuration = max \\bigl(</span>
<span class="sd">      max(SCT-Hours/2, TSA) - min(SCT+Hours/2, TSU), 0 \\bigr)`</span>

<span class="sd">    Examples:</span>

<span class="sd">        We focus on winter conditions with a relatively short possible</span>
<span class="sd">        sunshine duration:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tsa(8.4)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tsu(15.6)</span>

<span class="sd">        We start with a daily simulation time step.  The possible sunshine</span>
<span class="sd">        duration is, as to be expected, the span between sunrise and sunset:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub, round_</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-01&quot;, &quot;2000-01-02&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; derived.sct.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.hours.update()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_possiblesunshineduration_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.possiblesunshineduration</span>
<span class="sd">        possiblesunshineduration(7.2)</span>

<span class="sd">        The following example calculates the hourly possible sunshine</span>
<span class="sd">        durations of the same day:</span>

<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-01&quot;, &quot;2000-01-02&quot;, &quot;1h&quot;</span>
<span class="sd">        &gt;&gt;&gt; derived.sct.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.hours.update()</span>
<span class="sd">        &gt;&gt;&gt; sum_ = 0.0</span>
<span class="sd">        &gt;&gt;&gt; for idx in range(24):</span>
<span class="sd">        ...     model.idx_sim = idx</span>
<span class="sd">        ...     model.calc_possiblesunshineduration_v1()</span>
<span class="sd">        ...     print(idx+1, end=&quot;: &quot;)   # doctest: +ELLIPSIS</span>
<span class="sd">        ...     round_(fluxes.possiblesunshineduration.value)</span>
<span class="sd">        ...     sum_ += fluxes.possiblesunshineduration.value</span>
<span class="sd">        1: 0.0</span>
<span class="sd">        ...</span>
<span class="sd">        9: 0.6</span>
<span class="sd">        10: 1.0</span>
<span class="sd">        ...</span>
<span class="sd">        15: 1.0</span>
<span class="sd">        16: 0.6</span>
<span class="sd">        17: 0.0</span>
<span class="sd">        ...</span>
<span class="sd">        24: 0.0</span>

<span class="sd">        The sum of the hourly possible sunshine durations equals the daily</span>
<span class="sd">        possible sunshine, of course:</span>

<span class="sd">        &gt;&gt;&gt; round_(sum_)</span>
<span class="sd">        7.2</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">SCT</span><span class="p">,</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">Hours</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TSA</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TSU</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">PossibleSunshineDuration</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">d_tc</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">sct</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">idx_sim</span><span class="p">]</span>
        <span class="n">d_t0</span> <span class="o">=</span> <span class="nb">max</span><span class="p">((</span><span class="n">d_tc</span> <span class="o">-</span> <span class="n">der</span><span class="o">.</span><span class="n">hours</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">),</span> <span class="n">flu</span><span class="o">.</span><span class="n">tsa</span><span class="p">)</span>
        <span class="n">d_t1</span> <span class="o">=</span> <span class="nb">min</span><span class="p">((</span><span class="n">d_tc</span> <span class="o">+</span> <span class="n">der</span><span class="o">.</span><span class="n">hours</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">),</span> <span class="n">flu</span><span class="o">.</span><span class="n">tsu</span><span class="p">)</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">possiblesunshineduration</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">d_t1</span> <span class="o">-</span> <span class="n">d_t0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span></div>


<div class="viewcode-block" id="Calc_DailyPossibleSunshineDuration_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_DailyPossibleSunshineDuration_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_DailyPossibleSunshineDuration_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the possible astronomical sunshine duration.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`PossibleSunshineDuration =  TSU - TSA`</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tsa(8.4)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tsu(15.6)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_dailypossiblesunshineduration()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailypossiblesunshineduration</span>
<span class="sd">        dailypossiblesunshineduration(7.2)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TSA</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TSU</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">DailyPossibleSunshineDuration</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">dailypossiblesunshineduration</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">tsu</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">tsa</span></div>


<div class="viewcode-block" id="Calc_SP_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_SP_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_SP_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the relative sum of radiation :cite:`ref-LARSIM-Hilfe`.</span>

<span class="sd">    Additional requirements:</span>
<span class="sd">      |Model.idx_sim|</span>

<span class="sd">    Basic equations:</span>

<span class="sd">      .. math::</span>
<span class="sd">        SP = S_P^*(SCT + Hours/2) - S_P^*(SCT - Hours/2)</span>

<span class="sd">      .. math::</span>
<span class="sd">        S_P^*(t) = \\begin{cases}</span>
<span class="sd">        0</span>
<span class="sd">        &amp;|\\</span>
<span class="sd">        TL_P(t) \\leq 0</span>
<span class="sd">        \\\\</span>
<span class="sd">        50 - 50 \\cdot cos\\bigl(1.8 \\cdot TL_P(t)\\bigr) -</span>
<span class="sd">        3.4 \\cdot sin\\bigl(3.6 \\cdot TL_P(t)\\bigr)^2</span>
<span class="sd">        &amp;|\\</span>
<span class="sd">        0 &lt; TL_P(t) \\leq 50 \\cdot \\frac{2 \\cdot Pi}{360}</span>
<span class="sd">        \\\\</span>
<span class="sd">        50 - 50 \\cdot cos\\bigl(1.8 \\cdot TL_P(t)\\bigr) +</span>
<span class="sd">        3.4 \\cdot sin\\bigl(3.6 \\cdot TL_P(t)\\bigr)^2</span>
<span class="sd">        &amp;|\\</span>
<span class="sd">        50 \\cdot \\frac{2 \\cdot Pi}{360} &lt; TL_P(t) &lt;</span>
<span class="sd">        100 \\cdot \\frac{2 \\cdot Pi}{360}</span>
<span class="sd">        \\\\</span>
<span class="sd">        100</span>
<span class="sd">        &amp;|\\</span>
<span class="sd">        100 \\cdot \\frac{2 \\cdot Pi}{360} \\leq TL_P(t)</span>
<span class="sd">        \\end{cases}</span>

<span class="sd">      .. math::</span>
<span class="sd">        TL_P(t) = 100 \\cdot \\frac{2 \\cdot Pi}{360} \\cdot</span>
<span class="sd">        \\frac{t - TSA}{TSU - TSA}</span>

<span class="sd">    Examples:</span>

<span class="sd">        We focus on winter conditions with a relatively short possible</span>
<span class="sd">        sunshine duration:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tsa(8.4)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tsu(15.6)</span>

<span class="sd">        We start with an hourly simulation time step.  The relative radiation</span>
<span class="sd">        sum is, as to be expected, zero before sunrise and after sunset.</span>
<span class="sd">        In between, it reaches its maximum around noon:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub, round_</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-01&quot;, &quot;2000-01-02&quot;, &quot;1h&quot;</span>
<span class="sd">        &gt;&gt;&gt; derived.sct.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.hours.update()</span>
<span class="sd">        &gt;&gt;&gt; for idx in range(7, 17):</span>
<span class="sd">        ...     model.idx_sim = idx</span>
<span class="sd">        ...     model.calc_sp_v1()</span>
<span class="sd">        ...     print(idx+1, end=&quot;: &quot;)</span>
<span class="sd">        ...     round_(fluxes.sp.value)</span>
<span class="sd">        8: 0.0</span>
<span class="sd">        9: 0.853709</span>
<span class="sd">        10: 7.546592</span>
<span class="sd">        11: 18.473585</span>
<span class="sd">        12: 23.126115</span>
<span class="sd">        13: 23.126115</span>
<span class="sd">        14: 18.473585</span>
<span class="sd">        15: 7.546592</span>
<span class="sd">        16: 0.853709</span>
<span class="sd">        17: 0.0</span>

<span class="sd">        The following examples show how method |Calc_SP_V1| works for</span>
<span class="sd">        time step sizes longer than one hour:</span>

<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-01&quot;, &quot;2000-01-02&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; derived.sct.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.hours.update()</span>
<span class="sd">        &gt;&gt;&gt; model.idx_sim = 0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_sp_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.sp</span>
<span class="sd">        sp(100.0)</span>

<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-01&quot;, &quot;2000-01-02&quot;, &quot;6h&quot;</span>
<span class="sd">        &gt;&gt;&gt; derived.sct.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.hours.update()</span>
<span class="sd">        &gt;&gt;&gt; for idx in range(4):</span>
<span class="sd">        ...     model.idx_sim = idx</span>
<span class="sd">        ...     model.calc_sp_v1()</span>
<span class="sd">        ...     print((idx+1)*6, end=&quot;: &quot;)</span>
<span class="sd">        ...     round_(fluxes.sp.value)</span>
<span class="sd">        6: 0.0</span>
<span class="sd">        12: 50.0</span>
<span class="sd">        18: 50.0</span>
<span class="sd">        24: 0.0</span>

<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-01&quot;, &quot;2000-01-02&quot;, &quot;3h&quot;</span>
<span class="sd">        &gt;&gt;&gt; derived.sct.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.hours.update()</span>
<span class="sd">        &gt;&gt;&gt; for idx in range(8):</span>
<span class="sd">        ...     model.idx_sim = idx</span>
<span class="sd">        ...     model.calc_sp_v1()</span>
<span class="sd">        ...     print((idx+1)*3, end=&quot;: &quot;)</span>
<span class="sd">        ...     round_(fluxes.sp.value)</span>
<span class="sd">        3: 0.0</span>
<span class="sd">        6: 0.0</span>
<span class="sd">        9: 0.853709</span>
<span class="sd">        12: 49.146291</span>
<span class="sd">        15: 49.146291</span>
<span class="sd">        18: 0.853709</span>
<span class="sd">        21: 0.0</span>
<span class="sd">        24: 0.0</span>

<span class="sd">        Often, method |Calc_SP_V1| calculates a small but unrealistic</span>
<span class="sd">        &quot;bumb&quot; around noon (for example, the relative radiation is slightly</span>
<span class="sd">        smaller between 11:30 and 12:00 than it is between 11:00 and 11:30):</span>

<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-01&quot;, &quot;2000-01-02&quot;, &quot;30m&quot;</span>
<span class="sd">        &gt;&gt;&gt; derived.sct.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.hours.update()</span>
<span class="sd">        &gt;&gt;&gt; for idx in range(15, 33):</span>
<span class="sd">        ...     model.idx_sim = idx</span>
<span class="sd">        ...     model.calc_sp_v1()</span>
<span class="sd">        ...     print((idx+1)/2, end=&quot;: &quot;)</span>
<span class="sd">        ...     round_(fluxes.sp.value)</span>
<span class="sd">        8.0: 0.0</span>
<span class="sd">        8.5: 0.021762</span>
<span class="sd">        9.0: 0.831947</span>
<span class="sd">        9.5: 2.514315</span>
<span class="sd">        10.0: 5.032276</span>
<span class="sd">        10.5: 7.989385</span>
<span class="sd">        11.0: 10.4842</span>
<span class="sd">        11.5: 11.696873</span>
<span class="sd">        12.0: 11.429242</span>
<span class="sd">        12.5: 11.429242</span>
<span class="sd">        13.0: 11.696873</span>
<span class="sd">        13.5: 10.4842</span>
<span class="sd">        14.0: 7.989385</span>
<span class="sd">        14.5: 5.032276</span>
<span class="sd">        15.0: 2.514315</span>
<span class="sd">        15.5: 0.831947</span>
<span class="sd">        16.0: 0.021762</span>
<span class="sd">        16.5: 0.0</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">SCT</span><span class="p">,</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">Hours</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fixed</span><span class="o">.</span><span class="n">Pi</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TSA</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TSU</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SP</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">d_fac</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">fix</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">360.0</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">sp</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span><span class="p">:</span>
                <span class="n">d_dt</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">hours</span> <span class="o">/</span> <span class="mf">2.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">d_dt</span> <span class="o">=</span> <span class="o">-</span><span class="n">der</span><span class="o">.</span><span class="n">hours</span> <span class="o">/</span> <span class="mf">2.0</span>
            <span class="n">d_tlp</span> <span class="o">=</span> <span class="p">(</span>
                <span class="mf">100.0</span>
                <span class="o">*</span> <span class="n">d_fac</span>
                <span class="o">*</span> <span class="p">((</span><span class="n">der</span><span class="o">.</span><span class="n">sct</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">idx_sim</span><span class="p">]</span> <span class="o">+</span> <span class="n">d_dt</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">tsa</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">tsu</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">tsa</span><span class="p">))</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">d_tlp</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">d_sp</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">elif</span> <span class="n">d_tlp</span> <span class="o">&lt;</span> <span class="mf">100.0</span> <span class="o">*</span> <span class="n">d_fac</span><span class="p">:</span>
                <span class="n">d_sp</span> <span class="o">=</span> <span class="mf">50.0</span> <span class="o">-</span> <span class="mf">50.0</span> <span class="o">*</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mf">1.8</span> <span class="o">*</span> <span class="n">d_tlp</span><span class="p">)</span>
                <span class="n">d_temp</span> <span class="o">=</span> <span class="mf">3.4</span> <span class="o">*</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mf">3.6</span> <span class="o">*</span> <span class="n">d_tlp</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
                <span class="k">if</span> <span class="n">d_tlp</span> <span class="o">&lt;=</span> <span class="mf">50.0</span> <span class="o">*</span> <span class="n">d_fac</span><span class="p">:</span>
                    <span class="n">d_sp</span> <span class="o">-=</span> <span class="n">d_temp</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">d_sp</span> <span class="o">+=</span> <span class="n">d_temp</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">d_sp</span> <span class="o">=</span> <span class="mf">100.0</span>
            <span class="k">if</span> <span class="n">i</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">sp</span> <span class="o">+=</span> <span class="n">d_sp</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">sp</span> <span class="o">-=</span> <span class="n">d_sp</span></div>


<div class="viewcode-block" id="Return_DailyGlobalRadiation_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Return_DailyGlobalRadiation_V1">[docs]</a><span class="k">class</span> <span class="nc">Return_DailyGlobalRadiation_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate and return the daily global radiation :cite:`ref-LARSIM`.</span>

<span class="sd">    Additional requirements:</span>
<span class="sd">      |Model.idx_sim|</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      .. math::</span>
<span class="sd">        ExtraterrestrialRadiation \\cdot \\begin{cases}</span>
<span class="sd">        AngstromConstant + AngstromFactor \\cdot</span>
<span class="sd">        \\frac{sunshineduration}{possiblesunshineduration}</span>
<span class="sd">        &amp;|\\</span>
<span class="sd">        sunshineduration &gt; 0 \\;\\; \\lor \\;\\; Days &lt; 1</span>
<span class="sd">        \\\\</span>
<span class="sd">        AngstromAlternative</span>
<span class="sd">        &amp;|\\</span>
<span class="sd">        sunshineduration = 0 \\;\\; \\land \\;\\; Days \\geq1</span>
<span class="sd">        \\end{cases}</span>

<span class="sd">    Example:</span>

<span class="sd">        You can define the underlying Angstrom coefficients on a monthly</span>
<span class="sd">        basis to reflect the annual variability in the relationship between</span>
<span class="sd">        sunshine duration and  global radiation.  First, we demonstrate</span>
<span class="sd">        this for a daily time-step basis:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub, round_</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-30&quot;, &quot;2000-02-03&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; derived.moy.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.days.update()</span>
<span class="sd">        &gt;&gt;&gt; angstromconstant.jan = 0.1</span>
<span class="sd">        &gt;&gt;&gt; angstromfactor.jan = 0.5</span>
<span class="sd">        &gt;&gt;&gt; angstromalternative.jan = 0.2</span>
<span class="sd">        &gt;&gt;&gt; angstromconstant.feb = 0.2</span>
<span class="sd">        &gt;&gt;&gt; angstromfactor.feb = 0.6</span>
<span class="sd">        &gt;&gt;&gt; angstromalternative.feb = 0.3</span>
<span class="sd">        &gt;&gt;&gt; fluxes.extraterrestrialradiation = 1.7</span>
<span class="sd">        &gt;&gt;&gt; model.idx_sim = 1</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_dailyglobalradiation_v1(0.6, 1.0))</span>
<span class="sd">        0.68</span>
<span class="sd">        &gt;&gt;&gt; model.idx_sim = 2</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_dailyglobalradiation_v1(0.6, 1.0))</span>
<span class="sd">        0.952</span>

<span class="sd">        If possible sunshine duration is zero, we generally set global</span>
<span class="sd">        radiation to zero (even if the actual sunshine duration is larger</span>
<span class="sd">        than zero, which might occur as a result of small inconsistencies</span>
<span class="sd">        between measured and calculated input data):</span>

<span class="sd">        &gt;&gt;&gt; round_(model.return_dailyglobalradiation_v1(0.6, 0.0))</span>
<span class="sd">        0.0</span>

<span class="sd">        When actual sunshine is zero, the alternative Angstrom coefficient</span>
<span class="sd">        applies:</span>

<span class="sd">        &gt;&gt;&gt; model.idx_sim = 1</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_dailyglobalradiation_v1(0.0, 1.0))</span>
<span class="sd">        0.34</span>
<span class="sd">        &gt;&gt;&gt; model.idx_sim = 2</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_dailyglobalradiation_v1(0.0, 1.0))</span>
<span class="sd">        0.51</span>

<span class="sd">        All of the examples and explanations above hold for short simulation</span>
<span class="sd">        time steps, except that parameter |AngstromAlternative| does never</span>
<span class="sd">        replace parameter |AngstromConstant|:</span>

<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-30&quot;, &quot;2000-02-03&quot;, &quot;1h&quot;</span>
<span class="sd">        &gt;&gt;&gt; derived.moy.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.days.update()</span>
<span class="sd">        &gt;&gt;&gt; model.idx_sim = 1</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_dailyglobalradiation_v1(0.0, 1.0))</span>
<span class="sd">        0.17</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">AngstromConstant</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">AngstromFactor</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">AngstromAlternative</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">MOY</span><span class="p">,</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">Days</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ExtraterrestrialRadiation</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span>
        <span class="n">sunshineduration</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">possiblesunshineduration</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">if</span> <span class="n">possiblesunshineduration</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">moy</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">idx_sim</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">sunshineduration</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">days</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">flu</span><span class="o">.</span><span class="n">extraterrestrialradiation</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">angstromalternative</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">flu</span><span class="o">.</span><span class="n">extraterrestrialradiation</span> <span class="o">*</span> <span class="p">(</span>
                <span class="n">con</span><span class="o">.</span><span class="n">angstromconstant</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
                <span class="o">+</span> <span class="n">con</span><span class="o">.</span><span class="n">angstromfactor</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">*</span> <span class="n">sunshineduration</span> <span class="o">/</span> <span class="n">possiblesunshineduration</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="mf">0.0</span></div>


<div class="viewcode-block" id="Calc_GlobalRadiation_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_GlobalRadiation_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_GlobalRadiation_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the global radiation :cite:`ref-LARSIM`.</span>

<span class="sd">    Additional requirements:</span>
<span class="sd">      |Model.idx_sim|</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      .. math::</span>
<span class="sd">        GlobalRadiation =  \\frac{SP}{100}\\cdot \\begin{cases}</span>
<span class="sd">        Return\\_DailyGlobalRadiation\\_V1(</span>
<span class="sd">        SunshineDuration, PossibleSunshineDuration)</span>
<span class="sd">        &amp;|\\</span>
<span class="sd">        PossibleSunshineDuration &gt; 0</span>
<span class="sd">        \\\\</span>
<span class="sd">        Return\\_DailyGlobalRadiation\\_V1(</span>
<span class="sd">        DailySunshineDuration, DailyPossibleSunshineDuration)</span>
<span class="sd">        &amp;|\\</span>
<span class="sd">        PossibleSunshineDuration = 0</span>
<span class="sd">        \\end{cases}</span>

<span class="sd">    Examples:</span>

<span class="sd">        Method |Calc_GlobalRadiation_V1| uses the actual value of |SP| and</span>
<span class="sd">        method |Return_DailyGlobalRadiation_V1|, to calculate the current</span>
<span class="sd">        global radiation agreeing with the current values of sequence</span>
<span class="sd">        |SunshineDuration| and sequence |PossibleSunshineDuration|:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-30&quot;, &quot;2000-02-03&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; derived.nmblogentries.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.moy.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.days.update()</span>
<span class="sd">        &gt;&gt;&gt; angstromconstant.jan = 0.1</span>
<span class="sd">        &gt;&gt;&gt; angstromconstant.jan = 0.1</span>
<span class="sd">        &gt;&gt;&gt; angstromfactor.jan = 0.5</span>
<span class="sd">        &gt;&gt;&gt; angstromalternative.jan = 0.2</span>
<span class="sd">        &gt;&gt;&gt; inputs.sunshineduration = 0.6</span>
<span class="sd">        &gt;&gt;&gt; fluxes.possiblesunshineduration = 1.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.extraterrestrialradiation = 1.7</span>
<span class="sd">        &gt;&gt;&gt; fluxes.sp = 50.0</span>
<span class="sd">        &gt;&gt;&gt; model.idx_sim = 1</span>
<span class="sd">        &gt;&gt;&gt; model.calc_globalradiation_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.globalradiation</span>
<span class="sd">        globalradiation(0.34)</span>

<span class="sd">        During nightime periods, the value of |PossibleSunshineDuration| is</span>
<span class="sd">        zero.  Then, method |Calc_GlobalRadiation_V1| uses the values of the</span>
<span class="sd">        sequences |DailySunshineDuration| and |DailyPossibleSunshineDuration|</span>
<span class="sd">        as surrogates:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.possiblesunshineduration = 0.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailysunshineduration = 4.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailypossiblesunshineduration = 10.0</span>

<span class="sd">        &gt;&gt;&gt; model.calc_globalradiation_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.globalradiation</span>
<span class="sd">        globalradiation(0.255)</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Return_DailyGlobalRadiation_V1</span><span class="p">,)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">AngstromConstant</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">AngstromFactor</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">AngstromAlternative</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">MOY</span><span class="p">,</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">Days</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_inputs</span><span class="o">.</span><span class="n">SunshineDuration</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ExtraterrestrialRadiation</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">PossibleSunshineDuration</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">DailySunshineDuration</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">DailyPossibleSunshineDuration</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SP</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">GlobalRadiation</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">if</span> <span class="n">flu</span><span class="o">.</span><span class="n">possiblesunshineduration</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">d_act</span> <span class="o">=</span> <span class="n">inp</span><span class="o">.</span><span class="n">sunshineduration</span>
            <span class="n">d_pos</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">possiblesunshineduration</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d_act</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">dailysunshineduration</span>
            <span class="n">d_pos</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">dailypossiblesunshineduration</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">globalradiation</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">sp</span> <span class="o">/</span> <span class="mf">100.0</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">return_dailyglobalradiation_v1</span><span class="p">(</span><span class="n">d_act</span><span class="p">,</span> <span class="n">d_pos</span><span class="p">)</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Update_LoggedGlobalRadiation_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Update_LoggedGlobalRadiation_V1">[docs]</a><span class="k">class</span> <span class="nc">Update_LoggedGlobalRadiation_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Log the global radiation values of the last 24 hours.</span>

<span class="sd">    Example:</span>

<span class="sd">        The following example shows that each new method call successively</span>
<span class="sd">        moves the three memorised values to the right and stores the</span>
<span class="sd">        respective new value on the most left position:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;8h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; derived.nmblogentries.update()</span>
<span class="sd">        &gt;&gt;&gt; logs.loggedglobalradiation = 0.0</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import UnitTest</span>
<span class="sd">        &gt;&gt;&gt; test = UnitTest(model,</span>
<span class="sd">        ...                 model.update_loggedglobalradiation_v1,</span>
<span class="sd">        ...                 last_example=4,</span>
<span class="sd">        ...                 parseqs=(fluxes.globalradiation,</span>
<span class="sd">        ...                          logs.loggedglobalradiation))</span>
<span class="sd">        &gt;&gt;&gt; test.nexts.globalradiation = 1.0, 3.0, 2.0, 4.0</span>
<span class="sd">        &gt;&gt;&gt; del test.inits.loggedglobalradiation</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. | globalradiation |           loggedglobalradiation |</span>
<span class="sd">        -----------------------------------------------------------</span>
<span class="sd">        |   1 |             1.0 | 1.0  0.0                    0.0 |</span>
<span class="sd">        |   2 |             3.0 | 3.0  1.0                    0.0 |</span>
<span class="sd">        |   3 |             2.0 | 2.0  3.0                    1.0 |</span>
<span class="sd">        |   4 |             4.0 | 4.0  2.0                    3.0 |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">NmbLogEntries</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">GlobalRadiation</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_logs</span><span class="o">.</span><span class="n">LoggedGlobalRadiation</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">logs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">nmblogentries</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">loggedglobalradiation</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">log</span><span class="o">.</span><span class="n">loggedglobalradiation</span><span class="p">[</span><span class="n">idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">log</span><span class="o">.</span><span class="n">loggedglobalradiation</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">globalradiation</span></div>


<div class="viewcode-block" id="Calc_DailyGlobalRadiation_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_DailyGlobalRadiation_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_DailyGlobalRadiation_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the daily global radiation.</span>

<span class="sd">    Additional requirements:</span>
<span class="sd">      |Model.idx_sim|</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`DailyGlobalRadiation = Return\\_DailyGlobalRadiation\\_(</span>
<span class="sd">      DailySunshineDuration, DailyPossibleSunshineDuration)`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; angstromconstant.jan = 0.1</span>
<span class="sd">        &gt;&gt;&gt; angstromfactor.jan = 0.5</span>
<span class="sd">        &gt;&gt;&gt; angstromconstant.feb = 0.2</span>
<span class="sd">        &gt;&gt;&gt; angstromfactor.feb = 0.6</span>

<span class="sd">        We define the extraterrestrial radiation to 10 MJ/m² and the</span>
<span class="sd">        possible sunshine duration to 12 hours:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.extraterrestrialradiation = 10.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailypossiblesunshineduration = 12.0</span>

<span class="sd">        We define a daily simulation step size and update the relevant</span>
<span class="sd">        derived parameters:</span>

<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-30&quot;, &quot;2000-02-03&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; derived.moy.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.nmblogentries.update()</span>

<span class="sd">        Applying the Angstrom coefficients for January and February on</span>
<span class="sd">        the defined extraterrestrial radiation and a sunshine duration</span>
<span class="sd">        of 7.2 hours results in a daily global radiation sum of 4.0 MJ/m²</span>
<span class="sd">        and 5.6 MJ/m², respectively:</span>

<span class="sd">        &gt;&gt;&gt; model.idx_sim = 1</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailysunshineduration = 7.2</span>
<span class="sd">        &gt;&gt;&gt; model.calc_dailyglobalradiation_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailyglobalradiation</span>
<span class="sd">        dailyglobalradiation(4.0)</span>

<span class="sd">        &gt;&gt;&gt; model.idx_sim = 2</span>
<span class="sd">        &gt;&gt;&gt; model.calc_dailyglobalradiation_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailyglobalradiation</span>
<span class="sd">        dailyglobalradiation(5.6)</span>

<span class="sd">        Finally, we demonstrate for January that method</span>
<span class="sd">        |Calc_DailyGlobalRadiation_V1| calculates the same values for an</span>
<span class="sd">        hourly simulation time step, as long as the daily sum of sunshine</span>
<span class="sd">        duration remains identical:</span>

<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-30&quot;, &quot;2000-02-03&quot;, &quot;1h&quot;</span>
<span class="sd">        &gt;&gt;&gt; derived.moy.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.nmblogentries.update()</span>

<span class="sd">        The actual simulation step starts at 11 o&#39;clock and ends at 12 o&#39;clock:</span>

<span class="sd">        &gt;&gt;&gt; model.idx_sim = pub.timegrids.init[&quot;2000-01-31 11:00&quot;]</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailysunshineduration = 7.2</span>
<span class="sd">        &gt;&gt;&gt; model.calc_dailyglobalradiation_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailyglobalradiation</span>
<span class="sd">        dailyglobalradiation(4.0)</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Return_DailyGlobalRadiation_V1</span><span class="p">,)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">AngstromConstant</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">AngstromFactor</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">AngstromAlternative</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">MOY</span><span class="p">,</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">Days</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ExtraterrestrialRadiation</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">DailySunshineDuration</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">DailyPossibleSunshineDuration</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">DailyGlobalRadiation</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">dailyglobalradiation</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_dailyglobalradiation_v1</span><span class="p">(</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">dailysunshineduration</span><span class="p">,</span> <span class="n">flu</span><span class="o">.</span><span class="n">dailypossiblesunshineduration</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Calc_AdjustedGlobalRadiation_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_AdjustedGlobalRadiation_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_AdjustedGlobalRadiation_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Adjust the current global radiation to the daily global radiation.</span>

<span class="sd">    Additional requirements:</span>
<span class="sd">      |Model.idx_sim|</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`AdjustedGlobalRadiation = GlobalRadiation \\cdot</span>
<span class="sd">      \\frac{DailyGlobalRadiation}{\\sum LoggedGlobalRadiation}`</span>

<span class="sd">    Examples:</span>

<span class="sd">        The purpose of method |Calc_AdjustedGlobalRadiation_V1| is to</span>
<span class="sd">        adjust hourly global radiation values (or those of other short</span>
<span class="sd">        simulation time steps) so that their sum over the last 24 hours</span>
<span class="sd">        equals the global radiation value directly calculated with the</span>
<span class="sd">        relative sunshine duration over the last 24 hours.  We try to</span>
<span class="sd">        explain this somewhat contraintuitive approach by building up</span>
<span class="sd">        the examples on the examples on the documentation on method</span>
<span class="sd">        |Calc_DailyGlobalRadiation_V1|.</span>

<span class="sd">        Again, we start with a daily simulation time step:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; derived.nmblogentries.update()</span>

<span class="sd">        For such a daily simulation time step, the values of the</span>
<span class="sd">        sequences |GlobalRadiation|, |DailyGlobalRadiation|, and</span>
<span class="sd">        |LoggedGlobalRadiation| must be identical:</span>

<span class="sd">        &gt;&gt;&gt; model.idx_sim = 1</span>
<span class="sd">        &gt;&gt;&gt; fluxes.globalradiation = 4.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailyglobalradiation = 4.0</span>
<span class="sd">        &gt;&gt;&gt; logs.loggedglobalradiation = 4.0</span>

<span class="sd">        After calling method |Calc_AdjustedGlobalRadiation_V1|, the</span>
<span class="sd">        same holds for the adjusted global radiation sum:</span>

<span class="sd">        &gt;&gt;&gt; model.calc_adjustedglobalradiation_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.adjustedglobalradiation</span>
<span class="sd">        adjustedglobalradiation(4.0)</span>

<span class="sd">        Normally, one would not expect method |Calc_AdjustedGlobalRadiation_V1|</span>
<span class="sd">        to have an effect when applied on daily simulation time steps at all.</span>
<span class="sd">        However, it corrects &quot;wrong&quot; predefined global radiation values:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.dailyglobalradiation = 5.6</span>
<span class="sd">        &gt;&gt;&gt; model.calc_adjustedglobalradiation_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.adjustedglobalradiation</span>
<span class="sd">        adjustedglobalradiation(5.6)</span>

<span class="sd">        We now demonstrate how method |Calc_AdjustedGlobalRadiation_V1|</span>
<span class="sd">        actually works for hourly simulation time steps:</span>

<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; derived.nmblogentries.update()</span>

<span class="sd">        The daily global radiation value does not depend on the simulation</span>
<span class="sd">        time step.  We reset it to 4 MJ/m²/d:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.dailyglobalradiation = 4.0</span>

<span class="sd">        The other global radiation values now must be smaller and vary</span>
<span class="sd">        throughout the day.  We set them consistently with the values</span>
<span class="sd">        of the logged sunshine duration in the documentation on method</span>
<span class="sd">        |Calc_DailyGlobalRadiation_V1|:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.globalradiation = 0.8</span>
<span class="sd">        &gt;&gt;&gt; logs.loggedglobalradiation = (</span>
<span class="sd">        ...     0.8, 0.8, 0.2, 0.1, 0.1, 0.0,</span>
<span class="sd">        ...     0.0, 0.0, 0.0, 0.0, 0.0, 0.0,</span>
<span class="sd">        ...     0.0, 0.0, 0.0, 0.0, 0.0, 0.0,</span>
<span class="sd">        ...     0.0, 0.1, 0.4, 0.6, 0.7, 0.8)</span>

<span class="sd">        Compared with the total 24 hours, the simulation time steps around</span>
<span class="sd">        noon are relatively sunny, both for the current and the last day</span>
<span class="sd">        (see the first and the last entries of the log sequence for sunshine</span>
<span class="sd">        duration).  Accordingly, the sum of the hourly global radiation</span>
<span class="sd">        values (4.6 W/m²)  is larger than the directly calculated daily sum</span>
<span class="sd">        (4.0 W/m²).  Method |Calc_AdjustedGlobalRadiation_V1| uses the</span>
<span class="sd">        fraction of both sums to finally calculate the adjusted global</span>
<span class="sd">        radiation (:math:`0.8 \\cdot 4.0 / 4.6`):</span>

<span class="sd">        &gt;&gt;&gt; model.calc_adjustedglobalradiation_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.adjustedglobalradiation</span>
<span class="sd">        adjustedglobalradiation(0.695652)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">NmbLogEntries</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">GlobalRadiation</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">DailyGlobalRadiation</span><span class="p">,</span>
        <span class="n">lland_logs</span><span class="o">.</span><span class="n">LoggedGlobalRadiation</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">AdjustedGlobalRadiation</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">logs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">d_glob_sum</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">nmblogentries</span><span class="p">):</span>
            <span class="n">d_glob_sum</span> <span class="o">+=</span> <span class="n">log</span><span class="o">.</span><span class="n">loggedglobalradiation</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">adjustedglobalradiation</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">globalradiation</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">dailyglobalradiation</span> <span class="o">/</span> <span class="n">d_glob_sum</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Calc_ET0_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_ET0_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_ET0_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate reference evapotranspiration after Turc-Wendling.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`ET0 = KE \\cdot</span>
<span class="sd">      \\frac{(8.64 \\cdot Glob+93 \\cdot KF) \\cdot (TKor+22)}</span>
<span class="sd">      {165 \\cdot (TKor+123) \\cdot (1 + 0.00019 \\cdot min(HNN, 600))}`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(3)</span>
<span class="sd">        &gt;&gt;&gt; ke(1.1)</span>
<span class="sd">        &gt;&gt;&gt; kf(0.6)</span>
<span class="sd">        &gt;&gt;&gt; hnn(200.0, 600.0, 1000.0)</span>
<span class="sd">        &gt;&gt;&gt; inputs.glob = 200.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkor = 15.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_et0_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.et0</span>
<span class="sd">        et0(3.07171, 2.86215, 2.86215)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">KE</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">KF</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">HNN</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_inputs</span><span class="o">.</span><span class="n">Glob</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TKor</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ET0</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">et0</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">ke</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span>
                <span class="p">(</span><span class="mf">8.64</span> <span class="o">*</span> <span class="n">inp</span><span class="o">.</span><span class="n">glob</span> <span class="o">+</span> <span class="mf">93.0</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">kf</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="o">*</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">tkor</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="mf">22.0</span><span class="p">)</span>
                <span class="o">/</span> <span class="p">(</span>
                    <span class="mf">165.0</span>
                    <span class="o">*</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">tkor</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="mf">123.0</span><span class="p">)</span>
                    <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="mf">0.00019</span> <span class="o">*</span> <span class="nb">min</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">hnn</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="mf">600.0</span><span class="p">))</span>
                <span class="p">)</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="Calc_ET0_WET0_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_ET0_WET0_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_ET0_WET0_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Correct the given reference evapotranspiration and update the</span>
<span class="sd">    corresponding log sequence.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`ET0_{new} = WfET0 \\cdot KE \\cdot PET +</span>
<span class="sd">      (1-WfET0) \\cdot ET0_{old}`</span>

<span class="sd">    Example:</span>

<span class="sd">        Prepare four hydrological response units with different value</span>
<span class="sd">        combinations of parameters |KE| and |WfET0|:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(4)</span>
<span class="sd">        &gt;&gt;&gt; ke(0.8, 1.2, 0.8, 1.2)</span>
<span class="sd">        &gt;&gt;&gt; wfet0(2.0, 2.0, 0.2, 0.2)</span>

<span class="sd">        Note that the actual value of time dependend parameter |WfET0|</span>
<span class="sd">        is reduced due the difference between the given parameter and</span>
<span class="sd">        simulation time steps:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(wfet0.values)</span>
<span class="sd">        1.0, 1.0, 0.1, 0.1</span>

<span class="sd">        For the first two hydrological response units, the given |PET|</span>
<span class="sd">        value is modified by -0.4 mm and +0.4 mm, respectively.  For the</span>
<span class="sd">        other two response units, which weight the &quot;new&quot; evapotranspiration</span>
<span class="sd">        value with 10 %, |ET0| does deviate from the old value of |WET0|</span>
<span class="sd">        by -0.04 mm and +0.04 mm only:</span>

<span class="sd">        &gt;&gt;&gt; inputs.pet = 2.0</span>
<span class="sd">        &gt;&gt;&gt; logs.wet0 = 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_et0_wet0_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.et0</span>
<span class="sd">        et0(1.6, 2.4, 1.96, 2.04)</span>
<span class="sd">        &gt;&gt;&gt; logs.wet0</span>
<span class="sd">        wet0([[1.6, 2.4, 1.96, 2.04]])</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">WfET0</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">KE</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_inputs</span><span class="o">.</span><span class="n">PET</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_logs</span><span class="o">.</span><span class="n">WET0</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ET0</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">logs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">et0</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">con</span><span class="o">.</span><span class="n">wfet0</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">ke</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">inp</span><span class="o">.</span><span class="n">pet</span>
                <span class="o">+</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">wfet0</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">*</span> <span class="n">log</span><span class="o">.</span><span class="n">wet0</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">wet0</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">et0</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>


<div class="viewcode-block" id="Calc_EvPo_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_EvPo_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_EvPo_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the potential evapotranspiration for the relevant land</span>
<span class="sd">    use and month.</span>

<span class="sd">    Additional requirements:</span>
<span class="sd">      |Model.idx_sim|</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`EvPo = FLn \\cdot ET0`</span>

<span class="sd">    Example:</span>

<span class="sd">        For clarity, this is more of a kind of an integration example.</span>
<span class="sd">        Parameter |FLn| both depends on time (the actual month) and space</span>
<span class="sd">        (the actual land use).  Firstly, let us define a initialization</span>
<span class="sd">        time period spanning the transition from June to July:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;30.06.2000&quot;, &quot;02.07.2000&quot;, &quot;1d&quot;</span>

<span class="sd">        Secondly, assume that the considered subbasin is differenciated in</span>
<span class="sd">        two HRUs, one of primarily consisting of arable land and the other</span>
<span class="sd">        one of deciduous forests:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(2)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER, LAUBW)</span>

<span class="sd">        Thirdly, set the |FLn|</span>
<span class="sd">        values, one for the relevant months and land use classes:</span>

<span class="sd">        &gt;&gt;&gt; fln.acker_jun = 1.299</span>
<span class="sd">        &gt;&gt;&gt; fln.acker_jul = 1.304</span>
<span class="sd">        &gt;&gt;&gt; fln.laubw_jun = 1.350</span>
<span class="sd">        &gt;&gt;&gt; fln.laubw_jul = 1.365</span>

<span class="sd">        Fourthly, the index array connecting the simulation time steps</span>
<span class="sd">        defined above and the month indexes (0...11) can be retrieved</span>
<span class="sd">        from the |pub| module.  This can be done manually more</span>
<span class="sd">        conveniently via its update method:</span>

<span class="sd">        &gt;&gt;&gt; derived.moy.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.moy</span>
<span class="sd">        moy(5, 6)</span>

<span class="sd">        Finally, the actual method (with its simple equation) is applied</span>
<span class="sd">        as usual:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.et0 = 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.idx_sim = 0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_evpo_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evpo</span>
<span class="sd">        evpo(2.598, 2.7)</span>
<span class="sd">        &gt;&gt;&gt; model.idx_sim = 1</span>
<span class="sd">        &gt;&gt;&gt; model.calc_evpo_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evpo</span>
<span class="sd">        evpo(2.608, 2.73)</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">FLn</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">MOY</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ET0</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">EvPo</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">evpo</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">fln</span><span class="p">[</span><span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">der</span><span class="o">.</span><span class="n">moy</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">idx_sim</span><span class="p">]]</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">et0</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>


<div class="viewcode-block" id="Calc_NBes_Inzp_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_NBes_Inzp_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_NBes_Inzp_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate stand precipitation and update the interception storage</span>
<span class="sd">    accordingly.</span>

<span class="sd">    Additional requirements:</span>
<span class="sd">      |Model.idx_sim|</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      .. math::</span>
<span class="sd">        NBes = \\begin{cases}</span>
<span class="sd">        PKor</span>
<span class="sd">        &amp;|\\</span>
<span class="sd">        Inzp = KInz</span>
<span class="sd">        \\\\</span>
<span class="sd">        0</span>
<span class="sd">        &amp;|\\</span>
<span class="sd">        Inzp &lt; KInz</span>
<span class="sd">        \\end{cases}</span>

<span class="sd">    Examples:</span>

<span class="sd">        Initialise five HRUs with different land usages:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(5)</span>
<span class="sd">        &gt;&gt;&gt; lnk(SIED_D, FEUCHT, GLETS, FLUSS, SEE)</span>

<span class="sd">        Define |KInz| values for July the selected land usages directly:</span>

<span class="sd">        &gt;&gt;&gt; derived.kinz.sied_d_jul = 2.0</span>
<span class="sd">        &gt;&gt;&gt; derived.kinz.feucht_jul = 1.0</span>
<span class="sd">        &gt;&gt;&gt; derived.kinz.glets_jul = 0.0</span>
<span class="sd">        &gt;&gt;&gt; derived.kinz.fluss_jul = 1.0</span>
<span class="sd">        &gt;&gt;&gt; derived.kinz.see_jul = 1.0</span>

<span class="sd">        Now we prepare a |MOY| object, that assumes that the first, second,</span>
<span class="sd">        and third simulation time steps are in June, July, and August</span>
<span class="sd">        respectively (we make use of the value defined above for July, but</span>
<span class="sd">        setting the values of parameter |MOY| this way allows for a more</span>
<span class="sd">        rigorous testing of proper indexing):</span>

<span class="sd">        &gt;&gt;&gt; derived.moy.shape = 3</span>
<span class="sd">        &gt;&gt;&gt; derived.moy = 5, 6, 7</span>
<span class="sd">        &gt;&gt;&gt; model.idx_sim = 1</span>

<span class="sd">        The dense settlement (|SIED_D|), the wetland area (|FEUCHT|), and</span>
<span class="sd">        both water areas (|FLUSS| and |SEE|) start with a initial interception</span>
<span class="sd">        storage of 1/2 mm, the glacier (|GLETS|) and water areas (|FLUSS| and</span>
<span class="sd">        |SEE|) start with 0 mm.  In the first example, actual precipition</span>
<span class="sd">        is 1 mm:</span>

<span class="sd">        &gt;&gt;&gt; states.inzp = 0.5, 0.5, 0.0, 1.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.nkor = 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_nbes_inzp_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.inzp</span>
<span class="sd">        inzp(1.5, 1.0, 0.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.nbes</span>
<span class="sd">        nbes(0.0, 0.5, 1.0, 0.0, 0.0)</span>

<span class="sd">        Only for the settled area, interception capacity is not exceeded,</span>
<span class="sd">        meaning no stand precipitation occurs.  Note that it is common in</span>
<span class="sd">        define zero interception capacities for glacier areas, but not</span>
<span class="sd">        mandatory.  Also note that the |KInz|, |Inzp| and |NKor| values</span>
<span class="sd">        given for both water areas are ignored completely, and |Inzp|</span>
<span class="sd">        and |NBes| are simply set to zero.</span>

<span class="sd">        If there is no precipitation, there is of course also no stand</span>
<span class="sd">        precipitation and interception storage remains unchanged:</span>

<span class="sd">        &gt;&gt;&gt; states.inzp = 0.5, 0.5, 0.0, 0.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.nkor = 0.</span>
<span class="sd">        &gt;&gt;&gt; model.calc_nbes_inzp_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.inzp</span>
<span class="sd">        inzp(0.5, 0.5, 0.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.nbes</span>
<span class="sd">        nbes(0.0, 0.0, 0.0, 0.0, 0.0)</span>

<span class="sd">        Interception capacities change discontinuously between consecutive</span>
<span class="sd">        months.  This can result in little stand precipitation events in</span>
<span class="sd">        periods without precipitation:</span>

<span class="sd">        &gt;&gt;&gt; states.inzp = 1.0, 0.0, 0.0, 0.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; derived.kinz.sied_d_jul = 0.6</span>
<span class="sd">        &gt;&gt;&gt; fluxes.nkor = 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_nbes_inzp_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.inzp</span>
<span class="sd">        inzp(0.6, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.nbes</span>
<span class="sd">        nbes(0.4, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">MOY</span><span class="p">,</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">KInz</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NKor</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">Inzp</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NBes</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">WASSER</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">nbes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">inzp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">nbes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">nkor</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                    <span class="o">+</span> <span class="n">sta</span><span class="o">.</span><span class="n">inzp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                    <span class="o">-</span> <span class="n">der</span><span class="o">.</span><span class="n">kinz</span><span class="p">[</span><span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">der</span><span class="o">.</span><span class="n">moy</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">idx_sim</span><span class="p">]],</span>
                    <span class="mf">0.0</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">inzp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">nkor</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">nbes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>


<div class="viewcode-block" id="Calc_SNRatio_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_SNRatio_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_SNRatio_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the ratio of frozen to total precipitation :cite:`ref-LARSIM`.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`SNRatio =</span>
<span class="sd">      min\\left(max\\left(\\frac{(TGr-TSp/2-TKor)}{TSp}, 0\\right), 1\\right)`</span>

<span class="sd">    Examples:</span>

<span class="sd">        In the first example, the threshold temperature of seven</span>
<span class="sd">        hydrological response units is 0 °C and the temperature interval</span>
<span class="sd">        of mixed precipitation 2 °C:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(7)</span>
<span class="sd">        &gt;&gt;&gt; tgr(1.0)</span>
<span class="sd">        &gt;&gt;&gt; tsp(2.0)</span>

<span class="sd">        The value of |SNRatio| is zero above 0 °C and 1 below 2 °C.  Between</span>
<span class="sd">        these temperature values |SNRatio| decreases linearly:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.nkor = 4.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkor = -1.0, 0.0, 0.5, 1.0, 1.5, 2.0, 3.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_snratio_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.snratio</span>
<span class="sd">        snratio(1.0, 1.0, 0.75, 0.5, 0.25, 0.0, 0.0)</span>

<span class="sd">        Note the special case of a zero temperature interval.  With the</span>
<span class="sd">        actual temperature being equal to the threshold temperature, the</span>
<span class="sd">        the value of |SNRatio| is zero:</span>

<span class="sd">        &gt;&gt;&gt; tsp(0.0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_snratio_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.snratio</span>
<span class="sd">        snratio(1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">TGr</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">TSp</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TKor</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_aides</span><span class="o">.</span><span class="n">SNRatio</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">flu</span><span class="o">.</span><span class="n">tkor</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">tgr</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">con</span><span class="o">.</span><span class="n">tsp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">):</span>
                <span class="n">aid</span><span class="o">.</span><span class="n">snratio</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">elif</span> <span class="n">flu</span><span class="o">.</span><span class="n">tkor</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">tgr</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">tsp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">):</span>
                <span class="n">aid</span><span class="o">.</span><span class="n">snratio</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">aid</span><span class="o">.</span><span class="n">snratio</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">tgr</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">con</span><span class="o">.</span><span class="n">tsp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">tkor</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="p">)</span> <span class="o">/</span> <span class="n">con</span><span class="o">.</span><span class="n">tsp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>


<div class="viewcode-block" id="Calc_SBes_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_SBes_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_SBes_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the frozen part of stand precipitation.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`SBes = SNRatio \\cdot NBes`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(2)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.nbes = 10.0</span>
<span class="sd">        &gt;&gt;&gt; aides.snratio = 0.2, 0.8</span>
<span class="sd">        &gt;&gt;&gt; model.calc_sbes_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.sbes</span>
<span class="sd">        sbes(2.0, 8.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_aides</span><span class="o">.</span><span class="n">SNRatio</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NBes</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SBes</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">sbes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">aid</span><span class="o">.</span><span class="n">snratio</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">nbes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>


<div class="viewcode-block" id="Calc_SnowIntMax_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_SnowIntMax_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_SnowIntMax_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the current capacity of the snow interception storage.</span>

<span class="sd">    Basic equation (see :cite:`ref-LARSIM`, equations 3.69 to 3.71):</span>
<span class="sd">      .. math::</span>
<span class="sd">        SnowIntMax = \bigg( P1SIMax +  P2SIMax \cdot LAI \bigg) \cdot \begin{cases}</span>
<span class="sd">        1 &amp;|\ TKor  \leq -3</span>
<span class="sd">        \\</span>
<span class="sd">        (5 + TKor ) / 2 &amp;|\ -3 &lt; TKor &lt; -1</span>
<span class="sd">        \\</span>
<span class="sd">        2 &amp;|\ -1 \leq TKor</span>
<span class="sd">        \end{cases}</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-04-29&quot;, &quot;2000-05-03&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(8)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER, LAUBW, LAUBW, LAUBW, LAUBW, LAUBW, MISCHW, NADELW)</span>
<span class="sd">        &gt;&gt;&gt; lai.laubw_apr = 4.0</span>
<span class="sd">        &gt;&gt;&gt; lai.laubw_mai = 7.0</span>
<span class="sd">        &gt;&gt;&gt; lai.mischw_apr = 6.0</span>
<span class="sd">        &gt;&gt;&gt; lai.mischw_mai = 8.0</span>
<span class="sd">        &gt;&gt;&gt; lai.nadelw = 11.0</span>
<span class="sd">        &gt;&gt;&gt; p1simax(8.0)</span>
<span class="sd">        &gt;&gt;&gt; p2simax(1.5)</span>
<span class="sd">        &gt;&gt;&gt; derived.moy.update()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkor = 0.0, 0.0, -1.0, -2.0, -3.0, -4.0, -4.0, -4.0</span>

<span class="sd">        &gt;&gt;&gt; model.idx_sim = pub.timegrids.init[&quot;2000-04-30&quot;]</span>
<span class="sd">        &gt;&gt;&gt; model.calc_snowintmax_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.snowintmax</span>
<span class="sd">        snowintmax(0.0, 28.0, 28.0, 21.0, 14.0, 14.0, 17.0, 24.5)</span>

<span class="sd">        &gt;&gt;&gt; model.idx_sim = pub.timegrids.init[&quot;2000-05-01&quot;]</span>
<span class="sd">        &gt;&gt;&gt; model.calc_snowintmax_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.snowintmax</span>
<span class="sd">        snowintmax(0.0, 37.0, 37.0, 27.75, 18.5, 18.5, 20.0, 24.5)</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">LAI</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">P1SIMax</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">P2SIMax</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">MOY</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TKor</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SnowIntMax</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">moy</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">idx_sim</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">LAUBW</span><span class="p">,</span> <span class="n">MISCHW</span><span class="p">,</span> <span class="n">NADELW</span><span class="p">):</span>
                <span class="n">d_lai</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">lai</span><span class="p">[</span><span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">idx</span><span class="p">]</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">snowintmax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">p1simax</span> <span class="o">+</span> <span class="n">con</span><span class="o">.</span><span class="n">p2simax</span> <span class="o">*</span> <span class="n">d_lai</span>
                <span class="k">if</span> <span class="n">flu</span><span class="o">.</span><span class="n">tkor</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">:</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">snowintmax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*=</span> <span class="mi">2</span>
                <span class="k">elif</span> <span class="n">flu</span><span class="o">.</span><span class="n">tkor</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mf">3.0</span><span class="p">:</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">snowintmax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*=</span> <span class="mf">2.5</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">tkor</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">snowintmax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>


<div class="viewcode-block" id="Calc_SnowIntRate_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_SnowIntRate_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_SnowIntRate_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the ratio between the snow interception rate and precipitation</span>
<span class="sd">    intensity.</span>

<span class="sd">    Basic equation (see :cite:`ref-LARSIM`, equations 3.72 to 3.74):</span>
<span class="sd">       :math:`SnowIntRate = min\big(  P1SIRate +  P2SIRate \cdot LAI</span>
<span class="sd">       + P3SIRate \cdot SInz, 1 \big))`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-04-29&quot;, &quot;2000-05-03&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(7)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER, LAUBW, LAUBW, LAUBW, LAUBW, MISCHW, NADELW)</span>
<span class="sd">        &gt;&gt;&gt; lai.laubw_apr = 4.0</span>
<span class="sd">        &gt;&gt;&gt; lai.laubw_mai = 7.0</span>
<span class="sd">        &gt;&gt;&gt; lai.mischw_apr = 6.0</span>
<span class="sd">        &gt;&gt;&gt; lai.mischw_mai = 8.0</span>
<span class="sd">        &gt;&gt;&gt; lai.nadelw = 11.0</span>
<span class="sd">        &gt;&gt;&gt; p1sirate(0.2)</span>
<span class="sd">        &gt;&gt;&gt; p2sirate(0.02)</span>
<span class="sd">        &gt;&gt;&gt; p3sirate(0.003)</span>
<span class="sd">        &gt;&gt;&gt; derived.moy.update()</span>
<span class="sd">        &gt;&gt;&gt; states.sinz = 500.0, 500.0, 50.0, 5.0, 0.0, 0.0, 0.0</span>

<span class="sd">        &gt;&gt;&gt; model.idx_sim = pub.timegrids.init[&quot;2000-04-30&quot;]</span>
<span class="sd">        &gt;&gt;&gt; model.calc_snowintrate_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.snowintrate</span>
<span class="sd">        snowintrate(0.0, 1.0, 0.43, 0.295, 0.28, 0.32, 0.42)</span>

<span class="sd">        &gt;&gt;&gt; model.idx_sim = pub.timegrids.init[&quot;2000-05-01&quot;]</span>
<span class="sd">        &gt;&gt;&gt; model.calc_snowintrate_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.snowintrate</span>
<span class="sd">        snowintrate(0.0, 1.0, 0.49, 0.355, 0.34, 0.36, 0.42)</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">LAI</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">P1SIRate</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">P2SIRate</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">P3SIRate</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">MOY</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">SInz</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SnowIntRate</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">moy</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">idx_sim</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">LAUBW</span><span class="p">,</span> <span class="n">MISCHW</span><span class="p">,</span> <span class="n">NADELW</span><span class="p">):</span>
                <span class="n">d_lai</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">lai</span><span class="p">[</span><span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">idx</span><span class="p">]</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">snowintrate</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
                    <span class="n">con</span><span class="o">.</span><span class="n">p1sirate</span> <span class="o">+</span> <span class="n">con</span><span class="o">.</span><span class="n">p2sirate</span> <span class="o">*</span> <span class="n">d_lai</span> <span class="o">+</span> <span class="n">con</span><span class="o">.</span><span class="n">p3sirate</span> <span class="o">*</span> <span class="n">sta</span><span class="o">.</span><span class="n">sinz</span><span class="p">[</span><span class="n">k</span><span class="p">],</span>
                    <span class="mf">1.0</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">snowintrate</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>


<div class="viewcode-block" id="Calc_NBesInz_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_NBesInz_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_NBesInz_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the total amount of stand precipitation reaching the snow</span>
<span class="sd">    interception storage.</span>

<span class="sd">    Basic equation  (does this comply with `LARSIM`_?):</span>
<span class="sd">      :math:`NBesInz =</span>
<span class="sd">      min \big( SnowIntRate \cdot NBes, max (SnowIntMax - SInz, 0) \big)`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(6)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER, LAUBW, MISCHW, NADELW, NADELW, NADELW)</span>
<span class="sd">        &gt;&gt;&gt; states.sinz = 0.0, 0.0, 5.0, 10.0, 15.0, 20.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.nbes = 20.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.snowintmax = 15.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.snowintrate = 0.5</span>
<span class="sd">        &gt;&gt;&gt; model.calc_nbesinz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.nbesinz</span>
<span class="sd">        nbesinz(0.0, 10.0, 10.0, 5.0, 0.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NBes</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SnowIntMax</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SnowIntRate</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">SInz</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NBesInz</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">LAUBW</span><span class="p">,</span> <span class="n">MISCHW</span><span class="p">,</span> <span class="n">NADELW</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">nbesinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">snowintrate</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">nbes</span><span class="p">[</span><span class="n">k</span><span class="p">],</span>
                    <span class="nb">max</span><span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">snowintmax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">sta</span><span class="o">.</span><span class="n">sinz</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">nbesinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>


<div class="viewcode-block" id="Calc_SBesInz_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_SBesInz_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_SBesInz_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the frozen amount of stand precipitation reaching the snow</span>
<span class="sd">    interception storage.</span>

<span class="sd">    Basic equations (does this comply with `LARSIM`_?):</span>
<span class="sd">      :math:`SBesInz = SNRatio \cdot NBesInz`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(4)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER, LAUBW, MISCHW, NADELW)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.nbesinz = 10.0, 10.0, 5.0, 2.5</span>
<span class="sd">        &gt;&gt;&gt; aides.snratio = 0.8</span>
<span class="sd">        &gt;&gt;&gt; model.calc_sbesinz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.sbesinz</span>
<span class="sd">        sbesinz(0.0, 8.0, 4.0, 2.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NBesInz</span><span class="p">,</span>
        <span class="n">lland_aides</span><span class="o">.</span><span class="n">SNRatio</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SBesInz</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">LAUBW</span><span class="p">,</span> <span class="n">MISCHW</span><span class="p">,</span> <span class="n">NADELW</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">sbesinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">aid</span><span class="o">.</span><span class="n">snratio</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">nbesinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">sbesinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>


<div class="viewcode-block" id="Calc_STInz_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_STInz_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_STInz_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Add the relevant fraction of the frozen amount of stand precipitation</span>
<span class="sd">    to the frozen water equivalent of the interception snow storage.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`\frac{STInz}{dt} = SBesInz`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(4)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER, LAUBW, MISCHW, NADELW)</span>
<span class="sd">        &gt;&gt;&gt; states.stinz = 0.0, 1.0, 2.0, 3.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.sbesinz = 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_stinz_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.stinz</span>
<span class="sd">        stinz(0.0, 2.0, 3.0, 4.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SBesInz</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">STInz</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">LAUBW</span><span class="p">,</span> <span class="n">MISCHW</span><span class="p">,</span> <span class="n">NADELW</span><span class="p">):</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">stinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">sbesinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">stinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>


<div class="viewcode-block" id="Calc_WaDaInz_SInz_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_WaDaInz_SInz_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_WaDaInz_SInz_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Add as much liquid precipitation to the snow interception storage as it is</span>
<span class="sd">    able to hold.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      :math:`\frac{dSInz}{dt} = NBesInz - WaDaInz`</span>

<span class="sd">      :math:`SInz \leq PWMax \cdot STInz`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(5)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER, LAUBW, MISCHW, NADELW, NADELW)</span>
<span class="sd">        &gt;&gt;&gt; pwmax(2.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.nbesinz = 1.0</span>
<span class="sd">        &gt;&gt;&gt; states.stinz = 0.0, 0.0, 1.0, 1.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; states.sinz = 1.0, 0.0, 1.0, 1.5, 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_wadainz_sinz_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.sinz</span>
<span class="sd">        sinz(0.0, 0.0, 2.0, 2.0, 2.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wadainz</span>
<span class="sd">        wadainz(0.0, 1.0, 0.0, 0.5, 1.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">PWMax</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NBesInz</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">STInz</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">SInz</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WaDaInz</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">LAUBW</span><span class="p">,</span> <span class="n">MISCHW</span><span class="p">,</span> <span class="n">NADELW</span><span class="p">):</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">sinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">nbesinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">wadainz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">sinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">pwmax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">sta</span><span class="o">.</span><span class="n">stinz</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">)</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">sinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-=</span> <span class="n">flu</span><span class="o">.</span><span class="n">wadainz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">wadainz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">sinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>


<div class="viewcode-block" id="Calc_WNiedInz_ESnowInz_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_WNiedInz_ESnowInz_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_WNiedInz_ESnowInz_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the heat flux into the snow interception storage due to the amount</span>
<span class="sd">    of precipitation actually hold by the snow layer.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`\frac{dESnowInz}{dt} = W\!NiedInz`</span>

<span class="sd">      :math:`W\!NiedInz = (TKor-TRefN) \cdot</span>
<span class="sd">      (CPEis \cdot SBesInz + CPWasser \cdot (NBesInz - SBesInz - WaDaInz))`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(6)</span>
<span class="sd">        &gt;&gt;&gt; lnk(LAUBW, MISCHW, NADELW, NADELW, NADELW, ACKER)</span>
<span class="sd">        &gt;&gt;&gt; trefn(1.0)</span>
<span class="sd">        &gt;&gt;&gt; states.esnowinz = 0.02</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkor = 4.0, 0.0, 0.0, 0.0, 0.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.nbesinz = 10.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.sbesinz = 0.0, 0.0, 5.0, 10.0, 5.0, 5.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wadainz = 0.0, 0.0, 0.0, 0.0, 5.0, 5.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_wniedinz_esnowinz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wniedinz</span>
<span class="sd">        wniedinz(0.125604, -0.041868, -0.031384, -0.0209, -0.01045, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.esnowinz</span>
<span class="sd">        esnowinz(0.145604, -0.021868, -0.011384, -0.0009, 0.00955, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">TRefN</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">CPWasser</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">CPEis</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TKor</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NBesInz</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SBesInz</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WaDaInz</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">ESnowInz</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WNiedInz</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">LAUBW</span><span class="p">,</span> <span class="n">MISCHW</span><span class="p">,</span> <span class="n">NADELW</span><span class="p">):</span>
                <span class="n">d_ice</span> <span class="o">=</span> <span class="n">fix</span><span class="o">.</span><span class="n">cpeis</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">sbesinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">d_water</span> <span class="o">=</span> <span class="n">fix</span><span class="o">.</span><span class="n">cpwasser</span> <span class="o">*</span> <span class="p">(</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">nbesinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">sbesinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">wadainz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">wniedinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">tkor</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">trefn</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">d_ice</span> <span class="o">+</span> <span class="n">d_water</span><span class="p">)</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">esnowinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">wniedinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">wniedinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">esnowinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>


<div class="viewcode-block" id="Return_TempSInz_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Return_TempSInz_V1">[docs]</a><span class="k">class</span> <span class="nc">Return_TempSInz_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate and return the average temperature of the intercepted snow.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`max \left( \frac{ESnowInz}{STInz \cdot CPEis + (SInz - STInz)</span>
<span class="sd">      \cdot CPWasser}, -273 \right)`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(5)</span>
<span class="sd">        &gt;&gt;&gt; states.stinz = 0.0, 0.5, 5.0, 0.5, 0.5</span>
<span class="sd">        &gt;&gt;&gt; states.sinz = 0.0, 1.0, 10.0, 1.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; states.esnowinz = 0.0, 0.0, -0.1, -0.8, -1.0</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_tempsinz_v1(0))</span>
<span class="sd">        nan</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_tempsinz_v1(1))</span>
<span class="sd">        0.0</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_tempsinz_v1(2))</span>
<span class="sd">        -3.186337</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_tempsinz_v1(3))</span>
<span class="sd">        -254.906959</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_tempsinz_v1(4))</span>
<span class="sd">        -273.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">CPWasser</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">CPEis</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">STInz</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">SInz</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">ESnowInz</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span>
        <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">sinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">d_ice</span> <span class="o">=</span> <span class="n">fix</span><span class="o">.</span><span class="n">cpeis</span> <span class="o">*</span> <span class="n">sta</span><span class="o">.</span><span class="n">stinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">d_water</span> <span class="o">=</span> <span class="n">fix</span><span class="o">.</span><span class="n">cpwasser</span> <span class="o">*</span> <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">sinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">sta</span><span class="o">.</span><span class="n">stinz</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">esnowinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">d_ice</span> <span class="o">+</span> <span class="n">d_water</span><span class="p">),</span> <span class="o">-</span><span class="mf">273.0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">nan</span></div>


<div class="viewcode-block" id="Calc_TempSInz_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_TempSInz_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_TempSInz_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the average temperature of the intercepted snow.</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(6)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER, LAUBW, MISCHW, NADELW, NADELW, NADELW)</span>
<span class="sd">        &gt;&gt;&gt; pwmax(2.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkor = -1.0</span>
<span class="sd">        &gt;&gt;&gt; states.stinz = 0.0, 0.5, 5.0, 5.0, 5.0, 5.0</span>
<span class="sd">        &gt;&gt;&gt; states.sinz = 0.0, 1.0, 10.0, 10.0, 10.0, 10.0</span>
<span class="sd">        &gt;&gt;&gt; states.esnowinz = 0.0, 0.0, -0.1, -0.1, -0.1, -0.1</span>
<span class="sd">        &gt;&gt;&gt; model.calc_tempsinz_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.tempsinz</span>
<span class="sd">        tempsinz(nan, 0.0, -3.186337, -3.186337, -3.186337, -3.186337)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Return_TempSInz_V1</span><span class="p">,)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">CPWasser</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">CPEis</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">STInz</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">SInz</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">ESnowInz</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_aides</span><span class="o">.</span><span class="n">TempSInz</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">tempsinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_tempsinz_v1</span><span class="p">(</span><span class="n">k</span><span class="p">)</span></div>


<div class="viewcode-block" id="Update_ASInz_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Update_ASInz_V1">[docs]</a><span class="k">class</span> <span class="nc">Update_ASInz_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the dimensionless age of the intercepted snow.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      :math:`TauSInz_{new} = TauSInz_{old} \cdot max(1 - 0.1 \cdot SBesInz), 0) +</span>
<span class="sd">      \frac{r_1+r_2+r_3}{10^6} \cdot Seconds`</span>

<span class="sd">      :math:`r_1 = exp \left( 5000 \cdot</span>
<span class="sd">      \left( \frac{1}{273.15} - \frac{1}{273.15 + TempSInz} \right) \right)`</span>

<span class="sd">      :math:`r_2 = min \left(r_1^{10}, 1 \right)`</span>

<span class="sd">      :math:`r_3 = 0.03`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(10)</span>
<span class="sd">        &gt;&gt;&gt; derived.seconds(24*60*60)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.sbesinz = 0.0, 1.0, 5.0, 9.0, 10.0, 11.0, 11.0, 11.0, 11.0, 11.0</span>
<span class="sd">        &gt;&gt;&gt; states.sinz = 0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; states.asinz = 1.0, nan, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; aides.tempsinz = 0.0, 0.0, -10.0, -10.0, -10.0, -10.0, -1.0, 0.0, 1.0, 10.0</span>
<span class="sd">        &gt;&gt;&gt; model.update_asinz_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.asinz</span>
<span class="sd">        asinz(nan, 0.175392, 0.545768, 0.145768, 0.045768, 0.045768, 0.127468,</span>
<span class="sd">              0.175392, 0.181358, 0.253912)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">Seconds</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SBesInz</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">SInz</span><span class="p">,</span>
        <span class="n">lland_aides</span><span class="o">.</span><span class="n">TempSInz</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">ASInz</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">sinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">asinz</span><span class="p">[</span><span class="n">k</span><span class="p">]):</span>
                    <span class="n">sta</span><span class="o">.</span><span class="n">asinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">d_r1</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span>
                    <span class="mf">5000.0</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mf">273.15</span> <span class="o">-</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">273.15</span> <span class="o">+</span> <span class="n">aid</span><span class="o">.</span><span class="n">tempsinz</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>
                <span class="p">)</span>
                <span class="n">d_r2</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">d_r1</span> <span class="o">**</span> <span class="mi">10</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">asinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">sbesinz</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">)</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">asinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">d_r1</span> <span class="o">+</span> <span class="n">d_r2</span> <span class="o">+</span> <span class="mf">0.03</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1e6</span> <span class="o">*</span> <span class="n">der</span><span class="o">.</span><span class="n">seconds</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">asinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">nan</span></div>


<div class="viewcode-block" id="Calc_ActualAlbedoInz_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_ActualAlbedoInz_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_ActualAlbedoInz_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the current albedo of the intercepted snow.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`AlbedoSnowInz = Albedo0Snow \cdot</span>
<span class="sd">      \left( 1 - SnowAgingFactor \cdot \frac{ASInz}{1 + ASInz} \right)`</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(5)</span>
<span class="sd">        &gt;&gt;&gt; albedo0snow(0.8)</span>
<span class="sd">        &gt;&gt;&gt; snowagingfactor(0.35)</span>
<span class="sd">        &gt;&gt;&gt; states.asinz = nan, nan, 0.0, 1.0, 3.0</span>
<span class="sd">        &gt;&gt;&gt; states.sinz = 0.0, 0.0, 1.0, 1.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_actualalbedoinz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.actualalbedoinz</span>
<span class="sd">        actualalbedoinz(nan, nan, 0.8, 0.66, 0.59)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">SnowAgingFactor</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Albedo0Snow</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">ASInz</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">SInz</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ActualAlbedoInz</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">sinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">actualalbedoinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">albedo0snow</span> <span class="o">*</span> <span class="p">(</span>
                    <span class="mf">1.0</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">snowagingfactor</span> <span class="o">*</span> <span class="n">sta</span><span class="o">.</span><span class="n">asinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">sta</span><span class="o">.</span><span class="n">asinz</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">actualalbedoinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">nan</span></div>


<div class="viewcode-block" id="Calc_NetShortwaveRadiationInz_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_NetShortwaveRadiationInz_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_NetShortwaveRadiationInz_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the net shortwave radiation for the intercepted snow.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`NetShortwaveRadiationInz =</span>
<span class="sd">      (1 - Fr) \cdot (1.0 - ActualAlbedoInz) \\cdot AdjustedGlobalRadiation`</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-30&quot;, &quot;2000-02-03&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(2)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER, LAUBW)</span>
<span class="sd">        &gt;&gt;&gt; derived.fr.acker_jan = 1.0</span>
<span class="sd">        &gt;&gt;&gt; derived.fr.acker_feb = 1.0</span>
<span class="sd">        &gt;&gt;&gt; derived.fr.laubw_jan = 0.5</span>
<span class="sd">        &gt;&gt;&gt; derived.fr.laubw_feb = 0.1</span>
<span class="sd">        &gt;&gt;&gt; derived.moy.update()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.actualalbedoinz = 0.5</span>
<span class="sd">        &gt;&gt;&gt; fluxes.adjustedglobalradiation = 2.0</span>

<span class="sd">        &gt;&gt;&gt; model.idx_sim = pub.timegrids.init[&quot;2000-01-31&quot;]</span>
<span class="sd">        &gt;&gt;&gt; model.calc_netshortwaveradiationinz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.netshortwaveradiationinz</span>
<span class="sd">        netshortwaveradiationinz(0.0, 0.5)</span>

<span class="sd">        &gt;&gt;&gt; model.idx_sim = pub.timegrids.init[&quot;2000-02-01&quot;]</span>
<span class="sd">        &gt;&gt;&gt; model.calc_netshortwaveradiationinz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.netshortwaveradiationinz</span>
<span class="sd">        netshortwaveradiationinz(0.0, 0.9)</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">Fr</span><span class="p">,</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">MOY</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ActualAlbedoInz</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">AdjustedGlobalRadiation</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NetShortwaveRadiationInz</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">LAUBW</span><span class="p">,</span> <span class="n">MISCHW</span><span class="p">,</span> <span class="n">NADELW</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">netshortwaveradiationinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">der</span><span class="o">.</span><span class="n">fr</span><span class="p">[</span><span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">der</span><span class="o">.</span><span class="n">moy</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">idx_sim</span><span class="p">]])</span>
                    <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">actualalbedoinz</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                    <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">adjustedglobalradiation</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">netshortwaveradiationinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>


<div class="viewcode-block" id="Calc_SchmPotInz_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_SchmPotInz_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_SchmPotInz_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the potential melt of the intercepted snow according to its heat</span>
<span class="sd">    content.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`SchmPotInz = max \left( \frac{ESnowInz}{RSchmelz}, 0 \right)`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(4)</span>
<span class="sd">        &gt;&gt;&gt; states.sinz = 0.0, 1.0, 1.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; states.esnowinz = nan, 5.0, 2.0, -2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_schmpotinz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.schmpotinz</span>
<span class="sd">        schmpotinz(0.0, 14.97006, 5.988024, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fixed</span><span class="o">.</span><span class="n">RSchmelz</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">ESnowInz</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">SInz</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SchmPotInz</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">sinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">schmpotinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">esnowinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">fix</span><span class="o">.</span><span class="n">rschmelz</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">schmpotinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>


<div class="viewcode-block" id="Calc_SchmInz_STInz_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_SchmInz_STInz_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_SchmInz_STInz_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the actual amount of snow melting within the snow interception</span>
<span class="sd">    storage.</span>

<span class="sd">    Basic equations:</span>

<span class="sd">      :math:`\frac{dSTInz}{dt} = -SchmInz`</span>

<span class="sd">      .. math::</span>
<span class="sd">        SchmInz = \begin{cases}</span>
<span class="sd">        SchmPotInz &amp;|\ STInz&gt; 0</span>
<span class="sd">        \\</span>
<span class="sd">        0 &amp;|\ STInz = 0</span>
<span class="sd">        \end{cases}</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(6)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER, LAUBW, MISCHW, NADELW, NADELW, NADELW)</span>
<span class="sd">        &gt;&gt;&gt; states.stinz = 0.0, 0.0, 2.0, 2.0, 2.0, 2.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.schmpotinz = 1.0, 1.0, 0.0, 1.0, 3.0, 5.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_schminz_stinz_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.stinz</span>
<span class="sd">        stinz(0.0, 0.0, 2.0, 1.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.schminz</span>
<span class="sd">        schminz(0.0, 0.0, 0.0, 1.0, 2.0, 2.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SchmPotInz</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SchmInz</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">STInz</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">LAUBW</span><span class="p">,</span> <span class="n">MISCHW</span><span class="p">,</span> <span class="n">NADELW</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">schminz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">schmpotinz</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">sta</span><span class="o">.</span><span class="n">stinz</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">stinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-=</span> <span class="n">flu</span><span class="o">.</span><span class="n">schminz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">schminz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>


<div class="viewcode-block" id="Calc_GefrPotInz_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_GefrPotInz_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_GefrPotInz_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the potential refreezing within the snow interception storage</span>
<span class="sd">    according to its thermal energy.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`GefrPotInz = max \left( -\frac{ESnowInz}{RSchmelz}, 0 \right)`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(4)</span>
<span class="sd">        &gt;&gt;&gt; states.sinz = 0.0, 1.0, 1.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; states.esnowinz = nan, -5.0, -2.0, 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_gefrpotinz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.gefrpotinz</span>
<span class="sd">        gefrpotinz(0.0, 14.97006, 5.988024, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fixed</span><span class="o">.</span><span class="n">RSchmelz</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">ESnowInz</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">SInz</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">GefrPotInz</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">sinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">gefrpotinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="n">sta</span><span class="o">.</span><span class="n">esnowinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">fix</span><span class="o">.</span><span class="n">rschmelz</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">gefrpotinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>


<div class="viewcode-block" id="Calc_GefrInz_STInz_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_GefrInz_STInz_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_GefrInz_STInz_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the actual amount of snow melting within the snow interception</span>
<span class="sd">    storage.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      :math:`\frac{dGefrInz}{dt} = -GefrInz`</span>

<span class="sd">      .. math::</span>
<span class="sd">        GefrInz = \begin{cases}</span>
<span class="sd">        GefrPotInz &amp;|\ SInz - STInz &gt; 0</span>
<span class="sd">        \\</span>
<span class="sd">        0 &amp;|\ SInz - STInz = 0</span>
<span class="sd">        \end{cases}</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(6)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER, LAUBW, LAUBW, LAUBW, MISCHW, NADELW)</span>
<span class="sd">        &gt;&gt;&gt; refreezeflag(True)</span>
<span class="sd">        &gt;&gt;&gt; states.stinz = 0.0, 0.0, 2.0, 2.0, 2.0, 2.0</span>
<span class="sd">        &gt;&gt;&gt; states.sinz = 0.0, 0.0, 4.0, 4.0, 4.0, 4.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.gefrpotinz = 1.0, 1.0, 0.0, 1.0, 3.0, 5.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_gefrinz_stinz_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.stinz</span>
<span class="sd">        stinz(0.0, 0.0, 2.0, 3.0, 4.0, 4.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.gefrinz</span>
<span class="sd">        gefrinz(0.0, 0.0, 0.0, 1.0, 2.0, 2.0)</span>

<span class="sd">        &gt;&gt;&gt; refreezeflag(False)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_gefrinz_stinz_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.stinz</span>
<span class="sd">        stinz(0.0, 0.0, 2.0, 3.0, 4.0, 4.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.gefrinz</span>
<span class="sd">        gefrinz(0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">RefreezeFlag</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">GefrPotInz</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">SInz</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">GefrInz</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">STInz</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">LAUBW</span><span class="p">,</span> <span class="n">MISCHW</span><span class="p">,</span> <span class="n">NADELW</span><span class="p">)</span> <span class="ow">and</span> <span class="n">con</span><span class="o">.</span><span class="n">refreezeflag</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">gefrinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">gefrpotinz</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">sinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">sta</span><span class="o">.</span><span class="n">stinz</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">stinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">gefrinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">gefrinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>


<div class="viewcode-block" id="Calc_EvSInz_SInz_STInz_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_EvSInz_SInz_STInz_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_EvSInz_SInz_STInz_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the evaporation from the snow interception storage, if any exists,</span>
<span class="sd">    and its content accordingly.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      :math:`SInz_{new} = f \cdot SInz_{old}`</span>

<span class="sd">      :math:`STInz_{new} = f \cdot STInz_{old}`</span>

<span class="sd">      :math:`f = \frac{SInz-EvS}{SInz}`</span>

<span class="sd">      :math:`EvSInz = max \left( \frac{WLatSnow}{L}, SInz \right)`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(8)</span>
<span class="sd">        &gt;&gt;&gt; lnk(LAUBW, MISCHW, NADELW, NADELW, NADELW, NADELW, NADELW, ACKER)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wlatinz = -1.0, 0.0, 2.0, 4.0, 6.0, 6.0, 6.0, 6.0</span>
<span class="sd">        &gt;&gt;&gt; states.sinz = 2.0, 2.0, 2.0, 2.0, 2.0, 1.5, 0.0, 2.0</span>
<span class="sd">        &gt;&gt;&gt; states.stinz = 1.0, 1.0, 1.0, 1.0, 1.0, 0.5, 0.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_evsinz_sinz_stinz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evsinz</span>
<span class="sd">        evsinz(-0.37489, 0.0, 0.74978, 1.49956, 2.0, 1.5, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sinz</span>
<span class="sd">        sinz(2.37489, 2.0, 1.25022, 0.50044, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.stinz</span>
<span class="sd">        stinz(1.187445, 1.0, 0.62511, 0.25022, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fixed</span><span class="o">.</span><span class="n">LWE</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WLatInz</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">EvSInz</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">SInz</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">STInz</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">LAUBW</span><span class="p">,</span> <span class="n">MISCHW</span><span class="p">,</span> <span class="n">NADELW</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">sinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">evsinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">wlatinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">fix</span><span class="o">.</span><span class="n">lwe</span><span class="p">,</span> <span class="n">sta</span><span class="o">.</span><span class="n">sinz</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="n">d_frac</span> <span class="o">=</span> <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">sinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">evsinz</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">/</span> <span class="n">sta</span><span class="o">.</span><span class="n">sinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">sinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*=</span> <span class="n">d_frac</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">stinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*=</span> <span class="n">d_frac</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">evsinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">sinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">stinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>


<div class="viewcode-block" id="Update_WaDaInz_SInz_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Update_WaDaInz_SInz_V1">[docs]</a><span class="k">class</span> <span class="nc">Update_WaDaInz_SInz_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Update the actual water release from and the liquid water content of</span>
<span class="sd">    the snow interception storage due to melting.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      :math:`WaDaInz_{new} = WaDaInz_{old} + \Delta`</span>

<span class="sd">      :math:`SInz_{new} = SInz_{old} - \Delta`</span>

<span class="sd">      :math:`\Delta = max(SInz - PWMax \cdot STInz, 0)`</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(5)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER, LAUBW, LAUBW, MISCHW, NADELW)</span>
<span class="sd">        &gt;&gt;&gt; pwmax(2.0)</span>
<span class="sd">        &gt;&gt;&gt; states.stinz = 0.0, 0.0, 1.0, 1.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; states.sinz = 1.0, 0.0, 1.0, 2.0, 3.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wadainz = 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.update_wadainz_sinz_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.sinz</span>
<span class="sd">        sinz(1.0, 0.0, 1.0, 2.0, 2.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wadainz</span>
<span class="sd">        wadainz(1.0, 1.0, 1.0, 1.0, 2.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">PWMax</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">STInz</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">SInz</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WaDaInz</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">LAUBW</span><span class="p">,</span> <span class="n">MISCHW</span><span class="p">,</span> <span class="n">NADELW</span><span class="p">):</span>
                <span class="n">d_wadainz_corr</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">sinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">pwmax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">sta</span><span class="o">.</span><span class="n">stinz</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">)</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">wadainz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">d_wadainz_corr</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">sinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-=</span> <span class="n">d_wadainz_corr</span></div>


<div class="viewcode-block" id="Update_ESnowInz_V2"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Update_ESnowInz_V2">[docs]</a><span class="k">class</span> <span class="nc">Update_ESnowInz_V2</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Update the thermal energy content of the intercepted snow regarding snow</span>
<span class="sd">    melt and refreezing.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`\frac{dESnowInz}{dt} = RSchmelz \cdot (GefrInz - SchmInz)`</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(5)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER, NADELW, NADELW, NADELW, NADELW)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.gefrinz = 0.0, 0.0, 4.0, 0.0, 4.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.schminz = 0.0, 0.0, 0.0, 4.0, 4.0</span>
<span class="sd">        &gt;&gt;&gt; states.esnowinz = 1.0, 1.0, -1.5, 1.336, 0.0</span>
<span class="sd">        &gt;&gt;&gt; states.sinz = 1.0, 0.0, 5.0, 5.0, 10.0</span>
<span class="sd">        &gt;&gt;&gt; model.update_esnowinz_v2()</span>
<span class="sd">        &gt;&gt;&gt; states.esnowinz</span>
<span class="sd">        esnowinz(0.0, 0.0, -0.164, 0.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fixed</span><span class="o">.</span><span class="n">RSchmelz</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">GefrInz</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SchmInz</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">SInz</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">ESnowInz</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">LAUBW</span><span class="p">,</span> <span class="n">MISCHW</span><span class="p">,</span> <span class="n">NADELW</span><span class="p">)</span> <span class="ow">and</span> <span class="n">sta</span><span class="o">.</span><span class="n">sinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">esnowinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">fix</span><span class="o">.</span><span class="n">rschmelz</span> <span class="o">*</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">gefrinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">schminz</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">esnowinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>


<div class="viewcode-block" id="Calc_WATS_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_WATS_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_WATS_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Add the snow fall to the frozen water equivalent of the snow cover.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`\\frac{dW\\!ATS}{dt} = SBes`</span>

<span class="sd">    Example:</span>

<span class="sd">        On water surfaces, method |Calc_WATS_V1| never builds up a snow layer:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(4)</span>
<span class="sd">        &gt;&gt;&gt; lnk(WASSER, FLUSS, SEE, ACKER)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.sbes = 2.0</span>
<span class="sd">        &gt;&gt;&gt; states.wats = 5.5</span>
<span class="sd">        &gt;&gt;&gt; model.calc_wats_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.wats</span>
<span class="sd">        wats(0.0, 0.0, 0.0, 7.5)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SBes</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">WATS</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">WASSER</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">):</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">wats</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">wats</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">sbes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>


<div class="viewcode-block" id="Calc_WATS_V2"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_WATS_V2">[docs]</a><span class="k">class</span> <span class="nc">Calc_WATS_V2</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Add the not intercepted snow fall to the frozen water equivalent of the</span>
<span class="sd">    snow cover.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`\frac{dW\!\!ATS}{dt} = SBes - SBesInz`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(3)</span>
<span class="sd">        &gt;&gt;&gt; lnk(WASSER, ACKER, LAUBW)</span>
<span class="sd">        &gt;&gt;&gt; states.wats = 0.0, 1.0, 2.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.sbes = 2.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.sbesinz = 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_wats_v2()</span>
<span class="sd">        &gt;&gt;&gt; states.wats</span>
<span class="sd">        wats(0.0, 3.0, 3.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SBes</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SBesInz</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">WATS</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">WASSER</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">):</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">wats</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">elif</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">LAUBW</span><span class="p">,</span> <span class="n">MISCHW</span><span class="p">,</span> <span class="n">NADELW</span><span class="p">):</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">wats</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">sbes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">sbesinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">wats</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">sbes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>


<div class="viewcode-block" id="Calc_WaDa_WAeS_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_WaDa_WAeS_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_WaDa_WAeS_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Add as much liquid precipitation to the snow cover as it is able to hold.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      :math:`\\frac{dW\\!AeS}{dt} = NBes - WaDa`</span>

<span class="sd">      :math:`W\\!AeS \\leq PWMax \\cdot W\\!ATS`</span>

<span class="sd">    Example:</span>

<span class="sd">        For simplicity, we set the threshold parameter |PWMax| to a value</span>
<span class="sd">        of two for each of the six initialised hydrological response units.</span>
<span class="sd">        Thus, the snow layer can hold as much liquid water as it contains</span>
<span class="sd">        frozen water.  Stand precipitation is also always set to the same</span>
<span class="sd">        value, but we vary the initial conditions of the snow cover:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(6)</span>
<span class="sd">        &gt;&gt;&gt; lnk(FLUSS, SEE, ACKER, ACKER, ACKER, ACKER)</span>
<span class="sd">        &gt;&gt;&gt; pwmax(2.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.nbes = 1.0</span>
<span class="sd">        &gt;&gt;&gt; states.wats = 0.0, 0.0, 0.0, 1.0, 1.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; states.waes = 1.0, 1.0, 0.0, 1.0, 1.5, 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_wada_waes_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.waes</span>
<span class="sd">        waes(0.0, 0.0, 0.0, 2.0, 2.0, 2.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wada</span>
<span class="sd">        wada(1.0, 1.0, 1.0, 0.0, 0.5, 1.0)</span>

<span class="sd">        Note the special cases of the first two response units of type |FLUSS|</span>
<span class="sd">        and |SEE|.  For water areas, stand precipitaton |NBes| is generally</span>
<span class="sd">        passed to |WaDa| and |WAeS| is set to zero.  For all other land</span>
<span class="sd">        use classes (of which only |ACKER| is selected), method</span>
<span class="sd">        |Calc_WaDa_WAeS_V1| only passes the part of |NBes| exceeding the</span>
<span class="sd">        actual snow holding capacity to |WaDa|.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">PWMax</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NBes</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">WATS</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">WAeS</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WaDa</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">WASSER</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">):</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">wada</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">nbes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">nbes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">wada</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">pwmax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">sta</span><span class="o">.</span><span class="n">wats</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">)</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-=</span> <span class="n">flu</span><span class="o">.</span><span class="n">wada</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>


<div class="viewcode-block" id="Calc_WaDa_WAeS_V2"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_WaDa_WAeS_V2">[docs]</a><span class="k">class</span> <span class="nc">Calc_WaDa_WAeS_V2</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Add as much liquid precipitation and interception melt to the snow cover</span>
<span class="sd">    as it is able to hold.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      :math:`\frac{dW\!\!AeS}{dt} = NBes - NBesInz + WaDaInz - WaDa`</span>

<span class="sd">      :math:`W\!\!AeS \leq PWMax \cdot W\!\!AT\!S`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(10)</span>
<span class="sd">        &gt;&gt;&gt; lnk(FLUSS, SEE, ACKER, ACKER, ACKER, ACKER, LAUBW, LAUBW, LAUBW, LAUBW)</span>
<span class="sd">        &gt;&gt;&gt; pwmax(2.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.nbes = 1.5</span>
<span class="sd">        &gt;&gt;&gt; fluxes.nbesinz = 1.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wadainz = 0.5</span>
<span class="sd">        &gt;&gt;&gt; states.wats = 0.0, 0.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; states.waes = 1.0, 1.0, 0.0, 1.0, 1.5, 2.0, 0.0, 1.0, 1.5, 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_wada_waes_v2()</span>
<span class="sd">        &gt;&gt;&gt; states.waes</span>
<span class="sd">        waes(0.0, 0.0, 0.0, 2.0, 2.0, 2.0, 0.0, 2.0, 2.0, 2.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wada</span>
<span class="sd">        wada(1.0, 1.0, 1.0, 0.0, 0.5, 1.0, 1.5, 0.5, 1.0, 1.5)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">PWMax</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NBes</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NBesInz</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WaDaInz</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">WATS</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">WAeS</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WaDa</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">WASSER</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">):</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">wada</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">nbes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">nbesinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">wadainz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">LAUBW</span><span class="p">,</span> <span class="n">MISCHW</span><span class="p">,</span> <span class="n">NADELW</span><span class="p">):</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">nbes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">wada</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">pwmax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">sta</span><span class="o">.</span><span class="n">wats</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">)</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-=</span> <span class="n">flu</span><span class="o">.</span><span class="n">wada</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">nbes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">nbesinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">wadainz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">wada</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">pwmax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">sta</span><span class="o">.</span><span class="n">wats</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">)</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-=</span> <span class="n">flu</span><span class="o">.</span><span class="n">wada</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>


<div class="viewcode-block" id="Calc_WGTF_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_WGTF_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_WGTF_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the heat flux according to the degree-day method</span>
<span class="sd">    :cite:`ref-LARSIM`.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`WGTF = GTF \\cdot (TKor - TRefT) \\cdot RSchmelz`</span>

<span class="sd">    Examples:</span>

<span class="sd">        Initialise six hydrological response units with identical degree-day</span>
<span class="sd">        factors and temperature thresholds, but different combinations of</span>
<span class="sd">        land use and air temperature:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(6)</span>
<span class="sd">        &gt;&gt;&gt; lnk(FLUSS, SEE, LAUBW, ACKER, ACKER, LAUBW)</span>
<span class="sd">        &gt;&gt;&gt; gtf(5.0)</span>
<span class="sd">        &gt;&gt;&gt; treft(0.0)</span>
<span class="sd">        &gt;&gt;&gt; trefn(1.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkor = 1.0, 1.0, 1.0, 1.0, 0.0, -1.0</span>

<span class="sd">        Note that the values of the degree-day factor are only half</span>
<span class="sd">        as much as the given value, due to the simulation step size</span>
<span class="sd">        being only half as long as the parameter step size:</span>

<span class="sd">        &gt;&gt;&gt; gtf</span>
<span class="sd">        gtf(5.0)</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import print_values</span>
<span class="sd">        &gt;&gt;&gt; print_values(gtf.values)</span>
<span class="sd">        2.5, 2.5, 2.5, 2.5, 2.5, 2.5</span>

<span class="sd">        The results of the first four hydrological response units show</span>
<span class="sd">        that |WGTF| is generally zero for water areas (here, |FLUSS| and</span>
<span class="sd">        |SEE|) in principally identical for all other landuse-use type</span>
<span class="sd">        (here, |ACKER| and |LAUBW|).  The results of the last three</span>
<span class="sd">        response units show the expectable linear relationship.  However,</span>
<span class="sd">        note that that |WGTF| is allowed to be negative:</span>

<span class="sd">        &gt;&gt;&gt; model.calc_wgtf_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wgtf</span>
<span class="sd">        wgtf(0.0, 0.0, 0.835, 0.835, 0.0, -0.835)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">GTF</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">TRefT</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fixed</span><span class="o">.</span><span class="n">RSchmelz</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TKor</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WGTF</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">WASSER</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">wgtf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">wgtf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">gtf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">tkor</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">treft</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">*</span> <span class="n">fix</span><span class="o">.</span><span class="n">rschmelz</span></div>


<div class="viewcode-block" id="Calc_WNied_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_WNied_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_WNied_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the heat flux into the snow layer due to the total amount</span>
<span class="sd">    of ingoing precipitation (:cite:`ref-LARSIM`, modified).</span>

<span class="sd">    Method |Calc_WNied_V1| assumes that the temperature of precipitation</span>
<span class="sd">    equals air temperature minus |TRefN|.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`WNied = (TKor - TRefN) \\cdot</span>
<span class="sd">      (CPEis \\cdot SBes + CPWasser \\cdot (NBes - SBes))`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(5)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER, ACKER, ACKER, ACKER, WASSER)</span>
<span class="sd">        &gt;&gt;&gt; trefn(-2.0, 2.0, 2.0, 2.0, 2.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkor(1.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.nbes = 10.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.sbes = 0.0, 0.0, 5.0, 10.0, 10.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_wnied_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wnied</span>
<span class="sd">        wnied(0.125604, -0.041868, -0.031384, -0.0209, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">TRefN</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">CPWasser</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">CPEis</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TKor</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NBes</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SBes</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WNied</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">WASSER</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">wnied</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">d_ice</span> <span class="o">=</span> <span class="n">fix</span><span class="o">.</span><span class="n">cpeis</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">sbes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">d_water</span> <span class="o">=</span> <span class="n">fix</span><span class="o">.</span><span class="n">cpwasser</span> <span class="o">*</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">nbes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">sbes</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">wnied</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">tkor</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">trefn</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">d_ice</span> <span class="o">+</span> <span class="n">d_water</span><span class="p">)</span></div>


<div class="viewcode-block" id="Calc_WNied_ESnow_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_WNied_ESnow_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_WNied_ESnow_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the heat flux into the snow layer due to the amount</span>
<span class="sd">    of precipitation actually hold by the snow layer.</span>

<span class="sd">    Method |Calc_WNied_V1| assumes that the temperature of precipitation</span>
<span class="sd">    equals air temperature minus |TRefN|.  The same holds for the</span>
<span class="sd">    temperature of the fraction of precipitation not hold by the snow</span>
<span class="sd">    layer (in other words: no temperature mixing occurs).</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`\\frac{dESnow}{dt} = WNied`</span>

<span class="sd">      :math:`WNied = (TKor-TRefN) \\cdot</span>
<span class="sd">      (CPEis \\cdot SBes + CPWasser \\cdot (NBes - SBes - WaDa))`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(6)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER, ACKER, ACKER, ACKER, ACKER, WASSER)</span>
<span class="sd">        &gt;&gt;&gt; trefn(1.0)</span>
<span class="sd">        &gt;&gt;&gt; states.esnow = 0.02</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkor = 4.0, 0.0, 0.0, 0.0, 0.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.nbes = 10.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.sbes = 0.0, 0.0, 5.0, 10.0, 5.0, 5.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wada = 0.0, 0.0, 0.0, 0.0, 5.0, 5.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_wnied_esnow_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wnied</span>
<span class="sd">        wnied(0.125604, -0.041868, -0.031384, -0.0209, -0.01045, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.esnow</span>
<span class="sd">        esnow(0.145604, -0.021868, -0.011384, -0.0009, 0.00955, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">TRefN</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">CPWasser</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">CPEis</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TKor</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NBes</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SBes</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WaDa</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">ESnow</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WNied</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">WASSER</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">wnied</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">esnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">d_ice</span> <span class="o">=</span> <span class="n">fix</span><span class="o">.</span><span class="n">cpeis</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">sbes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">d_water</span> <span class="o">=</span> <span class="n">fix</span><span class="o">.</span><span class="n">cpwasser</span> <span class="o">*</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">nbes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">sbes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">wada</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">wnied</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">tkor</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">trefn</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">d_ice</span> <span class="o">+</span> <span class="n">d_water</span><span class="p">)</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">esnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">wnied</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>


<div class="viewcode-block" id="Return_SaturationVapourPressure_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Return_SaturationVapourPressure_V1">[docs]</a><span class="k">class</span> <span class="nc">Return_SaturationVapourPressure_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate and return the saturation vapour pressure over an</span>
<span class="sd">    arbitrary surface for the given temperature :cite:`ref-LARSIM`</span>
<span class="sd">    (based on :cite:`ref-Weischt1983`).</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`0.61078 \\cdot</span>
<span class="sd">      2.71828^{\\frac{17.08085 \\cdot temperature}{temperature + 234.175}}`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_saturationvapourpressure_v1(10.0))</span>
<span class="sd">        1.229385</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span>
        <span class="n">temperature</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.61078</span> <span class="o">*</span> <span class="mf">2.71828</span> <span class="o">**</span> <span class="p">(</span><span class="mf">17.08085</span> <span class="o">*</span> <span class="n">temperature</span> <span class="o">/</span> <span class="p">(</span><span class="n">temperature</span> <span class="o">+</span> <span class="mf">234.175</span><span class="p">))</span></div>


<div class="viewcode-block" id="Return_SaturationVapourPressureSlope_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Return_SaturationVapourPressureSlope_V1">[docs]</a><span class="k">class</span> <span class="nc">Return_SaturationVapourPressureSlope_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate and return the saturation vapour pressure slope over an</span>
<span class="sd">    arbitrary surface for the given temperature.</span>

<span class="sd">    Basic equation (derivative of |Return_SaturationVapourPressure_V1|:</span>
<span class="sd">      :math:`\\frac{2443.06 \\cdot</span>
<span class="sd">      exp((17.08085 \\cdot temperature) / (temperature + 234.175)}</span>
<span class="sd">      {(temperature+234.175)^2}`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_saturationvapourpressureslope_v1(10.0))</span>
<span class="sd">        0.082477</span>
<span class="sd">        &gt;&gt;&gt; dx = 1e-6</span>
<span class="sd">        &gt;&gt;&gt; round_((model.return_saturationvapourpressure_v1(10.0+dx) -</span>
<span class="sd">        ...         model.return_saturationvapourpressure_v1(10.0-dx))/2/dx)</span>
<span class="sd">        0.082477</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span>
        <span class="n">temperature</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="mf">2443.06</span>
            <span class="o">*</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">17.08085</span> <span class="o">*</span> <span class="n">temperature</span> <span class="o">/</span> <span class="p">(</span><span class="n">temperature</span> <span class="o">+</span> <span class="mf">234.175</span><span class="p">))</span>
            <span class="o">/</span> <span class="p">(</span><span class="n">temperature</span> <span class="o">+</span> <span class="mf">234.175</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Calc_SaturationVapourPressure_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_SaturationVapourPressure_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_SaturationVapourPressure_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the saturation vapour pressure over arbitrary surfaces.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`SaturationVapourPressure =</span>
<span class="sd">      Return\\_SaturationVapourPressure\\_V1(TKor)`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(3)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkor = -10.0, 0.0, 10.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_saturationvapourpressure_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.saturationvapourpressure</span>
<span class="sd">        saturationvapourpressure(0.285087, 0.61078, 1.229385)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Return_SaturationVapourPressure_V1</span><span class="p">,)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TKor</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SaturationVapourPressure</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">saturationvapourpressure</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_saturationvapourpressure_v1</span><span class="p">(</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">tkor</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="Calc_DailySaturationVapourPressure_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_DailySaturationVapourPressure_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_DailySaturationVapourPressure_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the daily saturation vapour pressure over arbitrary surfaces.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`DailySaturationVapourPressure =</span>
<span class="sd">      Return\\_SaturationVapourPressure\\_V1(TKorTag)`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(3)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkortag = -10.0, 0.0, 10.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_dailysaturationvapourpressure_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailysaturationvapourpressure</span>
<span class="sd">        dailysaturationvapourpressure(0.285087, 0.61078, 1.229385)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Return_SaturationVapourPressure_V1</span><span class="p">,)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TKorTag</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">DailySaturationVapourPressure</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">dailysaturationvapourpressure</span><span class="p">[</span>
                <span class="n">k</span>
            <span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_saturationvapourpressure_v1</span><span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">tkortag</span><span class="p">[</span><span class="n">k</span><span class="p">])</span></div>


<div class="viewcode-block" id="Calc_SaturationVapourPressureSlope_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_SaturationVapourPressureSlope_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_SaturationVapourPressureSlope_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the daily slope of the saturation vapour pressure curve.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`SaturationVapourPressureSlope =</span>
<span class="sd">      Return\\_SaturationVapourPressureSlope\\_V1(TKor)`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(3)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkor = -10.0, 0.0, 10.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.saturationvapourpressure = 0.285096, 0.6108, 1.229426</span>
<span class="sd">        &gt;&gt;&gt; model.calc_saturationvapourpressureslope_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.saturationvapourpressureslope</span>
<span class="sd">        saturationvapourpressureslope(0.022691, 0.044551, 0.082477)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Return_SaturationVapourPressureSlope_V1</span><span class="p">,)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TKor</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SaturationVapourPressureSlope</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">saturationvapourpressureslope</span><span class="p">[</span>
                <span class="n">k</span>
            <span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_saturationvapourpressureslope_v1</span><span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">tkor</span><span class="p">[</span><span class="n">k</span><span class="p">])</span></div>


<div class="viewcode-block" id="Calc_DailySaturationVapourPressureSlope_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_DailySaturationVapourPressureSlope_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_DailySaturationVapourPressureSlope_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the daily slope of the saturation vapour pressure curve.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`DailySaturationVapourPressureSlope =</span>
<span class="sd">      Return\\_SaturationVapourPressureSlope\\_V1(TKorTag)`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(3)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkortag = 10.0, 0.0, -10.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_dailysaturationvapourpressureslope_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailysaturationvapourpressureslope</span>
<span class="sd">        dailysaturationvapourpressureslope(0.082477, 0.044551, 0.022691)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Return_SaturationVapourPressureSlope_V1</span><span class="p">,)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TKorTag</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">DailySaturationVapourPressureSlope</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">dailysaturationvapourpressureslope</span><span class="p">[</span>
                <span class="n">k</span>
            <span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_saturationvapourpressureslope_v1</span><span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">tkortag</span><span class="p">[</span><span class="n">k</span><span class="p">])</span></div>


<div class="viewcode-block" id="Return_ActualVapourPressure_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Return_ActualVapourPressure_V1">[docs]</a><span class="k">class</span> <span class="nc">Return_ActualVapourPressure_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate and return the actual vapour pressure for the given</span>
<span class="sd">    saturation vapour pressure and relative humidity. :cite:`ref-LARSIM`</span>
<span class="sd">    (based on `ref-Weischet1983`)</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`saturationvapourpressure \\cdot relativehumidity / 100`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_actualvapourpressure_v1(2.0, 60.0))</span>
<span class="sd">        1.2</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span>
        <span class="n">saturationvapourpressure</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">relativehumidity</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">saturationvapourpressure</span> <span class="o">*</span> <span class="n">relativehumidity</span> <span class="o">/</span> <span class="mf">100.0</span></div>


<div class="viewcode-block" id="Calc_ActualVapourPressure_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_ActualVapourPressure_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_ActualVapourPressure_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the actual vapour pressure.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`ActualVapourPressure = Return\\_ActualVapourPressure\\_V1(</span>
<span class="sd">      SaturationVapourPressure, RelativeHumidity)`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(1)</span>
<span class="sd">        &gt;&gt;&gt; derived.nmblogentries.update()</span>
<span class="sd">        &gt;&gt;&gt; inputs.relativehumidity = 60.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.saturationvapourpressure = 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_actualvapourpressure_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.actualvapourpressure</span>
<span class="sd">        actualvapourpressure(1.2)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Return_ActualVapourPressure_V1</span><span class="p">,)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_inputs</span><span class="o">.</span><span class="n">RelativeHumidity</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SaturationVapourPressure</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ActualVapourPressure</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">actualvapourpressure</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_actualvapourpressure_v1</span><span class="p">(</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">saturationvapourpressure</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">inp</span><span class="o">.</span><span class="n">relativehumidity</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="Calc_DailyActualVapourPressure_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_DailyActualVapourPressure_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_DailyActualVapourPressure_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the daily actual vapour pressure.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`DailyActualVapourPressure = Return\\_ActualVapourPressure\\_V1(</span>
<span class="sd">      DailySaturationVapourPressure, DailyRelativeHumidity)`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(1)</span>
<span class="sd">        &gt;&gt;&gt; derived.nmblogentries.update()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailyrelativehumidity = 40.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailysaturationvapourpressure = 4.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_dailyactualvapourpressure_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailyactualvapourpressure</span>
<span class="sd">        dailyactualvapourpressure(1.6)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Return_ActualVapourPressure_V1</span><span class="p">,)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">DailyRelativeHumidity</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">DailySaturationVapourPressure</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">DailyActualVapourPressure</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">dailyactualvapourpressure</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_actualvapourpressure_v1</span><span class="p">(</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">dailysaturationvapourpressure</span><span class="p">[</span><span class="n">k</span><span class="p">],</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">dailyrelativehumidity</span><span class="p">,</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="Calc_DailyNetLongwaveRadiation_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_DailyNetLongwaveRadiation_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_DailyNetLongwaveRadiation_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the daily net longwave radiation.</span>

<span class="sd">    Basic equation above a snow-free surface:</span>
<span class="sd">       :math:`DailyNetLongwaveRadiation =</span>
<span class="sd">       Sigma \\cdot (TKorTag + 273.15)^4 \\cdot</span>
<span class="sd">       \\left(Emissivity - FrAtm \\cdot</span>
<span class="sd">       \\left(\\frac{DailyActualVapourPressure \\cdot 10}</span>
<span class="sd">       {TKorTag + 273.15}\\right)^{1/7}\\right) \\cdot</span>
<span class="sd">       \\left(0.2 + 0.8 \\cdot</span>
<span class="sd">       \\frac{DailySunshineDuration}{DailyPossibleSunshineDuration}\\right)`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(2)</span>
<span class="sd">        &gt;&gt;&gt; emissivity(0.95)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkortag = 22.1, 0.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailyactualvapourpressure = 1.6, 0.6</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailysunshineduration = 12.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailypossiblesunshineduration = 14.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_dailynetlongwaveradiation_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailynetlongwaveradiation</span>
<span class="sd">        dailynetlongwaveradiation(3.495045, 5.027685)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Emissivity</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">Sigma</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">FrAtm</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TKorTag</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">DailyActualVapourPressure</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">DailySunshineDuration</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">DailyPossibleSunshineDuration</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">DailyNetLongwaveRadiation</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">d_relsunshine</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">dailysunshineduration</span> <span class="o">/</span> <span class="n">flu</span><span class="o">.</span><span class="n">dailypossiblesunshineduration</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="n">d_temp</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">tkortag</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="mf">273.15</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">dailynetlongwaveradiation</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">(</span><span class="mf">0.2</span> <span class="o">+</span> <span class="mf">0.8</span> <span class="o">*</span> <span class="n">d_relsunshine</span><span class="p">)</span>
                <span class="o">*</span> <span class="n">fix</span><span class="o">.</span><span class="n">sigma</span>
                <span class="o">*</span> <span class="n">d_temp</span> <span class="o">**</span> <span class="mi">4</span>
                <span class="o">*</span> <span class="p">(</span>
                    <span class="n">con</span><span class="o">.</span><span class="n">emissivity</span>
                    <span class="o">-</span> <span class="n">fix</span><span class="o">.</span><span class="n">fratm</span>
                    <span class="o">*</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">dailyactualvapourpressure</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="mf">10.0</span> <span class="o">/</span> <span class="n">d_temp</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="mf">7.0</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="Calc_RLAtm_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_RLAtm_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_RLAtm_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the longwave radiation emitted from the atmosphere</span>
<span class="sd">     :cite:`ref-Thompson1981`.</span>

<span class="sd">    Basic equation (see :cite:`ref-LARSIM`, equation 3.40):</span>

<span class="sd">      :math:`RLAtm =</span>
<span class="sd">      FrAtm \cdot Sigma \cdot  (Tkor + 273.15)^4 \cdot</span>
<span class="sd">      \left( \frac{ActualVapourPressure \cdot 10}{TKor + 273.15} \right) ^{1/7}</span>
<span class="sd">      \cdot \left(1 + 0.22 \cdot \left(</span>
<span class="sd">      1 - \frac{DailySunshineDuration}{DailyPossibleSunshineDuration} \right)^2</span>
<span class="sd">      \right)`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(2)</span>
<span class="sd">        &gt;&gt;&gt; derived.days(1/24)</span>
<span class="sd">        &gt;&gt;&gt; emissivity(0.95)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkor = 0.0, 10.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.actualvapourpressure = 0.6</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailysunshineduration = 12.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailypossiblesunshineduration = 14.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rlatm_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.rlatm</span>
<span class="sd">        rlatm(0.846746, 0.972711)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">Days</span><span class="p">,)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">Sigma</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">FrAtm</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TKor</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ActualVapourPressure</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">DailySunshineDuration</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">DailyPossibleSunshineDuration</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_aides</span><span class="o">.</span><span class="n">RLAtm</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">d_rs</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">dailysunshineduration</span> <span class="o">/</span> <span class="n">flu</span><span class="o">.</span><span class="n">dailypossiblesunshineduration</span>
        <span class="n">d_common</span> <span class="o">=</span> <span class="n">fix</span><span class="o">.</span><span class="n">fratm</span> <span class="o">*</span> <span class="n">fix</span><span class="o">.</span><span class="n">sigma</span> <span class="o">*</span> <span class="n">der</span><span class="o">.</span><span class="n">days</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="mf">0.22</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">d_rs</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="n">d_t</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">tkor</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="mf">273.15</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">rlatm</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">d_common</span> <span class="o">*</span> <span class="p">(</span>
                <span class="n">d_t</span> <span class="o">**</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">actualvapourpressure</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="mf">10.0</span> <span class="o">/</span> <span class="n">d_t</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="mf">7.0</span><span class="p">)</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="Return_NetLongwaveRadiationInz_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Return_NetLongwaveRadiationInz_V1">[docs]</a><span class="k">class</span> <span class="nc">Return_NetLongwaveRadiationInz_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate and return the net longwave radiation for intercepted snow.</span>

<span class="sd">    The following equation is not part of the official `LARSIM`_ documentation.</span>
<span class="sd">    We think, it fits to the geometric assumtions underlying method</span>
<span class="sd">    |Return_NetLongwaveRadiationSnow_V1| but so far have not thoroughly checked</span>
<span class="sd">    if it results in realistic net longwave radiations.</span>

<span class="sd">    Basic equation:</span>

<span class="sd">      :math:`\big( 1 - Fr \big) \cdot \big( 0.97 \cdot Sigma \cdot (TempS + 273.15)^4</span>
<span class="sd">      - RLAtm \big)`</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-30&quot;, &quot;2000-02-03&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(2)</span>
<span class="sd">        &gt;&gt;&gt; lnk(LAUBW, NADELW)</span>
<span class="sd">        &gt;&gt;&gt; derived.moy.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.days(1/24)</span>
<span class="sd">        &gt;&gt;&gt; derived.fr.laubw_jan = 0.4</span>
<span class="sd">        &gt;&gt;&gt; derived.fr.laubw_feb = 0.5</span>
<span class="sd">        &gt;&gt;&gt; derived.fr.nadelw_jan = 0.6</span>
<span class="sd">        &gt;&gt;&gt; derived.fr.nadelw_feb = 0.7</span>
<span class="sd">        &gt;&gt;&gt; aides.tempsinz = -1.0</span>
<span class="sd">        &gt;&gt;&gt; aides.rlatm = 0.846746</span>

<span class="sd">        &gt;&gt;&gt; model.idx_sim = pub.timegrids.init[&quot;2000-01-31&quot;]</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import print_values</span>
<span class="sd">        &gt;&gt;&gt; for hru in range(2):</span>
<span class="sd">        ...     print_values(</span>
<span class="sd">        ...         [hru, model.return_netlongwaveradiationinz_v1(hru)])</span>
<span class="sd">        0, 0.163799</span>
<span class="sd">        1, 0.109199</span>

<span class="sd">        &gt;&gt;&gt; model.idx_sim = pub.timegrids.init[&quot;2000-02-01&quot;]</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import print_values</span>
<span class="sd">        &gt;&gt;&gt; for hru in range(2):</span>
<span class="sd">        ...     print_values(</span>
<span class="sd">        ...         [hru, model.return_netlongwaveradiationinz_v1(hru)])</span>
<span class="sd">        0, 0.136499</span>
<span class="sd">        1, 0.0819</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">MOY</span><span class="p">,</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">Days</span><span class="p">,</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">Fr</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fixed</span><span class="o">.</span><span class="n">Sigma</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_aides</span><span class="o">.</span><span class="n">TempSInz</span><span class="p">,</span>
        <span class="n">lland_aides</span><span class="o">.</span><span class="n">RLAtm</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span>
        <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">d_fr</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">fr</span><span class="p">[</span><span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">der</span><span class="o">.</span><span class="n">moy</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">idx_sim</span><span class="p">]]</span>
        <span class="n">d_rlsnow</span> <span class="o">=</span> <span class="n">fix</span><span class="o">.</span><span class="n">sigma</span> <span class="o">*</span> <span class="n">der</span><span class="o">.</span><span class="n">days</span> <span class="o">*</span> <span class="p">(</span><span class="n">aid</span><span class="o">.</span><span class="n">tempsinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="mf">273.15</span><span class="p">)</span> <span class="o">**</span> <span class="mi">4</span>
        <span class="k">return</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">d_fr</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">d_rlsnow</span> <span class="o">-</span> <span class="n">aid</span><span class="o">.</span><span class="n">rlatm</span><span class="p">[</span><span class="n">k</span><span class="p">])</span></div>


<div class="viewcode-block" id="Return_NetLongwaveRadiationSnow_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Return_NetLongwaveRadiationSnow_V1">[docs]</a><span class="k">class</span> <span class="nc">Return_NetLongwaveRadiationSnow_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate and return the net longwave radiation for snow-covered areas.</span>

<span class="sd">    Method |Return_NetLongwaveRadiationSnow_V1| differentiates between forests</span>
<span class="sd">    (|LAUBW|, |MISCHW|, and |NADELW|) and open areas.  The outgoing longwave radiation</span>
<span class="sd">    always depends on the snow surface temperature.  For open areas, the ingoing counter</span>
<span class="sd">    radiation stems from the atmosphere only.  This atmospheric radiation is partly</span>
<span class="sd">    replaced by the longwave radiation emitted by the tree canopies for forests.  The</span>
<span class="sd">    lower the value of parameter |Fr|, the higher this shading effect of the canopies.</span>
<span class="sd">    See :cite:`ref-LARSIM` and:cite:`ref-Thompson1981` for further information.</span>

<span class="sd">    Basic equation:</span>

<span class="sd">      .. math::</span>
<span class="sd">        Sigma \cdot (TempSSurface + 273.15)^4 - \begin{cases}</span>
<span class="sd">        Fr \cdot RLAtm + \big( 1 - Fr  \big) \cdot</span>
<span class="sd">        \big( 0.97 \cdot Sigma \cdot (TKor + 273.15)^4 \big)</span>
<span class="sd">        &amp;|\</span>
<span class="sd">        Lnk \in \{LAUBW, MISCHW, NADELW\}</span>
<span class="sd">        \\</span>
<span class="sd">        RLAtm</span>
<span class="sd">        &amp;|\</span>
<span class="sd">        Lnk \notin \{LAUBW, MISCHW, NADELW\}</span>
<span class="sd">        \end{cases}</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(2)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER, LAUBW)</span>
<span class="sd">        &gt;&gt;&gt; derived.moy(5)</span>
<span class="sd">        &gt;&gt;&gt; derived.days(1/24)</span>
<span class="sd">        &gt;&gt;&gt; derived.fr(0.3)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tempssurface = -5.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkor = 0.0</span>
<span class="sd">        &gt;&gt;&gt; aides.rlatm = 0.846746</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import print_values</span>
<span class="sd">        &gt;&gt;&gt; for hru in range(2):</span>
<span class="sd">        ...     print_values(</span>
<span class="sd">        ...         [hru, model.return_netlongwaveradiationsnow_v1(hru)])</span>
<span class="sd">        0, 0.208605</span>
<span class="sd">        1, 0.029784</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">Days</span><span class="p">,</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">MOY</span><span class="p">,</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">Fr</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fixed</span><span class="o">.</span><span class="n">Sigma</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TempSSurface</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TKor</span><span class="p">,</span>
        <span class="n">lland_aides</span><span class="o">.</span><span class="n">RLAtm</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span>
        <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">d_sigma</span> <span class="o">=</span> <span class="n">fix</span><span class="o">.</span><span class="n">sigma</span> <span class="o">*</span> <span class="n">der</span><span class="o">.</span><span class="n">days</span>
        <span class="n">d_temp</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">tkor</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="mf">273.15</span>
        <span class="n">d_counter</span> <span class="o">=</span> <span class="n">aid</span><span class="o">.</span><span class="n">rlatm</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">LAUBW</span><span class="p">,</span> <span class="n">MISCHW</span><span class="p">,</span> <span class="n">NADELW</span><span class="p">):</span>
            <span class="n">d_fr</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">fr</span><span class="p">[</span><span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">der</span><span class="o">.</span><span class="n">moy</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">idx_sim</span><span class="p">]]</span>
            <span class="n">d_counter</span> <span class="o">=</span> <span class="n">d_fr</span> <span class="o">*</span> <span class="n">d_counter</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">d_fr</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.97</span> <span class="o">*</span> <span class="n">d_sigma</span> <span class="o">*</span> <span class="n">d_temp</span> <span class="o">**</span> <span class="mi">4</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">d_sigma</span> <span class="o">*</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">tempssurface</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="mf">273.15</span><span class="p">)</span> <span class="o">**</span> <span class="mi">4</span> <span class="o">-</span> <span class="n">d_counter</span></div>


<div class="viewcode-block" id="Update_TauS_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Update_TauS_V1">[docs]</a><span class="k">class</span> <span class="nc">Update_TauS_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the dimensionless age of the snow layer :cite:`ref-LARSIM`</span>
<span class="sd">    (based on :cite:`ref-LUBW2006b`).</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      :math:`TauS_{new} = TauS_{old} \\cdot max(1 - 0.1 \\cdot SBes), 0) +</span>
<span class="sd">      \\frac{r_1+r_2+r_3}{10^6} \\cdot Seconds`</span>

<span class="sd">      :math:`r_1 = exp\\left(5000 \\cdot</span>
<span class="sd">      \\left(\\frac{1}{273.15} - \\frac{1}{273.15+TempS}\\right)\\right)`</span>

<span class="sd">      :math:`r_2 = min\\left(r_1^{10}, 1\\right)`</span>

<span class="sd">      :math:`r_3 = 0.03`</span>

<span class="sd">    Example:</span>

<span class="sd">        For snow-free surfaces, |TauS| is not defined; snowfall rejuvenates</span>
<span class="sd">        an existing snow layer; high temperatures increase the speed of aging:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(10)</span>
<span class="sd">        &gt;&gt;&gt; derived.seconds(24*60*60)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.sbes = 0.0, 1.0, 5.0, 9.0, 10.0, 11.0, 11.0, 11.0, 11.0, 11.0</span>
<span class="sd">        &gt;&gt;&gt; states.waes = 0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; states.taus = 1.0, nan, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; aides.temps = (</span>
<span class="sd">        ...     0.0, 0.0, -10.0, -10.0, -10.0, -10.0, -1.0, 0.0, 1.0, 10.0)</span>
<span class="sd">        &gt;&gt;&gt; model.update_taus()</span>
<span class="sd">        &gt;&gt;&gt; states.taus</span>
<span class="sd">        taus(nan, 0.175392, 0.545768, 0.145768, 0.045768, 0.045768, 0.127468,</span>
<span class="sd">             0.175392, 0.181358, 0.253912)</span>

<span class="sd">        Note that an initial |numpy.nan| value serves as an indication that</span>
<span class="sd">        there has been no snow-layer in the last simulation step, meaning</span>
<span class="sd">        the snow is fresh and starts with an age of zero (see the first</span>
<span class="sd">        two hydrological response units).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">Seconds</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SBes</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">WAeS</span><span class="p">,</span>
        <span class="n">lland_aides</span><span class="o">.</span><span class="n">TempS</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">TauS</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">taus</span><span class="p">[</span><span class="n">k</span><span class="p">]):</span>
                    <span class="n">sta</span><span class="o">.</span><span class="n">taus</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">d_r1</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span>
                    <span class="mf">5000.0</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mf">273.15</span> <span class="o">-</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">273.15</span> <span class="o">+</span> <span class="n">aid</span><span class="o">.</span><span class="n">temps</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>
                <span class="p">)</span>
                <span class="n">d_r2</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">d_r1</span> <span class="o">**</span> <span class="mi">10</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">taus</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">sbes</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">)</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">taus</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">d_r1</span> <span class="o">+</span> <span class="n">d_r2</span> <span class="o">+</span> <span class="mf">0.03</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1e6</span> <span class="o">*</span> <span class="n">der</span><span class="o">.</span><span class="n">seconds</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">taus</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">nan</span></div>


<div class="viewcode-block" id="Calc_ActualAlbedo_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_ActualAlbedo_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_ActualAlbedo_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the current albedo value :cite:`ref-LARSIM` (based on</span>
<span class="sd">    :cite:`ref-LUBW2006b`).</span>

<span class="sd">    For snow-free surfaces, method |Calc_ActualAlbedo_V1| takes the</span>
<span class="sd">    value of parameter |Albedo| relevant for the given landuse and month.</span>
<span class="sd">    For snow conditions, it estimates the albedo based on the snow age,</span>
<span class="sd">    as shown by the following equation.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`AlbedoSnow = Albedo0Snow \\cdot</span>
<span class="sd">      \\left(1-SnowAgingFactor \\cdot \\frac{TauS}{1 + TauS}\\right)`</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-30&quot;, &quot;2000-02-03&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(5)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER, VERS, VERS, VERS, VERS)</span>
<span class="sd">        &gt;&gt;&gt; albedo0snow(0.8)</span>
<span class="sd">        &gt;&gt;&gt; snowagingfactor(0.35)</span>
<span class="sd">        &gt;&gt;&gt; albedo.acker_jan = 0.2</span>
<span class="sd">        &gt;&gt;&gt; albedo.vers_jan = 0.3</span>
<span class="sd">        &gt;&gt;&gt; albedo.acker_feb = 0.4</span>
<span class="sd">        &gt;&gt;&gt; albedo.vers_feb = 0.5</span>
<span class="sd">        &gt;&gt;&gt; derived.moy.update()</span>
<span class="sd">        &gt;&gt;&gt; states.taus = nan, nan, 0.0, 1.0, 3.0</span>
<span class="sd">        &gt;&gt;&gt; states.waes = 0.0, 0.0, 1.0, 1.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.idx_sim = 1</span>
<span class="sd">        &gt;&gt;&gt; model.calc_actualalbedo_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.actualalbedo</span>
<span class="sd">        actualalbedo(0.2, 0.3, 0.8, 0.66, 0.59)</span>
<span class="sd">        &gt;&gt;&gt; model.idx_sim = 2</span>
<span class="sd">        &gt;&gt;&gt; model.calc_actualalbedo_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.actualalbedo</span>
<span class="sd">        actualalbedo(0.4, 0.5, 0.8, 0.66, 0.59)</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">SnowAgingFactor</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Albedo0Snow</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Albedo</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">MOY</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">TauS</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">WAeS</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ActualAlbedo</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">actualalbedo</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">albedo0snow</span> <span class="o">*</span> <span class="p">(</span>
                    <span class="mf">1.0</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">snowagingfactor</span> <span class="o">*</span> <span class="n">sta</span><span class="o">.</span><span class="n">taus</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">sta</span><span class="o">.</span><span class="n">taus</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">actualalbedo</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">albedo</span><span class="p">[</span><span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">der</span><span class="o">.</span><span class="n">moy</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">idx_sim</span><span class="p">]]</span></div>


<div class="viewcode-block" id="Calc_NetShortwaveRadiation_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_NetShortwaveRadiation_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_NetShortwaveRadiation_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the net shortwave radiation.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`NetShortwaveRadiation =</span>
<span class="sd">      (1.0 - ActualAlbedo) \\cdot AdjustedGlobalRadiation`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(1)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.actualalbedo = 0.25</span>
<span class="sd">        &gt;&gt;&gt; fluxes.adjustedglobalradiation = 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_netshortwaveradiation_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.netshortwaveradiation</span>
<span class="sd">        netshortwaveradiation(0.75)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ActualAlbedo</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">AdjustedGlobalRadiation</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NetShortwaveRadiation</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">netshortwaveradiation</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="mf">1.0</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">actualalbedo</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="p">)</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">adjustedglobalradiation</span></div>


<div class="viewcode-block" id="Calc_NetShortwaveRadiationSnow_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_NetShortwaveRadiationSnow_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_NetShortwaveRadiationSnow_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the net shortwave radiation for snow-surfaces.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`NetShortwaveRadiationSnow =</span>
<span class="sd">      Fr \\cdot (1.0 - ActualAlbedo) \\cdot AdjustedGlobalRadiation`</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-30&quot;, &quot;2000-02-03&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(2)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER, LAUBW)</span>
<span class="sd">        &gt;&gt;&gt; derived.fr.acker_jan = 1.0</span>
<span class="sd">        &gt;&gt;&gt; derived.fr.acker_feb = 1.0</span>
<span class="sd">        &gt;&gt;&gt; derived.fr.laubw_jan = 0.5</span>
<span class="sd">        &gt;&gt;&gt; derived.fr.laubw_feb = 0.1</span>
<span class="sd">        &gt;&gt;&gt; derived.moy.update()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.actualalbedo = 0.5</span>
<span class="sd">        &gt;&gt;&gt; fluxes.adjustedglobalradiation = 2.0</span>

<span class="sd">        &gt;&gt;&gt; model.idx_sim = pub.timegrids.init[&quot;2000-01-31&quot;]</span>
<span class="sd">        &gt;&gt;&gt; model.calc_netshortwaveradiationsnow_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.netshortwaveradiationsnow</span>
<span class="sd">        netshortwaveradiationsnow(1.0, 0.5)</span>

<span class="sd">        &gt;&gt;&gt; model.idx_sim = pub.timegrids.init[&quot;2000-02-01&quot;]</span>
<span class="sd">        &gt;&gt;&gt; model.calc_netshortwaveradiationsnow_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.netshortwaveradiationsnow</span>
<span class="sd">        netshortwaveradiationsnow(1.0, 0.1)</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">MOY</span><span class="p">,</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">Fr</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ActualAlbedo</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">AdjustedGlobalRadiation</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NetShortwaveRadiationSnow</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">netshortwaveradiationsnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">der</span><span class="o">.</span><span class="n">fr</span><span class="p">[</span><span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">der</span><span class="o">.</span><span class="n">moy</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">idx_sim</span><span class="p">]]</span>
                <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">actualalbedo</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">adjustedglobalradiation</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="Calc_DailyNetShortwaveRadiation_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_DailyNetShortwaveRadiation_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_DailyNetShortwaveRadiation_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the daily net shortwave radiation.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`DailyNetShortwaveRadiation =</span>
<span class="sd">      (1.0 - ActualAlbedo) \\cdot DailyGlobalRadiation`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(1)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.actualalbedo(0.25)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailyglobalradiation = 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_dailynetshortwaveradiation_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailynetshortwaveradiation</span>
<span class="sd">        dailynetshortwaveradiation(0.75)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">DailyGlobalRadiation</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ActualAlbedo</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">DailyNetShortwaveRadiation</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">dailynetshortwaveradiation</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="mf">1.0</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">actualalbedo</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="p">)</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">dailyglobalradiation</span></div>


<div class="viewcode-block" id="Return_TempS_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Return_TempS_V1">[docs]</a><span class="k">class</span> <span class="nc">Return_TempS_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate and return the average temperature of the snow layer</span>
<span class="sd">    :cite:`ref-LARSIM`.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`max\\left(</span>
<span class="sd">      \\frac{ESnow}{WATS \\cdot CPEis + (WAeS-WATS) \\cdot CPWasser},</span>
<span class="sd">      -273\\right)`</span>

<span class="sd">    Example:</span>

<span class="sd">        Note that we use |numpy.nan| values for snow-free surfaces</span>
<span class="sd">        (see the result of the first hydrological response unit) and</span>
<span class="sd">        that method |Return_TempS_V1| never returns temperature values</span>
<span class="sd">        lower than -273 °C (see the result of the fifth response unit):</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(5)</span>
<span class="sd">        &gt;&gt;&gt; states.wats = 0.0, 0.5, 5.0, 0.5, 0.5</span>
<span class="sd">        &gt;&gt;&gt; states.waes = 0.0, 1.0, 10.0, 1.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; states.esnow = 0.0, 0.0, -0.1, -0.8, -1.0</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_temps_v1(0))</span>
<span class="sd">        nan</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_temps_v1(1))</span>
<span class="sd">        0.0</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_temps_v1(2))</span>
<span class="sd">        -3.186337</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_temps_v1(3))</span>
<span class="sd">        -254.906959</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_temps_v1(4))</span>
<span class="sd">        -273.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">CPWasser</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">CPEis</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">WATS</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">WAeS</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">ESnow</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span>
        <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">d_ice</span> <span class="o">=</span> <span class="n">fix</span><span class="o">.</span><span class="n">cpeis</span> <span class="o">*</span> <span class="n">sta</span><span class="o">.</span><span class="n">wats</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">d_water</span> <span class="o">=</span> <span class="n">fix</span><span class="o">.</span><span class="n">cpwasser</span> <span class="o">*</span> <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">sta</span><span class="o">.</span><span class="n">wats</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">esnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">d_ice</span> <span class="o">+</span> <span class="n">d_water</span><span class="p">),</span> <span class="o">-</span><span class="mf">273.0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">nan</span></div>


<div class="viewcode-block" id="Return_ESnowInz_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Return_ESnowInz_V1">[docs]</a><span class="k">class</span> <span class="nc">Return_ESnowInz_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate and return the thermal energy content of the intercepted snow</span>
<span class="sd">    for its given bulk temperature.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`temps \cdot \big( STInz \cdot CPEis + (SInz - STInz) \cdot CPWasser \big)`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(3)</span>
<span class="sd">        &gt;&gt;&gt; states.stinz = 0.0, 0.5, 5.0</span>
<span class="sd">        &gt;&gt;&gt; states.sinz = 0.0, 1.0, 10.0</span>
<span class="sd">        &gt;&gt;&gt; states.esnowinz = 0.0, 0.0, -0.1</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_esnowinz_v1(0, 1.0))</span>
<span class="sd">        0.0</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_esnowinz_v1(1, 0.0))</span>
<span class="sd">        0.0</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_esnowinz_v1(2, -3.186337))</span>
<span class="sd">        -0.1</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">CPWasser</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">CPEis</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">STInz</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">SInz</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span>
        <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">temps</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">d_ice</span> <span class="o">=</span> <span class="n">fix</span><span class="o">.</span><span class="n">cpeis</span> <span class="o">*</span> <span class="n">sta</span><span class="o">.</span><span class="n">stinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="n">d_water</span> <span class="o">=</span> <span class="n">fix</span><span class="o">.</span><span class="n">cpwasser</span> <span class="o">*</span> <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">sinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">sta</span><span class="o">.</span><span class="n">stinz</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">temps</span> <span class="o">*</span> <span class="p">(</span><span class="n">d_ice</span> <span class="o">+</span> <span class="n">d_water</span><span class="p">)</span></div>


<div class="viewcode-block" id="Return_ESnow_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Return_ESnow_V1">[docs]</a><span class="k">class</span> <span class="nc">Return_ESnow_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate and return the thermal energy content of the snow layer for</span>
<span class="sd">    the given bulk temperature :cite:`ref-LARSIM`.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`temps \\cdot (WATS \\cdot CPEis + (WAeS-WATS)\\cdot CPWasser)`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(3)</span>
<span class="sd">        &gt;&gt;&gt; states.wats = 0.0, 0.5, 5.0</span>
<span class="sd">        &gt;&gt;&gt; states.waes = 0.0, 1.0, 10.0</span>
<span class="sd">        &gt;&gt;&gt; states.esnow = 0.0, 0.0, -0.1</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_esnow_v1(0, 1.0))</span>
<span class="sd">        0.0</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_esnow_v1(1, 0.0))</span>
<span class="sd">        0.0</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_esnow_v1(2, -3.186337))</span>
<span class="sd">        -0.1</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">CPWasser</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">CPEis</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">WATS</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">WAeS</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span>
        <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">temps</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">d_ice</span> <span class="o">=</span> <span class="n">fix</span><span class="o">.</span><span class="n">cpeis</span> <span class="o">*</span> <span class="n">sta</span><span class="o">.</span><span class="n">wats</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="n">d_water</span> <span class="o">=</span> <span class="n">fix</span><span class="o">.</span><span class="n">cpwasser</span> <span class="o">*</span> <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">sta</span><span class="o">.</span><span class="n">wats</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">temps</span> <span class="o">*</span> <span class="p">(</span><span class="n">d_ice</span> <span class="o">+</span> <span class="n">d_water</span><span class="p">)</span></div>


<div class="viewcode-block" id="Calc_TempS_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_TempS_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_TempS_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the average temperature of the snow layer.</span>

<span class="sd">    Method |Calc_TempS_V1| uses method |Return_TempS_V1| to calculate</span>
<span class="sd">    the snow temperature of all hydrological response units.</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(3)</span>
<span class="sd">        &gt;&gt;&gt; pwmax(2.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkor = -1.0</span>
<span class="sd">        &gt;&gt;&gt; states.wats = 0.0, 0.5, 5</span>
<span class="sd">        &gt;&gt;&gt; states.waes = 0.0, 1.0, 10</span>
<span class="sd">        &gt;&gt;&gt; states.esnow = 0.0, 0.0, -0.1</span>
<span class="sd">        &gt;&gt;&gt; model.calc_temps_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.temps</span>
<span class="sd">        temps(nan, 0.0, -3.186337)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Return_TempS_V1</span><span class="p">,)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">CPWasser</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">CPEis</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">WATS</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">WAeS</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">ESnow</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_aides</span><span class="o">.</span><span class="n">TempS</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">temps</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_temps_v1</span><span class="p">(</span><span class="n">k</span><span class="p">)</span></div>


<div class="viewcode-block" id="Calc_TZ_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_TZ_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_TZ_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the mean temperature in the top-layer of the soil</span>
<span class="sd">    :cite:`ref-LARSIM` (based on :cite:`ref-LUBW2006b`).</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      .. math::</span>
<span class="sd">        TZ = \\begin{cases}</span>
<span class="sd">        \\frac{EBdn}{2 \\cdot z \\cdot CG}</span>
<span class="sd">        &amp;|\\</span>
<span class="sd">        EBdn \\leq 0</span>
<span class="sd">        \\\\</span>
<span class="sd">        0</span>
<span class="sd">        &amp;|\\</span>
<span class="sd">        0 &lt; EBdn \\leq HeatOfFusion</span>
<span class="sd">        \\\\</span>
<span class="sd">        \\frac{EBdn - HeatOfFusion}{2 \\cdot z \\cdot CG}</span>
<span class="sd">        &amp;|\\</span>
<span class="sd">        HeatOfFusion &lt; EBdn</span>
<span class="sd">        \\end{cases}</span>

<span class="sd">    Examples:</span>

<span class="sd">        We set |TZ| to |numpy.nan| for all types of water areas:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(7)</span>
<span class="sd">        &gt;&gt;&gt; lnk(WASSER, FLUSS, SEE, WASSER, SEE, FLUSS, WASSER)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_tz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tz</span>
<span class="sd">        tz(nan, nan, nan, nan, nan, nan, nan)</span>

<span class="sd">        For all other land use types, the above basic equation applies:</span>

<span class="sd">        &gt;&gt;&gt; lnk(ACKER)</span>
<span class="sd">        &gt;&gt;&gt; derived.heatoffusion(26.72)</span>
<span class="sd">        &gt;&gt;&gt; states.ebdn(-10.0, -1.0, 0.0, 13.36, 26.72, 27.72, 36.72)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_tz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tz</span>
<span class="sd">        tz(-33.333333, -3.333333, 0.0, 0.0, 0.0, 3.333333, 33.333333)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">HeatOfFusion</span><span class="p">,)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">CG</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">EBdn</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TZ</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">WASSER</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">tz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">nan</span>
            <span class="k">elif</span> <span class="n">sta</span><span class="o">.</span><span class="n">ebdn</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">tz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">sta</span><span class="o">.</span><span class="n">ebdn</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">fix</span><span class="o">.</span><span class="n">z</span> <span class="o">*</span> <span class="n">fix</span><span class="o">.</span><span class="n">cg</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">sta</span><span class="o">.</span><span class="n">ebdn</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">der</span><span class="o">.</span><span class="n">heatoffusion</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">tz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">tz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">ebdn</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">der</span><span class="o">.</span><span class="n">heatoffusion</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">fix</span><span class="o">.</span><span class="n">z</span> <span class="o">*</span> <span class="n">fix</span><span class="o">.</span><span class="n">cg</span><span class="p">)</span></div>


<div class="viewcode-block" id="Calc_G_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_G_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_G_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate and return the &quot;MORECS&quot; soil heat flux (modified</span>
<span class="sd">    :cite:`ref-LARSIM`, based on :cite:`ref-Thompson1981`).</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      :math:`G = \\frac{PossibleSunshineDuration}</span>
<span class="sd">      {DailyPossibleSunshineDuration} \\cdot G_D</span>
<span class="sd">      + \\frac{(Hours - PossibleSunshineDuration)}</span>
<span class="sd">      {24-DailyPossibleSunshineDuration} \\cdot G_N`</span>

<span class="sd">      :math:`G_N = WG2Z - G_D`</span>

<span class="sd">      :math:`G_D = (0.3 - 0.03 \\cdot LAI) \\cdot DailyNetRadiation`</span>

<span class="sd">    The above equations are our interpretation on the relevant equations</span>
<span class="sd">    and explanations given in the LARSIM user manual.  :math:`G_D` is the</span>
<span class="sd">    daytime sum of the soil heat flux, which depends on the daily sum of</span>
<span class="sd">    net radiation and the leaf area index.  Curiously, |DailyNetRadiation|</span>
<span class="sd">    and :math:`G_D` become inversely related for leaf area index values</span>
<span class="sd">    larger than 10.  |WG2Z| defines the daily energy change of the soil</span>
<span class="sd">    layer, which is why we use its difference to :math:`G_D` for estimating</span>
<span class="sd">    the nighttime sum of the soil heat flux (:math:`G_N`).</span>

<span class="sd">    .. note::</span>

<span class="sd">       The sudden jumps of the soil heat flux calculated by method |Calc_G_V1|</span>
<span class="sd">       sometimes result in strange-looking evapotranspiration time-series.</span>
<span class="sd">       Hence, we do not use |Calc_G_V1| in any application model for now</span>
<span class="sd">       but leave it for further discussions and use the simplified method</span>
<span class="sd">       |Calc_G_V2| instead.</span>

<span class="sd">    Examples:</span>

<span class="sd">        To start as simple as possible, we perform the first test calculation</span>
<span class="sd">        for a daily simulation step size:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-05-30&quot;, &quot;2000-06-03&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>

<span class="sd">        We define five hydrological respose units, of which only the first</span>
<span class="sd">        four need further parameterisation, as method |Calc_G_V1| generally</span>
<span class="sd">        sets |G| to zero for all kinds of water areas:</span>

<span class="sd">        &gt;&gt;&gt; nhru(6)</span>
<span class="sd">        &gt;&gt;&gt; lnk(BODEN, OBSTB, OBSTB, LAUBW, NADELW, WASSER)</span>

<span class="sd">        We assign leaf area indices covering the usual range of values:</span>

<span class="sd">        &gt;&gt;&gt; lai.boden = 0.0</span>
<span class="sd">        &gt;&gt;&gt; lai.obstb = 5.0</span>
<span class="sd">        &gt;&gt;&gt; lai.laubw = 10.0</span>
<span class="sd">        &gt;&gt;&gt; lai.nadelw = 15.0</span>

<span class="sd">        We define a positive |WG2Z| value for May (on average, energy moves</span>
<span class="sd">        from the soil body to the soil surface) and a negative one for June</span>
<span class="sd">        (enery moves for the surface to the body):</span>

<span class="sd">        &gt;&gt;&gt; wg2z.may = 1.0</span>
<span class="sd">        &gt;&gt;&gt; wg2z.jun = -2.0</span>

<span class="sd">        The following derived parameters need to be updated:</span>

<span class="sd">        &gt;&gt;&gt; derived.moy.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.hours.update()</span>

<span class="sd">        For a daily simulation step size, the values of</span>
<span class="sd">        |PossibleSunshineDuration| (of the current simulation step) and</span>
<span class="sd">        |DailyPossibleSunshineDuration| must be identical:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.possiblesunshineduration = 14.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailypossiblesunshineduration = 14.0</span>

<span class="sd">        We set |DailyNetRadiation| to 10 MJ/m² for most response units,</span>
<span class="sd">        except one of the |ACKER| ones:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.dailynetradiation = 10.0, 10.0, -10.0, 10.0, 10.0, 10.0</span>

<span class="sd">        For the given daily simulation step size, method |Calc_G_V1|</span>
<span class="sd">        calculates soil surface fluxes identical with the |WG2Z| value</span>
<span class="sd">        of the respective month:</span>

<span class="sd">        &gt;&gt;&gt; model.idx_sim = pub.timegrids.init[&quot;2000-05-31&quot;]</span>
<span class="sd">        &gt;&gt;&gt; model.calc_g_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.g</span>
<span class="sd">        g(1.0, 1.0, 1.0, 1.0, 1.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; model.idx_sim = pub.timegrids.init[&quot;2000-06-01&quot;]</span>
<span class="sd">        &gt;&gt;&gt; model.calc_g_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.g</span>
<span class="sd">        g(-2.0, -2.0, -2.0, -2.0, -2.0, 0.0)</span>

<span class="sd">        Next, we switch to an hourly step size and focus on May:</span>

<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-05-30 00:00&quot;, &quot;2000-06-02 00:00&quot;, &quot;1h&quot;</span>
<span class="sd">        &gt;&gt;&gt; model.idx_sim = pub.timegrids.init[&quot;2000-05-31&quot;]</span>
<span class="sd">        &gt;&gt;&gt; derived.moy.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.hours.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.days.update()</span>

<span class="sd">        During daytime (when the possible sunshine duration is one hour),</span>
<span class="sd">        the soil surface flux is negative for net radiation values larger</span>
<span class="sd">        one and for leaf area index values smaller than ten (see response</span>
<span class="sd">        units one and two).  Negative net radiation (response unit three)</span>
<span class="sd">        ar leaf area indices larger then ten (response unit five) result</span>
<span class="sd">        in positive soil surface fluxes:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.possiblesunshineduration = 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_g_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.g</span>
<span class="sd">        g(-0.214286, -0.107143, 0.107143, 0.0, 0.107143, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; day = fluxes.g.values.copy()</span>

<span class="sd">        The nighttime soils surface fluxes (which we calculate through</span>
<span class="sd">        setting |PossibleSunshineDuration| to zero) somehow compensate the</span>
<span class="sd">        daytime ones:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.possiblesunshineduration = 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_g_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.g</span>
<span class="sd">        g(0.4, 0.25, -0.05, 0.1, -0.05, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; night = fluxes.g.values.copy()</span>

<span class="sd">        This compensation enforces that the daily sum the surface flux agrees</span>
<span class="sd">        with the actual value of |WG2Z|, which we confirm by the following</span>
<span class="sd">        test calculation:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import print_values</span>
<span class="sd">        &gt;&gt;&gt; print_values(day*fluxes.dailypossiblesunshineduration +</span>
<span class="sd">        ...              night*(24-fluxes.dailypossiblesunshineduration))</span>
<span class="sd">        1.0, 1.0, 1.0, 1.0, 1.0, 0.0</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">LAI</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">WG2Z</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">MOY</span><span class="p">,</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">Hours</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">PossibleSunshineDuration</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">DailyPossibleSunshineDuration</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">DailyNetRadiation</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">G</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">,</span> <span class="n">WASSER</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">g</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">moy</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">idx_sim</span><span class="p">]</span>
                <span class="n">d_cr</span> <span class="o">=</span> <span class="mf">0.3</span> <span class="o">-</span> <span class="mf">0.03</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">lai</span><span class="p">[</span><span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">idx</span><span class="p">]</span>
                <span class="n">d_gd</span> <span class="o">=</span> <span class="o">-</span><span class="n">d_cr</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">dailynetradiation</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">d_gn</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">wg2z</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">-</span> <span class="n">d_gd</span>
                <span class="n">d_gd_h</span> <span class="o">=</span> <span class="n">d_gd</span> <span class="o">/</span> <span class="n">flu</span><span class="o">.</span><span class="n">dailypossiblesunshineduration</span>
                <span class="n">d_gn_h</span> <span class="o">=</span> <span class="n">d_gn</span> <span class="o">/</span> <span class="p">(</span><span class="mf">24.0</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">dailypossiblesunshineduration</span><span class="p">)</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">g</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">possiblesunshineduration</span> <span class="o">*</span> <span class="n">d_gd_h</span>
                    <span class="o">+</span> <span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">hours</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">possiblesunshineduration</span><span class="p">)</span> <span class="o">*</span> <span class="n">d_gn_h</span>
                <span class="p">)</span></div>


<div class="viewcode-block" id="Calc_G_V2"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_G_V2">[docs]</a><span class="k">class</span> <span class="nc">Calc_G_V2</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Take the actual daily soil heat flux from parameter |WG2Z|.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      :math:`G = WG2Z`</span>

<span class="sd">    .. note::</span>

<span class="sd">       Method |Calc_G_V2| workaround.  We might remove it, as soon as the</span>
<span class="sd">       shortcomings of method |Calc_G_V1| are fixed.</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-05-30 00:00&quot;, &quot;2000-06-02 00:00&quot;, &quot;1h&quot;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(4)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER, WASSER, FLUSS, SEE)</span>
<span class="sd">        &gt;&gt;&gt; wg2z.may = 1.2</span>
<span class="sd">        &gt;&gt;&gt; wg2z.jun = -2.4</span>
<span class="sd">        &gt;&gt;&gt; derived.moy.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.days.update()</span>
<span class="sd">        &gt;&gt;&gt; model.idx_sim = pub.timegrids.init[&quot;2000-05-31 23:00&quot;]</span>
<span class="sd">        &gt;&gt;&gt; model.calc_g_v2()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.g</span>
<span class="sd">        g(0.05, 0.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; model.idx_sim = pub.timegrids.init[&quot;2000-06-01 00:00&quot;]</span>
<span class="sd">        &gt;&gt;&gt; model.calc_g_v2()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.g</span>
<span class="sd">        g(-0.1, 0.0, 0.0, 0.0)</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">WG2Z</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">MOY</span><span class="p">,</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">Days</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">G</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">,</span> <span class="n">WASSER</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">g</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">g</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">days</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">wg2z</span><span class="p">[</span><span class="n">der</span><span class="o">.</span><span class="n">moy</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">idx_sim</span><span class="p">]]</span></div>


<div class="viewcode-block" id="Return_WG_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Return_WG_V1">[docs]</a><span class="k">class</span> <span class="nc">Return_WG_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate and return the &quot;dynamic&quot; soil heat flux :cite:`ref-LARSIM`.</span>

<span class="sd">    The soil heat flux |WG| depends on the temperature gradient between</span>
<span class="sd">    depth z and the surface.  We set the soil surface temperature to the air</span>
<span class="sd">    temperature for snow-free conditions and otherwise to the average</span>
<span class="sd">    temperature of the snow layer.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      .. math::</span>
<span class="sd">        \\begin{cases}</span>
<span class="sd">        LambdaG \\cdot \\frac{TZ-TempS}{Z}</span>
<span class="sd">        &amp;|\\</span>
<span class="sd">        WAeS &gt; 0</span>
<span class="sd">        \\\\</span>
<span class="sd">        LambdaG \\cdot \\frac{TZ-TKor}{Z}</span>
<span class="sd">        &amp;|\\</span>
<span class="sd">        WAeS = 0</span>
<span class="sd">        \\end{cases}</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(2)</span>
<span class="sd">        &gt;&gt;&gt; fixed.lambdag.restore()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tz = 2.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkor = 10.0</span>
<span class="sd">        &gt;&gt;&gt; states.waes = 0.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; aides.temps = nan, -1.0</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_wg_v1(0))</span>
<span class="sd">        -0.1728</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_wg_v1(1))</span>
<span class="sd">        0.0648</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">LambdaG</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TZ</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TKor</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">WAeS</span><span class="p">,</span>
        <span class="n">lland_aides</span><span class="o">.</span><span class="n">TempS</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span>
        <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">d_temp</span> <span class="o">=</span> <span class="n">aid</span><span class="o">.</span><span class="n">temps</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d_temp</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">tkor</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">fix</span><span class="o">.</span><span class="n">lambdag</span> <span class="o">*</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">tz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">d_temp</span><span class="p">)</span> <span class="o">/</span> <span class="n">fix</span><span class="o">.</span><span class="n">z</span></div>


<div class="viewcode-block" id="Calc_WG_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_WG_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_WG_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the soil heat flux.</span>

<span class="sd">    Method |Calc_WG_V1| uses method |Return_WG_V1| to calculate the</span>
<span class="sd">    &quot;dynamic&quot; soil heat flux for all hydrological response units that</span>
<span class="sd">    do not represent water areas.</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(5)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER, VERS, WASSER, FLUSS, SEE)</span>
<span class="sd">        &gt;&gt;&gt; fixed.lambdag.restore()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tz = 2.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkor = 10.0</span>
<span class="sd">        &gt;&gt;&gt; states.waes = 0.0, 1.0, 0.0, 0.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; aides.temps = nan, -1.0, nan, nan, nan</span>
<span class="sd">        &gt;&gt;&gt; model.calc_wg_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wg</span>
<span class="sd">        wg(-0.1728, 0.0648, 0.0, 0.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Return_WG_V1</span><span class="p">,)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">LambdaG</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TZ</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TKor</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">WAeS</span><span class="p">,</span>
        <span class="n">lland_aides</span><span class="o">.</span><span class="n">TempS</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WG</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">,</span> <span class="n">WASSER</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">wg</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">wg</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_wg_v1</span><span class="p">(</span><span class="n">k</span><span class="p">)</span></div>


<div class="viewcode-block" id="Update_EBdn_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Update_EBdn_V1">[docs]</a><span class="k">class</span> <span class="nc">Update_EBdn_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Update the thermal energy content of the upper soil layer</span>
<span class="sd">    :cite:`ref-LARSIM`.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`\\frac{dEBdn}{dt} = WG2Z \\cdot Days - WG`</span>

<span class="sd">    Example:</span>

<span class="sd">        Water areas do not posses a soil energy content. For all other</span>
<span class="sd">        landuse types, the above equation applies:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(6)</span>
<span class="sd">        &gt;&gt;&gt; lnk(WASSER, FLUSS, SEE, ACKER, ACKER, ACKER)</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2019-04-29&quot;, &quot;2019-05-03&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; derived.moy.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.seconds.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.days.update()</span>
<span class="sd">        &gt;&gt;&gt; wg2z.apr = -0.03</span>
<span class="sd">        &gt;&gt;&gt; wg2z.may = -0.04</span>
<span class="sd">        &gt;&gt;&gt; states.ebdn = 0.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wg = 0.0, 0.0, 0.0, 0.5, 1.0, 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.idx_sim = 1</span>
<span class="sd">        &gt;&gt;&gt; model.update_ebdn_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.ebdn</span>
<span class="sd">        ebdn(0.0, 0.0, 0.0, -0.53, -1.03, -2.03)</span>
<span class="sd">        &gt;&gt;&gt; model.idx_sim = 2</span>
<span class="sd">        &gt;&gt;&gt; model.update_ebdn_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.ebdn</span>
<span class="sd">        ebdn(0.0, 0.0, 0.0, -1.07, -2.07, -4.07)</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">WG2Z</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">MOY</span><span class="p">,</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">Days</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WG</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">EBdn</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">WASSER</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">):</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">ebdn</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">ebdn</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">con</span><span class="o">.</span><span class="n">wg2z</span><span class="p">[</span><span class="n">der</span><span class="o">.</span><span class="n">moy</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">idx_sim</span><span class="p">]]</span> <span class="o">*</span> <span class="n">der</span><span class="o">.</span><span class="n">days</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">wg</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>


<div class="viewcode-block" id="Return_WSensInz_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Return_WSensInz_V1">[docs]</a><span class="k">class</span> <span class="nc">Return_WSensInz_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate and return the sensible heat flux between the intercepted snow and</span>
<span class="sd">    the atmosphere.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`(Turb0 + Turb1 \cdot WindSpeed2m) \cdot (TempSInz - TKor)`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(2)</span>
<span class="sd">        &gt;&gt;&gt; turb0(0.1728)</span>
<span class="sd">        &gt;&gt;&gt; turb1(0.1728)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkor = -2.0, -1.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.reducedwindspeed2m = 3.0</span>
<span class="sd">        &gt;&gt;&gt; aides.tempsinz = -5.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_wsensinz_v1(0))</span>
<span class="sd">        -0.0864</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_wsensinz_v1(1))</span>
<span class="sd">        0.0288</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Turb0</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Turb1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TKor</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ReducedWindSpeed2m</span><span class="p">,</span>
        <span class="n">lland_aides</span><span class="o">.</span><span class="n">TempSInz</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span>
        <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">turb0</span> <span class="o">+</span> <span class="n">con</span><span class="o">.</span><span class="n">turb1</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">reducedwindspeed2m</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">tempsinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">tkor</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Return_WSensSnow_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Return_WSensSnow_V1">[docs]</a><span class="k">class</span> <span class="nc">Return_WSensSnow_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate and return the sensible heat flux of the snow surface</span>
<span class="sd">    :cite:`ref-LARSIM`.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`(Turb0 + Turb1 \\cdot WindSpeed2m) \\cdot (TempSSurface - TKor)`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(2)</span>
<span class="sd">        &gt;&gt;&gt; turb0(0.1728)</span>
<span class="sd">        &gt;&gt;&gt; turb1(0.1728)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkor = -2.0, -1.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tempssurface = -5.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.reducedwindspeed2m = 3.0</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_wsenssnow_v1(0))</span>
<span class="sd">        -0.0864</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_wsenssnow_v1(1))</span>
<span class="sd">        0.0288</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Turb0</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Turb1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TKor</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TempSSurface</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ReducedWindSpeed2m</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span>
        <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">turb0</span> <span class="o">+</span> <span class="n">con</span><span class="o">.</span><span class="n">turb1</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">reducedwindspeed2m</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">tempssurface</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">tkor</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Return_WLatInz_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Return_WLatInz_V1">[docs]</a><span class="k">class</span> <span class="nc">Return_WLatInz_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate and return the latent heat flux between the surface of the</span>
<span class="sd">    intercepted snow and the atmosphere.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`(Turb0 + Turb1 \cdot ReducedWindSpeed2m) \cdot</span>
<span class="sd">      PsiInv \cdot (SaturationVapourPressureInz - ActualVapourPressure))`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(2)</span>
<span class="sd">        &gt;&gt;&gt; turb0(0.1728)</span>
<span class="sd">        &gt;&gt;&gt; turb1(0.1728)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.reducedwindspeed2m = 3.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.saturationvapourpressureinz = 0.4, 0.8</span>
<span class="sd">        &gt;&gt;&gt; fluxes.actualvapourpressure = .6108</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_wlatinz_v1(0))</span>
<span class="sd">        -0.10685</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_wlatinz_v1(1))</span>
<span class="sd">        0.095902</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">Turb0</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">Turb1</span><span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fixed</span><span class="o">.</span><span class="n">PsyInv</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ReducedWindSpeed2m</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SaturationVapourPressureInz</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ActualVapourPressure</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span>
        <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">turb0</span> <span class="o">+</span> <span class="n">con</span><span class="o">.</span><span class="n">turb1</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">reducedwindspeed2m</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="o">*</span> <span class="n">fix</span><span class="o">.</span><span class="n">psyinv</span>
            <span class="o">*</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">saturationvapourpressureinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">actualvapourpressure</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Return_WLatSnow_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Return_WLatSnow_V1">[docs]</a><span class="k">class</span> <span class="nc">Return_WLatSnow_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate and return the latent heat flux of the snow surface</span>
<span class="sd">    :cite:`ref-LARSIM`.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`(Turb0 + Turb1 \\cdot ReducedWindSpeed2m) \\cdot</span>
<span class="sd">      PsiInv \\cdot (SaturationVapourPressureSnow - ActualVapourPressure))`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(2)</span>
<span class="sd">        &gt;&gt;&gt; turb0(0.1728)</span>
<span class="sd">        &gt;&gt;&gt; turb1(0.1728)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.reducedwindspeed2m = 3.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.saturationvapourpressuresnow = 0.4, 0.8</span>
<span class="sd">        &gt;&gt;&gt; fluxes.actualvapourpressure = .6108</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_wlatsnow_v1(0))</span>
<span class="sd">        -0.10685</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_wlatsnow_v1(1))</span>
<span class="sd">        0.095902</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">Turb0</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">Turb1</span><span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fixed</span><span class="o">.</span><span class="n">PsyInv</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ReducedWindSpeed2m</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SaturationVapourPressureSnow</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ActualVapourPressure</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span>
        <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">turb0</span> <span class="o">+</span> <span class="n">con</span><span class="o">.</span><span class="n">turb1</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">reducedwindspeed2m</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="o">*</span> <span class="n">fix</span><span class="o">.</span><span class="n">psyinv</span>
            <span class="o">*</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">saturationvapourpressuresnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">actualvapourpressure</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Return_WSurf_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Return_WSurf_V1">[docs]</a><span class="k">class</span> <span class="nc">Return_WSurf_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate and return the snow surface heat flux :cite:`ref-LARSIM`</span>
<span class="sd">    (based on :cite:`ref-LUBW2006b`).</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`KTSchnee \\cdot (TempS - TempSSurface)`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(1)</span>
<span class="sd">        &gt;&gt;&gt; ktschnee(0.432)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tempssurface = -3.0</span>
<span class="sd">        &gt;&gt;&gt; aides.temps = -2.0</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_wsurf_v1(0))</span>
<span class="sd">        0.018</span>

<span class="sd">        Method |Return_WSurf_V1| explicitely supports infinite</span>
<span class="sd">        |KTSchnee| values:</span>

<span class="sd">        &gt;&gt;&gt; ktschnee(inf)</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_wsurf_v1(0))</span>
<span class="sd">        inf</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">KTSchnee</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_aides</span><span class="o">.</span><span class="n">TempS</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TempSSurface</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span>
        <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">if</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">ktschnee</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">inf</span>
        <span class="k">return</span> <span class="n">con</span><span class="o">.</span><span class="n">ktschnee</span> <span class="o">*</span> <span class="p">(</span><span class="n">aid</span><span class="o">.</span><span class="n">temps</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">tempssurface</span><span class="p">[</span><span class="n">k</span><span class="p">])</span></div>


<div class="viewcode-block" id="Return_NetRadiation_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Return_NetRadiation_V1">[docs]</a><span class="k">class</span> <span class="nc">Return_NetRadiation_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate and return the total net radiation.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`netshortwaveradiation - netlongwaveradiation`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_netradiation_v1(3.0, 2.0))</span>
<span class="sd">        1.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span>
        <span class="n">netshortwaveradiation</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">netlongwaveradiation</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">netshortwaveradiation</span> <span class="o">-</span> <span class="n">netlongwaveradiation</span></div>


<div class="viewcode-block" id="Calc_NetRadiation_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_NetRadiation_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_NetRadiation_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the total net radiation.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`NetRadiation = Return\\_NetRadiation\\_V1(</span>
<span class="sd">      NetShortwaveRadiation, DailyNetLongwaveRadiation \\cdot Days)`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(1)</span>
<span class="sd">        &gt;&gt;&gt; derived.days(0.5)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.netshortwaveradiation = 3.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailynetlongwaveradiation = 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_netradiation_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.netradiation</span>
<span class="sd">        netradiation(2.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Return_NetRadiation_V1</span><span class="p">,)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">Days</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NetShortwaveRadiation</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">DailyNetLongwaveRadiation</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NetRadiation</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">netradiation</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_netradiation_v1</span><span class="p">(</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">netshortwaveradiation</span><span class="p">[</span><span class="n">k</span><span class="p">],</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">dailynetlongwaveradiation</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">der</span><span class="o">.</span><span class="n">days</span><span class="p">,</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="Calc_DailyNetRadiation_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_DailyNetRadiation_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_DailyNetRadiation_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the daily total net radiation for snow-free land surfaces.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`NetRadiation = Return\\_NetRadiation\\_V1(</span>
<span class="sd">      DailyDailyNetShortwaveRadiation, DailyNetLongwaveRadiation)`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(1)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailynetshortwaveradiation = 3.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailynetlongwaveradiation = 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_dailynetradiation_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailynetradiation</span>
<span class="sd">        dailynetradiation(1.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Return_NetRadiation_V1</span><span class="p">,)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">DailyNetLongwaveRadiation</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">DailyNetShortwaveRadiation</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">DailyNetRadiation</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">dailynetradiation</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_netradiation_v1</span><span class="p">(</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">dailynetshortwaveradiation</span><span class="p">[</span><span class="n">k</span><span class="p">],</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">dailynetlongwaveradiation</span><span class="p">[</span><span class="n">k</span><span class="p">],</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="Return_EnergyGainSnowSurface_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Return_EnergyGainSnowSurface_V1">[docs]</a><span class="k">class</span> <span class="nc">Return_EnergyGainSnowSurface_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate and return the net energy gain of the snow surface</span>
<span class="sd">    (:cite:`ref-LARSIM` :cite:`ref-LUBW2006b`, modified).</span>

<span class="sd">    As surface cannot store any energy, method |Return_EnergyGainSnowSurface_V1|</span>
<span class="sd">    returns zero if one supplies it with the correct temperature of the</span>
<span class="sd">    snow surface.  Hence, this methods provides a means to find this</span>
<span class="sd">    &quot;correct&quot; temperature via root finding algorithms.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`WSurf(tempssurface) +</span>
<span class="sd">      NetshortwaveRadiation - NetlongwaveRadiation(tempssurface) -</span>
<span class="sd">      WSensSnow(tempssurface) - WLatSnow(tempssurface)`</span>

<span class="sd">    Example:</span>

<span class="sd">        Method |Return_EnergyGainSnowSurface_V1| relies on multiple</span>
<span class="sd">        submethods with different requirements.  Hence, we first need to</span>
<span class="sd">        specify a lot of input data (see the documentation on the</span>
<span class="sd">        different submethods for further information):</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(1)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER)</span>
<span class="sd">        &gt;&gt;&gt; turb0(0.1728)</span>
<span class="sd">        &gt;&gt;&gt; turb1(0.1728)</span>
<span class="sd">        &gt;&gt;&gt; ktschnee(0.432)</span>
<span class="sd">        &gt;&gt;&gt; derived.days.update()</span>
<span class="sd">        &gt;&gt;&gt; inputs.relativehumidity = 60.0</span>
<span class="sd">        &gt;&gt;&gt; states.waes = 1.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkor = -3.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.reducedwindspeed2m = 3.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.actualvapourpressure = 0.29</span>
<span class="sd">        &gt;&gt;&gt; fluxes.netshortwaveradiationsnow = 2.0</span>
<span class="sd">        &gt;&gt;&gt; derived.nmblogentries.update()</span>
<span class="sd">        &gt;&gt;&gt; aides.temps = -2.0</span>
<span class="sd">        &gt;&gt;&gt; aides.rlatm = 17.581556544</span>

<span class="sd">        Under the defined conditions and for a snow surface temperature of</span>
<span class="sd">        -4 °C, the net energy gain would be negative:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; model.idx_hru = 0</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_energygainsnowsurface_v1(-4.0))</span>
<span class="sd">        -6.565618</span>

<span class="sd">        As a side-effect, method |Return_EnergyGainSnowSurface_V1| calculates</span>
<span class="sd">        the following flux sequences for the given snow surface temperature:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.saturationvapourpressuresnow</span>
<span class="sd">        saturationvapourpressuresnow(0.453913)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.netlongwaveradiationsnow</span>
<span class="sd">        netlongwaveradiationsnow(8.126801)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.netradiationsnow</span>
<span class="sd">        netradiationsnow(-6.126801)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wsenssnow</span>
<span class="sd">        wsenssnow(-0.6912)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wlatsnow</span>
<span class="sd">        wlatsnow(1.994016)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wsurf</span>
<span class="sd">        wsurf(0.864)</span>

<span class="sd">    Technical checks:</span>

<span class="sd">        Note that method |Return_EnergyGainSnowSurface_V1| calculates the</span>
<span class="sd">        value of sequence |SaturationVapourPressureSnow| before its submethod</span>
<span class="sd">        |Return_WLatSnow_V1| uses it and that it assigns the given value to</span>
<span class="sd">        sequence |TempSSurface| before its submethods |Return_WSensSnow_V1|,</span>
<span class="sd">        |Return_NetLongwaveRadiationSnow_V1|, and |Return_WSurf_V1| use it:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.core.testtools import check_selectedvariables</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland.lland_model import (</span>
<span class="sd">        ...     Return_EnergyGainSnowSurface_V1)</span>
<span class="sd">        &gt;&gt;&gt; print(check_selectedvariables(Return_EnergyGainSnowSurface_V1))</span>
<span class="sd">        Possibly missing (REQUIREDSEQUENCES):</span>
<span class="sd">            Return_WLatSnow_V1: SaturationVapourPressureSnow</span>
<span class="sd">            Return_WSensSnow_V1: TempSSurface</span>
<span class="sd">            Return_NetLongwaveRadiationSnow_V1: TempSSurface</span>
<span class="sd">            Return_WSurf_V1: TempSSurface</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Return_SaturationVapourPressure_V1</span><span class="p">,</span>
        <span class="n">Return_WLatSnow_V1</span><span class="p">,</span>
        <span class="n">Return_WSensSnow_V1</span><span class="p">,</span>
        <span class="n">Return_NetLongwaveRadiationSnow_V1</span><span class="p">,</span>
        <span class="n">Return_NetRadiation_V1</span><span class="p">,</span>
        <span class="n">Return_WSurf_V1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">KTSchnee</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Turb0</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Turb1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">MOY</span><span class="p">,</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">Days</span><span class="p">,</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">Fr</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">PsyInv</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">Sigma</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NetShortwaveRadiationSnow</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TKor</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ReducedWindSpeed2m</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ActualVapourPressure</span><span class="p">,</span>
        <span class="n">lland_aides</span><span class="o">.</span><span class="n">TempS</span><span class="p">,</span>
        <span class="n">lland_aides</span><span class="o">.</span><span class="n">RLAtm</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TempSSurface</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SaturationVapourPressureSnow</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WSensSnow</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WLatSnow</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NetLongwaveRadiationSnow</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NetRadiationSnow</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WSurf</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span>
        <span class="n">tempssurface</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>

        <span class="n">k</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">idx_hru</span>

        <span class="n">flu</span><span class="o">.</span><span class="n">tempssurface</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">tempssurface</span>

        <span class="n">flu</span><span class="o">.</span><span class="n">saturationvapourpressuresnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_saturationvapourpressure_v1</span><span class="p">(</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">tempssurface</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">wlatsnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_wlatsnow_v1</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">wsenssnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_wsenssnow_v1</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">netlongwaveradiationsnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_netlongwaveradiationsnow_v1</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">netradiationsnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_netradiation_v1</span><span class="p">(</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">netshortwaveradiationsnow</span><span class="p">[</span><span class="n">k</span><span class="p">],</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">netlongwaveradiationsnow</span><span class="p">[</span><span class="n">k</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">wsurf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_wsurf_v1</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">wsurf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">netradiationsnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">wsenssnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">wlatsnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Return_TempSSurface_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Return_TempSSurface_V1">[docs]</a><span class="k">class</span> <span class="nc">Return_TempSSurface_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Determine and return the snow surface temperature (:cite:`ref-LARSIM`</span>
<span class="sd">    based on :cite:`ref-LUBW2006b`, modified).</span>

<span class="sd">    |Return_TempSSurface_V1| needs to determine the snow surface temperature</span>
<span class="sd">    via iteration.  Therefore, it uses the class |PegasusTempSSurface|</span>
<span class="sd">    which searches the root of the net energy gain of the snow surface</span>
<span class="sd">    defined by method |Return_EnergyGainSnowSurface_V1|.</span>

<span class="sd">    For snow-free conditions, method |Return_TempSSurface_V1| sets the value</span>
<span class="sd">    of |TempSSurface| to |numpy.nan| and the values of |WSensSnow|,</span>
<span class="sd">    |WLatSnow|, and |WSurf| to zero.  For snow conditions, the side-effects</span>
<span class="sd">    discussed in the documentation on method |Return_EnergyGainSnowSurface_V1|</span>
<span class="sd">    apply.</span>

<span class="sd">    Example:</span>

<span class="sd">        We reuse the configuration of the documentation on method</span>
<span class="sd">        |Return_EnergyGainSnowSurface_V1|, except that we prepare six</span>
<span class="sd">        hydrological response units and calculate their snow surface temperature:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(6)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER)</span>
<span class="sd">        &gt;&gt;&gt; turb0(0.1728)</span>
<span class="sd">        &gt;&gt;&gt; turb1(0.1728)</span>
<span class="sd">        &gt;&gt;&gt; ktschnee(0.432)</span>
<span class="sd">        &gt;&gt;&gt; derived.nmblogentries.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.days.update()</span>
<span class="sd">        &gt;&gt;&gt; inputs.relativehumidity = 60.0</span>
<span class="sd">        &gt;&gt;&gt; states.waes = 0.0, 1.0, 1.0, 1.0, 1.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkor = -3.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.reducedwindspeed2m = 3.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.actualvapourpressure = 0.29</span>
<span class="sd">        &gt;&gt;&gt; fluxes.netshortwaveradiationsnow = 1.0, 1.0, 2.0, 2.0, 2.0, 20.0</span>
<span class="sd">        &gt;&gt;&gt; aides.temps = nan, -2.0, -2.0, -50.0, -200.0, -2.0</span>
<span class="sd">        &gt;&gt;&gt; aides.rlatm = 17.581556544</span>
<span class="sd">        &gt;&gt;&gt; for hru in range(6):</span>
<span class="sd">        ...     _ = model.return_tempssurface_v1(hru)</span>

<span class="sd">        For the first, snow-free response unit, we cannot define a reasonable</span>
<span class="sd">        snow surface temperature, of course:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.tempssurface[0]</span>
<span class="sd">        nan</span>

<span class="sd">        Comparing response units two and three shows that a moderate increase</span>
<span class="sd">        in short wave radiation is compensated by a moderate increase in snow</span>
<span class="sd">        surface temperature:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import print_values</span>
<span class="sd">        &gt;&gt;&gt; print_values(fluxes.tempssurface[1:3])</span>
<span class="sd">        -8.064938, -7.512933</span>

<span class="sd">        To demonstrate the robustness of the implemented approach, response</span>
<span class="sd">        units three to five show the extreme decrease in surface temperature</span>
<span class="sd">        due to an even more extrem decrease in the bulk temperature of the</span>
<span class="sd">        snow layer:</span>

<span class="sd">        &gt;&gt;&gt; print_values(fluxes.tempssurface[2:5])</span>
<span class="sd">        -7.512933, -19.826442, -66.202324</span>

<span class="sd">        The sixths response unit comes with a very high net radiation</span>
<span class="sd">        to clarify that the allowed maximum value of the snow surface temperature</span>
<span class="sd">        is 0°C.  Hence, the snow temperature gradient might actually be too</span>
<span class="sd">        small for conducting all available energy deeper into the snow layer.</span>
<span class="sd">        In reality, only the topmost snow layer would melt in such a situation.</span>
<span class="sd">        Here, we do not differentiate between melting processes in different</span>
<span class="sd">        layers and thus add the potential energy excess at the snow surface to</span>
<span class="sd">        |WSurf|:</span>

<span class="sd">        &gt;&gt;&gt; print_values(fluxes.tempssurface[5:])</span>
<span class="sd">        0.0</span>

<span class="sd">        As to be expected, the energy fluxes of the snow surface neutralise</span>
<span class="sd">        each other (within the defined numerical accuracy):</span>

<span class="sd">        &gt;&gt;&gt; print_values(fluxes.netradiationsnow -</span>
<span class="sd">        ...              fluxes.wsenssnow -</span>
<span class="sd">        ...              fluxes.wlatsnow +</span>
<span class="sd">        ...              fluxes.wsurf)</span>
<span class="sd">        nan, 0.0, 0.0, 0.0, 0.0, 0.0</span>

<span class="sd">        Through setting parameter |KTSchnee| to |numpy.inf|, we disable</span>
<span class="sd">        the iterative search for the correct surface temperature.  Instead,</span>
<span class="sd">        method |Return_TempSSurface_V1| simply uses the bulk temperature of</span>
<span class="sd">        the snow layer as its surface temperature and sets |WSurf| so that</span>
<span class="sd">        the energy gain of the snow surface is zero:</span>

<span class="sd">        &gt;&gt;&gt; ktschnee(inf)</span>
<span class="sd">        &gt;&gt;&gt; for hru in range(6):</span>
<span class="sd">        ...     _ = model.return_tempssurface_v1(hru)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tempssurface</span>
<span class="sd">        tempssurface(nan, -2.0, -2.0, -50.0, -200.0, -2.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wsurf</span>
<span class="sd">        wsurf(0.0, 11.476385, 10.476385, -43.376447, -159.135575, -7.523615)</span>
<span class="sd">        &gt;&gt;&gt; print_values(fluxes.netradiationsnow -</span>
<span class="sd">        ...              fluxes.wsenssnow -</span>
<span class="sd">        ...              fluxes.wlatsnow +</span>
<span class="sd">        ...              fluxes.wsurf)</span>
<span class="sd">        nan, 0.0, 0.0, 0.0, 0.0, 0.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Return_EnergyGainSnowSurface_V1</span><span class="p">,)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Turb0</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Turb1</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">KTSchnee</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">MOY</span><span class="p">,</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">Days</span><span class="p">,</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">Fr</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">Sigma</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">PsyInv</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NetShortwaveRadiationSnow</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TKor</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ReducedWindSpeed2m</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ActualVapourPressure</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">WAeS</span><span class="p">,</span>
        <span class="n">lland_aides</span><span class="o">.</span><span class="n">TempS</span><span class="p">,</span>
        <span class="n">lland_aides</span><span class="o">.</span><span class="n">RLAtm</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TempSSurface</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SaturationVapourPressureSnow</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WSensSnow</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WLatSnow</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NetLongwaveRadiationSnow</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NetRadiationSnow</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WSurf</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span>
        <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">ktschnee</span><span class="p">):</span>
                <span class="n">model</span><span class="o">.</span><span class="n">idx_hru</span> <span class="o">=</span> <span class="n">k</span>
                <span class="n">model</span><span class="o">.</span><span class="n">return_energygainsnowsurface_v1</span><span class="p">(</span><span class="n">aid</span><span class="o">.</span><span class="n">temps</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">wsurf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">wsenssnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">wlatsnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">netradiationsnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">model</span><span class="o">.</span><span class="n">idx_hru</span> <span class="o">=</span> <span class="n">k</span>
                <span class="n">model</span><span class="o">.</span><span class="n">pegasustempssurface</span><span class="o">.</span><span class="n">find_x</span><span class="p">(</span><span class="o">-</span><span class="mf">50.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">100.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1e-8</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">wsurf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_energygainsnowsurface_v1</span><span class="p">(</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">tempssurface</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">tempssurface</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">nan</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">saturationvapourpressuresnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">wsenssnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">wlatsnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">wsurf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">return</span> <span class="n">flu</span><span class="o">.</span><span class="n">tempssurface</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>


<div class="viewcode-block" id="Return_WSurfInz_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Return_WSurfInz_V1">[docs]</a><span class="k">class</span> <span class="nc">Return_WSurfInz_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate and return the intercepted snow heat flux |WSurfInz|.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`WSurfInz = WSensInz + WLatInz - NetRadiationInz`</span>

<span class="sd">    Note that method |Return_WSurfInz_V1| calls a number of submethods and uses</span>
<span class="sd">    their results to update the corresponding sequences.  When calculating</span>
<span class="sd">    |SaturationVapourPressureInz| calls method |Return_SaturationVapourPressure_V1|,</span>
<span class="sd">    as follows:</span>

<span class="sd">      :math:`SaturationVapourPressureInz = Return_SaturationVapourPressure_V1(</span>
<span class="sd">      max(TempSInz, TKor)`</span>

<span class="sd">    The reason for using the maximum of the intercepted snow temperature (|TempSInz|)</span>
<span class="sd">    and the air temperature (|TKor|) is to increase the evaporation of intercepted</span>
<span class="sd">    snow (|EvSInz|). See :cite:`ref-LARSIM`, section 3.4.6.1, for a more detailed</span>
<span class="sd">    discussion.</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-01&quot;, &quot;2000-01-02&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(1)</span>
<span class="sd">        &gt;&gt;&gt; lnk(LAUBW)</span>
<span class="sd">        &gt;&gt;&gt; turb0(0.1728)</span>
<span class="sd">        &gt;&gt;&gt; turb1(0.1728)</span>
<span class="sd">        &gt;&gt;&gt; derived.fr(0.5)</span>
<span class="sd">        &gt;&gt;&gt; derived.nmblogentries.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.days.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.moy.update()</span>
<span class="sd">        &gt;&gt;&gt; inputs.relativehumidity = 60.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkor = -3.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.reducedwindspeed2m = 3.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.actualvapourpressure = 0.29</span>
<span class="sd">        &gt;&gt;&gt; fluxes.netshortwaveradiationinz = 2.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailysunshineduration = 10.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailypossiblesunshineduration = 12.0</span>
<span class="sd">        &gt;&gt;&gt; aides.tempsinz = -6.3252369154</span>
<span class="sd">        &gt;&gt;&gt; aides.rlatm = 17.581556544</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_wsurfinz_v1(0))</span>
<span class="sd">        1.751625</span>

<span class="sd">        &gt;&gt;&gt; fluxes.saturationvapourpressureinz</span>
<span class="sd">        saturationvapourpressureinz(0.489349)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.netlongwaveradiationinz</span>
<span class="sd">        netlongwaveradiationinz(3.624925)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.netradiationinz</span>
<span class="sd">        netradiationinz(-1.624925)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wsensinz</span>
<span class="sd">        wsensinz(-2.298404)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wlatinz</span>
<span class="sd">        wlatinz(2.425103)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wsurfinz</span>
<span class="sd">        wsurfinz(1.751625)</span>

<span class="sd">    Technical checks:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.core.testtools import check_selectedvariables</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland.lland_model import Return_WSurfInz_V1</span>
<span class="sd">        &gt;&gt;&gt; print(check_selectedvariables(Return_WSurfInz_V1))</span>
<span class="sd">        Possibly missing (REQUIREDSEQUENCES):</span>
<span class="sd">            Return_WLatInz_V1: SaturationVapourPressureInz</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Return_SaturationVapourPressure_V1</span><span class="p">,</span>
        <span class="n">Return_WLatInz_V1</span><span class="p">,</span>
        <span class="n">Return_WSensInz_V1</span><span class="p">,</span>
        <span class="n">Return_NetLongwaveRadiationInz_V1</span><span class="p">,</span>
        <span class="n">Return_NetRadiation_V1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Turb0</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Turb1</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">MOY</span><span class="p">,</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">Days</span><span class="p">,</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">Fr</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">Sigma</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">PsyInv</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NetShortwaveRadiationInz</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TKor</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ReducedWindSpeed2m</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ActualVapourPressure</span><span class="p">,</span>
        <span class="n">lland_aides</span><span class="o">.</span><span class="n">TempSInz</span><span class="p">,</span>
        <span class="n">lland_aides</span><span class="o">.</span><span class="n">RLAtm</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SaturationVapourPressureInz</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WSensInz</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WLatInz</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NetLongwaveRadiationInz</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NetRadiationInz</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WSurfInz</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span>
        <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">saturationvapourpressureinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_saturationvapourpressure_v1</span><span class="p">(</span>
            <span class="nb">max</span><span class="p">(</span><span class="n">aid</span><span class="o">.</span><span class="n">tempsinz</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">flu</span><span class="o">.</span><span class="n">tkor</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">wlatinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_wlatinz_v1</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">wsensinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_wsensinz_v1</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">netlongwaveradiationinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_netlongwaveradiationinz_v1</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">netradiationinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_netradiation_v1</span><span class="p">(</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">netshortwaveradiationinz</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">flu</span><span class="o">.</span><span class="n">netlongwaveradiationinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">wsurfinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">wsensinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">wlatinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">netradiationinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">flu</span><span class="o">.</span><span class="n">wsurfinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>


<div class="viewcode-block" id="Return_BackwardEulerErrorInz_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Return_BackwardEulerErrorInz_V1">[docs]</a><span class="k">class</span> <span class="nc">Return_BackwardEulerErrorInz_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate and return the &quot;Backward Euler error&quot; regarding the update of</span>
<span class="sd">    |ESnowInz| due to the energy flux |WSurfInz|.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`ESnowInz_{old} - esnowinz_{new} - WSurfInz(esnowinz{new})`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-01&quot;, &quot;2000-01-02&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(1)</span>
<span class="sd">        &gt;&gt;&gt; lnk(LAUBW)</span>
<span class="sd">        &gt;&gt;&gt; turb0(0.1728)</span>
<span class="sd">        &gt;&gt;&gt; turb1(0.1728)</span>
<span class="sd">        &gt;&gt;&gt; derived.fr(0.5)</span>
<span class="sd">        &gt;&gt;&gt; derived.nmblogentries.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.days.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.moy.update()</span>
<span class="sd">        &gt;&gt;&gt; inputs.relativehumidity = 60.0</span>
<span class="sd">        &gt;&gt;&gt; states.sinz = 120.0</span>
<span class="sd">        &gt;&gt;&gt; states.stinz = 100.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkor = -3.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.reducedwindspeed2m = 3.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.actualvapourpressure = 0.29</span>
<span class="sd">        &gt;&gt;&gt; fluxes.netshortwaveradiationinz = 2.0</span>
<span class="sd">        &gt;&gt;&gt; states.esnowinz = -0.1</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailysunshineduration = 10.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailypossiblesunshineduration = 12.0</span>
<span class="sd">        &gt;&gt;&gt; aides.rlatm = 17.581556544</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; model.idx_hru = 0</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_backwardeulererrorinz_v1(-1.8516245536573426))</span>
<span class="sd">        0.0</span>

<span class="sd">        &gt;&gt;&gt; aides.tempsinz</span>
<span class="sd">        tempsinz(-6.325237)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.saturationvapourpressureinz</span>
<span class="sd">        saturationvapourpressureinz(0.489349)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.netlongwaveradiationinz</span>
<span class="sd">        netlongwaveradiationinz(3.624925)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.netradiationinz</span>
<span class="sd">        netradiationinz(-1.624925)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wsensinz</span>
<span class="sd">        wsensinz(-2.298404)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wlatinz</span>
<span class="sd">        wlatinz(2.425103)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wsurfinz</span>
<span class="sd">        wsurfinz(1.751625)</span>

<span class="sd">        &gt;&gt;&gt; states.esnowinz</span>
<span class="sd">        esnowinz(-0.1)</span>


<span class="sd">        &gt;&gt;&gt; states.sinz = 0.0</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_backwardeulererrorinz_v1(-1.8516245536573426))</span>
<span class="sd">        nan</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wsurfinz</span>
<span class="sd">        wsurfinz(1.751625)</span>

<span class="sd">    Technical checks:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.core.testtools import check_selectedvariables</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland.lland_model import Return_BackwardEulerErrorInz_V1</span>
<span class="sd">        &gt;&gt;&gt; print(check_selectedvariables(Return_BackwardEulerErrorInz_V1))</span>
<span class="sd">        Possibly missing (REQUIREDSEQUENCES):</span>
<span class="sd">            Return_WLatInz_V1: SaturationVapourPressureInz</span>
<span class="sd">            Return_WSensInz_V1: TempSInz</span>
<span class="sd">            Return_NetLongwaveRadiationInz_V1: TempSInz</span>
<span class="sd">            Return_WSurfInz_V1: TempSInz</span>

<span class="sd">    .. testsetup::</span>

<span class="sd">        &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Return_TempSInz_V1</span><span class="p">,</span>
        <span class="n">Return_SaturationVapourPressure_V1</span><span class="p">,</span>
        <span class="n">Return_WLatInz_V1</span><span class="p">,</span>
        <span class="n">Return_WSensInz_V1</span><span class="p">,</span>
        <span class="n">Return_NetLongwaveRadiationInz_V1</span><span class="p">,</span>
        <span class="n">Return_NetRadiation_V1</span><span class="p">,</span>
        <span class="n">Return_WSurfInz_V1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Turb0</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Turb1</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">MOY</span><span class="p">,</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">Days</span><span class="p">,</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">Fr</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">CPWasser</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">CPEis</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">Sigma</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">PsyInv</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">SInz</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">STInz</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NetShortwaveRadiationInz</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TKor</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ReducedWindSpeed2m</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ActualVapourPressure</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">ESnowInz</span><span class="p">,</span>
        <span class="n">lland_aides</span><span class="o">.</span><span class="n">RLAtm</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_aides</span><span class="o">.</span><span class="n">TempSInz</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SaturationVapourPressureInz</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WSensInz</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WLatInz</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NetLongwaveRadiationInz</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NetRadiationInz</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WSurfInz</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span>
        <span class="n">esnowinz</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">idx_hru</span>
        <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">sinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">d_esnowinz_old</span> <span class="o">=</span> <span class="n">sta</span><span class="o">.</span><span class="n">esnowinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">sta</span><span class="o">.</span><span class="n">esnowinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">esnowinz</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">tempsinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_tempsinz_v1</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="n">sta</span><span class="o">.</span><span class="n">esnowinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">d_esnowinz_old</span>
            <span class="k">return</span> <span class="n">d_esnowinz_old</span> <span class="o">-</span> <span class="n">esnowinz</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">return_wsurfinz_v1</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">nan</span></div>


<div class="viewcode-block" id="Return_BackwardEulerError_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Return_BackwardEulerError_V1">[docs]</a><span class="k">class</span> <span class="nc">Return_BackwardEulerError_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate and return the &quot;Backward Euler error&quot; regarding the</span>
<span class="sd">    update of |ESnow| due to the energy fluxes |WG| and |WSurf|</span>
<span class="sd">    (:cite:`ref-LARSIM` based on :cite:`ref-LUBW2006b`, modified).</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`ESnow_{old} - esnow_{new} + WG(esnow{new} ) - WSurf(esnow{new})`</span>

<span class="sd">    Method |Return_BackwardEulerError_V1| does not calculate any hydrologically</span>
<span class="sd">    meaningfull property.  It is just a technical means to update the energy</span>
<span class="sd">    content of the snow layer with running into instability issues.  See the</span>
<span class="sd">    documentation on method |Update_ESnow_V1| for further information.</span>

<span class="sd">    Example:</span>

<span class="sd">        Method |Return_BackwardEulerError_V1| relies on multiple submethods</span>
<span class="sd">        with different requirements.  Hence, we first need to specify a lot</span>
<span class="sd">        of input data (see the documentation on the different submethods for</span>
<span class="sd">        further information):</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(1)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER)</span>
<span class="sd">        &gt;&gt;&gt; turb0(0.1728)</span>
<span class="sd">        &gt;&gt;&gt; turb1(0.1728)</span>
<span class="sd">        &gt;&gt;&gt; derived.nmblogentries.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.days.update()</span>
<span class="sd">        &gt;&gt;&gt; inputs.relativehumidity = 60.0</span>
<span class="sd">        &gt;&gt;&gt; states.waes = 12.0</span>
<span class="sd">        &gt;&gt;&gt; states.wats = 10.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkor = -3.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.reducedwindspeed2m = 3.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.actualvapourpressure = 0.29</span>
<span class="sd">        &gt;&gt;&gt; fluxes.netshortwaveradiationsnow = 2.0</span>
<span class="sd">        &gt;&gt;&gt; states.esnow = -0.1</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tz = 0.0</span>
<span class="sd">        &gt;&gt;&gt; aides.rlatm = 17.581556544</span>

<span class="sd">        Under the defined conditions the &quot;correct&quot; next value of |ESnow|,</span>
<span class="sd">        when following the Backward Euler approach, is approximately</span>
<span class="sd">        -0.195 MJ/m²:</span>

<span class="sd">        &gt;&gt;&gt; ktschnee(inf)</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; model.idx_hru = 0</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_backwardeulererror_v1(-0.19536469903172524))</span>
<span class="sd">        0.0</span>

<span class="sd">        As a side-effect, method |Return_BackwardEulerError_V1| calculates</span>
<span class="sd">        the following flux sequences for the given amount of energy:</span>

<span class="sd">        &gt;&gt;&gt; aides.temps</span>
<span class="sd">        temps(-6.67375)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tempssurface</span>
<span class="sd">        tempssurface(-6.67375)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.saturationvapourpressuresnow</span>
<span class="sd">        saturationvapourpressuresnow(0.370062)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.netlongwaveradiationsnow</span>
<span class="sd">        netlongwaveradiationsnow(7.12037)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.netradiationsnow</span>
<span class="sd">        netradiationsnow(-5.12037)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wsenssnow</span>
<span class="sd">        wsenssnow(-2.539296)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wlatsnow</span>
<span class="sd">        wlatsnow(0.973963)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wsurf</span>
<span class="sd">        wsurf(3.555037)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wg</span>
<span class="sd">        wg(3.459672)</span>

<span class="sd">        Note that the original value of |ESnow| remains unchanged, to allow</span>
<span class="sd">        for calling method |Return_BackwardEulerError_V1| multiple times</span>
<span class="sd">        during a root search without the need for an external reset:</span>

<span class="sd">        &gt;&gt;&gt; states.esnow</span>
<span class="sd">        esnow(-0.1)</span>

<span class="sd">        In the above example, |KTSchnee| is set to |numpy.inf|, which is</span>
<span class="sd">        why |TempSSurface| is identical with |TempS|.  After setting the</span>
<span class="sd">        common value of 0.432 MJ/m²/K/d, the surface temperature is</span>
<span class="sd">        calculated by another, embeded iteration approach (see method</span>
<span class="sd">        |Return_TempSSurface_V1|).  Hence, the values of |TempSSurface|</span>
<span class="sd">        and |TempS| differ and the energy amount of -0.195 MJ/m² is</span>
<span class="sd">        not correct anymore:</span>

<span class="sd">        &gt;&gt;&gt; ktschnee(0.432)</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_backwardeulererror_v1(-0.19536469903172524))</span>
<span class="sd">        2.70906</span>
<span class="sd">        &gt;&gt;&gt; aides.temps</span>
<span class="sd">        temps(-6.67375)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tempssurface</span>
<span class="sd">        tempssurface(-8.632029)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.saturationvapourpressuresnow</span>
<span class="sd">        saturationvapourpressuresnow(0.317671)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.netlongwaveradiationsnow</span>
<span class="sd">        netlongwaveradiationsnow(6.402218)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.netradiationsnow</span>
<span class="sd">        netradiationsnow(-4.402218)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wsenssnow</span>
<span class="sd">        wsenssnow(-3.892859)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wlatsnow</span>
<span class="sd">        wlatsnow(0.336617)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wsurf</span>
<span class="sd">        wsurf(0.845976)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wg</span>
<span class="sd">        wg(3.459672)</span>
<span class="sd">        &gt;&gt;&gt; states.esnow</span>
<span class="sd">        esnow(-0.1)</span>

<span class="sd">        If there is no snow-cover, it makes little sense to call method</span>
<span class="sd">        |Return_BackwardEulerError_V1|.  For savety, we let it then</span>
<span class="sd">        return a |numpy.nan| value:</span>

<span class="sd">        &gt;&gt;&gt; states.waes = 0.0</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_backwardeulererror_v1(-0.10503956))</span>
<span class="sd">        nan</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wsurf</span>
<span class="sd">        wsurf(0.845976)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Return_TempS_V1</span><span class="p">,</span>
        <span class="n">Return_WG_V1</span><span class="p">,</span>
        <span class="n">Return_TempSSurface_V1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Turb0</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Turb1</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">KTSchnee</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">MOY</span><span class="p">,</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">Days</span><span class="p">,</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">Fr</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">CPWasser</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">CPEis</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">LambdaG</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">Sigma</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">PsyInv</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">WAeS</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">WATS</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NetShortwaveRadiationSnow</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TKor</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ReducedWindSpeed2m</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TZ</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ActualVapourPressure</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">ESnow</span><span class="p">,</span>
        <span class="n">lland_aides</span><span class="o">.</span><span class="n">TempS</span><span class="p">,</span>
        <span class="n">lland_aides</span><span class="o">.</span><span class="n">RLAtm</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TempSSurface</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SaturationVapourPressureSnow</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WSensSnow</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WLatSnow</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NetLongwaveRadiationSnow</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NetRadiationSnow</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WSurf</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WG</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span>
        <span class="n">esnow</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">idx_hru</span>
        <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">d_esnow_old</span> <span class="o">=</span> <span class="n">sta</span><span class="o">.</span><span class="n">esnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">sta</span><span class="o">.</span><span class="n">esnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">esnow</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">temps</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_temps_v1</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="n">sta</span><span class="o">.</span><span class="n">esnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">d_esnow_old</span>
            <span class="n">model</span><span class="o">.</span><span class="n">return_tempssurface_v1</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">wg</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_wg_v1</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">d_esnow_old</span> <span class="o">-</span> <span class="n">esnow</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">wg</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">wsurf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">nan</span></div>


<div class="viewcode-block" id="Update_ESnowInz_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Update_ESnowInz_V1">[docs]</a><span class="k">class</span> <span class="nc">Update_ESnowInz_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Update the thermal energy content of the intercepted snow with regard to the</span>
<span class="sd">    energy fluxes from the atmosphere (except the one related to the heat content of</span>
<span class="sd">    precipitation).</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`\\frac{dESnow}{dt} = - WSurf`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-01&quot;, &quot;2000-01-02&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(8)</span>
<span class="sd">        &gt;&gt;&gt; lnk(LAUBW)</span>
<span class="sd">        &gt;&gt;&gt; turb0(0.1728)</span>
<span class="sd">        &gt;&gt;&gt; turb1(0.1728)</span>
<span class="sd">        &gt;&gt;&gt; derived.fr(0.5)</span>
<span class="sd">        &gt;&gt;&gt; derived.nmblogentries.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.days.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.moy.update()</span>
<span class="sd">        &gt;&gt;&gt; inputs.relativehumidity = 60.0</span>
<span class="sd">        &gt;&gt;&gt; states.sinz = 0.0, 120.0, 12.0, 1.2, 0.12, 0.012, 1.2e-6, 1.2e-12</span>
<span class="sd">        &gt;&gt;&gt; states.stinz = 0.0, 100.0, 12.0, 1.0, 0.10, 0.010, 1.0e-6, 1.0e-12</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkor = -3.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.reducedwindspeed2m = 3.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.actualvapourpressure = 0.29</span>
<span class="sd">        &gt;&gt;&gt; fluxes.netshortwaveradiationinz = 2.0</span>
<span class="sd">        &gt;&gt;&gt; states.esnowinz = -0.1</span>
<span class="sd">        &gt;&gt;&gt; aides.rlatm = 17.581556544</span>

<span class="sd">        &gt;&gt;&gt; model.update_esnowinz_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.esnowinz</span>
<span class="sd">        esnowinz(0.0, -1.851625, -0.205791, -0.024628, -0.00247, -0.000247, 0.0,</span>
<span class="sd">                 0.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.tempsinz</span>
<span class="sd">        tempsinz(nan, -6.325237, -8.2054, -8.41287, -8.438252, -8.440799,</span>
<span class="sd">                 -8.441082, -8.441082)</span>

<span class="sd">        &gt;&gt;&gt; esnowinz = states.esnowinz.values.copy()</span>
<span class="sd">        &gt;&gt;&gt; states.esnowinz = -0.1</span>
<span class="sd">        &gt;&gt;&gt; errors = []</span>
<span class="sd">        &gt;&gt;&gt; for hru in range(8):</span>
<span class="sd">        ...     model.idx_hru = hru</span>
<span class="sd">        ...     errors.append(model.return_backwardeulererrorinz_v1(esnowinz[hru]))</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import print_values</span>
<span class="sd">        &gt;&gt;&gt; print_values(errors)</span>
<span class="sd">        nan, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0</span>

<span class="sd">    Technical checks:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.core.testtools import check_selectedvariables</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland.lland_model import Update_ESnowInz_V1</span>
<span class="sd">        &gt;&gt;&gt; print(check_selectedvariables(Update_ESnowInz_V1))</span>
<span class="sd">        Possibly missing (REQUIREDSEQUENCES):</span>
<span class="sd">            Return_WSurfInz_V1: TempSInz</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Return_ESnowInz_V1</span><span class="p">,</span>
        <span class="n">Return_BackwardEulerErrorInz_V1</span><span class="p">,</span>
        <span class="n">Return_WSurfInz_V1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Turb0</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Turb1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">MOY</span><span class="p">,</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">Days</span><span class="p">,</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">Fr</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">CPWasser</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">CPEis</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">Sigma</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">PsyInv</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NetShortwaveRadiationInz</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TKor</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ReducedWindSpeed2m</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ActualVapourPressure</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">STInz</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">SInz</span><span class="p">,</span>
        <span class="n">lland_aides</span><span class="o">.</span><span class="n">RLAtm</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">ESnowInz</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_aides</span><span class="o">.</span><span class="n">TempSInz</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SaturationVapourPressureInz</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WSensInz</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WLatInz</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NetLongwaveRadiationInz</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NetRadiationInz</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WSurfInz</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">sinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">model</span><span class="o">.</span><span class="n">idx_hru</span> <span class="o">=</span> <span class="n">k</span>
                <span class="n">d_esnowinz</span> <span class="o">=</span> <span class="n">sta</span><span class="o">.</span><span class="n">esnowinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">esnowinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">pegasusesnowinz</span><span class="o">.</span><span class="n">find_x</span><span class="p">(</span>
                    <span class="n">model</span><span class="o">.</span><span class="n">return_esnowinz_v1</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="o">-</span><span class="mf">30.0</span><span class="p">),</span>
                    <span class="n">model</span><span class="o">.</span><span class="n">return_esnowinz_v1</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">),</span>
                    <span class="o">-</span><span class="mf">100.0</span><span class="p">,</span>
                    <span class="mf">100.0</span><span class="p">,</span>
                    <span class="mf">0.0</span><span class="p">,</span>
                    <span class="mf">1e-8</span><span class="p">,</span>
                    <span class="mi">10</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">esnowinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">aid</span><span class="o">.</span><span class="n">tempsinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                    <span class="n">sta</span><span class="o">.</span><span class="n">esnowinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">d_esnowinz</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">return_wsurfinz_v1</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">esnowinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">aid</span><span class="o">.</span><span class="n">tempsinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">nan</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">netlongwaveradiationinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">netradiationinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">saturationvapourpressureinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">wsensinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">wlatinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">wsurfinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>


<div class="viewcode-block" id="Update_ESnow_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Update_ESnow_V1">[docs]</a><span class="k">class</span> <span class="nc">Update_ESnow_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Update the thermal energy content of the snow layer with regard to the</span>
<span class="sd">    energy fluxes from the soil and the atmosphere (except the one related</span>
<span class="sd">    to the heat content of precipitation). :cite:`ref-LARSIM` based on</span>
<span class="sd">    :cite:`ref-LUBW2006b`, modified.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`\\frac{dESnow}{dt} = WG - WSurf`</span>

<span class="sd">    For a thin snow cover, small absolute changes in its energy content</span>
<span class="sd">    result in extreme temperature changes, which makes the above calculation</span>
<span class="sd">    stiff.  Furthermore, the nonlinearity of the term :math:`WSurf(ESnow(t))`</span>
<span class="sd">    prevents from finding an analytical solution of the problem.  This is why</span>
<span class="sd">    we apply the A-stable Backward Euler method.  Through our simplified</span>
<span class="sd">    approach of taking only one variable (|ESnow|) into account, we can solve</span>
<span class="sd">    the underlying root finding problem without any need to calculate or</span>
<span class="sd">    approximate derivatives.  Speaking plainly, we use the Pegasus iterator</span>
<span class="sd">    |PegasusESnow| to find the root of method |Return_BackwardEulerError_V1|</span>
<span class="sd">    whenever the surface is snow-covered.</span>

<span class="sd">    Example:</span>

<span class="sd">        We reuse the configuration of the documentation on method</span>
<span class="sd">        |Return_BackwardEulerError_V1|, except that we prepare five</span>
<span class="sd">        hydrological response units:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(8)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER)</span>
<span class="sd">        &gt;&gt;&gt; turb0(0.1728)</span>
<span class="sd">        &gt;&gt;&gt; turb1(0.1728)</span>
<span class="sd">        &gt;&gt;&gt; ktschnee(inf)</span>
<span class="sd">        &gt;&gt;&gt; derived.nmblogentries.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.days.update()</span>
<span class="sd">        &gt;&gt;&gt; inputs.relativehumidity = 60.0</span>
<span class="sd">        &gt;&gt;&gt; states.waes = 0.0, 120.0, 12.0, 1.2, 0.12, 0.012, 1.2e-6, 1.2e-12</span>
<span class="sd">        &gt;&gt;&gt; states.wats = 0.0, 100.0, 12.0, 1.0, 0.10, 0.010, 1.0e-6, 1.0e-12</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkor = -3.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.reducedwindspeed2m = 3.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.actualvapourpressure = 0.29</span>
<span class="sd">        &gt;&gt;&gt; fluxes.netshortwaveradiationsnow = 2.0</span>
<span class="sd">        &gt;&gt;&gt; states.esnow = -0.1</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tz = 0.0</span>
<span class="sd">        &gt;&gt;&gt; aides.rlatm = 17.581556544</span>

<span class="sd">        For the first, snow-free response unit, the energy content of the</span>
<span class="sd">        snow layer is zero.  For the other response units we see that the</span>
<span class="sd">        energy content decreases with decreasing snow thickness (This</span>
<span class="sd">        result is intuitively clear, but requires iteration in very different</span>
<span class="sd">        orders of magnitudes.  We hope, our implementation works always</span>
<span class="sd">        well.  Please tell us, if you encounter any cases where it does not):</span>

<span class="sd">        &gt;&gt;&gt; model.update_esnow_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.esnow</span>
<span class="sd">        esnow(0.0, -1.723064, -0.167737, -0.019803, -0.001983, -0.000198, 0.0,</span>
<span class="sd">              0.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.temps</span>
<span class="sd">        temps(nan, -5.886068, -6.688079, -6.764855, -6.774109, -6.775036,</span>
<span class="sd">              -6.775139, -6.775139)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tempssurface</span>
<span class="sd">        tempssurface(nan, -5.886068, -6.688079, -6.764855, -6.774109, -6.775036,</span>
<span class="sd">                     -6.775139, -6.775139)</span>

<span class="sd">        As to be expected, the requirement of the Backward Euler method</span>
<span class="sd">        is approximetely fullfilled for each response unit:</span>

<span class="sd">        &gt;&gt;&gt; esnow = states.esnow.values.copy()</span>
<span class="sd">        &gt;&gt;&gt; states.esnow = -0.1</span>
<span class="sd">        &gt;&gt;&gt; errors = []</span>
<span class="sd">        &gt;&gt;&gt; for hru in range(8):</span>
<span class="sd">        ...     model.idx_hru = hru</span>
<span class="sd">        ...     errors.append(model.return_backwardeulererror_v1(esnow[hru]))</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import print_values</span>
<span class="sd">        &gt;&gt;&gt; print_values(errors)</span>
<span class="sd">        nan, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0</span>

<span class="sd">        The following example repeats the above one, but enables the</span>
<span class="sd">        iterative adjustment of the snow surface temperature, which</span>
<span class="sd">        is embeded into the iterative adjustment of the energy content</span>
<span class="sd">        of the snow layer:</span>

<span class="sd">        &gt;&gt;&gt; ktschnee(0.432)</span>
<span class="sd">        &gt;&gt;&gt; model.update_esnow_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.esnow</span>
<span class="sd">        esnow(0.0, -0.806055, -0.090244, -0.010808, -0.001084, -0.000108, 0.0,</span>
<span class="sd">              0.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.temps</span>
<span class="sd">        temps(nan, -2.753522, -3.59826, -3.692022, -3.7035, -3.704652, -3.70478,</span>
<span class="sd">              -3.70478)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tempssurface</span>
<span class="sd">        tempssurface(nan, -7.692134, -7.893588, -7.915986, -7.918728, -7.919003,</span>
<span class="sd">                     -7.919034, -7.919034)</span>

<span class="sd">        The resulting energy amounts are, again, the &quot;correct&quot; ones:</span>

<span class="sd">        &gt;&gt;&gt; esnow = states.esnow.values.copy()</span>
<span class="sd">        &gt;&gt;&gt; states.esnow = -0.1</span>
<span class="sd">        &gt;&gt;&gt; errors = []</span>
<span class="sd">        &gt;&gt;&gt; for hru in range(8):</span>
<span class="sd">        ...     model.idx_hru = hru</span>
<span class="sd">        ...     errors.append(model.return_backwardeulererror_v1(esnow[hru]))</span>
<span class="sd">        &gt;&gt;&gt; print_values(errors)</span>
<span class="sd">        nan, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Return_ESnow_V1</span><span class="p">,</span>
        <span class="n">Return_TempSSurface_V1</span><span class="p">,</span>
        <span class="n">Return_WG_V1</span><span class="p">,</span>
        <span class="n">Return_BackwardEulerError_V1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Turb0</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Turb1</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">KTSchnee</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">MOY</span><span class="p">,</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">Days</span><span class="p">,</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">Fr</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">CPWasser</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">CPEis</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">LambdaG</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">Sigma</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">PsyInv</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NetShortwaveRadiationSnow</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TKor</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ReducedWindSpeed2m</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ActualVapourPressure</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TZ</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">WATS</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">WAeS</span><span class="p">,</span>
        <span class="n">lland_aides</span><span class="o">.</span><span class="n">TempS</span><span class="p">,</span>
        <span class="n">lland_aides</span><span class="o">.</span><span class="n">RLAtm</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">ESnow</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SaturationVapourPressureSnow</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TempSSurface</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WSensSnow</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WLatSnow</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NetLongwaveRadiationSnow</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NetRadiationSnow</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WSurf</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WG</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">model</span><span class="o">.</span><span class="n">idx_hru</span> <span class="o">=</span> <span class="n">k</span>
                <span class="n">d_esnow</span> <span class="o">=</span> <span class="n">sta</span><span class="o">.</span><span class="n">esnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">esnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">pegasusesnow</span><span class="o">.</span><span class="n">find_x</span><span class="p">(</span>
                    <span class="n">model</span><span class="o">.</span><span class="n">return_esnow_v1</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="o">-</span><span class="mf">30.0</span><span class="p">),</span>
                    <span class="n">model</span><span class="o">.</span><span class="n">return_esnow_v1</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">),</span>
                    <span class="o">-</span><span class="mf">100.0</span><span class="p">,</span>
                    <span class="mf">100.0</span><span class="p">,</span>
                    <span class="mf">0.0</span><span class="p">,</span>
                    <span class="mf">1e-8</span><span class="p">,</span>
                    <span class="mi">10</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">esnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">aid</span><span class="o">.</span><span class="n">temps</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">tempssurface</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_tempssurface</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">wg</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_wg_v1</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                    <span class="n">sta</span><span class="o">.</span><span class="n">esnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">d_esnow</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">wg</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">wsurf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">esnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">aid</span><span class="o">.</span><span class="n">temps</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">nan</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">tempssurface</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">nan</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">netlongwaveradiationsnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">netradiationsnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">saturationvapourpressuresnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">wsenssnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">wlatsnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">wsurf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>


<div class="viewcode-block" id="Calc_SchmPot_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_SchmPot_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_SchmPot_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the potential snow melt according to the day degree method.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`SchmPot = max\\left(\\frac{WGTF + WNied}{RSchmelz}, 0\\right)`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(2)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wgtf = 2.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wnied = 1.0, 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_schmpot_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.schmpot</span>
<span class="sd">        schmpot(8.982036, 11.976048)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fixed</span><span class="o">.</span><span class="n">RSchmelz</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WGTF</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WNied</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SchmPot</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">schmpot</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">((</span><span class="n">flu</span><span class="o">.</span><span class="n">wgtf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">wnied</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">/</span> <span class="n">fix</span><span class="o">.</span><span class="n">rschmelz</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span></div>


<div class="viewcode-block" id="Calc_SchmPot_V2"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_SchmPot_V2">[docs]</a><span class="k">class</span> <span class="nc">Calc_SchmPot_V2</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the potential snow melt according to the heat content of the</span>
<span class="sd">    snow layer.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`SchmPot = max\\left(\\frac{ESnow}{RSchmelz}, 0\\right)`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(4)</span>
<span class="sd">        &gt;&gt;&gt; states.waes = 0.0, 1.0, 1.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; states.esnow = nan, 5.0, 2.0, -2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_schmpot_v2()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.schmpot</span>
<span class="sd">        schmpot(0.0, 14.97006, 5.988024, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fixed</span><span class="o">.</span><span class="n">RSchmelz</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">ESnow</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">WAeS</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SchmPot</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">schmpot</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">esnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">fix</span><span class="o">.</span><span class="n">rschmelz</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">schmpot</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>


<div class="viewcode-block" id="Calc_GefrPot_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_GefrPot_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_GefrPot_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the potential refreezing within the snow layer according</span>
<span class="sd">    to the thermal energy content of the snow layer.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`GefrPot = max\\left(-\\frac{ESnow}{RSchmelz}, 0\\right)`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(4)</span>
<span class="sd">        &gt;&gt;&gt; states.waes = 0.0, 1.0, 1.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; states.esnow = nan, -5.0, -2.0, 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_gefrpot_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.gefrpot</span>
<span class="sd">        gefrpot(0.0, 14.97006, 5.988024, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fixed</span><span class="o">.</span><span class="n">RSchmelz</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">ESnow</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">WAeS</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">GefrPot</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">gefrpot</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="n">sta</span><span class="o">.</span><span class="n">esnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">fix</span><span class="o">.</span><span class="n">rschmelz</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">gefrpot</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>


<div class="viewcode-block" id="Calc_Schm_WATS_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_Schm_WATS_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_Schm_WATS_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the actual amount of water melting within the snow layer.</span>

<span class="sd">    Basic equations:</span>

<span class="sd">      :math:`\\frac{dW\\!ATS}{dt} = -Schm`</span>

<span class="sd">      .. math::</span>
<span class="sd">        Schm = \\begin{cases}</span>
<span class="sd">        SchmPot</span>
<span class="sd">        &amp;|\\</span>
<span class="sd">        WATS &gt; 0</span>
<span class="sd">        \\\\</span>
<span class="sd">        0</span>
<span class="sd">        &amp;|\\</span>
<span class="sd">        WATS = 0</span>
<span class="sd">        \\end{cases}</span>


<span class="sd">    Examples:</span>

<span class="sd">        We initialise two water (|FLUSS| and |SEE|) and four arable land</span>
<span class="sd">        (|ACKER|) HRUs.  We assume the same values for the initial amount</span>
<span class="sd">        of frozen water (|WATS|) and the frozen part of stand precipitation</span>
<span class="sd">        (|SBes|), but different values for potential snowmelt (|SchmPot|):</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(6)</span>
<span class="sd">        &gt;&gt;&gt; lnk(FLUSS, SEE, ACKER, ACKER, ACKER, ACKER)</span>
<span class="sd">        &gt;&gt;&gt; states.wats = 0.0, 0.0, 2.0, 2.0, 2.0, 2.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.schmpot = 1.0, 1.0, 0.0, 1.0, 3.0, 5.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_schm_wats_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.wats</span>
<span class="sd">        wats(0.0, 0.0, 2.0, 1.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.schm</span>
<span class="sd">        schm(0.0, 0.0, 0.0, 1.0, 2.0, 2.0)</span>

<span class="sd">        Actual melt is either limited by potential melt or the available frozen</span>
<span class="sd">        water, which is the sum of initial frozen water and the frozen part</span>
<span class="sd">        of stand precipitation.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SchmPot</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">Schm</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">WATS</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">WASSER</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">schm</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">schm</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">schmpot</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">sta</span><span class="o">.</span><span class="n">wats</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">wats</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-=</span> <span class="n">flu</span><span class="o">.</span><span class="n">schm</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>


<div class="viewcode-block" id="Calc_Gefr_WATS_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_Gefr_WATS_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_Gefr_WATS_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the actual amount of water melting within the snow layer.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      :math:`\\frac{dGefr}{dt} = -Gefr`</span>

<span class="sd">      .. math::</span>
<span class="sd">        Gefr = \\begin{cases}</span>
<span class="sd">        GefrPot</span>
<span class="sd">        &amp;|\\</span>
<span class="sd">        WAeS - WATS &gt; 0</span>
<span class="sd">        \\\\</span>
<span class="sd">        0</span>
<span class="sd">        &amp;|\\</span>
<span class="sd">        WAeS - WATS = 0</span>
<span class="sd">        \\end{cases}</span>

<span class="sd">    Examples:</span>

<span class="sd">        We initialise two water (|FLUSS| and |SEE|) and four arable land</span>
<span class="sd">        (|ACKER|) HRUs.  We assume the same values for the initial amount</span>
<span class="sd">        of frozen water (|WATS|) and the frozen part of stand precipitation</span>
<span class="sd">        (|SBes|), but different values for potential snowmelt (|SchmPot|):</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(6)</span>
<span class="sd">        &gt;&gt;&gt; lnk(FLUSS, SEE, ACKER, ACKER, ACKER, ACKER)</span>
<span class="sd">        &gt;&gt;&gt; refreezeflag(True)</span>
<span class="sd">        &gt;&gt;&gt; states.wats = 0.0, 0.0, 2.0, 2.0, 2.0, 2.0</span>
<span class="sd">        &gt;&gt;&gt; states.waes = 0.0, 0.0, 4.0, 4.0, 4.0, 4.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.gefrpot = 1.0, 1.0, 0.0, 1.0, 3.0, 5.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_gefr_wats_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.wats</span>
<span class="sd">        wats(0.0, 0.0, 2.0, 3.0, 4.0, 4.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.gefr</span>
<span class="sd">        gefr(0.0, 0.0, 0.0, 1.0, 2.0, 2.0)</span>

<span class="sd">        If we deactivate the refreezing flag, liquid water in the snow layer</span>
<span class="sd">        does not refreeze. |Gefr| is set to 0 and |WATS| does not change:</span>

<span class="sd">        &gt;&gt;&gt; refreezeflag(False)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_gefr_wats_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.wats</span>
<span class="sd">        wats(0.0, 0.0, 2.0, 3.0, 4.0, 4.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.gefr</span>
<span class="sd">        gefr(0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>

<span class="sd">        Actual refreezing is either limited by potential refreezing or the</span>
<span class="sd">        available water.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">RefreezeFlag</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">GefrPot</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">WAeS</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">Gefr</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">WATS</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">WASSER</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">con</span><span class="o">.</span><span class="n">refreezeflag</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">gefr</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">gefr</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">gefrpot</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">sta</span><span class="o">.</span><span class="n">wats</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">wats</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">gefr</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>


<div class="viewcode-block" id="Update_WaDa_WAeS_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Update_WaDa_WAeS_V1">[docs]</a><span class="k">class</span> <span class="nc">Update_WaDa_WAeS_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Update the actual water release from and the liquid water content of</span>
<span class="sd">    the snow layer due to melting.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      :math:`WaDa_{new} = WaDa_{old} + \\Delta`</span>

<span class="sd">      :math:`WAeS_{new} = WAeS_{old} - \\Delta`</span>

<span class="sd">      :math:`\\Delta = max(WAeS-PWMax \\cdot WATS, 0)`</span>

<span class="sd">    Examples:</span>

<span class="sd">        We set the threshold parameter |PWMax| for each of the seven</span>
<span class="sd">        initialised hydrological response units to two.  Thus, the snow</span>
<span class="sd">        cover can hold as much liquid water as it contains frozen water.</span>
<span class="sd">        For the first three response units, which represent water</span>
<span class="sd">        surfaces, snow-related processes are ignored and the original</span>
<span class="sd">        values of |WaDa| and |WAeS| remain unchanged. For all other land</span>
<span class="sd">        use classes (of which we select |ACKER| arbitrarily), method</span>
<span class="sd">        |Update_WaDa_WAeS_V1| passes only the amount of |WAeS| exceeding</span>
<span class="sd">        the actual snow holding capacity to |WaDa|:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(7)</span>
<span class="sd">        &gt;&gt;&gt; lnk(WASSER, FLUSS, SEE, ACKER, ACKER, ACKER, ACKER)</span>
<span class="sd">        &gt;&gt;&gt; pwmax(2.0)</span>
<span class="sd">        &gt;&gt;&gt; states.wats = 0.0, 0.0, 0.0, 0.0, 1.0, 1.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; states.waes = 1.0, 1.0, 1.0, 0.0, 1.0, 2.0, 3.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wada = 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.update_wada_waes_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.waes</span>
<span class="sd">        waes(1.0, 1.0, 1.0, 0.0, 1.0, 2.0, 2.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wada</span>
<span class="sd">        wada(1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 2.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">PWMax</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">WATS</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">WAeS</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WaDa</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="n">WASSER</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">):</span>
                <span class="n">d_wada_corr</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">pwmax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">sta</span><span class="o">.</span><span class="n">wats</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">)</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">wada</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">d_wada_corr</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-=</span> <span class="n">d_wada_corr</span></div>


<div class="viewcode-block" id="Update_ESnow_V2"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Update_ESnow_V2">[docs]</a><span class="k">class</span> <span class="nc">Update_ESnow_V2</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Update the thermal energy content of the snow layer regarding snow</span>
<span class="sd">    melt and refreezing.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`\\frac{dESNOW}{dt} = RSchmelz \\cdot (Gefr - Schm)`</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(7)</span>
<span class="sd">        &gt;&gt;&gt; lnk(WASSER, FLUSS, SEE, ACKER, ACKER, ACKER, ACKER)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.gefr = 0.0, 0.0, 0.0, 0.0, 4.0, 0.0, 4.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.schm = 0.0, 0.0, 0.0, 0.0, 0.0, 4.0, 4.0</span>
<span class="sd">        &gt;&gt;&gt; states.esnow = 1.0, 1.0, 1.0, 1.0, -1.5, 1.336, 0.0</span>
<span class="sd">        &gt;&gt;&gt; states.waes = 1.0, 1.0, 1.0, 0.0, 5.0, 5.0, 10.0</span>
<span class="sd">        &gt;&gt;&gt; model.update_esnow_v2()</span>
<span class="sd">        &gt;&gt;&gt; states.esnow</span>
<span class="sd">        esnow(0.0, 0.0, 0.0, 0.0, -0.164, 0.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fixed</span><span class="o">.</span><span class="n">RSchmelz</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">Gefr</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">Schm</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">WAeS</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">ESnow</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">WASSER</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">):</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">esnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">esnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">fix</span><span class="o">.</span><span class="n">rschmelz</span> <span class="o">*</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">gefr</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">schm</span><span class="p">[</span><span class="n">k</span><span class="p">])</span></div>


<div class="viewcode-block" id="Calc_SFF_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_SFF_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_SFF_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the ratio between frozen water and total water within</span>
<span class="sd">    the top soil layer :cite:`ref-LARSIM`.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      :math:`SFF = min\\left(max\\left(</span>
<span class="sd">      1 - \\frac{EBdn}{BoWa2Z} \\cdot RSchmelz, 0\\right), 1\\right)`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(9)</span>
<span class="sd">        &gt;&gt;&gt; lnk(VERS, WASSER, FLUSS, SEE, ACKER, ACKER, ACKER, ACKER, ACKER)</span>
<span class="sd">        &gt;&gt;&gt; states.ebdn(0.0, 0.0, 0.0, 0.0, 28.0, 27.0, 10.0, 0.0, -1.0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_sff_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.sff</span>
<span class="sd">        sff(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.625749, 1.0, 1.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">BoWa2Z</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">RSchmelz</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">EBdn</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SFF</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">VERS</span><span class="p">,</span> <span class="n">WASSER</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">sff</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">sff</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
                    <span class="nb">max</span><span class="p">(</span>
                        <span class="mf">1.0</span> <span class="o">-</span> <span class="n">sta</span><span class="o">.</span><span class="n">ebdn</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">fix</span><span class="o">.</span><span class="n">bowa2z</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">fix</span><span class="o">.</span><span class="n">rschmelz</span><span class="p">),</span>
                        <span class="mf">0.0</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="mf">1.0</span><span class="p">,</span>
                <span class="p">)</span></div>


<div class="viewcode-block" id="Calc_FVG_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_FVG_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_FVG_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the degree of frost sealing of the soil :cite:`ref-LARSIM`.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`FVG = min\\bigl(FVF \\cdot SFF^{BSFF}, 1\\bigl)`</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(7)</span>
<span class="sd">        &gt;&gt;&gt; lnk(VERS, WASSER, FLUSS, SEE, ACKER, ACKER, ACKER)</span>
<span class="sd">        &gt;&gt;&gt; fvf(0.8)</span>
<span class="sd">        &gt;&gt;&gt; bsff(2.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.sff(1.0, 1.0, 1.0, 1.0, 0.0, 0.5, 1.0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_fvg_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.fvg</span>
<span class="sd">        fvg(0.0, 0.0, 0.0, 0.0, 0.0, 0.2, 0.8)</span>

<span class="sd">        The calculated degree of frost sealing does never exceed one,</span>
<span class="sd">        even when defining |FVF| values larger one:</span>

<span class="sd">        &gt;&gt;&gt; fvf(1.6)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_fvg_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.fvg</span>
<span class="sd">        fvg(0.0, 0.0, 0.0, 0.0, 0.0, 0.4, 1.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">BSFF</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">FVF</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SFF</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">FVG</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">VERS</span><span class="p">,</span> <span class="n">WASSER</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">fvg</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">fvg</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">fvf</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">sff</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">**</span> <span class="n">con</span><span class="o">.</span><span class="n">bsff</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span></div>


<div class="viewcode-block" id="Calc_EvB_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_EvB_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_EvB_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the actual soil evapotranspiration.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      :math:`EvB = (EvPo - EvI) \\cdot</span>
<span class="sd">      \\frac{1 - temp}{1 + temp -2 \\cdot exp(-GrasRef_R)}`</span>

<span class="sd">      :math:`temp = exp\\left(-GrasRef_R \\cdot \\frac{BoWa}{WMax}\\right)`</span>

<span class="sd">    Examples:</span>

<span class="sd">        Soil evapotranspiration is calculated neither for water nor for</span>
<span class="sd">        sealed areas (see the first three hydrological reponse units of</span>
<span class="sd">        type |FLUSS|, |SEE|, and |VERS|).  All other land use classes are</span>
<span class="sd">        handled in accordance with a recommendation of the set of codes</span>
<span class="sd">        described in DVWK-M 504 :cite:`ref-DVWK`.  In case maximum soil water</span>
<span class="sd">        storage (|WMax|) is zero, soil evaporation (|EvB|) is generally set to</span>
<span class="sd">        zero (see the fourth hydrological response unit).  The last three</span>
<span class="sd">        response units demonstrate the rise in soil evaporation with increasing</span>
<span class="sd">        soil moisture, which is lessening in the high soil moisture range:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(7)</span>
<span class="sd">        &gt;&gt;&gt; lnk(FLUSS, SEE, VERS, ACKER, ACKER, ACKER, ACKER)</span>
<span class="sd">        &gt;&gt;&gt; grasref_r(5.0)</span>
<span class="sd">        &gt;&gt;&gt; wmax(100.0, 100.0, 100.0, 0.0, 100.0, 100.0, 100.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evpo = 5.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evi = 3.0</span>
<span class="sd">        &gt;&gt;&gt; states.bowa = 50.0, 50.0, 50.0, 0.0, 0.0, 50.0, 100.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_evb_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evb</span>
<span class="sd">        evb(0.0, 0.0, 0.0, 0.0, 0.0, 1.717962, 2.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">WMax</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">GrasRef_R</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">BoWa</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">EvPo</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">EvI</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">EvB</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">VERS</span><span class="p">,</span> <span class="n">WASSER</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">)</span> <span class="ow">or</span> <span class="n">con</span><span class="o">.</span><span class="n">wmax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">evb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">d_temp</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">con</span><span class="o">.</span><span class="n">grasref_r</span> <span class="o">*</span> <span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">con</span><span class="o">.</span><span class="n">wmax</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">evb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">evpo</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">evi</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                    <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">d_temp</span><span class="p">)</span>
                    <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">d_temp</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">con</span><span class="o">.</span><span class="n">grasref_r</span><span class="p">))</span>
                <span class="p">)</span></div>


<div class="viewcode-block" id="Calc_DryAirPressure_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_DryAirPressure_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_DryAirPressure_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the pressure of the dry air (based on :cite:`ref-DWD1987`).</span>

<span class="sd">    Basic equation:</span>
<span class="sd">       :math:`DryAirPressure = AirPressure - ActualVapourPressure`</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(3)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.actualvapourpressure = 0.9, 1.1, 2.5</span>
<span class="sd">        &gt;&gt;&gt; inputs.atmosphericpressure = 120.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_dryairpressure_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dryairpressure</span>
<span class="sd">        dryairpressure(119.1, 118.9, 117.5)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ActualVapourPressure</span><span class="p">,</span>
        <span class="n">lland_inputs</span><span class="o">.</span><span class="n">AtmosphericPressure</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">DryAirPressure</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">dryairpressure</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">inp</span><span class="o">.</span><span class="n">atmosphericpressure</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">actualvapourpressure</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="Calc_DensityAir_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_DensityAir_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_DensityAir_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the density of the air (based on :cite:`ref-DWD1987`).</span>

<span class="sd">    Basic equation:</span>
<span class="sd">       :math:`DensityAir = \\frac{DryAirPressure}{RDryAir \\cdot (TKor+273.15)}</span>
<span class="sd">       + \\frac{ActualVapourPressure}{RWaterVapour \\cdot (TKor+273.15)}`</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(3)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dryairpressure = 119.1, 100.0, 115.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.actualvapourpressure = 0.8, 0.7, 1.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkor = 10.0, 12.0, 14.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_densityair_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.densityair</span>
<span class="sd">        densityair(1.471419, 1.226998, 1.402691)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">RDryAir</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">RWaterVapour</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ActualVapourPressure</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">DryAirPressure</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TKor</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">DensityAir</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="n">d_t</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">tkor</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="mf">273.15</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">densityair</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">dryairpressure</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span>
                <span class="n">fix</span><span class="o">.</span><span class="n">rdryair</span> <span class="o">*</span> <span class="n">d_t</span>
            <span class="p">)</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">actualvapourpressure</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">fix</span><span class="o">.</span><span class="n">rwatervapour</span> <span class="o">*</span> <span class="n">d_t</span><span class="p">)</span></div>


<div class="viewcode-block" id="Calc_AerodynamicResistance_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_AerodynamicResistance_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_AerodynamicResistance_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the aerodynamic resistance :cite:`ref-LARSIM` (based on</span>
<span class="sd">    :cite:`ref-Thompson1981`).</span>

<span class="sd">    Basic equations (:math:`z_0` after Quast and Boehm, 1997):</span>
<span class="sd">      .. math::</span>
<span class="sd">        AerodynamicResistance = \\begin{cases}</span>
<span class="sd">        \\frac{6.25}{WindSpeed10m} \\cdot ln\\left(\\frac{10}{z_0}\\right)^2</span>
<span class="sd">        &amp;|\\</span>
<span class="sd">        z_0 &lt; 10</span>
<span class="sd">        \\\\</span>
<span class="sd">        \\frac{94}{WindSpeed10m}</span>
<span class="sd">        &amp;|\\</span>
<span class="sd">        z_0 \\geq 10</span>
<span class="sd">        \\end{cases}</span>

<span class="sd">      :math:`z_0 = 0.021 + 0.163 \\cdot CropHeight`</span>


<span class="sd">    Examples:</span>

<span class="sd">        Besides wind speed, aerodynamic resistance depends on the crop height,</span>
<span class="sd">        which typically varies between different landuse-use classes and, for</span>
<span class="sd">        vegetated surfaces, months.  In the first example, we set some</span>
<span class="sd">        different crop heights for different landuse-use types to cover the</span>
<span class="sd">        relevant range of values:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(5)</span>
<span class="sd">        &gt;&gt;&gt; lnk(WASSER, ACKER, OBSTB, LAUBW, NADELW)</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-30&quot;, &quot;2000-02-03&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; derived.moy.update()</span>
<span class="sd">        &gt;&gt;&gt; cropheight.wasser_jan = 0.0</span>
<span class="sd">        &gt;&gt;&gt; cropheight.acker_jan = 1.0</span>
<span class="sd">        &gt;&gt;&gt; cropheight.obstb_jan = 5.0</span>
<span class="sd">        &gt;&gt;&gt; cropheight.laubw_jan = 10.0</span>
<span class="sd">        &gt;&gt;&gt; cropheight.nadelw_jan = 15.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.windspeed10m = 3.0</span>
<span class="sd">        &gt;&gt;&gt; model.idx_sim = 1</span>
<span class="sd">        &gt;&gt;&gt; model.calc_aerodynamicresistance_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.aerodynamicresistance</span>
<span class="sd">        aerodynamicresistance(79.202731, 33.256788, 12.831028, 31.333333,</span>
<span class="sd">                              31.333333)</span>

<span class="sd">        The last example shows an decrease in resistance for increasing</span>
<span class="sd">        crop height for the first three hydrological response units only.</span>
<span class="sd">        When reaching a crop height of 10 m, the calculated resistance</span>
<span class="sd">        increases discontinously (see the fourth response unit) and then</span>
<span class="sd">        remains constant (see the fifth response unit).  In the next</span>
<span class="sd">        example, we set some unrealistic values, to inspect this</span>
<span class="sd">        behaviour more closely:</span>

<span class="sd">        &gt;&gt;&gt; cropheight.wasser_feb = 8.0</span>
<span class="sd">        &gt;&gt;&gt; cropheight.acker_feb = 9.0</span>
<span class="sd">        &gt;&gt;&gt; cropheight.obstb_feb = 10.0</span>
<span class="sd">        &gt;&gt;&gt; cropheight.laubw_feb = 11.0</span>
<span class="sd">        &gt;&gt;&gt; cropheight.nadelw_feb = 12.0</span>
<span class="sd">        &gt;&gt;&gt; model.idx_sim = 2</span>
<span class="sd">        &gt;&gt;&gt; model.calc_aerodynamicresistance_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.aerodynamicresistance</span>
<span class="sd">        aerodynamicresistance(8.510706, 7.561677, 31.333333, 31.333333,</span>
<span class="sd">                              31.333333)</span>

<span class="sd">        To get rid of this jump, one could use a threshold crop height</span>
<span class="sd">        of 1.14 m instead of 10 m for the selection of</span>
<span class="sd">        the two underlying equations:</span>

<span class="sd">        :math:`1.1404411695422059 =</span>
<span class="sd">        \\frac{\\frac{10}{\\exp(\\sqrt{94/6.25}}-0.021}{0.163}`</span>

<span class="sd">        The last example shows the inverse relationship between resistance</span>
<span class="sd">        and wind speed.  For zero wind speed, resistance becomes infinite:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import print_values</span>
<span class="sd">        &gt;&gt;&gt; cropheight(2.0)</span>
<span class="sd">        &gt;&gt;&gt; for ws in (0.0, 0.1, 1.0, 10.0):</span>
<span class="sd">        ...     fluxes.windspeed10m = ws</span>
<span class="sd">        ...     model.calc_aerodynamicresistance_v1()</span>
<span class="sd">        ...     print_values([ws, fluxes.aerodynamicresistance[0]])</span>
<span class="sd">        0.0, inf</span>
<span class="sd">        0.1, 706.026613</span>
<span class="sd">        1.0, 70.602661</span>
<span class="sd">        10.0, 7.060266</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">CropHeight</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">MOY</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WindSpeed10m</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">AerodynamicResistance</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">if</span> <span class="n">flu</span><span class="o">.</span><span class="n">windspeed10m</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
                <span class="n">d_ch</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cropheight</span><span class="p">[</span><span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">der</span><span class="o">.</span><span class="n">moy</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">idx_sim</span><span class="p">]]</span>
                <span class="k">if</span> <span class="n">d_ch</span> <span class="o">&lt;</span> <span class="mf">10.0</span><span class="p">:</span>
                    <span class="n">d_z0</span> <span class="o">=</span> <span class="mf">0.021</span> <span class="o">+</span> <span class="mf">0.163</span> <span class="o">*</span> <span class="n">d_ch</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">aerodynamicresistance</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="mf">6.25</span> <span class="o">/</span> <span class="n">flu</span><span class="o">.</span><span class="n">windspeed10m</span> <span class="o">*</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">10.0</span> <span class="o">/</span> <span class="n">d_z0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">aerodynamicresistance</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">94.0</span> <span class="o">/</span> <span class="n">flu</span><span class="o">.</span><span class="n">windspeed10m</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">aerodynamicresistance</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">inf</span></div>


<div class="viewcode-block" id="Calc_SoilSurfaceResistance_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_SoilSurfaceResistance_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_SoilSurfaceResistance_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the surface resistance of the bare soil surface</span>
<span class="sd">    :cite:`ref-LARSIM` (based on :cite:`ref-Thompson1981`).</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      .. math::</span>
<span class="sd">        SoilSurfaceResistance = \\begin{cases}</span>
<span class="sd">        100</span>
<span class="sd">        &amp;|\\</span>
<span class="sd">        NFk &gt; 20</span>
<span class="sd">        \\\\</span>
<span class="sd">        \\frac{100 \\cdot NFk}{max(BoWa-PWP, 0) + NFk/100}</span>
<span class="sd">        &amp;|\\</span>
<span class="sd">        NFk \\geq 20</span>
<span class="sd">        \\end{cases}</span>

<span class="sd">    Examples:</span>

<span class="sd">        Water areas and sealed surfaces do not posses a soil, which is why</span>
<span class="sd">        we set the soil surface resistance to |numpy.nan|:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(4)</span>
<span class="sd">        &gt;&gt;&gt; lnk(VERS, WASSER, FLUSS, SEE)</span>
<span class="sd">        &gt;&gt;&gt; fk(0.0)</span>
<span class="sd">        &gt;&gt;&gt; pwp(0.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.nfk.update()</span>
<span class="sd">        &gt;&gt;&gt; states.bowa = 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_soilsurfaceresistance_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.soilsurfaceresistance</span>
<span class="sd">        soilsurfaceresistance(nan, nan, nan, nan)</span>

<span class="sd">        For &quot;typical&quot; soils, which posses an available field capacity larger</span>
<span class="sd">        than 20 mm, we set the soil surface resistance to 100.0 s/m:</span>

<span class="sd">        &gt;&gt;&gt; lnk(ACKER)</span>
<span class="sd">        &gt;&gt;&gt; fk(20.1, 30.0, 40.0, 40.0)</span>
<span class="sd">        &gt;&gt;&gt; pwp(0.0, 0.0, 10.0, 10.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.nfk.update()</span>
<span class="sd">        &gt;&gt;&gt; states.bowa = 0.0, 20.0, 5.0, 30.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_soilsurfaceresistance_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.soilsurfaceresistance</span>
<span class="sd">        soilsurfaceresistance(100.0, 100.0, 100.0, 100.0)</span>

<span class="sd">        For all soils with smaller actual field capacities, resistance</span>
<span class="sd">        is 10&#39;000 s/m as long as the soil water content does not exceed</span>
<span class="sd">        the permanent wilting point:</span>

<span class="sd">        &gt;&gt;&gt; pwp(0.1, 20.0, 20.0, 30.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.nfk.update()</span>
<span class="sd">        &gt;&gt;&gt; states.bowa = 0.0, 10.0, 20.0, 30.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_soilsurfaceresistance_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.soilsurfaceresistance</span>
<span class="sd">        soilsurfaceresistance(10000.0, 10000.0, 10000.0, 10000.0)</span>

<span class="sd">        With increasing soil water contents, resistance decreases and</span>
<span class="sd">        reaches a value of 99 s/m:</span>

<span class="sd">        &gt;&gt;&gt; pwp(0.0)</span>
<span class="sd">        &gt;&gt;&gt; fk(20.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.nfk.update()</span>
<span class="sd">        &gt;&gt;&gt; states.bowa = 5.0, 10.0, 15.0, 20.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_soilsurfaceresistance_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.soilsurfaceresistance</span>
<span class="sd">        soilsurfaceresistance(384.615385, 196.078431, 131.578947, 99.009901)</span>

<span class="sd">        &gt;&gt;&gt; fk(50.0)</span>
<span class="sd">        &gt;&gt;&gt; pwp(40.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.nfk.update()</span>
<span class="sd">        &gt;&gt;&gt; states.bowa = 42.5, 45.0, 47.5, 50.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_soilsurfaceresistance_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.soilsurfaceresistance</span>
<span class="sd">        soilsurfaceresistance(384.615385, 196.078431, 131.578947, 99.009901)</span>

<span class="sd">        For zero field capacity, we set the soil surface resistance to zero:</span>

<span class="sd">        &gt;&gt;&gt; pwp(0.0)</span>
<span class="sd">        &gt;&gt;&gt; fk(0.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.nfk.update()</span>
<span class="sd">        &gt;&gt;&gt; states.bowa = 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_soilsurfaceresistance_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.soilsurfaceresistance</span>
<span class="sd">        soilsurfaceresistance(inf, inf, inf, inf)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">PWP</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">NFk</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">BoWa</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SoilSurfaceResistance</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">VERS</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">,</span> <span class="n">WASSER</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">soilsurfaceresistance</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">nan</span>
            <span class="k">elif</span> <span class="n">der</span><span class="o">.</span><span class="n">nfk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">20.0</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">soilsurfaceresistance</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">100.0</span>
            <span class="k">elif</span> <span class="n">der</span><span class="o">.</span><span class="n">nfk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">d_free</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">pwp</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">),</span> <span class="n">der</span><span class="o">.</span><span class="n">nfk</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">soilsurfaceresistance</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="mf">100.0</span> <span class="o">*</span> <span class="n">der</span><span class="o">.</span><span class="n">nfk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">d_free</span> <span class="o">+</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="n">der</span><span class="o">.</span><span class="n">nfk</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">soilsurfaceresistance</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">inf</span></div>


<div class="viewcode-block" id="Calc_LanduseSurfaceResistance_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_LanduseSurfaceResistance_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_LanduseSurfaceResistance_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the surface resistance of vegetation, water and sealed areas.</span>
<span class="sd">    :cite:`ref-LARSIM` (based on :cite:`ref-Thompson1981`)</span>

<span class="sd">    Basic equations:</span>
<span class="sd">       :math:`LanduseSurfaceResistance = SR^* \\cdot \\left(3.5 \\cdot</span>
<span class="sd">       \\left(1 - \\frac{min(BoWa, PY)}{PY}\\right) +</span>
<span class="sd">       exp\\left(\\frac{0.2 \\cdot PY}{max(BoWa, 0)}\\right)\\right)`</span>

<span class="sd">      .. math::</span>
<span class="sd">        SR^* = \\begin{cases}</span>
<span class="sd">        SurfaceResistance</span>
<span class="sd">        &amp;|\\</span>
<span class="sd">        Lnk \\neq NADELW</span>
<span class="sd">        \\\\</span>
<span class="sd">        10\\,000</span>
<span class="sd">        &amp;|\\</span>
<span class="sd">        Lnk = NADELW \\;\\; \\land \\;\\;</span>
<span class="sd">        (TKor \\leq -5 \\;\\; \\lor \\;\\; \\Delta \\geq 2)</span>
<span class="sd">        \\\\</span>
<span class="sd">        min\\left(\\frac{25 \\cdot SurfaceResistance}{(TKor + 5)</span>
<span class="sd">       \\cdot (1 - \\Delta/2)}, 10\\,000\\right)</span>
<span class="sd">        &amp;|\\</span>
<span class="sd">        Lnk = NADELW \\;\\; \\land \\;\\;</span>
<span class="sd">        (-5 &lt; TKor &lt; 20 \\;\\; \\land \\;\\; \\Delta &lt; 2)</span>
<span class="sd">        \\\\</span>
<span class="sd">        min\\left(\\frac{SurfaceResistance}{(1 - \\Delta/2)}, 10\\,000\\right)</span>
<span class="sd">        &amp;|\\</span>
<span class="sd">        Lnk = NADELW \\;\\; \\land \\;\\;</span>
<span class="sd">        (20 \\leq TKor \\;\\; \\land \\;\\; \\Delta &lt; 2)</span>
<span class="sd">        \\end{cases}</span>

<span class="sd">      :math:`\\Delta = SaturationVapourPressure - ActualVapourPressure`</span>


<span class="sd">    Example:</span>

<span class="sd">        Method |Calc_LanduseSurfaceResistance_V1| relies on multiple</span>
<span class="sd">        discontinuous relationships, works different for different</span>
<span class="sd">        types of landuse-use, and uses montly varying base parameters.</span>
<span class="sd">        Hence, we try to start simple and introduce further complexities</span>
<span class="sd">        step by step.</span>

<span class="sd">        For sealed surfaces and water areas the original parameter values</span>
<span class="sd">        are in effect without any modification:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-05-30&quot;, &quot;2000-06-03&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(4)</span>
<span class="sd">        &gt;&gt;&gt; lnk(VERS, FLUSS, SEE, WASSER)</span>
<span class="sd">        &gt;&gt;&gt; surfaceresistance.fluss_mai = 0.0</span>
<span class="sd">        &gt;&gt;&gt; surfaceresistance.see_mai = 0.0</span>
<span class="sd">        &gt;&gt;&gt; surfaceresistance.wasser_mai = 0.0</span>
<span class="sd">        &gt;&gt;&gt; surfaceresistance.vers_mai = 500.0</span>
<span class="sd">        &gt;&gt;&gt; derived.moy.update()</span>
<span class="sd">        &gt;&gt;&gt; model.idx_sim = 1</span>
<span class="sd">        &gt;&gt;&gt; model.calc_landusesurfaceresistance_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.landusesurfaceresistance</span>
<span class="sd">        landusesurfaceresistance(500.0, 0.0, 0.0, 0.0)</span>

<span class="sd">        For all &quot;soil areas&quot;, we sligthly increase the original parameter</span>
<span class="sd">        value by a constant factor for wet soils (|BoWa| &gt; |PY|) and</span>
<span class="sd">        increase it even more for dry soils (|BoWa| &gt; |PY|).  For</span>
<span class="sd">        a completely dry soil, surface resistance becomes infinite:</span>

<span class="sd">        &gt;&gt;&gt; lnk(ACKER)</span>
<span class="sd">        &gt;&gt;&gt; py(0.0)</span>
<span class="sd">        &gt;&gt;&gt; surfaceresistance.acker_jun = 40.0</span>
<span class="sd">        &gt;&gt;&gt; states.bowa = 0.0, 10.0, 20.0, 30.0</span>
<span class="sd">        &gt;&gt;&gt; model.idx_sim = 2</span>
<span class="sd">        &gt;&gt;&gt; model.calc_landusesurfaceresistance_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.landusesurfaceresistance</span>
<span class="sd">        landusesurfaceresistance(inf, 48.85611, 48.85611, 48.85611)</span>

<span class="sd">        &gt;&gt;&gt; py(20.0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_landusesurfaceresistance_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.landusesurfaceresistance</span>
<span class="sd">        landusesurfaceresistance(inf, 129.672988, 48.85611, 48.85611)</span>

<span class="sd">        &gt;&gt;&gt; states.bowa = 17.0, 18.0, 19.0, 20.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_landusesurfaceresistance_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.landusesurfaceresistance</span>
<span class="sd">        landusesurfaceresistance(71.611234, 63.953955, 56.373101, 48.85611)</span>

<span class="sd">        Only for coniferous trees, we further increase surface resistance</span>
<span class="sd">        for low temperatures and high water vapour pressure deficits.</span>
<span class="sd">        The highest resistance value results from air temperatures lower</span>
<span class="sd">        than -5 °C or vapour deficits higher than 2 kPa:</span>

<span class="sd">        &gt;&gt;&gt; lnk(NADELW)</span>
<span class="sd">        &gt;&gt;&gt; surfaceresistance.nadelw_jun = 80.0</span>
<span class="sd">        &gt;&gt;&gt; states.bowa = 20.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkor = 30.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.saturationvapourpressure = 3.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.actualvapourpressure = 0.0, 1.0, 2.0, 3.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_landusesurfaceresistance_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.landusesurfaceresistance</span>
<span class="sd">        landusesurfaceresistance(12214.027582, 12214.027582, 195.424441,</span>
<span class="sd">                                 97.712221)</span>

<span class="sd">        &gt;&gt;&gt; fluxes.actualvapourpressure = 1.0, 1.01, 1.1, 1.2</span>
<span class="sd">        &gt;&gt;&gt; model.calc_landusesurfaceresistance_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.landusesurfaceresistance</span>
<span class="sd">        landusesurfaceresistance(12214.027582, 12214.027582, 1954.244413,</span>
<span class="sd">                                 977.122207)</span>

<span class="sd">        &gt;&gt;&gt; fluxes.actualvapourpressure = 2.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkor = -10.0, 5.0, 20.0, 35.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_landusesurfaceresistance_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.landusesurfaceresistance</span>
<span class="sd">        landusesurfaceresistance(12214.027582, 488.561103, 195.424441,</span>
<span class="sd">                                 195.424441)</span>

<span class="sd">        &gt;&gt;&gt; fluxes.tkor = -6.0, -5.0, -4.0, -3.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_landusesurfaceresistance_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.landusesurfaceresistance</span>
<span class="sd">        landusesurfaceresistance(12214.027582, 12214.027582, 4885.611033,</span>
<span class="sd">                                 2442.805516)</span>

<span class="sd">        &gt;&gt;&gt; fluxes.tkor = 18.0, 19.0, 20.0, 21.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_landusesurfaceresistance_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.landusesurfaceresistance</span>
<span class="sd">        landusesurfaceresistance(212.417871, 203.567126, 195.424441, 195.424441)</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">SurfaceResistance</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">PY</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">MOY</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TKor</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SaturationVapourPressure</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ActualVapourPressure</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">BoWa</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">LanduseSurfaceResistance</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="n">d_res</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">surfaceresistance</span><span class="p">[</span><span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">der</span><span class="o">.</span><span class="n">moy</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">idx_sim</span><span class="p">]]</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">NADELW</span><span class="p">:</span>
                <span class="n">d_def</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">saturationvapourpressure</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">actualvapourpressure</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">tkor</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mf">5.0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">d_def</span> <span class="o">&gt;=</span> <span class="mf">2.0</span><span class="p">):</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">landusesurfaceresistance</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">10000.0</span>
                <span class="k">elif</span> <span class="n">flu</span><span class="o">.</span><span class="n">tkor</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">20.0</span><span class="p">:</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">landusesurfaceresistance</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
                        <span class="p">(</span><span class="mf">25.0</span> <span class="o">*</span> <span class="n">d_res</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">tkor</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="mf">5.0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">d_def</span><span class="p">),</span>
                        <span class="mf">10000.0</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">landusesurfaceresistance</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
                        <span class="n">d_res</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">d_def</span><span class="p">),</span> <span class="mf">10000.0</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">landusesurfaceresistance</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">d_res</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="n">WASSER</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">,</span> <span class="n">VERS</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">landusesurfaceresistance</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">inf</span>
                <span class="k">elif</span> <span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">con</span><span class="o">.</span><span class="n">py</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">landusesurfaceresistance</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*=</span> <span class="mf">3.5</span> <span class="o">*</span> <span class="p">(</span>
                        <span class="mf">1.0</span> <span class="o">-</span> <span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">con</span><span class="o">.</span><span class="n">py</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                    <span class="p">)</span> <span class="o">+</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">0.2</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">py</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">landusesurfaceresistance</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span></div>


<div class="viewcode-block" id="Calc_ActualSurfaceResistance_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_ActualSurfaceResistance_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_ActualSurfaceResistance_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the total surface resistance. :cite:`ref-LARSIM`</span>
<span class="sd">    (based on :cite:`ref-Grant1975`)</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      :math:`ActualSurfaceResistance =</span>
<span class="sd">      \\left(w \\cdot \\frac{1}{SRD} +</span>
<span class="sd">      (1-w) \\cdot \\frac{1}{SRN}\\right)^{-1}`</span>

<span class="sd">      :math:`SRD =</span>
<span class="sd">      \\left(\\frac{1-0.7^{LAI}}{LanduseSurfaceResistance} +</span>
<span class="sd">      \\frac{0.7^{LAI}}{SoilSurfaceResistance}\\right)^{-1}`</span>

<span class="sd">      :math:`SRN =</span>
<span class="sd">      \\left(\\frac{LAI}{2500} + \\frac{1}{SoilSurfaceResistance}\\right)^{-1}`</span>

<span class="sd">      :math:`w = \\frac{PossibleSunshineDuration}{Hours}`</span>


<span class="sd">    Examples:</span>

<span class="sd">        For sealed surfaces and water areas, method</span>
<span class="sd">        |Calc_ActualSurfaceResistance_V1| just uses the values of sequence</span>
<span class="sd">        |LanduseSurfaceResistance| as the effective surface resistance values:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2019-05-30&quot;, &quot;2019-06-03&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(4)</span>
<span class="sd">        &gt;&gt;&gt; lnk(VERS, FLUSS, SEE, WASSER)</span>
<span class="sd">        &gt;&gt;&gt; derived.moy.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.hours.update()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.soilsurfaceresistance = nan</span>
<span class="sd">        &gt;&gt;&gt; fluxes.landusesurfaceresistance = 500.0, 0.0, 0.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.idx_sim = 1</span>
<span class="sd">        &gt;&gt;&gt; model.calc_actualsurfaceresistance_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.actualsurfaceresistance</span>
<span class="sd">        actualsurfaceresistance(500.0, 0.0, 0.0, 0.0)</span>

<span class="sd">        For all other landuse types, the final soil resistance is a</span>
<span class="sd">        combination of |LanduseSurfaceResistance| and |SoilSurfaceResistance|</span>
<span class="sd">        that depends on the leaf area index.  We demonstrate this for the</span>
<span class="sd">        landuse types |ACKER|, |OBSTB|, |LAUBW|, and |NADELW|, for which we</span>
<span class="sd">        define different leaf area indices:</span>

<span class="sd">        &gt;&gt;&gt; lnk(ACKER, OBSTB, LAUBW, NADELW)</span>
<span class="sd">        &gt;&gt;&gt; lai.acker_mai = 0.0</span>
<span class="sd">        &gt;&gt;&gt; lai.obstb_mai = 2.0</span>
<span class="sd">        &gt;&gt;&gt; lai.laubw_mai = 5.0</span>
<span class="sd">        &gt;&gt;&gt; lai.nadelw_mai = 10.0</span>

<span class="sd">        The soil and landuse surface resistance are identical for all</span>
<span class="sd">        four hydrological response units:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.soilsurfaceresistance = 200.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.landusesurfaceresistance = 100.0</span>

<span class="sd">        When we assume that the sun shines the whole day, the final</span>
<span class="sd">        resistance is identical with the soil surface resistance for</span>
<span class="sd">        zero leaf area indices (see the first response unit) and</span>
<span class="sd">        becomes closer to landuse surface resistance for when the</span>
<span class="sd">        leaf area index increases:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.possiblesunshineduration = 24.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_actualsurfaceresistance_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.actualsurfaceresistance</span>
<span class="sd">        actualsurfaceresistance(200.0, 132.450331, 109.174477, 101.43261)</span>

<span class="sd">        For a polar night, there is a leaf area index-dependend interpolation</span>
<span class="sd">        between soil surface resistance and a fixed resistance value:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.possiblesunshineduration = 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_actualsurfaceresistance_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.actualsurfaceresistance</span>
<span class="sd">        actualsurfaceresistance(200.0, 172.413793, 142.857143, 111.111111)</span>

<span class="sd">        For all days that are not polar nights or polar days, the values</span>
<span class="sd">        of the two examples above are weighted based on the possible</span>
<span class="sd">        sunshine duration of that day:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.possiblesunshineduration = 12.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_actualsurfaceresistance_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.actualsurfaceresistance</span>
<span class="sd">        actualsurfaceresistance(200.0, 149.812734, 123.765057, 106.051498)</span>

<span class="sd">        The following examples demonstrate that method</span>
<span class="sd">        |Calc_ActualSurfaceResistance_V1| works similar when applied on an</span>
<span class="sd">        hourly time basis during the daytime period (first example),</span>
<span class="sd">        during the nighttime (second example), and during dawn or</span>
<span class="sd">        dusk (third example):</span>

<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2019-05-31 22:00&quot;, &quot;2019-06-01 03:00&quot;, &quot;1h&quot;</span>
<span class="sd">        &gt;&gt;&gt; nhru(1)</span>
<span class="sd">        &gt;&gt;&gt; lnk(NADELW)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.soilsurfaceresistance = 200.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.landusesurfaceresistance = 100.0</span>
<span class="sd">        &gt;&gt;&gt; derived.moy.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.hours.update()</span>
<span class="sd">        &gt;&gt;&gt; lai.nadelw_jun = 5.0</span>
<span class="sd">        &gt;&gt;&gt; model.idx_sim = 2</span>
<span class="sd">        &gt;&gt;&gt; fluxes.possiblesunshineduration = 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_actualsurfaceresistance_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.actualsurfaceresistance</span>
<span class="sd">        actualsurfaceresistance(109.174477)</span>

<span class="sd">        &gt;&gt;&gt; fluxes.possiblesunshineduration = 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_actualsurfaceresistance_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.actualsurfaceresistance</span>
<span class="sd">        actualsurfaceresistance(142.857143)</span>

<span class="sd">        &gt;&gt;&gt; fluxes.possiblesunshineduration = 0.5</span>
<span class="sd">        &gt;&gt;&gt; model.calc_actualsurfaceresistance_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.actualsurfaceresistance</span>
<span class="sd">        actualsurfaceresistance(123.765057)</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">LAI</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">MOY</span><span class="p">,</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">Hours</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SoilSurfaceResistance</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">LanduseSurfaceResistance</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">PossibleSunshineDuration</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ActualSurfaceResistance</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">VERS</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">,</span> <span class="n">WASSER</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">actualsurfaceresistance</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">landusesurfaceresistance</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">d_lai</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">lai</span><span class="p">[</span><span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">der</span><span class="o">.</span><span class="n">moy</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">idx_sim</span><span class="p">]]</span>
                <span class="n">d_invrestday</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="mf">0.7</span> <span class="o">**</span> <span class="n">d_lai</span><span class="p">)</span> <span class="o">/</span> <span class="n">flu</span><span class="o">.</span><span class="n">landusesurfaceresistance</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="p">)</span> <span class="o">+</span> <span class="mf">0.7</span> <span class="o">**</span> <span class="n">d_lai</span> <span class="o">/</span> <span class="n">flu</span><span class="o">.</span><span class="n">soilsurfaceresistance</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">d_invrestnight</span> <span class="o">=</span> <span class="n">d_lai</span> <span class="o">/</span> <span class="mf">2500.0</span> <span class="o">+</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">flu</span><span class="o">.</span><span class="n">soilsurfaceresistance</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">actualsurfaceresistance</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span>
                    <span class="p">(</span>
                        <span class="n">flu</span><span class="o">.</span><span class="n">possiblesunshineduration</span> <span class="o">/</span> <span class="n">der</span><span class="o">.</span><span class="n">hours</span> <span class="o">*</span> <span class="n">d_invrestday</span>
                        <span class="o">+</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">possiblesunshineduration</span> <span class="o">/</span> <span class="n">der</span><span class="o">.</span><span class="n">hours</span><span class="p">)</span>
                        <span class="o">*</span> <span class="n">d_invrestnight</span>
                    <span class="p">)</span>
                <span class="p">)</span></div>


<div class="viewcode-block" id="Return_Penman_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Return_Penman_V1">[docs]</a><span class="k">class</span> <span class="nc">Return_Penman_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate and return the evaporation from water surfaces according to</span>
<span class="sd">    Penman :cite:`ref-LARSIM` (based on :cite:`ref-DVWK1996`).</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`Days \\cdot \\frac{DailySaturationVapourPressureSlope \\cdot</span>
<span class="sd">      \\frac{DailyNetRadiation}{LW} +</span>
<span class="sd">      Psy \\cdot (1.3 + 0.94 \\cdot DailyWindSpeed2m) \\cdot</span>
<span class="sd">      (DailySaturationVapourPressure-DailyActualVapourPressure)}</span>
<span class="sd">      {DailySaturationVapourPressureSlope + Psy}`</span>

<span class="sd">    Examples:</span>

<span class="sd">        We initialise seven hydrological response units.  In reponse units</span>
<span class="sd">        one to three, evaporation is due to radiative forcing only.  In</span>
<span class="sd">        response units four to six, evaporation is due to aerodynamic forcing</span>
<span class="sd">        only.  Response unit seven shows the combined effect of both forces:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(7)</span>
<span class="sd">        &gt;&gt;&gt; derived.days.update()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailynetradiation = 0.0, 3.5, 7.0, 0.0, 0.0, 0.0, 7.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailywindspeed2m = 2.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailysaturationvapourpressure = 1.2</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailysaturationvapourpressureslope = 0.08</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailyactualvapourpressure = 1.2, 1.2, 1.2, 1.2, 0.6, 0.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import print_values</span>
<span class="sd">        &gt;&gt;&gt; for hru in range(7):</span>
<span class="sd">        ...     deficit = (fluxes.dailysaturationvapourpressure[hru] -</span>
<span class="sd">        ...                fluxes.dailyactualvapourpressure[hru])</span>
<span class="sd">        ...     print_values([fluxes.dailynetradiation[hru],</span>
<span class="sd">        ...                   deficit,</span>
<span class="sd">        ...                   model.return_penman_v1(hru)])</span>
<span class="sd">        0.0, 0.0, 0.0</span>
<span class="sd">        3.5, 0.0, 0.781513</span>
<span class="sd">        7.0, 0.0, 1.563027</span>
<span class="sd">        0.0, 0.0, 0.0</span>
<span class="sd">        0.0, 0.6, 0.858928</span>
<span class="sd">        0.0, 1.2, 1.717856</span>
<span class="sd">        7.0, 1.2, 3.280882</span>

<span class="sd">        The above results apply for a daily simulation time step.  The</span>
<span class="sd">        following example demonstrates that  we get equivalent results</span>
<span class="sd">        for hourly time steps:</span>

<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; derived.days.update()</span>
<span class="sd">        &gt;&gt;&gt; for hru in range(7):</span>
<span class="sd">        ...     deficit = (fluxes.dailysaturationvapourpressure[hru] -</span>
<span class="sd">        ...                fluxes.dailyactualvapourpressure[hru])</span>
<span class="sd">        ...     print_values([fluxes.dailynetradiation[hru],</span>
<span class="sd">        ...                   deficit,</span>
<span class="sd">        ...                   24*model.return_penman_v1(hru)])</span>
<span class="sd">        0.0, 0.0, 0.0</span>
<span class="sd">        3.5, 0.0, 0.781513</span>
<span class="sd">        7.0, 0.0, 1.563027</span>
<span class="sd">        0.0, 0.0, 0.0</span>
<span class="sd">        0.0, 0.6, 0.858928</span>
<span class="sd">        0.0, 1.2, 1.717856</span>
<span class="sd">        7.0, 1.2, 3.280882</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">Days</span><span class="p">,)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">LW</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">Psy</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">DailySaturationVapourPressureSlope</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">DailyNetRadiation</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">DailyWindSpeed2m</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">DailySaturationVapourPressure</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">DailyActualVapourPressure</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span>
        <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">der</span><span class="o">.</span><span class="n">days</span>
            <span class="o">*</span> <span class="p">(</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">dailysaturationvapourpressureslope</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">dailynetradiation</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="o">/</span> <span class="n">fix</span><span class="o">.</span><span class="n">lw</span>
                <span class="o">+</span> <span class="n">fix</span><span class="o">.</span><span class="n">psy</span>
                <span class="o">*</span> <span class="p">(</span><span class="mf">1.3</span> <span class="o">+</span> <span class="mf">0.94</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">dailywindspeed2m</span><span class="p">)</span>
                <span class="o">*</span> <span class="p">(</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">dailysaturationvapourpressure</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                    <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">dailyactualvapourpressure</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="o">/</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">dailysaturationvapourpressureslope</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">fix</span><span class="o">.</span><span class="n">psy</span><span class="p">)</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Return_PenmanMonteith_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Return_PenmanMonteith_V1">[docs]</a><span class="k">class</span> <span class="nc">Return_PenmanMonteith_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate and return the evapotranspiration according to Penman-Monteith.</span>
<span class="sd">    :cite:`ref-LARSIM` (based on :cite:`ref-Thompson1981`)</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      :math:`\\frac{SaturationVapourPressureSlope \\cdot (NetRadiation + G) +</span>
<span class="sd">      Seconds \\cdot C \\cdot DensitiyAir \\cdot CPLuft \\cdot</span>
<span class="sd">      \\frac{SaturationVapourPressure - ActualVapourPressure}</span>
<span class="sd">      {AerodynamicResistance^*}}</span>
<span class="sd">      {LW \\cdot (SaturationVapourPressureSlope + Psy \\cdot</span>
<span class="sd">      C \\cdot (1 + \\frac{actualsurfaceresistance}{AerodynamicResistance^*}))}`</span>

<span class="sd">      :math:`C = 1 +</span>
<span class="sd">      \\frac{b&#39; \\cdot AerodynamicResistance^*}{DensitiyAir \\cdot CPLuft}`</span>

<span class="sd">      :math:`b&#39; = 4 \\cdot Emissivity \\cdot</span>
<span class="sd">      \\frac{Sigma}{60 \\cdot 60 \\cdot 24} \\cdot (273.15 + TKor)^3`</span>

<span class="sd">      :math:`AerodynamicResistance^* =</span>
<span class="sd">      min\\Bigl(max\\bigl(AerodynamicResistance, 10^{-6}\\bigl), 10^6\\Bigl)`</span>

<span class="sd">    Correction factor `C` takes the difference between measured temperature</span>
<span class="sd">    and actual surface temperature into account.</span>

<span class="sd">    Example:</span>

<span class="sd">        We build the following example on the first example of the</span>
<span class="sd">        documentation on method |Return_Penman_V1|.  The total available</span>
<span class="sd">        energy (|NetRadiation| plus |G|) and the vapour saturation pressure</span>
<span class="sd">        deficit (|SaturationVapourPressure| minus |ActualVapourPressure|</span>
<span class="sd">        are identical.  To make the results roughly comparable, we use</span>
<span class="sd">        resistances suitable for water surfaces through setting</span>
<span class="sd">        |ActualSurfaceResistance| to zero and |AerodynamicResistance| to</span>
<span class="sd">        a reasonable precalculated value of 106 s/m:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(7)</span>
<span class="sd">        &gt;&gt;&gt; emissivity(0.96)</span>
<span class="sd">        &gt;&gt;&gt; derived.seconds.update()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.netradiation = 1.0, 4.5, 8.0, 1.0, 1.0, 1.0, 8.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.g = -1.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.saturationvapourpressure = 1.2</span>
<span class="sd">        &gt;&gt;&gt; fluxes.saturationvapourpressureslope = 0.08</span>
<span class="sd">        &gt;&gt;&gt; fluxes.actualvapourpressure = 1.2, 1.2, 1.2, 1.2, 0.6, 0.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.densityair = 1.24</span>
<span class="sd">        &gt;&gt;&gt; fluxes.actualsurfaceresistance = 0.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.aerodynamicresistance = 106.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkor = 10.0</span>

<span class="sd">        For the first three hydrological response units with energy forcing</span>
<span class="sd">        only, there is a relatively small deviation to the results of method</span>
<span class="sd">        |Return_Penman_v1| due to the correction factor `C`, which is only</span>
<span class="sd">        implemented by method |Return_PenmanMonteith_v1|.  For response</span>
<span class="sd">        units four to six with dynamic forcing only, the results of method</span>
<span class="sd">        |Return_PenmanMonteith_v1| are more than twice as large as those</span>
<span class="sd">        of method |Return_Penman_v1|:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import print_values</span>
<span class="sd">        &gt;&gt;&gt; for hru in range(7):</span>
<span class="sd">        ...     deficit = (fluxes.saturationvapourpressure[hru] -</span>
<span class="sd">        ...                fluxes.actualvapourpressure[hru])</span>
<span class="sd">        ...     print_values([fluxes.netradiation[hru]+fluxes.g[hru],</span>
<span class="sd">        ...                   deficit,</span>
<span class="sd">        ...                   model.return_penmanmonteith_v1(</span>
<span class="sd">        ...                       hru, fluxes.actualsurfaceresistance[hru])])</span>
<span class="sd">        0.0, 0.0, 0.0</span>
<span class="sd">        3.5, 0.0, 0.657142</span>
<span class="sd">        7.0, 0.0, 1.314284</span>
<span class="sd">        0.0, 0.0, 0.0</span>
<span class="sd">        0.0, 0.6, 2.031724</span>
<span class="sd">        0.0, 1.2, 4.063447</span>
<span class="sd">        7.0, 1.2, 5.377732</span>

<span class="sd">        Next, we repeat the above calculations using resistances relevant</span>
<span class="sd">        for vegetated surfaces (note that this also changes the results</span>
<span class="sd">        of the first three response units due to correction factor `C`</span>
<span class="sd">        depending on |AerodynamicResistance|):</span>

<span class="sd">        &gt;&gt;&gt; fluxes.actualsurfaceresistance = 80.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.aerodynamicresistance = 40.0</span>
<span class="sd">        &gt;&gt;&gt; for hru in range(7):</span>
<span class="sd">        ...     deficit = (fluxes.saturationvapourpressure[hru] -</span>
<span class="sd">        ...                fluxes.actualvapourpressure[hru])</span>
<span class="sd">        ...     print_values([fluxes.netradiation[hru]+fluxes.g[hru],</span>
<span class="sd">        ...                   deficit,</span>
<span class="sd">        ...                   model.return_penmanmonteith_v1(</span>
<span class="sd">        ...                       hru, fluxes.actualsurfaceresistance[hru])])</span>
<span class="sd">        0.0, 0.0, 0.0</span>
<span class="sd">        3.5, 0.0, 0.36958</span>
<span class="sd">        7.0, 0.0, 0.739159</span>
<span class="sd">        0.0, 0.0, 0.0</span>
<span class="sd">        0.0, 0.6, 2.469986</span>
<span class="sd">        0.0, 1.2, 4.939972</span>
<span class="sd">        7.0, 1.2, 5.679131</span>

<span class="sd">        The above results are sensitive to the relation of</span>
<span class="sd">        |ActualSurfaceResistance| and |AerodynamicResistance|.  The</span>
<span class="sd">        following example demonstrates this sensitivity through varying</span>
<span class="sd">        |ActualSurfaceResistance| over a wide range:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.netradiation = 8.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.actualvapourpressure = 0.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.actualsurfaceresistance = (</span>
<span class="sd">        ...     0.0, 20.0, 50.0, 100.0, 200.0, 500.0, 1000.0)</span>
<span class="sd">        &gt;&gt;&gt; for hru in range(7):</span>
<span class="sd">        ...     print_values([fluxes.actualsurfaceresistance[hru],</span>
<span class="sd">        ...                   model.return_penmanmonteith_v1(</span>
<span class="sd">        ...                       hru, fluxes.actualsurfaceresistance[hru])])</span>
<span class="sd">        0.0, 11.208588</span>
<span class="sd">        20.0, 9.014385</span>
<span class="sd">        50.0, 6.968226</span>
<span class="sd">        100.0, 5.055617</span>
<span class="sd">        200.0, 3.263897</span>
<span class="sd">        500.0, 1.581954</span>
<span class="sd">        1000.0, 0.851033</span>

<span class="sd">        One potential pitfall of the given Penman-Monteith equation is that</span>
<span class="sd">        |AerodynamicResistance| becomes infinite for zero windspeed.  We</span>
<span class="sd">        protect method |Return_PenmanMonteith_V1| against this problem</span>
<span class="sd">        (and the less likely problem of zero aerodynamic resistance) by</span>
<span class="sd">        limiting the value of |AerodynamicResistance| to the interval</span>
<span class="sd">        :math:`[10^{-6}, 10^6]`:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.actualvapourpressure = 0.6</span>
<span class="sd">        &gt;&gt;&gt; fluxes.actualsurfaceresistance = 80.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.aerodynamicresistance = (</span>
<span class="sd">        ...     0.0, 1e-6, 1e-3, 1.0, 1e3, 1e6, inf)</span>
<span class="sd">        &gt;&gt;&gt; for hru in range(7):</span>
<span class="sd">        ...     print_values([fluxes.aerodynamicresistance[hru],</span>
<span class="sd">        ...                   model.return_penmanmonteith_v1(</span>
<span class="sd">        ...                       hru, fluxes.actualsurfaceresistance[hru])])</span>
<span class="sd">        0.0, 5.00683</span>
<span class="sd">        0.000001, 5.00683</span>
<span class="sd">        0.001, 5.006734</span>
<span class="sd">        1.0, 4.91391</span>
<span class="sd">        1000.0, 0.829364</span>
<span class="sd">        1000000.0, 0.001275</span>
<span class="sd">        inf, 0.001275</span>

<span class="sd">        Now we change the simulation time step from one day to one hour</span>
<span class="sd">        to demonstrate that we can reproduce the results of the first</span>
<span class="sd">        example, which requires to adjust |NetRadiation| and |WG|:</span>

<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; derived.seconds.update()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.netradiation = 1.0, 4.5, 8.0, 1.0, 1.0, 1.0, 8.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.netradiation /= 24</span>
<span class="sd">        &gt;&gt;&gt; fluxes.g = -1.0/24</span>
<span class="sd">        &gt;&gt;&gt; fluxes.actualvapourpressure = 1.2, 1.2, 1.2, 1.2, 0.6, 0.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.actualsurfaceresistance = 0.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.aerodynamicresistance = 106.0</span>
<span class="sd">        &gt;&gt;&gt; for hru in range(7):</span>
<span class="sd">        ...     deficit = (fluxes.saturationvapourpressure[hru] -</span>
<span class="sd">        ...                fluxes.actualvapourpressure[hru])</span>
<span class="sd">        ...     print_values([24*(fluxes.netradiation[hru]+fluxes.g[hru]),</span>
<span class="sd">        ...                   deficit,</span>
<span class="sd">        ...                   24*model.return_penmanmonteith_v1(</span>
<span class="sd">        ...                       hru, fluxes.actualsurfaceresistance[hru])])</span>
<span class="sd">        0.0, 0.0, 0.0</span>
<span class="sd">        3.5, 0.0, 0.657142</span>
<span class="sd">        7.0, 0.0, 1.314284</span>
<span class="sd">        0.0, 0.0, 0.0</span>
<span class="sd">        0.0, 0.6, 2.031724</span>
<span class="sd">        0.0, 1.2, 4.063447</span>
<span class="sd">        7.0, 1.2, 5.377732</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">Emissivity</span><span class="p">,)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">Seconds</span><span class="p">,)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">Sigma</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">LW</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">CPLuft</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">Psy</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NetRadiation</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">G</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TKor</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SaturationVapourPressureSlope</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SaturationVapourPressure</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ActualVapourPressure</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">DensityAir</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">AerodynamicResistance</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span>
        <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">actualsurfaceresistance</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">d_ar</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">aerodynamicresistance</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="mf">1e-6</span><span class="p">),</span> <span class="mf">1e6</span><span class="p">)</span>
        <span class="n">d_b</span> <span class="o">=</span> <span class="p">(</span>
            <span class="mf">4.0</span>
            <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">emissivity</span>
            <span class="o">*</span> <span class="n">fix</span><span class="o">.</span><span class="n">sigma</span>
            <span class="o">/</span> <span class="mf">60.0</span>
            <span class="o">/</span> <span class="mf">60.0</span>
            <span class="o">/</span> <span class="mf">24.0</span>
            <span class="o">*</span> <span class="p">(</span><span class="mf">273.15</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">tkor</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">**</span> <span class="mi">3</span>
        <span class="p">)</span>
        <span class="n">d_c</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="n">d_b</span> <span class="o">*</span> <span class="n">d_ar</span> <span class="o">/</span> <span class="n">flu</span><span class="o">.</span><span class="n">densityair</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">fix</span><span class="o">.</span><span class="n">cpluft</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="p">(</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">saturationvapourpressureslope</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">netradiation</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">g</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="o">+</span> <span class="n">der</span><span class="o">.</span><span class="n">seconds</span>
                <span class="o">*</span> <span class="n">d_c</span>
                <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">densityair</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="o">*</span> <span class="n">fix</span><span class="o">.</span><span class="n">cpluft</span>
                <span class="o">*</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">saturationvapourpressure</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">actualvapourpressure</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="o">/</span> <span class="n">d_ar</span>
            <span class="p">)</span>
            <span class="o">/</span> <span class="p">(</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">saturationvapourpressureslope</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="o">+</span> <span class="n">fix</span><span class="o">.</span><span class="n">psy</span> <span class="o">*</span> <span class="n">d_c</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">actualsurfaceresistance</span> <span class="o">/</span> <span class="n">d_ar</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="o">/</span> <span class="n">fix</span><span class="o">.</span><span class="n">lw</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Calc_EvPo_V2"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_EvPo_V2">[docs]</a><span class="k">class</span> <span class="nc">Calc_EvPo_V2</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the potential evaporation according to Penman or</span>
<span class="sd">    Penman-Monteith.</span>

<span class="sd">    Method |Calc_EvPo_V2| applies method |Return_Penman_V1| on all water</span>
<span class="sd">    areas and method |Return_PenmanMonteith_V1| on all other hydrological</span>
<span class="sd">    response units.  For Penman-Monteith, we yield potential values by passing</span>
<span class="sd">    zero surface resistance values to method |Return_PenmanMonteith_V1|.</span>

<span class="sd">    Example:</span>

<span class="sd">        We recalculate the results for the seventh hydrological response</span>
<span class="sd">        unit of the first example of the documention on the methods</span>
<span class="sd">        |Return_Penman_V1| and |Return_PenmanMonteith_V1|.  The calculated</span>
<span class="sd">        potential values differ markedly:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(2)</span>
<span class="sd">        &gt;&gt;&gt; lnk(WASSER, ACKER)</span>
<span class="sd">        &gt;&gt;&gt; emissivity(0.96)</span>
<span class="sd">        &gt;&gt;&gt; derived.nmblogentries.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.seconds.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.days.update()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.netradiation = 8.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailynetradiation = 7.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.saturationvapourpressure = 1.2</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailysaturationvapourpressure = 1.2</span>
<span class="sd">        &gt;&gt;&gt; fluxes.saturationvapourpressureslope = 0.08</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailysaturationvapourpressureslope = 0.08</span>
<span class="sd">        &gt;&gt;&gt; fluxes.actualvapourpressure = 0.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailyactualvapourpressure = 0.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.windspeed2m = 2.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailywindspeed2m = 2.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkor = 10.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.g = -1.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.densityair = 1.24</span>
<span class="sd">        &gt;&gt;&gt; fluxes.aerodynamicresistance = 106.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_evpo_v2()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evpo</span>
<span class="sd">        evpo(3.280882, 5.377732)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Return_Penman_V1</span><span class="p">,</span>
        <span class="n">Return_PenmanMonteith_V1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Emissivity</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">Days</span><span class="p">,</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">Seconds</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">Sigma</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">LW</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">CPLuft</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">Psy</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NetRadiation</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">G</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TKor</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SaturationVapourPressureSlope</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SaturationVapourPressure</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ActualVapourPressure</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">DensityAir</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">AerodynamicResistance</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">DailySaturationVapourPressureSlope</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">DailyNetRadiation</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">DailyWindSpeed2m</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">DailySaturationVapourPressure</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">DailyActualVapourPressure</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">EvPo</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">WASSER</span><span class="p">,</span> <span class="n">SEE</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">evpo</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_penman_v1</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">evpo</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_penmanmonteith_v1</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span></div>


<div class="viewcode-block" id="Calc_EvS_WAeS_WATS_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_EvS_WAeS_WATS_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_EvS_WAeS_WATS_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the evaporation from the snow layer, if any exists, and</span>
<span class="sd">    update the snow cover accordingly.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      :math:`WAeS_{new} = f \\cdot WAeS_{old}`</span>

<span class="sd">      :math:`WATS_{new} = f \\cdot WATS_{old}`</span>

<span class="sd">      :math:`f = \\frac{WAeS-EvS}{WAeS}`</span>

<span class="sd">      :math:`EvS = max\\left(\\frac{WLatSnow}{L}, WAeS\\right)`</span>

<span class="sd">    Example:</span>

<span class="sd">        The first hydrological response unit shows that method</span>
<span class="sd">        |Calc_EvS_WAeS_WATS_V1| does calculate condensation and deposition</span>
<span class="sd">        if a negative flux of latent heat suggests so.  We define the</span>
<span class="sd">        relative amounts of condensation and deposition so that the fraction</span>
<span class="sd">        between the frozen and the total water content of the snow layer</span>
<span class="sd">        does not change.  The same holds for vaporisation and sublimation,</span>
<span class="sd">        as shown by response units to to seven.  Note that method</span>
<span class="sd">        |Calc_EvS_WAeS_WATS_V1| prevents negative water contents but does</span>
<span class="sd">        not prevent to high liquid water contents, which eventually needs</span>
<span class="sd">        to be corrected by another method called subsequentially.  The last</span>
<span class="sd">        response unit shows that method |Calc_EvS_WAeS_WATS_V1| sets |EvS|,</span>
<span class="sd">        |WATS| and |WAeS| to zero for water areas:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(8)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER, ACKER, ACKER, ACKER, ACKER, ACKER, ACKER, WASSER)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wlatsnow = -1.0, 0.0, 2.0, 4.0, 6.0, 6.0, 6.0, 6.0</span>
<span class="sd">        &gt;&gt;&gt; states.waes = 2.0, 2.0, 2.0, 2.0, 2.0, 1.5, 0.0, 2.0</span>
<span class="sd">        &gt;&gt;&gt; states.wats = 1.0, 1.0, 1.0, 1.0, 1.0, 0.5, 0.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_evs_waes_wats_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evs</span>
<span class="sd">        evs(-0.37489, 0.0, 0.74978, 1.49956, 2.0, 1.5, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.waes</span>
<span class="sd">        waes(2.37489, 2.0, 1.25022, 0.50044, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.wats</span>
<span class="sd">        wats(1.187445, 1.0, 0.62511, 0.25022, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fixed</span><span class="o">.</span><span class="n">LWE</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WLatSnow</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">EvS</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">WAeS</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">WATS</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">WASSER</span><span class="p">,</span> <span class="n">SEE</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">evs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">wats</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">evs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">wlatsnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">fix</span><span class="o">.</span><span class="n">lwe</span><span class="p">,</span> <span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="n">d_frac</span> <span class="o">=</span> <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">evs</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">/</span> <span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*=</span> <span class="n">d_frac</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">wats</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*=</span> <span class="n">d_frac</span></div>


<div class="viewcode-block" id="Calc_EvI_Inzp_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_EvI_Inzp_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_EvI_Inzp_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate interception evaporation and update the interception</span>
<span class="sd">    storage accordingly.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`\\frac{dInzp}{dt} = -EvI`</span>

<span class="sd">      .. math::</span>
<span class="sd">        EvI = \\begin{cases}</span>
<span class="sd">        EvPo</span>
<span class="sd">        &amp;|\\</span>
<span class="sd">        Inzp &gt; 0</span>
<span class="sd">        \\\\</span>
<span class="sd">        0</span>
<span class="sd">        &amp;|\\</span>
<span class="sd">        Inzp = 0</span>
<span class="sd">        \\end{cases}</span>

<span class="sd">    Examples:</span>

<span class="sd">        For all &quot;land response units&quot; like arable land (|ACKER|), interception</span>
<span class="sd">        evaporation (|EvI|) is identical with potential evapotranspiration</span>
<span class="sd">        (|EvPo|) as long as it is met by available intercepted water (|Inzp|):</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(3)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER)</span>
<span class="sd">        &gt;&gt;&gt; states.inzp = 0.0, 2.0, 4.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evpo = 3.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_evi_inzp_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.inzp</span>
<span class="sd">        inzp(0.0, 0.0, 1.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evi</span>
<span class="sd">        evi(0.0, 2.0, 3.0)</span>

<span class="sd">        For water areas (|WASSER|, |FLUSS| and |SEE|), |EvI| is generally</span>
<span class="sd">        equal to |EvPo| (but this might be corrected by a method called</span>
<span class="sd">        after |Calc_EvI_Inzp_V1| has been applied) and |Inzp| is set to zero:</span>

<span class="sd">        &gt;&gt;&gt; lnk(WASSER, FLUSS, SEE)</span>
<span class="sd">        &gt;&gt;&gt; states.inzp = 2.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evpo = 3.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_evi_inzp_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.inzp</span>
<span class="sd">        inzp(0.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evi</span>
<span class="sd">        evi(3.0, 3.0, 3.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">EvPo</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">Inzp</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">EvI</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">WASSER</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">evi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">evpo</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">inzp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">evi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">evpo</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">sta</span><span class="o">.</span><span class="n">inzp</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">inzp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-=</span> <span class="n">flu</span><span class="o">.</span><span class="n">evi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>


<div class="viewcode-block" id="Calc_EvI_Inzp_V2"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_EvI_Inzp_V2">[docs]</a><span class="k">class</span> <span class="nc">Calc_EvI_Inzp_V2</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate interception evaporation and update the interception</span>
<span class="sd">    storage accordingly.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`\frac{dInzp}{dt} = -EvI`</span>

<span class="sd">      .. math::</span>
<span class="sd">        EvI = \begin{cases}</span>
<span class="sd">        EvPo</span>
<span class="sd">        &amp;|\</span>
<span class="sd">        Inzp &gt; 0 \land ( Forest \lor WAeS = 0 )</span>
<span class="sd">        \\</span>
<span class="sd">        0</span>
<span class="sd">        &amp;|\</span>
<span class="sd">        Inzp = 0 \lor ( \lnot Forest \land WAeS &gt; 0 )</span>
<span class="sd">        \end{cases}</span>

<span class="sd">    Examples:</span>

<span class="sd">        For all forest land-use types (|LAUBW|, |MISCHW|, |NADELW|), interception</span>
<span class="sd">        evaporation (|EvI|) is identical with potential evapotranspiration</span>
<span class="sd">        (|EvPo|) as long as it is met by available intercepted water (|Inzp|):</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(3)</span>
<span class="sd">        &gt;&gt;&gt; lnk(LAUBW, MISCHW, NADELW)</span>
<span class="sd">        &gt;&gt;&gt; states.inzp = 0.0, 2.0, 4.0</span>
<span class="sd">        &gt;&gt;&gt; states.waes = 0.0, 0.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evpo = 3.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_evi_inzp_v2()</span>
<span class="sd">        &gt;&gt;&gt; states.inzp</span>
<span class="sd">        inzp(0.0, 0.0, 1.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evi</span>
<span class="sd">        evi(0.0, 2.0, 3.0)</span>

<span class="sd">        For all other land areas, no interception evaporation occurs when a snow</span>
<span class="sd">        cover is present (indicated by a |WAeS| values larger zero):</span>

<span class="sd">        &gt;&gt;&gt; lnk(ACKER)</span>
<span class="sd">        &gt;&gt;&gt; states.inzp = 0.0, 2.0, 4.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_evi_inzp_v2()</span>
<span class="sd">        &gt;&gt;&gt; states.inzp</span>
<span class="sd">        inzp(0.0, 0.0, 4.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evi</span>
<span class="sd">        evi(0.0, 2.0, 0.0)</span>

<span class="sd">        For water areas (|WASSER|, |FLUSS| and |SEE|), |EvI| is generally</span>
<span class="sd">        equal to |EvPo| (but this might be corrected by a method called</span>
<span class="sd">        after |Calc_EvI_Inzp_V2| has been applied) and |Inzp| is set to zero:</span>

<span class="sd">        &gt;&gt;&gt; lnk(WASSER, FLUSS, SEE)</span>
<span class="sd">        &gt;&gt;&gt; states.inzp = 2.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evpo = 3.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_evi_inzp_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.inzp</span>
<span class="sd">        inzp(0.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evi</span>
<span class="sd">        evi(3.0, 3.0, 3.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">EvPo</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">WAeS</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">Inzp</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">EvI</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">WASSER</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">evi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">evpo</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">inzp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">elif</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">LAUBW</span><span class="p">,</span> <span class="n">MISCHW</span><span class="p">,</span> <span class="n">NADELW</span><span class="p">)</span> <span class="ow">or</span> <span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">evi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">evpo</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">sta</span><span class="o">.</span><span class="n">inzp</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">inzp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-=</span> <span class="n">flu</span><span class="o">.</span><span class="n">evi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">evi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>


<div class="viewcode-block" id="Calc_EvI_Inzp_V3"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_EvI_Inzp_V3">[docs]</a><span class="k">class</span> <span class="nc">Calc_EvI_Inzp_V3</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate interception evaporation and update the interception storage</span>
<span class="sd">    accordingly if the snow interception storage is empty.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`\frac{dInzp}{dt} = -EvI`</span>

<span class="sd">      .. math::</span>
<span class="sd">        EvI = \begin{cases}</span>
<span class="sd">        EvPo &amp;|\ Inzp &gt; 0 \land</span>
<span class="sd">        \big( ( Forest \land SInz = 0 ) \lor ( \lnot Forest \land WAeS = 0 ) \big)</span>
<span class="sd">        \\</span>
<span class="sd">        0 &amp;|\ Inzp = 0 \lor</span>
<span class="sd">        \big( ( Forest \land SInz &gt; 0) \lor ( \lnot Forest \land WAeS &gt; 0 ) \big)</span>
<span class="sd">        \end{cases}</span>

<span class="sd">    Examples:</span>

<span class="sd">        For all forest land-use types (|LAUBW|, |MISCHW|, |NADELW|), interception</span>
<span class="sd">        evaporation (|EvI|) is identical with potential evapotranspiration (|EvPo|)</span>
<span class="sd">        as long as it is met by available intercepted water (|Inzp|) and there is no</span>
<span class="sd">        intercepted snow (indicated by |SInz| values larger zero):</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(4)</span>
<span class="sd">        &gt;&gt;&gt; lnk(LAUBW, MISCHW, NADELW, NADELW)</span>
<span class="sd">        &gt;&gt;&gt; states.inzp = 2.0, 4.0, 4.0, 4.0</span>
<span class="sd">        &gt;&gt;&gt; states.sinz = 0.0, 0.0, 1.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; states.waes = 0.0, 0.0, 0.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evpo = 3.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_evi_inzp_v3()</span>
<span class="sd">        &gt;&gt;&gt; states.inzp</span>
<span class="sd">        inzp(0.0, 1.0, 4.0, 1.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evi</span>
<span class="sd">        evi(2.0, 3.0, 0.0, 3.0)</span>

<span class="sd">        For all other land areas, no interception evaporation occurs when a snow</span>
<span class="sd">        cover is present (indicated by a |WAeS| values larger zero):</span>

<span class="sd">        &gt;&gt;&gt; lnk(ACKER)</span>
<span class="sd">        &gt;&gt;&gt; states.inzp = 2.0, 4.0, 4.0, 4.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_evi_inzp_v3()</span>
<span class="sd">        &gt;&gt;&gt; states.inzp</span>
<span class="sd">        inzp(0.0, 1.0, 1.0, 4.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evi</span>
<span class="sd">        evi(2.0, 3.0, 3.0, 0.0)</span>

<span class="sd">        For water areas (|WASSER|, |FLUSS| and |SEE|), |EvI| is generally</span>
<span class="sd">        equal to |EvPo| (but this might be corrected by a method called</span>
<span class="sd">        after |Calc_EvI_Inzp_V3| has been applied) and |Inzp| is set to zero:</span>

<span class="sd">        &gt;&gt;&gt; lnk(WASSER, FLUSS, SEE, SEE)</span>
<span class="sd">        &gt;&gt;&gt; states.inzp = 2.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evpo = 3.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_evi_inzp_v3()</span>
<span class="sd">        &gt;&gt;&gt; states.inzp</span>
<span class="sd">        inzp(0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evi</span>
<span class="sd">        evi(3.0, 3.0, 3.0, 3.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">EvPo</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">SInz</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">WAeS</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">Inzp</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">EvI</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">WASSER</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">evi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">evpo</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">inzp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">elif</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">LAUBW</span><span class="p">,</span> <span class="n">MISCHW</span><span class="p">,</span> <span class="n">NADELW</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">sinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">evi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">evpo</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">sta</span><span class="o">.</span><span class="n">inzp</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                    <span class="n">sta</span><span class="o">.</span><span class="n">inzp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-=</span> <span class="n">flu</span><span class="o">.</span><span class="n">evi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">evi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">elif</span> <span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">evi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">evpo</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">sta</span><span class="o">.</span><span class="n">inzp</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">inzp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-=</span> <span class="n">flu</span><span class="o">.</span><span class="n">evi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">evi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>


<div class="viewcode-block" id="Calc_EvB_V2"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_EvB_V2">[docs]</a><span class="k">class</span> <span class="nc">Calc_EvB_V2</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the actual evapotranspiration from the soil.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`EvB = \\frac{EvPo - EvI}{EvPo} \\cdot</span>
<span class="sd">      Return\\_PenmanMonteith\\_V1(ActualSurfaceResistance)`</span>

<span class="sd">    Example:</span>

<span class="sd">        For sealed surfaces, water areas and snow-covered hydrological response units</span>
<span class="sd">        that are not forests, there is no soil evapotranspiration:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(6)</span>
<span class="sd">        &gt;&gt;&gt; lnk(VERS, WASSER, FLUSS, SEE, ACKER, ACKER)</span>
<span class="sd">        &gt;&gt;&gt; states.waes = 0.0, 0.0, 0.0, 0.0, 0.1, 10.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_evb_v2()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evb</span>
<span class="sd">        evb(0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>

<span class="sd">        For all other cases, method |Calc_EvB_V2| first applies method</span>
<span class="sd">        |Return_PenmanMonteith_V1| (of which&#39;s documentation we take</span>
<span class="sd">        most of the following test configuration) and adjusts the returned</span>
<span class="sd">        soil evapotranspiration to the (prioritised) interception evaporation</span>
<span class="sd">        in accordance with the base equation defined above:</span>

<span class="sd">        &gt;&gt;&gt; lnk(NADELW)</span>
<span class="sd">        &gt;&gt;&gt; emissivity(0.96)</span>
<span class="sd">        &gt;&gt;&gt; derived.seconds.update()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.netradiation = 8.0, 8.0, 8.0, 8.0, 8.0, -30.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.g = -1.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.saturationvapourpressure = 1.2</span>
<span class="sd">        &gt;&gt;&gt; fluxes.saturationvapourpressureslope = 0.08</span>
<span class="sd">        &gt;&gt;&gt; fluxes.actualvapourpressure = 0.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.densityair = 1.24</span>
<span class="sd">        &gt;&gt;&gt; fluxes.actualsurfaceresistance = 0.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.aerodynamicresistance = 106.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkor = 10.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evpo = 0.0, 6.0, 6.0, 6.0, 6.0, -6.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evi = 0.0, 0.0, 2.0, 4.0, 6.0, -3.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_evb_v2()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evb</span>
<span class="sd">        evb(0.0, 5.377732, 3.585154, 1.792577, 0.0, -0.878478)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Return_PenmanMonteith_V1</span><span class="p">,)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Emissivity</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">Seconds</span><span class="p">,)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">Sigma</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">LW</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">CPLuft</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">Psy</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NetRadiation</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">G</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TKor</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SaturationVapourPressureSlope</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SaturationVapourPressure</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ActualVapourPressure</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">DensityAir</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">AerodynamicResistance</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ActualSurfaceResistance</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">EvPo</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">EvI</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">WAeS</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">EvB</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">VERS</span><span class="p">,</span> <span class="n">WASSER</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">))</span>
                <span class="ow">or</span> <span class="p">((</span><span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="n">LAUBW</span><span class="p">,</span> <span class="n">MISCHW</span><span class="p">,</span> <span class="n">NADELW</span><span class="p">)</span> <span class="ow">and</span> <span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">))</span>
                <span class="ow">or</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">evpo</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">evb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">evb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">evpo</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">evi</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                    <span class="o">/</span> <span class="n">flu</span><span class="o">.</span><span class="n">evpo</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                    <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">return_penmanmonteith_v1</span><span class="p">(</span>
                        <span class="n">k</span><span class="p">,</span>
                        <span class="n">flu</span><span class="o">.</span><span class="n">actualsurfaceresistance</span><span class="p">[</span><span class="n">k</span><span class="p">],</span>
                    <span class="p">)</span>
                <span class="p">)</span></div>


<div class="viewcode-block" id="Calc_QKap_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_QKap_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_QKap_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the capillary rise.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`QKap = KapMax \\cdot min\\left(max\\left(1 -</span>
<span class="sd">      \\frac{BoWa-KapGrenz_1}{KapGrenz_2-KapGrenz_1}, 0 \\right), 1 \\right)`</span>

<span class="sd">    Examples:</span>

<span class="sd">        We prepare six hydrological response units of landuse type |ACKER|</span>
<span class="sd">        with different soil water contents:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(6)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER)</span>
<span class="sd">        &gt;&gt;&gt; wmax(100.0)</span>
<span class="sd">        &gt;&gt;&gt; states.bowa(0.0, 20.0, 40.0, 60.0, 80.0, 100.0)</span>

<span class="sd">        The maximum capillary rise is 3 mm/d (which is 1.5 mm for the</span>
<span class="sd">        actual simulation time step of 12 hours):</span>

<span class="sd">        &gt;&gt;&gt; kapmax(3.0)</span>

<span class="sd">        Please read the documentation on parameter |KapGrenz|, which gives</span>
<span class="sd">        some examples on how to configure the capillary rise thresholds.</span>
<span class="sd">        The following examples show the calculation results for with and</span>
<span class="sd">        without a range of linear transition:</span>

<span class="sd">        &gt;&gt;&gt; kapgrenz(20.0, 80.0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qkap_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qkap</span>
<span class="sd">        qkap(1.5, 1.5, 1.0, 0.5, 0.0, 0.0)</span>

<span class="sd">        &gt;&gt;&gt; kapgrenz(40.0, 40.0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qkap_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qkap</span>
<span class="sd">        qkap(1.5, 1.5, 1.5, 0.0, 0.0, 0.0)</span>

<span class="sd">        You are allowed to set the lower threshold to values lower than</span>
<span class="sd">        zero and the larger one to values larger than |WMax|:</span>

<span class="sd">        &gt;&gt;&gt; kapgrenz(-50.0, 150.0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qkap_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qkap</span>
<span class="sd">        qkap(1.125, 0.975, 0.825, 0.675, 0.525, 0.375)</span>

<span class="sd">        For water areas and sealed surfaces, capillary rise is always zero:</span>

<span class="sd">        &gt;&gt;&gt; lnk(WASSER, FLUSS, SEE, VERS, VERS, VERS)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qkap_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qkap</span>
<span class="sd">        qkap(0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">KapMax</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">KapGrenz</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">WMax</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">BoWa</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QKap</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">VERS</span><span class="p">,</span> <span class="n">WASSER</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">wmax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">qkap</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">elif</span> <span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">con</span><span class="o">.</span><span class="n">kapgrenz</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">]:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">qkap</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">kapmax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">con</span><span class="o">.</span><span class="n">kapgrenz</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">]:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">qkap</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">kapmax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span>
                    <span class="mf">1.0</span>
                    <span class="o">-</span> <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">kapgrenz</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
                    <span class="o">/</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">kapgrenz</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">kapgrenz</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">qkap</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="Calc_QBB_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_QBB_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_QBB_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the amount of base flow released from the soil.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      .. math::</span>
<span class="sd">        QBB = \\begin{cases}</span>
<span class="sd">        0</span>
<span class="sd">        &amp;|\\</span>
<span class="sd">        BoWa \\leq PWP \\;\\; \\lor \\;\\;</span>
<span class="sd">        (BoWa \\leq NFk \\;\\; \\land \\;\\; RBeta)</span>
<span class="sd">        \\\\</span>
<span class="sd">        Beta_{eff}  \\cdot (BoWa - PWP)</span>
<span class="sd">        &amp;|\\</span>
<span class="sd">        BoWa &gt; NFk \\;\\; \\lor \\;\\;</span>
<span class="sd">        (BoWa &gt; PWP \\;\\; \\land \\;\\; \\overline{RBeta})</span>
<span class="sd">        \\end{cases}</span>

<span class="sd">      .. math::</span>
<span class="sd">        Beta_{eff} = \\begin{cases}</span>
<span class="sd">        Beta</span>
<span class="sd">        &amp;|\\</span>
<span class="sd">        BoWa \\leq FK</span>
<span class="sd">        \\\\</span>
<span class="sd">        Beta \\cdot \\left(1+(FBeta-1)\\cdot\\frac{BoWa-FK}{WMax-FK}\\right)</span>
<span class="sd">        &amp;|\\</span>
<span class="sd">        BoWa &gt; FK</span>
<span class="sd">        \\end{cases}</span>

<span class="sd">    Examples:</span>

<span class="sd">        For water and sealed areas, no base flow is calculated (see the</span>
<span class="sd">        first three hydrological response units of type |VERS|, |FLUSS|, and</span>
<span class="sd">        |SEE|).  No principal distinction is made between the remaining land</span>
<span class="sd">        use classes (arable land |ACKER| has been selected for the last five</span>
<span class="sd">        HRUs arbitrarily):</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(8)</span>
<span class="sd">        &gt;&gt;&gt; lnk(FLUSS, SEE, VERS, ACKER, ACKER, ACKER, ACKER, ACKER)</span>
<span class="sd">        &gt;&gt;&gt; beta(0.04)</span>
<span class="sd">        &gt;&gt;&gt; fbeta(2.0)</span>
<span class="sd">        &gt;&gt;&gt; wmax(0.0, 0.0, 0.0, 0.0, 100.0, 100.0, 100.0, 200.0)</span>
<span class="sd">        &gt;&gt;&gt; fk(70.0)</span>
<span class="sd">        &gt;&gt;&gt; pwp(10.0)</span>
<span class="sd">        &gt;&gt;&gt; rbeta(False)</span>

<span class="sd">        Note the time dependence of parameter |Beta|:</span>

<span class="sd">        &gt;&gt;&gt; beta</span>
<span class="sd">        beta(0.04)</span>
<span class="sd">        &gt;&gt;&gt; beta.values</span>
<span class="sd">        array([ 0.02,  0.02,  0.02,  0.02,  0.02,  0.02,  0.02,  0.02])</span>

<span class="sd">        In the first example, the actual soil water content |BoWa| is set</span>
<span class="sd">        to low values.  For values below the threshold |PWP|, no percolation</span>
<span class="sd">        occurs.  Above |PWP| (but below |FK|), |QBB| increases linearly by</span>
<span class="sd">        an amount defined by parameter |Beta|:</span>

<span class="sd">        &gt;&gt;&gt; states.bowa = 20.0, 20.0, 20.0, 0.0, 0.0, 10.0, 20.0, 20.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qbb_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qbb</span>
<span class="sd">        qbb(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.2, 0.2)</span>

<span class="sd">        Note that for the last two response units the same amount of base</span>
<span class="sd">        flow generation is determined, in spite of the fact that both exhibit</span>
<span class="sd">        different relative soil moistures.</span>

<span class="sd">        If we set the reduction option |RBeta| to |False|, |QBB| is</span>
<span class="sd">        reduced to zero as long as |BoWa| does not exceed |FK|:</span>

<span class="sd">        &gt;&gt;&gt; rbeta(True)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qbb_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qbb</span>
<span class="sd">        qbb(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>

<span class="sd">        In the second example, we set the actual soil water content |BoWa|</span>
<span class="sd">        to high values.  For values below threshold |FK|, the discussion above</span>
<span class="sd">        remains valid.  For values above |FK|, percolation shows a nonlinear</span>
<span class="sd">        behaviour when factor |FBeta| is set to values larger than one:</span>

<span class="sd">        &gt;&gt;&gt; rbeta(False)</span>
<span class="sd">        &gt;&gt;&gt; wmax(0.0, 0.0, 0.0, 100.0, 100.0, 100.0, 100.0, 200.0)</span>
<span class="sd">        &gt;&gt;&gt; fk(70.0)</span>
<span class="sd">        &gt;&gt;&gt; pwp(10.0)</span>
<span class="sd">        &gt;&gt;&gt; states.bowa = 0.0, 0.0, 0.0, 60.0, 70.0, 80.0, 100.0, 200.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qbb_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qbb</span>
<span class="sd">        qbb(0.0, 0.0, 0.0, 1.0, 1.2, 1.866667, 3.6, 7.6)</span>

<span class="sd">        &gt;&gt;&gt; rbeta(True)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qbb_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qbb</span>
<span class="sd">        qbb(0.0, 0.0, 0.0, 0.0, 0.0, 1.866667, 3.6, 7.6)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">WMax</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Beta</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">FBeta</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">RBeta</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">PWP</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">FK</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">BoWa</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QBB</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">VERS</span><span class="p">,</span> <span class="n">WASSER</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">))</span>
                <span class="ow">or</span> <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">con</span><span class="o">.</span><span class="n">pwp</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="ow">or</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">wmax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">qbb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">elif</span> <span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">con</span><span class="o">.</span><span class="n">fk</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">rbeta</span><span class="p">:</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">qbb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">qbb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">beta</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">pwp</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">qbb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">con</span><span class="o">.</span><span class="n">beta</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                    <span class="o">*</span> <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">pwp</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                    <span class="o">*</span> <span class="p">(</span>
                        <span class="mf">1.0</span>
                        <span class="o">+</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">fbeta</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span>
                        <span class="o">*</span> <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">fk</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                        <span class="o">/</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">wmax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">fk</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                    <span class="p">)</span>
                <span class="p">)</span></div>


<div class="viewcode-block" id="Calc_QIB1_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_QIB1_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_QIB1_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the first inflow component released from the soil.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`QIB1 = DMin \\cdot \\frac{BoWa}{WMax}`</span>

<span class="sd">    Examples:</span>

<span class="sd">        For water and sealed areas, no interflow is calculated (the first</span>
<span class="sd">        three HRUs are of type |FLUSS|, |SEE|, and |VERS|, respectively).</span>
<span class="sd">        No principal distinction is made between the remaining land use</span>
<span class="sd">        classes (arable land |ACKER| has been selected for the last five</span>
<span class="sd">        HRUs arbitrarily):</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(8)</span>
<span class="sd">        &gt;&gt;&gt; lnk(FLUSS, SEE, VERS, ACKER, ACKER, ACKER, ACKER, ACKER)</span>
<span class="sd">        &gt;&gt;&gt; dmax(10.0)</span>
<span class="sd">        &gt;&gt;&gt; dmin(4.0)</span>
<span class="sd">        &gt;&gt;&gt; wmax(101.0, 101.0, 101.0, 0.0, 101.0, 101.0, 101.0, 202.0)</span>
<span class="sd">        &gt;&gt;&gt; pwp(10.0)</span>
<span class="sd">        &gt;&gt;&gt; states.bowa = 10.1, 10.1, 10.1, 0.0, 0.0, 10.0, 10.1, 10.1</span>

<span class="sd">        Note the time dependence of parameter |DMin|:</span>

<span class="sd">        &gt;&gt;&gt; dmin</span>
<span class="sd">        dmin(4.0)</span>
<span class="sd">        &gt;&gt;&gt; dmin.values</span>
<span class="sd">        array([ 2.,  2.,  2.,  2.,  2.,  2.,  2.,  2.])</span>

<span class="sd">        Compared to the calculation of |QBB|, the following results show</span>
<span class="sd">        some relevant differences:</span>

<span class="sd">        &gt;&gt;&gt; model.calc_qib1_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qib1</span>
<span class="sd">        qib1(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.2, 0.1)</span>

<span class="sd">        Firstly, as demonstrated with the help of the seventh and the</span>
<span class="sd">        eight HRU, the generation of the first interflow component |QIB1|</span>
<span class="sd">        depends on relative soil moisture.  Secondly, as demonstrated with</span>
<span class="sd">        the help the sixth and seventh HRU, it starts abruptly whenever</span>
<span class="sd">        the slightest exceedance of the threshold  parameter |PWP| occurs.</span>
<span class="sd">        Such sharp discontinuouties are a potential source of trouble.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">DMin</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">WMax</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">PWP</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">BoWa</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QIB1</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">VERS</span><span class="p">,</span> <span class="n">WASSER</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">con</span><span class="o">.</span><span class="n">pwp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">qib1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">qib1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">dmin</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">con</span><span class="o">.</span><span class="n">wmax</span><span class="p">[</span><span class="n">k</span><span class="p">])</span></div>


<div class="viewcode-block" id="Calc_QIB2_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_QIB2_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_QIB2_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the second inflow component released from the soil.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`QIB2 = (DMax-DMin) \\cdot</span>
<span class="sd">      \\left(\\frac{BoWa-FK}{WMax-FK}\\right)^\\frac{3}{2}`</span>

<span class="sd">    Examples:</span>

<span class="sd">        For water and sealed areas, no interflow is calculated (the first</span>
<span class="sd">        three HRUs are of type |FLUSS|, |SEE|, and |VERS|, respectively).</span>
<span class="sd">        No principal distinction is made between the remaining land use</span>
<span class="sd">        classes (arable land |ACKER| has been selected for the last</span>
<span class="sd">        five HRUs arbitrarily):</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(8)</span>
<span class="sd">        &gt;&gt;&gt; lnk(FLUSS, SEE, VERS, ACKER, ACKER, ACKER, ACKER, ACKER)</span>
<span class="sd">        &gt;&gt;&gt; dmax(10.0)</span>
<span class="sd">        &gt;&gt;&gt; dmin(4.0)</span>
<span class="sd">        &gt;&gt;&gt; wmax(100.0, 100.0, 100.0, 50.0, 100.0, 100.0, 100.0, 200.0)</span>
<span class="sd">        &gt;&gt;&gt; fk(50.0)</span>
<span class="sd">        &gt;&gt;&gt; states.bowa = 100.0, 100.0, 100.0, 50.1, 50.0, 75.0, 100.0, 100.0</span>

<span class="sd">        Note the time dependence of parameters |DMin| (see the example above)</span>
<span class="sd">        and |DMax|:</span>

<span class="sd">        &gt;&gt;&gt; dmax</span>
<span class="sd">        dmax(10.0)</span>
<span class="sd">        &gt;&gt;&gt; dmax.values</span>
<span class="sd">        array([ 5.,  5.,  5.,  5.,  5.,  5.,  5.,  5.])</span>

<span class="sd">        The following results show that he calculation of |QIB2| both</span>
<span class="sd">        resembles those of |QBB| and |QIB1| in some regards:</span>

<span class="sd">        &gt;&gt;&gt; model.calc_qib2_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qib2</span>
<span class="sd">        qib2(0.0, 0.0, 0.0, 0.0, 0.0, 1.06066, 3.0, 0.57735)</span>

<span class="sd">        In the given example, the maximum rate of total interflow</span>
<span class="sd">        generation is 5 mm/12h (parameter |DMax|).  For the seventh zone,</span>
<span class="sd">        which contains a saturated soil, the value calculated for the</span>
<span class="sd">        second interflow component (|QIB2|) is 3 mm/h.  The &quot;missing&quot;</span>
<span class="sd">        value of 2 mm/12h is be calculated by method |Calc_QIB1_V1|.</span>

<span class="sd">        (The fourth zone, which is slightly oversaturated, is only intended</span>
<span class="sd">        to demonstrate that zero division due to |WMax| = |FK| is circumvented.)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">WMax</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">DMax</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">DMin</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">FK</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">BoWa</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QIB2</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">VERS</span><span class="p">,</span> <span class="n">WASSER</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">))</span>
                <span class="ow">or</span> <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">con</span><span class="o">.</span><span class="n">fk</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="ow">or</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">wmax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">con</span><span class="o">.</span><span class="n">fk</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">qib2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">qib2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">dmax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">dmin</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span>
                    <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">fk</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">wmax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">fk</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="p">)</span> <span class="o">**</span> <span class="mf">1.5</span></div>


<div class="viewcode-block" id="Calc_QDB_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_QDB_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_QDB_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate direct runoff released from the soil.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      .. math::</span>
<span class="sd">        QDB = \\begin{cases}</span>
<span class="sd">        max\\bigl(Exz, 0\\bigl)</span>
<span class="sd">        &amp;|\\</span>
<span class="sd">        SfA \\leq 0</span>
<span class="sd">        \\\\</span>
<span class="sd">        max\\bigl(Exz + WMax \\cdot SfA^{BSf+1}, 0\\bigl)</span>
<span class="sd">        &amp;|\\</span>
<span class="sd">        SfA &gt; 0</span>
<span class="sd">        \\end{cases}</span>

<span class="sd">      :math:`SFA = \\left(1 - \\frac{BoWa}{WMax}\\right)^\\frac{1}{BSf+1} -</span>
<span class="sd">      \\frac{WaDa}{(BSf+1) \\cdot WMax}`</span>

<span class="sd">      :math:`Exz = (BoWa + WaDa) - WMax`</span>

<span class="sd">    Examples:</span>

<span class="sd">        For water areas (|FLUSS| and |SEE|), sealed areas (|VERS|), and</span>
<span class="sd">        areas without any soil storage capacity, all water is completely</span>
<span class="sd">        routed as direct runoff |QDB| (see the first four HRUs).  No</span>
<span class="sd">        principal distinction is made between the remaining land use</span>
<span class="sd">        classes (arable land |ACKER| has been selected for the last five</span>
<span class="sd">        HRUs arbitrarily):</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(9)</span>
<span class="sd">        &gt;&gt;&gt; lnk(FLUSS, SEE, VERS, ACKER, ACKER, ACKER, ACKER, ACKER, ACKER)</span>
<span class="sd">        &gt;&gt;&gt; bsf(0.4)</span>
<span class="sd">        &gt;&gt;&gt; wmax(100.0, 100.0, 100.0, 0.0, 100.0, 100.0, 100.0, 100.0, 100.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wada = 10.0</span>
<span class="sd">        &gt;&gt;&gt; states.bowa = (</span>
<span class="sd">        ...     100.0, 100.0, 100.0, 0.0, -0.1, 0.0, 50.0, 100.0, 100.1)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qdb_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qdb</span>
<span class="sd">        qdb(10.0, 10.0, 10.0, 10.0, 0.142039, 0.144959, 1.993649, 10.0, 10.1)</span>

<span class="sd">        With the common |BSf| value of 0.4, the discharge coefficient</span>
<span class="sd">        increases more or less exponentially with soil moisture.</span>
<span class="sd">        For soil moisture values slightly below zero or above usable</span>
<span class="sd">        field capacity, plausible amounts of generated direct runoff</span>
<span class="sd">        are ensured.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">WMax</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">BSf</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WaDa</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">BoWa</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QDB</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">WASSER</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">qdb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">VERS</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">wmax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">qdb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">wada</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">con</span><span class="o">.</span><span class="n">wmax</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                    <span class="n">d_sfa</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">con</span><span class="o">.</span><span class="n">wmax</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">**</span> <span class="p">(</span>
                        <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">bsf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span>
                    <span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">wada</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="p">((</span><span class="n">con</span><span class="o">.</span><span class="n">bsf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">wmax</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">d_sfa</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">d_exz</span> <span class="o">=</span> <span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">wada</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">wmax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">qdb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">d_exz</span>
                <span class="k">if</span> <span class="n">d_sfa</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">qdb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">d_sfa</span> <span class="o">**</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">bsf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">wmax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">qdb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">qdb</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">)</span></div>


<div class="viewcode-block" id="Update_QDB_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Update_QDB_V1">[docs]</a><span class="k">class</span> <span class="nc">Update_QDB_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Update the direct runoff according to the degree of frost sealing.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`QDB_{updated} = QDB + FVG \\cdot (WaDa - QDB)`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(3)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qdb(5.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wada(10.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.fvg(0.2)</span>
<span class="sd">        &gt;&gt;&gt; model.update_qdb_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qdb</span>
<span class="sd">        qdb(6.0, 6.0, 6.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WaDa</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">FVG</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QDB</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">qdb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">fvg</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">wada</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">qdb</span><span class="p">[</span><span class="n">k</span><span class="p">])</span></div>


<div class="viewcode-block" id="Calc_BoWa_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_BoWa_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_BoWa_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Update the soil moisture and, if necessary, correct the ingoing and</span>
<span class="sd">    outgoing fluxes.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">       :math:`\\frac{dBoWa}{dt} = WaDa + Qkap - EvB - QBB - QIB1 - QIB2 - QDB`</span>

<span class="sd">       :math:`0 \\leq BoWa \\leq WMax`</span>

<span class="sd">    Examples:</span>

<span class="sd">        For water areas and sealed surfaces, we simply set soil moisture |BoWa|</span>
<span class="sd">        to zero and do not need to perform any flux corrections:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(4)</span>
<span class="sd">        &gt;&gt;&gt; lnk(FLUSS, SEE, WASSER, VERS)</span>
<span class="sd">        &gt;&gt;&gt; states.bowa = 100.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_bowa_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.bowa</span>
<span class="sd">        bowa(0.0, 0.0, 0.0, 0.0)</span>

<span class="sd">        We make no principal distinction between the remaining land use</span>
<span class="sd">        classes and select arable land (|ACKER|) for the following examples.</span>

<span class="sd">        To prevent soil water contents increasing |WMax|, we might need to</span>
<span class="sd">        decrease |WaDa| and |QKap|:</span>

<span class="sd">        &gt;&gt;&gt; lnk(ACKER)</span>
<span class="sd">        &gt;&gt;&gt; wmax(100.0)</span>
<span class="sd">        &gt;&gt;&gt; states.bowa = 90.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wada = 0.0, 5.0, 10.0, 15.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qkap = 10.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evb = 5.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qbb = 0.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qib1 = 0.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qib2 = 0.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qdb = 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_bowa_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.bowa</span>
<span class="sd">        bowa(95.0, 100.0, 100.0, 100.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wada</span>
<span class="sd">        wada(0.0, 5.0, 2.5, 6.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qkap</span>
<span class="sd">        qkap(10.0, 10.0, 2.5, 4.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evb</span>
<span class="sd">        evb(5.0, 5.0, 5.0, 5.0)</span>

<span class="sd">        Additionally, to prevent storage overlflows we might need to</span>
<span class="sd">        decrease |EvB| in case it is negative (meaning, condensation</span>
<span class="sd">        increases the soil water storage):</span>

<span class="sd">        &gt;&gt;&gt; states.bowa = 90.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wada = 0.0, 5.0, 10.0, 15.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qkap = 2.5</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evb = -2.5</span>
<span class="sd">        &gt;&gt;&gt; model.calc_bowa_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.bowa</span>
<span class="sd">        bowa(95.0, 100.0, 100.0, 100.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wada</span>
<span class="sd">        wada(0.0, 5.0, 3.333333, 7.5)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qkap</span>
<span class="sd">        qkap(2.5, 2.5, 0.833333, 1.25)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evb</span>
<span class="sd">        evb(-2.5, -2.5, -0.833333, -1.25)</span>

<span class="sd">        To prevent negative |BoWa| value, we might need to decrease |QBB|,</span>
<span class="sd">        |QIB1|, |QIB1|, |QBB|, and |EvB|:</span>

<span class="sd">        &gt;&gt;&gt; states.bowa = 10.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wada = 0.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qkap = 0.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evb = 0.0, 5.0, 10.0, 15.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qbb = 1.25</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qib1 = 1.25</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qib2 = 1.25</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qdb = 1.25</span>
<span class="sd">        &gt;&gt;&gt; model.calc_bowa_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.bowa</span>
<span class="sd">        bowa(5.0, 0.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evb</span>
<span class="sd">        evb(0.0, 5.0, 6.666667, 7.5)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qbb</span>
<span class="sd">        qbb(1.25, 1.25, 0.833333, 0.625)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qib1</span>
<span class="sd">        qib1(1.25, 1.25, 0.833333, 0.625)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qib2</span>
<span class="sd">        qib2(1.25, 1.25, 0.833333, 0.625)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qdb</span>
<span class="sd">        qdb(1.25, 1.25, 0.833333, 0.625)</span>

<span class="sd">        We do not to modify negative |EvB| values (condensation) to prevent</span>
<span class="sd">        negative |BoWa| values:</span>

<span class="sd">        &gt;&gt;&gt; states.bowa = 10.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evb = -15.0, -10.0, -5.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qbb = 5.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qib1 = 5.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qib2 = 5.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qdb = 5.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_bowa_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.bowa</span>
<span class="sd">        bowa(5.0, 0.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evb</span>
<span class="sd">        evb(-15.0, -10.0, -5.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qbb</span>
<span class="sd">        qbb(5.0, 5.0, 3.75, 2.5)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qib1</span>
<span class="sd">        qib1(5.0, 5.0, 3.75, 2.5)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qib2</span>
<span class="sd">        qib2(5.0, 5.0, 3.75, 2.5)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qdb</span>
<span class="sd">        qdb(5.0, 5.0, 3.75, 2.5)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">WMax</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WaDa</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">BoWa</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">EvB</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QBB</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QIB1</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QIB2</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QDB</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QKap</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">VERS</span><span class="p">,</span> <span class="n">WASSER</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">):</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">d_decr</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">qbb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">qib1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">qib2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">qdb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">d_incr</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">wada</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">qkap</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">flu</span><span class="o">.</span><span class="n">evb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">d_decr</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">evb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">d_incr</span> <span class="o">-=</span> <span class="n">flu</span><span class="o">.</span><span class="n">evb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">d_decr</span> <span class="o">&gt;</span> <span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">d_incr</span><span class="p">:</span>
                    <span class="n">d_rvl</span> <span class="o">=</span> <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">d_incr</span><span class="p">)</span> <span class="o">/</span> <span class="n">d_decr</span>
                    <span class="k">if</span> <span class="n">flu</span><span class="o">.</span><span class="n">evb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                        <span class="n">flu</span><span class="o">.</span><span class="n">evb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*=</span> <span class="n">d_rvl</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">qbb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*=</span> <span class="n">d_rvl</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">qib1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*=</span> <span class="n">d_rvl</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">qib2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*=</span> <span class="n">d_rvl</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">qdb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*=</span> <span class="n">d_rvl</span>
                    <span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">d_incr</span><span class="p">)</span> <span class="o">-</span> <span class="n">d_decr</span>
                    <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">con</span><span class="o">.</span><span class="n">wmax</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                        <span class="n">d_factor</span> <span class="o">=</span> <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">wmax</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">/</span> <span class="n">d_incr</span>
                        <span class="k">if</span> <span class="n">flu</span><span class="o">.</span><span class="n">evb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
                            <span class="n">flu</span><span class="o">.</span><span class="n">evb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*=</span> <span class="n">d_factor</span>
                        <span class="n">flu</span><span class="o">.</span><span class="n">wada</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*=</span> <span class="n">d_factor</span>
                        <span class="n">flu</span><span class="o">.</span><span class="n">qkap</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*=</span> <span class="n">d_factor</span>
                        <span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">wmax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>


<div class="viewcode-block" id="Calc_QBGZ_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_QBGZ_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_QBGZ_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Aggregate the amount of base flow released by all &quot;soil type&quot; HRUs</span>
<span class="sd">    and the &quot;net precipitation&quot; above water areas of type |SEE|.</span>

<span class="sd">    Water areas of type |SEE| are assumed to be directly connected with</span>
<span class="sd">    groundwater, but not with the stream network.  This is modelled by</span>
<span class="sd">    adding their (positive or negative) &quot;net input&quot; (|NKor|-|EvI|) to the</span>
<span class="sd">    &quot;percolation output&quot; of the soil containing HRUs.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">       :math:`QBGZ = \\Sigma\\bigl(FHRU \\cdot \\bigl(QBB-Qkap\\bigl)\\bigl) +</span>
<span class="sd">       \\Sigma\\bigl(FHRU \\cdot \\bigl(NKor_{SEE}-EvI_{SEE}\\bigl)\\bigl)`</span>

<span class="sd">    Examples:</span>

<span class="sd">        The first example shows that |QBGZ| is the area weighted sum of</span>
<span class="sd">        |QBB| from &quot;soil type&quot; HRUs like arable land (|ACKER|) and of</span>
<span class="sd">        |NKor|-|EvI| from water areas of type |SEE|.  All other water</span>
<span class="sd">        areas (|WASSER| and |FLUSS|) and also sealed surfaces (|VERS|)</span>
<span class="sd">        have no impact on |QBGZ|:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(6)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER, ACKER, VERS, WASSER, FLUSS, SEE)</span>
<span class="sd">        &gt;&gt;&gt; fhru(0.1, 0.2, 0.1, 0.1, 0.1, 0.4)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qbb = 2., 4.0, 300.0, 300.0, 300.0, 300.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qkap = 1., 2.0, 150.0, 150.0, 150.0, 150.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.nkor = 200.0, 200.0, 200.0, 200.0, 200.0, 20.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evi = 100.0, 100.0, 100.0, 100.0, 100.0, 10.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qbgz_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.qbgz</span>
<span class="sd">        qbgz(4.5)</span>

<span class="sd">        The second example shows that large evaporation values above a</span>
<span class="sd">        HRU of type |SEE| can result in negative values of |QBGZ|:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.evi[5] = 30</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qbgz_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.qbgz</span>
<span class="sd">        qbgz(-3.5)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">FHRU</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NKor</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">EvI</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QBB</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QKap</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">QBGZ</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span><span class="o">.</span><span class="n">qbgz</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">SEE</span><span class="p">:</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">qbgz</span> <span class="o">+=</span> <span class="n">con</span><span class="o">.</span><span class="n">fhru</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">nkor</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">evi</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="n">WASSER</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">VERS</span><span class="p">):</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">qbgz</span> <span class="o">+=</span> <span class="n">con</span><span class="o">.</span><span class="n">fhru</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">qbb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">qkap</span><span class="p">[</span><span class="n">k</span><span class="p">])</span></div>


<div class="viewcode-block" id="Calc_QIGZ1_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_QIGZ1_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_QIGZ1_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Aggregate the amount of the first interflow component released</span>
<span class="sd">    by all HRUs.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">       :math:`QIGZ1 = \\Sigma(FHRU \\cdot QIB1)`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(2)</span>
<span class="sd">        &gt;&gt;&gt; fhru(0.75, 0.25)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qib1 = 1.0, 5.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qigz1_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.qigz1</span>
<span class="sd">        qigz1(2.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">FHRU</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QIB1</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">QIGZ1</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span><span class="o">.</span><span class="n">qigz1</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="n">sta</span><span class="o">.</span><span class="n">qigz1</span> <span class="o">+=</span> <span class="n">con</span><span class="o">.</span><span class="n">fhru</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">qib1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>


<div class="viewcode-block" id="Calc_QIGZ2_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_QIGZ2_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_QIGZ2_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Aggregate the amount of the second interflow component released</span>
<span class="sd">    by all HRUs.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">       :math:`QIGZ2 = \\Sigma(FHRU \\cdot QIB2)`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(2)</span>
<span class="sd">        &gt;&gt;&gt; fhru(0.75, 0.25)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qib2 = 1.0, 5.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qigz2_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.qigz2</span>
<span class="sd">        qigz2(2.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">FHRU</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QIB2</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">QIGZ2</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span><span class="o">.</span><span class="n">qigz2</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="n">sta</span><span class="o">.</span><span class="n">qigz2</span> <span class="o">+=</span> <span class="n">con</span><span class="o">.</span><span class="n">fhru</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">qib2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>


<div class="viewcode-block" id="Calc_QDGZ_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_QDGZ_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_QDGZ_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Aggregate the amount of total direct flow released by all HRUs.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">       :math:`QDGZ = \\Sigma\\bigl(FHRU \\cdot QDB\\bigl) +</span>
<span class="sd">       \\Sigma\\bigl(FHRU \\cdot \\bigl(NKor_{FLUSS}-EvI_{FLUSS}\\bigl)\\bigl)`</span>

<span class="sd">    Examples:</span>

<span class="sd">        The first example shows that |QDGZ| is the area weighted sum of</span>
<span class="sd">        |QDB| from &quot;land type&quot; HRUs like arable land (|ACKER|) and sealed</span>
<span class="sd">        surfaces (|VERS|) as well as of |NKor|-|EvI| from water areas of</span>
<span class="sd">        type |FLUSS|.  Water areas of type |WASSER| and |SEE| have no</span>
<span class="sd">        impact on |QDGZ|:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(5)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER, VERS, WASSER, SEE, FLUSS)</span>
<span class="sd">        &gt;&gt;&gt; fhru(0.1, 0.2, 0.1, 0.2, 0.4)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qdb = 2., 4.0, 300.0, 300.0, 300.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.nkor = 200.0, 200.0, 200.0, 200.0, 20.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evi = 100.0, 100.0, 100.0, 100.0, 10.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qdgz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qdgz</span>
<span class="sd">        qdgz(5.0)</span>

<span class="sd">        The second example shows that large evaporation values above a</span>
<span class="sd">        HRU of type |FLUSS| can result in negative values of |QDGZ|:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.evi[4] = 30</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qdgz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qdgz</span>
<span class="sd">        qdgz(-3.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">FHRU</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NKor</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">EvI</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QDB</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QDGZ</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">qdgz</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">FLUSS</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">qdgz</span> <span class="o">+=</span> <span class="n">con</span><span class="o">.</span><span class="n">fhru</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">nkor</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">evi</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="n">WASSER</span><span class="p">,</span> <span class="n">SEE</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">qdgz</span> <span class="o">+=</span> <span class="n">con</span><span class="o">.</span><span class="n">fhru</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">qdb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>


<div class="viewcode-block" id="Calc_QDGZ1_QDGZ2_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_QDGZ1_QDGZ2_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_QDGZ1_QDGZ2_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Separate total direct flow into a slower and a faster component.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">       :math:`QDGZ2 = \\frac{(QDGZ-A2)^2}{QDGZ+A1-A2}`</span>

<span class="sd">       :math:`QDGZ1 = QDGZ - QDGZ2`</span>

<span class="sd">    Examples:</span>

<span class="sd">        We borrowed the formula for calculating the amount of the faster</span>
<span class="sd">        component of direct flow from the well-known curve number approach.</span>
<span class="sd">        Parameter |A2| would be the initial loss and parameter |A1| the</span>
<span class="sd">        maximum storage, but one should not take this analogy too literally.</span>

<span class="sd">        With the value of parameter |A1| set to zero, parameter |A2| defines</span>
<span class="sd">        the maximum amount of &quot;slow&quot; direct runoff per time step:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; a1(0.0)</span>

<span class="sd">        Let us set the value of |A2| to 4 mm/d, which is 2 mm/12h concerning</span>
<span class="sd">        the selected simulation step size:</span>

<span class="sd">        &gt;&gt;&gt; a2(4.0)</span>
<span class="sd">        &gt;&gt;&gt; a2</span>
<span class="sd">        a2(4.0)</span>
<span class="sd">        &gt;&gt;&gt; a2.value</span>
<span class="sd">        2.0</span>

<span class="sd">        Define a test function and let it calculate |QDGZ1| and |QDGZ1| for</span>
<span class="sd">        values of |QDGZ| ranging from -10 to 100 mm/12h:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import UnitTest</span>
<span class="sd">        &gt;&gt;&gt; test = UnitTest(model,</span>
<span class="sd">        ...                 model.calc_qdgz1_qdgz2_v1,</span>
<span class="sd">        ...                 last_example=6,</span>
<span class="sd">        ...                 parseqs=(fluxes.qdgz,</span>
<span class="sd">        ...                          states.qdgz1,</span>
<span class="sd">        ...                          states.qdgz2))</span>
<span class="sd">        &gt;&gt;&gt; test.nexts.qdgz = -10.0, 0.0, 1.0, 2.0, 3.0, 100.0</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. |  qdgz | qdgz1 | qdgz2 |</span>
<span class="sd">        -------------------------------</span>
<span class="sd">        |   1 | -10.0 | -10.0 |   0.0 |</span>
<span class="sd">        |   2 |   0.0 |   0.0 |   0.0 |</span>
<span class="sd">        |   3 |   1.0 |   1.0 |   0.0 |</span>
<span class="sd">        |   4 |   2.0 |   2.0 |   0.0 |</span>
<span class="sd">        |   5 |   3.0 |   2.0 |   1.0 |</span>
<span class="sd">        |   6 | 100.0 |   2.0 |  98.0 |</span>

<span class="sd">        Setting |A2| to zero and |A1| to 4 mm/d (or 2 mm/12h) results in</span>
<span class="sd">        a smoother transition:</span>

<span class="sd">        &gt;&gt;&gt; a2(0.0)</span>
<span class="sd">        &gt;&gt;&gt; a1(4.0)</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. |  qdgz |    qdgz1 |     qdgz2 |</span>
<span class="sd">        --------------------------------------</span>
<span class="sd">        |   1 | -10.0 |    -10.0 |       0.0 |</span>
<span class="sd">        |   2 |   0.0 |      0.0 |       0.0 |</span>
<span class="sd">        |   3 |   1.0 | 0.666667 |  0.333333 |</span>
<span class="sd">        |   4 |   2.0 |      1.0 |       1.0 |</span>
<span class="sd">        |   5 |   3.0 |      1.2 |       1.8 |</span>
<span class="sd">        |   6 | 100.0 | 1.960784 | 98.039216 |</span>

<span class="sd">        Alternatively, one can mix these two configurations by setting</span>
<span class="sd">        the values of both parameters to 2 mm/h:</span>

<span class="sd">        &gt;&gt;&gt; a2(2.0)</span>
<span class="sd">        &gt;&gt;&gt; a1(2.0)</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. |  qdgz |    qdgz1 |    qdgz2 |</span>
<span class="sd">        -------------------------------------</span>
<span class="sd">        |   1 | -10.0 |    -10.0 |      0.0 |</span>
<span class="sd">        |   2 |   0.0 |      0.0 |      0.0 |</span>
<span class="sd">        |   3 |   1.0 |      1.0 |      0.0 |</span>
<span class="sd">        |   4 |   2.0 |      1.5 |      0.5 |</span>
<span class="sd">        |   5 |   3.0 | 1.666667 | 1.333333 |</span>
<span class="sd">        |   6 | 100.0 |     1.99 |    98.01 |</span>

<span class="sd">        Note the similarity of the results for very high values of total</span>
<span class="sd">        direct flow |QDGZ| in all three examples, which converge to the sum</span>
<span class="sd">        of the values of parameter |A1| and |A2|, representing the maximum</span>
<span class="sd">        value of `slow` direct flow generation per simulation step</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">A2</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">A1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QDGZ</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">QDGZ2</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">QDGZ1</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">if</span> <span class="n">flu</span><span class="o">.</span><span class="n">qdgz</span> <span class="o">&gt;</span> <span class="n">con</span><span class="o">.</span><span class="n">a2</span><span class="p">:</span>
            <span class="n">sta</span><span class="o">.</span><span class="n">qdgz2</span> <span class="o">=</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">qdgz</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">a2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">qdgz</span> <span class="o">+</span> <span class="n">con</span><span class="o">.</span><span class="n">a1</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">a2</span><span class="p">)</span>
            <span class="n">sta</span><span class="o">.</span><span class="n">qdgz1</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">qdgz</span> <span class="o">-</span> <span class="n">sta</span><span class="o">.</span><span class="n">qdgz2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sta</span><span class="o">.</span><span class="n">qdgz2</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">sta</span><span class="o">.</span><span class="n">qdgz1</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">qdgz</span></div>


<div class="viewcode-block" id="Calc_QBGA_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_QBGA_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_QBGA_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Perform the runoff concentration calculation for base flow.</span>

<span class="sd">    The working equation is the analytical solution of the linear storage</span>
<span class="sd">    equation under the assumption of constant change in inflow during</span>
<span class="sd">    the simulation time step.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">       :math:`QBGA_{neu} = QBGA_{alt} +</span>
<span class="sd">       (QBGZ_{alt}-QBGA_{alt}) \\cdot (1-exp(-KB^{-1})) +</span>
<span class="sd">       (QBGZ_{neu}-QBGZ_{alt}) \\cdot (1-KB\\cdot(1-exp(-KB^{-1})))`</span>

<span class="sd">    Examples:</span>

<span class="sd">        A normal test case:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; derived.kb(0.1)</span>
<span class="sd">        &gt;&gt;&gt; states.qbgz.old = 2.0</span>
<span class="sd">        &gt;&gt;&gt; states.qbgz.new = 4.0</span>
<span class="sd">        &gt;&gt;&gt; states.qbga.old = 3.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qbga_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.qbga</span>
<span class="sd">        qbga(3.800054)</span>

<span class="sd">        First extreme test case (zero division is circumvented):</span>

<span class="sd">        &gt;&gt;&gt; derived.kb(0.0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qbga_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.qbga</span>
<span class="sd">        qbga(4.0)</span>

<span class="sd">        Second extreme test case (numerical overflow is circumvented):</span>

<span class="sd">        &gt;&gt;&gt; derived.kb(1e500)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qbga_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.qbga</span>
<span class="sd">        qbga(5.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">KB</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">QBGZ</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">QBGA</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">old</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess_old</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess_new</span>
        <span class="k">if</span> <span class="n">der</span><span class="o">.</span><span class="n">kb</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">new</span><span class="o">.</span><span class="n">qbga</span> <span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">qbgz</span>
        <span class="k">elif</span> <span class="n">der</span><span class="o">.</span><span class="n">kb</span> <span class="o">&gt;</span> <span class="mf">1e200</span><span class="p">:</span>
            <span class="n">new</span><span class="o">.</span><span class="n">qbga</span> <span class="o">=</span> <span class="n">old</span><span class="o">.</span><span class="n">qbga</span> <span class="o">+</span> <span class="n">new</span><span class="o">.</span><span class="n">qbgz</span> <span class="o">-</span> <span class="n">old</span><span class="o">.</span><span class="n">qbgz</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d_temp</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">der</span><span class="o">.</span><span class="n">kb</span><span class="p">)</span>
            <span class="n">new</span><span class="o">.</span><span class="n">qbga</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">old</span><span class="o">.</span><span class="n">qbga</span>
                <span class="o">+</span> <span class="p">(</span><span class="n">old</span><span class="o">.</span><span class="n">qbgz</span> <span class="o">-</span> <span class="n">old</span><span class="o">.</span><span class="n">qbga</span><span class="p">)</span> <span class="o">*</span> <span class="n">d_temp</span>
                <span class="o">+</span> <span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">qbgz</span> <span class="o">-</span> <span class="n">old</span><span class="o">.</span><span class="n">qbgz</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">der</span><span class="o">.</span><span class="n">kb</span> <span class="o">*</span> <span class="n">d_temp</span><span class="p">)</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="Update_QDGZ_QBGZ_QBGA_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Update_QDGZ_QBGZ_QBGA_V1">[docs]</a><span class="k">class</span> <span class="nc">Update_QDGZ_QBGZ_QBGA_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Redirect the inflow into the storage compartment for base flow into</span>
<span class="sd">    the storage compartments for direct flow upon exceedance of the groundwater</span>
<span class="sd">    aquifer&#39;s limited volume :cite:`ref-LARSIM`.</span>

<span class="sd">    We gained the following equation for updating |QBGZ| by converting the</span>
<span class="sd">    equation used by method |Calc_QBGA_V1|.</span>

<span class="sd">    Note that applying method |Update_QDGZ_QBGZ_QBGA_V1| can result in some</span>
<span class="sd">    oscillation both of |QBGZ| and |QDGZ|.  Due to the dampening effect</span>
<span class="sd">    of the runoff concentration storages for direct runoff, this oscillation</span>
<span class="sd">    should seldom be traced through to the resulting outflow values (|QDGA1|</span>
<span class="sd">    and |QDGA2|).  However, for long simulation time steps and short runoff</span>
<span class="sd">    concentration times, it is possible.  Fixing this issue would probably</span>
<span class="sd">    require to solve the differential equation of the linear storage with</span>
<span class="sd">    a different approach. See the results of the integration test</span>
<span class="sd">    :ref:`lland_v1_acker_gw_vol` for an example.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">       :math:`QBGA_{neu}^{final} = min \left ( QBGAMax, QBGA_{neu}^{orig} \right )`</span>

<span class="sd">       :math:`QBGZ_{neu}^{final} = QBGZ_{alt} +</span>
<span class="sd">       \frac{QBGA_{neu}^{final} - QBGA_{alt} -</span>
<span class="sd">       (QBGZ_{alt}-QBGA_{alt}) \cdot (1-exp(-KB^{-1})}</span>
<span class="sd">       {1-KB \cdot (1-exp(-KB^{-1})}`</span>

<span class="sd">       :math:`QDGZ^{final} = QDGZ^{orig} + QBGZ_{neu}^{orig} - QBGZ_{neu}^{final}`</span>

<span class="sd">    Examples:</span>

<span class="sd">        We modify the first example of the documentation on method |Calc_QBGA_V1| to</span>
<span class="sd">        show that both equations are consistent.  The following setting is nearly</span>
<span class="sd">        identical, except for a higher recent inflow (6 mm/d instead of 4 mm/d).</span>
<span class="sd">        As a consequence, the recent outflow is also increased (5.6 mm/d instead of</span>
<span class="sd">        3.8 mm/d):</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; derived.kb(0.1)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qdgz = 1.0</span>
<span class="sd">        &gt;&gt;&gt; states.qbgz.old = 2.0</span>
<span class="sd">        &gt;&gt;&gt; states.qbgz.new = 6.0</span>
<span class="sd">        &gt;&gt;&gt; states.qbga.old = 3.0</span>
<span class="sd">        &gt;&gt;&gt; states.qbga.new = 5.6000636</span>

<span class="sd">        Now we set the highest allowed outflow (which is proportional to the maximum</span>
<span class="sd">        storage capacity, see the documentation on parameter |QBGAMax|) to 3.8 mm/d</span>
<span class="sd">        and apply method |Update_QDGZ_QBGZ_QBGA_V1|:</span>

<span class="sd">        &gt;&gt;&gt; derived.qbgamax(3.8000545)</span>
<span class="sd">        &gt;&gt;&gt; model.update_qdgz_qbgz_qbga_v1()</span>

<span class="sd">        First, |Update_QDGZ_QBGZ_QBGA_V1| resets the recent outflow to the highest</span>
<span class="sd">        value allowed:</span>

<span class="sd">        &gt;&gt;&gt; states.qbga</span>
<span class="sd">        qbga(3.800054)</span>

<span class="sd">        Second, it determines the recent inflow that results in the highest allowed</span>
<span class="sd">        outflow:</span>

<span class="sd">        &gt;&gt;&gt; states.qbgz</span>
<span class="sd">        qbgz(4.0)</span>

<span class="sd">        Third, it adds the excess of groundwater recharge (2 mm/d) to the</span>
<span class="sd">        to the already generated  direct discharge:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.qdgz</span>
<span class="sd">        qdgz(3.0)</span>

<span class="sd">        The final example deals with the edge case of zero storage capacity.</span>
<span class="sd">        Without any storage capacity, the aquifer can neither receive nor release</span>
<span class="sd">        any water.  Here, method |Update_QDGZ_QBGZ_QBGA_V1| needs to reset the</span>
<span class="sd">        recent inflow to a negative value to accomplish zero outflow, as the old</span>
<span class="sd">        inflow and outflow values are not consistent with our modification of</span>
<span class="sd">        parameter |QBGAMax|:</span>

<span class="sd">        &gt;&gt;&gt; derived.qbgamax(0.0)</span>
<span class="sd">        &gt;&gt;&gt; model.update_qdgz_qbgz_qbga_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.qbga</span>
<span class="sd">        qbga(0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.qbgz</span>
<span class="sd">        qbgz(-0.222261)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qdgz</span>
<span class="sd">        qdgz(7.222261)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">KB</span><span class="p">,</span>
        <span class="n">lland_derived</span><span class="o">.</span><span class="n">QBGAMax</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QDGZ</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">QBGA</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">QBGZ</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">old</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess_old</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess_new</span>
        <span class="k">if</span> <span class="n">new</span><span class="o">.</span><span class="n">qbga</span> <span class="o">&gt;</span> <span class="n">der</span><span class="o">.</span><span class="n">qbgamax</span><span class="p">:</span>
            <span class="n">d_temp</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">der</span><span class="o">.</span><span class="n">kb</span><span class="p">)</span>
            <span class="n">d_qbgz_adj</span> <span class="o">=</span> <span class="n">old</span><span class="o">.</span><span class="n">qbgz</span> <span class="o">+</span> <span class="p">(</span>
                <span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">qbgamax</span> <span class="o">-</span> <span class="n">old</span><span class="o">.</span><span class="n">qbga</span> <span class="o">-</span> <span class="p">(</span><span class="n">old</span><span class="o">.</span><span class="n">qbgz</span> <span class="o">-</span> <span class="n">old</span><span class="o">.</span><span class="n">qbga</span><span class="p">)</span> <span class="o">*</span> <span class="n">d_temp</span><span class="p">)</span>
                <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">der</span><span class="o">.</span><span class="n">kb</span> <span class="o">*</span> <span class="n">d_temp</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">new</span><span class="o">.</span><span class="n">qbga</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">qbgamax</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">qdgz</span> <span class="o">+=</span> <span class="n">new</span><span class="o">.</span><span class="n">qbgz</span> <span class="o">-</span> <span class="n">d_qbgz_adj</span>
            <span class="n">new</span><span class="o">.</span><span class="n">qbgz</span> <span class="o">=</span> <span class="n">d_qbgz_adj</span></div>


<div class="viewcode-block" id="Update_QDGZ_QBGZ_QBGA_V2"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Update_QDGZ_QBGZ_QBGA_V2">[docs]</a><span class="k">class</span> <span class="nc">Update_QDGZ_QBGZ_QBGA_V2</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Redirect (a portion of) the inflow into the storage compartment for base</span>
<span class="sd">    flow into the storage compartments for direct flow due to the groundwater</span>
<span class="sd">    table&#39;s too fast rise :cite:`ref-LARSIM`.</span>

<span class="sd">    In contrast to restricting an aquifer&#39;s volume (implemented by the method</span>
<span class="sd">    |Update_QDGZ_QBGZ_QBGA_V1|), limiting the water table&#39;s increase seems a</span>
<span class="sd">    litter counterintuitive.  However, we provide both kinds of restrictions</span>
<span class="sd">    to fully capture the option &quot;GS BASIS LIMITIERT&quot; of the original LARSIM model.</span>

<span class="sd">    The problem of oscillating time series for |QBGZ| and |QDGZ| discussed for method</span>
<span class="sd">    |Update_QDGZ_QBGZ_QBGA_V1| also holds for method |Update_QDGZ_QBGZ_QBGA_V2|.</span>
<span class="sd">    The smaller the &quot;transition area&quot; (the difference between |GSBGrad2| and</span>
<span class="sd">    |GSBGrad1|, the larger the oscillations. See the results of the integration</span>
<span class="sd">    test :ref:`lland_v1_acker_gw_rise` for an example.</span>

<span class="sd">    Basic equations:</span>

<span class="sd">       :math:`Grad = KB \cdot (QBGA_{neu}^{orig} - QBGA_{alt})`</span>

<span class="sd">       :math:`QBGZ_{neu}^{final} = QBGZ_{neu}^{orig} \cdot min \left( max \left(</span>
<span class="sd">       \frac{Grad-GSBGrad1}{GSBGrad2 - GSBGrad1}, 0 \right), 1 \right)`</span>

<span class="sd">       :math:`QBGA_{neu}^{final} = QBGA_{alt} +</span>
<span class="sd">       (QBGZ_{alt}-QBGA_{alt}) \cdot (1-exp(-KB^{-1})) +</span>
<span class="sd">       (QBGZ_{neu}^{final}-QBGZ_{alt}) \cdot (1-KB\cdot(1-exp(-KB^{-1})))`</span>

<span class="sd">       :math:`QDGZ^{final} = QDGZ^{orig} + QBGZ_{neu}^{orig} - QBGZ_{neu}^{final}`</span>

<span class="sd">    Examples:</span>

<span class="sd">        We build our explanations on the first example of the documentation on</span>
<span class="sd">        method |Calc_QBGA_V1|:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; derived.kb(0.1)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qdgz = 1.0</span>
<span class="sd">        &gt;&gt;&gt; states.qbgz.old = 2.0</span>
<span class="sd">        &gt;&gt;&gt; states.qbgz.new = 4.0</span>
<span class="sd">        &gt;&gt;&gt; states.qbga.old = 3.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qbga_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.qbga</span>
<span class="sd">        qbga(3.800054)</span>

<span class="sd">        In this example, the old and the new outflow value of the groundwater</span>
<span class="sd">        storage is 3.0 mm/d and 3.8 mm/d, respectively, which corresponds to a</span>
<span class="sd">        storage increase of 0.08 mm/d:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_((states.qbga.new - states.qbga.old) * derived.kb)</span>
<span class="sd">        0.080005</span>

<span class="sd">        If we assign larger values to the threshold parameters |GSBGrad1| (0.1 mm/d)</span>
<span class="sd">        and |GSBGrad2| (0.2 mm/d), method |Update_QDGZ_QBGZ_QBGA_V2| does not need</span>
<span class="sd">        to change anything:</span>

<span class="sd">        &gt;&gt;&gt; gsbgrad1(0.1)</span>
<span class="sd">        &gt;&gt;&gt; gsbgrad2(0.2)</span>
<span class="sd">        &gt;&gt;&gt; model.update_qdgz_qbgz_qbga_v2()</span>
<span class="sd">        &gt;&gt;&gt; states.qbga</span>
<span class="sd">        qbga(3.800054)</span>
<span class="sd">        &gt;&gt;&gt; states.qbgz</span>
<span class="sd">        qbgz(4.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qdgz</span>
<span class="sd">        qdgz(1.0)</span>

<span class="sd">        If we assign smaller values to both threshold parameters, method</span>
<span class="sd">        |Update_QDGZ_QBGZ_QBGA_V2| redirects all groundwater inflow to direct</span>
<span class="sd">        runoff and recalculates groundwater outflow accordingly:</span>

<span class="sd">        &gt;&gt;&gt; gsbgrad1(0.01)</span>
<span class="sd">        &gt;&gt;&gt; gsbgrad2(0.05)</span>
<span class="sd">        &gt;&gt;&gt; model.update_qdgz_qbgz_qbga_v2()</span>
<span class="sd">        &gt;&gt;&gt; states.qbga</span>
<span class="sd">        qbga(0.200036)</span>
<span class="sd">        &gt;&gt;&gt; states.qbgz</span>
<span class="sd">        qbgz(0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qdgz</span>
<span class="sd">        qdgz(5.0)</span>

<span class="sd">        For an actual rise (we first reset it to 0.08 mm/d) between both threshold</span>
<span class="sd">        values, method |Update_QDGZ_QBGZ_QBGA_V2| interpolates the fraction of</span>
<span class="sd">        redirected groundwater inflow linearly:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.qdgz = 1.0</span>
<span class="sd">        &gt;&gt;&gt; states.qbgz.new = 4.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qbga_v1()</span>
<span class="sd">        &gt;&gt;&gt; gsbgrad1(0.01)</span>
<span class="sd">        &gt;&gt;&gt; gsbgrad2(0.1)</span>
<span class="sd">        &gt;&gt;&gt; model.update_qdgz_qbgz_qbga_v2()</span>
<span class="sd">        &gt;&gt;&gt; states.qbga</span>
<span class="sd">        qbga(0.999822)</span>
<span class="sd">        &gt;&gt;&gt; states.qbgz</span>
<span class="sd">        qbgz(0.888647)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qdgz</span>
<span class="sd">        qdgz(4.111353)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">GSBGrad1</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">GSBGrad2</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">KB</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QDGZ</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">QBGA</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">QBGZ</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Calc_QBGA_V1</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">old</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess_old</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess_new</span>
        <span class="n">d_grad</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">kb</span> <span class="o">*</span> <span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">qbga</span> <span class="o">-</span> <span class="n">old</span><span class="o">.</span><span class="n">qbga</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">d_grad</span> <span class="o">&gt;</span> <span class="n">con</span><span class="o">.</span><span class="n">gsbgrad1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">d_grad</span> <span class="o">&lt;</span> <span class="n">con</span><span class="o">.</span><span class="n">gsbgrad2</span><span class="p">:</span>
                <span class="n">d_qbgz_exc</span> <span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">qbgz</span> <span class="o">*</span> <span class="p">(</span>
                    <span class="p">(</span><span class="n">d_grad</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">gsbgrad1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">gsbgrad2</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">gsbgrad1</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">d_qbgz_exc</span> <span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">qbgz</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">qdgz</span> <span class="o">+=</span> <span class="n">d_qbgz_exc</span>
            <span class="n">new</span><span class="o">.</span><span class="n">qbgz</span> <span class="o">-=</span> <span class="n">d_qbgz_exc</span>
            <span class="n">model</span><span class="o">.</span><span class="n">calc_qbga_v1</span><span class="p">()</span></div>


<div class="viewcode-block" id="Calc_QIGA1_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_QIGA1_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_QIGA1_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Perform the runoff concentration calculation for the first</span>
<span class="sd">    interflow component.</span>

<span class="sd">    The working equation is the analytical solution of the linear storage</span>
<span class="sd">    equation under the assumption of constant change in inflow during</span>
<span class="sd">    the simulation time step.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">       :math:`QIGA1_{neu} = QIGA1_{alt} +</span>
<span class="sd">       (QIGZ1_{alt}-QIGA1_{alt}) \\cdot (1-exp(-KI1^{-1})) +</span>
<span class="sd">       (QIGZ1_{neu}-QIGZ1_{alt}) \\cdot (1-KI1\\cdot(1-exp(-KI1^{-1})))`</span>

<span class="sd">    Examples:</span>

<span class="sd">        A normal test case:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; derived.ki1(0.1)</span>
<span class="sd">        &gt;&gt;&gt; states.qigz1.old = 2.0</span>
<span class="sd">        &gt;&gt;&gt; states.qigz1.new = 4.0</span>
<span class="sd">        &gt;&gt;&gt; states.qiga1.old = 3.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qiga1_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.qiga1</span>
<span class="sd">        qiga1(3.800054)</span>

<span class="sd">        First extreme test case (zero division is circumvented):</span>

<span class="sd">        &gt;&gt;&gt; derived.ki1(0.0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qiga1_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.qiga1</span>
<span class="sd">        qiga1(4.0)</span>

<span class="sd">        Second extreme test case (numerical overflow is circumvented):</span>

<span class="sd">        &gt;&gt;&gt; derived.ki1(1e500)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qiga1_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.qiga1</span>
<span class="sd">        qiga1(5.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">KI1</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">QIGZ1</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">QIGA1</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">old</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess_old</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess_new</span>
        <span class="k">if</span> <span class="n">der</span><span class="o">.</span><span class="n">ki1</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">new</span><span class="o">.</span><span class="n">qiga1</span> <span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">qigz1</span>
        <span class="k">elif</span> <span class="n">der</span><span class="o">.</span><span class="n">ki1</span> <span class="o">&gt;</span> <span class="mf">1e200</span><span class="p">:</span>
            <span class="n">new</span><span class="o">.</span><span class="n">qiga1</span> <span class="o">=</span> <span class="n">old</span><span class="o">.</span><span class="n">qiga1</span> <span class="o">+</span> <span class="n">new</span><span class="o">.</span><span class="n">qigz1</span> <span class="o">-</span> <span class="n">old</span><span class="o">.</span><span class="n">qigz1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d_temp</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">der</span><span class="o">.</span><span class="n">ki1</span><span class="p">)</span>
            <span class="n">new</span><span class="o">.</span><span class="n">qiga1</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">old</span><span class="o">.</span><span class="n">qiga1</span>
                <span class="o">+</span> <span class="p">(</span><span class="n">old</span><span class="o">.</span><span class="n">qigz1</span> <span class="o">-</span> <span class="n">old</span><span class="o">.</span><span class="n">qiga1</span><span class="p">)</span> <span class="o">*</span> <span class="n">d_temp</span>
                <span class="o">+</span> <span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">qigz1</span> <span class="o">-</span> <span class="n">old</span><span class="o">.</span><span class="n">qigz1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">der</span><span class="o">.</span><span class="n">ki1</span> <span class="o">*</span> <span class="n">d_temp</span><span class="p">)</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="Calc_QIGA2_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_QIGA2_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_QIGA2_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Perform the runoff concentration calculation for the second</span>
<span class="sd">    interflow component.</span>

<span class="sd">    The working equation is the analytical solution of the linear storage</span>
<span class="sd">    equation under the assumption of constant change in inflow during</span>
<span class="sd">    the simulation time step.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">       :math:`QIGA2_{neu} = QIGA2_{alt} +</span>
<span class="sd">       (QIGZ2_{alt}-QIGA2_{alt}) \\cdot (1-exp(-KI2^{-1})) +</span>
<span class="sd">       (QIGZ2_{neu}-QIGZ2_{alt}) \\cdot (1-KI2\\cdot(1-exp(-KI2^{-1})))`</span>

<span class="sd">    Examples:</span>

<span class="sd">        A normal test case:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; derived.ki2(0.1)</span>
<span class="sd">        &gt;&gt;&gt; states.qigz2.old = 2.0</span>
<span class="sd">        &gt;&gt;&gt; states.qigz2.new = 4.0</span>
<span class="sd">        &gt;&gt;&gt; states.qiga2.old = 3.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qiga2_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.qiga2</span>
<span class="sd">        qiga2(3.800054)</span>

<span class="sd">        First extreme test case (zero division is circumvented):</span>

<span class="sd">        &gt;&gt;&gt; derived.ki2(0.0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qiga2_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.qiga2</span>
<span class="sd">        qiga2(4.0)</span>

<span class="sd">        Second extreme test case (numerical overflow is circumvented):</span>

<span class="sd">        &gt;&gt;&gt; derived.ki2(1e500)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qiga2_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.qiga2</span>
<span class="sd">        qiga2(5.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">KI2</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">QIGZ2</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">QIGA2</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">old</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess_old</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess_new</span>
        <span class="k">if</span> <span class="n">der</span><span class="o">.</span><span class="n">ki2</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">new</span><span class="o">.</span><span class="n">qiga2</span> <span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">qigz2</span>
        <span class="k">elif</span> <span class="n">der</span><span class="o">.</span><span class="n">ki2</span> <span class="o">&gt;</span> <span class="mf">1e200</span><span class="p">:</span>
            <span class="n">new</span><span class="o">.</span><span class="n">qiga2</span> <span class="o">=</span> <span class="n">old</span><span class="o">.</span><span class="n">qiga2</span> <span class="o">+</span> <span class="n">new</span><span class="o">.</span><span class="n">qigz2</span> <span class="o">-</span> <span class="n">old</span><span class="o">.</span><span class="n">qigz2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d_temp</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">der</span><span class="o">.</span><span class="n">ki2</span><span class="p">)</span>
            <span class="n">new</span><span class="o">.</span><span class="n">qiga2</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">old</span><span class="o">.</span><span class="n">qiga2</span>
                <span class="o">+</span> <span class="p">(</span><span class="n">old</span><span class="o">.</span><span class="n">qigz2</span> <span class="o">-</span> <span class="n">old</span><span class="o">.</span><span class="n">qiga2</span><span class="p">)</span> <span class="o">*</span> <span class="n">d_temp</span>
                <span class="o">+</span> <span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">qigz2</span> <span class="o">-</span> <span class="n">old</span><span class="o">.</span><span class="n">qigz2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">der</span><span class="o">.</span><span class="n">ki2</span> <span class="o">*</span> <span class="n">d_temp</span><span class="p">)</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="Calc_QDGA1_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_QDGA1_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_QDGA1_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Perform the runoff concentration calculation for &quot;slow&quot; direct runoff.</span>

<span class="sd">    The working equation is the analytical solution of the linear storage</span>
<span class="sd">    equation under the assumption of constant change in inflow during</span>
<span class="sd">    the simulation time step.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">       :math:`QDGA1_{neu} = QDGA1_{alt} +</span>
<span class="sd">       (QDGZ1_{alt}-QDGA1_{alt}) \\cdot (1-exp(-KD1^{-1})) +</span>
<span class="sd">       (QDGZ1_{neu}-QDGZ1_{alt}) \\cdot (1-KD1\\cdot(1-exp(-KD1^{-1})))`</span>

<span class="sd">    Examples:</span>

<span class="sd">        A normal test case:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; derived.kd1(0.1)</span>
<span class="sd">        &gt;&gt;&gt; states.qdgz1.old = 2.0</span>
<span class="sd">        &gt;&gt;&gt; states.qdgz1.new = 4.0</span>
<span class="sd">        &gt;&gt;&gt; states.qdga1.old = 3.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qdga1_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.qdga1</span>
<span class="sd">        qdga1(3.800054)</span>

<span class="sd">        First extreme test case (zero division is circumvented):</span>

<span class="sd">        &gt;&gt;&gt; derived.kd1(0.0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qdga1_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.qdga1</span>
<span class="sd">        qdga1(4.0)</span>

<span class="sd">        Second extreme test case (numerical overflow is circumvented):</span>

<span class="sd">        &gt;&gt;&gt; derived.kd1(1e500)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qdga1_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.qdga1</span>
<span class="sd">        qdga1(5.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">KD1</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">QDGZ1</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">QDGA1</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">old</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess_old</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess_new</span>
        <span class="k">if</span> <span class="n">der</span><span class="o">.</span><span class="n">kd1</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">new</span><span class="o">.</span><span class="n">qdga1</span> <span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">qdgz1</span>
        <span class="k">elif</span> <span class="n">der</span><span class="o">.</span><span class="n">kd1</span> <span class="o">&gt;</span> <span class="mf">1e200</span><span class="p">:</span>
            <span class="n">new</span><span class="o">.</span><span class="n">qdga1</span> <span class="o">=</span> <span class="n">old</span><span class="o">.</span><span class="n">qdga1</span> <span class="o">+</span> <span class="n">new</span><span class="o">.</span><span class="n">qdgz1</span> <span class="o">-</span> <span class="n">old</span><span class="o">.</span><span class="n">qdgz1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d_temp</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">der</span><span class="o">.</span><span class="n">kd1</span><span class="p">)</span>
            <span class="n">new</span><span class="o">.</span><span class="n">qdga1</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">old</span><span class="o">.</span><span class="n">qdga1</span>
                <span class="o">+</span> <span class="p">(</span><span class="n">old</span><span class="o">.</span><span class="n">qdgz1</span> <span class="o">-</span> <span class="n">old</span><span class="o">.</span><span class="n">qdga1</span><span class="p">)</span> <span class="o">*</span> <span class="n">d_temp</span>
                <span class="o">+</span> <span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">qdgz1</span> <span class="o">-</span> <span class="n">old</span><span class="o">.</span><span class="n">qdgz1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">der</span><span class="o">.</span><span class="n">kd1</span> <span class="o">*</span> <span class="n">d_temp</span><span class="p">)</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="Calc_QDGA2_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_QDGA2_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_QDGA2_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Perform the runoff concentration calculation for &quot;fast&quot; direct runoff.</span>

<span class="sd">    The working equation is the analytical solution of the linear storage</span>
<span class="sd">    equation under the assumption of constant change in inflow during</span>
<span class="sd">    the simulation time step.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">       :math:`QDGA2_{neu} = QDGA2_{alt} +</span>
<span class="sd">       (QDGZ2_{alt}-QDGA2_{alt}) \\cdot (1-exp(-KD2^{-1})) +</span>
<span class="sd">       (QDGZ2_{neu}-QDGZ2_{alt}) \\cdot (1-KD2\\cdot(1-exp(-KD2^{-1})))`</span>

<span class="sd">    Examples:</span>

<span class="sd">        A normal test case:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; derived.kd2(0.1)</span>
<span class="sd">        &gt;&gt;&gt; states.qdgz2.old = 2.0</span>
<span class="sd">        &gt;&gt;&gt; states.qdgz2.new = 4.0</span>
<span class="sd">        &gt;&gt;&gt; states.qdga2.old = 3.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qdga2_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.qdga2</span>
<span class="sd">        qdga2(3.800054)</span>

<span class="sd">        First extreme test case (zero division is circumvented):</span>

<span class="sd">        &gt;&gt;&gt; derived.kd2(0.0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qdga2_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.qdga2</span>
<span class="sd">        qdga2(4.0)</span>

<span class="sd">        Second extreme test case (numerical overflow is circumvented):</span>

<span class="sd">        &gt;&gt;&gt; derived.kd2(1e500)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qdga2_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.qdga2</span>
<span class="sd">        qdga2(5.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">KD2</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">QDGZ2</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">QDGA2</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">old</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess_old</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess_new</span>
        <span class="k">if</span> <span class="n">der</span><span class="o">.</span><span class="n">kd2</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">new</span><span class="o">.</span><span class="n">qdga2</span> <span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">qdgz2</span>
        <span class="k">elif</span> <span class="n">der</span><span class="o">.</span><span class="n">kd2</span> <span class="o">&gt;</span> <span class="mf">1e200</span><span class="p">:</span>
            <span class="n">new</span><span class="o">.</span><span class="n">qdga2</span> <span class="o">=</span> <span class="n">old</span><span class="o">.</span><span class="n">qdga2</span> <span class="o">+</span> <span class="n">new</span><span class="o">.</span><span class="n">qdgz2</span> <span class="o">-</span> <span class="n">old</span><span class="o">.</span><span class="n">qdgz2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d_temp</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">der</span><span class="o">.</span><span class="n">kd2</span><span class="p">)</span>
            <span class="n">new</span><span class="o">.</span><span class="n">qdga2</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">old</span><span class="o">.</span><span class="n">qdga2</span>
                <span class="o">+</span> <span class="p">(</span><span class="n">old</span><span class="o">.</span><span class="n">qdgz2</span> <span class="o">-</span> <span class="n">old</span><span class="o">.</span><span class="n">qdga2</span><span class="p">)</span> <span class="o">*</span> <span class="n">d_temp</span>
                <span class="o">+</span> <span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">qdgz2</span> <span class="o">-</span> <span class="n">old</span><span class="o">.</span><span class="n">qdgz2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">der</span><span class="o">.</span><span class="n">kd2</span> <span class="o">*</span> <span class="n">d_temp</span><span class="p">)</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="Calc_QAH_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_QAH_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_QAH_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the final runoff in mm.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">       :math:`QAH = QZH + QBGA + QIGA1 + QIGA2 + QDGA1 + QDGA2 +</span>
<span class="sd">       NKor_{WASSER} - EvI_{WASSER}`</span>

<span class="sd">    In case there are water areas of type |WASSER|, their |NKor| values are</span>
<span class="sd">    added and their |EvPo| values are subtracted from the &quot;potential&quot; runoff</span>
<span class="sd">    value, if possible.  This can result in problematic modifications of</span>
<span class="sd">    simulated runoff series. It seems advisable to use the water types</span>
<span class="sd">    |FLUSS| and |SEE| instead.</span>

<span class="sd">    Examples:</span>

<span class="sd">        When there are no water areas in the respective subbasin (we choose</span>
<span class="sd">        arable land |ACKER| arbitrarily), the inflow (|QZH|) and the different</span>
<span class="sd">        runoff components (|QBGA|, |QIGA1|, |QIGA2|, |QDGA1|, and |QDGA2|)</span>
<span class="sd">        are simply summed up:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(3)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER, ACKER, ACKER)</span>
<span class="sd">        &gt;&gt;&gt; fhru(0.5, 0.2, 0.3)</span>
<span class="sd">        &gt;&gt;&gt; negq(False)</span>
<span class="sd">        &gt;&gt;&gt; states.qbga = 0.1</span>
<span class="sd">        &gt;&gt;&gt; states.qiga1 = 0.2</span>
<span class="sd">        &gt;&gt;&gt; states.qiga2 = 0.3</span>
<span class="sd">        &gt;&gt;&gt; states.qdga1 = 0.4</span>
<span class="sd">        &gt;&gt;&gt; states.qdga2 = 0.5</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qzh = 1.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.nkor = 10.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evi = 4.0, 5.0, 3.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qah_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qah</span>
<span class="sd">        qah(2.5)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evi</span>
<span class="sd">        evi(4.0, 5.0, 3.0)</span>

<span class="sd">        The defined values of interception evaporation do not show any</span>
<span class="sd">        impact on the result of the given example, the predefined values</span>
<span class="sd">        for sequence |EvI| remain unchanged.  But when we define the first</span>
<span class="sd">        hydrological as a water area (|WASSER|), |Calc_QAH_V1| adds the</span>
<span class="sd">        adjusted precipitaton (|NKor|) to and subtracts the interception</span>
<span class="sd">        evaporation (|EvI|) from |lland_fluxes.QAH|:</span>

<span class="sd">        &gt;&gt;&gt; control.lnk(WASSER, VERS, NADELW)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qah_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qah</span>
<span class="sd">        qah(5.5)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evi</span>
<span class="sd">        evi(4.0, 5.0, 3.0)</span>

<span class="sd">        Note that only 5 mm are added (instead of the |NKor| value 10 mm)</span>
<span class="sd">        and that only 2 mm are substracted (instead of the |EvI| value 4 mm,</span>
<span class="sd">        as the first response unit area only accounts for 50 % of the</span>
<span class="sd">        total subbasin area.</span>

<span class="sd">        Setting also the land use class of the second response unit to water</span>
<span class="sd">        type |WASSER| and resetting |NKor| to zero would result in overdrying.</span>
<span class="sd">        To avoid this, both actual water evaporation values stored in</span>
<span class="sd">        sequence |EvI| are reduced by the same factor:</span>

<span class="sd">        &gt;&gt;&gt; control.lnk(WASSER, WASSER, NADELW)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.nkor = 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qah_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qah</span>
<span class="sd">        qah(0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evi</span>
<span class="sd">        evi(3.333333, 4.166667, 3.0)</span>

<span class="sd">        The handling of water areas of type |FLUSS| and |SEE| differs</span>
<span class="sd">        from those of type |WASSER|, as these do receive their net input</span>
<span class="sd">        before the runoff concentration routines are applied.  This</span>
<span class="sd">        should be more realistic in most cases (especially for type |SEE|,</span>
<span class="sd">        representing lakes not directly connected to the stream network).</span>
<span class="sd">        But it could also, at least for very dry periods, result in negative</span>
<span class="sd">        outflow values. We avoid this by setting |lland_fluxes.QAH|</span>
<span class="sd">        to zero and adding the truncated negative outflow value to the |EvI|</span>
<span class="sd">        value of all response units of type |FLUSS| and |SEE|:</span>

<span class="sd">        &gt;&gt;&gt; control.lnk(FLUSS, SEE, NADELW)</span>
<span class="sd">        &gt;&gt;&gt; states.qbga = -1.0</span>
<span class="sd">        &gt;&gt;&gt; states.qdga2 = -1.9</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evi = 4.0, 5.0, 3.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qah_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qah</span>
<span class="sd">        qah(0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evi</span>
<span class="sd">        evi(2.571429, 3.571429, 3.0)</span>

<span class="sd">        This adjustment of |EvI| is only correct regarding the total</span>
<span class="sd">        water balance.  Neither spatial nor temporal consistency of the</span>
<span class="sd">        resulting |EvI| values are assured.  In the most extreme case,</span>
<span class="sd">        even negative |EvI| values might occur.  This seems acceptable,</span>
<span class="sd">        as long as the adjustment of |EvI| is rarely triggered.  When in</span>
<span class="sd">        doubt about this, check sequences |EvPo| and |EvI| of all |FLUSS|</span>
<span class="sd">        and |SEE| units for possible discrepancies.  Also note that</span>
<span class="sd">        |lland_fluxes.QAH| might perform unnecessary corrections when you</span>
<span class="sd">        combine water type |WASSER| with water type |SEE| or |FLUSS|.</span>

<span class="sd">        For some model configurations, negative discharges for dry conditions</span>
<span class="sd">        are acceptable or even preferable, which is possible through</span>
<span class="sd">        setting parameter |NegQ| to |True|:</span>

<span class="sd">        &gt;&gt;&gt; negq(True)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evi = 4.0, 5.0, 3.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qah_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qah</span>
<span class="sd">        qah(-1.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evi</span>
<span class="sd">        evi(4.0, 5.0, 3.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NegQ</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">FHRU</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">QBGA</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">QIGA1</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">QIGA2</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">QDGA1</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">QDGA2</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NKor</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QZH</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">EvI</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QAH</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">qah</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">qzh</span> <span class="o">+</span> <span class="n">sta</span><span class="o">.</span><span class="n">qbga</span> <span class="o">+</span> <span class="n">sta</span><span class="o">.</span><span class="n">qiga1</span> <span class="o">+</span> <span class="n">sta</span><span class="o">.</span><span class="n">qiga2</span> <span class="o">+</span> <span class="n">sta</span><span class="o">.</span><span class="n">qdga1</span> <span class="o">+</span> <span class="n">sta</span><span class="o">.</span><span class="n">qdga2</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">con</span><span class="o">.</span><span class="n">negq</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">qah</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">):</span>
            <span class="n">d_area</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">):</span>
                    <span class="n">d_area</span> <span class="o">+=</span> <span class="n">con</span><span class="o">.</span><span class="n">fhru</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">d_area</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">):</span>
                        <span class="n">flu</span><span class="o">.</span><span class="n">evi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">qah</span> <span class="o">/</span> <span class="n">d_area</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">qah</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">d_epw</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">WASSER</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">qah</span> <span class="o">+=</span> <span class="n">con</span><span class="o">.</span><span class="n">fhru</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">nkor</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">d_epw</span> <span class="o">+=</span> <span class="n">con</span><span class="o">.</span><span class="n">fhru</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">evi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">qah</span> <span class="o">&gt;</span> <span class="n">d_epw</span><span class="p">)</span> <span class="ow">or</span> <span class="n">con</span><span class="o">.</span><span class="n">negq</span><span class="p">:</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">qah</span> <span class="o">-=</span> <span class="n">d_epw</span>
        <span class="k">elif</span> <span class="n">d_epw</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">WASSER</span><span class="p">:</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">evi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*=</span> <span class="n">flu</span><span class="o">.</span><span class="n">qah</span> <span class="o">/</span> <span class="n">d_epw</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">qah</span> <span class="o">=</span> <span class="mf">0.0</span></div>


<div class="viewcode-block" id="Calc_QA_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_QA_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_QA_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the final runoff in m³/s.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">       :math:`QA = QFactor \\cdot QAH`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; derived.qfactor(2.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qah = 3.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qa_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qa</span>
<span class="sd">        qa(6.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">QFactor</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QAH</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QA</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">qa</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">qfactor</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">qah</span></div>


<div class="viewcode-block" id="Pass_QA_V1"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Pass_QA_V1">[docs]</a><span class="k">class</span> <span class="nc">Pass_QA_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Update the outlet link sequence.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">       :math:`Q_{outlets} = QA`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QA</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_outlets</span><span class="o">.</span><span class="n">Q</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">outlets</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">out</span><span class="o">.</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">qa</span></div>


<div class="viewcode-block" id="PegasusESnowInz"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.PegasusESnowInz">[docs]</a><span class="k">class</span> <span class="nc">PegasusESnowInz</span><span class="p">(</span><span class="n">roottools</span><span class="o">.</span><span class="n">Pegasus</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Pegasus iterator for finding the correct energy content of the intercepted</span>
<span class="sd">    snow.&quot;&quot;&quot;</span>

    <span class="n">METHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Return_BackwardEulerErrorInz_V1</span><span class="p">,)</span></div>


<div class="viewcode-block" id="PegasusESnow"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.PegasusESnow">[docs]</a><span class="k">class</span> <span class="nc">PegasusESnow</span><span class="p">(</span><span class="n">roottools</span><span class="o">.</span><span class="n">Pegasus</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Pegasus iterator for finding the correct snow energy content.&quot;&quot;&quot;</span>

    <span class="n">METHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Return_BackwardEulerError_V1</span><span class="p">,)</span></div>


<div class="viewcode-block" id="PegasusTempSSurface"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.PegasusTempSSurface">[docs]</a><span class="k">class</span> <span class="nc">PegasusTempSSurface</span><span class="p">(</span><span class="n">roottools</span><span class="o">.</span><span class="n">Pegasus</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Pegasus iterator for finding the correct snow surface temperature.&quot;&quot;&quot;</span>

    <span class="n">METHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Return_EnergyGainSnowSurface_V1</span><span class="p">,)</span></div>


<div class="viewcode-block" id="Model"><a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Model">[docs]</a><span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">AdHocModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base model for HydPy-L-Land.&quot;&quot;&quot;</span>

    <span class="n">INLET_METHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Pick_QZ_V1</span><span class="p">,)</span>
    <span class="n">RECEIVER_METHODS</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">ADD_METHODS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Return_AdjustedWindSpeed_V1</span><span class="p">,</span>
        <span class="n">Return_ActualVapourPressure_V1</span><span class="p">,</span>
        <span class="n">Calc_DailyNetLongwaveRadiation_V1</span><span class="p">,</span>
        <span class="n">Return_NetLongwaveRadiationInz_V1</span><span class="p">,</span>
        <span class="n">Return_NetLongwaveRadiationSnow_V1</span><span class="p">,</span>
        <span class="n">Return_DailyGlobalRadiation_V1</span><span class="p">,</span>
        <span class="n">Return_Penman_V1</span><span class="p">,</span>
        <span class="n">Return_PenmanMonteith_V1</span><span class="p">,</span>
        <span class="n">Return_EnergyGainSnowSurface_V1</span><span class="p">,</span>
        <span class="n">Return_SaturationVapourPressure_V1</span><span class="p">,</span>
        <span class="n">Return_SaturationVapourPressureSlope_V1</span><span class="p">,</span>
        <span class="n">Return_NetRadiation_V1</span><span class="p">,</span>
        <span class="n">Return_WSensInz_V1</span><span class="p">,</span>
        <span class="n">Return_WSensSnow_V1</span><span class="p">,</span>
        <span class="n">Return_WLatInz_V1</span><span class="p">,</span>
        <span class="n">Return_WLatSnow_V1</span><span class="p">,</span>
        <span class="n">Return_WSurfInz_V1</span><span class="p">,</span>
        <span class="n">Return_WSurf_V1</span><span class="p">,</span>
        <span class="n">Return_BackwardEulerErrorInz_V1</span><span class="p">,</span>
        <span class="n">Return_BackwardEulerError_V1</span><span class="p">,</span>
        <span class="n">Return_TempSInz_V1</span><span class="p">,</span>
        <span class="n">Return_TempS_V1</span><span class="p">,</span>
        <span class="n">Return_WG_V1</span><span class="p">,</span>
        <span class="n">Return_ESnowInz_V1</span><span class="p">,</span>
        <span class="n">Return_ESnow_V1</span><span class="p">,</span>
        <span class="n">Return_TempSSurface_V1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RUN_METHODS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Calc_QZH_V1</span><span class="p">,</span>
        <span class="n">Update_LoggedTemL_V1</span><span class="p">,</span>
        <span class="n">Calc_TemLTag_V1</span><span class="p">,</span>
        <span class="n">Update_LoggedRelativeHumidity_V1</span><span class="p">,</span>
        <span class="n">Calc_DailyRelativeHumidity_V1</span><span class="p">,</span>
        <span class="n">Update_LoggedSunshineDuration_V1</span><span class="p">,</span>
        <span class="n">Calc_NKor_V1</span><span class="p">,</span>
        <span class="n">Calc_TKor_V1</span><span class="p">,</span>
        <span class="n">Calc_TKorTag_V1</span><span class="p">,</span>
        <span class="n">Calc_WindSpeed2m_V1</span><span class="p">,</span>
        <span class="n">Calc_ReducedWindSpeed2m_V1</span><span class="p">,</span>
        <span class="n">Update_LoggedWindSpeed2m_V1</span><span class="p">,</span>
        <span class="n">Calc_DailyWindSpeed2m_V1</span><span class="p">,</span>
        <span class="n">Calc_WindSpeed10m_V1</span><span class="p">,</span>
        <span class="n">Calc_SolarDeclination_V1</span><span class="p">,</span>
        <span class="n">Calc_DailySunshineDuration_V1</span><span class="p">,</span>
        <span class="n">Calc_TSA_TSU_V1</span><span class="p">,</span>
        <span class="n">Calc_EarthSunDistance_V1</span><span class="p">,</span>
        <span class="n">Calc_ExtraterrestrialRadiation_V1</span><span class="p">,</span>
        <span class="n">Calc_PossibleSunshineDuration_V1</span><span class="p">,</span>
        <span class="n">Calc_DailyPossibleSunshineDuration_V1</span><span class="p">,</span>
        <span class="n">Calc_SP_V1</span><span class="p">,</span>
        <span class="n">Calc_GlobalRadiation_V1</span><span class="p">,</span>
        <span class="n">Update_LoggedGlobalRadiation_V1</span><span class="p">,</span>
        <span class="n">Calc_DailyGlobalRadiation_V1</span><span class="p">,</span>
        <span class="n">Calc_AdjustedGlobalRadiation_V1</span><span class="p">,</span>
        <span class="n">Calc_SaturationVapourPressure_V1</span><span class="p">,</span>
        <span class="n">Calc_DailySaturationVapourPressure_V1</span><span class="p">,</span>
        <span class="n">Calc_SaturationVapourPressureSlope_V1</span><span class="p">,</span>
        <span class="n">Calc_DailySaturationVapourPressureSlope_V1</span><span class="p">,</span>
        <span class="n">Calc_ActualVapourPressure_V1</span><span class="p">,</span>
        <span class="n">Calc_DailyActualVapourPressure_V1</span><span class="p">,</span>
        <span class="n">Calc_ET0_V1</span><span class="p">,</span>
        <span class="n">Calc_ET0_WET0_V1</span><span class="p">,</span>
        <span class="n">Calc_EvPo_V1</span><span class="p">,</span>
        <span class="n">Calc_NBes_Inzp_V1</span><span class="p">,</span>
        <span class="n">Calc_SNRatio_V1</span><span class="p">,</span>
        <span class="n">Calc_SBes_V1</span><span class="p">,</span>
        <span class="n">Calc_SnowIntMax_V1</span><span class="p">,</span>
        <span class="n">Calc_SnowIntRate_V1</span><span class="p">,</span>
        <span class="n">Calc_NBesInz_V1</span><span class="p">,</span>
        <span class="n">Calc_SBesInz_V1</span><span class="p">,</span>
        <span class="n">Calc_STInz_V1</span><span class="p">,</span>
        <span class="n">Calc_WaDaInz_SInz_V1</span><span class="p">,</span>
        <span class="n">Calc_WNiedInz_ESnowInz_V1</span><span class="p">,</span>
        <span class="n">Calc_TempSInz_V1</span><span class="p">,</span>
        <span class="n">Update_ASInz_V1</span><span class="p">,</span>
        <span class="n">Calc_NetShortwaveRadiationInz_V1</span><span class="p">,</span>
        <span class="n">Calc_ActualAlbedoInz_V1</span><span class="p">,</span>
        <span class="n">Update_ESnowInz_V1</span><span class="p">,</span>
        <span class="n">Calc_SchmPotInz_V1</span><span class="p">,</span>
        <span class="n">Calc_SchmInz_STInz_V1</span><span class="p">,</span>
        <span class="n">Calc_GefrPotInz_V1</span><span class="p">,</span>
        <span class="n">Calc_GefrInz_STInz_V1</span><span class="p">,</span>
        <span class="n">Calc_EvSInz_SInz_STInz_V1</span><span class="p">,</span>
        <span class="n">Update_WaDaInz_SInz_V1</span><span class="p">,</span>
        <span class="n">Update_ESnowInz_V2</span><span class="p">,</span>
        <span class="n">Calc_WATS_V1</span><span class="p">,</span>
        <span class="n">Calc_WATS_V2</span><span class="p">,</span>
        <span class="n">Calc_WaDa_WAeS_V1</span><span class="p">,</span>
        <span class="n">Calc_WaDa_WAeS_V2</span><span class="p">,</span>
        <span class="n">Calc_WGTF_V1</span><span class="p">,</span>
        <span class="n">Calc_WNied_V1</span><span class="p">,</span>
        <span class="n">Calc_WNied_ESnow_V1</span><span class="p">,</span>
        <span class="n">Calc_TZ_V1</span><span class="p">,</span>
        <span class="n">Calc_WG_V1</span><span class="p">,</span>
        <span class="n">Calc_TempS_V1</span><span class="p">,</span>
        <span class="n">Update_TauS_V1</span><span class="p">,</span>
        <span class="n">Calc_ActualAlbedo_V1</span><span class="p">,</span>
        <span class="n">Calc_NetShortwaveRadiation_V1</span><span class="p">,</span>
        <span class="n">Calc_NetShortwaveRadiationSnow_V1</span><span class="p">,</span>
        <span class="n">Calc_DailyNetShortwaveRadiation_V1</span><span class="p">,</span>
        <span class="n">Calc_RLAtm_V1</span><span class="p">,</span>
        <span class="n">Calc_G_V1</span><span class="p">,</span>
        <span class="n">Calc_G_V2</span><span class="p">,</span>
        <span class="n">Calc_EvB_V2</span><span class="p">,</span>
        <span class="n">Update_EBdn_V1</span><span class="p">,</span>
        <span class="n">Update_ESnow_V1</span><span class="p">,</span>
        <span class="n">Calc_NetRadiation_V1</span><span class="p">,</span>
        <span class="n">Calc_DailyNetRadiation_V1</span><span class="p">,</span>
        <span class="n">Calc_DryAirPressure_V1</span><span class="p">,</span>
        <span class="n">Calc_DensityAir_V1</span><span class="p">,</span>
        <span class="n">Calc_AerodynamicResistance_V1</span><span class="p">,</span>
        <span class="n">Calc_SoilSurfaceResistance_V1</span><span class="p">,</span>
        <span class="n">Calc_LanduseSurfaceResistance_V1</span><span class="p">,</span>
        <span class="n">Calc_ActualSurfaceResistance_V1</span><span class="p">,</span>
        <span class="n">Calc_EvPo_V2</span><span class="p">,</span>
        <span class="n">Calc_EvI_Inzp_V1</span><span class="p">,</span>
        <span class="n">Calc_EvI_Inzp_V2</span><span class="p">,</span>
        <span class="n">Calc_EvI_Inzp_V3</span><span class="p">,</span>
        <span class="n">Calc_EvB_V1</span><span class="p">,</span>
        <span class="n">Calc_SchmPot_V1</span><span class="p">,</span>
        <span class="n">Calc_SchmPot_V2</span><span class="p">,</span>
        <span class="n">Calc_GefrPot_V1</span><span class="p">,</span>
        <span class="n">Calc_Schm_WATS_V1</span><span class="p">,</span>
        <span class="n">Calc_Gefr_WATS_V1</span><span class="p">,</span>
        <span class="n">Calc_EvS_WAeS_WATS_V1</span><span class="p">,</span>
        <span class="n">Update_WaDa_WAeS_V1</span><span class="p">,</span>
        <span class="n">Update_ESnow_V2</span><span class="p">,</span>
        <span class="n">Calc_SFF_V1</span><span class="p">,</span>
        <span class="n">Calc_FVG_V1</span><span class="p">,</span>
        <span class="n">Calc_QKap_V1</span><span class="p">,</span>
        <span class="n">Calc_QBB_V1</span><span class="p">,</span>
        <span class="n">Calc_QIB1_V1</span><span class="p">,</span>
        <span class="n">Calc_QIB2_V1</span><span class="p">,</span>
        <span class="n">Calc_QDB_V1</span><span class="p">,</span>
        <span class="n">Update_QDB_V1</span><span class="p">,</span>
        <span class="n">Calc_BoWa_V1</span><span class="p">,</span>
        <span class="n">Calc_QBGZ_V1</span><span class="p">,</span>
        <span class="n">Calc_QIGZ1_V1</span><span class="p">,</span>
        <span class="n">Calc_QIGZ2_V1</span><span class="p">,</span>
        <span class="n">Calc_QDGZ_V1</span><span class="p">,</span>
        <span class="n">Calc_QBGA_V1</span><span class="p">,</span>
        <span class="n">Update_QDGZ_QBGZ_QBGA_V1</span><span class="p">,</span>
        <span class="n">Update_QDGZ_QBGZ_QBGA_V2</span><span class="p">,</span>
        <span class="n">Calc_QIGA1_V1</span><span class="p">,</span>
        <span class="n">Calc_QIGA2_V1</span><span class="p">,</span>
        <span class="n">Calc_QDGZ1_QDGZ2_V1</span><span class="p">,</span>
        <span class="n">Calc_QDGA1_V1</span><span class="p">,</span>
        <span class="n">Calc_QDGA2_V1</span><span class="p">,</span>
        <span class="n">Calc_QAH_V1</span><span class="p">,</span>
        <span class="n">Calc_QA_V1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">OUTLET_METHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Pass_QA_V1</span><span class="p">,)</span>
    <span class="n">SENDER_METHODS</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">SUBMODELS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">PegasusESnowInz</span><span class="p">,</span>
        <span class="n">PegasusESnow</span><span class="p">,</span>
        <span class="n">PegasusTempSSurface</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">idx_hru</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Idx_HRU</span><span class="p">()</span></div>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../../index.html">
              <img class="logo" src="../../../../_static/HydPy_Logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="../../../../index.html">Table of Contents</a></h3>
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../install.html">Installation Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../how_to.html">How to…</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../framework.html">Framework Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../modelcollection.html">Model Collection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../development.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../examples.html">Example Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../zbibliography.html">Bibliography</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">HydPy 4.0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">hydpy.models.lland.lland_model</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2021, HydPy Developers.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.5.2.
    </div>
  </body>
</html>