<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>hydpy.models.exch_v001 &#8212; HydPy 5.0.3 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../../_static/classic.css?v=127cebf3" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=eafc0fe6" />
    
    <script src="../../../_static/documentation_options.js?v=f98c4cc8"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">HydPy 5.0.3 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">hydpy.models.exch_v001</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/HydPy_Logo.png" alt="Logo"/>
            </a></p>
  <div>
    <h3><a href="../../../index.html">Table of Contents</a></h3>
    <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installation Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../how_to.html">How to…</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../framework.html">Framework Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modelcollection.html">Model Collection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../development.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples.html">Example Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../zbibliography.html">Bibliography</a></li>
</ul>

  </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for hydpy.models.exch_v001</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># pylint: disable=line-too-long, unused-wildcard-import</span>
<span class="sd">&quot;&quot;&quot;Bidirectional water exchange over a weir.</span>

<span class="sd">.. _`German Federal Institute of Hydrology (BfG)`: https://www.bafg.de/EN</span>

<span class="sd">Version 1 of `HydPy-Exch` implements the general weir formula.  We implemented it on</span>
<span class="sd">behalf of the `German Federal Institute of Hydrology (BfG)`_ to connect different</span>
<span class="sd">|dam_v006| instances (lake models), enabling them to exchange water based on water</span>
<span class="sd">level differences.  This specific combination serves to model some huge, connected</span>
<span class="sd">(sub)lakes of the Rhine basin similar to HBV96 :cite:p:`ref-Lindstrom1997HBV96`.</span>
<span class="sd">Combinations with other models providing (something like) water level information and</span>
<span class="sd">allowing for an additional inflow that can be positive and negative are possible.</span>

<span class="sd">Integration tests</span>
<span class="sd">=================</span>

<span class="sd">.. how_to_understand_integration_tests::</span>

<span class="sd">We perform all integration tests over a month with a simulation step of one day:</span>

<span class="sd">&gt;&gt;&gt; from hydpy import Element, FusedVariable, Nodes, PPoly, prepare_model, pub</span>
<span class="sd">&gt;&gt;&gt; pub.timegrids = &quot;2000-01-01&quot;, &quot;2000-02-01&quot;, &quot;1d&quot;</span>

<span class="sd">The following examples demonstrate how |exch_v001| interacts with lake models like</span>
<span class="sd">|dam_v006|.  Therefore, we must set up one |exch_v001| instance and two |dam_v006|</span>
<span class="sd">instances.</span>

<span class="sd">First, we define the eight required |Node| objects:</span>

<span class="sd"> * `inflow1` and `inflow2` pass the inflow into the first and the second lake.</span>
<span class="sd"> * `outflow1` and `outflow2` receive the lakes&#39; outflows.</span>
<span class="sd"> * `overflow1` and `overflow2` exchange water between the lakes.</span>
<span class="sd"> * `waterlevel1` and `waterlevel2` inform the exchange model about the lakes&#39; current</span>
<span class="sd">   water levels.</span>

<span class="sd">We define the |Node.variable| type of all nodes explicitly.  For the inflow and outflow</span>
<span class="sd">nodes, we stick to the default by using the string literal &quot;Q&quot;, telling |dam_v006| to</span>
<span class="sd">connect these nodes to the inlet sequence |dam_inlets.Q| and outlet sequence</span>
<span class="sd">|dam_outlets.Q|, respectively:</span>

<span class="sd">&gt;&gt;&gt; inflow1, inflow2  = Nodes(&quot;inflow1&quot;, &quot;inflow2&quot;, defaultvariable=&quot;Q&quot;)</span>
<span class="sd">&gt;&gt;&gt; outflow1, outflow2  = Nodes(&quot;outflow1&quot;, &quot;outflow2&quot;, defaultvariable=&quot;Q&quot;)</span>

<span class="sd">The overflow nodes do not connect both lakes directly but the lakes with the exchange</span>
<span class="sd">model. Still, we can use a single string literal (&quot;E&quot;) because the exchange-related</span>
<span class="sd">inlet sequence of |dam_v006| (|dam_inlets.E|) and the only outlet sequence of</span>
<span class="sd">|exch_v001| (|exch_outlets.E|) have the same name:</span>

<span class="sd">&gt;&gt;&gt; overflow1, overflow2 = Nodes(&quot;overflow1&quot;, &quot;overflow2&quot;, defaultvariable=&quot;E&quot;)</span>

<span class="sd">The water level nodes require a little more effort in first defining a |FusedVariable|.</span>
<span class="sd">This fused variable combines the string literal &quot;L&quot; (telling |exch_v001| to connect</span>
<span class="sd">both nodes to the receiver sequence |exch_receivers.L|) and the alias of output</span>
<span class="sd">sequence |dam_factors.WaterLevel| of |dam_v006|:</span>

<span class="sd">&gt;&gt;&gt; from hydpy.outputs import dam_WaterLevel</span>
<span class="sd">&gt;&gt;&gt; WaterLevel = FusedVariable(&quot;L&quot;, dam_WaterLevel)</span>
<span class="sd">&gt;&gt;&gt; waterlevel1, waterlevel2 = Nodes(&quot;waterlevel1&quot;, &quot;waterlevel2&quot;, defaultvariable=WaterLevel)</span>

<span class="sd">Now we prepare the two |Element| objects holding the |dam_v006| instances.  The</span>
<span class="sd">configuration is similar to the one in the documentation on |dam_v006|, except in</span>
<span class="sd">connecting `waterlevel1` and `waterlevel2` as additional output nodes:</span>

<span class="sd">&gt;&gt;&gt; lake1 = Element(&quot;lake1&quot;,</span>
<span class="sd">...                 inlets=(inflow1, overflow1),</span>
<span class="sd">...                 outlets=outflow1,</span>
<span class="sd">...                 outputs=waterlevel1)</span>
<span class="sd">&gt;&gt;&gt; lake2 = Element(&quot;lake2&quot;,</span>
<span class="sd">...                 inlets=(inflow2, overflow2),</span>
<span class="sd">...                 outlets=outflow2,</span>
<span class="sd">...                 outputs=waterlevel2)</span>

<span class="sd">From the perspective of the exchange element, `waterlevel1` and `waterlevel2` are</span>
<span class="sd">receiver nodes, while `overflow1` and `overflow2` are outlet nodes.  At the beginning</span>
<span class="sd">of each simulation step, |exch_v001| receives water level information from both lakes.</span>
<span class="sd">Then, it calculates the correct exchange and sends it to both lakes via the overflow</span>
<span class="sd">nodes, but with different signs.  If the first lake&#39;s water level is higher, it passes</span>
<span class="sd">a negative value to `overflow1` (the first lake loses water) and a positive value to</span>
<span class="sd">`overflow2` (the second lake gains water), and vice versa:</span>

<span class="sd">&gt;&gt;&gt; exchange = Element(&quot;exchange&quot;,</span>
<span class="sd">...                    receivers=(waterlevel1, waterlevel2),</span>
<span class="sd">...                    outlets=(overflow1, overflow2))</span>

<span class="sd">In our test configuration, both the nodes&#39; names and the order in which we give them to</span>
<span class="sd">the constructor of class |Element| agree with the nodes&#39; target lakes.  This practice</span>
<span class="sd">seems advisable for keeping clarity, but it is not a technical requirement.  The</span>
<span class="sd">documentation on class |exch_v001.Model| explains the internal sorting mechanisms and</span>
<span class="sd">plausibility checks underlying the connection-related functionalities of |exch_v001|.</span>

<span class="sd">We parameterise both lake models identically. All of the following values stem from</span>
<span class="sd">the documentation on |dam_v006|.  We will use them in all examples:</span>

<span class="sd">&gt;&gt;&gt; lake1.model = prepare_model(&quot;dam_v006&quot;)</span>
<span class="sd">&gt;&gt;&gt; lake2.model = prepare_model(&quot;dam_v006&quot;)</span>
<span class="sd">&gt;&gt;&gt; from numpy import inf</span>
<span class="sd">&gt;&gt;&gt; for model_ in (lake1.model, lake2.model):</span>
<span class="sd">...     control = model_.parameters.control</span>
<span class="sd">...     control.catchmentarea(86.4)</span>
<span class="sd">...     control.surfacearea(1.44)</span>
<span class="sd">...     control.correctionprecipitation(1.2)</span>
<span class="sd">...     control.correctionevaporation(1.2)</span>
<span class="sd">...     control.weightevaporation(0.8)</span>
<span class="sd">...     control.thresholdevaporation(0.0)</span>
<span class="sd">...     control.dischargetolerance(0.1)</span>
<span class="sd">...     control.toleranceevaporation(0.001)</span>
<span class="sd">...     control.allowedwaterleveldrop(inf)</span>
<span class="sd">...     control.watervolume2waterlevel(PPoly.from_data(xs=[0.0, 1.0], ys=[0.0, 1.0]))</span>
<span class="sd">...     control.pars.update()</span>

<span class="sd">Now we prepare the exchange model.  We will use common values for the flow coefficient</span>
<span class="sd">and exponent throughout the following examples:</span>

<span class="sd">&gt;&gt;&gt; from hydpy.models.exch_v001 import *</span>
<span class="sd">&gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">&gt;&gt;&gt; flowcoefficient(0.62)</span>
<span class="sd">&gt;&gt;&gt; flowexponent(1.5)</span>
<span class="sd">&gt;&gt;&gt; exchange.model = model</span>

<span class="sd">An |IntegrationTest| object will help us to perform the individual examples:</span>

<span class="sd">&gt;&gt;&gt; from hydpy.core.testtools import IntegrationTest</span>
<span class="sd">&gt;&gt;&gt; test = IntegrationTest(exchange)</span>
<span class="sd">&gt;&gt;&gt; test.plotting_options.axis1 = (factors.waterlevel,)</span>
<span class="sd">&gt;&gt;&gt; test.plotting_options.axis2 = (fluxes.potentialexchange, fluxes.actualexchange)</span>

<span class="sd">For simplicity, we set both lakes&#39; inflow, precipitation, and evaporation to zero:</span>

<span class="sd">&gt;&gt;&gt; inflow1.sequences.sim.series = 0.0</span>
<span class="sd">&gt;&gt;&gt; inflow2.sequences.sim.series = 0.0</span>
<span class="sd">&gt;&gt;&gt; for model_ in (lake1.model, lake2.model):</span>
<span class="sd">...     inputs = model_.sequences.inputs</span>
<span class="sd">...     for seq in (inputs.precipitation, inputs.evaporation):</span>
<span class="sd">...         seq.prepare_series()</span>
<span class="sd">...         seq.series = 0.0</span>

<span class="sd">The only difference between both lakes is their initial state.  The first lake starts</span>
<span class="sd">empty, and the second lake starts with a water volume of 1 million m³.  Note that</span>
<span class="sd">|exch_v001| requires the same information.  We must give it to the log sequence</span>
<span class="sd">|LoggedWaterLevel|:</span>

<span class="sd">&gt;&gt;&gt; test.inits = [(lake1.model.sequences.states.watervolume, 0.0),</span>
<span class="sd">...               (lake1.model.sequences.logs.loggedadjustedevaporation, 0.0),</span>
<span class="sd">...               (lake2.model.sequences.states.watervolume, 1.0),</span>
<span class="sd">...               (lake2.model.sequences.logs.loggedadjustedevaporation, 0.0),</span>
<span class="sd">...               (logs.loggedwaterlevel, (0.0, 1.0))]</span>

<span class="sd">.. _exch_v001_base_scenario:</span>

<span class="sd">base scenario</span>
<span class="sd">_____________</span>

<span class="sd">Our base scenario defines a small crest width of 0.2 meters, enabling only limited</span>
<span class="sd">water exchange:</span>

<span class="sd">&gt;&gt;&gt; crestwidth(0.2)</span>

<span class="sd">The crest height of 0.0 m and the allowed exchange of 5.0 m³/s are so low and high,</span>
<span class="sd">respectively, that they do not affect the following results:</span>

<span class="sd">&gt;&gt;&gt; crestheight(0.0)</span>
<span class="sd">&gt;&gt;&gt; allowedexchange(5.0)</span>

<span class="sd">We define a linear relationship between the water level and the outflow for both lakes:</span>

<span class="sd">&gt;&gt;&gt; for model_ in (lake1.model, lake2.model):</span>
<span class="sd">...     model_.parameters.control.waterlevel2flooddischarge(</span>
<span class="sd">...         PPoly.from_data(xs=[0.0, 1.0], ys=[0.0, 2.0]))</span>

<span class="sd">The following results show that the first lake&#39;s water level drops fast due to releasing</span>
<span class="sd">water to the second lake and its outlet.  The second lake receives this overflow through</span>
<span class="sd">the whole simulation period but with a decreasing tendency.  Hence, the water level</span>
<span class="sd">rises initially but then falls again because of the lake&#39;s outflow:</span>

<span class="sd">.. integration-test::</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;exch_v001_base_scenario&quot;)</span>
<span class="sd">    |                date |           waterlevel | deltawaterlevel | potentialexchange | actualexchange | inflow1 | inflow2 | outflow1 | outflow2 | overflow1 | overflow2 | waterlevel1 | waterlevel2 |</span>
<span class="sd">    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span>
<span class="sd">    | 2000-01-01 00:00:00 |      0.0         1.0 |            -1.0 |            -0.124 |         -0.124 |     0.0 |     0.0 | 0.010096 |   1.8266 |     0.124 |    -0.124 |    0.009841 |    0.831468 |</span>
<span class="sd">    | 2000-01-02 00:00:00 | 0.009841    0.831468 |       -0.821627 |         -0.092349 |      -0.092349 |     0.0 |     0.0 | 0.025961 | 1.520015 |  0.092349 | -0.092349 |    0.015577 |     0.69216 |</span>
<span class="sd">    | 2000-01-03 00:00:00 | 0.015577     0.69216 |       -0.676583 |         -0.069009 |      -0.069009 |     0.0 |     0.0 | 0.034425 | 1.265985 |  0.069009 | -0.069009 |    0.018565 |    0.576816 |</span>
<span class="sd">    | 2000-01-04 00:00:00 | 0.018565    0.576816 |       -0.558251 |         -0.051721 |      -0.051721 |     0.0 |     0.0 | 0.038391 | 1.055489 |  0.051721 | -0.051721 |    0.019717 |    0.481154 |</span>
<span class="sd">    | 2000-01-05 00:00:00 | 0.019717    0.481154 |       -0.461437 |         -0.038868 |      -0.038868 |     0.0 |     0.0 | 0.039385 | 0.880788 |  0.038868 | -0.038868 |    0.019672 |    0.401695 |</span>
<span class="sd">    | 2000-01-06 00:00:00 | 0.019672    0.401695 |       -0.382023 |         -0.029279 |      -0.029279 |     0.0 |     0.0 | 0.038475 | 0.735592 |  0.029279 | -0.029279 |    0.018878 |     0.33561 |</span>
<span class="sd">    | 2000-01-07 00:00:00 | 0.018878     0.33561 |       -0.316733 |         -0.022103 |      -0.022103 |     0.0 |     0.0 | 0.036403 | 0.614768 |  0.022103 | -0.022103 |    0.017642 |    0.280585 |</span>
<span class="sd">    | 2000-01-08 00:00:00 | 0.017642    0.280585 |       -0.262942 |         -0.016719 |      -0.016719 |     0.0 |     0.0 |  0.03368 | 0.514116 |  0.016719 | -0.016719 |    0.016177 |    0.234721 |</span>
<span class="sd">    | 2000-01-09 00:00:00 | 0.016177    0.234721 |       -0.218544 |         -0.012669 |      -0.012669 |     0.0 |     0.0 | 0.030653 | 0.430186 |  0.012669 | -0.012669 |    0.014623 |    0.196458 |</span>
<span class="sd">    | 2000-01-10 00:00:00 | 0.014623    0.196458 |       -0.181835 |         -0.009615 |      -0.009615 |     0.0 |     0.0 |  0.02755 |  0.36014 |  0.009615 | -0.009615 |    0.013073 |    0.164511 |</span>
<span class="sd">    | 2000-01-11 00:00:00 | 0.013073    0.164511 |       -0.151438 |         -0.007308 |      -0.007308 |     0.0 |     0.0 | 0.024519 | 0.301637 |  0.007308 | -0.007308 |    0.011586 |    0.137818 |</span>
<span class="sd">    | 2000-01-12 00:00:00 | 0.011586    0.137818 |       -0.126232 |         -0.005561 |      -0.005561 |     0.0 |     0.0 | 0.021651 |  0.25274 |  0.005561 | -0.005561 |    0.010196 |    0.115501 |</span>
<span class="sd">    | 2000-01-13 00:00:00 | 0.010196    0.115501 |       -0.105305 |         -0.004237 |      -0.004237 |     0.0 |     0.0 | 0.018997 | 0.211848 |  0.004237 | -0.004237 |    0.008921 |    0.096831 |</span>
<span class="sd">    | 2000-01-14 00:00:00 | 0.008921    0.096831 |        -0.08791 |         -0.003232 |      -0.003232 |     0.0 |     0.0 |  0.01658 | 0.177631 |  0.003232 | -0.003232 |    0.007768 |    0.081205 |</span>
<span class="sd">    | 2000-01-15 00:00:00 | 0.007768    0.081205 |       -0.073437 |         -0.002468 |      -0.002468 |     0.0 |     0.0 | 0.014406 | 0.148985 |  0.002468 | -0.002468 |    0.006736 |    0.068119 |</span>
<span class="sd">    | 2000-01-16 00:00:00 | 0.006736    0.068119 |       -0.061383 |         -0.001886 |      -0.001886 |     0.0 |     0.0 | 0.012471 | 0.124992 |  0.001886 | -0.001886 |    0.005822 |    0.057157 |</span>
<span class="sd">    | 2000-01-17 00:00:00 | 0.005822    0.057157 |       -0.051335 |         -0.001442 |      -0.001442 |     0.0 |     0.0 | 0.010762 | 0.104889 |  0.001442 | -0.001442 |    0.005016 |     0.04797 |</span>
<span class="sd">    | 2000-01-18 00:00:00 | 0.005016     0.04797 |       -0.042954 |         -0.001104 |      -0.001104 |     0.0 |     0.0 | 0.009261 | 0.087555 |  0.001104 | -0.001104 |    0.004312 |     0.04031 |</span>
<span class="sd">    | 2000-01-19 00:00:00 | 0.004312     0.04031 |       -0.035998 |         -0.000847 |      -0.000847 |     0.0 |     0.0 | 0.007951 | 0.073581 |  0.000847 | -0.000847 |    0.003698 |    0.033879 |</span>
<span class="sd">    | 2000-01-20 00:00:00 | 0.003698    0.033879 |       -0.030181 |          -0.00065 |       -0.00065 |     0.0 |     0.0 | 0.006813 | 0.061848 |   0.00065 |  -0.00065 |    0.003165 |    0.028479 |</span>
<span class="sd">    | 2000-01-21 00:00:00 | 0.003165    0.028479 |       -0.025314 |         -0.000499 |      -0.000499 |     0.0 |     0.0 | 0.005827 | 0.051994 |  0.000499 | -0.000499 |    0.002705 |    0.023944 |</span>
<span class="sd">    | 2000-01-22 00:00:00 | 0.002705    0.023944 |       -0.021239 |         -0.000384 |      -0.000384 |     0.0 |     0.0 | 0.004976 | 0.043717 |  0.000384 | -0.000384 |    0.002308 |    0.020134 |</span>
<span class="sd">    | 2000-01-23 00:00:00 | 0.002308    0.020134 |       -0.017825 |         -0.000295 |      -0.000295 |     0.0 |     0.0 | 0.004243 | 0.036763 |  0.000295 | -0.000295 |    0.001967 |    0.016932 |</span>
<span class="sd">    | 2000-01-24 00:00:00 | 0.001967    0.016932 |       -0.014965 |         -0.000227 |      -0.000227 |     0.0 |     0.0 | 0.003614 | 0.030918 |  0.000227 | -0.000227 |    0.001675 |    0.014241 |</span>
<span class="sd">    | 2000-01-25 00:00:00 | 0.001675    0.014241 |       -0.012566 |         -0.000175 |      -0.000175 |     0.0 |     0.0 | 0.003075 | 0.026006 |  0.000175 | -0.000175 |    0.001424 |    0.011979 |</span>
<span class="sd">    | 2000-01-26 00:00:00 | 0.001424    0.011979 |       -0.010555 |         -0.000134 |      -0.000134 |     0.0 |     0.0 | 0.002613 | 0.021876 |  0.000134 | -0.000134 |     0.00121 |    0.010077 |</span>
<span class="sd">    | 2000-01-27 00:00:00 |  0.00121    0.010077 |       -0.008867 |         -0.000104 |      -0.000104 |     0.0 |     0.0 | 0.002219 | 0.018404 |  0.000104 | -0.000104 |    0.001027 |    0.008478 |</span>
<span class="sd">    | 2000-01-28 00:00:00 | 0.001027    0.008478 |       -0.007451 |          -0.00008 |       -0.00008 |     0.0 |     0.0 | 0.001883 | 0.015484 |   0.00008 |  -0.00008 |    0.000871 |    0.007133 |</span>
<span class="sd">    | 2000-01-29 00:00:00 | 0.000871    0.007133 |       -0.006262 |         -0.000061 |      -0.000061 |     0.0 |     0.0 | 0.001597 | 0.013029 |  0.000061 | -0.000061 |    0.000738 |    0.006002 |</span>
<span class="sd">    | 2000-01-30 00:00:00 | 0.000738    0.006002 |       -0.005264 |         -0.000047 |      -0.000047 |     0.0 |     0.0 | 0.001353 | 0.010963 |  0.000047 | -0.000047 |    0.000626 |    0.005051 |</span>
<span class="sd">    | 2000-01-31 00:00:00 | 0.000626    0.005051 |       -0.004425 |         -0.000037 |      -0.000037 |     0.0 |     0.0 | 0.001146 | 0.009226 |  0.000037 | -0.000037 |     0.00053 |    0.004251 |</span>

<span class="sd">.. _exch_v001_crest_height:</span>

<span class="sd">crest height</span>
<span class="sd">____________</span>

<span class="sd">In this example, we increase the crest&#39;s width and, more importantly, set its height to</span>
<span class="sd">0.5 m, matching a water volume of 0.5 million m³:</span>

<span class="sd">&gt;&gt;&gt; crestwidth(20.0)</span>
<span class="sd">&gt;&gt;&gt; crestheight(0.5)</span>

<span class="sd">The crest height now influences the lakes&#39; interaction significantly.  For</span>
<span class="sd">clarification, we disallow both lakes to release any water:</span>

<span class="sd">&gt;&gt;&gt; for model_ in (lake1.model, lake2.model):</span>
<span class="sd">...     model_.parameters.control.waterlevel2flooddischarge(</span>
<span class="sd">...         PPoly.from_data(xs=[0.0], ys=[0.0]))</span>


<span class="sd">Due to the identical parameter values of both models and the symmetrical initial</span>
<span class="sd">conditions of 0.0 and 1.0 million m³, both water levels move towards the defined crest</span>
<span class="sd">height asymptotically:</span>

<span class="sd">.. integration-test::</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;exch_v001_crest_height&quot;)</span>
<span class="sd">    |                date |           waterlevel | deltawaterlevel | potentialexchange | actualexchange | inflow1 | inflow2 | outflow1 | outflow2 | overflow1 | overflow2 | waterlevel1 | waterlevel2 |</span>
<span class="sd">    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span>
<span class="sd">    | 2000-01-01 00:00:00 |      0.0         1.0 |            -0.5 |         -4.384062 |      -4.384062 |     0.0 |     0.0 |      0.0 |      0.0 |  4.384062 | -4.384062 |    0.378783 |    0.621217 |</span>
<span class="sd">    | 2000-01-02 00:00:00 | 0.378783    0.621217 |       -0.121217 |          -0.52332 |       -0.52332 |     0.0 |     0.0 |      0.0 |      0.0 |   0.52332 |  -0.52332 |    0.423998 |    0.576002 |</span>
<span class="sd">    | 2000-01-03 00:00:00 | 0.423998    0.576002 |       -0.076002 |         -0.259813 |      -0.259813 |     0.0 |     0.0 |      0.0 |      0.0 |  0.259813 | -0.259813 |    0.446446 |    0.553554 |</span>
<span class="sd">    | 2000-01-04 00:00:00 | 0.446446    0.553554 |       -0.053554 |         -0.153679 |      -0.153679 |     0.0 |     0.0 |      0.0 |      0.0 |  0.153679 | -0.153679 |    0.459723 |    0.540277 |</span>
<span class="sd">    | 2000-01-05 00:00:00 | 0.459723    0.540277 |       -0.040277 |          -0.10023 |       -0.10023 |     0.0 |     0.0 |      0.0 |      0.0 |   0.10023 |  -0.10023 |    0.468383 |    0.531617 |</span>
<span class="sd">    | 2000-01-06 00:00:00 | 0.468383    0.531617 |       -0.031617 |          -0.06971 |       -0.06971 |     0.0 |     0.0 |      0.0 |      0.0 |   0.06971 |  -0.06971 |    0.474406 |    0.525594 |</span>
<span class="sd">    | 2000-01-07 00:00:00 | 0.474406    0.525594 |       -0.025594 |         -0.050772 |      -0.050772 |     0.0 |     0.0 |      0.0 |      0.0 |  0.050772 | -0.050772 |    0.478793 |    0.521207 |</span>
<span class="sd">    | 2000-01-08 00:00:00 | 0.478793    0.521207 |       -0.021207 |         -0.038295 |      -0.038295 |     0.0 |     0.0 |      0.0 |      0.0 |  0.038295 | -0.038295 |    0.482102 |    0.517898 |</span>
<span class="sd">    | 2000-01-09 00:00:00 | 0.482102    0.517898 |       -0.017898 |         -0.029692 |      -0.029692 |     0.0 |     0.0 |      0.0 |      0.0 |  0.029692 | -0.029692 |    0.484667 |    0.515333 |</span>
<span class="sd">    | 2000-01-10 00:00:00 | 0.484667    0.515333 |       -0.015333 |         -0.023543 |      -0.023543 |     0.0 |     0.0 |      0.0 |      0.0 |  0.023543 | -0.023543 |    0.486701 |    0.513299 |</span>
<span class="sd">    | 2000-01-11 00:00:00 | 0.486701    0.513299 |       -0.013299 |         -0.019017 |      -0.019017 |     0.0 |     0.0 |      0.0 |      0.0 |  0.019017 | -0.019017 |    0.488344 |    0.511656 |</span>
<span class="sd">    | 2000-01-12 00:00:00 | 0.488344    0.511656 |       -0.011656 |         -0.015604 |      -0.015604 |     0.0 |     0.0 |      0.0 |      0.0 |  0.015604 | -0.015604 |    0.489692 |    0.510308 |</span>
<span class="sd">    | 2000-01-13 00:00:00 | 0.489692    0.510308 |       -0.010308 |         -0.012976 |      -0.012976 |     0.0 |     0.0 |      0.0 |      0.0 |  0.012976 | -0.012976 |    0.490814 |    0.509186 |</span>
<span class="sd">    | 2000-01-14 00:00:00 | 0.490814    0.509186 |       -0.009186 |         -0.010918 |      -0.010918 |     0.0 |     0.0 |      0.0 |      0.0 |  0.010918 | -0.010918 |    0.491757 |    0.508243 |</span>
<span class="sd">    | 2000-01-15 00:00:00 | 0.491757    0.508243 |       -0.008243 |          -0.00928 |       -0.00928 |     0.0 |     0.0 |      0.0 |      0.0 |   0.00928 |  -0.00928 |    0.492559 |    0.507441 |</span>
<span class="sd">    | 2000-01-16 00:00:00 | 0.492559    0.507441 |       -0.007441 |          -0.00796 |       -0.00796 |     0.0 |     0.0 |      0.0 |      0.0 |   0.00796 |  -0.00796 |    0.493246 |    0.506754 |</span>
<span class="sd">    | 2000-01-17 00:00:00 | 0.493246    0.506754 |       -0.006754 |         -0.006882 |      -0.006882 |     0.0 |     0.0 |      0.0 |      0.0 |  0.006882 | -0.006882 |    0.493841 |    0.506159 |</span>
<span class="sd">    | 2000-01-18 00:00:00 | 0.493841    0.506159 |       -0.006159 |         -0.005994 |      -0.005994 |     0.0 |     0.0 |      0.0 |      0.0 |  0.005994 | -0.005994 |    0.494359 |    0.505641 |</span>
<span class="sd">    | 2000-01-19 00:00:00 | 0.494359    0.505641 |       -0.005641 |         -0.005254 |      -0.005254 |     0.0 |     0.0 |      0.0 |      0.0 |  0.005254 | -0.005254 |    0.494813 |    0.505187 |</span>
<span class="sd">    | 2000-01-20 00:00:00 | 0.494813    0.505187 |       -0.005187 |         -0.004633 |      -0.004633 |     0.0 |     0.0 |      0.0 |      0.0 |  0.004633 | -0.004633 |    0.495213 |    0.504787 |</span>
<span class="sd">    | 2000-01-21 00:00:00 | 0.495213    0.504787 |       -0.004787 |         -0.004107 |      -0.004107 |     0.0 |     0.0 |      0.0 |      0.0 |  0.004107 | -0.004107 |    0.495568 |    0.504432 |</span>
<span class="sd">    | 2000-01-22 00:00:00 | 0.495568    0.504432 |       -0.004432 |         -0.003659 |      -0.003659 |     0.0 |     0.0 |      0.0 |      0.0 |  0.003659 | -0.003659 |    0.495884 |    0.504116 |</span>
<span class="sd">    | 2000-01-23 00:00:00 | 0.495884    0.504116 |       -0.004116 |         -0.003274 |      -0.003274 |     0.0 |     0.0 |      0.0 |      0.0 |  0.003274 | -0.003274 |    0.496167 |    0.503833 |</span>
<span class="sd">    | 2000-01-24 00:00:00 | 0.496167    0.503833 |       -0.003833 |         -0.002943 |      -0.002943 |     0.0 |     0.0 |      0.0 |      0.0 |  0.002943 | -0.002943 |    0.496421 |    0.503579 |</span>
<span class="sd">    | 2000-01-25 00:00:00 | 0.496421    0.503579 |       -0.003579 |         -0.002655 |      -0.002655 |     0.0 |     0.0 |      0.0 |      0.0 |  0.002655 | -0.002655 |    0.496651 |    0.503349 |</span>
<span class="sd">    | 2000-01-26 00:00:00 | 0.496651    0.503349 |       -0.003349 |         -0.002404 |      -0.002404 |     0.0 |     0.0 |      0.0 |      0.0 |  0.002404 | -0.002404 |    0.496858 |    0.503142 |</span>
<span class="sd">    | 2000-01-27 00:00:00 | 0.496858    0.503142 |       -0.003142 |         -0.002184 |      -0.002184 |     0.0 |     0.0 |      0.0 |      0.0 |  0.002184 | -0.002184 |    0.497047 |    0.502953 |</span>
<span class="sd">    | 2000-01-28 00:00:00 | 0.497047    0.502953 |       -0.002953 |          -0.00199 |       -0.00199 |     0.0 |     0.0 |      0.0 |      0.0 |   0.00199 |  -0.00199 |    0.497219 |    0.502781 |</span>
<span class="sd">    | 2000-01-29 00:00:00 | 0.497219    0.502781 |       -0.002781 |         -0.001819 |      -0.001819 |     0.0 |     0.0 |      0.0 |      0.0 |  0.001819 | -0.001819 |    0.497376 |    0.502624 |</span>
<span class="sd">    | 2000-01-30 00:00:00 | 0.497376    0.502624 |       -0.002624 |         -0.001667 |      -0.001667 |     0.0 |     0.0 |      0.0 |      0.0 |  0.001667 | -0.001667 |     0.49752 |     0.50248 |</span>
<span class="sd">    | 2000-01-31 00:00:00 |  0.49752     0.50248 |        -0.00248 |         -0.001531 |      -0.001531 |     0.0 |     0.0 |      0.0 |      0.0 |  0.001531 | -0.001531 |    0.497652 |    0.502348 |</span>

<span class="sd">.. _exch_v001_numerical_accuracy:</span>

<span class="sd">numerical accuracy</span>
<span class="sd">__________________</span>

<span class="sd">|exch_v001| is a very flexible tool but requires the user to apply it wisely.  One</span>
<span class="sd">crucial aspect is numerical accuracy.  One can expect sufficiently accurate results</span>
<span class="sd">only if the simulation step size is relatively short compared to water level dynamics.</span>
<span class="sd">In this example, we illustrate what happens if there is too much exchange due to a</span>
<span class="sd">large crest width:</span>

<span class="sd">&gt;&gt;&gt; crestwidth(200.0)</span>

<span class="sd">We see substantial numerical oscillations in the results.  Due to the stiffness of the</span>
<span class="sd">underlying system of differential equations, a further increase of the crest width</span>
<span class="sd">would even result in a numerical overflow error that might be hard to trace back in a</span>
<span class="sd">real-world application:</span>

<span class="sd">.. integration-test::</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;exch_v001_numerical_accuracy&quot;)</span>
<span class="sd">    |                date |           waterlevel | deltawaterlevel | potentialexchange | actualexchange | inflow1 | inflow2 | outflow1 | outflow2 | overflow1 | overflow2 | waterlevel1 | waterlevel2 |</span>
<span class="sd">    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span>
<span class="sd">    | 2000-01-01 00:00:00 |      0.0         1.0 |            -0.5 |         -43.84062 |           -5.0 |     0.0 |     0.0 |      0.0 |      0.0 |       5.0 |      -5.0 |       0.432 |       0.568 |</span>
<span class="sd">    | 2000-01-02 00:00:00 |    0.432       0.568 |          -0.068 |         -2.198797 |      -2.198797 |     0.0 |     0.0 |      0.0 |      0.0 |  2.198797 | -2.198797 |    0.621976 |    0.378024 |</span>
<span class="sd">    | 2000-01-03 00:00:00 | 0.621976    0.378024 |        0.121976 |          5.282426 |            5.0 |     0.0 |     0.0 |      0.0 |      0.0 |      -5.0 |       5.0 |    0.189976 |    0.810024 |</span>
<span class="sd">    | 2000-01-04 00:00:00 | 0.189976    0.810024 |       -0.310024 |        -21.404969 |           -5.0 |     0.0 |     0.0 |      0.0 |      0.0 |       5.0 |      -5.0 |    0.621976 |    0.378024 |</span>
<span class="sd">    | 2000-01-05 00:00:00 | 0.621976    0.378024 |        0.121976 |          5.282426 |            5.0 |     0.0 |     0.0 |      0.0 |      0.0 |      -5.0 |       5.0 |    0.189976 |    0.810024 |</span>
<span class="sd">    | 2000-01-06 00:00:00 | 0.189976    0.810024 |       -0.310024 |        -21.404969 |           -5.0 |     0.0 |     0.0 |      0.0 |      0.0 |       5.0 |      -5.0 |    0.621976 |    0.378024 |</span>
<span class="sd">    | 2000-01-07 00:00:00 | 0.621976    0.378024 |        0.121976 |          5.282426 |            5.0 |     0.0 |     0.0 |      0.0 |      0.0 |      -5.0 |       5.0 |    0.189976 |    0.810024 |</span>
<span class="sd">    | 2000-01-08 00:00:00 | 0.189976    0.810024 |       -0.310024 |        -21.404969 |           -5.0 |     0.0 |     0.0 |      0.0 |      0.0 |       5.0 |      -5.0 |    0.621976 |    0.378024 |</span>
<span class="sd">    | 2000-01-09 00:00:00 | 0.621976    0.378024 |        0.121976 |          5.282426 |            5.0 |     0.0 |     0.0 |      0.0 |      0.0 |      -5.0 |       5.0 |    0.189976 |    0.810024 |</span>
<span class="sd">    | 2000-01-10 00:00:00 | 0.189976    0.810024 |       -0.310024 |        -21.404969 |           -5.0 |     0.0 |     0.0 |      0.0 |      0.0 |       5.0 |      -5.0 |    0.621976 |    0.378024 |</span>
<span class="sd">    | 2000-01-11 00:00:00 | 0.621976    0.378024 |        0.121976 |          5.282426 |            5.0 |     0.0 |     0.0 |      0.0 |      0.0 |      -5.0 |       5.0 |    0.189976 |    0.810024 |</span>
<span class="sd">    | 2000-01-12 00:00:00 | 0.189976    0.810024 |       -0.310024 |        -21.404969 |           -5.0 |     0.0 |     0.0 |      0.0 |      0.0 |       5.0 |      -5.0 |    0.621976 |    0.378024 |</span>
<span class="sd">    | 2000-01-13 00:00:00 | 0.621976    0.378024 |        0.121976 |          5.282426 |            5.0 |     0.0 |     0.0 |      0.0 |      0.0 |      -5.0 |       5.0 |    0.189976 |    0.810024 |</span>
<span class="sd">    | 2000-01-14 00:00:00 | 0.189976    0.810024 |       -0.310024 |        -21.404969 |           -5.0 |     0.0 |     0.0 |      0.0 |      0.0 |       5.0 |      -5.0 |    0.621976 |    0.378024 |</span>
<span class="sd">    | 2000-01-15 00:00:00 | 0.621976    0.378024 |        0.121976 |          5.282426 |            5.0 |     0.0 |     0.0 |      0.0 |      0.0 |      -5.0 |       5.0 |    0.189976 |    0.810024 |</span>
<span class="sd">    | 2000-01-16 00:00:00 | 0.189976    0.810024 |       -0.310024 |        -21.404969 |           -5.0 |     0.0 |     0.0 |      0.0 |      0.0 |       5.0 |      -5.0 |    0.621976 |    0.378024 |</span>
<span class="sd">    | 2000-01-17 00:00:00 | 0.621976    0.378024 |        0.121976 |          5.282426 |            5.0 |     0.0 |     0.0 |      0.0 |      0.0 |      -5.0 |       5.0 |    0.189976 |    0.810024 |</span>
<span class="sd">    | 2000-01-18 00:00:00 | 0.189976    0.810024 |       -0.310024 |        -21.404969 |           -5.0 |     0.0 |     0.0 |      0.0 |      0.0 |       5.0 |      -5.0 |    0.621976 |    0.378024 |</span>
<span class="sd">    | 2000-01-19 00:00:00 | 0.621976    0.378024 |        0.121976 |          5.282426 |            5.0 |     0.0 |     0.0 |      0.0 |      0.0 |      -5.0 |       5.0 |    0.189976 |    0.810024 |</span>
<span class="sd">    | 2000-01-20 00:00:00 | 0.189976    0.810024 |       -0.310024 |        -21.404969 |           -5.0 |     0.0 |     0.0 |      0.0 |      0.0 |       5.0 |      -5.0 |    0.621976 |    0.378024 |</span>
<span class="sd">    | 2000-01-21 00:00:00 | 0.621976    0.378024 |        0.121976 |          5.282426 |            5.0 |     0.0 |     0.0 |      0.0 |      0.0 |      -5.0 |       5.0 |    0.189976 |    0.810024 |</span>
<span class="sd">    | 2000-01-22 00:00:00 | 0.189976    0.810024 |       -0.310024 |        -21.404969 |           -5.0 |     0.0 |     0.0 |      0.0 |      0.0 |       5.0 |      -5.0 |    0.621976 |    0.378024 |</span>
<span class="sd">    | 2000-01-23 00:00:00 | 0.621976    0.378024 |        0.121976 |          5.282426 |            5.0 |     0.0 |     0.0 |      0.0 |      0.0 |      -5.0 |       5.0 |    0.189976 |    0.810024 |</span>
<span class="sd">    | 2000-01-24 00:00:00 | 0.189976    0.810024 |       -0.310024 |        -21.404969 |           -5.0 |     0.0 |     0.0 |      0.0 |      0.0 |       5.0 |      -5.0 |    0.621976 |    0.378024 |</span>
<span class="sd">    | 2000-01-25 00:00:00 | 0.621976    0.378024 |        0.121976 |          5.282426 |            5.0 |     0.0 |     0.0 |      0.0 |      0.0 |      -5.0 |       5.0 |    0.189976 |    0.810024 |</span>
<span class="sd">    | 2000-01-26 00:00:00 | 0.189976    0.810024 |       -0.310024 |        -21.404969 |           -5.0 |     0.0 |     0.0 |      0.0 |      0.0 |       5.0 |      -5.0 |    0.621976 |    0.378024 |</span>
<span class="sd">    | 2000-01-27 00:00:00 | 0.621976    0.378024 |        0.121976 |          5.282426 |            5.0 |     0.0 |     0.0 |      0.0 |      0.0 |      -5.0 |       5.0 |    0.189976 |    0.810024 |</span>
<span class="sd">    | 2000-01-28 00:00:00 | 0.189976    0.810024 |       -0.310024 |        -21.404969 |           -5.0 |     0.0 |     0.0 |      0.0 |      0.0 |       5.0 |      -5.0 |    0.621976 |    0.378024 |</span>
<span class="sd">    | 2000-01-29 00:00:00 | 0.621976    0.378024 |        0.121976 |          5.282426 |            5.0 |     0.0 |     0.0 |      0.0 |      0.0 |      -5.0 |       5.0 |    0.189976 |    0.810024 |</span>
<span class="sd">    | 2000-01-30 00:00:00 | 0.189976    0.810024 |       -0.310024 |        -21.404969 |           -5.0 |     0.0 |     0.0 |      0.0 |      0.0 |       5.0 |      -5.0 |    0.621976 |    0.378024 |</span>
<span class="sd">    | 2000-01-31 00:00:00 | 0.621976    0.378024 |        0.121976 |          5.282426 |            5.0 |     0.0 |     0.0 |      0.0 |      0.0 |      -5.0 |       5.0 |    0.189976 |    0.810024 |</span>

<span class="sd">.. _exch_v001_allowed_exchange:</span>

<span class="sd">allowed exchange</span>
<span class="sd">________________</span>

<span class="sd">Sometimes there might be hydrological reasons to limit the water exchange.  Still, here</span>
<span class="sd">we use the related parameter |AllowedExchange| only as a stop-gap for stabilising</span>
<span class="sd">simulation results affected by numerical instability by setting its value to 2.0 m³/s:</span>

<span class="sd">&gt;&gt;&gt; allowedexchange(2.0)</span>

<span class="sd">The results are far from perfect (the initial water levels change too slowly and still</span>
<span class="sd">oscillate for a few days) but are at least stable and not overly wrong:</span>

<span class="sd">.. integration-test::</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;exch_v001_allowed_exchange&quot;)</span>
<span class="sd">    |                date |           waterlevel | deltawaterlevel | potentialexchange | actualexchange | inflow1 | inflow2 | outflow1 | outflow2 | overflow1 | overflow2 | waterlevel1 | waterlevel2 |</span>
<span class="sd">    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span>
<span class="sd">    | 2000-01-01 00:00:00 |      0.0         1.0 |            -0.5 |         -43.84062 |           -2.0 |     0.0 |     0.0 |      0.0 |      0.0 |       2.0 |      -2.0 |      0.1728 |      0.8272 |</span>
<span class="sd">    | 2000-01-02 00:00:00 |   0.1728      0.8272 |         -0.3272 |        -23.208209 |           -2.0 |     0.0 |     0.0 |      0.0 |      0.0 |       2.0 |      -2.0 |      0.3456 |      0.6544 |</span>
<span class="sd">    | 2000-01-03 00:00:00 |   0.3456      0.6544 |         -0.1544 |         -7.523027 |           -2.0 |     0.0 |     0.0 |      0.0 |      0.0 |       2.0 |      -2.0 |      0.5184 |      0.4816 |</span>
<span class="sd">    | 2000-01-04 00:00:00 |   0.5184      0.4816 |          0.0184 |          0.309491 |       0.309491 |     0.0 |     0.0 |      0.0 |      0.0 | -0.309491 |  0.309491 |     0.49166 |     0.50834 |</span>
<span class="sd">    | 2000-01-05 00:00:00 |  0.49166     0.50834 |        -0.00834 |         -0.094444 |      -0.094444 |     0.0 |     0.0 |      0.0 |      0.0 |  0.094444 | -0.094444 |     0.49982 |     0.50018 |</span>
<span class="sd">    | 2000-01-06 00:00:00 |  0.49982     0.50018 |        -0.00018 |           -0.0003 |        -0.0003 |     0.0 |     0.0 |      0.0 |      0.0 |    0.0003 |   -0.0003 |    0.499846 |    0.500154 |</span>
<span class="sd">    | 2000-01-07 00:00:00 | 0.499846    0.500154 |       -0.000154 |         -0.000237 |      -0.000237 |     0.0 |     0.0 |      0.0 |      0.0 |  0.000237 | -0.000237 |    0.499866 |    0.500134 |</span>
<span class="sd">    | 2000-01-08 00:00:00 | 0.499866    0.500134 |       -0.000134 |         -0.000192 |      -0.000192 |     0.0 |     0.0 |      0.0 |      0.0 |  0.000192 | -0.000192 |    0.499883 |    0.500117 |</span>
<span class="sd">    | 2000-01-09 00:00:00 | 0.499883    0.500117 |       -0.000117 |         -0.000157 |      -0.000157 |     0.0 |     0.0 |      0.0 |      0.0 |  0.000157 | -0.000157 |    0.499896 |    0.500104 |</span>
<span class="sd">    | 2000-01-10 00:00:00 | 0.499896    0.500104 |       -0.000104 |         -0.000131 |      -0.000131 |     0.0 |     0.0 |      0.0 |      0.0 |  0.000131 | -0.000131 |    0.499908 |    0.500092 |</span>
<span class="sd">    | 2000-01-11 00:00:00 | 0.499908    0.500092 |       -0.000092 |          -0.00011 |       -0.00011 |     0.0 |     0.0 |      0.0 |      0.0 |   0.00011 |  -0.00011 |    0.499917 |    0.500083 |</span>
<span class="sd">    | 2000-01-12 00:00:00 | 0.499917    0.500083 |       -0.000083 |         -0.000093 |      -0.000093 |     0.0 |     0.0 |      0.0 |      0.0 |  0.000093 | -0.000093 |    0.499925 |    0.500075 |</span>
<span class="sd">    | 2000-01-13 00:00:00 | 0.499925    0.500075 |       -0.000075 |          -0.00008 |       -0.00008 |     0.0 |     0.0 |      0.0 |      0.0 |   0.00008 |  -0.00008 |    0.499932 |    0.500068 |</span>
<span class="sd">    | 2000-01-14 00:00:00 | 0.499932    0.500068 |       -0.000068 |         -0.000069 |      -0.000069 |     0.0 |     0.0 |      0.0 |      0.0 |  0.000069 | -0.000069 |    0.499938 |    0.500062 |</span>
<span class="sd">    | 2000-01-15 00:00:00 | 0.499938    0.500062 |       -0.000062 |          -0.00006 |       -0.00006 |     0.0 |     0.0 |      0.0 |      0.0 |   0.00006 |  -0.00006 |    0.499943 |    0.500057 |</span>
<span class="sd">    | 2000-01-16 00:00:00 | 0.499943    0.500057 |       -0.000057 |         -0.000053 |      -0.000053 |     0.0 |     0.0 |      0.0 |      0.0 |  0.000053 | -0.000053 |    0.499948 |    0.500052 |</span>
<span class="sd">    | 2000-01-17 00:00:00 | 0.499948    0.500052 |       -0.000052 |         -0.000047 |      -0.000047 |     0.0 |     0.0 |      0.0 |      0.0 |  0.000047 | -0.000047 |    0.499952 |    0.500048 |</span>
<span class="sd">    | 2000-01-18 00:00:00 | 0.499952    0.500048 |       -0.000048 |         -0.000041 |      -0.000041 |     0.0 |     0.0 |      0.0 |      0.0 |  0.000041 | -0.000041 |    0.499956 |    0.500044 |</span>
<span class="sd">    | 2000-01-19 00:00:00 | 0.499956    0.500044 |       -0.000044 |         -0.000037 |      -0.000037 |     0.0 |     0.0 |      0.0 |      0.0 |  0.000037 | -0.000037 |    0.499959 |    0.500041 |</span>
<span class="sd">    | 2000-01-20 00:00:00 | 0.499959    0.500041 |       -0.000041 |         -0.000033 |      -0.000033 |     0.0 |     0.0 |      0.0 |      0.0 |  0.000033 | -0.000033 |    0.499962 |    0.500038 |</span>
<span class="sd">    | 2000-01-21 00:00:00 | 0.499962    0.500038 |       -0.000038 |          -0.00003 |       -0.00003 |     0.0 |     0.0 |      0.0 |      0.0 |   0.00003 |  -0.00003 |    0.499964 |    0.500036 |</span>
<span class="sd">    | 2000-01-22 00:00:00 | 0.499964    0.500036 |       -0.000036 |         -0.000027 |      -0.000027 |     0.0 |     0.0 |      0.0 |      0.0 |  0.000027 | -0.000027 |    0.499966 |    0.500034 |</span>
<span class="sd">    | 2000-01-23 00:00:00 | 0.499966    0.500034 |       -0.000034 |         -0.000024 |      -0.000024 |     0.0 |     0.0 |      0.0 |      0.0 |  0.000024 | -0.000024 |    0.499969 |    0.500031 |</span>
<span class="sd">    | 2000-01-24 00:00:00 | 0.499969    0.500031 |       -0.000031 |         -0.000022 |      -0.000022 |     0.0 |     0.0 |      0.0 |      0.0 |  0.000022 | -0.000022 |     0.49997 |     0.50003 |</span>
<span class="sd">    | 2000-01-25 00:00:00 |  0.49997     0.50003 |        -0.00003 |          -0.00002 |       -0.00002 |     0.0 |     0.0 |      0.0 |      0.0 |   0.00002 |  -0.00002 |    0.499972 |    0.500028 |</span>
<span class="sd">    | 2000-01-26 00:00:00 | 0.499972    0.500028 |       -0.000028 |         -0.000018 |      -0.000018 |     0.0 |     0.0 |      0.0 |      0.0 |  0.000018 | -0.000018 |    0.499974 |    0.500026 |</span>
<span class="sd">    | 2000-01-27 00:00:00 | 0.499974    0.500026 |       -0.000026 |         -0.000017 |      -0.000017 |     0.0 |     0.0 |      0.0 |      0.0 |  0.000017 | -0.000017 |    0.499975 |    0.500025 |</span>
<span class="sd">    | 2000-01-28 00:00:00 | 0.499975    0.500025 |       -0.000025 |         -0.000015 |      -0.000015 |     0.0 |     0.0 |      0.0 |      0.0 |  0.000015 | -0.000015 |    0.499976 |    0.500024 |</span>
<span class="sd">    | 2000-01-29 00:00:00 | 0.499976    0.500024 |       -0.000024 |         -0.000014 |      -0.000014 |     0.0 |     0.0 |      0.0 |      0.0 |  0.000014 | -0.000014 |    0.499978 |    0.500022 |</span>
<span class="sd">    | 2000-01-30 00:00:00 | 0.499978    0.500022 |       -0.000022 |         -0.000013 |      -0.000013 |     0.0 |     0.0 |      0.0 |      0.0 |  0.000013 | -0.000013 |    0.499979 |    0.500021 |</span>
<span class="sd">    | 2000-01-31 00:00:00 | 0.499979    0.500021 |       -0.000021 |         -0.000012 |      -0.000012 |     0.0 |     0.0 |      0.0 |      0.0 |  0.000012 | -0.000012 |     0.49998 |     0.50002 |</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1"># import...</span>

<span class="c1"># ...from HydPy</span>
<span class="kn">from</span> <span class="nn">hydpy.exe.modelimports</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="kn">import</span> <span class="n">modeltools</span>
<span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="kn">import</span> <span class="n">objecttools</span>
<span class="kn">from</span> <span class="nn">hydpy.models.exch</span> <span class="kn">import</span> <span class="n">exch_model</span>


<div class="viewcode-block" id="Model">
<a class="viewcode-back" href="../../../exch_v001.html#hydpy.models.exch_v001.Model">[docs]</a>
<span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">AdHocModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Version 1 of the `HydPy-Exch`.</span>

<span class="sd">    Before continuing, please first read the general documentation on application model</span>
<span class="sd">    |exch_v001|.</span>

<span class="sd">    To work correctly, each |exch_v001| must know which water level node and which</span>
<span class="sd">    overflow node belong to the same lake model.  The following examples might provide</span>
<span class="sd">    insight into how we deal with this issue but are merely there for testing that we</span>
<span class="sd">    handle all expected cases well.</span>

<span class="sd">    We recreate the configuration of the |Node| and |Element| objects of the main</span>
<span class="sd">    documentation, neglecting the lakes&#39; inflow and outflow nodes, which are not</span>
<span class="sd">    relevant for connecting |exch_v001|:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy.models.exch_v001 import *</span>
<span class="sd">    &gt;&gt;&gt; parameterstep()</span>
<span class="sd">    &gt;&gt;&gt; from hydpy import Element, FusedVariable, Node, Nodes</span>
<span class="sd">    &gt;&gt;&gt; from hydpy.outputs import dam_WaterLevel</span>
<span class="sd">    &gt;&gt;&gt; WaterLevel = FusedVariable(&quot;L&quot;, dam_WaterLevel)</span>

<span class="sd">    &gt;&gt;&gt; Element.clear_all()</span>
<span class="sd">    &gt;&gt;&gt; Node.clear_all()</span>

<span class="sd">    &gt;&gt;&gt; overflow1, overflow2 = Nodes(&quot;overflow1&quot;, &quot;overflow2&quot;, defaultvariable=&quot;E&quot;)</span>
<span class="sd">    &gt;&gt;&gt; waterlevel1, waterlevel2 = Nodes(&quot;waterlevel1&quot;, &quot;waterlevel2&quot;, defaultvariable=WaterLevel)</span>
<span class="sd">    &gt;&gt;&gt; lake1 = Element(&quot;lake1&quot;, inlets=overflow1, outputs=waterlevel1)</span>
<span class="sd">    &gt;&gt;&gt; lake2 = Element(&quot;lake2&quot;, inlets=overflow2, outputs=waterlevel2)</span>
<span class="sd">    &gt;&gt;&gt; exchange = Element(&quot;exchange&quot;,</span>
<span class="sd">    ...                    receivers=(waterlevel1, waterlevel2),</span>
<span class="sd">    ...                    outlets=(overflow1, overflow2))</span>
<span class="sd">    &gt;&gt;&gt; exchange.model = model</span>

<span class="sd">    The water levels of `lake1` and `lake2` are available via the first and the second</span>
<span class="sd">    entry of the receiver sequence |exch_receivers.L|, respectively:</span>

<span class="sd">    &gt;&gt;&gt; waterlevel1.sequences.sim = 1.0</span>
<span class="sd">    &gt;&gt;&gt; waterlevel2.sequences.sim = 2.0</span>
<span class="sd">    &gt;&gt;&gt; receivers.l</span>
<span class="sd">    l(1.0, 2.0)</span>

<span class="sd">    Likewise, the first and the second entry of the outlet sequence |exch_outlets.E|</span>
<span class="sd">    are available to the overflow nodes `lake1` and `lake2`, respectively:</span>

<span class="sd">    &gt;&gt;&gt; outlets.e = 3.0, 4.0</span>
<span class="sd">    &gt;&gt;&gt; overflow1.sequences.sim</span>
<span class="sd">    sim(3.0)</span>
<span class="sd">    &gt;&gt;&gt; overflow2.sequences.sim</span>
<span class="sd">    sim(4.0)</span>

<span class="sd">    We recreate this configuration multiple times, each time changing one aspect</span>
<span class="sd">    (marked by exclamation marks).  First, we connect node `waterlevel2` with èlement</span>
<span class="sd">    `lake1` and node `waterlevel1` with element `lake2`:</span>

<span class="sd">    &gt;&gt;&gt; Element.clear_all()</span>
<span class="sd">    &gt;&gt;&gt; Node.clear_all()</span>
<span class="sd">    &gt;&gt;&gt; overflow1, overflow2 = Nodes(&quot;overflow1&quot;, &quot;overflow2&quot;, defaultvariable=&quot;E&quot;)</span>
<span class="sd">    &gt;&gt;&gt; waterlevel1, waterlevel2 = Nodes(&quot;waterlevel1&quot;, &quot;waterlevel2&quot;, defaultvariable=WaterLevel)</span>
<span class="sd">    &gt;&gt;&gt; lake1 = Element(&quot;lake1&quot;, inlets=overflow1, outputs=waterlevel2)  # !!!</span>
<span class="sd">    &gt;&gt;&gt; lake2 = Element(&quot;lake2&quot;, inlets=overflow2, outputs=waterlevel1)  # !!!</span>
<span class="sd">    &gt;&gt;&gt; exchange = Element(&quot;exchange&quot;,</span>
<span class="sd">    ...                    receivers=(waterlevel1, waterlevel2),</span>
<span class="sd">    ...                    outlets=(overflow1, overflow2))</span>
<span class="sd">    &gt;&gt;&gt; exchange.model = model</span>

<span class="sd">    Due to this swap, the first of the outlet sequence |exch_outlets.E| connects to</span>
<span class="sd">    node `overflow2` and the second one to node `overflow1`:</span>

<span class="sd">    &gt;&gt;&gt; waterlevel1.sequences.sim = 1.0</span>
<span class="sd">    &gt;&gt;&gt; waterlevel2.sequences.sim = 2.0</span>
<span class="sd">    &gt;&gt;&gt; receivers.l</span>
<span class="sd">    l(1.0, 2.0)</span>

<span class="sd">    &gt;&gt;&gt; outlets.e = 3.0, 4.0</span>
<span class="sd">    &gt;&gt;&gt; overflow1.sequences.sim</span>
<span class="sd">    sim(4.0)</span>
<span class="sd">    &gt;&gt;&gt; overflow2.sequences.sim</span>
<span class="sd">    sim(3.0)</span>

<span class="sd">    Swapping the nodes `overflow1` and `overflow2` instead of `waterlevel1` and</span>
<span class="sd">    `waterlevel2` leads to the same results (we arbitrarily decided to ground the</span>
<span class="sd">    internal sorting on the alphabetical order of the receiver nodes&#39; names):</span>

<span class="sd">    &gt;&gt;&gt; Element.clear_all()</span>
<span class="sd">    &gt;&gt;&gt; Node.clear_all()</span>
<span class="sd">    &gt;&gt;&gt; overflow1, overflow2 = Nodes(&quot;overflow1&quot;, &quot;overflow2&quot;, defaultvariable=&quot;E&quot;)</span>
<span class="sd">    &gt;&gt;&gt; waterlevel1, waterlevel2 = Nodes(&quot;waterlevel1&quot;, &quot;waterlevel2&quot;, defaultvariable=WaterLevel)</span>
<span class="sd">    &gt;&gt;&gt; lake1 = Element(&quot;lake1&quot;, inlets=overflow2, outputs=waterlevel1)  # !!!</span>
<span class="sd">    &gt;&gt;&gt; lake2 = Element(&quot;lake2&quot;, inlets=overflow1, outputs=waterlevel2)  # !!!</span>
<span class="sd">    &gt;&gt;&gt; exchange = Element(&quot;exchange&quot;,</span>
<span class="sd">    ...                    receivers=(waterlevel1, waterlevel2),</span>
<span class="sd">    ...                    outlets=(overflow1, overflow2))</span>
<span class="sd">    &gt;&gt;&gt; exchange.model = model</span>

<span class="sd">    &gt;&gt;&gt; waterlevel1.sequences.sim = 1.0</span>
<span class="sd">    &gt;&gt;&gt; waterlevel2.sequences.sim = 2.0</span>
<span class="sd">    &gt;&gt;&gt; receivers.l</span>
<span class="sd">    l(1.0, 2.0)</span>

<span class="sd">    &gt;&gt;&gt; outlets.e = 3.0, 4.0</span>
<span class="sd">    &gt;&gt;&gt; overflow1.sequences.sim</span>
<span class="sd">    sim(4.0)</span>
<span class="sd">    &gt;&gt;&gt; overflow2.sequences.sim</span>
<span class="sd">    sim(3.0)</span>

<span class="sd">    Now we (accidentally) connect node `waterlevel2` to both lakes.  Therefore,</span>
<span class="sd">    |exch_v001| cannot find a water level node connected to the same lake model as</span>
<span class="sd">    outlet node `overflow1`:</span>

<span class="sd">    &gt;&gt;&gt; Element.clear_all()</span>
<span class="sd">    &gt;&gt;&gt; Node.clear_all()</span>
<span class="sd">    &gt;&gt;&gt; overflow1, overflow2 = Nodes(&quot;overflow1&quot;, &quot;overflow2&quot;, defaultvariable=&quot;E&quot;)</span>
<span class="sd">    &gt;&gt;&gt; waterlevel1, waterlevel2 = Nodes(&quot;waterlevel1&quot;, &quot;waterlevel2&quot;, defaultvariable=WaterLevel)</span>
<span class="sd">    &gt;&gt;&gt; lake1 = Element(&quot;lake1&quot;, inlets=overflow1, outputs=waterlevel2)  # !!!</span>
<span class="sd">    &gt;&gt;&gt; lake2 = Element(&quot;lake2&quot;, inlets=overflow2, outputs=waterlevel2)</span>
<span class="sd">    &gt;&gt;&gt; exchange = Element(&quot;exchange&quot;,</span>
<span class="sd">    ...                    receivers=(waterlevel1, waterlevel2),</span>
<span class="sd">    ...                    outlets=(overflow1, overflow2))</span>
<span class="sd">    &gt;&gt;&gt; exchange.model = model</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    RuntimeError: While trying to build the node connection of the `outlet` sequences \</span>
<span class="sd">of the model handled by element `exchange`, the following error occurred: Outlet node \</span>
<span class="sd">`overflow1` does not correspond to any available receiver node.</span>

<span class="sd">    |exch_v001| raises the following error if there are not precisely two water level</span>
<span class="sd">    nodes available:</span>

<span class="sd">    &gt;&gt;&gt; Element.clear_all()</span>
<span class="sd">    &gt;&gt;&gt; Node.clear_all()</span>
<span class="sd">    &gt;&gt;&gt; overflow1, overflow2 = Nodes(&quot;overflow1&quot;, &quot;overflow2&quot;, defaultvariable=&quot;E&quot;)</span>
<span class="sd">    &gt;&gt;&gt; waterlevel1, waterlevel2 = Nodes(&quot;waterlevel1&quot;, &quot;waterlevel2&quot;, defaultvariable=WaterLevel)</span>
<span class="sd">    &gt;&gt;&gt; lake1 = Element(&quot;lake1&quot;, inlets=overflow1, outputs=waterlevel1)</span>
<span class="sd">    &gt;&gt;&gt; lake2 = Element(&quot;lake2&quot;, inlets=overflow2, outputs=waterlevel2)</span>
<span class="sd">    &gt;&gt;&gt; exchange = Element(&quot;exchange&quot;,</span>
<span class="sd">    ...                    receivers=waterlevel1,  # !!!</span>
<span class="sd">    ...                    outlets=(overflow1, overflow2))</span>
<span class="sd">    &gt;&gt;&gt; exchange.model = model</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    RuntimeError: While trying to build the node connection of the `receiver` \</span>
<span class="sd">sequences of the model handled by element `exchange`, the following error occurred: \</span>
<span class="sd">There must be exactly 2 outlet receiver but the following `1` receiver nodes are \</span>
<span class="sd">defined: waterlevel1.</span>

<span class="sd">    Correspondingly, |exch_v001| raises the following error if there are not precisely</span>
<span class="sd">    two overflow nodes available:</span>

<span class="sd">    &gt;&gt;&gt; Element.clear_all()</span>
<span class="sd">    &gt;&gt;&gt; Node.clear_all()</span>
<span class="sd">    &gt;&gt;&gt; overflow1, overflow2 = Nodes(&quot;overflow1&quot;, &quot;overflow2&quot;, defaultvariable=&quot;E&quot;)</span>
<span class="sd">    &gt;&gt;&gt; waterlevel1, waterlevel2 = Nodes(&quot;waterlevel1&quot;, &quot;waterlevel2&quot;, defaultvariable=WaterLevel)</span>
<span class="sd">    &gt;&gt;&gt; lake1 = Element(&quot;lake1&quot;, inlets=overflow1, outputs=waterlevel1)</span>
<span class="sd">    &gt;&gt;&gt; lake2 = Element(&quot;lake2&quot;, inlets=overflow2, outputs=waterlevel2)</span>
<span class="sd">    &gt;&gt;&gt; exchange = Element(&quot;exchange&quot;,</span>
<span class="sd">    ...                    receivers=(waterlevel1, waterlevel2),</span>
<span class="sd">    ...                    outlets=(overflow1, overflow2, waterlevel2))  # !!!</span>
<span class="sd">    &gt;&gt;&gt; exchange.model = model</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    RuntimeError: While trying to build the node connection of the `outlet` sequences \</span>
<span class="sd">of the model handled by element `exchange`, the following error occurred: There must \</span>
<span class="sd">be exactly 2 outlet nodes but the following `3` outlet nodes are defined: overflow1, \</span>
<span class="sd">overflow2, and waterlevel2.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">INLET_METHODS</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">RECEIVER_METHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">exch_model</span><span class="o">.</span><span class="n">Pic_LoggedWaterLevel_V1</span><span class="p">,)</span>
    <span class="n">RUN_METHODS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">exch_model</span><span class="o">.</span><span class="n">Update_WaterLevel_V1</span><span class="p">,</span>
        <span class="n">exch_model</span><span class="o">.</span><span class="n">Calc_DeltaWaterLevel_V1</span><span class="p">,</span>
        <span class="n">exch_model</span><span class="o">.</span><span class="n">Calc_PotentialExchange_V1</span><span class="p">,</span>
        <span class="n">exch_model</span><span class="o">.</span><span class="n">Calc_ActualExchange_V1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ADD_METHODS</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">OUTLET_METHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">exch_model</span><span class="o">.</span><span class="n">Pass_ActualExchange_V1</span><span class="p">,)</span>
    <span class="n">SENDER_METHODS</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">SUBMODELS</span> <span class="o">=</span> <span class="p">()</span>

    <span class="k">def</span> <span class="nf">_connect_receivers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span>
        <span class="k">assert</span> <span class="n">element</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">receivers</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">receivers</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">receivers</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;There must be exactly 2 outlet receiver but the following &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">receivers</span><span class="p">)</span><span class="si">}</span><span class="s2">` receiver nodes are defined: &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">enumeration</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">receivers</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_connect_receivers</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_connect_outlets</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span>
        <span class="k">assert</span> <span class="n">element</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">outlets</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">outlets</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">outlets</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;There must be exactly 2 outlet nodes but the following &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">outlets</span><span class="p">)</span><span class="si">}</span><span class="s2">` outlet nodes are defined: &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">enumeration</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">outlets</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>
        <span class="n">idx2outlets</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">outlet</span> <span class="ow">in</span> <span class="n">outlets</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">receiver</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">receivers</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">outlet</span><span class="o">.</span><span class="n">exits</span> <span class="o">==</span> <span class="n">receiver</span><span class="o">.</span><span class="n">entries</span><span class="p">:</span>
                    <span class="n">idx2outlets</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">outlet</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Outlet node `</span><span class="si">{</span><span class="n">outlet</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">` does not correspond to any &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;available receiver node.&quot;</span>
                <span class="p">)</span>
        <span class="n">sequence</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">outlets</span><span class="p">[</span><span class="s2">&quot;e&quot;</span><span class="p">]</span>
        <span class="n">sequence</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">outlet</span> <span class="ow">in</span> <span class="n">idx2outlets</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">sequence</span><span class="o">.</span><span class="n">set_pointer</span><span class="p">(</span><span class="n">outlet</span><span class="o">.</span><span class="n">get_double</span><span class="p">(</span><span class="s2">&quot;outlets&quot;</span><span class="p">),</span> <span class="n">idx</span><span class="p">)</span></div>



<span class="n">tester</span> <span class="o">=</span> <span class="n">Tester</span><span class="p">()</span>
<span class="n">cythonizer</span> <span class="o">=</span> <span class="n">Cythonizer</span><span class="p">()</span>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">HydPy 5.0.3 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">hydpy.models.exch_v001</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2023, HydPy Developers.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    </div>
  </body>
</html>