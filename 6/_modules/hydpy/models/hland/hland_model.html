<!DOCTYPE html>

<html lang="en" data-content_root="../../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>hydpy.models.hland.hland_model &#8212; HydPy 6.2.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/classic.css?v=127cebf3" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/graphviz.css?v=4ae1632d" />
    
    <script src="../../../../_static/documentation_options.js?v=f13f159b"></script>
    <script src="../../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">HydPy 6.2.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">hydpy.models.hland.hland_model</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../../index.html">
              <img class="logo" src="../../../../_static/HydPy_Logo.png" alt="Logo"/>
            </a></p>
  <div>
    <h3><a href="../../../../index.html">Table of Contents</a></h3>
    <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../example_projects.html">Example Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../user_guide.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer_guide.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference_manual.html">Reference Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../zbibliography.html">Bibliography</a></li>
</ul>

  </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for hydpy.models.hland.hland_model</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">.. _`issue 68`: https://github.com/hydpy-dev/hydpy/issues/68</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># imports...</span>
<span class="c1"># ...from site-packages</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span>

<span class="c1"># ...from HydPy</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy</span><span class="w"> </span><span class="kn">import</span> <span class="n">config</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">importtools</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">modeltools</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.cythons</span><span class="w"> </span><span class="kn">import</span> <span class="n">modelutils</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.core.typingtools</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.interfaces</span><span class="w"> </span><span class="kn">import</span> <span class="n">aetinterfaces</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.interfaces</span><span class="w"> </span><span class="kn">import</span> <span class="n">precipinterfaces</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.interfaces</span><span class="w"> </span><span class="kn">import</span> <span class="n">rconcinterfaces</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.interfaces</span><span class="w"> </span><span class="kn">import</span> <span class="n">tempinterfaces</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.interfaces</span><span class="w"> </span><span class="kn">import</span> <span class="n">stateinterfaces</span>

<span class="c1"># ...from hland</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.hland</span><span class="w"> </span><span class="kn">import</span> <span class="n">hland_constants</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.hland.hland_constants</span><span class="w"> </span><span class="kn">import</span> <span class="n">FIELD</span><span class="p">,</span> <span class="n">FOREST</span><span class="p">,</span> <span class="n">GLACIER</span><span class="p">,</span> <span class="n">ILAKE</span><span class="p">,</span> <span class="n">SEALED</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.hland</span><span class="w"> </span><span class="kn">import</span> <span class="n">hland_control</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.hland</span><span class="w"> </span><span class="kn">import</span> <span class="n">hland_derived</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.hland</span><span class="w"> </span><span class="kn">import</span> <span class="n">hland_fixed</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.hland</span><span class="w"> </span><span class="kn">import</span> <span class="n">hland_inputs</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.hland</span><span class="w"> </span><span class="kn">import</span> <span class="n">hland_factors</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.hland</span><span class="w"> </span><span class="kn">import</span> <span class="n">hland_fluxes</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.hland</span><span class="w"> </span><span class="kn">import</span> <span class="n">hland_states</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.hland</span><span class="w"> </span><span class="kn">import</span> <span class="n">hland_aides</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.hland</span><span class="w"> </span><span class="kn">import</span> <span class="n">hland_outlets</span>


<div class="viewcode-block" id="Calc_TC_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_TC_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_TC_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Adjust the measured air temperature to the altitude of the individual zones.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`TC = T + TCorr - TCAlt \cdot (ZoneZ - Z)`</span>

<span class="sd">    Examples:</span>

<span class="sd">        Prepare two zones, the first lying at the reference height and the second 200</span>
<span class="sd">        meters above:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(2)</span>
<span class="sd">        &gt;&gt;&gt; zonez(2.0, 4.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.z(2.0)</span>

<span class="sd">        Applying the usual temperature lapse rate of 0.6°C/100m does not affect the</span>
<span class="sd">        first zone but reduces the temperature of the second zone by 1.2°C:</span>

<span class="sd">        &gt;&gt;&gt; tcorr(1.0)</span>
<span class="sd">        &gt;&gt;&gt; tcalt(0.6)</span>
<span class="sd">        &gt;&gt;&gt; inputs.t = 5.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_tc_v1()</span>
<span class="sd">        &gt;&gt;&gt; factors.tc</span>
<span class="sd">        tc(6.0, 4.8)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">TCorr</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">TCAlt</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneZ</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_derived</span><span class="o">.</span><span class="n">Z</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_inputs</span><span class="o">.</span><span class="n">T</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_factors</span><span class="o">.</span><span class="n">TC</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="n">fac</span><span class="o">.</span><span class="n">tc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">inp</span><span class="o">.</span><span class="n">t</span> <span class="o">+</span> <span class="n">con</span><span class="o">.</span><span class="n">tcorr</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">tcalt</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">zonez</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">der</span><span class="o">.</span><span class="n">z</span><span class="p">)</span></div>



<div class="viewcode-block" id="Calc_FracRain_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_FracRain_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_FracRain_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Determine the temperature-dependent fraction of (liquid) rainfall</span>
<span class="sd">    and (total) precipitation.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`FracRain = \frac{TC-(TT-\frac{TTInt}{2})}{TTInt}`</span>

<span class="sd">    Restriction:</span>
<span class="sd">      :math:`0 \leq FracRain \leq 1`</span>

<span class="sd">    Examples:</span>

<span class="sd">        The threshold temperature of seven zones is 0°C, and the corresponding</span>
<span class="sd">        temperature interval of mixed precipitation 2°C:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(7)</span>
<span class="sd">        &gt;&gt;&gt; tt(0.0)</span>
<span class="sd">        &gt;&gt;&gt; ttint(2.0)</span>

<span class="sd">        The fraction of rainfall is zero below -1°C, is one above 1°C, and increases</span>
<span class="sd">        linearly in between:</span>

<span class="sd">        &gt;&gt;&gt; factors.tc = -10.0, -1.0, -0.5, 0.0, 0.5, 1.0, 10.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_fracrain_v1()</span>
<span class="sd">        &gt;&gt;&gt; factors.fracrain</span>
<span class="sd">        fracrain(0.0, 0.0, 0.25, 0.5, 0.75, 1.0, 1.0)</span>

<span class="sd">        Note the particular case of a zero temperature interval.  With an actual</span>
<span class="sd">        temperature being equal to the threshold temperature, the rainfall fraction</span>
<span class="sd">        is one:</span>

<span class="sd">        &gt;&gt;&gt; ttint(0.0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_fracrain_v1()</span>
<span class="sd">        &gt;&gt;&gt; factors.fracrain</span>
<span class="sd">        fracrain(0.0, 0.0, 0.0, 1.0, 1.0, 1.0, 1.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span> <span class="n">hland_control</span><span class="o">.</span><span class="n">TT</span><span class="p">,</span> <span class="n">hland_control</span><span class="o">.</span><span class="n">TTInt</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_factors</span><span class="o">.</span><span class="n">TC</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_factors</span><span class="o">.</span><span class="n">FracRain</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="n">d_dt</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">ttint</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.0</span>
            <span class="k">if</span> <span class="n">fac</span><span class="o">.</span><span class="n">tc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">tt</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">d_dt</span><span class="p">):</span>
                <span class="n">fac</span><span class="o">.</span><span class="n">fracrain</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="k">elif</span> <span class="n">fac</span><span class="o">.</span><span class="n">tc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">tt</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">d_dt</span><span class="p">):</span>
                <span class="n">fac</span><span class="o">.</span><span class="n">fracrain</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fac</span><span class="o">.</span><span class="n">fracrain</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">fac</span><span class="o">.</span><span class="n">tc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">tt</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">d_dt</span><span class="p">))</span> <span class="o">/</span> <span class="n">con</span><span class="o">.</span><span class="n">ttint</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>



<div class="viewcode-block" id="Calc_RFC_SFC_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_RFC_SFC_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_RFC_SFC_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the corrected fractions of rainfall/snowfall and total precipitation.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      :math:`RfC = RfCF \cdot FracRain`</span>

<span class="sd">      :math:`SfC = SfCF \cdot (1 - FracRain)`</span>

<span class="sd">    Examples:</span>

<span class="sd">        Assume five zones with different temperatures and hence different fractions of</span>
<span class="sd">        rainfall and total precipitation:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(5)</span>
<span class="sd">        &gt;&gt;&gt; factors.fracrain = 0.0, 0.25, 0.5, 0.75, 1.0</span>

<span class="sd">        With no rainfall and no snowfall correction (due to the respective factors</span>
<span class="sd">        being one), the corrected fraction related to rain is identical to the original</span>
<span class="sd">        fraction, while the corrected fraction related to snow behaves the opposite:</span>

<span class="sd">        &gt;&gt;&gt; rfcf(1.0)</span>
<span class="sd">        &gt;&gt;&gt; sfcf(1.0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rfc_sfc_v1()</span>
<span class="sd">        &gt;&gt;&gt; factors.rfc</span>
<span class="sd">        rfc(0.0, 0.25, 0.5, 0.75, 1.0)</span>
<span class="sd">        &gt;&gt;&gt; factors.sfc</span>
<span class="sd">        sfc(1.0, 0.75, 0.5, 0.25, 0.0)</span>

<span class="sd">        With a rainfall reduction of 20% and a snowfall increase of 20 %, the corrected</span>
<span class="sd">        fractions are as follows:</span>

<span class="sd">        &gt;&gt;&gt; rfcf(0.8)</span>
<span class="sd">        &gt;&gt;&gt; sfcf(1.2)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rfc_sfc_v1()</span>
<span class="sd">        &gt;&gt;&gt; factors.rfc</span>
<span class="sd">        rfc(0.0, 0.2, 0.4, 0.6, 0.8)</span>
<span class="sd">        &gt;&gt;&gt; factors.sfc</span>
<span class="sd">        sfc(1.2, 0.9, 0.6, 0.3, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span> <span class="n">hland_control</span><span class="o">.</span><span class="n">RfCF</span><span class="p">,</span> <span class="n">hland_control</span><span class="o">.</span><span class="n">SfCF</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_factors</span><span class="o">.</span><span class="n">FracRain</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_factors</span><span class="o">.</span><span class="n">RfC</span><span class="p">,</span> <span class="n">hland_factors</span><span class="o">.</span><span class="n">SfC</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="n">fac</span><span class="o">.</span><span class="n">rfc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">fac</span><span class="o">.</span><span class="n">fracrain</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">rfcf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">fac</span><span class="o">.</span><span class="n">sfc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">fac</span><span class="o">.</span><span class="n">fracrain</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">sfcf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>



<div class="viewcode-block" id="Calc_PC_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_PC_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_PC_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Apply the precipitation correction factors and adjust precipitation to the</span>
<span class="sd">    altitude of the individual zones.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`PC = P \cdot PCorr \cdot (1 + PCAlt \cdot (ZoneZ - Z)) \cdot (RfC + SfC)`</span>

<span class="sd">    Examples:</span>

<span class="sd">        Five zones are at an elevation of 200 m.  A precipitation value of 5 mm has</span>
<span class="sd">        been measured at a gauge at an elevation of 300 m:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(5)</span>
<span class="sd">        &gt;&gt;&gt; zonez(3.0)</span>
<span class="sd">        &gt;&gt;&gt; inputs.p = 5.0</span>
<span class="sd">        &gt;&gt;&gt; derived.z(2.0)</span>

<span class="sd">        The first four zones illustrate the individual precipitation corrections due to</span>
<span class="sd">        the general (|PCorr|, first zone), the altitude (|PCAlt|, second zone), the</span>
<span class="sd">        rainfall (|RfC|, third zone), and the snowfall adjustment (|SfC|, fourth zone).</span>
<span class="sd">        The fifth zone illustrates the interaction between all corrections:</span>

<span class="sd">        &gt;&gt;&gt; pcorr(1.3, 1.0, 1.0, 1.0, 1.3)</span>
<span class="sd">        &gt;&gt;&gt; pcalt(0.0, 0.1, 0.0, 0.0, 0.1)</span>
<span class="sd">        &gt;&gt;&gt; factors.rfc = 0.5, 0.5, 0.4, 0.5, 0.4</span>
<span class="sd">        &gt;&gt;&gt; factors.sfc = 0.5, 0.5, 0.5, 0.7, 0.7</span>
<span class="sd">        &gt;&gt;&gt; model.calc_pc_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.pc</span>
<span class="sd">        pc(6.5, 5.5, 4.5, 6.0, 7.865)</span>

<span class="sd">        Usually, one would set zero or positive values for parameter |PCAlt|.  But it</span>
<span class="sd">        is also allowed to assign negative values to reflect possible negative</span>
<span class="sd">        relationships between precipitation and altitude.  Method |Calc_PC_V1| performs</span>
<span class="sd">        the required truncations to prevent negative precipitation values:</span>


<span class="sd">        &gt;&gt;&gt; pcalt(-1.0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_pc_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.pc</span>
<span class="sd">        pc(0.0, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">PCAlt</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneZ</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">PCorr</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_derived</span><span class="o">.</span><span class="n">Z</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_inputs</span><span class="o">.</span><span class="n">P</span><span class="p">,</span> <span class="n">hland_factors</span><span class="o">.</span><span class="n">RfC</span><span class="p">,</span> <span class="n">hland_factors</span><span class="o">.</span><span class="n">SfC</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">PC</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">pc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">inp</span><span class="o">.</span><span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">con</span><span class="o">.</span><span class="n">pcalt</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">zonez</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">der</span><span class="o">.</span><span class="n">z</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">flu</span><span class="o">.</span><span class="n">pc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">pc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">pc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*=</span> <span class="n">con</span><span class="o">.</span><span class="n">pcorr</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">fac</span><span class="o">.</span><span class="n">rfc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">fac</span><span class="o">.</span><span class="n">sfc</span><span class="p">[</span><span class="n">k</span><span class="p">])</span></div>



<div class="viewcode-block" id="Calc_TF_Ic_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_TF_Ic_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_TF_Ic_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate throughfall and update the interception storage accordingly.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      .. math::</span>
<span class="sd">        TF =</span>
<span class="sd">        \begin{cases}</span>
<span class="sd">        PC &amp;|\ Ic = IcMax</span>
<span class="sd">        \\</span>
<span class="sd">        0 &amp;|\ Ic &lt; IcMax</span>
<span class="sd">        \end{cases}</span>

<span class="sd">    Examples:</span>

<span class="sd">        Initialise seven zones of different types.  Assume a general interception</span>
<span class="sd">        capacity of 2 mm. All zones receive a precipitation input of 0.5 mm:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(7)</span>
<span class="sd">        &gt;&gt;&gt; zonetype(GLACIER, ILAKE, FIELD, FOREST, SEALED, SEALED, SEALED)</span>
<span class="sd">        &gt;&gt;&gt; icmax(2.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.pc = 0.5</span>
<span class="sd">        &gt;&gt;&gt; states.ic = 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_tf_ic_v1()</span>

<span class="sd">        The interception routine does not apply to glaciers (first zone) and internal</span>
<span class="sd">        lakes (second zone).  Hence, all precipitation becomes throughfall. For fields,</span>
<span class="sd">        forests, and sealed areas, the interception routine works identical, so the</span>
<span class="sd">        results of zone three to five are equal.  The last three zones demonstrate that</span>
<span class="sd">        all precipitation is stored until the intercepted water reaches the available</span>
<span class="sd">        capacity; afterwards, all precipitation becomes throughfall.  Initial storage</span>
<span class="sd">        reduces the effective capacity of the respective simulation step:</span>

<span class="sd">        &gt;&gt;&gt; states.ic</span>
<span class="sd">        ic(0.0, 0.0, 0.5, 0.5, 0.5, 1.5, 2.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tf</span>
<span class="sd">        tf(0.5, 0.5, 0.0, 0.0, 0.0, 0.0, 0.5)</span>

<span class="sd">        A zero precipitation example:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.pc = 0.0</span>
<span class="sd">        &gt;&gt;&gt; states.ic = 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_tf_ic_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.ic</span>
<span class="sd">        ic(0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 2.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tf</span>
<span class="sd">        tf(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>

<span class="sd">        A high precipitation example:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.pc = 5.0</span>
<span class="sd">        &gt;&gt;&gt; states.ic = 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_tf_ic_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.ic</span>
<span class="sd">        ic(0.0, 0.0, 2.0, 2.0, 2.0, 2.0, 2.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tf</span>
<span class="sd">        tf(5.0, 5.0, 3.0, 3.0, 3.0, 4.0, 5.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneType</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">IcMax</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">PC</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_states</span><span class="o">.</span><span class="n">Ic</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">TF</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">zonetype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">FIELD</span><span class="p">,</span> <span class="n">FOREST</span><span class="p">,</span> <span class="n">SEALED</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">tf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">pc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">icmax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">sta</span><span class="o">.</span><span class="n">ic</span><span class="p">[</span><span class="n">k</span><span class="p">]),</span> <span class="mf">0.0</span><span class="p">)</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">ic</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">pc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">tf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">tf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">pc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">ic</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_EI_Ic_AETModel_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_EI_Ic_AETModel_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_EI_Ic_AETModel_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Let a submodel that follows the |AETModel_V1| submodel interface calculate</span>
<span class="sd">    interception evaporation and adjust the amount of intercepted water.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`\frac{dIc_i}{dt} = -EI_i`</span>

<span class="sd">    Examples:</span>

<span class="sd">        We build an example based on |evap_aet_hbv96| for calculating interception</span>
<span class="sd">        evaporation, which uses |evap_ret_io| for querying potential</span>
<span class="sd">        evapotranspiration:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland_96 import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(5)</span>
<span class="sd">        &gt;&gt;&gt; zonetype(GLACIER, SEALED, FIELD, FOREST, ILAKE)</span>
<span class="sd">        &gt;&gt;&gt; area(1.0)</span>
<span class="sd">        &gt;&gt;&gt; zonearea(0.05, 0.1, 0.2, 0.3, 0.35)</span>
<span class="sd">        &gt;&gt;&gt; zonez(5.0)</span>
<span class="sd">        &gt;&gt;&gt; icmax(3.0)</span>
<span class="sd">        &gt;&gt;&gt; fc(50.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tf = 0.5</span>
<span class="sd">        &gt;&gt;&gt; with model.add_aetmodel_v1(&quot;evap_aet_hbv96&quot;):</span>
<span class="sd">        ...     with model.add_petmodel_v1(&quot;evap_ret_io&quot;):</span>
<span class="sd">        ...         evapotranspirationfactor(0.6, 0.8, 1.0, 1.2, 1.4)</span>
<span class="sd">        ...         inputs.referenceevapotranspiration = 1.0</span>

<span class="sd">        |Calc_EI_Ic_AETModel_V1| uses the flux returned by the submodel to adjust |Ic|:</span>

<span class="sd">        &gt;&gt;&gt; states.ic = 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_ei_ic_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.ei</span>
<span class="sd">        ei(0.0, 0.8, 1.0, 1.2, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.ic</span>
<span class="sd">        ic(0.0, 1.2, 1.0, 0.8, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tf</span>
<span class="sd">        tf(0.5, 0.5, 0.5, 0.5, 0.5)</span>

<span class="sd">        |Calc_EI_Ic_AETModel_V1| eventually reduces |EI| so that |Ic| does not become</span>
<span class="sd">        negative:</span>

<span class="sd">        &gt;&gt;&gt; model.aetmodel.petmodel.sequences.inputs.referenceevapotranspiration = 5.0</span>
<span class="sd">        &gt;&gt;&gt; states.ic = 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_ei_ic_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.ei</span>
<span class="sd">        ei(0.0, 2.0, 2.0, 2.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.ic</span>
<span class="sd">        ic(0.0, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tf</span>
<span class="sd">        tf(0.5, 0.5, 0.5, 0.5, 0.5)</span>

<span class="sd">        In contrast, |Calc_EI_Ic_AETModel_V1| does not reduce negative |EI| values</span>
<span class="sd">        (condensation) that cause an overshoot of the interception storage capacity:</span>

<span class="sd">        &gt;&gt;&gt; model.aetmodel.petmodel.sequences.inputs.referenceevapotranspiration = -3.0</span>
<span class="sd">        &gt;&gt;&gt; states.ic = 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_ei_ic_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.ei</span>
<span class="sd">        ei(0.0, -2.4, -3.0, -3.6, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.ic</span>
<span class="sd">        ic(0.0, 4.4, 5.0, 5.6, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tf</span>
<span class="sd">        tf(0.5, 0.5, 0.5, 0.5, 0.5)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span> <span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneType</span><span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_states</span><span class="o">.</span><span class="n">Ic</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">EI</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">submodel</span><span class="p">:</span> <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">submodel</span><span class="o">.</span><span class="n">determine_interceptionevaporation</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">zonetype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">FIELD</span><span class="p">,</span> <span class="n">FOREST</span><span class="p">,</span> <span class="n">SEALED</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">ei</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">submodel</span><span class="o">.</span><span class="n">get_interceptionevaporation</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">sta</span><span class="o">.</span><span class="n">ic</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">ic</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-=</span> <span class="n">flu</span><span class="o">.</span><span class="n">ei</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">ei</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">ic</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_EI_Ic_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_EI_Ic_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_EI_Ic_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Let a submodel that follows the |AETModel_V1| submodel interface calculate</span>
<span class="sd">    interception evaporation and adjust the amount of intercepted water.&quot;&quot;&quot;</span>

    <span class="n">SUBMODELINTERFACES</span> <span class="o">=</span> <span class="p">(</span><span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="p">,)</span>
    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Calc_EI_Ic_AETModel_V1</span><span class="p">,)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span> <span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneType</span><span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_states</span><span class="o">.</span><span class="n">Ic</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">EI</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">aetmodel_typeid</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">calc_ei_ic_aetmodel_v1</span><span class="p">(</span>
                <span class="n">cast</span><span class="p">(</span><span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">aetmodel</span><span class="p">)</span>
            <span class="p">)</span></div>

        <span class="c1"># ToDo:</span>
        <span class="c1">#     else:</span>
        <span class="c1">#         assert_never(model.petmodel)</span>


<div class="viewcode-block" id="Calc_SP_WC_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_SP_WC_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_SP_WC_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Add throughfall to the snow layer.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      :math:`\frac{dSP}{dt} = SFDist \cdot TF \cdot \frac{SfC}{SfC + RfC}`</span>

<span class="sd">      :math:`\frac{dWC}{dt} = SFDist \cdot TF \cdot \frac{RfC}{SfC + RfC}`</span>

<span class="sd">    Examples:</span>

<span class="sd">        Consider the following setting, in which nine zones of different types receive</span>
<span class="sd">        a throughfall of 10 mm:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(9)</span>
<span class="sd">        &gt;&gt;&gt; sclass(1)</span>
<span class="sd">        &gt;&gt;&gt; zonetype(ILAKE, GLACIER, FIELD, FOREST, SEALED, FIELD, FIELD, FIELD, FIELD)</span>
<span class="sd">        &gt;&gt;&gt; sfdist(0.2)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tf = 10.0</span>
<span class="sd">        &gt;&gt;&gt; factors.sfc = 0.5, 0.5, 0.5, 0.5, 0.5, 0.2, 0.8, 1.0, 4.0</span>
<span class="sd">        &gt;&gt;&gt; factors.rfc = 0.5, 0.5, 0.5, 0.5, 0.5, 0.8, 0.2, 4.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; states.sp = 2.0</span>
<span class="sd">        &gt;&gt;&gt; states.wc = 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_sp_wc_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.sp</span>
<span class="sd">        sp(0.0, 7.0, 7.0, 7.0, 7.0, 4.0, 10.0, 4.0, 10.0)</span>
<span class="sd">        &gt;&gt;&gt; states.wc</span>
<span class="sd">        wc(0.0, 6.0, 6.0, 6.0, 6.0, 9.0, 3.0, 9.0, 3.0)</span>

<span class="sd">        The snow routine does not apply to internal lakes, which is why both the ice</span>
<span class="sd">        storage and the water storage of the first zone remain unchanged.  The snow</span>
<span class="sd">        routine is identical for fields, forests, sealed areas, and glaciers (besides</span>
<span class="sd">        the additional glacier melt), which is why the results zone three to five are</span>
<span class="sd">        equal.  The last four zones illustrate that method |Calc_SP_WC_V1| applies the</span>
<span class="sd">        corrected snowfall and rainfall fractions &quot;relatively&quot;, considering that the</span>
<span class="sd">        throughfall is already corrected.</span>

<span class="sd">        When both factors are zero, neither the water nor the ice content of the snow</span>
<span class="sd">        layer changes:</span>

<span class="sd">        &gt;&gt;&gt; factors.sfc = 0.0</span>
<span class="sd">        &gt;&gt;&gt; factors.rfc = 0.0</span>
<span class="sd">        &gt;&gt;&gt; states.sp = 2.0</span>
<span class="sd">        &gt;&gt;&gt; states.wc = 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_sp_wc_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.sp</span>
<span class="sd">        sp(0.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0)</span>
<span class="sd">        &gt;&gt;&gt; states.wc</span>
<span class="sd">        wc(0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0)</span>

<span class="sd">        In the above examples, we did not divide the zones into snow classes. If we do</span>
<span class="sd">        so, method |Calc_SP_WC_V1| adds different amounts of snow and rainfall to the</span>
<span class="sd">        individual snow classes based on the current values of parameter |SFDist|:</span>

<span class="sd">        &gt;&gt;&gt; sclass(2)</span>
<span class="sd">        &gt;&gt;&gt; sfdist(0.0, 2.0)</span>
<span class="sd">        &gt;&gt;&gt; factors.sfc = 0.5, 0.5, 0.5, 0.5, 0.5, 0.2, 0.8, 1.0, 4.0</span>
<span class="sd">        &gt;&gt;&gt; factors.rfc = 0.5, 0.5, 0.5, 0.5, 0.5, 0.8, 0.2, 4.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; states.sp = 2.0</span>
<span class="sd">        &gt;&gt;&gt; states.wc = 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_sp_wc_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.sp</span>
<span class="sd">        sp([[0.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0],</span>
<span class="sd">            [0.0, 12.0, 12.0, 12.0, 12.0, 6.0, 18.0, 6.0, 18.0]])</span>
<span class="sd">        &gt;&gt;&gt; states.wc</span>
<span class="sd">        wc([[0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0],</span>
<span class="sd">            [0.0, 11.0, 11.0, 11.0, 11.0, 17.0, 5.0, 17.0, 5.0]])</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">SClass</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneType</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">SFDist</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">TF</span><span class="p">,</span> <span class="n">hland_factors</span><span class="o">.</span><span class="n">RfC</span><span class="p">,</span> <span class="n">hland_factors</span><span class="o">.</span><span class="n">SfC</span><span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_states</span><span class="o">.</span><span class="n">WC</span><span class="p">,</span> <span class="n">hland_states</span><span class="o">.</span><span class="n">SP</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">zonetype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">!=</span> <span class="n">ILAKE</span><span class="p">:</span>
                <span class="n">d_denom</span> <span class="o">=</span> <span class="n">fac</span><span class="o">.</span><span class="n">rfc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">fac</span><span class="o">.</span><span class="n">sfc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">d_denom</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">d_rain</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">tf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">fac</span><span class="o">.</span><span class="n">rfc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">d_denom</span>
                    <span class="n">d_snow</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">tf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">fac</span><span class="o">.</span><span class="n">sfc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">d_denom</span>
                    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">sclass</span><span class="p">):</span>
                        <span class="n">sta</span><span class="o">.</span><span class="n">wc</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">con</span><span class="o">.</span><span class="n">sfdist</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">*</span> <span class="n">d_rain</span>
                        <span class="n">sta</span><span class="o">.</span><span class="n">sp</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">con</span><span class="o">.</span><span class="n">sfdist</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">*</span> <span class="n">d_snow</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">sclass</span><span class="p">):</span>
                    <span class="n">sta</span><span class="o">.</span><span class="n">wc</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                    <span class="n">sta</span><span class="o">.</span><span class="n">sp</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_SPL_WCL_SP_WC_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_SPL_WCL_SP_WC_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_SPL_WCL_SP_WC_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the subbasin-internal redistribution losses of the snow layer.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      :math:`\frac{dSP}{dt} = -SPL`</span>

<span class="sd">      :math:`\frac{dWC}{dt} = -WCL`</span>

<span class="sd">      :math:`SPL = SP \cdot RelExcess`</span>

<span class="sd">      :math:`WCL = WC \cdot RelExcess`</span>

<span class="sd">      :math:`RelExcess = \frac{max(SP + WC - SMax, 0)}{SP + WC}`</span>

<span class="sd">    Examples:</span>

<span class="sd">        We prepare eight zones.  We use the first five to show the identical behaviour</span>
<span class="sd">        of the land-use types |GLACIER|, |FIELD|, |FOREST|, and |SEALED| and the unique</span>
<span class="sd">        behaviour of type |ILAKE|.  Zones six to eight serve to demonstrate the effects</span>
<span class="sd">        of different initial states:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(8)</span>
<span class="sd">        &gt;&gt;&gt; sclass(1)</span>
<span class="sd">        &gt;&gt;&gt; zonetype(ILAKE, GLACIER, FIELD, FOREST, SEALED, FIELD, FIELD, FIELD)</span>
<span class="sd">        &gt;&gt;&gt; smax(500.0)</span>

<span class="sd">        Internal lakes do not possess a snow module and cannot redistribute any snow.</span>
<span class="sd">        Hence, |Calc_SPL_WCL_SP_WC_V1| sets the loss (|SPL| and |WCL|) and state (|SP|</span>
<span class="sd">        and |WC|) sequences to zero.  For all other zones, the total amount of snow</span>
<span class="sd">        redistribution depends on how much the total water equivalent exceeds the</span>
<span class="sd">        threshold parameter |SMax| (consistently set to 500 m).  The fraction between</span>
<span class="sd">        the liquid (|WCL|) and frozen (|SPL|) loss depends on the fraction between</span>
<span class="sd">        the actual storage of liquid (|WC|) and frozen (|SP|) water in the snow layer:</span>

<span class="sd">        &gt;&gt;&gt; states.sp = 600.0, 600.0, 600.0, 600.0, 600.0, 60.0, 800.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; states.wc = 200.0, 200.0, 200.0, 200.0, 200.0, 20.0, 0.0, 800.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_spl_wcl_sp_wc_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.spl</span>
<span class="sd">        spl(0.0, 225.0, 225.0, 225.0, 225.0, 0.0, 300.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wcl</span>
<span class="sd">        wcl(0.0, 75.0, 75.0, 75.0, 75.0, 0.0, 0.0, 300.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sp</span>
<span class="sd">        sp(0.0, 375.0, 375.0, 375.0, 375.0, 60.0, 500.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.wc</span>
<span class="sd">        wc(0.0, 125.0, 125.0, 125.0, 125.0, 20.0, 0.0, 500.0)</span>

<span class="sd">        The above example deals with a single snow class.  Here, we add a second snow</span>
<span class="sd">        class to illustrate that the total snow loss of each zone does not depend on</span>
<span class="sd">        its average snow storage but the degree of exceedance of |SMax| within its</span>
<span class="sd">        individual snow classes:</span>

<span class="sd">        &gt;&gt;&gt; sclass(2)</span>
<span class="sd">        &gt;&gt;&gt; states.sp = [[600.0, 600.0, 600.0, 600.0, 600.0, 60.0, 800.0, 0.0],</span>
<span class="sd">        ...              [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]]</span>
<span class="sd">        &gt;&gt;&gt; states.wc = [[200.0, 200.0, 200.0, 200.0, 200.0, 20.0, 0.0, 800.0],</span>
<span class="sd">        ...              [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]]</span>
<span class="sd">        &gt;&gt;&gt; model.calc_spl_wcl_sp_wc_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.spl</span>
<span class="sd">        spl(0.0, 112.5, 112.5, 112.5, 112.5, 0.0, 150.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wcl</span>
<span class="sd">        wcl(0.0, 37.5, 37.5, 37.5, 37.5, 0.0, 0.0, 150.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sp</span>
<span class="sd">        sp([[0.0, 375.0, 375.0, 375.0, 375.0, 60.0, 500.0, 0.0],</span>
<span class="sd">            [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]])</span>
<span class="sd">        &gt;&gt;&gt; states.wc</span>
<span class="sd">        wc([[0.0, 125.0, 125.0, 125.0, 125.0, 20.0, 0.0, 500.0],</span>
<span class="sd">            [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]])</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">SClass</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneType</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">SMax</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_states</span><span class="o">.</span><span class="n">WC</span><span class="p">,</span> <span class="n">hland_states</span><span class="o">.</span><span class="n">SP</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">SPL</span><span class="p">,</span> <span class="n">hland_fluxes</span><span class="o">.</span><span class="n">WCL</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">spl</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">wcl</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">zonetype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">ILAKE</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">sclass</span><span class="p">):</span>
                    <span class="n">sta</span><span class="o">.</span><span class="n">sp</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                    <span class="n">sta</span><span class="o">.</span><span class="n">wc</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">smax</span><span class="p">[</span><span class="n">k</span><span class="p">]):</span>
                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">sclass</span><span class="p">):</span>
                    <span class="n">d_snow</span> <span class="o">=</span> <span class="n">sta</span><span class="o">.</span><span class="n">sp</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">sta</span><span class="o">.</span><span class="n">wc</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
                    <span class="n">d_excess</span> <span class="o">=</span> <span class="n">d_snow</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">smax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">d_excess</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                        <span class="n">d_excess_sp</span> <span class="o">=</span> <span class="n">d_excess</span> <span class="o">*</span> <span class="n">sta</span><span class="o">.</span><span class="n">sp</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">d_snow</span>
                        <span class="n">d_excess_wc</span> <span class="o">=</span> <span class="n">d_excess</span> <span class="o">*</span> <span class="n">sta</span><span class="o">.</span><span class="n">wc</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">d_snow</span>
                        <span class="n">flu</span><span class="o">.</span><span class="n">spl</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">d_excess_sp</span> <span class="o">/</span> <span class="n">con</span><span class="o">.</span><span class="n">sclass</span>
                        <span class="n">flu</span><span class="o">.</span><span class="n">wcl</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">d_excess_wc</span> <span class="o">/</span> <span class="n">con</span><span class="o">.</span><span class="n">sclass</span>
                        <span class="n">sta</span><span class="o">.</span><span class="n">sp</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">-=</span> <span class="n">d_excess_sp</span>
                        <span class="n">sta</span><span class="o">.</span><span class="n">wc</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">-=</span> <span class="n">d_excess_wc</span></div>



<div class="viewcode-block" id="Calc_SPG_WCG_SP_WC_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_SPG_WCG_SP_WC_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_SPG_WCG_SP_WC_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the subbasin-internal redistribution gains of the snow layer.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      :math:`\frac{dSP}{dt} = -SPG`</span>

<span class="sd">      :math:`\frac{dWC}{dt} = -WCG`</span>

<span class="sd">    Examples:</span>

<span class="sd">        We prepare an example consisting of seven zones, sorted by (non-strictly)</span>
<span class="sd">        descending elevation.  For now, there is a single snow class per zone, and the</span>
<span class="sd">        zones&#39; areas are identical (1.0 km²).  The last zone is of type |ILAKE| and</span>
<span class="sd">        does not participate in snow redistribution. We use the same configuration for</span>
<span class="sd">        |SMax| (the maximum snow storage) and |SRed| (defining the redistribution</span>
<span class="sd">        paths) throughout all examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; area(7.0)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(7)</span>
<span class="sd">        &gt;&gt;&gt; sclass(1)</span>
<span class="sd">        &gt;&gt;&gt; zonetype(GLACIER, FIELD, FOREST, SEALED, FOREST, FIELD, ILAKE)</span>
<span class="sd">        &gt;&gt;&gt; zonez(30.0, 25.0, 20.0, 15.0, 10.0, 10.0, 5.0)</span>
<span class="sd">        &gt;&gt;&gt; zonearea(1.0)</span>
<span class="sd">        &gt;&gt;&gt; psi(1.0)</span>
<span class="sd">        &gt;&gt;&gt; sfdist(1.0)</span>
<span class="sd">        &gt;&gt;&gt; smax(500.0)</span>
<span class="sd">        &gt;&gt;&gt; sred([[0.0, 0.2, 0.2, 0.2, 0.2, 0.2, 0.0],</span>
<span class="sd">        ...       [0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0],</span>
<span class="sd">        ...       [0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0],</span>
<span class="sd">        ...       [0.0, 0.0, 0.0, 0.0, 0.5, 0.5, 0.0],</span>
<span class="sd">        ...       [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],</span>
<span class="sd">        ...       [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],</span>
<span class="sd">        ...       [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]])</span>

<span class="sd">        For convenience, we prepare a function that updates all relevant derived</span>
<span class="sd">        parameters:</span>

<span class="sd">        &gt;&gt;&gt; def update():</span>
<span class="sd">        ...     derived.rellandarea.update()</span>
<span class="sd">        ...     derived.relzoneareas.update()</span>
<span class="sd">        ...     derived.rellowerzonearea.update()</span>
<span class="sd">        ...     derived.zonearearatios.update()</span>
<span class="sd">        ...     derived.indiceszonez.update()</span>
<span class="sd">        ...     derived.sredorder.update()</span>
<span class="sd">        ...     derived.srednumber.update()</span>
<span class="sd">        ...     derived.sredend.update()</span>
<span class="sd">        &gt;&gt;&gt; update()</span>

<span class="sd">        In the first example, the total snow water equivalent (300 mm) is way below</span>
<span class="sd">        |SRed| (500 mm).  Hence, all frozen (|SPL|) and liquid (|WCL|) water released</span>
<span class="sd">        deposits completely in the target zones:</span>

<span class="sd">        &gt;&gt;&gt; states.sp = 200.0</span>
<span class="sd">        &gt;&gt;&gt; states.wc = 100.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.spl = 20.0, 20.0, 20.0, 20.0, 0.0, 0.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wcl = 10.0, 10.0, 10.0, 10.0, 0.0, 0.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_spg_wcg_sp_wc_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.spg</span>
<span class="sd">        spg(0.0, 4.0, 24.0, 24.0, 14.0, 14.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wcg</span>
<span class="sd">        wcg(0.0, 2.0, 12.0, 12.0, 7.0, 7.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sp</span>
<span class="sd">        sp(200.0, 204.0, 224.0, 224.0, 214.0, 214.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.wc</span>
<span class="sd">        wc(100.0, 102.0, 112.0, 112.0, 107.0, 107.0, 0.0)</span>

<span class="sd">        The following test function checks that method |Calc_SPG_WCG_SP_WC_V1| does not</span>
<span class="sd">        introduce any water balance errors:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import repr_</span>
<span class="sd">        &gt;&gt;&gt; def check(sp_old, wc_old):</span>
<span class="sd">        ...     def check_vector(deltas):</span>
<span class="sd">        ...         return numpy.max(numpy.abs(numpy.sum(deltas, axis=0)))</span>
<span class="sd">        ...     sp_new = states.sp.average_values()</span>
<span class="sd">        ...     sp_delta_l = fluxes.spl.average_values()</span>
<span class="sd">        ...     sp_delta_g = fluxes.spg.average_values()</span>
<span class="sd">        ...     sp_old_array = numpy.array(6 * [sp_old] + [0.0])</span>
<span class="sd">        ...     wc_new = states.wc.average_values()</span>
<span class="sd">        ...     wc_delta_l = fluxes.wcl.average_values()</span>
<span class="sd">        ...     wc_delta_g = fluxes.wcg.average_values()</span>
<span class="sd">        ...     wc_old_array = numpy.array(6 * [wc_old] + [0.0])</span>
<span class="sd">        ...     errors = [sp_old + sp_delta_l - sp_new,</span>
<span class="sd">        ...               sp_delta_l - sp_delta_g,</span>
<span class="sd">        ...               check_vector(sp_old_array + fluxes.spg - states.sp),</span>
<span class="sd">        ...               wc_old + wc_delta_l - wc_new,</span>
<span class="sd">        ...               wc_delta_l - wc_delta_g,</span>
<span class="sd">        ...               check_vector(wc_old_array + fluxes.wcg - states.wc)]</span>
<span class="sd">        ...     print(*(repr_(error) for error in errors), sep=&quot;, &quot;)</span>

<span class="sd">        The possible errors related to different aspects of the frozen and the liquid</span>
<span class="sd">        water content of the snow layer are all within the range of the given numerical</span>
<span class="sd">        precision:</span>

<span class="sd">        &gt;&gt;&gt; check(sp_old=200.0, wc_old=100.0)</span>
<span class="sd">        0.0, 0.0, 0.0, 0.0, 0.0, 0.0</span>

<span class="sd">        Next, we increase the size of the first area and decrease the size of the</span>
<span class="sd">        second area by the same amount.  The different results for |SPG| and |WCG|</span>
<span class="sd">        reflect that the loss terms (|SPL| and |WCL|) relate to the sizes of the</span>
<span class="sd">        supplying zones while the gain terms (|SPG| and |WCG|) relate to the sizes of</span>
<span class="sd">        the receiving zones:</span>

<span class="sd">        &gt;&gt;&gt; zonearea(1.5, 0.5, 1.0, 1.0, 1.0, 1.0, 1.0)</span>
<span class="sd">        &gt;&gt;&gt; update()</span>
<span class="sd">        &gt;&gt;&gt; states.sp = 200.0</span>
<span class="sd">        &gt;&gt;&gt; states.wc = 100.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_spg_wcg_sp_wc_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.spg</span>
<span class="sd">        spg(0.0, 12.0, 16.0, 26.0, 16.0, 16.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wcg</span>
<span class="sd">        wcg(0.0, 6.0, 8.0, 13.0, 8.0, 8.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sp</span>
<span class="sd">        sp(200.0, 212.0, 216.0, 226.0, 216.0, 216.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.wc</span>
<span class="sd">        wc(100.0, 106.0, 108.0, 113.0, 108.0, 108.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; check(sp_old=200.0, wc_old=100.0)</span>
<span class="sd">        0.0, 0.0, 0.0, 0.0, 0.0, 0.0</span>

<span class="sd">        When modelling high mountain areas, even the lowest zones (the so-called</span>
<span class="sd">        &quot;dead-ends&quot;) can receive substantial amounts of redistributed snow.  Therefore,</span>
<span class="sd">        the simple &quot;from top to bottom&quot; approach described so far can result in</span>
<span class="sd">        unrealistic snow towers for these dead-ends, especially if their size is small</span>
<span class="sd">        compared to the size of the snow-delivering area.  To prevent such artefacts,</span>
<span class="sd">        method |Calc_SPG_WCG_SP_WC_V1| takes the total snow amount of all dead-ends</span>
<span class="sd">        exceeding the |Smax| threshold and distributes it gradually to the other zones,</span>
<span class="sd">        starting from the lowest in the order defined by parameter |IndicesZoneZ|:</span>

<span class="sd">        &gt;&gt;&gt; zonearea(1.0)</span>
<span class="sd">        &gt;&gt;&gt; update()</span>
<span class="sd">        &gt;&gt;&gt; states.sp = 400.0</span>
<span class="sd">        &gt;&gt;&gt; states.wc = 75.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_spg_wcg_sp_wc_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.spg</span>
<span class="sd">        spg(0.0, 13.333333, 16.666667, 16.666667, 16.666667, 16.666667, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wcg</span>
<span class="sd">        wcg(0.0, 6.666667, 8.333333, 8.333333, 8.333333, 8.333333, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sp</span>
<span class="sd">        sp(400.0, 413.333333, 416.666667, 416.666667, 416.666667, 416.666667,</span>
<span class="sd">           0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.wc</span>
<span class="sd">        wc(75.0, 81.666667, 83.333333, 83.333333, 83.333333, 83.333333, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; check(sp_old=400.0, wc_old=75.0)</span>
<span class="sd">        0.0, 0.0, 0.0, 0.0, 0.0, 0.0</span>

<span class="sd">        If the total snow amount of all zone reaches |SMax|, |Calc_SPG_WCG_SP_WC_V1|</span>
<span class="sd">        distributes all remaining excess evenly to all non-lake zones:</span>

<span class="sd">        &gt;&gt;&gt; states.sp = 400.0</span>
<span class="sd">        &gt;&gt;&gt; states.wc = 90.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_spg_wcg_sp_wc_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.spg</span>
<span class="sd">        spg(13.333333, 13.333333, 13.333333, 13.333333, 13.333333, 13.333333,</span>
<span class="sd">            0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wcg</span>
<span class="sd">        wcg(6.666667, 6.666667, 6.666667, 6.666667, 6.666667, 6.666667, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sp</span>
<span class="sd">        sp(413.333333, 413.333333, 413.333333, 413.333333, 413.333333,</span>
<span class="sd">           413.333333, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.wc</span>
<span class="sd">        wc(96.666667, 96.666667, 96.666667, 96.666667, 96.666667, 96.666667, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; check(sp_old=400.0, wc_old=90.0)</span>
<span class="sd">        0.0, 0.0, 0.0, 0.0, 0.0, 0.0</span>

<span class="sd">        Introducing multiple snow classes within each zone complicates things.  We</span>
<span class="sd">        repeat some of the above examples with an increased number of snow classes:</span>

<span class="sd">        &gt;&gt;&gt; sclass(2)</span>
<span class="sd">        &gt;&gt;&gt; update()</span>

<span class="sd">        The &quot;normal&quot; snow redistribution relies similarly on parameter |SFDist| as the</span>
<span class="sd">        snowfall accumulation does.  We show this by repeating the first example with</span>
<span class="sd">        the most extreme configuration of |SFDist|, where the second snow class</span>
<span class="sd">        receives the entire amount of incoming snow:</span>

<span class="sd">        &gt;&gt;&gt; sfdist(0.0, 2.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sp = 200.0</span>
<span class="sd">        &gt;&gt;&gt; states.wc = 100.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.spl = 20.0, 20.0, 20.0, 20.0, 0.0, 0.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wcl = 10.0, 10.0, 10.0, 10.0, 0.0, 0.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_spg_wcg_sp_wc_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.spg</span>
<span class="sd">        spg(0.0, 4.0, 24.0, 24.0, 14.0, 14.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wcg</span>
<span class="sd">        wcg(0.0, 2.0, 12.0, 12.0, 7.0, 7.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sp</span>
<span class="sd">        sp([[200.0, 200.0, 200.0, 200.0, 200.0, 200.0, 0.0],</span>
<span class="sd">            [200.0, 208.0, 248.0, 248.0, 228.0, 228.0, 0.0]])</span>
<span class="sd">        &gt;&gt;&gt; states.wc</span>
<span class="sd">        wc([[100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 0.0],</span>
<span class="sd">            [100.0, 104.0, 124.0, 124.0, 114.0, 114.0, 0.0]])</span>

<span class="sd">        During the eventual &quot;bottom to top&quot; re-redistribution, on the other hand,</span>
<span class="sd">        the fractions between the gains of individual snow classes do not depend on</span>
<span class="sd">        |SFDist| but their remaining capacities:</span>

<span class="sd">        &gt;&gt;&gt; states.sp = 400.0</span>
<span class="sd">        &gt;&gt;&gt; states.wc = 75.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_spg_wcg_sp_wc_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.spg</span>
<span class="sd">        spg(0.0, 13.333333, 16.666667, 16.666667, 16.666667, 16.666667, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wcg</span>
<span class="sd">        wcg(0.0, 6.666667, 8.333333, 8.333333, 8.333333, 8.333333, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sp</span>
<span class="sd">        sp([[400.0, 412.280702, 416.666667, 416.666667, 416.666667, 416.666667,</span>
<span class="sd">             0.0],</span>
<span class="sd">            [400.0, 414.385965, 416.666667, 416.666667, 416.666667, 416.666667,</span>
<span class="sd">             0.0]])</span>
<span class="sd">        &gt;&gt;&gt; states.wc</span>
<span class="sd">        wc([[75.0, 81.140351, 83.333333, 83.333333, 83.333333, 83.333333, 0.0],</span>
<span class="sd">            [75.0, 82.192982, 83.333333, 83.333333, 83.333333, 83.333333, 0.0]])</span>
<span class="sd">        &gt;&gt;&gt; check(sp_old=400.0, wc_old=75.0)</span>
<span class="sd">        0.0, 0.0, 0.0, 0.0, 0.0, 0.0</span>

<span class="sd">        During a subbasin-wide excess of |SMax|, all snow classes of a specific zone</span>
<span class="sd">        handle the same total snow water equivalent:</span>

<span class="sd">        &gt;&gt;&gt; states.sp = 400.0</span>
<span class="sd">        &gt;&gt;&gt; states.wc = 90.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_spg_wcg_sp_wc_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.spg</span>
<span class="sd">        spg(13.333333, 13.333333, 13.333333, 13.333333, 13.333333, 13.333333,</span>
<span class="sd">            0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wcg</span>
<span class="sd">        wcg(6.666667, 6.666667, 6.666667, 6.666667, 6.666667, 6.666667, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sp</span>
<span class="sd">        sp([[413.333333, 413.333333, 413.333333, 413.333333, 413.333333,</span>
<span class="sd">             413.333333, 0.0],</span>
<span class="sd">            [413.333333, 413.333333, 413.333333, 413.333333, 413.333333,</span>
<span class="sd">             413.333333, 0.0]])</span>
<span class="sd">        &gt;&gt;&gt; states.wc</span>
<span class="sd">        wc([[96.666667, 96.666667, 96.666667, 96.666667, 96.666667, 96.666667,</span>
<span class="sd">             0.0],</span>
<span class="sd">            [96.666667, 96.666667, 96.666667, 96.666667, 96.666667, 96.666667,</span>
<span class="sd">             0.0]])</span>
<span class="sd">        &gt;&gt;&gt; check(sp_old=400.0, wc_old=90.0)</span>
<span class="sd">        0.0, 0.0, 0.0, 0.0, 0.0, 0.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">SClass</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneType</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">SFDist</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">SMax</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">SRed</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_derived</span><span class="o">.</span><span class="n">RelLandArea</span><span class="p">,</span>
        <span class="n">hland_derived</span><span class="o">.</span><span class="n">RelZoneAreas</span><span class="p">,</span>
        <span class="n">hland_derived</span><span class="o">.</span><span class="n">ZoneAreaRatios</span><span class="p">,</span>
        <span class="n">hland_derived</span><span class="o">.</span><span class="n">IndicesZoneZ</span><span class="p">,</span>
        <span class="n">hland_derived</span><span class="o">.</span><span class="n">SRedNumber</span><span class="p">,</span>
        <span class="n">hland_derived</span><span class="o">.</span><span class="n">SRedOrder</span><span class="p">,</span>
        <span class="n">hland_derived</span><span class="o">.</span><span class="n">SRedEnd</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">SPL</span><span class="p">,</span> <span class="n">hland_fluxes</span><span class="o">.</span><span class="n">WCL</span><span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_states</span><span class="o">.</span><span class="n">WC</span><span class="p">,</span> <span class="n">hland_states</span><span class="o">.</span><span class="n">SP</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_aides</span><span class="o">.</span><span class="n">SPE</span><span class="p">,</span>
        <span class="n">hland_aides</span><span class="o">.</span><span class="n">WCE</span><span class="p">,</span>
        <span class="n">hland_fluxes</span><span class="o">.</span><span class="n">SPG</span><span class="p">,</span>
        <span class="n">hland_fluxes</span><span class="o">.</span><span class="n">WCG</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>

        <span class="c1"># initialise gain and excess:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">spg</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">wcg</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">spe</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">wce</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">zonetype</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">ILAKE</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">sclass</span><span class="p">):</span>
                    <span class="n">sta</span><span class="o">.</span><span class="n">sp</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                    <span class="n">sta</span><span class="o">.</span><span class="n">wc</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="c1"># redistribute losses from top to bottom:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">srednumber</span><span class="p">):</span>
            <span class="c1"># f: from, t: to</span>
            <span class="n">f</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">sredorder</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">der</span><span class="o">.</span><span class="n">sredorder</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">d_f</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">zonearearatios</span><span class="p">[</span><span class="n">f</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">sred</span><span class="p">[</span><span class="n">f</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span>
            <span class="n">d_gain_frozen</span> <span class="o">=</span> <span class="n">d_f</span> <span class="o">*</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">spl</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="o">+</span> <span class="n">aid</span><span class="o">.</span><span class="n">spe</span><span class="p">[</span><span class="n">f</span><span class="p">])</span>
            <span class="n">d_gain_liquid</span> <span class="o">=</span> <span class="n">d_f</span> <span class="o">*</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">wcl</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="o">+</span> <span class="n">aid</span><span class="o">.</span><span class="n">wce</span><span class="p">[</span><span class="n">f</span><span class="p">])</span>
            <span class="n">d_gain_total</span> <span class="o">=</span> <span class="n">d_gain_frozen</span> <span class="o">+</span> <span class="n">d_gain_liquid</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">sclass</span><span class="p">):</span>
                <span class="n">d_gain_pot</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">sfdist</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">*</span> <span class="n">d_gain_total</span>
                <span class="k">if</span> <span class="n">d_gain_pot</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">d_gain_max</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">smax</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">sta</span><span class="o">.</span><span class="n">sp</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">sta</span><span class="o">.</span><span class="n">wc</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span>
                    <span class="n">d_fraction_gain</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">d_gain_max</span> <span class="o">/</span> <span class="n">d_gain_pot</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
                    <span class="n">d_factor_gain</span> <span class="o">=</span> <span class="n">d_fraction_gain</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">sfdist</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">spg</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+=</span> <span class="n">d_factor_gain</span> <span class="o">*</span> <span class="n">d_gain_frozen</span> <span class="o">/</span> <span class="n">con</span><span class="o">.</span><span class="n">sclass</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">wcg</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+=</span> <span class="n">d_factor_gain</span> <span class="o">*</span> <span class="n">d_gain_liquid</span> <span class="o">/</span> <span class="n">con</span><span class="o">.</span><span class="n">sclass</span>
                    <span class="n">sta</span><span class="o">.</span><span class="n">sp</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="o">+=</span> <span class="n">d_factor_gain</span> <span class="o">*</span> <span class="n">d_gain_frozen</span>
                    <span class="n">sta</span><span class="o">.</span><span class="n">wc</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="o">+=</span> <span class="n">d_factor_gain</span> <span class="o">*</span> <span class="n">d_gain_liquid</span>
                    <span class="n">d_factor_excess</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">d_fraction_gain</span><span class="p">)</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">sfdist</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
                    <span class="n">aid</span><span class="o">.</span><span class="n">spe</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+=</span> <span class="n">d_factor_excess</span> <span class="o">*</span> <span class="n">d_gain_frozen</span> <span class="o">/</span> <span class="n">con</span><span class="o">.</span><span class="n">sclass</span>
                    <span class="n">aid</span><span class="o">.</span><span class="n">wce</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+=</span> <span class="n">d_factor_excess</span> <span class="o">*</span> <span class="n">d_gain_liquid</span> <span class="o">/</span> <span class="n">con</span><span class="o">.</span><span class="n">sclass</span>

        <span class="c1"># check for remaining excess at the dead ends:</span>
        <span class="n">d_excess_frozen_basin</span><span class="p">,</span> <span class="n">d_excess_liquid_basin</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">der</span><span class="o">.</span><span class="n">sredend</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">d_excess_frozen_basin</span> <span class="o">+=</span> <span class="n">der</span><span class="o">.</span><span class="n">relzoneareas</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">aid</span><span class="o">.</span><span class="n">spe</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">spl</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">d_excess_liquid_basin</span> <span class="o">+=</span> <span class="n">der</span><span class="o">.</span><span class="n">relzoneareas</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">aid</span><span class="o">.</span><span class="n">wce</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">wcl</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">d_excess_frozen_basin</span> <span class="o">+</span> <span class="n">d_excess_liquid_basin</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># redistribute the remaining excess from bottom to top:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">indiceszonez</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">zonetype</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">==</span> <span class="n">ILAKE</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">d_excess_frozen_zone</span> <span class="o">=</span> <span class="n">d_excess_frozen_basin</span> <span class="o">/</span> <span class="n">der</span><span class="o">.</span><span class="n">relzoneareas</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
            <span class="n">d_excess_liquid_zone</span> <span class="o">=</span> <span class="n">d_excess_liquid_basin</span> <span class="o">/</span> <span class="n">der</span><span class="o">.</span><span class="n">relzoneareas</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
            <span class="n">d_excess_total_zone</span> <span class="o">=</span> <span class="n">d_excess_frozen_zone</span> <span class="o">+</span> <span class="n">d_excess_liquid_zone</span>
            <span class="n">d_gain_max_cum</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">sclass</span><span class="p">):</span>
                <span class="n">d_gain_max_cum</span> <span class="o">+=</span> <span class="n">con</span><span class="o">.</span><span class="n">smax</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">sta</span><span class="o">.</span><span class="n">sp</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">sta</span><span class="o">.</span><span class="n">wc</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">d_gain_max_cum</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">d_fraction_gain_zone</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
                <span class="n">d_gain_max_cum</span> <span class="o">/</span> <span class="n">con</span><span class="o">.</span><span class="n">sclass</span> <span class="o">/</span> <span class="n">d_excess_total_zone</span><span class="p">,</span> <span class="mf">1.0</span>
            <span class="p">)</span>
            <span class="n">d_excess_frozen_zone_actual</span> <span class="o">=</span> <span class="n">d_fraction_gain_zone</span> <span class="o">*</span> <span class="n">d_excess_frozen_zone</span>
            <span class="n">d_excess_liquid_zone_actual</span> <span class="o">=</span> <span class="n">d_fraction_gain_zone</span> <span class="o">*</span> <span class="n">d_excess_liquid_zone</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">sclass</span><span class="p">):</span>
                <span class="n">d_fraction_gain_class</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">con</span><span class="o">.</span><span class="n">smax</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">sta</span><span class="o">.</span><span class="n">sp</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">sta</span><span class="o">.</span><span class="n">wc</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span>
                <span class="p">)</span> <span class="o">/</span> <span class="n">d_gain_max_cum</span>
                <span class="n">d_delta_sp_zone</span> <span class="o">=</span> <span class="n">d_fraction_gain_class</span> <span class="o">*</span> <span class="n">d_excess_frozen_zone_actual</span>
                <span class="n">d_delta_wc_zone</span> <span class="o">=</span> <span class="n">d_fraction_gain_class</span> <span class="o">*</span> <span class="n">d_excess_liquid_zone_actual</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">spg</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+=</span> <span class="n">d_delta_sp_zone</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">wcg</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+=</span> <span class="n">d_delta_wc_zone</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">sp</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="o">+=</span> <span class="n">d_delta_sp_zone</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">sclass</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">wc</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="o">+=</span> <span class="n">d_delta_wc_zone</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">sclass</span>
            <span class="n">d_excess_frozen_basin</span> <span class="o">-=</span> <span class="n">d_excess_frozen_zone_actual</span> <span class="o">*</span> <span class="n">der</span><span class="o">.</span><span class="n">relzoneareas</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
            <span class="n">d_excess_liquid_basin</span> <span class="o">-=</span> <span class="n">d_excess_liquid_zone_actual</span> <span class="o">*</span> <span class="n">der</span><span class="o">.</span><span class="n">relzoneareas</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">d_excess_frozen_basin</span> <span class="o">+</span> <span class="n">d_excess_liquid_basin</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="k">return</span>

        <span class="c1"># redistribute the still remaining excess evenly:</span>
        <span class="n">d_excess_frozen_land</span> <span class="o">=</span> <span class="n">d_excess_frozen_basin</span> <span class="o">/</span> <span class="n">der</span><span class="o">.</span><span class="n">rellandarea</span>
        <span class="n">d_excess_liquid_land</span> <span class="o">=</span> <span class="n">d_excess_liquid_basin</span> <span class="o">/</span> <span class="n">der</span><span class="o">.</span><span class="n">rellandarea</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">zonetype</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">!=</span> <span class="n">ILAKE</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">spg</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+=</span> <span class="n">d_excess_frozen_land</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">wcg</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+=</span> <span class="n">d_excess_liquid_land</span>
                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">sclass</span><span class="p">):</span>
                    <span class="n">sta</span><span class="o">.</span><span class="n">sp</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="o">+=</span> <span class="n">d_excess_frozen_land</span>
                    <span class="n">sta</span><span class="o">.</span><span class="n">wc</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="o">+=</span> <span class="n">d_excess_liquid_land</span>
        <span class="k">return</span></div>



<div class="viewcode-block" id="Calc_CFAct_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_CFAct_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_CFAct_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Adjust the day degree factor for snow to the current day of the year.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      :math:`CFAct = max( CFMax + f \cdot CFVar, 0 )`</span>

<span class="sd">      :math:`f = sin(2 \cdot  Pi \cdot (DOY + 1) / 366) / 2`</span>

<span class="sd">    Examples:</span>

<span class="sd">        We initialise five zones of different types but the same values for |CFMax| and</span>
<span class="sd">        |CFVar|.  For internal lakes, |CFAct| is always zero.  In all other cases,</span>
<span class="sd">        results are identical and follow a sinusoid curve throughout the year (of which</span>
<span class="sd">        we show only selected points as the maximum around June 20 and the minimum</span>
<span class="sd">        around December 20):</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(5)</span>
<span class="sd">        &gt;&gt;&gt; zonetype(ILAKE, GLACIER, FIELD, FOREST, SEALED)</span>
<span class="sd">        &gt;&gt;&gt; cfmax(4.0)</span>
<span class="sd">        &gt;&gt;&gt; cfvar(3.0)</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import UnitTest</span>
<span class="sd">        &gt;&gt;&gt; test = UnitTest(model=model,</span>
<span class="sd">        ...                 method=model.calc_cfact_v1,</span>
<span class="sd">        ...                 last_example=10,</span>
<span class="sd">        ...                 parseqs=(derived.doy, factors.cfact))</span>
<span class="sd">        &gt;&gt;&gt; test.nexts.doy = 0, 1, 170, 171, 172, 353, 354, 355, 364, 365</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. |                     doy |                                       cfact |</span>
<span class="sd">        -------------------------------------------------------------------------------</span>
<span class="sd">        |   1 |   0    0    0    0    0 | 0.0  1.264648  1.264648  1.264648  1.264648 |</span>
<span class="sd">        |   2 |   1    1    1    1    1 | 0.0  1.267289  1.267289  1.267289  1.267289 |</span>
<span class="sd">        |   3 | 170  170  170  170  170 | 0.0  2.749762  2.749762  2.749762  2.749762 |</span>
<span class="sd">        |   4 | 171  171  171  171  171 | 0.0  2.749976  2.749976  2.749976  2.749976 |</span>
<span class="sd">        |   5 | 172  172  172  172  172 | 0.0  2.749969  2.749969  2.749969  2.749969 |</span>
<span class="sd">        |   6 | 353  353  353  353  353 | 0.0  1.250238  1.250238  1.250238  1.250238 |</span>
<span class="sd">        |   7 | 354  354  354  354  354 | 0.0  1.250024  1.250024  1.250024  1.250024 |</span>
<span class="sd">        |   8 | 355  355  355  355  355 | 0.0  1.250031  1.250031  1.250031  1.250031 |</span>
<span class="sd">        |   9 | 364  364  364  364  364 | 0.0  1.260018  1.260018  1.260018  1.260018 |</span>
<span class="sd">        |  10 | 365  365  365  365  365 | 0.0  1.262224  1.262224  1.262224  1.262224 |</span>

<span class="sd">        Now, we convert all zones to type |FIELD| and vary |CFVar|.  If we set |CFVar|</span>
<span class="sd">        to zero, |CFAct| always equals |CFMax| (see zone one).  If we change the sign</span>
<span class="sd">        of |CFVar|, the sinusoid curve shifts a half year to reflect the southern</span>
<span class="sd">        hemisphere&#39;s annual cycle of radiation (compare zone two and three).  Finally,</span>
<span class="sd">        |Calc_CFAct_V1| prevents negative values of |CFAct| by setting them to zero</span>
<span class="sd">        (see zone four and five):</span>

<span class="sd">        &gt;&gt;&gt; zonetype(FIELD)</span>
<span class="sd">        &gt;&gt;&gt; cfvar(0.0, 3.0, -3.0, 10.0, -10.0)</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. |                     doy |                                       cfact |</span>
<span class="sd">        -------------------------------------------------------------------------------</span>
<span class="sd">        |   1 |   0    0    0    0    0 | 2.0  1.264648  2.735352       0.0  4.451173 |</span>
<span class="sd">        |   2 |   1    1    1    1    1 | 2.0  1.267289  2.732711       0.0  4.442371 |</span>
<span class="sd">        |   3 | 170  170  170  170  170 | 2.0  2.749762  1.250238  4.499206       0.0 |</span>
<span class="sd">        |   4 | 171  171  171  171  171 | 2.0  2.749976  1.250024  4.499919       0.0 |</span>
<span class="sd">        |   5 | 172  172  172  172  172 | 2.0  2.749969  1.250031  4.499896       0.0 |</span>
<span class="sd">        |   6 | 353  353  353  353  353 | 2.0  1.250238  2.749762       0.0  4.499206 |</span>
<span class="sd">        |   7 | 354  354  354  354  354 | 2.0  1.250024  2.749976       0.0  4.499919 |</span>
<span class="sd">        |   8 | 355  355  355  355  355 | 2.0  1.250031  2.749969       0.0  4.499896 |</span>
<span class="sd">        |   9 | 364  364  364  364  364 | 2.0  1.260018  2.739982       0.0  4.466606 |</span>
<span class="sd">        |  10 | 365  365  365  365  365 | 2.0  1.262224  2.737776       0.0  4.459252 |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneType</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">CFMax</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">CFVar</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fixed</span><span class="o">.</span><span class="n">Pi</span><span class="p">,)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_derived</span><span class="o">.</span><span class="n">DOY</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_factors</span><span class="o">.</span><span class="n">CFAct</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">d_factor</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span>
            <span class="mi">2</span> <span class="o">*</span> <span class="n">fix</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">doy</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">idx_sim</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">366</span> <span class="o">-</span> <span class="mf">1.39</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">zonetype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">!=</span> <span class="n">ILAKE</span><span class="p">:</span>
                <span class="n">fac</span><span class="o">.</span><span class="n">cfact</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">cfmax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">d_factor</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">cfvar</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fac</span><span class="o">.</span><span class="n">cfact</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_Melt_SP_WC_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_Melt_SP_WC_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_Melt_SP_WC_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the melting of the ice content within the snow layer and update both</span>
<span class="sd">    the snow layers&#39; ice and the water content.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      :math:`\frac{dSP}{dt} = - Melt`</span>

<span class="sd">      :math:`\frac{dWC}{dt} = + Melt`</span>

<span class="sd">      :math:`Melt = min(CFAct \cdot (TC - TTM), SP)`</span>

<span class="sd">    Examples:</span>

<span class="sd">        We initialise seven zones with the same threshold temperature and degree-day</span>
<span class="sd">        factor but different zone types and initial ice contents:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(7)</span>
<span class="sd">        &gt;&gt;&gt; sclass(1)</span>
<span class="sd">        &gt;&gt;&gt; zonetype(ILAKE, GLACIER, FIELD, FOREST, SEALED, SEALED, SEALED)</span>
<span class="sd">        &gt;&gt;&gt; derived.ttm = 2.0</span>
<span class="sd">        &gt;&gt;&gt; factors.cfact(2.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sp = 0.0, 10.0, 10.0, 10.0, 10.0, 5.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; states.wc = 2.0</span>

<span class="sd">        When the actual temperature equals the threshold temperature for melting and</span>
<span class="sd">        refreezing, no melting occurs, and the states remain unchanged:</span>

<span class="sd">        &gt;&gt;&gt; factors.tc = 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_melt_sp_wc_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.melt</span>
<span class="sd">        melt(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sp</span>
<span class="sd">        sp(0.0, 10.0, 10.0, 10.0, 10.0, 5.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.wc</span>
<span class="sd">        wc(0.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0)</span>

<span class="sd">        The same holds for an actual temperature lower than the threshold temperature:</span>

<span class="sd">        &gt;&gt;&gt; states.sp = 0.0, 10.0, 10.0, 10.0, 10.0, 5.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; states.wc = 2.0</span>
<span class="sd">        &gt;&gt;&gt; factors.tc = -1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_melt_sp_wc_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.melt</span>
<span class="sd">        melt(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sp</span>
<span class="sd">        sp(0.0, 10.0, 10.0, 10.0, 10.0, 5.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.wc</span>
<span class="sd">        wc(0.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0)</span>

<span class="sd">        With an actual temperature of 3°C above the threshold temperature, melting can</span>
<span class="sd">        occur. The actual melting is consistent with potential melting, except for the</span>
<span class="sd">        first zone, an internal lake, and the last two zones, for which potential</span>
<span class="sd">        melting exceeds the available frozen water content of the snow layer:</span>

<span class="sd">        &gt;&gt;&gt; states.sp = 0.0, 10.0, 10.0, 10.0, 10.0, 5.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; states.wc = 2.0</span>
<span class="sd">        &gt;&gt;&gt; factors.tc = 5.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_melt_sp_wc_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.melt</span>
<span class="sd">        melt(0.0, 6.0, 6.0, 6.0, 6.0, 5.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sp</span>
<span class="sd">        sp(0.0, 4.0, 4.0, 4.0, 4.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.wc</span>
<span class="sd">        wc(0.0, 8.0, 8.0, 8.0, 8.0, 7.0, 2.0)</span>

<span class="sd">        In the above examples, we did not divide the zones into snow classes. If we do</span>
<span class="sd">        so, method |Calc_Melt_SP_WC_V1| assumes a uniform distribution of the</span>
<span class="sd">        potential melting among the individual classes.  This assumption implies that</span>
<span class="sd">        if a single snow class does not provide enough frozen water, the actual melting</span>
<span class="sd">        of the total zone must be smaller than its potential melt rate:</span>

<span class="sd">        &gt;&gt;&gt; sclass(2)</span>
<span class="sd">        &gt;&gt;&gt; states.sp = [[0.0, 0.0, 1.0, 2.0, 3.0, 4.0, 0.0],</span>
<span class="sd">        ...              [0.0, 10.0, 10.0, 10.0, 10.0, 10.0, 0.0]]</span>
<span class="sd">        &gt;&gt;&gt; states.wc = [[0.0], [2.0]]</span>
<span class="sd">        &gt;&gt;&gt; model.calc_melt_sp_wc_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.melt</span>
<span class="sd">        melt([[0.0, 0.0, 1.0, 2.0, 3.0, 4.0, 0.0],</span>
<span class="sd">              [0.0, 6.0, 6.0, 6.0, 6.0, 6.0, 0.0]])</span>
<span class="sd">        &gt;&gt;&gt; states.sp</span>
<span class="sd">        sp([[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],</span>
<span class="sd">            [0.0, 4.0, 4.0, 4.0, 4.0, 4.0, 0.0]])</span>
<span class="sd">        &gt;&gt;&gt; states.wc</span>
<span class="sd">        wc([[0.0, 0.0, 1.0, 2.0, 3.0, 4.0, 0.0],</span>
<span class="sd">            [0.0, 8.0, 8.0, 8.0, 8.0, 8.0, 2.0]])</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">SClass</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneType</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_derived</span><span class="o">.</span><span class="n">TTM</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_factors</span><span class="o">.</span><span class="n">TC</span><span class="p">,</span> <span class="n">hland_factors</span><span class="o">.</span><span class="n">CFAct</span><span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_states</span><span class="o">.</span><span class="n">WC</span><span class="p">,</span> <span class="n">hland_states</span><span class="o">.</span><span class="n">SP</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">Melt</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">zonetype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">!=</span> <span class="n">ILAKE</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">fac</span><span class="o">.</span><span class="n">tc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">der</span><span class="o">.</span><span class="n">ttm</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                    <span class="n">d_potmelt</span> <span class="o">=</span> <span class="n">fac</span><span class="o">.</span><span class="n">cfact</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">fac</span><span class="o">.</span><span class="n">tc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">der</span><span class="o">.</span><span class="n">ttm</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">sclass</span><span class="p">):</span>
                        <span class="n">flu</span><span class="o">.</span><span class="n">melt</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">d_potmelt</span><span class="p">,</span> <span class="n">sta</span><span class="o">.</span><span class="n">sp</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span>
                        <span class="n">sta</span><span class="o">.</span><span class="n">sp</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">-=</span> <span class="n">flu</span><span class="o">.</span><span class="n">melt</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
                        <span class="n">sta</span><span class="o">.</span><span class="n">wc</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">melt</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">sclass</span><span class="p">):</span>
                        <span class="n">flu</span><span class="o">.</span><span class="n">melt</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">sclass</span><span class="p">):</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">melt</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                    <span class="n">sta</span><span class="o">.</span><span class="n">wc</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                    <span class="n">sta</span><span class="o">.</span><span class="n">sp</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_Refr_SP_WC_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_Refr_SP_WC_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_Refr_SP_WC_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate refreezing of the water content within the snow layer and</span>
<span class="sd">    update both the snow layers&#39; ice and the water content.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      :math:`\frac{dSP}{dt} =  + Refr`</span>

<span class="sd">      :math:`\frac{dWC}{dt} =  - Refr`</span>

<span class="sd">      :math:`Refr = min(cfr \cdot cfmax \cdot (TTM - TC), WC)`</span>

<span class="sd">    Examples:</span>

<span class="sd">        We initialise seven zones with the same threshold temperature, degree-day factor</span>
<span class="sd">        and refreezing coefficient but different zone types and initial states:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(7)</span>
<span class="sd">        &gt;&gt;&gt; sclass(1)</span>
<span class="sd">        &gt;&gt;&gt; zonetype(ILAKE, GLACIER, FIELD, FOREST, SEALED, SEALED, SEALED)</span>
<span class="sd">        &gt;&gt;&gt; cfmax(4.0)</span>
<span class="sd">        &gt;&gt;&gt; cfr(0.1)</span>
<span class="sd">        &gt;&gt;&gt; derived.ttm = 2.0</span>
<span class="sd">        &gt;&gt;&gt; states.sp = 2.0</span>
<span class="sd">        &gt;&gt;&gt; states.wc = 0.0, 1.0, 1.0, 1.0, 1.0, 0.5, 0.0</span>

<span class="sd">        Note that the assumed length of the simulation step is half a day.  Hence the</span>
<span class="sd">        effective value of the degree-day factor is not 4 but 2:</span>

<span class="sd">        &gt;&gt;&gt; cfmax</span>
<span class="sd">        cfmax(4.0)</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(cfmax.values[0])</span>
<span class="sd">        2.0</span>

<span class="sd">        When the actual temperature equals the threshold temperature for melting and</span>
<span class="sd">        refreezing, no refreezing occurs, and the states remain unchanged:</span>

<span class="sd">        &gt;&gt;&gt; factors.tc = 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_refr_sp_wc_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.refr</span>
<span class="sd">        refr(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sp</span>
<span class="sd">        sp(0.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0)</span>
<span class="sd">        &gt;&gt;&gt; states.wc</span>
<span class="sd">        wc(0.0, 1.0, 1.0, 1.0, 1.0, 0.5, 0.0)</span>

<span class="sd">        The same holds for an actual temperature higher than the threshold temperature:</span>

<span class="sd">        &gt;&gt;&gt; states.sp = 2.0</span>
<span class="sd">        &gt;&gt;&gt; states.wc = 0.0, 1.0, 1.0, 1.0, 1.0, 0.5, 0.0</span>
<span class="sd">        &gt;&gt;&gt; factors.tc = 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_refr_sp_wc_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.refr</span>
<span class="sd">        refr(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sp</span>
<span class="sd">        sp(0.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0)</span>
<span class="sd">        &gt;&gt;&gt; states.wc</span>
<span class="sd">        wc(0.0, 1.0, 1.0, 1.0, 1.0, 0.5, 0.0)</span>

<span class="sd">        With an actual temperature of 3°C above the threshold temperature, there is no</span>
<span class="sd">        refreezing:</span>

<span class="sd">        &gt;&gt;&gt; states.sp = 2.0</span>
<span class="sd">        &gt;&gt;&gt; states.wc = 0.0, 1.0, 1.0, 1.0, 1.0, 0.5, 0.0</span>
<span class="sd">        &gt;&gt;&gt; factors.tc = 5.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_refr_sp_wc_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.refr</span>
<span class="sd">        refr(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sp</span>
<span class="sd">        sp(0.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0)</span>
<span class="sd">        &gt;&gt;&gt; states.wc</span>
<span class="sd">        wc(0.0, 1.0, 1.0, 1.0, 1.0, 0.5, 0.0)</span>

<span class="sd">        With an actual temperature of 3°C below the threshold temperature, refreezing</span>
<span class="sd">        can occur. Actual refreezing is consistent with potential refreezing, except</span>
<span class="sd">        for the first zone, an internal lake, and the last two zones, for which</span>
<span class="sd">        potential refreezing exceeds the available liquid water content of the snow</span>
<span class="sd">        layer:</span>

<span class="sd">        &gt;&gt;&gt; states.sp = 2.0</span>
<span class="sd">        &gt;&gt;&gt; states.wc = 0.0, 1.0, 1.0, 1.0, 1.0, 0.5, 0.0</span>
<span class="sd">        &gt;&gt;&gt; factors.tc = -1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_refr_sp_wc_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.refr</span>
<span class="sd">        refr(0.0, 0.6, 0.6, 0.6, 0.6, 0.5, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sp</span>
<span class="sd">        sp(0.0, 2.6, 2.6, 2.6, 2.6, 2.5, 2.0)</span>
<span class="sd">        &gt;&gt;&gt; states.wc</span>
<span class="sd">        wc(0.0, 0.4, 0.4, 0.4, 0.4, 0.0, 0.0)</span>

<span class="sd">        In the above examples, we did not divide the zones into snow classes. If we do</span>
<span class="sd">        so, method |Calc_Refr_SP_WC_V1| assumes a uniform distribution of the potential</span>
<span class="sd">        refreezing among the individual classes.  This assumption implies that if a</span>
<span class="sd">        single snow class does not provide enough liquid water, the actual refreezing</span>
<span class="sd">        of the total zone must be smaller than its potential refreezing rate:</span>

<span class="sd">        &gt;&gt;&gt; sclass(2)</span>
<span class="sd">        &gt;&gt;&gt; states.sp = [[0.0], [2.0]]</span>
<span class="sd">        &gt;&gt;&gt; states.wc = [[0.0, 0.0, 0.1, 0.2, 0.3, 0.4, 0.0],</span>
<span class="sd">        ...              [0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.0]]</span>
<span class="sd">        &gt;&gt;&gt; model.calc_refr_sp_wc_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.refr</span>
<span class="sd">        refr([[0.0, 0.0, 0.1, 0.2, 0.3, 0.4, 0.0],</span>
<span class="sd">              [0.0, 0.6, 0.6, 0.6, 0.6, 0.6, 0.0]])</span>
<span class="sd">        &gt;&gt;&gt; states.sp</span>
<span class="sd">        sp([[0.0, 0.0, 0.1, 0.2, 0.3, 0.4, 0.0],</span>
<span class="sd">            [0.0, 2.6, 2.6, 2.6, 2.6, 2.6, 2.0]])</span>
<span class="sd">        &gt;&gt;&gt; states.wc</span>
<span class="sd">        wc([[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],</span>
<span class="sd">            [0.0, 0.4, 0.4, 0.4, 0.4, 0.4, 0.0]])</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">SClass</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneType</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">CFR</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">CFMax</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_derived</span><span class="o">.</span><span class="n">TTM</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_factors</span><span class="o">.</span><span class="n">TC</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_states</span><span class="o">.</span><span class="n">WC</span><span class="p">,</span> <span class="n">hland_states</span><span class="o">.</span><span class="n">SP</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">Refr</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">zonetype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">!=</span> <span class="n">ILAKE</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">fac</span><span class="o">.</span><span class="n">tc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">der</span><span class="o">.</span><span class="n">ttm</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                    <span class="n">d_potrefr</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cfr</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">cfmax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">ttm</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">fac</span><span class="o">.</span><span class="n">tc</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">sclass</span><span class="p">):</span>
                        <span class="n">flu</span><span class="o">.</span><span class="n">refr</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">d_potrefr</span><span class="p">,</span> <span class="n">sta</span><span class="o">.</span><span class="n">wc</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span>
                        <span class="n">sta</span><span class="o">.</span><span class="n">sp</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">refr</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
                        <span class="n">sta</span><span class="o">.</span><span class="n">wc</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">-=</span> <span class="n">flu</span><span class="o">.</span><span class="n">refr</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">sclass</span><span class="p">):</span>
                        <span class="n">flu</span><span class="o">.</span><span class="n">refr</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">sclass</span><span class="p">):</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">refr</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                    <span class="n">sta</span><span class="o">.</span><span class="n">wc</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                    <span class="n">sta</span><span class="o">.</span><span class="n">sp</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_In_WC_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_In_WC_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_In_WC_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the actual water release from the snow layer due to the exceedance of</span>
<span class="sd">    the snow layers&#39; capacity for (liquid) water.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      :math:`\frac{dWC}{dt} = -In`</span>

<span class="sd">      :math:`-In = max(WC - WHC \cdot SP, 0)`</span>

<span class="sd">    Examples:</span>

<span class="sd">        We initialise seven zones of different types with different frozen water</span>
<span class="sd">        contents of the snow layer and set the relative water holding capacity to 20 %:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(7)</span>
<span class="sd">        &gt;&gt;&gt; sclass(1)</span>
<span class="sd">        &gt;&gt;&gt; zonetype(ILAKE, GLACIER, FIELD, FOREST, SEALED, SEALED, SEALED)</span>
<span class="sd">        &gt;&gt;&gt; whc(0.2)</span>
<span class="sd">        &gt;&gt;&gt; states.sp = 0.0, 10.0, 10.0, 10.0, 10.0, 5.0, 0.0</span>

<span class="sd">        Also, we set the actual value of stand precipitation to 5 mm/d:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.tf = 5.0</span>

<span class="sd">        When there is no (liquid) water content in the snow layer, no water can be</span>
<span class="sd">        released:</span>

<span class="sd">        &gt;&gt;&gt; states.wc = 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_in_wc_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.in_</span>
<span class="sd">        in_(5.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.wc</span>
<span class="sd">        wc(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>

<span class="sd">        When there is a (liquid) water content in the snow layer, the water release</span>
<span class="sd">        depends on the frozen water content.  Note the special cases of the first zone</span>
<span class="sd">        being an internal lake, for which the snow routine does not apply, and of the</span>
<span class="sd">        last zone, which has no ice content and thus effectively is not a snow layer:</span>

<span class="sd">        &gt;&gt;&gt; states.wc = 5.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_in_wc_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.in_</span>
<span class="sd">        in_(5.0, 3.0, 3.0, 3.0, 3.0, 4.0, 5.0)</span>
<span class="sd">        &gt;&gt;&gt; states.wc</span>
<span class="sd">        wc(0.0, 2.0, 2.0, 2.0, 2.0, 1.0, 0.0)</span>

<span class="sd">        For a relative water holding capacity of zero, the snow layer releases all</span>
<span class="sd">        liquid water immediately:</span>

<span class="sd">        &gt;&gt;&gt; whc(0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.wc = 5.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_in_wc_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.in_</span>
<span class="sd">        in_(5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0)</span>
<span class="sd">        &gt;&gt;&gt; states.wc</span>
<span class="sd">        wc(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>

<span class="sd">        In the above examples, we did not divide the zones into snow classes. If we do</span>
<span class="sd">        so, method |Calc_In_WC_V1| averages the water release of all snow classes of</span>
<span class="sd">        each zone:</span>

<span class="sd">        &gt;&gt;&gt; sclass(2)</span>
<span class="sd">        &gt;&gt;&gt; whc(0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sp = 0.0, 10.0, 10.0, 10.0, 10.0, 5.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; states.wc = [[2.0], [3.0]]</span>
<span class="sd">        &gt;&gt;&gt; model.calc_in_wc_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.in_</span>
<span class="sd">        in_(5.0, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5)</span>
<span class="sd">        &gt;&gt;&gt; states.wc</span>
<span class="sd">        wc([[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],</span>
<span class="sd">            [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]])</span>

<span class="sd">        For the single lake zone, method |Calc_In_WC_V1| passed the stand precipitation</span>
<span class="sd">        directly to |In_| in all examples.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">SClass</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneType</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">WHC</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">TF</span><span class="p">,</span> <span class="n">hland_states</span><span class="o">.</span><span class="n">SP</span><span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_states</span><span class="o">.</span><span class="n">WC</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">In_</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">in_</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">zonetype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">!=</span> <span class="n">ILAKE</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">sclass</span><span class="p">):</span>
                    <span class="n">d_wc_old</span> <span class="o">=</span> <span class="n">sta</span><span class="o">.</span><span class="n">wc</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
                    <span class="n">sta</span><span class="o">.</span><span class="n">wc</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">d_wc_old</span><span class="p">,</span> <span class="n">con</span><span class="o">.</span><span class="n">whc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">sta</span><span class="o">.</span><span class="n">sp</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">in_</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">d_wc_old</span> <span class="o">-</span> <span class="n">sta</span><span class="o">.</span><span class="n">wc</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span> <span class="o">/</span> <span class="n">con</span><span class="o">.</span><span class="n">sclass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">in_</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">tf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">sclass</span><span class="p">):</span>
                    <span class="n">sta</span><span class="o">.</span><span class="n">wc</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_SWE_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_SWE_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_SWE_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the total snow water equivalent.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`SWE = SP + WC`</span>

<span class="sd">    Example:</span>

<span class="sd">        We initialise five zones of different types, each one with two snow classes.</span>
<span class="sd">        For internal lakes, |Calc_SWE_V1| generally sets the snow water equivalent to</span>
<span class="sd">        zero.  For all others, the given basic equation applies:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(5)</span>
<span class="sd">        &gt;&gt;&gt; sclass(2)</span>
<span class="sd">        &gt;&gt;&gt; zonetype(ILAKE, GLACIER, FIELD, FOREST, SEALED)</span>
<span class="sd">        &gt;&gt;&gt; states.wc = [[0.1, 0.2, 0.3, 0.4, 0.5], [0.6, 0.7, 0.8, 0.9, 1.0]]</span>
<span class="sd">        &gt;&gt;&gt; states.sp = [[1.0, 2.0, 3.0, 4.0, 5.0], [6.0, 7.0, 8.0, 9.0, 10.0]]</span>
<span class="sd">        &gt;&gt;&gt; model.calc_swe_v1()</span>
<span class="sd">        &gt;&gt;&gt; factors.swe</span>
<span class="sd">        swe([[0.0, 2.2, 3.3, 4.4, 5.5],</span>
<span class="sd">             [0.0, 7.7, 8.8, 9.9, 11.0]])</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">SClass</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneType</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_states</span><span class="o">.</span><span class="n">SP</span><span class="p">,</span> <span class="n">hland_states</span><span class="o">.</span><span class="n">WC</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_factors</span><span class="o">.</span><span class="n">SWE</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">zonetype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">!=</span> <span class="n">ILAKE</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">sclass</span><span class="p">):</span>
                    <span class="n">fac</span><span class="o">.</span><span class="n">swe</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">sta</span><span class="o">.</span><span class="n">sp</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">sta</span><span class="o">.</span><span class="n">wc</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">sclass</span><span class="p">):</span>
                    <span class="n">fac</span><span class="o">.</span><span class="n">swe</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_SR_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_SR_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_SR_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the sealed surface runoff.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      .. math::</span>
<span class="sd">        SR =</span>
<span class="sd">        \begin{cases}</span>
<span class="sd">        In &amp;|\ ZoneType_k = SEALED</span>
<span class="sd">        \\</span>
<span class="sd">        0 &amp;|\ ZoneType_k \neq SEALED</span>
<span class="sd">        \end{cases}</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(5)</span>
<span class="sd">        &gt;&gt;&gt; zonetype(ILAKE, GLACIER, FIELD, FOREST, SEALED)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.in_ = 1.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.sr = 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_sr_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.sr</span>
<span class="sd">        sr(0.0, 0.0, 0.0, 0.0, 1.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span> <span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneType</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">In_</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">SR</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">zonetype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">SEALED</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">sr</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">in_</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">sr</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_GAct_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_GAct_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_GAct_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Adjust the day degree factor for glacier ice to the current day of the year.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      :math:`GAct = max( GMelt + f \cdot GVar, 0 )`</span>

<span class="sd">      :math:`f = sin(2 \cdot  Pi \cdot (DOY + 1) / 366) / 2`</span>

<span class="sd">    Examples:</span>

<span class="sd">        The following examples agree with the ones |Calc_CFAct_V1|, except that method</span>
<span class="sd">        |Calc_GAct_V1| applies the given basic equations only for zones of types</span>
<span class="sd">        |GLACIER| and sets |GAct| to zero for all other zone types:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(5)</span>
<span class="sd">        &gt;&gt;&gt; zonetype(ILAKE, GLACIER, FIELD, FOREST, SEALED)</span>
<span class="sd">        &gt;&gt;&gt; gmelt(4.0)</span>
<span class="sd">        &gt;&gt;&gt; gvar(3.0)</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import UnitTest</span>
<span class="sd">        &gt;&gt;&gt; test = UnitTest(model=model,</span>
<span class="sd">        ...                 method=model.calc_gact_v1,</span>
<span class="sd">        ...                 last_example=10,</span>
<span class="sd">        ...                 parseqs=(derived.doy, factors.gact))</span>
<span class="sd">        &gt;&gt;&gt; test.nexts.doy = 0, 1, 170, 171, 172, 353, 354, 355, 364, 365</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. |                     doy |                          gact |</span>
<span class="sd">        -----------------------------------------------------------------</span>
<span class="sd">        |   1 |   0    0    0    0    0 | 0.0  1.264648  0.0  0.0   0.0 |</span>
<span class="sd">        |   2 |   1    1    1    1    1 | 0.0  1.267289  0.0  0.0   0.0 |</span>
<span class="sd">        |   3 | 170  170  170  170  170 | 0.0  2.749762  0.0  0.0   0.0 |</span>
<span class="sd">        |   4 | 171  171  171  171  171 | 0.0  2.749976  0.0  0.0   0.0 |</span>
<span class="sd">        |   5 | 172  172  172  172  172 | 0.0  2.749969  0.0  0.0   0.0 |</span>
<span class="sd">        |   6 | 353  353  353  353  353 | 0.0  1.250238  0.0  0.0   0.0 |</span>
<span class="sd">        |   7 | 354  354  354  354  354 | 0.0  1.250024  0.0  0.0   0.0 |</span>
<span class="sd">        |   8 | 355  355  355  355  355 | 0.0  1.250031  0.0  0.0   0.0 |</span>
<span class="sd">        |   9 | 364  364  364  364  364 | 0.0  1.260018  0.0  0.0   0.0 |</span>
<span class="sd">        |  10 | 365  365  365  365  365 | 0.0  1.262224  0.0  0.0   0.0 |</span>

<span class="sd">        &gt;&gt;&gt; zonetype(GLACIER)</span>
<span class="sd">        &gt;&gt;&gt; gvar(0.0, 3.0, -3.0, 10.0, -10.0)</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. |                     doy |                                        gact |</span>
<span class="sd">        -------------------------------------------------------------------------------</span>
<span class="sd">        |   1 |   0    0    0    0    0 | 2.0  1.264648  2.735352       0.0  4.451173 |</span>
<span class="sd">        |   2 |   1    1    1    1    1 | 2.0  1.267289  2.732711       0.0  4.442371 |</span>
<span class="sd">        |   3 | 170  170  170  170  170 | 2.0  2.749762  1.250238  4.499206       0.0 |</span>
<span class="sd">        |   4 | 171  171  171  171  171 | 2.0  2.749976  1.250024  4.499919       0.0 |</span>
<span class="sd">        |   5 | 172  172  172  172  172 | 2.0  2.749969  1.250031  4.499896       0.0 |</span>
<span class="sd">        |   6 | 353  353  353  353  353 | 2.0  1.250238  2.749762       0.0  4.499206 |</span>
<span class="sd">        |   7 | 354  354  354  354  354 | 2.0  1.250024  2.749976       0.0  4.499919 |</span>
<span class="sd">        |   8 | 355  355  355  355  355 | 2.0  1.250031  2.749969       0.0  4.499896 |</span>
<span class="sd">        |   9 | 364  364  364  364  364 | 2.0  1.260018  2.739982       0.0  4.466606 |</span>
<span class="sd">        |  10 | 365  365  365  365  365 | 2.0  1.262224  2.737776       0.0  4.459252 |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneType</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">GMelt</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">GVar</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fixed</span><span class="o">.</span><span class="n">Pi</span><span class="p">,)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_derived</span><span class="o">.</span><span class="n">DOY</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_factors</span><span class="o">.</span><span class="n">GAct</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">d_factor</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span>
            <span class="mi">2</span> <span class="o">*</span> <span class="n">fix</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">doy</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">idx_sim</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">366</span> <span class="o">-</span> <span class="mf">1.39</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">zonetype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">GLACIER</span><span class="p">:</span>
                <span class="n">fac</span><span class="o">.</span><span class="n">gact</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">gmelt</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">d_factor</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">gvar</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fac</span><span class="o">.</span><span class="n">gact</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_GlMelt_In_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_GlMelt_In_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_GlMelt_In_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the melting of non-snow-covered glaciers and add it to the water</span>
<span class="sd">    release of the snow module.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      .. math::</span>
<span class="sd">        GlMelt =</span>
<span class="sd">        \begin{cases}</span>
<span class="sd">        max(GMelt \cdot (TC - TTM), 0) &amp;|\ SP = 0</span>
<span class="sd">        \\</span>
<span class="sd">        0 &amp;|\ SP &gt; 0</span>
<span class="sd">        \end{cases}</span>

<span class="sd">    Examples:</span>

<span class="sd">        We prepare eight zones. The first four zones are no glaciers, a snow layer</span>
<span class="sd">        covers the sixth zone, and the last two zones actual temperature is not above</span>
<span class="sd">        the threshold temperature.  Hence, glacier melting occurs only in the fifth</span>
<span class="sd">        zone:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(8)</span>
<span class="sd">        &gt;&gt;&gt; sclass(1)</span>
<span class="sd">        &gt;&gt;&gt; zonetype(FIELD, FOREST, ILAKE, SEALED, GLACIER, GLACIER, GLACIER, GLACIER)</span>
<span class="sd">        &gt;&gt;&gt; derived.ttm(2.0)</span>
<span class="sd">        &gt;&gt;&gt; factors.tc = 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 2.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; factors.gact = 2.0</span>
<span class="sd">        &gt;&gt;&gt; states.sp = 0.0, 0.0, 0.0, 0.0, 0.0, 0.1, 0.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.in_ = 3.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_glmelt_in_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.glmelt</span>
<span class="sd">        glmelt(0.0, 0.0, 0.0, 0.0, 2.0, 0.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.in_</span>
<span class="sd">        in_(3.0, 3.0, 3.0, 3.0, 5.0, 3.0, 3.0, 3.0)</span>

<span class="sd">        In the above examples, we did not divide the zones into snow classes. If we do</span>
<span class="sd">        so, method |Calc_GlMelt_In_V1| sums the glacier melt of all non-snow-covered</span>
<span class="sd">        snow classes of each glacier zone. This assumption implies that if there is a</span>
<span class="sd">        single snow-covered snow class, the actual glacier melting of the total zone</span>
<span class="sd">        must be smaller than its potential melt rate:</span>

<span class="sd">        &gt;&gt;&gt; sclass(2)</span>
<span class="sd">        &gt;&gt;&gt; factors.tc = 3.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.in_ = 3.0</span>
<span class="sd">        &gt;&gt;&gt; states.sp = [[0.0, 0.0, 0.1, 0.1, 0.0, 0.0, 0.1, 0.1],</span>
<span class="sd">        ...              [0.0, 0.1, 0.0, 0.1, 0.0, 0.1, 0.0, 0.1]]</span>
<span class="sd">        &gt;&gt;&gt; model.calc_glmelt_in_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.glmelt</span>
<span class="sd">        glmelt(0.0, 0.0, 0.0, 0.0, 2.0, 1.0, 1.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.in_</span>
<span class="sd">        in_(3.0, 3.0, 3.0, 3.0, 5.0, 4.0, 4.0, 3.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">SClass</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneType</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_derived</span><span class="o">.</span><span class="n">TTM</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_states</span><span class="o">.</span><span class="n">SP</span><span class="p">,</span> <span class="n">hland_factors</span><span class="o">.</span><span class="n">TC</span><span class="p">,</span> <span class="n">hland_factors</span><span class="o">.</span><span class="n">GAct</span><span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">In_</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">GlMelt</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">glmelt</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">zonetype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">GLACIER</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">fac</span><span class="o">.</span><span class="n">tc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">der</span><span class="o">.</span><span class="n">ttm</span><span class="p">[</span><span class="n">k</span><span class="p">]):</span>
                <span class="n">d_glmeltpot</span> <span class="o">=</span> <span class="n">fac</span><span class="o">.</span><span class="n">gact</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">con</span><span class="o">.</span><span class="n">sclass</span> <span class="o">*</span> <span class="p">(</span><span class="n">fac</span><span class="o">.</span><span class="n">tc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">der</span><span class="o">.</span><span class="n">ttm</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">sclass</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">sp</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
                        <span class="n">flu</span><span class="o">.</span><span class="n">glmelt</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">d_glmeltpot</span>
                        <span class="n">flu</span><span class="o">.</span><span class="n">in_</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">d_glmeltpot</span></div>



<div class="viewcode-block" id="Calc_R_SM_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_R_SM_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_R_SM_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate effective precipitation and update the soil moisture.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      :math:`\frac{dSM}{dt} = IN - R`</span>

<span class="sd">      :math:`R = IN \cdot \left( \frac{SM}{FC} \right)^{Beta}`</span>


<span class="sd">    Examples:</span>

<span class="sd">        We initialise seven zones of different types.  The field capacity of all fields</span>
<span class="sd">        and forests is 200 mm, the input of each zone is 10 mm:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(7)</span>
<span class="sd">        &gt;&gt;&gt; zonetype(ILAKE, GLACIER, SEALED, FIELD, FIELD, FOREST, FOREST)</span>
<span class="sd">        &gt;&gt;&gt; fc(200.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.in_ = 10.0</span>

<span class="sd">        With the typical nonlinearity parameter value of 2, relative soil moisture of</span>
<span class="sd">        50 % (zones five and six) results in a discharge coefficient of 25 %.  For</span>
<span class="sd">        a completely dried (zone four) or saturated soil (zone seven), the discharge</span>
<span class="sd">        coefficient is generally 0 % and 100 %, respectively.  Glaciers, internal lakes</span>
<span class="sd">        and sealed areas always route 100% of their input as effective precipitation:</span>

<span class="sd">        &gt;&gt;&gt; beta(2.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sm = 0.0, 0.0, 0.0, 0.0, 100.0, 100.0, 200.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_r_sm_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.r</span>
<span class="sd">        r(10.0, 10.0, 10.0, 0.0, 2.5, 2.5, 10.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sm</span>
<span class="sd">        sm(0.0, 0.0, 0.0, 10.0, 107.5, 107.5, 200.0)</span>

<span class="sd">        By decreasing the nonlinearity parameter, the discharge coefficient increases.</span>
<span class="sd">        A parameter value of zero leads to a discharge coefficient of 100 % for any</span>
<span class="sd">        soil moisture:</span>

<span class="sd">        &gt;&gt;&gt; beta(0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sm = 0.0, 0.0, 0.0, 100.0, 100.0, 0.0, 200.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_r_sm_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.r</span>
<span class="sd">        r(10.0, 10.0, 10.0, 10.0, 10.0, 10.0, 10.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sm</span>
<span class="sd">        sm(0.0, 0.0, 0.0, 100.0, 100.0, 0.0, 200.0)</span>

<span class="sd">        Also, with a field capacity of zero, the discharge coefficient always equates</span>
<span class="sd">        to 100 %:</span>

<span class="sd">        &gt;&gt;&gt; fc(0.0)</span>
<span class="sd">        &gt;&gt;&gt; beta(2.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sm = 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_r_sm_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.r</span>
<span class="sd">        r(10.0, 10.0, 10.0, 10.0, 10.0, 10.0, 10.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sm</span>
<span class="sd">        sm(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneType</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">FC</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">Beta</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">In_</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_states</span><span class="o">.</span><span class="n">SM</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">R</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">zonetype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">FIELD</span><span class="p">,</span> <span class="n">FOREST</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">fc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">in_</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">sm</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">con</span><span class="o">.</span><span class="n">fc</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">**</span> <span class="n">con</span><span class="o">.</span><span class="n">beta</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">sta</span><span class="o">.</span><span class="n">sm</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">in_</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">fc</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">in_</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">sm</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">in_</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">in_</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">sm</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_CF_SM_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_CF_SM_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_CF_SM_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate capillary flow and update the soil moisture.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      :math:`\frac{dSM}{dt} = CF`</span>

<span class="sd">      :math:`CF = CFLUX \cdot (1 - \frac{SM}{FC})`</span>

<span class="sd">    Examples:</span>

<span class="sd">        We initialise seven zones of different types.  For all fields and forests, the</span>
<span class="sd">        field capacity is 200 mm and the maximum capillary flow rate is 4 mm/d:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(7)</span>
<span class="sd">        &gt;&gt;&gt; zonetype(ILAKE, GLACIER, SEALED, FIELD, FOREST, FOREST, FOREST)</span>
<span class="sd">        &gt;&gt;&gt; fc(200.0)</span>
<span class="sd">        &gt;&gt;&gt; cflux(4.0)</span>

<span class="sd">        Note that the assumed length of the simulation step is only half a day.  Hence</span>
<span class="sd">        the maximum capillary flow per simulation step is 2 instead of 4:</span>

<span class="sd">        &gt;&gt;&gt; cflux</span>
<span class="sd">        cflux(4.0)</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(cflux.values[0])</span>
<span class="sd">        2.0</span>

<span class="sd">        For fields and forests, the actual capillary return flow depends only on the</span>
<span class="sd">        relative soil moisture deficit, provided that the upper zone layer stores</span>
<span class="sd">        enough water or that enough &quot;routable&quot; effective precipitation is available:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.r = 0.0</span>
<span class="sd">        &gt;&gt;&gt; states.sm = 0.0, 0.0, 0.0, 100.0, 100.0, 0.0, 200.0</span>
<span class="sd">        &gt;&gt;&gt; states.uz = 20.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_cf_sm_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.cf</span>
<span class="sd">        cf(0.0, 0.0, 0.0, 1.0, 1.0, 2.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sm</span>
<span class="sd">        sm(0.0, 0.0, 0.0, 101.0, 101.0, 2.0, 200.0)</span>

<span class="sd">        &gt;&gt;&gt; states.sm = 0.0, 0.0, 0.0, 100.0, 100.0, 0.0, 200.0</span>
<span class="sd">        &gt;&gt;&gt; states.uz = 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_cf_sm_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.cf</span>
<span class="sd">        cf(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sm</span>
<span class="sd">        sm(0.0, 0.0, 0.0, 100.0, 100.0, 0.0, 200.0)</span>

<span class="sd">        If the upper zone layer is empty and no effective precipitation is available,</span>
<span class="sd">        capillary flow is zero:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.r = 0.0</span>
<span class="sd">        &gt;&gt;&gt; states.sm = 0.0, 0.0, 0.0, 100.0, 100.0, 0.0, 200.0</span>
<span class="sd">        &gt;&gt;&gt; states.uz = 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_cf_sm_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.cf</span>
<span class="sd">        cf(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sm</span>
<span class="sd">        sm(0.0, 0.0, 0.0, 100.0, 100.0, 0.0, 200.0)</span>

<span class="sd">        In the following example, both the upper zone layer and effective precipitation</span>
<span class="sd">        provide water for the capillary flow but less than the maximum flow rate times</span>
<span class="sd">        the relative soil moisture:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.r = 0.1</span>
<span class="sd">        &gt;&gt;&gt; states.sm = 0.0, 0.0, 0.0, 100.0, 100.0, 0.0, 200.0</span>
<span class="sd">        &gt;&gt;&gt; states.uz = 0.2</span>
<span class="sd">        &gt;&gt;&gt; model.calc_cf_sm_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.cf</span>
<span class="sd">        cf(0.0, 0.0, 0.0, 0.3, 0.3, 0.3, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sm</span>
<span class="sd">        sm(0.0, 0.0, 0.0, 100.3, 100.3, 0.3, 200.0)</span>

<span class="sd">        Even unrealistic high maximum capillary flow rates do not result in overfilled</span>
<span class="sd">        soils:</span>

<span class="sd">        &gt;&gt;&gt; cflux(1000.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.r = 200.0</span>
<span class="sd">        &gt;&gt;&gt; states.sm = 0.0, 0.0, 0.0, 100.0, 100.0, 0.0, 200.0</span>
<span class="sd">        &gt;&gt;&gt; states.uz = 200.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_cf_sm_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.cf</span>
<span class="sd">        cf(0.0, 0.0, 0.0, 100.0, 100.0, 200.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sm</span>
<span class="sd">        sm(0.0, 0.0, 0.0, 200.0, 200.0, 200.0, 200.0)</span>

<span class="sd">        For soils with zero field capacity, capillary flow is always zero:</span>

<span class="sd">        &gt;&gt;&gt; fc(0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sm = 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_cf_sm_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.cf</span>
<span class="sd">        cf(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sm</span>
<span class="sd">        sm(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneType</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">FC</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">CFlux</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">R</span><span class="p">,</span> <span class="n">hland_states</span><span class="o">.</span><span class="n">UZ</span><span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_states</span><span class="o">.</span><span class="n">SM</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">CF</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">zonetype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">FIELD</span><span class="p">,</span> <span class="n">FOREST</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">fc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">cf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cflux</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">sta</span><span class="o">.</span><span class="n">sm</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">con</span><span class="o">.</span><span class="n">fc</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">cf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">cf</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">sta</span><span class="o">.</span><span class="n">uz</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">cf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">cf</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">con</span><span class="o">.</span><span class="n">fc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">sta</span><span class="o">.</span><span class="n">sm</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">cf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">sm</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">cf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">cf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">sm</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_EA_SM_AETModel_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_EA_SM_AETModel_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_EA_SM_AETModel_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Let a submodel that follows the |AETModel_V1| submodel interface calculate</span>
<span class="sd">    soil evapotranspiration and adjust the soil water content.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`\frac{dSM_i}{dt} = -EA_i`</span>

<span class="sd">    Examples:</span>

<span class="sd">        We build an example based on |evap_aet_hbv96| for calculating soil</span>
<span class="sd">        evapotranspiration:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland_96 import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(5)</span>
<span class="sd">        &gt;&gt;&gt; zonetype(GLACIER, SEALED, FIELD, FOREST, ILAKE)</span>
<span class="sd">        &gt;&gt;&gt; area(1.0)</span>
<span class="sd">        &gt;&gt;&gt; zonearea(0.05, 0.1, 0.2, 0.3, 0.35)</span>
<span class="sd">        &gt;&gt;&gt; zonez(5.0)</span>
<span class="sd">        &gt;&gt;&gt; fc(50.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.r = 0.5</span>
<span class="sd">        &gt;&gt;&gt; with model.add_aetmodel_v1(&quot;evap_aet_hbv96&quot;):</span>
<span class="sd">        ...     soilmoisturelimit(0.0)</span>
<span class="sd">        ...     excessreduction(field=0.5, forest=0.0)</span>

<span class="sd">        |Calc_EA_SM_AETModel_V1| uses the flux returned by the submodel to adjust |SM|:</span>

<span class="sd">        &gt;&gt;&gt; model.aetmodel.sequences.fluxes.potentialinterceptionevaporation = 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.aetmodel.sequences.fluxes.potentialsoilevapotranspiration = 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.aetmodel.sequences.fluxes.interceptionevaporation = 1.0</span>
<span class="sd">        &gt;&gt;&gt; states.sm = 3.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_ea_sm_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.ea</span>
<span class="sd">        ea(0.0, 0.0, 0.5, 1.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sm</span>
<span class="sd">        sm(0.0, 0.0, 2.5, 2.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.r</span>
<span class="sd">        r(0.5, 0.5, 0.5, 0.5, 0.5)</span>

<span class="sd">        |Calc_EA_SM_AETModel_V1| eventually reduces |EA| so that |SM| does not become</span>
<span class="sd">        negative:</span>

<span class="sd">        &gt;&gt;&gt; model.aetmodel.sequences.fluxes.potentialinterceptionevaporation = 5.0</span>
<span class="sd">        &gt;&gt;&gt; model.aetmodel.sequences.fluxes.potentialsoilevapotranspiration = 5.0</span>
<span class="sd">        &gt;&gt;&gt; model.aetmodel.sequences.fluxes.interceptionevaporation = 5.0</span>
<span class="sd">        &gt;&gt;&gt; states.sm = 3.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_ea_sm_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.ea</span>
<span class="sd">        ea(0.0, 0.0, 2.5, 3.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sm</span>
<span class="sd">        sm(0.0, 0.0, 0.5, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.r</span>
<span class="sd">        r(0.5, 0.5, 0.5, 0.5, 0.5)</span>

<span class="sd">        |Calc_EA_SM_AETModel_V1| converts any amounts of condensation (negative |EA|)</span>
<span class="sd">        that would cause soil water to exceed field capacity to the effective soil</span>
<span class="sd">        response (|R|):</span>

<span class="sd">        &gt;&gt;&gt; model.aetmodel.sequences.fluxes.potentialinterceptionevaporation = -5.0</span>
<span class="sd">        &gt;&gt;&gt; model.aetmodel.sequences.fluxes.potentialsoilevapotranspiration = -5.0</span>
<span class="sd">        &gt;&gt;&gt; model.aetmodel.sequences.fluxes.interceptionevaporation = -5.0</span>
<span class="sd">        &gt;&gt;&gt; states.sm = 47.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_ea_sm_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.ea</span>
<span class="sd">        ea(0.0, 0.0, -2.5, -5.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sm</span>
<span class="sd">        sm(0.0, 0.0, 49.5, 50.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.r</span>
<span class="sd">        r(0.5, 0.5, 0.5, 2.5, 0.5)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneType</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">FC</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_states</span><span class="o">.</span><span class="n">SM</span><span class="p">,</span> <span class="n">hland_fluxes</span><span class="o">.</span><span class="n">R</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">EA</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">submodel</span><span class="p">:</span> <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">submodel</span><span class="o">.</span><span class="n">determine_soilevapotranspiration</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">zonetype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">FIELD</span><span class="p">,</span> <span class="n">FOREST</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">ea</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">submodel</span><span class="o">.</span><span class="n">get_soilevapotranspiration</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">sta</span><span class="o">.</span><span class="n">sm</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">sm</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-=</span> <span class="n">flu</span><span class="o">.</span><span class="n">ea</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">sm</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">con</span><span class="o">.</span><span class="n">fc</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">sta</span><span class="o">.</span><span class="n">sm</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">fc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                    <span class="n">sta</span><span class="o">.</span><span class="n">sm</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">fc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">ea</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">sm</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_EA_SM_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_EA_SM_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_EA_SM_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Let a submodel that follows the |AETModel_V1| submodel interface calculate soil</span>
<span class="sd">    evapotranspiration and adjust the soil water content.&quot;&quot;&quot;</span>

    <span class="n">SUBMODELINTERFACES</span> <span class="o">=</span> <span class="p">(</span><span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="p">,)</span>
    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Calc_EA_SM_AETModel_V1</span><span class="p">,)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneType</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">FC</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_states</span><span class="o">.</span><span class="n">SM</span><span class="p">,</span> <span class="n">hland_fluxes</span><span class="o">.</span><span class="n">R</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">EA</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">aetmodel_typeid</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">calc_ea_sm_aetmodel_v1</span><span class="p">(</span>
                <span class="n">cast</span><span class="p">(</span><span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">aetmodel</span><span class="p">)</span>
            <span class="p">)</span></div>

        <span class="c1"># ToDo:</span>
        <span class="c1">#     else:</span>
        <span class="c1">#         assert_never(model.petmodel)</span>


<div class="viewcode-block" id="Calc_InUZ_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_InUZ_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_InUZ_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Accumulate the total inflow into the upper zone layer.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      .. math::</span>
<span class="sd">        InUZ = \sum_{k=1}^{NmbZones} \frac{RelZoneAreas_k}{RelUpperZoneArea} \cdot</span>
<span class="sd">        \begin{cases}</span>
<span class="sd">        R-CF &amp;|\ ZoneType_k \in \{FIELD, FOREST, GLACIER \}</span>
<span class="sd">        \\</span>
<span class="sd">        0 &amp;|\ ZoneType_k \notin \{FIELD, FOREST, GLACIER \}</span>
<span class="sd">        \end{cases}</span>

<span class="sd">    Examples:</span>

<span class="sd">        We initialise five zones of different land-use types and sizes.  Method</span>
<span class="sd">        |Calc_InUZ_V1| takes only those of type |FIELD|, |FOREST|, and |GLACIER| into</span>
<span class="sd">        account:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(5)</span>
<span class="sd">        &gt;&gt;&gt; zonetype(FIELD, FOREST, ILAKE, GLACIER, SEALED)</span>
<span class="sd">        &gt;&gt;&gt; derived.relzoneareas = 0.25, 0.2, 0.4, 0.05, 0.1</span>
<span class="sd">        &gt;&gt;&gt; derived.relupperzonearea = 0.5</span>
<span class="sd">        &gt;&gt;&gt; fluxes.r = 2.0, 4.0, 1.0, 6.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.cf = 1.0, 2.0, 0.5, 3.0, 0.5</span>
<span class="sd">        &gt;&gt;&gt; model.calc_inuz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.inuz</span>
<span class="sd">        inuz(1.6)</span>

<span class="sd">        Internal lakes and sealed areas do not contribute to the upper zone layer.</span>
<span class="sd">        Hence, for a subbasin consisting only of such zones, |InUZ| is zero:</span>

<span class="sd">        &gt;&gt;&gt; zonetype(ILAKE, ILAKE, ILAKE, SEALED, SEALED)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_inuz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.inuz</span>
<span class="sd">        inuz(0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span> <span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneType</span><span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_derived</span><span class="o">.</span><span class="n">RelZoneAreas</span><span class="p">,</span> <span class="n">hland_derived</span><span class="o">.</span><span class="n">RelUpperZoneArea</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">R</span><span class="p">,</span> <span class="n">hland_fluxes</span><span class="o">.</span><span class="n">CF</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">InUZ</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">inuz</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">zonetype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">FIELD</span><span class="p">,</span> <span class="n">FOREST</span><span class="p">,</span> <span class="n">GLACIER</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">inuz</span> <span class="o">+=</span> <span class="p">(</span>
                    <span class="n">der</span><span class="o">.</span><span class="n">relzoneareas</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">der</span><span class="o">.</span><span class="n">relupperzonearea</span> <span class="o">*</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">cf</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="p">)</span></div>



<div class="viewcode-block" id="Calc_SUZ_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_SUZ_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_SUZ_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Add the effective precipitation to the upper storage reservoir.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`\frac{SUZ}{dt} = R`</span>

<span class="sd">    Example:</span>

<span class="sd">        For internal lakes and sealed areas, method |Calc_SUZ_V1| always sets |SUZ| to</span>
<span class="sd">        zero:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(4)</span>
<span class="sd">        &gt;&gt;&gt; zonetype(FIELD, ILAKE, GLACIER, SEALED)</span>
<span class="sd">        &gt;&gt;&gt; states.suz = 1.0, 0.0, 2.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.r = 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_suz_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.suz</span>
<span class="sd">        suz(3.0, 0.0, 4.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span> <span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneType</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">R</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_states</span><span class="o">.</span><span class="n">SUZ</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">zonetype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">FIELD</span><span class="p">,</span> <span class="n">FOREST</span><span class="p">,</span> <span class="n">GLACIER</span><span class="p">):</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">suz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">suz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_ContriArea_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_ContriArea_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_ContriArea_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Determine the relative size of the contributing area of the whole subbasin.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`ContriArea = \left( \frac{SM}{FC} \right)^{Beta}`</span>

<span class="sd">    Examples:</span>

<span class="sd">        We initialise five zones. Method |Calc_ContriArea_V1| takes only the first two</span>
<span class="sd">        zones of type field and forest into account (even though glaciers also</span>
<span class="sd">        contribute to the inflow of the upper zone layer):</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(5)</span>
<span class="sd">        &gt;&gt;&gt; zonetype(FIELD, FOREST, GLACIER, ILAKE, SEALED)</span>
<span class="sd">        &gt;&gt;&gt; beta(2.0)</span>
<span class="sd">        &gt;&gt;&gt; fc(200.0)</span>
<span class="sd">        &gt;&gt;&gt; resparea(True)</span>
<span class="sd">        &gt;&gt;&gt; derived.relzoneareas(1.0/6.0, 2.0/6.0, 1.0/6.0, 1.0/6.0, 1.0/6.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.relsoilarea(0.5)</span>

<span class="sd">        With relative soil moisture of 100 % in the whole subbasin, the contributing</span>
<span class="sd">        area is also 100 %:</span>

<span class="sd">        &gt;&gt;&gt; states.sm = 200.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_contriarea_v1()</span>
<span class="sd">        &gt;&gt;&gt; factors.contriarea</span>
<span class="sd">        contriarea(1.0)</span>

<span class="sd">        Relative soil moistures of 0 % result in a contributing area of 0 %:</span>

<span class="sd">        &gt;&gt;&gt; states.sm = 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_contriarea_v1()</span>
<span class="sd">        &gt;&gt;&gt; factors.contriarea</span>
<span class="sd">        contriarea(0.0)</span>

<span class="sd">        For the given value 2 of the nonlinearity parameter |Beta|, soil moisture of</span>
<span class="sd">        50 % corresponds to contributing area of 25 %:</span>

<span class="sd">        &gt;&gt;&gt; states.sm = 100.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_contriarea_v1()</span>
<span class="sd">        &gt;&gt;&gt; factors.contriarea</span>
<span class="sd">        contriarea(0.25)</span>

<span class="sd">        Setting the |RespArea| option to |False|, the soil area (total area of all</span>
<span class="sd">        field and forest zones in the subbasin) to zero, or all field capacities to</span>
<span class="sd">        zero, results in contributing area values of 100 %:</span>

<span class="sd">        &gt;&gt;&gt; resparea(False)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_contriarea_v1()</span>
<span class="sd">        &gt;&gt;&gt; factors.contriarea</span>
<span class="sd">        contriarea(1.0)</span>

<span class="sd">        &gt;&gt;&gt; resparea(True)</span>
<span class="sd">        &gt;&gt;&gt; derived.relsoilarea(0.0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_contriarea_v1()</span>
<span class="sd">        &gt;&gt;&gt; factors.contriarea</span>
<span class="sd">        contriarea(1.0)</span>

<span class="sd">        &gt;&gt;&gt; derived.relsoilarea(0.5)</span>
<span class="sd">        &gt;&gt;&gt; fc(0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sm = 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_contriarea_v1()</span>
<span class="sd">        &gt;&gt;&gt; factors.contriarea</span>
<span class="sd">        contriarea(1.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">RespArea</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneType</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">FC</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">Beta</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_derived</span><span class="o">.</span><span class="n">RelZoneAreas</span><span class="p">,</span> <span class="n">hland_derived</span><span class="o">.</span><span class="n">RelSoilArea</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_states</span><span class="o">.</span><span class="n">SM</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_factors</span><span class="o">.</span><span class="n">ContriArea</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span><span class="o">.</span><span class="n">contriarea</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">resparea</span> <span class="ow">and</span> <span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">relsoilarea</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">zonetype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">FIELD</span><span class="p">,</span> <span class="n">FOREST</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">fc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                        <span class="n">d_weight</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">relzoneareas</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">der</span><span class="o">.</span><span class="n">relsoilarea</span>
                        <span class="n">fac</span><span class="o">.</span><span class="n">contriarea</span> <span class="o">*=</span> <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">sm</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">con</span><span class="o">.</span><span class="n">fc</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">**</span> <span class="n">d_weight</span>
            <span class="n">fac</span><span class="o">.</span><span class="n">contriarea</span> <span class="o">**=</span> <span class="n">con</span><span class="o">.</span><span class="n">beta</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>



<div class="viewcode-block" id="Calc_Q0_Perc_UZ_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_Q0_Perc_UZ_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_Q0_Perc_UZ_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the percolation and direct runoff leaving the upper zone storage</span>
<span class="sd">    and update it accordingly.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      :math:`\frac{dUZ}{dt} = InUZ - Perc - Q0`</span>

<span class="sd">      :math:`Perc = PercMax \cdot ContriArea`</span>

<span class="sd">      :math:`Q0 = K \cdot \left( \frac{UZ}{ContriArea} \right)^{1+Alpha}`</span>

<span class="sd">    Note that the system behaviour of this method depends strongly on the</span>
<span class="sd">    specifications of the options |RespArea| and |RecStep|.</span>

<span class="sd">    Examples:</span>

<span class="sd">        First, we prepare a small helper function for checking if method</span>
<span class="sd">        |Calc_Q0_Perc_UZ_V1| always complies with the water balance equation, assuming</span>
<span class="sd">        an initial content of the upper zone storage of 1 mm:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; def check():</span>
<span class="sd">        ...     error = 1.0 + fluxes.inuz - fluxes.perc - fluxes.q0 - states.uz</span>
<span class="sd">        ...     assert round(error, 12) == 0</span>

<span class="sd">        The upper zone layer routine is an exception compared to the other subroutines</span>
<span class="sd">        of |hland| regarding numerical accuracy.  Method |Calc_Q0_Perc_UZ_V1| divides</span>
<span class="sd">        each simulation step into substeps and solves each substep with the explicit</span>
<span class="sd">        Euler method.  The more substeps involved, the more precise the numerical</span>
<span class="sd">        integration of the underlying ordinary differential equations.  In the first</span>
<span class="sd">        example, we omit this option by setting the |RecStep| parameter, which defines</span>
<span class="sd">        the number of substeps, to one:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; recstep(2)</span>
<span class="sd">        &gt;&gt;&gt; derived.dt = 1/recstep</span>
<span class="sd">        &gt;&gt;&gt; percmax(2.0)</span>
<span class="sd">        &gt;&gt;&gt; alpha(1.0)</span>
<span class="sd">        &gt;&gt;&gt; k(2.0)</span>
<span class="sd">        &gt;&gt;&gt; factors.contriarea = 1.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.inuz = 0.0</span>
<span class="sd">        &gt;&gt;&gt; states.uz = 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_q0_perc_uz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.perc</span>
<span class="sd">        perc(1.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.q0</span>
<span class="sd">        q0(0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.uz</span>
<span class="sd">        uz(0.0)</span>
<span class="sd">        &gt;&gt;&gt; check()</span>

<span class="sd">        Due to the sequential calculation of the upper zone routine, the upper zone</span>
<span class="sd">        storage drains completely through percolation, and no water remains for fast</span>
<span class="sd">        discharge response.  By dividing the simulation step into 100 substeps, method</span>
<span class="sd">        |Calc_Q0_Perc_UZ_V1| also calculates a considerable amount of direct runoff:</span>

<span class="sd">        &gt;&gt;&gt; recstep(200)</span>
<span class="sd">        &gt;&gt;&gt; derived.dt = 1.0/recstep</span>
<span class="sd">        &gt;&gt;&gt; states.uz = 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_q0_perc_uz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.perc</span>
<span class="sd">        perc(0.786934)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.q0</span>
<span class="sd">        q0(0.213066)</span>
<span class="sd">        &gt;&gt;&gt; states.uz</span>
<span class="sd">        uz(0.0)</span>
<span class="sd">        &gt;&gt;&gt; check()</span>

<span class="sd">        Note that the assumed length of the simulation step is half a day. Hence the</span>
<span class="sd">        effective values of the maximum percolation rate and the storage coefficient</span>
<span class="sd">        are not 2 but 1:</span>

<span class="sd">        &gt;&gt;&gt; percmax</span>
<span class="sd">        percmax(2.0)</span>
<span class="sd">        &gt;&gt;&gt; k</span>
<span class="sd">        k(2.0)</span>
<span class="sd">        &gt;&gt;&gt; percmax.value</span>
<span class="sd">        1.0</span>
<span class="sd">        &gt;&gt;&gt; k.value</span>
<span class="sd">        1.0</span>

<span class="sd">        By decreasing the contributing area, one reduces percolation but increases the</span>
<span class="sd">        fast discharge response:</span>

<span class="sd">        &gt;&gt;&gt; factors.contriarea = 0.5</span>
<span class="sd">        &gt;&gt;&gt; states.uz = 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_q0_perc_uz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.perc</span>
<span class="sd">        perc(0.434108)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.q0</span>
<span class="sd">        q0(0.565892)</span>
<span class="sd">        &gt;&gt;&gt; states.uz</span>
<span class="sd">        uz(0.0)</span>
<span class="sd">        &gt;&gt;&gt; check()</span>

<span class="sd">        Without any contributing area, the complete amount of water stored in the upper</span>
<span class="sd">        zone layer is released as direct discharge immediately:</span>

<span class="sd">        &gt;&gt;&gt; factors.contriarea = 0.0</span>
<span class="sd">        &gt;&gt;&gt; states.uz = 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_q0_perc_uz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.perc</span>
<span class="sd">        perc(0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.q0</span>
<span class="sd">        q0(1.0)</span>
<span class="sd">        &gt;&gt;&gt; states.uz</span>
<span class="sd">        uz(0.0)</span>
<span class="sd">        &gt;&gt;&gt; check()</span>

<span class="sd">        Resetting |RecStep| leads to more transparent results.  Note that direct</span>
<span class="sd">        discharge drains the rest of the upper zone storage due to the storage</span>
<span class="sd">        coefficient&#39;s large value and the numerical approximation&#39;s low accuracy:</span>

<span class="sd">        &gt;&gt;&gt; recstep(2)</span>
<span class="sd">        &gt;&gt;&gt; factors.contriarea = 0.5</span>
<span class="sd">        &gt;&gt;&gt; derived.dt = 1.0/recstep</span>
<span class="sd">        &gt;&gt;&gt; states.uz = 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_q0_perc_uz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.perc</span>
<span class="sd">        perc(0.5)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.q0</span>
<span class="sd">        q0(0.5)</span>
<span class="sd">        &gt;&gt;&gt; states.uz</span>
<span class="sd">        uz(0.0)</span>
<span class="sd">        &gt;&gt;&gt; check()</span>

<span class="sd">        Applying a more reasonable storage coefficient leads to the following results:</span>

<span class="sd">        &gt;&gt;&gt; k(0.5)</span>
<span class="sd">        &gt;&gt;&gt; states.uz = 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_q0_perc_uz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.perc</span>
<span class="sd">        perc(0.5)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.q0</span>
<span class="sd">        q0(0.25)</span>
<span class="sd">        &gt;&gt;&gt; states.uz</span>
<span class="sd">        uz(0.25)</span>
<span class="sd">        &gt;&gt;&gt; check()</span>

<span class="sd">        Adding an input of 0.3 mm results in the same percolation value (which here is</span>
<span class="sd">        determined by the maximum percolation rate only) but increases the direct</span>
<span class="sd">        response (which always depends on the actual upper zone storage):</span>

<span class="sd">        &gt;&gt;&gt; fluxes.inuz = 0.3</span>
<span class="sd">        &gt;&gt;&gt; states.uz = 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_q0_perc_uz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.perc</span>
<span class="sd">        perc(0.5)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.q0</span>
<span class="sd">        q0(0.64)</span>
<span class="sd">        &gt;&gt;&gt; states.uz</span>
<span class="sd">        uz(0.16)</span>
<span class="sd">        &gt;&gt;&gt; check()</span>

<span class="sd">        Due to the same reasons, another increase in numerical accuracy has no impact</span>
<span class="sd">        on percolation but decreases the direct response:</span>

<span class="sd">        &gt;&gt;&gt; recstep(200)</span>
<span class="sd">        &gt;&gt;&gt; derived.dt = 1.0/recstep</span>
<span class="sd">        &gt;&gt;&gt; states.uz = 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_q0_perc_uz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.perc</span>
<span class="sd">        perc(0.5)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.q0</span>
<span class="sd">        q0(0.421708)</span>
<span class="sd">        &gt;&gt;&gt; states.uz</span>
<span class="sd">        uz(0.378292)</span>
<span class="sd">        &gt;&gt;&gt; check()</span>

<span class="sd">        If phases of capillary rise, |InUZ| is negative and constant throughout the</span>
<span class="sd">        complete simulation interval.  However, if |UZ| runs dry during the simulation</span>
<span class="sd">        interval, it can no contribute to the capillary rise.  To always comply with</span>
<span class="sd">        the water balance equation, method |Calc_Q0_Perc_UZ_V1| reduces both |Perc|</span>
<span class="sd">        and |Q0| by the same factor in such situations.  Reducing |InUZ| would be more</span>
<span class="sd">        reasonable but would also require modifying |CF| and |SM| (and others?), which</span>
<span class="sd">        is way too much effort given the minor impact of this manipulation on the</span>
<span class="sd">        general simulation results.  The following two examples show how the</span>
<span class="sd">        manipulation works if the capillary rise requires all (first example) or half</span>
<span class="sd">        (second example) of the available water.</span>

<span class="sd">        &gt;&gt;&gt; fluxes.inuz = -1.0</span>
<span class="sd">        &gt;&gt;&gt; states.uz = 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_q0_perc_uz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.perc</span>
<span class="sd">        perc(0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.q0</span>
<span class="sd">        q0(0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.uz</span>
<span class="sd">        uz(0.0)</span>
<span class="sd">        &gt;&gt;&gt; check()</span>

<span class="sd">        &gt;&gt;&gt; fluxes.inuz = -0.5</span>
<span class="sd">        &gt;&gt;&gt; states.uz = 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_q0_perc_uz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.perc</span>
<span class="sd">        perc(0.323912)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.q0</span>
<span class="sd">        q0(0.176088)</span>
<span class="sd">        &gt;&gt;&gt; states.uz</span>
<span class="sd">        uz(0.0)</span>
<span class="sd">        &gt;&gt;&gt; check()</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">RecStep</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">PercMax</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">K</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">Alpha</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_derived</span><span class="o">.</span><span class="n">DT</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_factors</span><span class="o">.</span><span class="n">ContriArea</span><span class="p">,</span> <span class="n">hland_fluxes</span><span class="o">.</span><span class="n">InUZ</span><span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_states</span><span class="o">.</span><span class="n">UZ</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">Perc</span><span class="p">,</span> <span class="n">hland_fluxes</span><span class="o">.</span><span class="n">Q0</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">uz_old</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">sta</span><span class="o">.</span><span class="n">uz</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">perc</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">q0</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">recstep</span><span class="p">):</span>
            <span class="n">sta</span><span class="o">.</span><span class="n">uz</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">uz</span> <span class="o">+</span> <span class="n">der</span><span class="o">.</span><span class="n">dt</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">inuz</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="n">perc</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">dt</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">percmax</span> <span class="o">*</span> <span class="n">fac</span><span class="o">.</span><span class="n">contriarea</span><span class="p">,</span> <span class="n">sta</span><span class="o">.</span><span class="n">uz</span><span class="p">)</span>
            <span class="n">sta</span><span class="o">.</span><span class="n">uz</span> <span class="o">-=</span> <span class="n">perc</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">perc</span> <span class="o">+=</span> <span class="n">perc</span>
            <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">uz</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">fac</span><span class="o">.</span><span class="n">contriarea</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">q0</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
                        <span class="n">der</span><span class="o">.</span><span class="n">dt</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">uz</span> <span class="o">/</span> <span class="n">fac</span><span class="o">.</span><span class="n">contriarea</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">con</span><span class="o">.</span><span class="n">alpha</span><span class="p">),</span>
                        <span class="n">sta</span><span class="o">.</span><span class="n">uz</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">q0</span> <span class="o">=</span> <span class="n">sta</span><span class="o">.</span><span class="n">uz</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">uz</span> <span class="o">-=</span> <span class="n">q0</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">q0</span> <span class="o">+=</span> <span class="n">q0</span>
        <span class="n">error</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">sta</span><span class="o">.</span><span class="n">uz</span> <span class="o">-</span> <span class="p">(</span><span class="n">uz_old</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">inuz</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">perc</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">q0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">error</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">error</span> <span class="o">/</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">perc</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">q0</span><span class="p">)</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">perc</span> <span class="o">*=</span> <span class="n">factor</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">q0</span> <span class="o">*=</span> <span class="n">factor</span></div>



<div class="viewcode-block" id="Calc_DP_SUZ_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_DP_SUZ_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_DP_SUZ_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the deep percolation and remove it from the upper storage reservoir.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`DP = min(PERCMax, SUZ)`</span>

<span class="sd">      :math:`\frac{SUZ}{dt} = -DP`</span>

<span class="sd">      :math:`\frac{SUZ}{dt} = -RS -RI`</span>

<span class="sd">    Example:</span>

<span class="sd">        For internal lakes and sealed areas, method |Calc_DP_SUZ_V1| always sets the</span>
<span class="sd">        values of |DP| and |SUZ| to zero:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(9)</span>
<span class="sd">        &gt;&gt;&gt; zonetype(FIELD, FIELD, FIELD, FIELD, FIELD, FOREST, GLACIER, ILAKE, SEALED)</span>
<span class="sd">        &gt;&gt;&gt; percmax(4.8)</span>
<span class="sd">        &gt;&gt;&gt; states.suz = 0.0, 0.1, 0.2, 0.3, 0.4, 0.4, 0.4, 0.4, 0.4</span>
<span class="sd">        &gt;&gt;&gt; model.calc_dp_suz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dp</span>
<span class="sd">        dp(0.0, 0.1, 0.2, 0.2, 0.2, 0.2, 0.2, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.suz</span>
<span class="sd">        suz(0.0, 0.0, 0.0, 0.1, 0.2, 0.2, 0.2, 0.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneType</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">PercMax</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_states</span><span class="o">.</span><span class="n">SUZ</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">DP</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">zonetype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">FIELD</span><span class="p">,</span> <span class="n">FOREST</span><span class="p">,</span> <span class="n">GLACIER</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">dp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">suz</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">con</span><span class="o">.</span><span class="n">percmax</span><span class="p">)</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">suz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-=</span> <span class="n">flu</span><span class="o">.</span><span class="n">dp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">dp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">suz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_QAb_QVs_BW_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_QAb_QVs_BW_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_QAb_QVs_BW_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the flow and the percolation from a two-outlet reservoir and update it.</span>

<span class="sd">    Method |Calc_QAb_QVs_BW_V1| is an &quot;additional method&quot; used by the &quot;run methods&quot;</span>
<span class="sd">    |Calc_QAb1_QVs1_BW1_V1| and |Calc_QAb2_QVs2_BW2_V1| for calculating the flow and</span>
<span class="sd">    the percolation from the surface water reservoir and the interflow reservoir,</span>
<span class="sd">    respectively.  See the documentation on method |Calc_QAb1_QVs1_BW1_V1| for further</span>
<span class="sd">    information.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># positional arguments required for consistency with the cythonized extension class:</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span>  <span class="c1"># pylint: disable=too-many-positional-arguments</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span>
        <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">h</span><span class="p">:</span> <span class="n">VectorFloat</span><span class="p">,</span>
        <span class="n">k1</span><span class="p">:</span> <span class="n">VectorFloat</span><span class="p">,</span>
        <span class="n">k2</span><span class="p">:</span> <span class="n">VectorFloat</span><span class="p">,</span>
        <span class="n">s0</span><span class="p">:</span> <span class="n">VectorFloat</span><span class="p">,</span>
        <span class="n">qz</span><span class="p">:</span> <span class="n">VectorFloat</span><span class="p">,</span>
        <span class="n">qa1</span><span class="p">:</span> <span class="n">VectorFloat</span><span class="p">,</span>
        <span class="n">qa2</span><span class="p">:</span> <span class="n">VectorFloat</span><span class="p">,</span>
        <span class="n">t0</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="o">/</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">d_h</span> <span class="o">=</span> <span class="n">h</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="n">d_k1</span> <span class="o">=</span> <span class="n">k1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="n">d_k2</span> <span class="o">=</span> <span class="n">k2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="n">d_qz</span> <span class="o">=</span> <span class="n">qz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="n">d_s0</span> <span class="o">=</span> <span class="n">s0</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">d_k1</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">d_s0</span> <span class="o">&gt;</span> <span class="n">d_h</span><span class="p">):</span>
            <span class="n">qa1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">d_s0</span> <span class="o">-</span> <span class="n">d_h</span>
            <span class="n">s0</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">d_s0</span> <span class="o">=</span> <span class="n">d_h</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">d_k1</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">d_s0</span> <span class="o">==</span> <span class="n">d_h</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">d_qz</span> <span class="o">&gt;</span> <span class="n">d_h</span> <span class="o">/</span> <span class="n">d_k2</span><span class="p">):</span>
            <span class="n">d_qa2</span> <span class="o">=</span> <span class="n">d_h</span> <span class="o">/</span> <span class="n">d_k2</span>
            <span class="n">d_dt</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">t0</span>
            <span class="n">qa2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">d_dt</span> <span class="o">*</span> <span class="n">d_qa2</span>
            <span class="n">qa1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">d_dt</span> <span class="o">*</span> <span class="p">(</span><span class="n">d_qz</span> <span class="o">-</span> <span class="n">d_qa2</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">d_k2</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">qa2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">d_s0</span> <span class="o">+</span> <span class="n">d_qz</span>
            <span class="n">s0</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">d_s0</span> <span class="o">&lt;</span> <span class="n">d_h</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">d_s0</span> <span class="o">==</span> <span class="n">d_h</span> <span class="ow">and</span> <span class="n">d_qz</span> <span class="o">&lt;=</span> <span class="n">d_h</span> <span class="o">/</span> <span class="n">d_k2</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">d_s0</span> <span class="o">==</span> <span class="n">d_h</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">d_qz</span> <span class="o">&lt;=</span> <span class="n">d_h</span> <span class="o">/</span> <span class="n">d_k2</span><span class="p">):</span>
                <span class="n">d_t1</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="k">elif</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">d_k2</span><span class="p">):</span>
                <span class="n">d_t1</span> <span class="o">=</span> <span class="p">(</span><span class="n">d_h</span> <span class="o">-</span> <span class="n">d_s0</span><span class="p">)</span> <span class="o">/</span> <span class="n">d_qz</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">d_t1</span> <span class="o">=</span> <span class="n">t0</span> <span class="o">+</span> <span class="n">d_k2</span> <span class="o">*</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">d_qz</span> <span class="o">-</span> <span class="n">d_s0</span> <span class="o">/</span> <span class="n">d_k2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">d_qz</span> <span class="o">-</span> <span class="n">d_h</span> <span class="o">/</span> <span class="n">d_k2</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="mf">0.0</span> <span class="o">&lt;</span> <span class="n">d_t1</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
                <span class="n">qa2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">d_t1</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span> <span class="o">*</span> <span class="n">d_qz</span> <span class="o">-</span> <span class="p">(</span><span class="n">d_h</span> <span class="o">-</span> <span class="n">d_s0</span><span class="p">)</span>
                <span class="n">s0</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">d_h</span>
                <span class="n">model</span><span class="o">.</span><span class="n">calc_qab_qvs_bw_v1</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">,</span> <span class="n">s0</span><span class="p">,</span> <span class="n">qz</span><span class="p">,</span> <span class="n">qa1</span><span class="p">,</span> <span class="n">qa2</span><span class="p">,</span> <span class="n">d_t1</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">d_k2</span><span class="p">):</span>
                <span class="n">s0</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span> <span class="o">*</span> <span class="n">d_qz</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">d_dt</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">t0</span>
                <span class="n">d_k2qz</span> <span class="o">=</span> <span class="n">d_k2</span> <span class="o">*</span> <span class="n">d_qz</span>
                <span class="n">s0</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">d_k2qz</span> <span class="o">-</span> <span class="p">(</span><span class="n">d_k2qz</span> <span class="o">-</span> <span class="n">d_s0</span><span class="p">)</span> <span class="o">*</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">d_dt</span> <span class="o">/</span> <span class="n">d_k2</span><span class="p">)</span>
                <span class="n">qa2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">d_s0</span> <span class="o">-</span> <span class="n">s0</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">d_dt</span> <span class="o">*</span> <span class="n">d_qz</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d_v1</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">d_k1</span> <span class="o">+</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">d_k2</span>
            <span class="n">d_v2</span> <span class="o">=</span> <span class="n">d_qz</span> <span class="o">+</span> <span class="n">d_h</span> <span class="o">/</span> <span class="n">d_k1</span>
            <span class="n">d_nom</span> <span class="o">=</span> <span class="n">d_v2</span> <span class="o">-</span> <span class="n">d_h</span> <span class="o">*</span> <span class="n">d_v1</span>
            <span class="n">d_denom</span> <span class="o">=</span> <span class="n">d_v2</span> <span class="o">-</span> <span class="n">d_s0</span> <span class="o">*</span> <span class="n">d_v1</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">d_s0</span> <span class="o">==</span> <span class="n">d_h</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">d_denom</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">d_nom</span> <span class="o">/</span> <span class="n">d_denom</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">d_t1</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">d_t1</span> <span class="o">=</span> <span class="n">t0</span> <span class="o">-</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">d_v1</span> <span class="o">*</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">d_nom</span> <span class="o">/</span> <span class="n">d_denom</span><span class="p">)</span>
                <span class="n">d_t1</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">d_t1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
            <span class="n">d_dt</span> <span class="o">=</span> <span class="n">d_t1</span> <span class="o">-</span> <span class="n">t0</span>
            <span class="n">d_v3</span> <span class="o">=</span> <span class="p">(</span><span class="n">d_v2</span> <span class="o">*</span> <span class="n">d_dt</span><span class="p">)</span> <span class="o">/</span> <span class="n">d_v1</span>
            <span class="n">d_v4</span> <span class="o">=</span> <span class="n">d_denom</span> <span class="o">/</span> <span class="n">d_v1</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">d_dt</span> <span class="o">*</span> <span class="n">d_v1</span><span class="p">))</span>
            <span class="n">d_qa1</span> <span class="o">=</span> <span class="p">(</span><span class="n">d_v3</span> <span class="o">-</span> <span class="n">d_v4</span> <span class="o">-</span> <span class="n">d_h</span> <span class="o">*</span> <span class="n">d_dt</span><span class="p">)</span> <span class="o">/</span> <span class="n">d_k1</span>
            <span class="n">d_qa2</span> <span class="o">=</span> <span class="p">(</span><span class="n">d_v3</span> <span class="o">-</span> <span class="n">d_v4</span><span class="p">)</span> <span class="o">/</span> <span class="n">d_k2</span>
            <span class="n">qa1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">d_qa1</span>
            <span class="n">qa2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">d_qa2</span>
            <span class="k">if</span> <span class="n">d_t1</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span>
                <span class="n">s0</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">d_dt</span> <span class="o">*</span> <span class="n">d_qz</span> <span class="o">-</span> <span class="n">d_qa1</span> <span class="o">-</span> <span class="n">d_qa2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">s0</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">d_h</span>
            <span class="k">if</span> <span class="n">d_t1</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
                <span class="n">model</span><span class="o">.</span><span class="n">calc_qab_qvs_bw_v1</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">,</span> <span class="n">s0</span><span class="p">,</span> <span class="n">qz</span><span class="p">,</span> <span class="n">qa1</span><span class="p">,</span> <span class="n">qa2</span><span class="p">,</span> <span class="n">d_t1</span><span class="p">)</span></div>



<div class="viewcode-block" id="Calc_QAb1_QVs1_BW1_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_QAb1_QVs1_BW1_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_QAb1_QVs1_BW1_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the flow and the percolation from the surface flow reservoir and</span>
<span class="sd">    update it.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      :math:`\frac{dBW1}{dt} = R - QAb1 - QVs1`</span>

<span class="sd">      :math:`QAb1 = \frac{max(BW1 - H1, 0)}{TAb1}`</span>

<span class="sd">      :math:`QVs1 = \frac{BW1}{TVs1}`</span>

<span class="sd">    We follow the new COSERO implementation described in :cite:t:`ref-Kling2005` and</span>
<span class="sd">    :cite:t:`ref-Kling2006` and solve the given ordinary differential equation under the</span>
<span class="sd">    assumption of constant inflow (|R|).  Despite the simple appearance of the short</span>
<span class="sd">    equation, its solution is quite complicated due to the threshold |H1| used</span>
<span class="sd">    (:cite:t:`ref-Kling2005` and :cite:t:`ref-Kling2006` explain the math in some</span>
<span class="sd">    detail).</span>
<span class="sd">    Additionally, we allow setting either |TAb1| or |TVs1| to |numpy.inf| or zero,</span>
<span class="sd">    allowing for disabling certain surface flow reservoir functionalities.</span>
<span class="sd">    Consequently, our source code includes many branches, and extensive testing is</span>
<span class="sd">    required to get some confidence in its robustness.  We verified each of the</span>
<span class="sd">    following tests with numerical integration results.  You can find this independent</span>
<span class="sd">    test code in `issue 68`_.  Please tell us if you encounter a plausible combination</span>
<span class="sd">    of parameter values not adequately covered by our tests or source code.</span>

<span class="sd">    Examples:</span>

<span class="sd">        We prepare eight zones with identical values for the control parameters |H1|,</span>
<span class="sd">        |TAb1|, and |TVs1|.  We only vary the inflow (|R|) and the initial state</span>
<span class="sd">        (|BW1|).  For the first and the second zone, |BW1| changes but remains</span>
<span class="sd">        permanently below |H1|.  Hence, all water leaving the storage leaves via</span>
<span class="sd">        percolation.  For the third and the fourth zone, |BW1| also changes but is</span>
<span class="sd">        permanently above |H1|.  Hence, there is a continuous generation of percolation</span>
<span class="sd">        and surface runoff.  For the fifth and sixth zone, |BW1| starts below and ends</span>
<span class="sd">        above |H1| and the other way round.  For the seventh and the eighth zone,</span>
<span class="sd">        inflow and outflow are balanced:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(8)</span>
<span class="sd">        &gt;&gt;&gt; zonetype(FIELD)</span>
<span class="sd">        &gt;&gt;&gt; h1(4.0)</span>
<span class="sd">        &gt;&gt;&gt; tab1(1.0)</span>
<span class="sd">        &gt;&gt;&gt; tvs1(2.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.r = 0.0, 2.0, 0.0, 2.0, 5.0, 0.1, 0.5, 2.5</span>
<span class="sd">        &gt;&gt;&gt; states.bw1 = 2.0, 2.0, 9.0, 9.0, 2.0, 5.0, 2.0, 6.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qab1_qvs1_bw1_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qab1</span>
<span class="sd">        qab1(0.0, 0.0, 1.561119, 1.956437, 0.246114, 0.181758, 0.0, 1.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qvs1</span>
<span class="sd">        qvs1(0.442398, 0.672805, 1.780559, 1.978219, 1.007586, 1.086805, 0.5,</span>
<span class="sd">             1.5)</span>
<span class="sd">        &gt;&gt;&gt; states.bw1</span>
<span class="sd">        bw1(1.557602, 3.327195, 5.658322, 7.065344, 5.7463, 3.831437, 2.0, 6.0)</span>

<span class="sd">        In the following examples, we keep the general configuration but set either</span>
<span class="sd">        |TAb1| or |TVs1| to |numpy.inf| or zero (you can replace |numpy.inf| with a</span>
<span class="sd">        high value and zero with a low value to confirm the correct &quot;direction&quot; of our</span>
<span class="sd">        handling of these special cases):</span>

<span class="sd">        &gt;&gt;&gt; infinity = inf</span>
<span class="sd">        &gt;&gt;&gt; zero = 0.0</span>

<span class="sd">        Setting |TAb1| to |numpy.inf| disables the surface runoff:</span>

<span class="sd">        &gt;&gt;&gt; tab1(infinity)</span>
<span class="sd">        &gt;&gt;&gt; states.bw1 = 2.0, 2.0, 9.0, 9.0, 2.0, 5.0, 2.0, 6.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qab1_qvs1_bw1_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qab1</span>
<span class="sd">        qab1(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qvs1</span>
<span class="sd">        qvs1(0.442398, 0.672805, 1.990793, 2.221199, 1.018414, 1.117516, 0.5,</span>
<span class="sd">             1.615203)</span>
<span class="sd">        &gt;&gt;&gt; states.bw1</span>
<span class="sd">        bw1(1.557602, 3.327195, 7.009207, 8.778801, 5.981586, 3.982484, 2.0,</span>
<span class="sd">            6.884797)</span>

<span class="sd">        Setting |TAb1| to zero enforces that all water exceeding |H1| becomes surface</span>
<span class="sd">        runoff immediately:</span>

<span class="sd">        &gt;&gt;&gt; tab1(zero)</span>
<span class="sd">        &gt;&gt;&gt; states.bw1 = 2.0, 2.0, 9.0, 9.0, 2.0, 5.0, 2.0, 6.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qab1_qvs1_bw1_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qab1</span>
<span class="sd">        qab1(0.0, 0.0, 5.0, 6.0, 2.115471, 1.0, 0.0, 3.5)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qvs1</span>
<span class="sd">        qvs1(0.442398, 0.672805, 0.884797, 1.0, 0.884529, 0.896317, 0.5, 1.0)</span>
<span class="sd">        &gt;&gt;&gt; states.bw1</span>
<span class="sd">        bw1(1.557602, 3.327195, 3.115203, 4.0, 4.0, 3.203683, 2.0, 4.0)</span>

<span class="sd">        Setting |TVs1| to |numpy.inf| disables the percolation:</span>

<span class="sd">        &gt;&gt;&gt; tab1(1.0)</span>
<span class="sd">        &gt;&gt;&gt; tvs1(infinity)</span>
<span class="sd">        &gt;&gt;&gt; states.bw1 = 2.0, 2.0, 9.0, 9.0, 2.0, 5.0, 2.0, 6.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qab1_qvs1_bw1_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qab1</span>
<span class="sd">        qab1(0.0, 0.0, 1.967347, 2.393469, 0.408182, 0.414775, 0.0, 1.319592)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qvs1</span>
<span class="sd">        qvs1(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.bw1</span>
<span class="sd">        bw1(2.0, 4.0, 7.032653, 8.606531, 6.591818, 4.685225, 2.5, 7.180408)</span>

<span class="sd">        Setting |TAb1| to zero ensures that all availalbe water becomes percolation</span>
<span class="sd">        immediately:</span>

<span class="sd">        &gt;&gt;&gt; tvs1(zero)</span>
<span class="sd">        &gt;&gt;&gt; states.bw1 = 2.0, 2.0, 9.0, 9.0, 2.0, 5.0, 2.0, 6.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qab1_qvs1_bw1_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qab1</span>
<span class="sd">        qab1(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qvs1</span>
<span class="sd">        qvs1(2.0, 4.0, 9.0, 11.0, 7.0, 5.1, 2.5, 8.5)</span>
<span class="sd">        &gt;&gt;&gt; states.bw1</span>
<span class="sd">        bw1(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>

<span class="sd">        The following examples repeat the ones above for the edge case where the</span>
<span class="sd">        threshold value |H1| is zero:</span>

<span class="sd">        &gt;&gt;&gt; h1(0.0)</span>
<span class="sd">        &gt;&gt;&gt; tvs1(2.0)</span>
<span class="sd">        &gt;&gt;&gt; states.bw1 = 2.0, 2.0, 9.0, 9.0, 2.0, 5.0, 2.0, 6.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qab1_qvs1_bw1_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qab1</span>
<span class="sd">        qab1(0.703511, 1.09883, 3.165801, 3.561119, 1.691807, 1.778544,</span>
<span class="sd">             0.802341, 2.604682)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qvs1</span>
<span class="sd">        qvs1(0.351756, 0.549415, 1.5829, 1.780559, 0.845904, 0.889272, 0.40117,</span>
<span class="sd">             1.302341)</span>
<span class="sd">        &gt;&gt;&gt; states.bw1</span>
<span class="sd">        bw1(0.944733, 2.351756, 4.251299, 5.658322, 4.462289, 2.432184,</span>
<span class="sd">            1.296489, 4.592977)</span>

<span class="sd">        &gt;&gt;&gt; tab1(infinity)</span>
<span class="sd">        &gt;&gt;&gt; states.bw1 = 2.0, 2.0, 9.0, 9.0, 2.0, 5.0, 2.0, 6.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qab1_qvs1_bw1_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qab1</span>
<span class="sd">        qab1(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qvs1</span>
<span class="sd">        qvs1(0.442398, 0.672805, 1.990793, 2.221199, 1.018414, 1.117516, 0.5,</span>
<span class="sd">             1.615203)</span>
<span class="sd">        &gt;&gt;&gt; states.bw1</span>
<span class="sd">        bw1(1.557602, 3.327195, 7.009207, 8.778801, 5.981586, 3.982484, 2.0,</span>
<span class="sd">            6.884797)</span>

<span class="sd">        &gt;&gt;&gt; tab1(zero)</span>
<span class="sd">        &gt;&gt;&gt; states.bw1 = 2.0, 2.0, 9.0, 9.0, 2.0, 5.0, 2.0, 6.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qab1_qvs1_bw1_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qab1</span>
<span class="sd">        qab1(2.0, 4.0, 9.0, 11.0, 7.0, 5.1, 2.5, 8.5)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qvs1</span>
<span class="sd">        qvs1(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.bw1</span>
<span class="sd">        bw1(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>

<span class="sd">        &gt;&gt;&gt; tab1(1.0)</span>
<span class="sd">        &gt;&gt;&gt; tvs1(infinity)</span>
<span class="sd">        &gt;&gt;&gt; states.bw1 = 2.0, 2.0, 9.0, 9.0, 2.0, 5.0, 2.0, 6.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qab1_qvs1_bw1_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qab1</span>
<span class="sd">        qab1(0.786939, 1.213061, 3.541224, 3.967347, 1.852245, 1.988653,</span>
<span class="sd">             0.893469, 2.893469)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qvs1</span>
<span class="sd">        qvs1(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.bw1</span>
<span class="sd">        bw1(1.213061, 2.786939, 5.458776, 7.032653, 5.147755, 3.111347,</span>
<span class="sd">            1.606531, 5.606531)</span>

<span class="sd">        &gt;&gt;&gt; tvs1(zero)</span>
<span class="sd">        &gt;&gt;&gt; states.bw1 = 2.0, 2.0, 9.0, 9.0, 2.0, 5.0, 2.0, 6.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qab1_qvs1_bw1_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qab1</span>
<span class="sd">        qab1(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qvs1</span>
<span class="sd">        qvs1(2.0, 4.0, 9.0, 11.0, 7.0, 5.1, 2.5, 8.5)</span>
<span class="sd">        &gt;&gt;&gt; states.bw1</span>
<span class="sd">        bw1(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>

<span class="sd">        |Calc_QAb1_QVs1_BW1_V1| processes forest and glacier zones like field zones but</span>
<span class="sd">        sets the values of |QAb1|, |QVs1|, and |BW1| to zero for internal lakes and</span>
<span class="sd">        sealed areas:</span>

<span class="sd">        &gt;&gt;&gt; zonetype(FOREST, GLACIER, ILAKE, SEALED, FOREST, GLACIER, ILAKE, SEALED)</span>
<span class="sd">        &gt;&gt;&gt; h1(4.0)</span>
<span class="sd">        &gt;&gt;&gt; tab1(1.0)</span>
<span class="sd">        &gt;&gt;&gt; tvs1(2.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.r = 2.0, 2.0, 2.0, 2.0, 2.5, 2.5, 2.5, 2.5</span>
<span class="sd">        &gt;&gt;&gt; states.bw1 = 2.0, 2.0, 2.0, 2.0, 6.0, 6.0, 6.0, 6.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qab1_qvs1_bw1_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qab1</span>
<span class="sd">        qab1(0.0, 0.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qvs1</span>
<span class="sd">        qvs1(0.672805, 0.672805, 0.0, 0.0, 1.5, 1.5, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.bw1</span>
<span class="sd">        bw1(3.327195, 3.327195, 0.0, 0.0, 6.0, 6.0, 0.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneType</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">H1</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">TAb1</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">TVs1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">R</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_states</span><span class="o">.</span><span class="n">BW1</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">QAb1</span><span class="p">,</span> <span class="n">hland_fluxes</span><span class="o">.</span><span class="n">QVs1</span><span class="p">)</span>
    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Calc_QAb_QVs_BW_V1</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">qab1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">qvs1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">zonetype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">FIELD</span><span class="p">,</span> <span class="n">FOREST</span><span class="p">,</span> <span class="n">GLACIER</span><span class="p">):</span>
                <span class="n">model</span><span class="o">.</span><span class="n">calc_qab_qvs_bw_v1</span><span class="p">(</span>
                    <span class="n">k</span><span class="p">,</span>
                    <span class="n">con</span><span class="o">.</span><span class="n">h1</span><span class="p">,</span>
                    <span class="n">con</span><span class="o">.</span><span class="n">tab1</span><span class="p">,</span>
                    <span class="n">con</span><span class="o">.</span><span class="n">tvs1</span><span class="p">,</span>
                    <span class="n">sta</span><span class="o">.</span><span class="n">bw1</span><span class="p">,</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">r</span><span class="p">,</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">qab1</span><span class="p">,</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">qvs1</span><span class="p">,</span>
                    <span class="mf">0.0</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">bw1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_QAb2_QVs2_BW2_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_QAb2_QVs2_BW2_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_QAb2_QVs2_BW2_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the flow and the percolation from the interflow reservoir and update</span>
<span class="sd">    it.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      :math:`\frac{dBW2}{dt} = QVs1 - QAb2 - QVs2`</span>

<span class="sd">      :math:`QAb2 = \frac{max(BW2 - H2, 0)}{TAb2}`</span>

<span class="sd">      :math:`QVs2 = \frac{BW2}{TVs2}`</span>

<span class="sd">    Method |Calc_QAb2_QVs2_BW2_V1| is functionally identical with method</span>
<span class="sd">    |Calc_QAb1_QVs1_BW1_V1| and also relies on the &quot;additional method&quot;</span>
<span class="sd">    |Calc_QAb_QVs_BW_V1|.  Please see the documentation on method</span>
<span class="sd">    |Calc_QAb1_QVs1_BW1_V1|, which provides more information and exhaustive example</span>
<span class="sd">    calculations.</span>

<span class="sd">    Example:</span>

<span class="sd">        We only repeat the first and the last example of the documentation on method</span>
<span class="sd">        |Calc_QAb1_QVs1_BW1_V1| to verify that method |Calc_QAb2_QVs2_BW2_V1| calls</span>
<span class="sd">        method |Calc_QAb_QVs_BW_V1| correctly:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(8)</span>
<span class="sd">        &gt;&gt;&gt; zonetype(FIELD)</span>
<span class="sd">        &gt;&gt;&gt; h2(4.0)</span>
<span class="sd">        &gt;&gt;&gt; tab2(1.0)</span>
<span class="sd">        &gt;&gt;&gt; tvs2(2.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qvs1 = 0.0, 2.0, 0.0, 2.0, 5.0, 0.1, 0.5, 2.5</span>
<span class="sd">        &gt;&gt;&gt; states.bw2 = 2.0, 2.0, 9.0, 9.0, 2.0, 5.0, 2.0, 6.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qab2_qvs2_bw2_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qab2</span>
<span class="sd">        qab2(0.0, 0.0, 1.561119, 1.956437, 0.246114, 0.181758, 0.0, 1.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qvs2</span>
<span class="sd">        qvs2(0.442398, 0.672805, 1.780559, 1.978219, 1.007586, 1.086805, 0.5,</span>
<span class="sd">             1.5)</span>
<span class="sd">        &gt;&gt;&gt; states.bw2</span>
<span class="sd">        bw2(1.557602, 3.327195, 5.658322, 7.065344, 5.7463, 3.831437, 2.0, 6.0)</span>

<span class="sd">        |Calc_QAb2_QVs2_BW2_V1| processes forest and glacier zones like field zones but</span>
<span class="sd">        sets the values of |QAb2|, |QVs2|, and |BW2| to zero for internal lakes and</span>
<span class="sd">        sealed areas:</span>

<span class="sd">        &gt;&gt;&gt; zonetype(FOREST, GLACIER, ILAKE, SEALED, FOREST, GLACIER, ILAKE, SEALED)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qvs1 = 2.0, 2.0, 2.0, 2.0, 2.5, 2.5, 2.5, 2.5</span>
<span class="sd">        &gt;&gt;&gt; states.bw2 = 2.0, 2.0, 2.0, 2.0, 6.0, 6.0, 6.0, 6.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qab2_qvs2_bw2_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qab2</span>
<span class="sd">        qab2(0.0, 0.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qvs2</span>
<span class="sd">        qvs2(0.672805, 0.672805, 0.0, 0.0, 1.5, 1.5, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.bw2</span>
<span class="sd">        bw2(3.327195, 3.327195, 0.0, 0.0, 6.0, 6.0, 0.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneType</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">H2</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">TAb2</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">TVs2</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">QVs1</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_states</span><span class="o">.</span><span class="n">BW2</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">QAb2</span><span class="p">,</span> <span class="n">hland_fluxes</span><span class="o">.</span><span class="n">QVs2</span><span class="p">)</span>
    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Calc_QAb_QVs_BW_V1</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">qab2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">qvs2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">zonetype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">FIELD</span><span class="p">,</span> <span class="n">FOREST</span><span class="p">,</span> <span class="n">GLACIER</span><span class="p">):</span>
                <span class="n">model</span><span class="o">.</span><span class="n">calc_qab_qvs_bw_v1</span><span class="p">(</span>
                    <span class="n">k</span><span class="p">,</span>
                    <span class="n">con</span><span class="o">.</span><span class="n">h2</span><span class="p">,</span>
                    <span class="n">con</span><span class="o">.</span><span class="n">tab2</span><span class="p">,</span>
                    <span class="n">con</span><span class="o">.</span><span class="n">tvs2</span><span class="p">,</span>
                    <span class="n">sta</span><span class="o">.</span><span class="n">bw2</span><span class="p">,</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">qvs1</span><span class="p">,</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">qab2</span><span class="p">,</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">qvs2</span><span class="p">,</span>
                    <span class="mf">0.0</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">bw2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_RS_RI_SUZ_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_RS_RI_SUZ_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_RS_RI_SUZ_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the surface runoff and the interflow and remove them from the upper</span>
<span class="sd">    storage reservoir.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`RS = (SUZ - SGR) \cdot (1 - W0)`</span>

<span class="sd">      :math:`RI = SUZ \cdot (1 - W1)`</span>

<span class="sd">      :math:`\frac{SUZ}{dt} = -(RS + RI)`</span>

<span class="sd">    Examples:</span>

<span class="sd">        For internal lakes and sealed areas, method |Calc_RS_RI_SUZ_V1| always sets the</span>
<span class="sd">        values of |RS|, |RI|, and |SUZ| to zero:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(9)</span>
<span class="sd">        &gt;&gt;&gt; zonetype(FIELD, FIELD, FIELD, FIELD, FIELD, FOREST, GLACIER, ILAKE, SEALED)</span>
<span class="sd">        &gt;&gt;&gt; sgr(10.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.w0 = 0.4</span>
<span class="sd">        &gt;&gt;&gt; derived.w1 = 0.8</span>
<span class="sd">        &gt;&gt;&gt; states.suz = 0.0, 5.0, 10.0, 15.0, 20.0, 20.0, 20.0, 20.0, 20.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rs_ri_suz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.rs</span>
<span class="sd">        rs(0.0, 0.0, 0.0, 3.0, 6.0, 6.0, 6.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.ri</span>
<span class="sd">        ri(0.0, 1.0, 2.0, 3.0, 4.0, 4.0, 4.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.suz</span>
<span class="sd">        suz(0.0, 4.0, 8.0, 9.0, 10.0, 10.0, 10.0, 0.0, 0.0)</span>

<span class="sd">        Theoretically, the parallel calculation of |RS| and |RI| can result in negative</span>
<span class="sd">        values of |SUZ|.  The checks implemented for the parameter classes |K0| and</span>
<span class="sd">        |K1| should prevent this problem.  However, to be definitely on the safe side,</span>
<span class="sd">        method |Calc_RS_RI_SUZ_V1| also checks if the final state of |SUZ| is negative</span>
<span class="sd">        and, when necessary, resets it to zero and reduces |RS| and |RI| accordingly</span>
<span class="sd">        (with the same fraction):</span>

<span class="sd">        &gt;&gt;&gt; derived.w0 = 0.1</span>
<span class="sd">        &gt;&gt;&gt; derived.w1 = 0.2</span>
<span class="sd">        &gt;&gt;&gt; states.suz = 0.0, 5.0, 10.0, 15.0, 20.0, 20.0, 20.0, 20.0, 20.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rs_ri_suz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.rs</span>
<span class="sd">        rs(0.0, 0.0, 0.0, 4.909091, 10.8, 10.8, 10.8, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.ri</span>
<span class="sd">        ri(0.0, 4.0, 8.0, 13.090909, 19.2, 19.2, 19.2, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.suz</span>
<span class="sd">        suz(0.0, 1.0, 2.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneType</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">SGR</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_derived</span><span class="o">.</span><span class="n">W0</span><span class="p">,</span> <span class="n">hland_derived</span><span class="o">.</span><span class="n">W1</span><span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_states</span><span class="o">.</span><span class="n">SUZ</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">RS</span><span class="p">,</span> <span class="n">hland_fluxes</span><span class="o">.</span><span class="n">RI</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">zonetype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">FIELD</span><span class="p">,</span> <span class="n">FOREST</span><span class="p">,</span> <span class="n">GLACIER</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">suz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">con</span><span class="o">.</span><span class="n">sgr</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">rs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">suz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">sgr</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">der</span><span class="o">.</span><span class="n">w0</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">rs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">ri</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">sta</span><span class="o">.</span><span class="n">suz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">der</span><span class="o">.</span><span class="n">w1</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">suz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-=</span> <span class="n">flu</span><span class="o">.</span><span class="n">rs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">ri</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">suz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">d_f</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">sta</span><span class="o">.</span><span class="n">suz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">rs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">ri</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">rs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*=</span> <span class="n">d_f</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">ri</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*=</span> <span class="n">d_f</span>
                    <span class="n">sta</span><span class="o">.</span><span class="n">suz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">suz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">rs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">ri</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_LZ_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_LZ_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_LZ_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Add percolation from the upper zone layera and lake precipitation to the lower</span>
<span class="sd">    zone storage.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      .. math::</span>
<span class="sd">        \frac{dLZ}{dt} = \frac{RelUpperZoneArea}{RelLowerZoneArea} \cdot Perc +</span>
<span class="sd">        \sum_{k=1}^{NmbZones} \frac{RelZoneAreas_k}{RelLowerZoneArea} \cdot</span>
<span class="sd">        \begin{cases}</span>
<span class="sd">        Pc_k &amp;|\ ZoneType_k = ILAKE</span>
<span class="sd">        \\</span>
<span class="sd">        0 &amp;|\ ZoneType_k \neq ILAKE</span>
<span class="sd">        \end{cases}</span>

<span class="sd">    Examples:</span>

<span class="sd">        We define a subbasin with five zones of different land-use types and sizes:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(5)</span>
<span class="sd">        &gt;&gt;&gt; zonetype(FIELD, FOREST, GLACIER, ILAKE, SEALED)</span>
<span class="sd">        &gt;&gt;&gt; area(100.0)</span>
<span class="sd">        &gt;&gt;&gt; zonearea(10.0, 20.0, 30.0, 15.0, 25.0)</span>
<span class="sd">        &gt;&gt;&gt; psi(1.0)</span>

<span class="sd">        To ensure the consistency of the values of the relevant derived parameters, we</span>
<span class="sd">        apply their |Parameter.update| methods:</span>

<span class="sd">        &gt;&gt;&gt; derived.relzoneareas.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.relupperzonearea.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.rellowerzonearea.update()</span>

<span class="sd">        First, we set the precipitation intensity (|PC|) to 30 mm and the percolation</span>
<span class="sd">        intensity (|PERC|) to zero. Only the internal lake zone passes its value for</span>
<span class="sd">        |PC| directly to the lower zone layer.  The fraction between its size (15 km²)</span>
<span class="sd">        and the extent of the lower zone layer (75 km²) is 1/5.  Hence, the single</span>
<span class="sd">        zone&#39;s input of 30 mm increases the lower zone layer&#39;s water content by 6 mm:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.pc = 30.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.perc = 0.0</span>
<span class="sd">        &gt;&gt;&gt; states.lz = 10.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_lz_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.lz</span>
<span class="sd">        lz(16.0)</span>

<span class="sd">        Second, we set |PC| to zero and the percolation intensity to 5 mm.  The</span>
<span class="sd">        fraction between the extents of the upper zone layer (60 km²) and the lower</span>
<span class="sd">        zone layer (75 km³) is 4/5. Hence, percolation released by the upper zone layer</span>
<span class="sd">        increases the content of the lower zone layer by 4 mm:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.pc = 0.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.perc = 5.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_lz_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.lz</span>
<span class="sd">        lz(20.0)</span>

<span class="sd">        In case the extent of the lower zone area is zero (which is possible for</span>
<span class="sd">        completely sealed subbasins only) method |Calc_LZ_V1| sets |LZ| to zero:</span>

<span class="sd">        &gt;&gt;&gt; derived.rellowerzonearea(0.0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_lz_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.lz</span>
<span class="sd">        lz(0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span> <span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneType</span><span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_derived</span><span class="o">.</span><span class="n">RelUpperZoneArea</span><span class="p">,</span>
        <span class="n">hland_derived</span><span class="o">.</span><span class="n">RelLowerZoneArea</span><span class="p">,</span>
        <span class="n">hland_derived</span><span class="o">.</span><span class="n">RelZoneAreas</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">Perc</span><span class="p">,</span> <span class="n">hland_fluxes</span><span class="o">.</span><span class="n">PC</span><span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_states</span><span class="o">.</span><span class="n">LZ</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">if</span> <span class="n">der</span><span class="o">.</span><span class="n">rellowerzonearea</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">sta</span><span class="o">.</span><span class="n">lz</span> <span class="o">+=</span> <span class="n">der</span><span class="o">.</span><span class="n">relupperzonearea</span> <span class="o">/</span> <span class="n">der</span><span class="o">.</span><span class="n">rellowerzonearea</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">perc</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">zonetype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">ILAKE</span><span class="p">:</span>
                    <span class="n">sta</span><span class="o">.</span><span class="n">lz</span> <span class="o">+=</span> <span class="n">der</span><span class="o">.</span><span class="n">relzoneareas</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">der</span><span class="o">.</span><span class="n">rellowerzonearea</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">pc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sta</span><span class="o">.</span><span class="n">lz</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_LZ_V2">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_LZ_V2">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_LZ_V2</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Add percolation from the interflow reservoir and lake precipitation to the</span>
<span class="sd">    lower zone storage.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      .. math::</span>
<span class="sd">        \frac{dLZ}{dt} =</span>
<span class="sd">        \sum_{k=1}^{NmbZones} \frac{RelZoneAreas_k}{RelLowerZoneArea} \cdot</span>
<span class="sd">        \begin{cases}</span>
<span class="sd">        QVs2_k &amp;|\ ZoneType_k \in \{ FIELD, FOREST, GLACIER \}</span>
<span class="sd">        \\</span>
<span class="sd">        Pc_k &amp;|\ ZoneType_k = ILAKE</span>
<span class="sd">        \\</span>
<span class="sd">        0 &amp;|\ ZoneType_k = SEALED</span>
<span class="sd">        \end{cases}</span>

<span class="sd">    Example:</span>

<span class="sd">        The first three zones of type |FIELD|, |FOREST|, and |GLACIER| contribute via</span>
<span class="sd">        deep percolation to the lower zone reservoir.  For the fourth zone of type</span>
<span class="sd">        |ILAKE|, precipitation contributes directly to the lower zone storage.  The</span>
<span class="sd">        fifth zone of type |SEALED| does not contribute to the lower zone storage at</span>
<span class="sd">        all:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(5)</span>
<span class="sd">        &gt;&gt;&gt; zonetype(FIELD, FOREST, GLACIER, ILAKE, SEALED)</span>
<span class="sd">        &gt;&gt;&gt; derived.relzoneareas = 0.24, 0.18, 0.12, 0.06, 0.4</span>
<span class="sd">        &gt;&gt;&gt; derived.rellowerzonearea = 0.6</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qvs2 = 1.0, 2.0, 3.0, nan, nan</span>
<span class="sd">        &gt;&gt;&gt; fluxes.pc = nan, nan, nan, 14.0, nan</span>
<span class="sd">        &gt;&gt;&gt; states.lz = 5.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_lz_v2()</span>
<span class="sd">        &gt;&gt;&gt; states.lz</span>
<span class="sd">        lz(8.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span> <span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneType</span><span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_derived</span><span class="o">.</span><span class="n">RelZoneAreas</span><span class="p">,</span> <span class="n">hland_derived</span><span class="o">.</span><span class="n">RelLowerZoneArea</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">QVs2</span><span class="p">,</span> <span class="n">hland_fluxes</span><span class="o">.</span><span class="n">PC</span><span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_states</span><span class="o">.</span><span class="n">LZ</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">zonetype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">ILAKE</span><span class="p">:</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">lz</span> <span class="o">+=</span> <span class="n">der</span><span class="o">.</span><span class="n">relzoneareas</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">der</span><span class="o">.</span><span class="n">rellowerzonearea</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">pc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">con</span><span class="o">.</span><span class="n">zonetype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">!=</span> <span class="n">SEALED</span><span class="p">:</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">lz</span> <span class="o">+=</span> <span class="n">der</span><span class="o">.</span><span class="n">relzoneareas</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">der</span><span class="o">.</span><span class="n">rellowerzonearea</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">qvs2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>



<div class="viewcode-block" id="Calc_GR1_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_GR1_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_GR1_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the recharge to the fast response groundwater reservoir.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`GR1 = min \left(DP, \frac{SG1Max - SG1}{K2} \right)`</span>

<span class="sd">    Examples:</span>

<span class="sd">        For internal lakes and sealed areas, method |Calc_GR1_V1| always sets the values</span>
<span class="sd">        of |GR1| and |SG1| to zero:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(9)</span>
<span class="sd">        &gt;&gt;&gt; zonetype(FIELD, FIELD, FIELD, FIELD, FIELD, FOREST, GLACIER, ILAKE, SEALED)</span>
<span class="sd">        &gt;&gt;&gt; sg1max(10.0)</span>
<span class="sd">        &gt;&gt;&gt; k2(10.0/24.0)</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(k2.values[0])</span>
<span class="sd">        10.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dp = 0.5</span>
<span class="sd">        &gt;&gt;&gt; states.sg1 = 0.0, 5.0, 9.0, 9.9, 10.0, 5.0, 5.0, 5.0, 5.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_gr1_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.gr1</span>
<span class="sd">        gr1(0.5, 0.5, 0.1, 0.01, 0.0, 0.5, 0.5, 0.0, 0.0)</span>

<span class="sd">        For unreasonably low values of parameter |K2|, the sum of |SG1| and |GR1| could</span>
<span class="sd">        theoretically become larger than |SG1Max|.  We let method |Calc_GR1_V1| reduce</span>
<span class="sd">        |GR1| when necessary to ensure this does not happen:</span>

<span class="sd">        &gt;&gt;&gt; k2.values = 0.5</span>
<span class="sd">        &gt;&gt;&gt; states.sg1 = 0.0, 5.0, 9.0, 9.9, 10.0, 5.0, 5.0, 5.0, 5.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_gr1_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.gr1</span>
<span class="sd">        gr1(0.5, 0.5, 0.5, 0.1, 0.0, 0.5, 0.5, 0.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneType</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">SG1Max</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">K2</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">DP</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_states</span><span class="o">.</span><span class="n">SG1</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">GR1</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">zonetype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">FIELD</span><span class="p">,</span> <span class="n">FOREST</span><span class="p">,</span> <span class="n">GLACIER</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">gr1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">dp</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">sg1max</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">sta</span><span class="o">.</span><span class="n">sg1</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">/</span> <span class="n">con</span><span class="o">.</span><span class="n">k2</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">gr1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-=</span> <span class="nb">max</span><span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">sg1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">gr1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">sg1max</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">sg1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">gr1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_RG1_SG1_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_RG1_SG1_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_RG1_SG1_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the discharge from the fast response groundwater reservoir and</span>
<span class="sd">    subtract it.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`SG1_{new} = W2 \cdot SG1_{old} + (1 - W2) \cdot K2 \cdot GR1`</span>

<span class="sd">      :math:`RG1 = SG1_{old} + GR1 - SG1_{new}`</span>

<span class="sd">    Example:</span>

<span class="sd">        For internal lakes and sealed areas, method |Calc_RG1_SG1_V1| always sets the</span>
<span class="sd">        values of |GR1| and |SG1| to zero:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(7)</span>
<span class="sd">        &gt;&gt;&gt; zonetype(FIELD, FIELD, FIELD, FOREST, GLACIER, ILAKE, SEALED)</span>
<span class="sd">        &gt;&gt;&gt; k2(1.0/24, 10.0/24, 100.0/24, 100.0/24, 100.0/24, 100.0/24, 100.0/24)</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(k2.values)</span>
<span class="sd">        1.442695, 10.0, 100.0, 100.0, 100.0, 100.0, 100.0</span>
<span class="sd">        &gt;&gt;&gt; derived.w2.update()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.gr1 = 2.0</span>
<span class="sd">        &gt;&gt;&gt; states.sg1 = 5.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rg1_sg1_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.rg1</span>
<span class="sd">        rg1(3.057305, 0.572561, 0.059718, 0.059718, 0.059718, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sg1</span>
<span class="sd">        sg1(3.942695, 6.427439, 6.940282, 6.940282, 6.940282, 0.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneType</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">K2</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_derived</span><span class="o">.</span><span class="n">W2</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">GR1</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_states</span><span class="o">.</span><span class="n">SG1</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">RG1</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">zonetype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">FIELD</span><span class="p">,</span> <span class="n">FOREST</span><span class="p">,</span> <span class="n">GLACIER</span><span class="p">):</span>
                <span class="n">d_sg1</span> <span class="o">=</span> <span class="n">sta</span><span class="o">.</span><span class="n">sg1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">sg1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">der</span><span class="o">.</span><span class="n">w2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">d_sg1</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">der</span><span class="o">.</span><span class="n">w2</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">k2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">gr1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">rg1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">d_sg1</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">gr1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">sta</span><span class="o">.</span><span class="n">sg1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">sg1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">rg1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_GR2_GR3_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_GR2_GR3_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_GR2_GR3_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the recharge of the first-order and the second-order slow response</span>
<span class="sd">    groundwater reservoir.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      .. math::</span>
<span class="sd">        GRT =</span>
<span class="sd">        \sum_{k=1}^{NmbZones} \frac{RelZoneAreas_k}{RelLowerZoneArea} \cdot</span>
<span class="sd">        \begin{cases}</span>
<span class="sd">        DP_k - GR1_k &amp;|\ ZoneType_k \in \{ FIELD, FOREST, GLACIER \}</span>
<span class="sd">        \\</span>
<span class="sd">        Pc_k &amp;|\ ZoneType_k = ILAKE</span>
<span class="sd">        \\</span>
<span class="sd">        0 &amp;|\ ZoneType_k = SEALED</span>
<span class="sd">        \end{cases}</span>

<span class="sd">      :math:`GR2 = FSG \cdot GRT`</span>

<span class="sd">      :math:`GR3 = (1 - FSG) \cdot GRT`</span>

<span class="sd">    Example:</span>

<span class="sd">        Method |Calc_GR2_GR3_V1| aggregates the given input (term &quot;GRT&quot; in the given</span>
<span class="sd">        basic equations) divides it between |GR2| and |GR3|:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(5)</span>
<span class="sd">        &gt;&gt;&gt; zonetype(FIELD, FOREST, GLACIER, ILAKE, SEALED)</span>
<span class="sd">        &gt;&gt;&gt; derived.relzoneareas(0.24, 0.18, 0.12, 0.06, 0.4)</span>
<span class="sd">        &gt;&gt;&gt; derived.rellowerzonearea(0.6)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.gr1 = 1.0, 2.0, 3.0, nan, nan</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dp = 4.0, 6.0, 8.0, nan, nan</span>
<span class="sd">        &gt;&gt;&gt; fluxes.pc = nan, nan, nan, 11.0, nan</span>
<span class="sd">        &gt;&gt;&gt; model.calc_gr2_gr3_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.gr2</span>
<span class="sd">        gr2(4.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.gr3</span>
<span class="sd">        gr3(0.5)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span> <span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneType</span><span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_derived</span><span class="o">.</span><span class="n">RelZoneAreas</span><span class="p">,</span> <span class="n">hland_derived</span><span class="o">.</span><span class="n">RelLowerZoneArea</span><span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fixed</span><span class="o">.</span><span class="n">FSG</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">PC</span><span class="p">,</span> <span class="n">hland_fluxes</span><span class="o">.</span><span class="n">DP</span><span class="p">,</span> <span class="n">hland_fluxes</span><span class="o">.</span><span class="n">GR1</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">GR2</span><span class="p">,</span> <span class="n">hland_fluxes</span><span class="o">.</span><span class="n">GR3</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">gr2</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">gr3</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">zonetype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">SEALED</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">d_weight</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">relzoneareas</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">der</span><span class="o">.</span><span class="n">rellowerzonearea</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">zonetype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">ILAKE</span><span class="p">:</span>
                <span class="n">d_total</span> <span class="o">=</span> <span class="n">d_weight</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">pc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">d_total</span> <span class="o">=</span> <span class="n">d_weight</span> <span class="o">*</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">dp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">gr1</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">gr2</span> <span class="o">+=</span> <span class="n">fix</span><span class="o">.</span><span class="n">fsg</span> <span class="o">*</span> <span class="n">d_total</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">gr3</span> <span class="o">+=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">fix</span><span class="o">.</span><span class="n">fsg</span><span class="p">)</span> <span class="o">*</span> <span class="n">d_total</span></div>



<div class="viewcode-block" id="Calc_EL_SG2_SG3_AETModel_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_EL_SG2_SG3_AETModel_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_EL_SG2_SG3_AETModel_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Let a submodel that follows the |AETModel_V1| submodel interface calculate</span>
<span class="sd">    lake evaporation and adjust the slow response groundwater reservoirs.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      :math:`\frac{dSG2_i}{dt} =</span>
<span class="sd">      -FSG \cdot \frac{RelZoneAreas_i}{RelLowerZoneArea} \cdot EL_i`</span>

<span class="sd">      :math:`\frac{dSG3_i}{dt} =</span>
<span class="sd">      -(1 - FSG) \cdot \frac{RelZoneAreas_i}{RelLowerZoneArea} \cdot EL_i`</span>

<span class="sd">    Examples:</span>

<span class="sd">        We build an example based on |evap_aet_hbv96| for calculating lake evaporation:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland_96p import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(5)</span>
<span class="sd">        &gt;&gt;&gt; zonetype(GLACIER, SEALED, FIELD, FOREST, ILAKE)</span>
<span class="sd">        &gt;&gt;&gt; area(0.9)</span>
<span class="sd">        &gt;&gt;&gt; zonearea(0.2, 0.1, 0.1, 0.1, 0.4)</span>
<span class="sd">        &gt;&gt;&gt; psi(1.0)</span>
<span class="sd">        &gt;&gt;&gt; zonez(5.0)</span>
<span class="sd">        &gt;&gt;&gt; fc(50.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.relzoneareas.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.rellowerzonearea.update()</span>
<span class="sd">        &gt;&gt;&gt; factors.tc = 10.0</span>
<span class="sd">        &gt;&gt;&gt; with model.add_aetmodel_v1(&quot;evap_aet_hbv96&quot;):</span>
<span class="sd">        ...     temperaturethresholdice(0.0)</span>

<span class="sd">        |Calc_EL_SG2_SG3_AETModel_V1| uses the flux returned by the submodel to adjust</span>
<span class="sd">        |SG2| and |SG3|, considering the total extent of the groundwater-affected</span>
<span class="sd">        subarea and the fraction between the spatial extents of the first-order and the</span>
<span class="sd">        second-order slow response groundwater reservoir:</span>

<span class="sd">        &gt;&gt;&gt; model.aetmodel.sequences.fluxes.potentialwaterevaporation = 2.25</span>
<span class="sd">        &gt;&gt;&gt; states.sg2 = 3.0</span>
<span class="sd">        &gt;&gt;&gt; states.sg3 = 0.3</span>
<span class="sd">        &gt;&gt;&gt; model.calc_el_sg2_sg3_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.el</span>
<span class="sd">        el(0.0, 0.0, 0.0, 0.0, 2.25)</span>
<span class="sd">        &gt;&gt;&gt; states.sg2</span>
<span class="sd">        sg2(2.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sg3</span>
<span class="sd">        sg3(0.175)</span>

<span class="sd">        Zones of type |ILAKE| are assumed to have an open water surface, so evaporation</span>
<span class="sd">        is always possible.  Therefore, applying |Calc_EL_SG2_SG3_AETModel_V1| can</span>
<span class="sd">        result in negative |SG2| and |SG3| values:</span>

<span class="sd">        &gt;&gt;&gt; model.aetmodel.sequences.fluxes.potentialwaterevaporation = 4.5</span>
<span class="sd">        &gt;&gt;&gt; states.sg2 = 1.0</span>
<span class="sd">        &gt;&gt;&gt; states.sg3 = 0.1</span>
<span class="sd">        &gt;&gt;&gt; model.calc_el_sg2_sg3_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.el</span>
<span class="sd">        el(0.0, 0.0, 0.0, 0.0, 4.5)</span>
<span class="sd">        &gt;&gt;&gt; states.sg2</span>
<span class="sd">        sg2(-1.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sg3</span>
<span class="sd">        sg3(-0.15)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span> <span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneType</span><span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_derived</span><span class="o">.</span><span class="n">RelZoneAreas</span><span class="p">,</span> <span class="n">hland_derived</span><span class="o">.</span><span class="n">RelLowerZoneArea</span><span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fixed</span><span class="o">.</span><span class="n">FSG</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_states</span><span class="o">.</span><span class="n">SG2</span><span class="p">,</span> <span class="n">hland_states</span><span class="o">.</span><span class="n">SG3</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">EL</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">submodel</span><span class="p">:</span> <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">submodel</span><span class="o">.</span><span class="n">determine_waterevaporation</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">zonetype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">ILAKE</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">el</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">submodel</span><span class="o">.</span><span class="n">get_waterevaporation</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="n">weight</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">relzoneareas</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">der</span><span class="o">.</span><span class="n">rellowerzonearea</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">sg2</span> <span class="o">-=</span> <span class="n">fix</span><span class="o">.</span><span class="n">fsg</span> <span class="o">*</span> <span class="n">weight</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">el</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">sg3</span> <span class="o">-=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">fix</span><span class="o">.</span><span class="n">fsg</span><span class="p">)</span> <span class="o">*</span> <span class="n">weight</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">el</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">el</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_EL_SG2_SG3_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_EL_SG2_SG3_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_EL_SG2_SG3_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Let a submodel that follows the |AETModel_V1| submodel interface calculate</span>
<span class="sd">    interception evaporation, soil evapotranspiration, and open water evaporation, and</span>
<span class="sd">    adjust the related interception, soil water, and slow response groundwater storages</span>
<span class="sd">    accordingly.&quot;&quot;&quot;</span>

    <span class="n">SUBMODELINTERFACES</span> <span class="o">=</span> <span class="p">(</span><span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="p">,)</span>
    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Calc_EL_SG2_SG3_AETModel_V1</span><span class="p">,)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span> <span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneType</span><span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_derived</span><span class="o">.</span><span class="n">RelZoneAreas</span><span class="p">,</span> <span class="n">hland_derived</span><span class="o">.</span><span class="n">RelLowerZoneArea</span><span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fixed</span><span class="o">.</span><span class="n">FSG</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_states</span><span class="o">.</span><span class="n">SG2</span><span class="p">,</span> <span class="n">hland_states</span><span class="o">.</span><span class="n">SG3</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">EL</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">aetmodel_typeid</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">calc_el_sg2_sg3_aetmodel_v1</span><span class="p">(</span>
                <span class="n">cast</span><span class="p">(</span><span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">aetmodel</span><span class="p">)</span>
            <span class="p">)</span></div>

        <span class="c1"># ToDo:</span>
        <span class="c1">#     else:</span>
        <span class="c1">#         assert_never(model.petmodel)</span>


<div class="viewcode-block" id="Calc_RG2_SG2_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_RG2_SG2_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_RG2_SG2_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the discharge from the first-order slow response groundwater</span>
<span class="sd">    reservoir and subtract it.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`SG2_{new} = W3 \cdot SG2_{old} + (1 - W3) \cdot K3 \cdot GR2`</span>

<span class="sd">      :math:`RG2 = SG2_{old} + GR2 - SG2_{new}`</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; k3(2.0/24)</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(k3.values)</span>
<span class="sd">        2.0</span>
<span class="sd">        &gt;&gt;&gt; derived.w3.update()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.gr2 = 2.0</span>

<span class="sd">        For non-negative |SG2| values, method |Calc_RG2_SG2_V1| strictly follows the</span>
<span class="sd">        given base equation:</span>

<span class="sd">        &gt;&gt;&gt; states.sg2 = 5.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rg2_sg2_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.rg2</span>
<span class="sd">        rg2(2.393469)</span>
<span class="sd">        &gt;&gt;&gt; states.sg2</span>
<span class="sd">        sg2(4.606531)</span>

<span class="sd">        For negative |SG2| values, it uses |RG2| to fill the groundwater storage</span>
<span class="sd">        so that no discharge occurs:</span>

<span class="sd">        &gt;&gt;&gt; states.sg2 = -3.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rg2_sg2_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.rg2</span>
<span class="sd">        rg2(0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sg2</span>
<span class="sd">        sg2(-1.0)</span>

<span class="sd">        &gt;&gt;&gt; states.sg2 = -2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rg2_sg2_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.rg2</span>
<span class="sd">        rg2(0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sg2</span>
<span class="sd">        sg2(0.0)</span>

<span class="sd">        If the sum of |SG2| and |RG2| is positive, recharge first fills the deficit.</span>
<span class="sd">        In the remaining time, |Calc_RG2_SG2_V1| handles the remaining recharge as</span>
<span class="sd">        implied by the basic equations (with parameters |K3| and |W3| adapted to the</span>
<span class="sd">        remaining time interval):</span>

<span class="sd">        &gt;&gt;&gt; states.sg2 = -1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rg2_sg2_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.rg2</span>
<span class="sd">        rg2(0.115203)</span>
<span class="sd">        &gt;&gt;&gt; states.sg2</span>
<span class="sd">        sg2(0.884797)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_control</span><span class="o">.</span><span class="n">K3</span><span class="p">,)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_derived</span><span class="o">.</span><span class="n">W3</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">GR2</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_states</span><span class="o">.</span><span class="n">SG2</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">RG2</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">d_sg2</span> <span class="o">=</span> <span class="n">sta</span><span class="o">.</span><span class="n">sg2</span>
        <span class="n">d_gr2</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">gr2</span>
        <span class="n">d_k3</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">k3</span>
        <span class="n">d_w3</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">w3</span>
        <span class="k">if</span> <span class="n">d_sg2</span> <span class="o">&lt;</span> <span class="mf">0.0</span> <span class="o">&lt;</span> <span class="n">d_gr2</span><span class="p">:</span>
            <span class="n">d_add</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="o">-</span><span class="n">sta</span><span class="o">.</span><span class="n">sg2</span><span class="p">,</span> <span class="n">d_gr2</span><span class="p">)</span>
            <span class="n">d_k3</span> <span class="o">*=</span> <span class="n">d_gr2</span> <span class="o">/</span> <span class="n">d_add</span>
            <span class="n">d_w3</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">d_k3</span><span class="p">)</span>
            <span class="n">d_sg2</span> <span class="o">+=</span> <span class="n">d_add</span>
            <span class="n">d_gr2</span> <span class="o">-=</span> <span class="n">d_add</span>
        <span class="k">if</span> <span class="n">d_sg2</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">sta</span><span class="o">.</span><span class="n">sg2</span> <span class="o">=</span> <span class="n">d_w3</span> <span class="o">*</span> <span class="n">d_sg2</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">d_w3</span><span class="p">)</span> <span class="o">*</span> <span class="n">d_k3</span> <span class="o">*</span> <span class="n">d_gr2</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">rg2</span> <span class="o">=</span> <span class="n">d_sg2</span> <span class="o">+</span> <span class="n">d_gr2</span> <span class="o">-</span> <span class="n">sta</span><span class="o">.</span><span class="n">sg2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sta</span><span class="o">.</span><span class="n">sg2</span> <span class="o">=</span> <span class="n">d_sg2</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">rg2</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_RG3_SG3_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_RG3_SG3_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_RG3_SG3_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the discharge from the second-order slow response groundwater</span>
<span class="sd">    reservoir and subtract it.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`SG3_{new} = W4 \cdot SG3_{old} + (1 - W4) \cdot K4 \cdot GR3`</span>

<span class="sd">      :math:`RG3 = SG3_{old} + GR3 - SG3_{new}`</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; derived.k4(1.0/24)</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(derived.k4.values)</span>
<span class="sd">        1.0</span>
<span class="sd">        &gt;&gt;&gt; derived.w4.update()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.gr3 = 2.0</span>

<span class="sd">        For non-negative |SG3| values, method |Calc_RG3_SG3_V1| strictly follows the</span>
<span class="sd">        given base equation:</span>

<span class="sd">        &gt;&gt;&gt; states.sg3 = 5.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rg3_sg3_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.rg3</span>
<span class="sd">        rg3(3.896362)</span>
<span class="sd">        &gt;&gt;&gt; states.sg3</span>
<span class="sd">        sg3(3.103638)</span>

<span class="sd">        For negative |SG3| values, it uses |RG3| to fill the groundwater storage</span>
<span class="sd">        so that no discharge occurs:</span>

<span class="sd">        &gt;&gt;&gt; states.sg3 = -3.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rg3_sg3_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.rg3</span>
<span class="sd">        rg3(0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sg3</span>
<span class="sd">        sg3(-1.0)</span>

<span class="sd">        &gt;&gt;&gt; states.sg3 = -2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rg3_sg3_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.rg3</span>
<span class="sd">        rg3(0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sg3</span>
<span class="sd">        sg3(0.0)</span>

<span class="sd">        If the sum of |SG3| and |RG3| is positive, recharge first fills the deficit.</span>
<span class="sd">        In the remaining time, |Calc_RG3_SG3_V1| handles the remaining recharge as</span>
<span class="sd">        implied by the basic equations (with parameters |hland_derived.K4| and |W4|</span>
<span class="sd">        adapted to the remaining time interval):</span>

<span class="sd">        &gt;&gt;&gt; states.sg3 = -1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rg3_sg3_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.rg3</span>
<span class="sd">        rg3(0.213061)</span>
<span class="sd">        &gt;&gt;&gt; states.sg3</span>
<span class="sd">        sg3(0.786939)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_derived</span><span class="o">.</span><span class="n">K4</span><span class="p">,</span> <span class="n">hland_derived</span><span class="o">.</span><span class="n">W4</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">GR3</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_states</span><span class="o">.</span><span class="n">SG3</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">RG3</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">d_sg3</span> <span class="o">=</span> <span class="n">sta</span><span class="o">.</span><span class="n">sg3</span>
        <span class="n">d_gr3</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">gr3</span>
        <span class="n">d_k4</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">k4</span>
        <span class="n">d_w4</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">w4</span>
        <span class="k">if</span> <span class="n">d_sg3</span> <span class="o">&lt;</span> <span class="mf">0.0</span> <span class="o">&lt;</span> <span class="n">d_gr3</span><span class="p">:</span>
            <span class="n">d_add</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="o">-</span><span class="n">sta</span><span class="o">.</span><span class="n">sg3</span><span class="p">,</span> <span class="n">d_gr3</span><span class="p">)</span>
            <span class="n">d_k4</span> <span class="o">*=</span> <span class="n">d_gr3</span> <span class="o">/</span> <span class="n">d_add</span>
            <span class="n">d_w4</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">d_k4</span><span class="p">)</span>
            <span class="n">d_sg3</span> <span class="o">+=</span> <span class="n">d_add</span>
            <span class="n">d_gr3</span> <span class="o">-=</span> <span class="n">d_add</span>
        <span class="k">if</span> <span class="n">d_sg3</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">sta</span><span class="o">.</span><span class="n">sg3</span> <span class="o">=</span> <span class="n">d_w4</span> <span class="o">*</span> <span class="n">d_sg3</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">d_w4</span><span class="p">)</span> <span class="o">*</span> <span class="n">d_k4</span> <span class="o">*</span> <span class="n">d_gr3</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">rg3</span> <span class="o">=</span> <span class="n">d_sg3</span> <span class="o">+</span> <span class="n">d_gr3</span> <span class="o">-</span> <span class="n">sta</span><span class="o">.</span><span class="n">sg3</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sta</span><span class="o">.</span><span class="n">sg3</span> <span class="o">=</span> <span class="n">d_sg3</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">rg3</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_EL_LZ_AETModel_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_EL_LZ_AETModel_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_EL_LZ_AETModel_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Let a submodel that follows the |AETModel_V1| submodel interface calculate</span>
<span class="sd">    lake evaporation and adjust the lower zone&#39;s water content.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`\frac{dLZ_i}{dt} = -\frac{RelZoneAreas_i}{RelLowerZoneArea} \cdot EL_i`</span>

<span class="sd">    Examples:</span>

<span class="sd">        We build an example based on |evap_aet_hbv96| for calculating lake evaporation:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland_96 import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(5)</span>
<span class="sd">        &gt;&gt;&gt; zonetype(GLACIER, SEALED, FIELD, FOREST, ILAKE)</span>
<span class="sd">        &gt;&gt;&gt; area(0.9)</span>
<span class="sd">        &gt;&gt;&gt; zonearea(0.2, 0.1, 0.1, 0.1, 0.4)</span>
<span class="sd">        &gt;&gt;&gt; psi(1.0)</span>
<span class="sd">        &gt;&gt;&gt; zonez(5.0)</span>
<span class="sd">        &gt;&gt;&gt; fc(50.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.relzoneareas.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.rellowerzonearea.update()</span>
<span class="sd">        &gt;&gt;&gt; factors.tc = 10.0</span>
<span class="sd">        &gt;&gt;&gt; with model.add_aetmodel_v1(&quot;evap_aet_hbv96&quot;):</span>
<span class="sd">        ...     temperaturethresholdice(0.0)</span>

<span class="sd">        |Calc_EL_LZ_AETModel_V1| uses the flux returned by the submodel to adjust |LZ|,</span>
<span class="sd">        considering the extent of the groundwater-affected subarea:</span>

<span class="sd">        &gt;&gt;&gt; model.aetmodel.sequences.fluxes.potentialwaterevaporation = 2.0</span>
<span class="sd">        &gt;&gt;&gt; states.lz = 3.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_el_lz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.el</span>
<span class="sd">        el(0.0, 0.0, 0.0, 0.0, 2.0)</span>
<span class="sd">        &gt;&gt;&gt; states.lz</span>
<span class="sd">        lz(2.0)</span>

<span class="sd">        Zones of type |ILAKE| are assumed to have an open water surface, so evaporation</span>
<span class="sd">        is always possible.  Therefore, applying |Calc_EL_LZ_AETModel_V1| can result in</span>
<span class="sd">        negative |LZ| values:</span>

<span class="sd">        &gt;&gt;&gt; model.aetmodel.sequences.fluxes.potentialwaterevaporation = 6.0</span>
<span class="sd">        &gt;&gt;&gt; states.lz = 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_el_lz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.el</span>
<span class="sd">        el(0.0, 0.0, 0.0, 0.0, 6.0)</span>
<span class="sd">        &gt;&gt;&gt; states.lz</span>
<span class="sd">        lz(-2.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span> <span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneType</span><span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_derived</span><span class="o">.</span><span class="n">RelZoneAreas</span><span class="p">,</span> <span class="n">hland_derived</span><span class="o">.</span><span class="n">RelLowerZoneArea</span><span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_states</span><span class="o">.</span><span class="n">LZ</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">EL</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">submodel</span><span class="p">:</span> <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">submodel</span><span class="o">.</span><span class="n">determine_waterevaporation</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">zonetype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">ILAKE</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">el</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">submodel</span><span class="o">.</span><span class="n">get_waterevaporation</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">lz</span> <span class="o">-=</span> <span class="n">der</span><span class="o">.</span><span class="n">relzoneareas</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">der</span><span class="o">.</span><span class="n">rellowerzonearea</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">el</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">el</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_EL_LZ_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_EL_LZ_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_EL_LZ_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Let a submodel that follows the |AETModel_V1| submodel interface calculate lake</span>
<span class="sd">    evaporation and adjust the lower zone&#39;s water content.&quot;&quot;&quot;</span>

    <span class="n">SUBMODELINTERFACES</span> <span class="o">=</span> <span class="p">(</span><span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="p">,)</span>
    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Calc_EL_LZ_AETModel_V1</span><span class="p">,)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span> <span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneType</span><span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_derived</span><span class="o">.</span><span class="n">RelZoneAreas</span><span class="p">,</span> <span class="n">hland_derived</span><span class="o">.</span><span class="n">RelLowerZoneArea</span><span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_states</span><span class="o">.</span><span class="n">LZ</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">EL</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">aetmodel_typeid</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">calc_el_lz_aetmodel_v1</span><span class="p">(</span>
                <span class="n">cast</span><span class="p">(</span><span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">aetmodel</span><span class="p">)</span>
            <span class="p">)</span></div>

        <span class="c1"># ToDo:</span>
        <span class="c1">#     else:</span>
        <span class="c1">#         assert_never(model.petmodel)</span>


<div class="viewcode-block" id="Calc_Q1_LZ_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_Q1_LZ_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_Q1_LZ_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the slow response of the lower zone layer.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      .. math::</span>
<span class="sd">        Q1 =</span>
<span class="sd">        \begin{cases}</span>
<span class="sd">        K4 \cdot LZ^{1 + Gamma} &amp;|\ LZ &gt; 0</span>
<span class="sd">        \\</span>
<span class="sd">        0 &amp;|\ LZ \leq 0</span>
<span class="sd">        \end{cases}</span>

<span class="sd">      :math:`\frac{dLZ}{dt} = -Q1`</span>

<span class="sd">    Examples:</span>

<span class="sd">        As long as the lower zone storage is negative or zero, there is no slow</span>
<span class="sd">        discharge response:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; k4(0.2)</span>
<span class="sd">        &gt;&gt;&gt; gamma(0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.lz = -2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_q1_lz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.q1</span>
<span class="sd">        q1(0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.lz</span>
<span class="sd">        lz(-2.0)</span>

<span class="sd">        &gt;&gt;&gt; states.lz = 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_q1_lz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.q1</span>
<span class="sd">        q1(0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.lz</span>
<span class="sd">        lz(0.0)</span>

<span class="sd">        For storage values above zero the linear or nonlinear storage routing equation</span>
<span class="sd">        applies:</span>

<span class="sd">        &gt;&gt;&gt; states.lz = 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_q1_lz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.q1</span>
<span class="sd">        q1(0.2)</span>
<span class="sd">        &gt;&gt;&gt; states.lz</span>
<span class="sd">        lz(1.8)</span>

<span class="sd">        &gt;&gt;&gt; gamma(1.0)</span>
<span class="sd">        &gt;&gt;&gt; states.lz = 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_q1_lz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.q1</span>
<span class="sd">        q1(0.4)</span>
<span class="sd">        &gt;&gt;&gt; states.lz</span>
<span class="sd">        lz(1.6)</span>

<span class="sd">        Note that the assumed length of the simulation step is half a day. Hence the</span>
<span class="sd">        effective value of the storage coefficient is not 0.2 but 0.1:</span>

<span class="sd">        &gt;&gt;&gt; k4</span>
<span class="sd">        k4(0.2)</span>
<span class="sd">        &gt;&gt;&gt; k4.value</span>
<span class="sd">        0.1</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_control</span><span class="o">.</span><span class="n">K4</span><span class="p">,</span> <span class="n">hland_control</span><span class="o">.</span><span class="n">Gamma</span><span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_states</span><span class="o">.</span><span class="n">LZ</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">Q1</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">lz</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">q1</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">k4</span> <span class="o">*</span> <span class="n">sta</span><span class="o">.</span><span class="n">lz</span> <span class="o">**</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">con</span><span class="o">.</span><span class="n">gamma</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">q1</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">sta</span><span class="o">.</span><span class="n">lz</span> <span class="o">-=</span> <span class="n">flu</span><span class="o">.</span><span class="n">q1</span></div>



<div class="viewcode-block" id="Calc_InRC_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_InRC_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_InRC_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the input of the runoff concentration submodel.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      .. math::</span>
<span class="sd">        InRC = A_U \cdot Q0 + A_L \cdot Q1 +</span>
<span class="sd">        \sum_{k=1}^{N}  A_Z^k \cdot \begin{cases}</span>
<span class="sd">        R &amp;|\ T_Z^k = S</span>
<span class="sd">        \\</span>
<span class="sd">        0 &amp;|\ T_Z^k \neq S</span>
<span class="sd">        \end{cases}</span>
<span class="sd">        \\ \\</span>
<span class="sd">        N = NmbZones \\</span>
<span class="sd">        A_U = RelUpperZoneArea \\</span>
<span class="sd">        A_L = RelLowerZoneArea \\</span>
<span class="sd">        A_Z = RelZoneAreas  \\</span>
<span class="sd">        T_Z = ZoneType \\</span>
<span class="sd">        S = SEALED</span>

<span class="sd">    Example:</span>

<span class="sd">        We define a subbasin with five zones of different land-use types and sizes:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(5)</span>
<span class="sd">        &gt;&gt;&gt; zonetype(FIELD, FOREST, GLACIER, ILAKE, SEALED)</span>
<span class="sd">        &gt;&gt;&gt; area(100.0)</span>
<span class="sd">        &gt;&gt;&gt; zonearea(10.0, 20.0, 30.0, 15.0, 25.0)</span>
<span class="sd">        &gt;&gt;&gt; psi(1.0)</span>

<span class="sd">        To ensure the consistency of the values of the relevant derived parameters, we</span>
<span class="sd">        apply their |Parameter.update| methods:</span>

<span class="sd">        &gt;&gt;&gt; derived.relzoneareas.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.relupperzonearea.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.rellowerzonearea.update()</span>

<span class="sd">        The runoff concentration submodel receives freshly generated runoff (|R|)</span>
<span class="sd">        directly from the sealed zone (0.5 mm), direct runoff (|Q0|) indirectly from</span>
<span class="sd">        the field, forest, and glacier zones (0.6 mm) and base flow (|Q1|) indirectly</span>
<span class="sd">        from the field, forest, glacier and internal lake zones (3.0 mm):</span>

<span class="sd">        &gt;&gt;&gt; fluxes.r = 2.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.q0 = 1.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.q1 = 4.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_inrc_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.inrc</span>
<span class="sd">        inrc(4.1)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span> <span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneType</span><span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_derived</span><span class="o">.</span><span class="n">RelZoneAreas</span><span class="p">,</span>
        <span class="n">hland_derived</span><span class="o">.</span><span class="n">RelUpperZoneArea</span><span class="p">,</span>
        <span class="n">hland_derived</span><span class="o">.</span><span class="n">RelLowerZoneArea</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">R</span><span class="p">,</span> <span class="n">hland_fluxes</span><span class="o">.</span><span class="n">Q0</span><span class="p">,</span> <span class="n">hland_fluxes</span><span class="o">.</span><span class="n">Q1</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">InRC</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">inrc</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">relupperzonearea</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">q0</span> <span class="o">+</span> <span class="n">der</span><span class="o">.</span><span class="n">rellowerzonearea</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">q1</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">zonetype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">SEALED</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">inrc</span> <span class="o">+=</span> <span class="n">der</span><span class="o">.</span><span class="n">relzoneareas</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>



<div class="viewcode-block" id="Calc_InRC_V2">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_InRC_V2">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_InRC_V2</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the input of the runoff concentration submodel.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      .. math::</span>
<span class="sd">        InRC = A_L \cdot (RG2 + RG3) +</span>
<span class="sd">        \sum_{k=1}^{N}</span>
<span class="sd">        \begin{cases}</span>
<span class="sd">        RS + RI + RG1 &amp;|\ T_Z^k \in \{FI, FO, G \}</span>
<span class="sd">        \\</span>
<span class="sd">        R &amp;|\ T_Z^k = S</span>
<span class="sd">        \\</span>
<span class="sd">        0 &amp;|\ T_Z^k = L</span>
<span class="sd">        \end{cases}</span>
<span class="sd">        \\ \\</span>
<span class="sd">        N = NmbZones \\</span>
<span class="sd">        A_L = RelLowerZoneArea \\</span>
<span class="sd">        Z_T = ZoneType \\</span>
<span class="sd">        FI = FIELD \\</span>
<span class="sd">        FO = FOREST \\</span>
<span class="sd">        G = GLACIER \\</span>
<span class="sd">        S = SEALED \\</span>
<span class="sd">        L = ILAKE</span>

<span class="sd">    Example:</span>

<span class="sd">        Besides adding all components, method |Calc_InRC_V2| needs to aggregate the HRU</span>
<span class="sd">        level values of |RS|, |RI|, |RG1|, and |R| to the subbasin level:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(5)</span>
<span class="sd">        &gt;&gt;&gt; zonetype(FIELD, FOREST, GLACIER, ILAKE, SEALED)</span>
<span class="sd">        &gt;&gt;&gt; derived.relzoneareas(0.35, 0.25, 0.15, 0.05, 0.2)</span>
<span class="sd">        &gt;&gt;&gt; derived.rellowerzonearea(0.8)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.rs = 0.1, 0.2, 0.3, nan, nan</span>
<span class="sd">        &gt;&gt;&gt; fluxes.ri = 0.4, 0.6, 0.8, nan, nan</span>
<span class="sd">        &gt;&gt;&gt; fluxes.rg1 = 1.1, 1.4, 1.7, nan, nan</span>
<span class="sd">        &gt;&gt;&gt; fluxes.r = nan, nan, nan, nan, 2.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.rg2 = 3.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.rg3 = 4.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_inrc_v2()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.inrc</span>
<span class="sd">        inrc(7.53)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span> <span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneType</span><span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_derived</span><span class="o">.</span><span class="n">RelZoneAreas</span><span class="p">,</span> <span class="n">hland_derived</span><span class="o">.</span><span class="n">RelLowerZoneArea</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_fluxes</span><span class="o">.</span><span class="n">R</span><span class="p">,</span>
        <span class="n">hland_fluxes</span><span class="o">.</span><span class="n">RS</span><span class="p">,</span>
        <span class="n">hland_fluxes</span><span class="o">.</span><span class="n">RI</span><span class="p">,</span>
        <span class="n">hland_fluxes</span><span class="o">.</span><span class="n">RG1</span><span class="p">,</span>
        <span class="n">hland_fluxes</span><span class="o">.</span><span class="n">RG2</span><span class="p">,</span>
        <span class="n">hland_fluxes</span><span class="o">.</span><span class="n">RG3</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">InRC</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">inrc</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">rellowerzonearea</span> <span class="o">*</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">rg2</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">rg3</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">zonetype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">FIELD</span><span class="p">,</span> <span class="n">FOREST</span><span class="p">,</span> <span class="n">GLACIER</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">inrc</span> <span class="o">+=</span> <span class="n">der</span><span class="o">.</span><span class="n">relzoneareas</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">rs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">ri</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">rg1</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">con</span><span class="o">.</span><span class="n">zonetype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">SEALED</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">inrc</span> <span class="o">+=</span> <span class="n">der</span><span class="o">.</span><span class="n">relzoneareas</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>



<div class="viewcode-block" id="Calc_InRC_V3">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_InRC_V3">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_InRC_V3</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the input of the runoff concentration submodel.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      .. math::</span>
<span class="sd">        InRC = \sum_{k=1}^{N} \frac{A_Z^k}{A_L} \cdot</span>
<span class="sd">        \begin{cases}</span>
<span class="sd">        QAb1 + QAb2 &amp;|\ T_Z^k \in \{FI, FO, G \}</span>
<span class="sd">        \\</span>
<span class="sd">        R &amp;|\ T_Z^k = S</span>
<span class="sd">        \\</span>
<span class="sd">        0 &amp;|\ T_Z^k = L</span>
<span class="sd">        \end{cases}</span>
<span class="sd">        \\ \\</span>
<span class="sd">        N = NmbZones \\</span>
<span class="sd">        A_Z = RelZoneAreas \\</span>
<span class="sd">        A_L = RelLandArea \\</span>
<span class="sd">        T_Z = ZoneType \\</span>
<span class="sd">        FI = FIELD \\</span>
<span class="sd">        FO = FOREST \\</span>
<span class="sd">        G = GLACIER \\</span>
<span class="sd">        S = SEALED \\</span>
<span class="sd">        L = ILAKE</span>

<span class="sd">    Example:</span>

<span class="sd">        The runoff concentration submodel receives surface flow (|QAb1| and |QAb2|)</span>
<span class="sd">        from the first three zones of type |FIELD|, |FOREST|, and |GLACIER|, receives</span>
<span class="sd">        directly generated runoff from the fifth zone of type |SEALED|, and receives</span>
<span class="sd">        nothing from the fourth zone of type |ILAKE|:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(5)</span>
<span class="sd">        &gt;&gt;&gt; zonetype(FIELD, FOREST, GLACIER, ILAKE, SEALED)</span>
<span class="sd">        &gt;&gt;&gt; derived.relzoneareas = 0.35, 0.25, 0.15, 0.2, 0.05</span>
<span class="sd">        &gt;&gt;&gt; derived.rellandarea(0.8)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qab1 = 1.0, 2.0, 3.0, nan, nan</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qab2 = 3.0, 6.0, 9.0, nan, nan</span>
<span class="sd">        &gt;&gt;&gt; fluxes.r = nan, nan, nan, nan, 8.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_inrc_v3()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.inrc</span>
<span class="sd">        inrc(7.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span> <span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneType</span><span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_derived</span><span class="o">.</span><span class="n">RelZoneAreas</span><span class="p">,</span> <span class="n">hland_derived</span><span class="o">.</span><span class="n">RelLandArea</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">R</span><span class="p">,</span> <span class="n">hland_fluxes</span><span class="o">.</span><span class="n">QAb1</span><span class="p">,</span> <span class="n">hland_fluxes</span><span class="o">.</span><span class="n">QAb2</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">InRC</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">inrc</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">zonetype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">ILAKE</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">d_weight</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">relzoneareas</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">der</span><span class="o">.</span><span class="n">rellandarea</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">zonetype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">SEALED</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">inrc</span> <span class="o">+=</span> <span class="n">d_weight</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">inrc</span> <span class="o">+=</span> <span class="n">d_weight</span> <span class="o">*</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">qab1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">qab2</span><span class="p">[</span><span class="n">k</span><span class="p">])</span></div>



<div class="viewcode-block" id="Calc_OutRC_RConcModel_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_OutRC_RConcModel_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_OutRC_RConcModel_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Let a submodel that follows the |RConcModel_V1| submodel interface calculate</span>
<span class="sd">    runoff concentration.&quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">InRC</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">OutRC</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">submodel</span><span class="p">:</span> <span class="n">rconcinterfaces</span><span class="o">.</span><span class="n">RConcModel_V1</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">submodel</span><span class="o">.</span><span class="n">set_inflow</span><span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">inrc</span><span class="p">)</span>
        <span class="n">submodel</span><span class="o">.</span><span class="n">determine_outflow</span><span class="p">()</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">outrc</span> <span class="o">=</span> <span class="n">submodel</span><span class="o">.</span><span class="n">get_outflow</span><span class="p">()</span></div>



<div class="viewcode-block" id="Calc_OutRC_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_OutRC_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_OutRC_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;If the model has a submodel that follows the |RConcModel_V1| submodel interface,</span>
<span class="sd">    calculate runoff concentration. If not, set the output equal to the input.</span>

<span class="sd">    Examples:</span>

<span class="sd">        A model without a submodel for runoff concentration directs the input directly</span>
<span class="sd">        to the output:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland_96 import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.inrc = 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_outrc_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.outrc</span>
<span class="sd">        outrc(1.0)</span>

<span class="sd">        If a submodel for runoff concentration is added (in this case, a unit</span>
<span class="sd">        hydrograph with three ordinates), the output for the first time step</span>
<span class="sd">        corresponds to the portion of the input specified by the first ordinate (since</span>
<span class="sd">        the initial conditions of the logging sequence |rconc_logs.QUH| were set to</span>
<span class="sd">        zero, and thus no additional runoff portions from previous time steps are</span>
<span class="sd">        included):</span>

<span class="sd">        &gt;&gt;&gt; with model.add_rconcmodel_v1(&quot;rconc_uh&quot;):</span>
<span class="sd">        ...     uh([0.3,0.4,0.3])</span>
<span class="sd">        ...     logs.quh = 0.0, 0.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_outrc_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.outrc</span>
<span class="sd">        outrc(0.3)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMODELINTERFACES</span> <span class="o">=</span> <span class="p">(</span><span class="n">rconcinterfaces</span><span class="o">.</span><span class="n">RConcModel_V1</span><span class="p">,)</span>
    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Calc_OutRC_RConcModel_V1</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">InRC</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">OutRC</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">rconcmodel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">outrc</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">inrc</span>
        <span class="k">elif</span> <span class="n">model</span><span class="o">.</span><span class="n">rconcmodel_typeid</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">calc_outrc_rconcmodel_v1</span><span class="p">(</span>
                <span class="n">cast</span><span class="p">(</span><span class="n">rconcinterfaces</span><span class="o">.</span><span class="n">RConcModel_V1</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">rconcmodel</span><span class="p">)</span>
            <span class="p">)</span></div>



<div class="viewcode-block" id="Calc_RT_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_RT_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_RT_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the total discharge in mm.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">        :math:`RT = OutRC`</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.outrc = 3.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rt_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.rt</span>
<span class="sd">        rt(3.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">OutRC</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">RT</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">rt</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">outrc</span></div>



<div class="viewcode-block" id="Calc_RT_V2">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_RT_V2">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_RT_V2</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the total discharge in mm.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">        :math:`RT = RelUpperZoneArea \cdot OutRC + RelLowerZoneArea \cdot Q1`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; derived.rellandarea(0.8)</span>
<span class="sd">        &gt;&gt;&gt; derived.rellowerzonearea(0.6)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.outrc = 2.5</span>
<span class="sd">        &gt;&gt;&gt; fluxes.q1 = 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rt_v2()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.rt</span>
<span class="sd">        rt(2.6)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_derived</span><span class="o">.</span><span class="n">RelLandArea</span><span class="p">,</span> <span class="n">hland_derived</span><span class="o">.</span><span class="n">RelLowerZoneArea</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">OutRC</span><span class="p">,</span> <span class="n">hland_fluxes</span><span class="o">.</span><span class="n">Q1</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">RT</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">rt</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">rellandarea</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">outrc</span> <span class="o">+</span> <span class="n">der</span><span class="o">.</span><span class="n">rellowerzonearea</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">q1</span></div>



<div class="viewcode-block" id="Calc_QT_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_QT_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_QT_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the total discharge in m³/s.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">        :math:`QT = QFactor \cdot RT`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; derived.qfactor(0.5)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.rt = 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qt_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qt</span>
<span class="sd">        qt(1.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_derived</span><span class="o">.</span><span class="n">QFactor</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">RT</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">QT</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">qt</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">qfactor</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">rt</span></div>



<div class="viewcode-block" id="Pass_Q_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Pass_Q_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Pass_Q_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update the outlet link sequence.</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qt = 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.pass_q_v1()</span>
<span class="sd">        &gt;&gt;&gt; outlets.q</span>
<span class="sd">        q(2.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">QT</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_outlets</span><span class="o">.</span><span class="n">Q</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">outlets</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">out</span><span class="o">.</span><span class="n">q</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">qt</span></div>



<div class="viewcode-block" id="Get_Temperature_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Get_Temperature_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Get_Temperature_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the selected zone&#39;s current temperature.</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(2)</span>
<span class="sd">        &gt;&gt;&gt; factors.tc = 2.0, 4.0</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(model.get_temperature_v1(0))</span>
<span class="sd">        2.0</span>
<span class="sd">        &gt;&gt;&gt; round_(model.get_temperature_v1(1))</span>
<span class="sd">        4.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_factors</span><span class="o">.</span><span class="n">TC</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>

        <span class="k">return</span> <span class="n">fac</span><span class="o">.</span><span class="n">tc</span><span class="p">[</span><span class="n">s</span><span class="p">]</span></div>



<div class="viewcode-block" id="Get_MeanTemperature_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Get_MeanTemperature_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Get_MeanTemperature_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the basin&#39;s current mean temperature.</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; inputs.t = 2.0</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(model.get_meantemperature_v1())</span>
<span class="sd">        2.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_inputs</span><span class="o">.</span><span class="n">T</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">fastaccess</span>

        <span class="k">return</span> <span class="n">inp</span><span class="o">.</span><span class="n">t</span></div>



<div class="viewcode-block" id="Get_Precipitation_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Get_Precipitation_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Get_Precipitation_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the current precipitation from the selected zone.</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(2)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.pc = 2.0, 4.0</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(model.get_precipitation_v1(0))</span>
<span class="sd">        2.0</span>
<span class="sd">        &gt;&gt;&gt; round_(model.get_precipitation_v1(1))</span>
<span class="sd">        4.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">PC</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>

        <span class="k">return</span> <span class="n">flu</span><span class="o">.</span><span class="n">pc</span><span class="p">[</span><span class="n">s</span><span class="p">]</span></div>



<div class="viewcode-block" id="Get_InterceptedWater_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Get_InterceptedWater_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Get_InterceptedWater_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the selected zone&#39;s current amount of intercepted water.</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(2)</span>
<span class="sd">        &gt;&gt;&gt; states.ic = 2.0, 4.0</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(model.get_interceptedwater_v1(0))</span>
<span class="sd">        2.0</span>
<span class="sd">        &gt;&gt;&gt; round_(model.get_interceptedwater_v1(1))</span>
<span class="sd">        4.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_states</span><span class="o">.</span><span class="n">Ic</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>

        <span class="k">return</span> <span class="n">sta</span><span class="o">.</span><span class="n">ic</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>



<div class="viewcode-block" id="Get_SoilWater_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Get_SoilWater_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Get_SoilWater_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the selected zone&#39;s current soil water content.</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(2)</span>
<span class="sd">        &gt;&gt;&gt; states.sm = 2.0, 4.0</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(model.get_soilwater_v1(0))</span>
<span class="sd">        2.0</span>
<span class="sd">        &gt;&gt;&gt; round_(model.get_soilwater_v1(1))</span>
<span class="sd">        4.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_states</span><span class="o">.</span><span class="n">SM</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>

        <span class="k">return</span> <span class="n">sta</span><span class="o">.</span><span class="n">sm</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>



<div class="viewcode-block" id="Get_SnowCover_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Get_SnowCover_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Get_SnowCover_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the selected zone&#39;s current snow cover degree.</span>

<span class="sd">    Example:</span>

<span class="sd">        Each snow class with a non-zero amount of snow counts as completely covered:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(3)</span>
<span class="sd">        &gt;&gt;&gt; sclass(2)</span>
<span class="sd">        &gt;&gt;&gt; states.sp = [[0.0, 0.0, 1.0], [0.0, 1.0, 1.0]]</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(model.get_snowcover_v1(0))</span>
<span class="sd">        0.0</span>
<span class="sd">        &gt;&gt;&gt; round_(model.get_snowcover_v1(1))</span>
<span class="sd">        0.5</span>
<span class="sd">        &gt;&gt;&gt; round_(model.get_snowcover_v1(2))</span>
<span class="sd">        1.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_control</span><span class="o">.</span><span class="n">SClass</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_states</span><span class="o">.</span><span class="n">SP</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>

        <span class="n">snowcovered</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">sclass</span><span class="p">):</span>
            <span class="n">snowcovered</span> <span class="o">+=</span> <span class="n">sta</span><span class="o">.</span><span class="n">sp</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span>
        <span class="k">return</span> <span class="n">snowcovered</span> <span class="o">/</span> <span class="n">con</span><span class="o">.</span><span class="n">sclass</span></div>



<div class="viewcode-block" id="Model">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Model">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Model</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">AdHocModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;|hland.DOCNAME.complete|.&quot;&quot;&quot;</span>

    <span class="n">DOCNAME</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">DocName</span><span class="p">(</span><span class="n">short</span><span class="o">=</span><span class="s2">&quot;H&quot;</span><span class="p">)</span>
    <span class="n">__HYDPY_ROOTMODEL__</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">INLET_METHODS</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">OBSERVER_METHODS</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">RECEIVER_METHODS</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">RUN_METHODS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Calc_TC_V1</span><span class="p">,</span>
        <span class="n">Calc_FracRain_V1</span><span class="p">,</span>
        <span class="n">Calc_RFC_SFC_V1</span><span class="p">,</span>
        <span class="n">Calc_PC_V1</span><span class="p">,</span>
        <span class="n">Calc_TF_Ic_V1</span><span class="p">,</span>
        <span class="n">Calc_EI_Ic_V1</span><span class="p">,</span>
        <span class="n">Calc_SP_WC_V1</span><span class="p">,</span>
        <span class="n">Calc_SPL_WCL_SP_WC_V1</span><span class="p">,</span>
        <span class="n">Calc_SPG_WCG_SP_WC_V1</span><span class="p">,</span>
        <span class="n">Calc_CFAct_V1</span><span class="p">,</span>
        <span class="n">Calc_Melt_SP_WC_V1</span><span class="p">,</span>
        <span class="n">Calc_Refr_SP_WC_V1</span><span class="p">,</span>
        <span class="n">Calc_In_WC_V1</span><span class="p">,</span>
        <span class="n">Calc_SWE_V1</span><span class="p">,</span>
        <span class="n">Calc_SR_V1</span><span class="p">,</span>
        <span class="n">Calc_GAct_V1</span><span class="p">,</span>
        <span class="n">Calc_GlMelt_In_V1</span><span class="p">,</span>
        <span class="n">Calc_R_SM_V1</span><span class="p">,</span>
        <span class="n">Calc_CF_SM_V1</span><span class="p">,</span>
        <span class="n">Calc_EA_SM_V1</span><span class="p">,</span>
        <span class="n">Calc_InUZ_V1</span><span class="p">,</span>
        <span class="n">Calc_SUZ_V1</span><span class="p">,</span>
        <span class="n">Calc_ContriArea_V1</span><span class="p">,</span>
        <span class="n">Calc_Q0_Perc_UZ_V1</span><span class="p">,</span>
        <span class="n">Calc_DP_SUZ_V1</span><span class="p">,</span>
        <span class="n">Calc_QAb1_QVs1_BW1_V1</span><span class="p">,</span>
        <span class="n">Calc_QAb2_QVs2_BW2_V1</span><span class="p">,</span>
        <span class="n">Calc_RS_RI_SUZ_V1</span><span class="p">,</span>
        <span class="n">Calc_LZ_V1</span><span class="p">,</span>
        <span class="n">Calc_LZ_V2</span><span class="p">,</span>
        <span class="n">Calc_GR1_V1</span><span class="p">,</span>
        <span class="n">Calc_RG1_SG1_V1</span><span class="p">,</span>
        <span class="n">Calc_GR2_GR3_V1</span><span class="p">,</span>
        <span class="n">Calc_RG2_SG2_V1</span><span class="p">,</span>
        <span class="n">Calc_RG3_SG3_V1</span><span class="p">,</span>
        <span class="n">Calc_EL_SG2_SG3_V1</span><span class="p">,</span>
        <span class="n">Calc_EL_LZ_V1</span><span class="p">,</span>
        <span class="n">Calc_Q1_LZ_V1</span><span class="p">,</span>
        <span class="n">Calc_InRC_V1</span><span class="p">,</span>
        <span class="n">Calc_InRC_V3</span><span class="p">,</span>
        <span class="n">Calc_OutRC_V1</span><span class="p">,</span>
        <span class="n">Calc_InRC_V2</span><span class="p">,</span>
        <span class="n">Calc_RT_V1</span><span class="p">,</span>
        <span class="n">Calc_RT_V2</span><span class="p">,</span>
        <span class="n">Calc_QT_V1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">INTERFACE_METHODS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Get_Temperature_V1</span><span class="p">,</span>
        <span class="n">Get_MeanTemperature_V1</span><span class="p">,</span>
        <span class="n">Get_Precipitation_V1</span><span class="p">,</span>
        <span class="n">Get_InterceptedWater_V1</span><span class="p">,</span>
        <span class="n">Get_SoilWater_V1</span><span class="p">,</span>
        <span class="n">Get_SnowCover_V1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ADD_METHODS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Calc_EI_Ic_AETModel_V1</span><span class="p">,</span>
        <span class="n">Calc_EA_SM_AETModel_V1</span><span class="p">,</span>
        <span class="n">Calc_EL_LZ_AETModel_V1</span><span class="p">,</span>
        <span class="n">Calc_EL_SG2_SG3_AETModel_V1</span><span class="p">,</span>
        <span class="n">Calc_QAb_QVs_BW_V1</span><span class="p">,</span>
        <span class="n">Calc_OutRC_RConcModel_V1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">OUTLET_METHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Pass_Q_V1</span><span class="p">,)</span>
    <span class="n">SENDER_METHODS</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">SUBMODELINTERFACES</span> <span class="o">=</span> <span class="p">(</span><span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="p">,</span> <span class="n">rconcinterfaces</span><span class="o">.</span><span class="n">RConcModel_V1</span><span class="p">)</span>
    <span class="n">SUBMODELS</span> <span class="o">=</span> <span class="p">()</span>

    <span class="n">aetmodel</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelProperty</span><span class="p">(</span><span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="p">)</span>
    <span class="n">aetmodel_is_mainmodel</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelIsMainmodelProperty</span><span class="p">()</span>
    <span class="n">aetmodel_typeid</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelTypeIDProperty</span><span class="p">()</span>

    <span class="n">rconcmodel</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelProperty</span><span class="p">(</span><span class="n">rconcinterfaces</span><span class="o">.</span><span class="n">RConcModel_V1</span><span class="p">)</span>
    <span class="n">rconcmodel_is_mainmodel</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelIsMainmodelProperty</span><span class="p">()</span>
    <span class="n">rconcmodel_typeid</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelTypeIDProperty</span><span class="p">()</span></div>



<div class="viewcode-block" id="Main_AETModel_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Main_AETModel_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Main_AETModel_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">AdHocModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for |hland.DOCNAME.long| models that use submodels that comply with</span>
<span class="sd">    the |AETModel_V1| interface.&quot;&quot;&quot;</span>

    <span class="n">aetmodel</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelProperty</span>
    <span class="n">aetmodel_is_mainmodel</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelIsMainmodelProperty</span><span class="p">()</span>
    <span class="n">aetmodel_typeid</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelTypeIDProperty</span><span class="p">()</span>

    <span class="nd">@importtools</span><span class="o">.</span><span class="n">prepare_submodel</span><span class="p">(</span>
        <span class="s2">&quot;aetmodel&quot;</span><span class="p">,</span>
        <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="p">,</span>
        <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="o">.</span><span class="n">prepare_nmbzones</span><span class="p">,</span>
        <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="o">.</span><span class="n">prepare_subareas</span><span class="p">,</span>
        <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="o">.</span><span class="n">prepare_elevations</span><span class="p">,</span>
        <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="o">.</span><span class="n">prepare_maxsoilwater</span><span class="p">,</span>
        <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="o">.</span><span class="n">prepare_water</span><span class="p">,</span>
        <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="o">.</span><span class="n">prepare_interception</span><span class="p">,</span>
        <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="o">.</span><span class="n">prepare_soil</span><span class="p">,</span>
        <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="o">.</span><span class="n">prepare_plant</span><span class="p">,</span>
        <span class="n">landtype_constants</span><span class="o">=</span><span class="n">hland_constants</span><span class="o">.</span><span class="n">CONSTANTS</span><span class="p">,</span>
        <span class="n">landtype_refindices</span><span class="o">=</span><span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneType</span><span class="p">,</span>
        <span class="n">refweights</span><span class="o">=</span><span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneArea</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_aetmodel_v1</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">aetmodel</span><span class="p">:</span> <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="p">,</span>
        <span class="o">/</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">refresh</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>  <span class="c1"># pylint: disable=unused-argument</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialise the given submodel that follows the |AETModel_V1| interface and</span>
<span class="sd">        is responsible for calculating the different kinds of actual</span>
<span class="sd">        evapotranspiration.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland_96 import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(5)</span>
<span class="sd">        &gt;&gt;&gt; area(10.0)</span>
<span class="sd">        &gt;&gt;&gt; zonetype(FIELD, FOREST, ILAKE, GLACIER, SEALED)</span>
<span class="sd">        &gt;&gt;&gt; zonearea(2.0)</span>
<span class="sd">        &gt;&gt;&gt; zonez(3.0)</span>
<span class="sd">        &gt;&gt;&gt; fc(200.0)</span>
<span class="sd">        &gt;&gt;&gt; with model.add_aetmodel_v1(&quot;evap_aet_hbv96&quot;):</span>
<span class="sd">        ...     nmbhru</span>
<span class="sd">        ...     water</span>
<span class="sd">        ...     interception</span>
<span class="sd">        ...     soil</span>
<span class="sd">        ...     excessreduction(field=1.0, forest=0.5, default=nan)</span>
<span class="sd">        ...     for method, arguments in model.preparemethod2arguments.items():</span>
<span class="sd">        ...         print(method, arguments[0][0], sep=&quot;: &quot;)</span>
<span class="sd">        nmbhru(5)</span>
<span class="sd">        water(field=False, forest=False, glacier=False, ilake=True,</span>
<span class="sd">              sealed=False)</span>
<span class="sd">        interception(field=True, forest=True, glacier=False, ilake=False,</span>
<span class="sd">                     sealed=True)</span>
<span class="sd">        soil(field=True, forest=True, glacier=False, ilake=False, sealed=False)</span>
<span class="sd">        prepare_nmbzones: 5</span>
<span class="sd">        prepare_zonetypes: [1 2 4 3 5]</span>
<span class="sd">        prepare_subareas: [2. 2. 2. 2. 2.]</span>
<span class="sd">        prepare_elevations: [300. 300. 300. 300. 300.]</span>
<span class="sd">        prepare_maxsoilwater: [200. 200. 200. 200. 200.]</span>
<span class="sd">        prepare_water: [False False  True False False]</span>
<span class="sd">        prepare_interception: [ True  True False False  True]</span>
<span class="sd">        prepare_plant: [ True  True False False False]</span>
<span class="sd">        prepare_soil: [ True  True False False False]</span>

<span class="sd">        &gt;&gt;&gt; ered = model.aetmodel.parameters.control.excessreduction</span>
<span class="sd">        &gt;&gt;&gt; ered</span>
<span class="sd">        excessreduction(field=1.0, forest=0.5)</span>
<span class="sd">        &gt;&gt;&gt; zonetype(FOREST, FIELD, ILAKE, GLACIER, SEALED)</span>
<span class="sd">        &gt;&gt;&gt; ered</span>
<span class="sd">        excessreduction(field=0.5, forest=1.0)</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(ered.average_values())</span>
<span class="sd">        0.75</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">control</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span>
        <span class="n">nmbzones</span> <span class="o">=</span> <span class="n">control</span><span class="o">.</span><span class="n">nmbzones</span><span class="o">.</span><span class="n">value</span>
        <span class="n">zonetype</span> <span class="o">=</span> <span class="n">control</span><span class="o">.</span><span class="n">zonetype</span><span class="o">.</span><span class="n">values</span>

        <span class="n">aetmodel</span><span class="o">.</span><span class="n">prepare_nmbzones</span><span class="p">(</span><span class="n">nmbzones</span><span class="p">)</span>
        <span class="n">aetmodel</span><span class="o">.</span><span class="n">prepare_zonetypes</span><span class="p">(</span><span class="n">zonetype</span><span class="p">)</span>
        <span class="n">aetmodel</span><span class="o">.</span><span class="n">prepare_subareas</span><span class="p">(</span><span class="n">control</span><span class="o">.</span><span class="n">zonearea</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="n">aetmodel</span><span class="o">.</span><span class="n">prepare_elevations</span><span class="p">(</span><span class="mf">100.0</span> <span class="o">*</span> <span class="n">control</span><span class="o">.</span><span class="n">zonez</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">aetmodel</span><span class="o">.</span><span class="n">prepare_maxsoilwater</span><span class="p">(</span><span class="n">control</span><span class="o">.</span><span class="n">fc</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">sel</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">nmbzones</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">NP_BOOL</span><span class="p">)</span>
        <span class="n">sel</span><span class="p">[</span><span class="n">zonetype</span> <span class="o">==</span> <span class="n">ILAKE</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">aetmodel</span><span class="o">.</span><span class="n">prepare_water</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span>
        <span class="n">sel</span> <span class="o">=</span> <span class="o">~</span><span class="n">sel</span>
        <span class="n">sel</span><span class="p">[</span><span class="n">zonetype</span> <span class="o">==</span> <span class="n">GLACIER</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">aetmodel</span><span class="o">.</span><span class="n">prepare_interception</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span>
        <span class="n">sel</span><span class="p">[</span><span class="n">zonetype</span> <span class="o">==</span> <span class="n">SEALED</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">aetmodel</span><span class="o">.</span><span class="n">prepare_plant</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span>
        <span class="n">aetmodel</span><span class="o">.</span><span class="n">prepare_soil</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span></div>



<div class="viewcode-block" id="Main_RConcModel_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Main_RConcModel_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Main_RConcModel_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">AdHocModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for |hland.DOCNAME.long| models that use submodels that comply with</span>
<span class="sd">    the |RConcModel_V1| interface.&quot;&quot;&quot;</span>

    <span class="n">rconcmodel</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelProperty</span>
    <span class="n">rconcmodel_is_mainmodel</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelIsMainmodelProperty</span><span class="p">()</span>
    <span class="n">rconcmodel_typeid</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelTypeIDProperty</span><span class="p">()</span>

    <span class="nd">@importtools</span><span class="o">.</span><span class="n">prepare_submodel</span><span class="p">(</span><span class="s2">&quot;rconcmodel&quot;</span><span class="p">,</span> <span class="n">rconcinterfaces</span><span class="o">.</span><span class="n">RConcModel_V1</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_rconcmodel_v1</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">rconcmodel</span><span class="p">:</span> <span class="n">rconcinterfaces</span><span class="o">.</span><span class="n">RConcModel_V1</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">refresh</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialise the given submodel that follows the |RConcModel_V1| interface and</span>
<span class="sd">        is responsible for calculating the runoff concentration.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland_96 import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; with model.add_rconcmodel_v1(&quot;rconc_uh&quot;):</span>
<span class="sd">        ...     uh([0.3, 0.5, 0.2])</span>
<span class="sd">        ...     logs.quh.shape = 3</span>
<span class="sd">        ...     logs.quh = 1.0, 3.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.sequences.fluxes.inrc = 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_outrc_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.outrc</span>
<span class="sd">        outrc(1.0)</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_rconcmodel_waterbalance</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">initial_conditions</span><span class="p">:</span> <span class="n">ConditionsModel</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Get the water balance of the rconc submodel if used.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rconcmodel</span><span class="p">:</span>
            <span class="n">rconcmodel_conditions</span> <span class="o">=</span> <span class="n">initial_conditions</span><span class="p">[</span><span class="s2">&quot;model.rconcmodel&quot;</span><span class="p">]</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rconcmodel</span><span class="o">.</span><span class="n">get_waterbalance</span><span class="p">(</span><span class="n">rconcmodel_conditions</span><span class="p">)</span>
        <span class="k">return</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Sub_TempModel_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Sub_TempModel_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Sub_TempModel_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">AdHocModel</span><span class="p">,</span> <span class="n">tempinterfaces</span><span class="o">.</span><span class="n">TempModel_V1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for |hland.DOCNAME.long| models that comply with the |TempModel_V1|</span>
<span class="sd">    submodel interface.&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="Sub_PrecipModel_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Sub_PrecipModel_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Sub_PrecipModel_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">AdHocModel</span><span class="p">,</span> <span class="n">precipinterfaces</span><span class="o">.</span><span class="n">PrecipModel_V1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for |hland.DOCNAME.long| models that comply with the |PrecipModel_V1|</span>
<span class="sd">    submodel interface.&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="Sub_IntercModel_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Sub_IntercModel_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Sub_IntercModel_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">AdHocModel</span><span class="p">,</span> <span class="n">stateinterfaces</span><span class="o">.</span><span class="n">IntercModel_V1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for |hland.DOCNAME.long| models that comply with the |IntercModel_V1|</span>
<span class="sd">    submodel interface.&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="Sub_SoilWaterModel_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Sub_SoilWaterModel_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Sub_SoilWaterModel_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">AdHocModel</span><span class="p">,</span> <span class="n">stateinterfaces</span><span class="o">.</span><span class="n">SoilWaterModel_V1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for |hland.DOCNAME.long| models that comply with the</span>
<span class="sd">    |SoilWaterModel_V1| submodel interface.&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="Sub_SnowCoverModel_V1">
<a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Sub_SnowCoverModel_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Sub_SnowCoverModel_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">AdHocModel</span><span class="p">,</span> <span class="n">stateinterfaces</span><span class="o">.</span><span class="n">SnowCoverModel_V1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for |hland.DOCNAME.long| models that comply with the</span>
<span class="sd">    |SnowCoverModel_V1| submodel interface.&quot;&quot;&quot;</span></div>

</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">HydPy 6.2.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">hydpy.models.hland.hland_model</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2013-2025, HydPy Developers.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 9.0.4.
    </div>
  </body>
</html>