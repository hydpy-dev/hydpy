# pylint: disable=line-too-long, unused-wildcard-import
"""

Integration tests
=================

.. how_to_understand_integration_tests::


>>> from hydpy import pub
>>> pub.timegrids = "2000-01-01", "2000-03-01", "1d"

>>> from hydpy import Element, FusedVariable, Node, Nodes
>>> from hydpy.aliases import dam_observers_R, dam_states_WaterVolume, manage_senders_Request
>>> t = Node("t")
>>> r_1, r_1a, r_2, r_2a, r_2b, r_2b1 = Nodes(
...     "r_1", "r_1a", "r_2", "r_2a", "r_2b", "r_2b1",
...     defaultvariable=FusedVariable("R", dam_observers_R, manage_senders_Request),
... )
>>> v_1, v_1a, v_2, v_2a, v_2b, v_2b1 = Nodes(
...     "v_1", "v_1a", "v_2", "v_2a", "v_2b", "v_2b1",
...     defaultvariable=dam_states_WaterVolume,
... )
>>> d_1 = Element("d_1", inlets="q_1a_1", outlets=t, observers=r_1, outputs=v_1)
>>> d_1a = Element("d_1a", outlets="q_1a_1", observers=r_1a, outputs=v_1a)
>>> d_2 = Element("d_2", inlets=("q_2a_2", "q_2b_2"), outlets=t, observers=r_2, outputs=v_2)
>>> d_2a = Element("d_2a", outlets="q_2a_2", observers=r_2a, outputs=v_2a)
>>> d_2b = Element("d_2b", inlets="q_2b1_2b", outlets="q_2b_2", observers=r_2b, outputs=v_2b)
>>> d_2b1 = Element("d_2b1", outlets="q_2b1_2b", observers=r_2b1, outputs=v_2b1)
>>> dams = d_1, d_1a, d_2, d_2a, d_2b, d_2b1

>>> lwc = Element(
...     "lwc",
...     receivers=[t, v_1, v_1a, v_2, v_2a, v_2b, v_2b1],
...     senders=[r_1, r_1a, r_2, r_2a, r_2b, r_2b1],
... )

>>> from hydpy import PPoly, prepare_model
>>> from numpy import inf
>>> for dam in dams:
...     dam.model = prepare_model("dam_llake")
...     control = dam.model.parameters.control
...     control.catchmentarea(86.4)
...     control.surfacearea(1.44)
...     control.correctionprecipitation(1.2)
...     control.correctionevaporation(1.2)
...     control.weightevaporation(0.8)
...     control.thresholdevaporation(0.0)
...     control.dischargetolerance(0.1)
...     control.toleranceevaporation(0.001)
...     control.allowedwaterleveldrop(inf)
...     control.watervolume2waterlevel(PPoly.from_data(xs=[0.0, 1.0], ys=[0.0, 1.0]))
...     control.waterlevel2flooddischarge(PPoly.from_data(xs=[0.0, 1.0], ys=[0.0, 0.1]))
...     control.commission(0)
...     control.pars.update()


>>> from hydpy.models.manage_lwc import *
>>> parameterstep()
>>> dischargemin(1.0)
>>> dischargemax(1.1)
>>> nmbsources(6)
>>> active(d_1=True, d_1a=True, d_2=True, d_2a=True, d_2b=True, d_2b1=True)
>>> volumemin(d_1=0.0, d_1a=0.0, d_2=0.0, d_2a=0.0, d_2b=0.0, d_2b1=0.0)
>>> volumemax(d_1=1.0, d_1a=1.0, d_2=1.0, d_2a=1.0, d_2b=1.0, d_2b1=1.0)
>>> releasemax(d_1=0.5, d_1a=0.5, d_2=0.5, d_2a=0.5, d_2b=0.5, d_2b1=0.5)


>>> lwc.model = model

>>> from hydpy.core.testtools import IntegrationTest
>>> test = IntegrationTest(lwc)


>>> inits = [(logs.loggedwatervolume, 1.0), (logs.loggeddischarge, 2.0)]
>>> for dam in dams:
...     inits.append((dam.model.sequences.states.watervolume, 1.0))
...     inits.append((dam.model.sequences.logs.loggedadjustedevaporation, 0.0))
>>> test.inits = inits

.. _manage_lwc_base_scenario:

base scenario
_____________


.. integration-test::

    >>> test("manage_lwc_base_scenario")
    |                date |   demand |                                                    request |   q_1a_1 |   q_2a_2 | q_2b1_2b |   q_2b_2 |      r_1 |     r_1a |      r_2 |     r_2a |     r_2b |    r_2b1 |        t |       v_1 |      v_1a |      v_2 |     v_2a |     v_2b |     v_2b1 |
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    | 2000-01-01 00:00:00 |      0.0 |      0.0       0.0       0.0       0.0       0.0       0.0 | 0.099569 | 0.099569 | 0.099569 | 0.099998 |      0.0 |      0.0 |      0.0 |      0.0 |      0.0 |      0.0 | 0.200427 |  0.999963 |  0.991397 | 1.008566 | 0.991397 | 0.999963 |  0.991397 |
    | 2000-01-02 00:00:00 |      1.0 |      0.5  0.000429       0.5       0.0       0.0  0.000429 | 0.108946 | 0.098713 | 0.108946 | 0.100035 |      0.5 | 0.000429 |      0.5 |      0.0 |      0.0 | 0.000429 | 1.000134 |   0.96617 |  0.981984 | 0.982532 | 0.982868 | 1.000733 |  0.981984 |
    | 2000-01-03 00:00:00 | 0.998661 | 0.499331  0.391549  0.499331  0.101091  0.101091       0.0 |  0.39195 | 0.140393 | 0.097775 | 0.141473 | 0.499331 | 0.391549 | 0.499331 | 0.101091 | 0.101091 |      0.0 | 0.998792 |  0.956887 |   0.94812 | 0.963737 | 0.970739 | 0.996957 |  0.973536 |
    | 2000-01-04 00:00:00 |      1.0 |      0.5  0.498994       0.5  0.209856  0.209856  0.035216 | 0.499055 | 0.217919 | 0.114713 | 0.218325 |      0.5 | 0.498994 |      0.5 | 0.209856 | 0.209856 | 0.035216 | 1.000127 |    0.9568 |  0.905001 | 0.958223 |  0.95191 | 0.988005 |  0.963625 |
    | 2000-01-05 00:00:00 | 0.998729 | 0.499364       0.5  0.499364  0.241766  0.241766  0.138828 | 0.500056 | 0.246443 | 0.162083 | 0.246782 | 0.499364 |      0.5 | 0.499364 | 0.241766 | 0.241766 | 0.138828 | 0.998857 |  0.956854 |  0.861797 | 0.957687 | 0.930618 | 0.980687 |  0.949621 |
    | 2000-01-06 00:00:00 |      1.0 |      0.5  0.499374       0.5  0.244867  0.244867  0.223527 | 0.499427 | 0.249162 | 0.229793 | 0.249602 |      0.5 | 0.499374 |      0.5 | 0.244867 | 0.244867 | 0.223527 | 1.000127 |  0.956799 |  0.818646 | 0.957575 |  0.90909 | 0.978976 |  0.929767 |
    | 2000-01-07 00:00:00 | 0.998732 | 0.499366       0.5  0.499366  0.245516  0.245516  0.243337 | 0.500048 | 0.249619 | 0.247735 | 0.250195 | 0.499366 |      0.5 | 0.499366 | 0.245516 | 0.245516 | 0.243337 |  0.99886 |  0.956852 |  0.775442 | 0.957608 | 0.887523 | 0.978763 |  0.908363 |
    | 2000-01-08 00:00:00 |      1.0 |      0.5  0.499393       0.5  0.245325  0.245325  0.245797 | 0.499438 | 0.249298 | 0.249876 | 0.250017 |      0.5 | 0.499393 |      0.5 | 0.245325 | 0.245325 | 0.245797 | 1.000127 |  0.956798 |   0.73229 | 0.957543 | 0.865984 | 0.978751 |  0.886774 |
    | 2000-01-09 00:00:00 | 0.998732 | 0.499366       0.5  0.499366  0.245699  0.245699  0.245938 | 0.500042 | 0.249511 | 0.249866 | 0.250362 | 0.499366 |      0.5 | 0.499366 | 0.245699 | 0.245699 | 0.245938 |  0.99886 |  0.956851 |  0.689087 | 0.957582 | 0.844426 | 0.978708 |  0.865185 |
    | 2000-01-10 00:00:00 |      1.0 |      0.5  0.499406       0.5  0.245477  0.245477  0.246434 | 0.499446 | 0.249171 | 0.250195 | 0.250158 |      0.5 | 0.499406 |      0.5 | 0.245477 | 0.245477 | 0.246434 | 1.000127 |  0.956798 |  0.645935 | 0.957518 | 0.822897 | 0.978711 |  0.843568 |
    | 2000-01-11 00:00:00 | 0.998732 | 0.499366       0.5  0.499366  0.245845  0.245845  0.246396 | 0.500036 | 0.249389 | 0.250029 | 0.250497 | 0.499366 |      0.5 | 0.499366 | 0.245845 | 0.245845 | 0.246396 |  0.99886 |   0.95685 |  0.602732 | 0.957557 |  0.80135 | 0.978671 |  0.821966 |
    | 2000-01-12 00:00:00 |      1.0 |      0.5  0.499418       0.5  0.245617  0.245617  0.246864 | 0.499452 | 0.249051 | 0.250344 | 0.250287 |      0.5 | 0.499418 |      0.5 | 0.245617 | 0.245617 | 0.246864 | 1.000127 |  0.956797 |  0.559579 | 0.957495 | 0.779832 | 0.978676 |  0.800336 |
    | 2000-01-13 00:00:00 | 0.998732 | 0.499366       0.5  0.499366   0.24598   0.24598  0.246807 | 0.500031 | 0.249275 | 0.250168 | 0.250622 | 0.499366 |      0.5 | 0.499366 |  0.24598 |  0.24598 | 0.246807 |  0.99886 |  0.956849 |  0.516376 | 0.957535 | 0.758295 | 0.978637 |  0.778722 |
    | 2000-01-14 00:00:00 |      1.0 |      0.5  0.499428       0.5  0.245747  0.245747  0.247261 | 0.499458 | 0.248939 |  0.25048 | 0.250406 |      0.5 | 0.499428 |      0.5 | 0.245747 | 0.245747 | 0.247261 | 1.000127 |  0.956797 |  0.473223 | 0.957473 | 0.736787 | 0.978643 |   0.75708 |
    | 2000-01-15 00:00:00 | 0.998732 | 0.499366       0.5  0.499366  0.246106  0.246106  0.247187 | 0.500027 | 0.249169 | 0.250298 | 0.250738 | 0.499366 |      0.5 | 0.499366 | 0.246106 | 0.246106 | 0.247187 | 0.998861 |  0.956849 |  0.430021 | 0.957514 | 0.715258 | 0.978605 |  0.735454 |
    | 2000-01-16 00:00:00 |      1.0 |      0.5  0.499437       0.5  0.245868  0.245868  0.247628 | 0.499463 | 0.248835 | 0.250607 | 0.250518 |      0.5 | 0.499437 |      0.5 | 0.245868 | 0.245868 | 0.247628 | 1.000127 |  0.956797 |  0.386867 | 0.957453 | 0.693759 | 0.978613 |  0.713802 |
    | 2000-01-17 00:00:00 | 0.998732 | 0.499366       0.5  0.499366  0.246223  0.246223  0.247538 | 0.500023 |  0.24907 | 0.250417 | 0.250846 | 0.499366 |      0.5 | 0.499366 | 0.246223 | 0.246223 | 0.247538 | 0.998861 |  0.956848 |  0.343665 | 0.957495 | 0.672239 | 0.978576 |  0.692166 |
    | 2000-01-18 00:00:00 |      1.0 |      0.5  0.499445       0.5   0.24598   0.24598  0.247967 | 0.499467 | 0.248739 | 0.250725 | 0.250621 |      0.5 | 0.499445 |      0.5 |  0.24598 |  0.24598 | 0.247967 | 1.000127 |  0.956796 |  0.300511 | 0.957434 | 0.650748 | 0.978585 |  0.670503 |
    | 2000-01-19 00:00:00 | 0.998732 | 0.499366       0.5  0.499366  0.246332  0.246332  0.247863 |  0.50002 | 0.248979 | 0.250529 | 0.250946 | 0.499366 |      0.5 | 0.499366 | 0.246332 | 0.246332 | 0.247863 | 0.998861 |  0.956847 |   0.25731 | 0.957477 | 0.629237 | 0.978549 |  0.648857 |
    | 2000-01-20 00:00:00 |      1.0 |      0.5  0.499452       0.5  0.246084  0.246084   0.24828 |  0.49947 | 0.248649 | 0.250835 | 0.250717 |      0.5 | 0.499452 |      0.5 | 0.246084 | 0.246084 |  0.24828 | 1.000127 |  0.956796 |  0.214155 | 0.957416 | 0.607753 | 0.978559 |  0.627185 |
    | 2000-01-21 00:00:00 | 0.998732 | 0.499366       0.5  0.499366  0.246433  0.246433  0.248163 | 0.500017 | 0.248894 | 0.250632 | 0.251039 | 0.499366 |      0.5 | 0.499366 | 0.246433 | 0.246433 | 0.248163 | 0.998861 |  0.956847 |  0.170954 |  0.95746 | 0.586249 | 0.978524 |  0.605531 |
    | 2000-01-22 00:00:00 |      1.0 |      0.5  0.499457       0.5  0.246181  0.246181   0.24857 | 0.499474 | 0.248566 | 0.250936 | 0.250807 |      0.5 | 0.499457 |      0.5 | 0.246181 | 0.246181 |  0.24857 | 1.000127 |  0.956796 |  0.127799 |   0.9574 | 0.564773 | 0.978535 |   0.58385 |
    | 2000-01-23 00:00:00 | 0.998732 | 0.499366       0.5  0.499366  0.246527  0.246527   0.24844 | 0.500015 | 0.248815 | 0.250728 | 0.251126 | 0.499366 |      0.5 | 0.499366 | 0.246527 | 0.246527 |  0.24844 | 0.998861 |  0.956846 |  0.084598 | 0.957444 | 0.543275 |   0.9785 |  0.562187 |
    | 2000-01-24 00:00:00 |      1.0 |      0.5  0.499462       0.5  0.246271  0.246271  0.248838 | 0.499476 | 0.248489 | 0.251031 |  0.25089 |      0.5 | 0.499462 |      0.5 | 0.246271 | 0.246271 | 0.248838 | 1.000127 |  0.956796 |  0.041443 | 0.957385 | 0.521806 | 0.978513 |  0.540498 |
    | 2000-01-25 00:00:00 | 0.998732 | 0.499366  0.479667  0.499366  0.246614  0.246614  0.248698 | 0.479685 | 0.248741 | 0.250817 | 0.251207 | 0.499366 | 0.479667 | 0.499366 | 0.246614 | 0.246614 | 0.248698 | 0.998861 |   0.95509 | -0.000002 |  0.95743 | 0.500315 | 0.978479 |  0.518827 |
    | 2000-01-26 00:00:00 |      1.0 |      0.5       0.0       0.5  0.246355  0.246355  0.249087 |      0.0 | 0.248417 | 0.251118 | 0.250967 |      0.5 |      0.0 |      0.5 | 0.246355 | 0.246355 | 0.249087 | 1.000124 |  0.911884 | -0.000002 | 0.957371 | 0.478851 | 0.978492 |  0.497131 |
    | 2000-01-27 00:00:00 | 0.998757 | 0.499378       0.0  0.499378  0.246695  0.246695  0.248936 |      0.0 | 0.248673 |   0.2509 | 0.251281 | 0.499378 |      0.0 | 0.499378 | 0.246695 | 0.246695 | 0.248936 | 0.998878 |  0.868733 | -0.000002 | 0.957415 | 0.457366 | 0.978459 |  0.475453 |
    | 2000-01-28 00:00:00 |      1.0 |      0.5       0.0       0.5  0.246439  0.246439  0.249317 |      0.0 | 0.248356 |   0.2512 | 0.251044 |      0.5 |      0.0 |      0.5 | 0.246439 | 0.246439 | 0.249317 | 1.000116 |  0.825529 | -0.000002 | 0.957358 | 0.435908 | 0.978472 |  0.453749 |
    | 2000-01-29 00:00:00 |  0.99884 |  0.49942       0.0   0.49942   0.24677   0.24677  0.249162 |      0.0 |  0.24861 | 0.250982 | 0.251351 |  0.49942 |      0.0 |  0.49942 |  0.24677 |  0.24677 | 0.249162 | 0.998953 |  0.782375 | -0.000002 | 0.957399 | 0.414428 | 0.978441 |  0.432064 |
    | 2000-01-30 00:00:00 |      1.0 |      0.5       0.0       0.5  0.246532  0.246532   0.24953 |      0.0 | 0.248314 | 0.251276 |  0.25113 |      0.5 |      0.0 |      0.5 | 0.246532 | 0.246532 |  0.24953 | 1.000109 |  0.739171 | -0.000002 | 0.957346 | 0.392974 | 0.978453 |  0.410354 |
    | 2000-01-31 00:00:00 | 0.998911 | 0.499456       0.0  0.499456  0.246841  0.246841  0.249385 |      0.0 | 0.248552 | 0.251072 | 0.251417 | 0.499456 |      0.0 | 0.499456 | 0.246841 | 0.246841 | 0.249385 | 0.999018 |  0.696014 | -0.000002 | 0.957385 | 0.371499 | 0.978423 |  0.388661 |
    | 2000-02-01 00:00:00 |      1.0 |      0.5       0.0       0.5  0.246617  0.246617  0.249729 |      0.0 | 0.248273 | 0.251347 | 0.251209 |      0.5 |      0.0 |      0.5 | 0.246617 | 0.246617 | 0.249729 | 1.000103 |  0.652811 | -0.000002 | 0.957334 | 0.350048 | 0.978435 |  0.366945 |
    | 2000-02-02 00:00:00 | 0.998973 | 0.499486       0.0  0.499486  0.246907  0.246907  0.249591 |      0.0 | 0.248498 | 0.251155 | 0.251478 | 0.499486 |      0.0 | 0.499486 | 0.246907 | 0.246907 | 0.249591 | 0.999074 |  0.609652 | -0.000002 | 0.957371 | 0.328578 | 0.978407 |  0.345245 |
    | 2000-02-03 00:00:00 |      1.0 |      0.5       0.0       0.5  0.246695  0.246695  0.249914 |      0.0 | 0.248235 | 0.251414 | 0.251281 |      0.5 |      0.0 |      0.5 | 0.246695 | 0.246695 | 0.249914 | 1.000097 |  0.566449 | -0.000002 | 0.957324 |  0.30713 | 0.978419 |  0.323523 |
    | 2000-02-04 00:00:00 | 0.999026 | 0.499513       0.0  0.499513  0.246969  0.246969   0.24978 |      0.0 | 0.248448 | 0.251231 | 0.251534 | 0.499513 |      0.0 | 0.499513 | 0.246969 | 0.246969 |  0.24978 | 0.999122 |  0.523288 | -0.000002 | 0.957359 | 0.285664 | 0.978393 |  0.301817 |
    | 2000-02-05 00:00:00 |      1.0 |      0.5       0.0       0.5  0.246766  0.246766  0.250084 |      0.0 | 0.248198 | 0.251476 | 0.251347 |      0.5 |      0.0 |      0.5 | 0.246766 | 0.246766 | 0.250084 | 1.000093 |  0.480086 | -0.000002 | 0.957314 |  0.26422 | 0.978404 |  0.280089 |
    | 2000-02-06 00:00:00 | 0.999073 | 0.499536       0.0  0.499536  0.247025  0.247025  0.249955 |      0.0 | 0.248401 |   0.2513 | 0.251587 | 0.499536 |      0.0 | 0.499536 | 0.247025 | 0.247025 | 0.249955 | 0.999164 |  0.436923 | -0.000002 | 0.957347 | 0.242758 | 0.978379 |  0.258377 |
    | 2000-02-07 00:00:00 |      1.0 |      0.5       0.0       0.5  0.246832  0.246832  0.250242 |      0.0 | 0.248163 | 0.251533 | 0.251407 |      0.5 |      0.0 |      0.5 | 0.246832 | 0.246832 | 0.250242 | 1.000089 |  0.393721 | -0.000002 | 0.957305 | 0.221317 |  0.97839 |  0.236645 |
    | 2000-02-08 00:00:00 | 0.999112 | 0.499556       0.0  0.499556  0.247078  0.247078  0.250117 |      0.0 | 0.248357 | 0.251364 | 0.251636 | 0.499556 |      0.0 | 0.499556 | 0.247078 | 0.247078 | 0.250117 |   0.9992 |  0.350557 | -0.000002 | 0.957337 | 0.199859 | 0.978366 |  0.214927 |
    | 2000-02-09 00:00:00 |      1.0 |      0.5       0.0       0.5  0.246892  0.246892  0.250389 |      0.0 |  0.24813 | 0.251586 | 0.251463 |      0.5 |      0.0 |      0.5 | 0.246892 | 0.246892 | 0.250389 | 1.000085 |  0.307356 | -0.000002 | 0.957296 | 0.178421 | 0.978377 |   0.19319 |
    | 2000-02-10 00:00:00 | 0.999147 | 0.499573       0.0  0.499573  0.247127  0.247127  0.250266 |      0.0 | 0.248317 | 0.251423 | 0.251681 | 0.499573 |      0.0 | 0.499573 | 0.247127 | 0.247127 | 0.250266 | 0.999231 |  0.264191 | -0.000002 | 0.957328 | 0.156966 | 0.978355 |  0.171467 |
    | 2000-02-11 00:00:00 |      1.0 |      0.5       0.0       0.5  0.246947  0.246947  0.250524 |      0.0 | 0.248098 | 0.251635 | 0.251514 |      0.5 |      0.0 |      0.5 | 0.246947 | 0.246947 | 0.250524 | 1.000082 |  0.220989 | -0.000002 | 0.957289 |  0.13553 | 0.978365 |  0.149726 |
    | 2000-02-12 00:00:00 | 0.999177 | 0.499588       0.0  0.499588  0.247173  0.247173  0.250404 |      0.0 | 0.248279 | 0.251476 | 0.251723 | 0.499588 |      0.0 | 0.499588 | 0.247173 | 0.247173 | 0.250404 | 0.999258 |  0.177823 | -0.000002 | 0.957319 | 0.114079 | 0.978344 |  0.127998 |
    | 2000-02-13 00:00:00 |      1.0 |      0.5       0.0       0.5  0.246998  0.246998   0.25065 |      0.0 | 0.248068 |  0.25168 | 0.251561 |      0.5 |      0.0 |      0.5 | 0.246998 | 0.246998 |  0.25065 |  1.00008 |  0.134622 | -0.000002 | 0.957281 | 0.092646 | 0.978354 |  0.106253 |
    | 2000-02-14 00:00:00 | 0.999202 | 0.499601       0.0  0.499601  0.247215  0.247215  0.250531 |      0.0 | 0.248244 | 0.251526 | 0.251762 | 0.499601 |      0.0 | 0.499601 | 0.247215 | 0.247215 | 0.250531 | 0.999282 |  0.091455 | -0.000002 | 0.957311 | 0.071198 | 0.978334 |  0.084521 |
    | 2000-02-15 00:00:00 |      1.0 |      0.5       0.0       0.5  0.247045  0.247045  0.250767 |      0.0 |  0.24804 | 0.251723 | 0.251604 |      0.5 |      0.0 |      0.5 | 0.247045 | 0.247045 | 0.250767 | 1.000078 |  0.048253 | -0.000002 | 0.957274 | 0.049767 | 0.978344 |  0.062772 |
    | 2000-02-16 00:00:00 | 0.999225 | 0.499612       0.0  0.499612  0.247254  0.247254  0.250648 |      0.0 | 0.248211 | 0.251572 | 0.251798 | 0.499612 |      0.0 | 0.499612 | 0.247254 | 0.247254 | 0.250648 | 0.999302 |  0.005086 | -0.000002 | 0.957303 | 0.028322 | 0.978324 |  0.041036 |
    | 2000-02-17 00:00:00 |      1.0 | 0.058864       0.0       0.5  0.195687  0.298488  0.250875 |      0.0 | 0.197879 | 0.251762 | 0.300435 | 0.058864 |      0.0 |      0.5 | 0.195687 | 0.298488 | 0.250875 | 0.577574 | -0.001611 | -0.000002 | 0.957152 | 0.011225 | 0.974119 |  0.019284 |
    | 2000-02-18 00:00:00 |      1.0 |      0.0       0.0       0.5  0.102282  0.393643  0.223196 |      0.0 | 0.112029 | 0.224559 | 0.394031 |      0.0 |      0.0 |      0.5 | 0.102282 | 0.393643 | 0.223196 | 0.500063 | -0.001611 | -0.000002 |  0.95767 | 0.001546 | 0.959477 | -0.000118 |
    | 2000-02-19 00:00:00 |      1.0 |      0.0       0.0       0.5  0.016922  0.473006       0.0 |      0.0 | 0.050058 |      0.0 | 0.473103 |      0.0 |      0.0 |      0.5 | 0.016922 | 0.473006 |      0.0 | 0.500064 | -0.001611 | -0.000002 | 0.959666 | -0.00278 | 0.918601 | -0.000118 |
    | 2000-02-20 00:00:00 |      1.0 |      0.0       0.0       0.5       0.0  0.466831       0.0 |      0.0 |      0.0 |      0.0 | 0.466931 |      0.0 |      0.0 |      0.5 |      0.0 | 0.466831 |      0.0 | 0.500063 | -0.001611 | -0.000002 | 0.956803 | -0.00278 | 0.878258 | -0.000118 |
    | 2000-02-21 00:00:00 |      1.0 |      0.0       0.0       0.5       0.0  0.499963       0.0 |      0.0 |      0.0 |      0.0 | 0.500016 |      0.0 |      0.0 |      0.5 |      0.0 | 0.499963 |      0.0 | 0.500063 | -0.001611 | -0.000002 | 0.956799 | -0.00278 | 0.835056 | -0.000118 |
    | 2000-02-22 00:00:00 |      1.0 |      0.0       0.0       0.5       0.0       0.5       0.0 |      0.0 |      0.0 |      0.0 |  0.50005 |      0.0 |      0.0 |      0.5 |      0.0 |      0.5 |      0.0 | 0.500063 | -0.001611 | -0.000002 | 0.956798 | -0.00278 | 0.791852 | -0.000118 |
    | 2000-02-23 00:00:00 |      1.0 |      0.0       0.0       0.5       0.0       0.5       0.0 |      0.0 |      0.0 |      0.0 | 0.500046 |      0.0 |      0.0 |      0.5 |      0.0 |      0.5 |      0.0 | 0.500063 | -0.001611 | -0.000002 | 0.956796 | -0.00278 | 0.748648 | -0.000118 |
    | 2000-02-24 00:00:00 |      1.0 |      0.0       0.0       0.5       0.0       0.5       0.0 |      0.0 |      0.0 |      0.0 | 0.500043 |      0.0 |      0.0 |      0.5 |      0.0 |      0.5 |      0.0 | 0.500063 | -0.001611 | -0.000002 | 0.956795 | -0.00278 | 0.705444 | -0.000118 |
    | 2000-02-25 00:00:00 |      1.0 |      0.0       0.0       0.5       0.0       0.5       0.0 |      0.0 |      0.0 |      0.0 |  0.50004 |      0.0 |      0.0 |      0.5 |      0.0 |      0.5 |      0.0 | 0.500063 | -0.001611 | -0.000002 | 0.956793 | -0.00278 | 0.662241 | -0.000118 |
    | 2000-02-26 00:00:00 |      1.0 |      0.0       0.0       0.5       0.0       0.5       0.0 |      0.0 |      0.0 |      0.0 | 0.500037 |      0.0 |      0.0 |      0.5 |      0.0 |      0.5 |      0.0 | 0.500063 | -0.001611 | -0.000002 |  0.95679 | -0.00278 | 0.619038 | -0.000118 |
    | 2000-02-27 00:00:00 |      1.0 |      0.0       0.0       0.5       0.0       0.5       0.0 |      0.0 |      0.0 |      0.0 | 0.500035 |      0.0 |      0.0 |      0.5 |      0.0 |      0.5 |      0.0 | 0.500063 | -0.001611 | -0.000002 | 0.956788 | -0.00278 | 0.575835 | -0.000118 |
    | 2000-02-28 00:00:00 |      1.0 |      0.0       0.0       0.5       0.0       0.5       0.0 |      0.0 |      0.0 |      0.0 | 0.500032 |      0.0 |      0.0 |      0.5 |      0.0 |      0.5 |      0.0 | 0.500063 | -0.001611 | -0.000002 | 0.956785 | -0.00278 | 0.532632 | -0.000118 |
    | 2000-02-29 00:00:00 |      1.0 |      0.0       0.0       0.5       0.0       0.5       0.0 |      0.0 |      0.0 |      0.0 |  0.50003 |      0.0 |      0.0 |      0.5 |      0.0 |      0.5 |      0.0 | 0.500063 | -0.001611 | -0.000002 | 0.956782 | -0.00278 | 0.489429 | -0.000118 |

"""
from hydpy.core.objecttools import devicename

# import...
# ...from HydPy
from hydpy.exe.modelimports import *
from hydpy.core import devicetools
from hydpy.core import modeltools
from hydpy.core.typingtools import *

# ...from manage
from hydpy.models.manage import manage_model


class Model(modeltools.AdHocModel):
    """|manage_lwc.DOCNAME.complete|."""

    DOCNAME = modeltools.DocName(
        short="Manage-LWC", description="low water control management model"
    )
    __HYDPY_ROOTMODEL__ = True

    INLET_METHODS = ()
    OBSERVER_METHODS = ()
    RECEIVER_METHODS = (
        manage_model.Pick_LoggedDischarge_V1,
        manage_model.Pick_LoggedWaterVolume_V1,
    )
    RUN_METHODS = (manage_model.Calc_Demand_V1, manage_model.Calc_Request_V1)
    ADD_METHODS = ()
    OUTLET_METHODS = ()
    SENDER_METHODS = (manage_model.Pass_Request_V1,)
    SUBMODELINTERFACES = ()
    SUBMODELS = ()

    sourcenames: list[str]

    def __init__(self) -> None:
        super().__init__()
        self.sourcenames = []

    def _connect_receivers(self) -> None:
        """

        >>> from hydpy import Element, Nodes
        >>> volumes = Nodes("volume1", "volume2", defaultvariable="WaterVolumes")
        >>> lwc = Element(
        ...     "lwc",
        ...     # observers="gauge",
        ...     receivers=volumes,
        ...     # senders=["release1", "release2"],
        ... )
        >>> from hydpy.models.manage_lwc import *
        >>> parameterstep()
        >>> lwc.model = model
        """

        name2elements = devicetools._registry[devicetools.Element]

        volume_nodes = []
        for sourcename in self.sourcenames:
            element = name2elements[sourcename]
            # ToDo: also search in senders...?
            selected = [n for n in element.outputs if n in self.element.receivers]
            assert len(selected) == 1
            volume_nodes.append(selected[0])
        self.sequences.receivers.watervolume.connect_to_nodes(
            group="receivers",
            available_nodes=volume_nodes,
            applied_nodes=[],
            report_noconnect=True,
        )

        target_nodes = [n for n in self.element.receivers if str(n.variable) == "Q"]
        assert len(target_nodes) == 1
        self.sequences.receivers.q.connect_to_nodes(
            group="receivers",
            available_nodes=target_nodes,
            applied_nodes=[],
            report_noconnect=True,
        )

    def _connect_senders(self) -> None:
        """Todo"""

        name2elements = devicetools._registry[devicetools.Element]

        request_nodes = []
        for sourcename in self.sourcenames:
            element = name2elements[sourcename]
            # ToDo: also search in inputs...?
            selected = [n for n in element.observers if n in self.element.senders]
            assert len(selected) == 1
            request_nodes.append(selected[0])
        self.sequences.senders.request.connect_to_nodes(
            group="senders",
            available_nodes=request_nodes,
            applied_nodes=[],
            report_noconnect=True,
        )


tester = Tester()
cythonizer = Cythonizer()
