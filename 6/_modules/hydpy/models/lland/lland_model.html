<!DOCTYPE html>

<html lang="en" data-content_root="../../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>hydpy.models.lland.lland_model &#8212; HydPy 6.1.5 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/classic.css?v=127cebf3" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/graphviz.css?v=4ae1632d" />
    
    <script src="../../../../_static/documentation_options.js?v=3b4955ce"></script>
    <script src="../../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">HydPy 6.1.5 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">hydpy.models.lland.lland_model</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../../index.html">
              <img class="logo" src="../../../../_static/HydPy_Logo.png" alt="Logo"/>
            </a></p>
  <div>
    <h3><a href="../../../../index.html">Table of Contents</a></h3>
    <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../example_projects.html">Example Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../user_guide.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer_guide.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference_manual.html">Reference Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../zbibliography.html">Bibliography</a></li>
</ul>

  </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for hydpy.models.lland.lland_model</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># pylint: disable=missing-module-docstring</span>

<span class="c1"># imports...</span>
<span class="c1"># ...from site-packages</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span>

<span class="c1"># ...from HydPy</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy</span><span class="w"> </span><span class="kn">import</span> <span class="n">config</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">importtools</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">modeltools</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.core.typingtools</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.auxs</span><span class="w"> </span><span class="kn">import</span> <span class="n">roottools</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.cythons</span><span class="w"> </span><span class="kn">import</span> <span class="n">modelutils</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.interfaces</span><span class="w"> </span><span class="kn">import</span> <span class="n">aetinterfaces</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.interfaces</span><span class="w"> </span><span class="kn">import</span> <span class="n">precipinterfaces</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.interfaces</span><span class="w"> </span><span class="kn">import</span> <span class="n">radiationinterfaces</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.interfaces</span><span class="w"> </span><span class="kn">import</span> <span class="n">soilinterfaces</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.interfaces</span><span class="w"> </span><span class="kn">import</span> <span class="n">stateinterfaces</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.interfaces</span><span class="w"> </span><span class="kn">import</span> <span class="n">tempinterfaces</span>

<span class="c1"># ...from lland</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.lland</span><span class="w"> </span><span class="kn">import</span> <span class="n">lland_control</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.lland</span><span class="w"> </span><span class="kn">import</span> <span class="n">lland_derived</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.lland</span><span class="w"> </span><span class="kn">import</span> <span class="n">lland_fixed</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.lland</span><span class="w"> </span><span class="kn">import</span> <span class="n">lland_inlets</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.lland</span><span class="w"> </span><span class="kn">import</span> <span class="n">lland_inputs</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.lland</span><span class="w"> </span><span class="kn">import</span> <span class="n">lland_factors</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.lland</span><span class="w"> </span><span class="kn">import</span> <span class="n">lland_fluxes</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.lland</span><span class="w"> </span><span class="kn">import</span> <span class="n">lland_states</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.lland</span><span class="w"> </span><span class="kn">import</span> <span class="n">lland_logs</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.lland</span><span class="w"> </span><span class="kn">import</span> <span class="n">lland_aides</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.lland</span><span class="w"> </span><span class="kn">import</span> <span class="n">lland_outlets</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.lland</span><span class="w"> </span><span class="kn">import</span> <span class="n">lland_constants</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.lland.lland_constants</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">WASSER</span><span class="p">,</span>
    <span class="n">FLUSS</span><span class="p">,</span>
    <span class="n">SEE</span><span class="p">,</span>
    <span class="n">VERS</span><span class="p">,</span>
    <span class="n">BODEN</span><span class="p">,</span>
    <span class="n">GLETS</span><span class="p">,</span>
    <span class="n">LAUBW</span><span class="p">,</span>
    <span class="n">MISCHW</span><span class="p">,</span>
    <span class="n">NADELW</span><span class="p">,</span>
<span class="p">)</span>


<div class="viewcode-block" id="Pick_QZ_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Pick_QZ_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Pick_QZ_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Query the current inflow from all inlet nodes.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`QZ = \sum Q_{inlets}`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_inlets</span><span class="o">.</span><span class="n">Q</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QZ</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">inl</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">inlets</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">qz</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">inl</span><span class="o">.</span><span class="n">len_q</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">qz</span> <span class="o">+=</span> <span class="n">inl</span><span class="o">.</span><span class="n">q</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span></div>



<div class="viewcode-block" id="Calc_QZH_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_QZH_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_QZH_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the inflow in mm.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">       :math:`QZH = QZ / QFactor`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; derived.qfactor(2.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qz = 6.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qzh_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qzh</span>
<span class="sd">        qzh(3.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">QFactor</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QZ</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QZH</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">qzh</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">qz</span> <span class="o">/</span> <span class="n">der</span><span class="o">.</span><span class="n">qfactor</span></div>



<div class="viewcode-block" id="Process_RadiationModel_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Process_RadiationModel_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Process_RadiationModel_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Let a submodel that complies with the |RadiationModel_V1| interface preprocess</span>
<span class="sd">    all eventually required data.</span>

<span class="sd">    Example:</span>

<span class="sd">        We use the combination of |lland_dd| and |meteo_glob_morsim| as an example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;1997-08-01&quot;, &quot;1997-08-02&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland_knauf import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; with model.add_radiationmodel_v1(&quot;meteo_glob_morsim&quot;):</span>
<span class="sd">        ...     latitude(54.1)</span>
<span class="sd">        ...     longitude(9.7)</span>
<span class="sd">        ...     angstromconstant(0.25)</span>
<span class="sd">        ...     angstromfactor(0.5)</span>
<span class="sd">        ...     angstromalternative(0.15)</span>
<span class="sd">        ...     inputs.sunshineduration = 6.3</span>
<span class="sd">        &gt;&gt;&gt; model.process_radiationmodel_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.radiationmodel.sequences.fluxes.globalradiation</span>
<span class="sd">        globalradiation(190.25149)</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMODELINTERFACES</span> <span class="o">=</span> <span class="p">(</span><span class="n">radiationinterfaces</span><span class="o">.</span><span class="n">RadiationModel_V1</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">radiationmodel_typeid</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">cast</span><span class="p">(</span>
                <span class="n">radiationinterfaces</span><span class="o">.</span><span class="n">RadiationModel_V1</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">radiationmodel</span>
            <span class="p">)</span><span class="o">.</span><span class="n">process_radiation</span><span class="p">()</span></div>

        <span class="c1"># ToDo:</span>
        <span class="c1">#     elif ...</span>
        <span class="c1">#     else:</span>
        <span class="c1">#         assert_never(model.radiationmodel)</span>


<div class="viewcode-block" id="Calc_PossibleSunshineDuration_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_PossibleSunshineDuration_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_PossibleSunshineDuration_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Query the possible sunshine duration from a submodel that complies with the</span>
<span class="sd">    |RadiationModel_V1| or |RadiationModel_V4| interface.</span>

<span class="sd">    Examples:</span>

<span class="sd">        We combine |lland_knauf| with submodels that comply with different interfaces.</span>
<span class="sd">        First, with |meteo_glob_morsim|, which complies with |RadiationModel_V1|:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland_knauf import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; with model.add_radiationmodel_v1(&quot;meteo_glob_morsim&quot;, update=False):</span>
<span class="sd">        ...     factors.possiblesunshineduration = 10.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_possiblesunshineduration()</span>
<span class="sd">        &gt;&gt;&gt; factors.possiblesunshineduration</span>
<span class="sd">        possiblesunshineduration(10.0)</span>

<span class="sd">        Second, with |meteo_psun_sun_glob_io|, which complies with |RadiationModel_V4|:</span>

<span class="sd">        &gt;&gt;&gt; with model.add_radiationmodel_v4(&quot;meteo_psun_sun_glob_io&quot;, update=False):</span>
<span class="sd">        ...     inputs.possiblesunshineduration = 14.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_possiblesunshineduration()</span>
<span class="sd">        &gt;&gt;&gt; factors.possiblesunshineduration</span>
<span class="sd">        possiblesunshineduration(14.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMODELINTERFACES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">radiationinterfaces</span><span class="o">.</span><span class="n">RadiationModel_V1</span><span class="p">,</span>
        <span class="n">radiationinterfaces</span><span class="o">.</span><span class="n">RadiationModel_V4</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_factors</span><span class="o">.</span><span class="n">PossibleSunshineDuration</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>

        <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">radiationmodel_typeid</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">fac</span><span class="o">.</span><span class="n">possiblesunshineduration</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
                <span class="n">radiationinterfaces</span><span class="o">.</span><span class="n">RadiationModel_V3</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">radiationmodel</span>
            <span class="p">)</span><span class="o">.</span><span class="n">get_possiblesunshineduration</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">model</span><span class="o">.</span><span class="n">radiationmodel_typeid</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">fac</span><span class="o">.</span><span class="n">possiblesunshineduration</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
                <span class="n">radiationinterfaces</span><span class="o">.</span><span class="n">RadiationModel_V4</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">radiationmodel</span>
            <span class="p">)</span><span class="o">.</span><span class="n">get_possiblesunshineduration</span><span class="p">()</span></div>

        <span class="c1"># ToDo:</span>
        <span class="c1">#     elif ...</span>
        <span class="c1">#     else:</span>
        <span class="c1">#         assert_never(model.radiationmodel)</span>


<div class="viewcode-block" id="Calc_SunshineDuration_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_SunshineDuration_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_SunshineDuration_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Query the actual sunshine duration from a submodel that complies with the</span>
<span class="sd">    |RadiationModel_V1| or |RadiationModel_V4| interface.</span>

<span class="sd">        We combine |lland_knauf| with submodels that comply with different interfaces.</span>
<span class="sd">        First, with |meteo_glob_fao56|, which complies with |RadiationModel_V1|:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland_knauf import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; with model.add_radiationmodel_v1(&quot;meteo_glob_morsim&quot;, update=False):</span>
<span class="sd">        ...     inputs.sunshineduration = 10.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_sunshineduration()</span>
<span class="sd">        &gt;&gt;&gt; factors.sunshineduration</span>
<span class="sd">        sunshineduration(10.0)</span>

<span class="sd">        Second, with |meteo_psun_sun_glob_io|, which complies with |RadiationModel_V4|:</span>

<span class="sd">        &gt;&gt;&gt; with model.add_radiationmodel_v4(&quot;meteo_psun_sun_glob_io&quot;, update=False):</span>
<span class="sd">        ...     inputs.sunshineduration = 14.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_sunshineduration()</span>
<span class="sd">        &gt;&gt;&gt; factors.sunshineduration</span>
<span class="sd">        sunshineduration(14.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMODELINTERFACES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">radiationinterfaces</span><span class="o">.</span><span class="n">RadiationModel_V1</span><span class="p">,</span>
        <span class="n">radiationinterfaces</span><span class="o">.</span><span class="n">RadiationModel_V4</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_factors</span><span class="o">.</span><span class="n">SunshineDuration</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>

        <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">radiationmodel_typeid</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">fac</span><span class="o">.</span><span class="n">sunshineduration</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
                <span class="n">radiationinterfaces</span><span class="o">.</span><span class="n">RadiationModel_V3</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">radiationmodel</span>
            <span class="p">)</span><span class="o">.</span><span class="n">get_sunshineduration</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">model</span><span class="o">.</span><span class="n">radiationmodel_typeid</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">fac</span><span class="o">.</span><span class="n">sunshineduration</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
                <span class="n">radiationinterfaces</span><span class="o">.</span><span class="n">RadiationModel_V4</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">radiationmodel</span>
            <span class="p">)</span><span class="o">.</span><span class="n">get_sunshineduration</span><span class="p">()</span></div>

        <span class="c1"># ToDo:</span>
        <span class="c1">#     elif ...</span>
        <span class="c1">#     else:</span>
        <span class="c1">#         assert_never(model.radiationmodel)</span>


<div class="viewcode-block" id="Calc_GlobalRadiation_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_GlobalRadiation_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_GlobalRadiation_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Query the global radiation from a submodel that complies with the</span>
<span class="sd">    |RadiationModel_V1| or |RadiationModel_V4| interface.</span>

<span class="sd">    Examples:</span>

<span class="sd">        We combine |lland_knauf| with submodels that comply with different interfaces.</span>
<span class="sd">        First, with |meteo_glob_morsim|, which complies with |RadiationModel_V1|:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland_knauf import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; with model.add_radiationmodel_v1(&quot;meteo_glob_morsim&quot;, update=False):</span>
<span class="sd">        ...     fluxes.globalradiation = 100.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_globalradiation()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.globalradiation</span>
<span class="sd">        globalradiation(100.0)</span>

<span class="sd">        Second, with |meteo_psun_sun_glob_io|, which complies with</span>
<span class="sd">        |RadiationModel_V4|:</span>

<span class="sd">        &gt;&gt;&gt; with model.add_radiationmodel_v4(&quot;meteo_psun_sun_glob_io&quot;, update=False):</span>
<span class="sd">        ...     inputs.globalradiation = 400.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_globalradiation()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.globalradiation</span>
<span class="sd">        globalradiation(400.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMODELINTERFACES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">radiationinterfaces</span><span class="o">.</span><span class="n">RadiationModel_V1</span><span class="p">,</span>
        <span class="n">radiationinterfaces</span><span class="o">.</span><span class="n">RadiationModel_V2</span><span class="p">,</span>
        <span class="n">radiationinterfaces</span><span class="o">.</span><span class="n">RadiationModel_V3</span><span class="p">,</span>
        <span class="n">radiationinterfaces</span><span class="o">.</span><span class="n">RadiationModel_V4</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">GlobalRadiation</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>

        <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">radiationmodel_typeid</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">globalradiation</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
                <span class="n">radiationinterfaces</span><span class="o">.</span><span class="n">RadiationModel_V1</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">radiationmodel</span>
            <span class="p">)</span><span class="o">.</span><span class="n">get_globalradiation</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">model</span><span class="o">.</span><span class="n">radiationmodel_typeid</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">globalradiation</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
                <span class="n">radiationinterfaces</span><span class="o">.</span><span class="n">RadiationModel_V4</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">radiationmodel</span>
            <span class="p">)</span><span class="o">.</span><span class="n">get_globalradiation</span><span class="p">()</span></div>

        <span class="c1"># ToDo:</span>
        <span class="c1">#     else:</span>
        <span class="c1">#         assert_never(model.radiationmodel)</span>


<div class="viewcode-block" id="Update_LoggedSunshineDuration_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Update_LoggedSunshineDuration_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Update_LoggedSunshineDuration_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Log the sunshine duration values of the last 24 hours.</span>

<span class="sd">    Example:</span>

<span class="sd">        The following example shows that each new method call successively</span>
<span class="sd">        moves the three memorised values to the right and stores the</span>
<span class="sd">        respective new value on the most left position:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; derived.nmblogentries(3)</span>
<span class="sd">        &gt;&gt;&gt; logs.loggedsunshineduration.shape = 3</span>
<span class="sd">        &gt;&gt;&gt; logs.loggedsunshineduration = 0.0</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import UnitTest</span>
<span class="sd">        &gt;&gt;&gt; test = UnitTest(model,</span>
<span class="sd">        ...                 model.update_loggedsunshineduration_v1,</span>
<span class="sd">        ...                 last_example=4,</span>
<span class="sd">        ...                 parseqs=(factors.sunshineduration,</span>
<span class="sd">        ...                          logs.loggedsunshineduration))</span>
<span class="sd">        &gt;&gt;&gt; test.nexts.sunshineduration = 1.0, 3.0, 2.0, 4.0</span>
<span class="sd">        &gt;&gt;&gt; del test.inits.loggedsunshineduration</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. | sunshineduration |           loggedsunshineduration |</span>
<span class="sd">        -------------------------------------------------------------</span>
<span class="sd">        |   1 |              1.0 | 1.0  0.0                     0.0 |</span>
<span class="sd">        |   2 |              3.0 | 3.0  1.0                     0.0 |</span>
<span class="sd">        |   3 |              2.0 | 2.0  3.0                     1.0 |</span>
<span class="sd">        |   4 |              4.0 | 4.0  2.0                     3.0 |</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">NmbLogEntries</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_factors</span><span class="o">.</span><span class="n">SunshineDuration</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_logs</span><span class="o">.</span><span class="n">LoggedSunshineDuration</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">logs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">nmblogentries</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">loggedsunshineduration</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">log</span><span class="o">.</span><span class="n">loggedsunshineduration</span><span class="p">[</span><span class="n">idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">log</span><span class="o">.</span><span class="n">loggedsunshineduration</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">fac</span><span class="o">.</span><span class="n">sunshineduration</span></div>



<div class="viewcode-block" id="Calc_DailySunshineDuration_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_DailySunshineDuration_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_DailySunshineDuration_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the sunshine duration sum of the last 24 hours.</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; derived.nmblogentries(3)</span>
<span class="sd">        &gt;&gt;&gt; logs.loggedsunshineduration.shape = 3</span>
<span class="sd">        &gt;&gt;&gt; logs.loggedsunshineduration = 1.0, 5.0, 3.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_dailysunshineduration_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailysunshineduration</span>
<span class="sd">        dailysunshineduration(9.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">NmbLogEntries</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_logs</span><span class="o">.</span><span class="n">LoggedSunshineDuration</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">DailySunshineDuration</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">logs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">dailysunshineduration</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">nmblogentries</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">dailysunshineduration</span> <span class="o">+=</span> <span class="n">log</span><span class="o">.</span><span class="n">loggedsunshineduration</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span></div>



<div class="viewcode-block" id="Update_LoggedPossibleSunshineDuration_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Update_LoggedPossibleSunshineDuration_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Update_LoggedPossibleSunshineDuration_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Log the sunshine duration values of the last 24 hours.</span>

<span class="sd">    Example:</span>

<span class="sd">        The following example shows that each new method call successively</span>
<span class="sd">        moves the three memorised values to the right and stores the</span>
<span class="sd">        respective new value on the most left position:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; derived.nmblogentries(3)</span>
<span class="sd">        &gt;&gt;&gt; logs.loggedpossiblesunshineduration.shape = 3</span>
<span class="sd">        &gt;&gt;&gt; logs.loggedpossiblesunshineduration = 0.0</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import UnitTest</span>
<span class="sd">        &gt;&gt;&gt; test = UnitTest(model,</span>
<span class="sd">        ...                 model.update_loggedpossiblesunshineduration_v1,</span>
<span class="sd">        ...                 last_example=4,</span>
<span class="sd">        ...                 parseqs=(factors.possiblesunshineduration,</span>
<span class="sd">        ...                          logs.loggedpossiblesunshineduration))</span>
<span class="sd">        &gt;&gt;&gt; test.nexts.possiblesunshineduration = 1.0, 3.0, 2.0, 4.0</span>
<span class="sd">        &gt;&gt;&gt; del test.inits.loggedpossiblesunshineduration</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. | possiblesunshineduration |           loggedpossiblesunshineduration |</span>
<span class="sd">        -----------------------------------------------------------------------------</span>
<span class="sd">        |   1 |                      1.0 | 1.0  0.0                             0.0 |</span>
<span class="sd">        |   2 |                      3.0 | 3.0  1.0                             0.0 |</span>
<span class="sd">        |   3 |                      2.0 | 2.0  3.0                             1.0 |</span>
<span class="sd">        |   4 |                      4.0 | 4.0  2.0                             3.0 |</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">NmbLogEntries</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_factors</span><span class="o">.</span><span class="n">PossibleSunshineDuration</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_logs</span><span class="o">.</span><span class="n">LoggedPossibleSunshineDuration</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">logs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">nmblogentries</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">loggedpossiblesunshineduration</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">log</span><span class="o">.</span><span class="n">loggedpossiblesunshineduration</span><span class="p">[</span><span class="n">idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">loggedpossiblesunshineduration</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">fac</span><span class="o">.</span><span class="n">possiblesunshineduration</span></div>



<div class="viewcode-block" id="Calc_DailyPossibleSunshineDuration_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_DailyPossibleSunshineDuration_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_DailyPossibleSunshineDuration_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the sunshine duration sum of the last 24 hours.</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; derived.nmblogentries(3)</span>
<span class="sd">        &gt;&gt;&gt; logs.loggedpossiblesunshineduration.shape = 3</span>
<span class="sd">        &gt;&gt;&gt; logs.loggedpossiblesunshineduration = 1.0, 5.0, 3.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_dailypossiblesunshineduration_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailypossiblesunshineduration</span>
<span class="sd">        dailypossiblesunshineduration(9.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">NmbLogEntries</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_logs</span><span class="o">.</span><span class="n">LoggedPossibleSunshineDuration</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">DailyPossibleSunshineDuration</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">logs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">dailypossiblesunshineduration</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">nmblogentries</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">dailypossiblesunshineduration</span> <span class="o">+=</span> <span class="n">log</span><span class="o">.</span><span class="n">loggedpossiblesunshineduration</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span></div>



<div class="viewcode-block" id="Calc_NKor_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_NKor_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_NKor_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Adjust the given precipitation value according to :cite:t:`ref-LARSIM`.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`NKor = KG \\cdot Nied`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(3)</span>
<span class="sd">        &gt;&gt;&gt; kg(0.8, 1.0, 1.2)</span>
<span class="sd">        &gt;&gt;&gt; inputs.nied = 10.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_nkor_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.nkor</span>
<span class="sd">        nkor(8.0, 10.0, 12.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">KG</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_inputs</span><span class="o">.</span><span class="n">Nied</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NKor</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">nkor</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">kg</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">inp</span><span class="o">.</span><span class="n">nied</span></div>



<div class="viewcode-block" id="Calc_TKor_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_TKor_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_TKor_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Adjust the given air temperature value.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`TKor = KT + TemL`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(3)</span>
<span class="sd">        &gt;&gt;&gt; kt(-2.0, 0.0, 2.0)</span>
<span class="sd">        &gt;&gt;&gt; inputs.teml(1.0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_tkor_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkor</span>
<span class="sd">        tkor(-1.0, 1.0, 3.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">KT</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_inputs</span><span class="o">.</span><span class="n">TemL</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TKor</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">tkor</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">kt</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">inp</span><span class="o">.</span><span class="n">teml</span></div>



<div class="viewcode-block" id="Calc_WindSpeed2m_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_WindSpeed2m_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_WindSpeed2m_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Adjust the measured wind speed to a height of 2 meters above the ground</span>
<span class="sd">    according to :cite:t:`ref-LARSIM`.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`WindSpeed2m = WindSpeed \cdot</span>
<span class="sd">      \frac{ln(newheight / Z0)}{ln(MeasuringHeightWindSpeed / Z0)}`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; measuringheightwindspeed(10.0)</span>
<span class="sd">        &gt;&gt;&gt; inputs.windspeed = 5.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_windspeed2m_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.windspeed2m</span>
<span class="sd">        windspeed2m(4.007956)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">MeasuringHeightWindSpeed</span><span class="p">,)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fixed</span><span class="o">.</span><span class="n">Z0</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_inputs</span><span class="o">.</span><span class="n">WindSpeed</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WindSpeed2m</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">windspeed2m</span> <span class="o">=</span> <span class="n">inp</span><span class="o">.</span><span class="n">windspeed</span> <span class="o">*</span> <span class="p">(</span>
            <span class="n">modelutils</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">/</span> <span class="n">fix</span><span class="o">.</span><span class="n">z0</span><span class="p">)</span>
            <span class="o">/</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">measuringheightwindspeed</span> <span class="o">/</span> <span class="n">fix</span><span class="o">.</span><span class="n">z0</span><span class="p">)</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="Calc_ReducedWindSpeed2m_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_ReducedWindSpeed2m_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_ReducedWindSpeed2m_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the landuse-use-specific wind speed at height of 2 meters</span>
<span class="sd">    according to :cite:t:`ref-LARSIM` (based on :cite:t:`ref-LUBW2006a`,</span>
<span class="sd">    :cite:t:`ref-LUBWLUWG2015`).</span>


<span class="sd">    Basic equation (for forests):</span>
<span class="sd">      :math:`ReducedWindSpeed2m = \</span>
<span class="sd">      max(P1Wind - P2Wind \\cdot LAI, 0) \\cdot WindSpeed2m`</span>

<span class="sd">    Example:</span>

<span class="sd">        The basic equation given above holds for forests (hydrological</span>
<span class="sd">        response units of type |LAUBW|, |MISCHW|, and |NADELW| only.</span>
<span class="sd">        For all other landuse-use types method |Calc_ReducedWindSpeed2m_V1|</span>
<span class="sd">        maintains the given wind speed for grass:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2019-05-30&quot;, &quot;2019-06-03&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(4)</span>
<span class="sd">        &gt;&gt;&gt; lnk(OBSTB, LAUBW, MISCHW, NADELW)</span>
<span class="sd">        &gt;&gt;&gt; lai.obstb_mai = 0.0</span>
<span class="sd">        &gt;&gt;&gt; lai.laubw_mai = 2.0</span>
<span class="sd">        &gt;&gt;&gt; lai.mischw_mai = 4.0</span>
<span class="sd">        &gt;&gt;&gt; lai.nadelw_mai = 7.0</span>
<span class="sd">        &gt;&gt;&gt; p1wind(0.5)</span>
<span class="sd">        &gt;&gt;&gt; p2wind(0.1)</span>
<span class="sd">        &gt;&gt;&gt; derived.moy.update()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.windspeed2m = 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.idx_sim = pub.timegrids.init[&quot;2019-05-31&quot;]</span>
<span class="sd">        &gt;&gt;&gt; model.calc_reducedwindspeed2m_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.reducedwindspeed2m</span>
<span class="sd">        reducedwindspeed2m(2.0, 0.6, 0.2, 0.0)</span>

<span class="sd">        &gt;&gt;&gt; lai.obstb_jun = 0.0</span>
<span class="sd">        &gt;&gt;&gt; lai.laubw_jun = 3.0</span>
<span class="sd">        &gt;&gt;&gt; lai.mischw_jun = 6.0</span>
<span class="sd">        &gt;&gt;&gt; lai.nadelw_jun = 10.0</span>
<span class="sd">        &gt;&gt;&gt; model.idx_sim = pub.timegrids.init[&quot;2019-06-01&quot;]</span>
<span class="sd">        &gt;&gt;&gt; model.calc_reducedwindspeed2m_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.reducedwindspeed2m</span>
<span class="sd">        reducedwindspeed2m(2.0, 0.4, 0.0, 0.0)</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">LAI</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">P1Wind</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">P2Wind</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">MOY</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WindSpeed2m</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ReducedWindSpeed2m</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">LAUBW</span><span class="p">,</span> <span class="n">MISCHW</span><span class="p">,</span> <span class="n">NADELW</span><span class="p">):</span>
                <span class="n">d_lai</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">lai</span><span class="p">[</span><span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">der</span><span class="o">.</span><span class="n">moy</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">idx_sim</span><span class="p">]]</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">reducedwindspeed2m</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="nb">max</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">p1wind</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">p2wind</span> <span class="o">*</span> <span class="n">d_lai</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">windspeed2m</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">reducedwindspeed2m</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">windspeed2m</span></div>



<div class="viewcode-block" id="Calc_NBes_Inzp_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_NBes_Inzp_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_NBes_Inzp_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate stand precipitation and update the interception storage accordingly.</span>

<span class="sd">    Additional requirements:</span>
<span class="sd">      |Model.idx_sim|</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      .. math::</span>
<span class="sd">        NBes = \begin{cases}</span>
<span class="sd">        PKor</span>
<span class="sd">        &amp;|\</span>
<span class="sd">        Inzp = KInz</span>
<span class="sd">        \\</span>
<span class="sd">        0</span>
<span class="sd">        &amp;|\</span>
<span class="sd">        Inzp &lt; KInz</span>
<span class="sd">        \end{cases}</span>

<span class="sd">    Examples:</span>

<span class="sd">        Initialise five HRUs with different land usages:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(5)</span>
<span class="sd">        &gt;&gt;&gt; lnk(SIED_D, FEUCHT, GLETS, FLUSS, SEE)</span>

<span class="sd">        Define |KInz| values for July the selected land usages directly:</span>

<span class="sd">        &gt;&gt;&gt; derived.kinz.sied_d_jul = 2.0</span>
<span class="sd">        &gt;&gt;&gt; derived.kinz.feucht_jul = 1.0</span>
<span class="sd">        &gt;&gt;&gt; derived.kinz.glets_jul = 0.0</span>
<span class="sd">        &gt;&gt;&gt; derived.kinz.fluss_jul = 1.0</span>
<span class="sd">        &gt;&gt;&gt; derived.kinz.see_jul = 1.0</span>

<span class="sd">        Now we prepare a |MOY| object, that assumes that the first, second,</span>
<span class="sd">        and third simulation time steps are in June, July, and August</span>
<span class="sd">        respectively (we make use of the value defined above for July, but</span>
<span class="sd">        setting the values of parameter |MOY| this way allows for a more</span>
<span class="sd">        rigorous testing of proper indexing):</span>

<span class="sd">        &gt;&gt;&gt; derived.moy.shape = 3</span>
<span class="sd">        &gt;&gt;&gt; derived.moy = 5, 6, 7</span>
<span class="sd">        &gt;&gt;&gt; model.idx_sim = 1</span>

<span class="sd">        The dense settlement (|SIED_D|), the wetland area (|FEUCHT|), and</span>
<span class="sd">        both water areas (|FLUSS| and |SEE|) start with a initial interception</span>
<span class="sd">        storage of 1/2 mm, the glacier (|GLETS|) and water areas (|FLUSS| and</span>
<span class="sd">        |SEE|) start with 0 mm.  In the first example, actual precipition</span>
<span class="sd">        is 1 mm:</span>

<span class="sd">        &gt;&gt;&gt; states.inzp = 0.5, 0.5, 0.0, 1.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.nkor = 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_nbes_inzp_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.inzp</span>
<span class="sd">        inzp(1.5, 1.0, 0.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.nbes</span>
<span class="sd">        nbes(0.0, 0.5, 1.0, 0.0, 0.0)</span>

<span class="sd">        Only for the settled area, interception capacity is not exceeded,</span>
<span class="sd">        meaning no stand precipitation occurs.  Note that it is common in</span>
<span class="sd">        define zero interception capacities for glacier areas, but not</span>
<span class="sd">        mandatory.  Also note that the |KInz|, |Inzp| and |NKor| values</span>
<span class="sd">        given for both water areas are ignored completely, and |Inzp|</span>
<span class="sd">        and |NBes| are simply set to zero.</span>

<span class="sd">        If there is no precipitation, there is of course also no stand</span>
<span class="sd">        precipitation and interception storage remains unchanged:</span>

<span class="sd">        &gt;&gt;&gt; states.inzp = 0.5, 0.5, 0.0, 0.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.nkor = 0.</span>
<span class="sd">        &gt;&gt;&gt; model.calc_nbes_inzp_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.inzp</span>
<span class="sd">        inzp(0.5, 0.5, 0.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.nbes</span>
<span class="sd">        nbes(0.0, 0.0, 0.0, 0.0, 0.0)</span>

<span class="sd">        Interception capacities change discontinuously between consecutive</span>
<span class="sd">        months.  This can result in little stand precipitation events in</span>
<span class="sd">        periods without precipitation:</span>

<span class="sd">        &gt;&gt;&gt; states.inzp = 1.0, 0.0, 0.0, 0.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; derived.kinz.sied_d_jul = 0.6</span>
<span class="sd">        &gt;&gt;&gt; fluxes.nkor = 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_nbes_inzp_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.inzp</span>
<span class="sd">        inzp(0.6, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.nbes</span>
<span class="sd">        nbes(0.4, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">MOY</span><span class="p">,</span> <span class="n">lland_derived</span><span class="o">.</span><span class="n">KInz</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NKor</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">Inzp</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NBes</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">WASSER</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">nbes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">inzp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">nbes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">nkor</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                    <span class="o">+</span> <span class="n">sta</span><span class="o">.</span><span class="n">inzp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                    <span class="o">-</span> <span class="n">der</span><span class="o">.</span><span class="n">kinz</span><span class="p">[</span><span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">der</span><span class="o">.</span><span class="n">moy</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">idx_sim</span><span class="p">]],</span>
                    <span class="mf">0.0</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">inzp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">nkor</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">nbes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>



<div class="viewcode-block" id="Calc_SNRatio_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_SNRatio_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_SNRatio_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the ratio of frozen to total precipitation according to</span>
<span class="sd">    :cite:t:`ref-LARSIM`.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`SNRatio =</span>
<span class="sd">      min\\left(max\\left(\\frac{(TGr-TSp/2-TKor)}{TSp}, 0\\right), 1\\right)`</span>

<span class="sd">    Examples:</span>

<span class="sd">        In the first example, the threshold temperature of seven</span>
<span class="sd">        hydrological response units is 0 °C and the temperature interval</span>
<span class="sd">        of mixed precipitation 2 °C:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(7)</span>
<span class="sd">        &gt;&gt;&gt; tgr(1.0)</span>
<span class="sd">        &gt;&gt;&gt; tsp(2.0)</span>

<span class="sd">        The value of |SNRatio| is zero above 0 °C and 1 below 2 °C.  Between</span>
<span class="sd">        these temperature values |SNRatio| decreases linearly:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.nkor = 4.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkor = -1.0, 0.0, 0.5, 1.0, 1.5, 2.0, 3.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_snratio_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.snratio</span>
<span class="sd">        snratio(1.0, 1.0, 0.75, 0.5, 0.25, 0.0, 0.0)</span>

<span class="sd">        Note the special case of a zero temperature interval.  With the</span>
<span class="sd">        actual temperature being equal to the threshold temperature, the</span>
<span class="sd">        the value of |SNRatio| is zero:</span>

<span class="sd">        &gt;&gt;&gt; tsp(0.0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_snratio_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.snratio</span>
<span class="sd">        snratio(1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">TGr</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">TSp</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TKor</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_aides</span><span class="o">.</span><span class="n">SNRatio</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">flu</span><span class="o">.</span><span class="n">tkor</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">tgr</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">con</span><span class="o">.</span><span class="n">tsp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">):</span>
                <span class="n">aid</span><span class="o">.</span><span class="n">snratio</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">elif</span> <span class="n">flu</span><span class="o">.</span><span class="n">tkor</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">tgr</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">tsp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">):</span>
                <span class="n">aid</span><span class="o">.</span><span class="n">snratio</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">aid</span><span class="o">.</span><span class="n">snratio</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">tgr</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">con</span><span class="o">.</span><span class="n">tsp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">tkor</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="p">)</span> <span class="o">/</span> <span class="n">con</span><span class="o">.</span><span class="n">tsp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>



<div class="viewcode-block" id="Calc_SBes_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_SBes_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_SBes_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the frozen part of stand precipitation.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`SBes = SNRatio \\cdot NBes`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(2)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.nbes = 10.0</span>
<span class="sd">        &gt;&gt;&gt; aides.snratio = 0.2, 0.8</span>
<span class="sd">        &gt;&gt;&gt; model.calc_sbes_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.sbes</span>
<span class="sd">        sbes(2.0, 8.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_aides</span><span class="o">.</span><span class="n">SNRatio</span><span class="p">,</span> <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NBes</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SBes</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">sbes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">aid</span><span class="o">.</span><span class="n">snratio</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">nbes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>



<div class="viewcode-block" id="Calc_SnowIntMax_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_SnowIntMax_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_SnowIntMax_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the current capacity of the snow interception storage according to</span>
<span class="sd">    :cite:t:`ref-LARSIM`.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      .. math::</span>
<span class="sd">        SnowIntMax = \bigg( P1SIMax +  P2SIMax \cdot LAI \bigg) \cdot \begin{cases}</span>
<span class="sd">        1 &amp;|\ TKor  \leq -3</span>
<span class="sd">        \\</span>
<span class="sd">        (5 + TKor ) / 2 &amp;|\ -3 &lt; TKor &lt; -1</span>
<span class="sd">        \\</span>
<span class="sd">        2 &amp;|\ -1 \leq TKor</span>
<span class="sd">        \end{cases}</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-04-29&quot;, &quot;2000-05-03&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(8)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER, LAUBW, LAUBW, LAUBW, LAUBW, LAUBW, MISCHW, NADELW)</span>
<span class="sd">        &gt;&gt;&gt; lai.laubw_apr = 4.0</span>
<span class="sd">        &gt;&gt;&gt; lai.laubw_mai = 7.0</span>
<span class="sd">        &gt;&gt;&gt; lai.mischw_apr = 6.0</span>
<span class="sd">        &gt;&gt;&gt; lai.mischw_mai = 8.0</span>
<span class="sd">        &gt;&gt;&gt; lai.nadelw = 11.0</span>
<span class="sd">        &gt;&gt;&gt; p1simax(8.0)</span>
<span class="sd">        &gt;&gt;&gt; p2simax(1.5)</span>
<span class="sd">        &gt;&gt;&gt; derived.moy.update()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkor = 0.0, 0.0, -1.0, -2.0, -3.0, -4.0, -4.0, -4.0</span>

<span class="sd">        &gt;&gt;&gt; model.idx_sim = pub.timegrids.init[&quot;2000-04-30&quot;]</span>
<span class="sd">        &gt;&gt;&gt; model.calc_snowintmax_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.snowintmax</span>
<span class="sd">        snowintmax(0.0, 28.0, 28.0, 21.0, 14.0, 14.0, 17.0, 24.5)</span>

<span class="sd">        &gt;&gt;&gt; model.idx_sim = pub.timegrids.init[&quot;2000-05-01&quot;]</span>
<span class="sd">        &gt;&gt;&gt; model.calc_snowintmax_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.snowintmax</span>
<span class="sd">        snowintmax(0.0, 37.0, 37.0, 27.75, 18.5, 18.5, 20.0, 24.5)</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">LAI</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">P1SIMax</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">P2SIMax</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">MOY</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TKor</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SnowIntMax</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">moy</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">idx_sim</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">LAUBW</span><span class="p">,</span> <span class="n">MISCHW</span><span class="p">,</span> <span class="n">NADELW</span><span class="p">):</span>
                <span class="n">d_lai</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">lai</span><span class="p">[</span><span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">idx</span><span class="p">]</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">snowintmax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">p1simax</span> <span class="o">+</span> <span class="n">con</span><span class="o">.</span><span class="n">p2simax</span> <span class="o">*</span> <span class="n">d_lai</span>
                <span class="k">if</span> <span class="n">flu</span><span class="o">.</span><span class="n">tkor</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">:</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">snowintmax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*=</span> <span class="mi">2</span>
                <span class="k">elif</span> <span class="n">flu</span><span class="o">.</span><span class="n">tkor</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mf">3.0</span><span class="p">:</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">snowintmax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*=</span> <span class="mf">2.5</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">tkor</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">snowintmax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_SnowIntRate_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_SnowIntRate_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_SnowIntRate_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the ratio between the snow interception rate and precipitation</span>
<span class="sd">    intensity according to :cite:t:`ref-LARSIM`.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">       :math:`SnowIntRate = min\big(  P1SIRate +  P2SIRate \cdot LAI</span>
<span class="sd">       + P3SIRate \cdot SInz, 1 \big))`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-04-29&quot;, &quot;2000-05-03&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(7)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER, LAUBW, LAUBW, LAUBW, LAUBW, MISCHW, NADELW)</span>
<span class="sd">        &gt;&gt;&gt; lai.laubw_apr = 4.0</span>
<span class="sd">        &gt;&gt;&gt; lai.laubw_mai = 7.0</span>
<span class="sd">        &gt;&gt;&gt; lai.mischw_apr = 6.0</span>
<span class="sd">        &gt;&gt;&gt; lai.mischw_mai = 8.0</span>
<span class="sd">        &gt;&gt;&gt; lai.nadelw = 11.0</span>
<span class="sd">        &gt;&gt;&gt; p1sirate(0.2)</span>
<span class="sd">        &gt;&gt;&gt; p2sirate(0.02)</span>
<span class="sd">        &gt;&gt;&gt; p3sirate(0.003)</span>
<span class="sd">        &gt;&gt;&gt; derived.moy.update()</span>
<span class="sd">        &gt;&gt;&gt; states.sinz = 500.0, 500.0, 50.0, 5.0, 0.0, 0.0, 0.0</span>

<span class="sd">        &gt;&gt;&gt; model.idx_sim = pub.timegrids.init[&quot;2000-04-30&quot;]</span>
<span class="sd">        &gt;&gt;&gt; model.calc_snowintrate_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.snowintrate</span>
<span class="sd">        snowintrate(0.0, 1.0, 0.43, 0.295, 0.28, 0.32, 0.42)</span>

<span class="sd">        &gt;&gt;&gt; model.idx_sim = pub.timegrids.init[&quot;2000-05-01&quot;]</span>
<span class="sd">        &gt;&gt;&gt; model.calc_snowintrate_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.snowintrate</span>
<span class="sd">        snowintrate(0.0, 1.0, 0.49, 0.355, 0.34, 0.36, 0.42)</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">LAI</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">P1SIRate</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">P2SIRate</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">P3SIRate</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">MOY</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">SInz</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SnowIntRate</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">moy</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">idx_sim</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">LAUBW</span><span class="p">,</span> <span class="n">MISCHW</span><span class="p">,</span> <span class="n">NADELW</span><span class="p">):</span>
                <span class="n">d_lai</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">lai</span><span class="p">[</span><span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">idx</span><span class="p">]</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">snowintrate</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
                    <span class="n">con</span><span class="o">.</span><span class="n">p1sirate</span> <span class="o">+</span> <span class="n">con</span><span class="o">.</span><span class="n">p2sirate</span> <span class="o">*</span> <span class="n">d_lai</span> <span class="o">+</span> <span class="n">con</span><span class="o">.</span><span class="n">p3sirate</span> <span class="o">*</span> <span class="n">sta</span><span class="o">.</span><span class="n">sinz</span><span class="p">[</span><span class="n">k</span><span class="p">],</span>
                    <span class="mf">1.0</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">snowintrate</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_NBesInz_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_NBesInz_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_NBesInz_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the total amount of stand precipitation reaching the snow</span>
<span class="sd">    interception storage.</span>

<span class="sd">    Basic equation  (does this comply with `LARSIM`_?):</span>
<span class="sd">      :math:`NBesInz =</span>
<span class="sd">      min \big( SnowIntRate \cdot NBes, max (SnowIntMax - SInz, 0) \big)`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(6)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER, LAUBW, MISCHW, NADELW, NADELW, NADELW)</span>
<span class="sd">        &gt;&gt;&gt; states.sinz = 0.0, 0.0, 5.0, 10.0, 15.0, 20.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.nbes = 20.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.snowintmax = 15.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.snowintrate = 0.5</span>
<span class="sd">        &gt;&gt;&gt; model.calc_nbesinz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.nbesinz</span>
<span class="sd">        nbesinz(0.0, 10.0, 10.0, 5.0, 0.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NBes</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SnowIntMax</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SnowIntRate</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">SInz</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NBesInz</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">LAUBW</span><span class="p">,</span> <span class="n">MISCHW</span><span class="p">,</span> <span class="n">NADELW</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">nbesinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">snowintrate</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">nbes</span><span class="p">[</span><span class="n">k</span><span class="p">],</span>
                    <span class="nb">max</span><span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">snowintmax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">sta</span><span class="o">.</span><span class="n">sinz</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">nbesinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_SBesInz_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_SBesInz_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_SBesInz_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the frozen amount of stand precipitation reaching the snow</span>
<span class="sd">    interception storage.</span>

<span class="sd">    Basic equations (does this comply with `LARSIM`_?):</span>
<span class="sd">      :math:`SBesInz = SNRatio \cdot NBesInz`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(4)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER, LAUBW, MISCHW, NADELW)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.nbesinz = 10.0, 10.0, 5.0, 2.5</span>
<span class="sd">        &gt;&gt;&gt; aides.snratio = 0.8</span>
<span class="sd">        &gt;&gt;&gt; model.calc_sbesinz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.sbesinz</span>
<span class="sd">        sbesinz(0.0, 8.0, 4.0, 2.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NBesInz</span><span class="p">,</span> <span class="n">lland_aides</span><span class="o">.</span><span class="n">SNRatio</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SBesInz</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">LAUBW</span><span class="p">,</span> <span class="n">MISCHW</span><span class="p">,</span> <span class="n">NADELW</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">sbesinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">aid</span><span class="o">.</span><span class="n">snratio</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">nbesinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">sbesinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_STInz_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_STInz_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_STInz_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Add the relevant fraction of the frozen amount of stand precipitation</span>
<span class="sd">    to the frozen water equivalent of the interception snow storage.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`\frac{STInz}{dt} = SBesInz`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(4)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER, LAUBW, MISCHW, NADELW)</span>
<span class="sd">        &gt;&gt;&gt; states.stinz = 0.0, 1.0, 2.0, 3.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.sbesinz = 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_stinz_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.stinz</span>
<span class="sd">        stinz(0.0, 2.0, 3.0, 4.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SBesInz</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">STInz</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">LAUBW</span><span class="p">,</span> <span class="n">MISCHW</span><span class="p">,</span> <span class="n">NADELW</span><span class="p">):</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">stinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">sbesinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">stinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_WaDaInz_SInz_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_WaDaInz_SInz_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_WaDaInz_SInz_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Add as much liquid precipitation to the snow interception storage as it is</span>
<span class="sd">    able to hold.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      :math:`\frac{dSInz}{dt} = NBesInz - WaDaInz`</span>

<span class="sd">      :math:`SInz \leq PWMax \cdot STInz`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(5)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER, LAUBW, MISCHW, NADELW, NADELW)</span>
<span class="sd">        &gt;&gt;&gt; pwmax(2.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.nbesinz = 1.0</span>
<span class="sd">        &gt;&gt;&gt; states.stinz = 0.0, 0.0, 1.0, 1.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; states.sinz = 1.0, 0.0, 1.0, 1.5, 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_wadainz_sinz_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.sinz</span>
<span class="sd">        sinz(0.0, 0.0, 2.0, 2.0, 2.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wadainz</span>
<span class="sd">        wadainz(0.0, 1.0, 0.0, 0.5, 1.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">PWMax</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NBesInz</span><span class="p">,</span> <span class="n">lland_states</span><span class="o">.</span><span class="n">STInz</span><span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">SInz</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WaDaInz</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">LAUBW</span><span class="p">,</span> <span class="n">MISCHW</span><span class="p">,</span> <span class="n">NADELW</span><span class="p">):</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">sinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">nbesinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">wadainz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">sinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">pwmax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">sta</span><span class="o">.</span><span class="n">stinz</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">)</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">sinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-=</span> <span class="n">flu</span><span class="o">.</span><span class="n">wadainz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">wadainz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">sinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_WNiedInz_ESnowInz_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_WNiedInz_ESnowInz_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_WNiedInz_ESnowInz_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the heat flux into the snow interception storage due to the amount</span>
<span class="sd">    of precipitation actually hold by the snow layer.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`\frac{dESnowInz}{dt} = W\!NiedInz`</span>

<span class="sd">      :math:`W\!NiedInz = (TKor-TRefN) \cdot</span>
<span class="sd">      (CPEis \cdot SBesInz + CPWasser \cdot (NBesInz - SBesInz - WaDaInz))`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(6)</span>
<span class="sd">        &gt;&gt;&gt; lnk(LAUBW, MISCHW, NADELW, NADELW, NADELW, ACKER)</span>
<span class="sd">        &gt;&gt;&gt; trefn(1.0)</span>
<span class="sd">        &gt;&gt;&gt; states.esnowinz = 0.5</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkor = 4.0, 0.0, 0.0, 0.0, 0.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.nbesinz = 10.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.sbesinz = 0.0, 0.0, 5.0, 10.0, 5.0, 5.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wadainz = 0.0, 0.0, 0.0, 0.0, 5.0, 5.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_wniedinz_esnowinz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wniedinz</span>
<span class="sd">        wniedinz(2.9075, -0.969167, -0.726481, -0.483796, -0.241898, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.esnowinz</span>
<span class="sd">        esnowinz(3.4075, -0.469167, -0.226481, 0.016204, 0.258102, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">TRefN</span><span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fixed</span><span class="o">.</span><span class="n">CPWasser</span><span class="p">,</span> <span class="n">lland_fixed</span><span class="o">.</span><span class="n">CPEis</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TKor</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NBesInz</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SBesInz</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WaDaInz</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">ESnowInz</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WNiedInz</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">LAUBW</span><span class="p">,</span> <span class="n">MISCHW</span><span class="p">,</span> <span class="n">NADELW</span><span class="p">):</span>
                <span class="n">d_ice</span> <span class="o">=</span> <span class="n">fix</span><span class="o">.</span><span class="n">cpeis</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">sbesinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">d_water</span> <span class="o">=</span> <span class="n">fix</span><span class="o">.</span><span class="n">cpwasser</span> <span class="o">*</span> <span class="p">(</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">nbesinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">sbesinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">wadainz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">wniedinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">tkor</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">trefn</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">d_ice</span> <span class="o">+</span> <span class="n">d_water</span><span class="p">)</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">esnowinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">wniedinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">wniedinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">esnowinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Return_TempSInz_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Return_TempSInz_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Return_TempSInz_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate and return the average temperature of the intercepted snow.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`max \left( \frac{ESnowInz}{STInz \cdot CPEis + (SInz - STInz)</span>
<span class="sd">      \cdot CPWasser}, -273 \right)`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(5)</span>
<span class="sd">        &gt;&gt;&gt; states.stinz = 0.0, 0.5, 5.0, 0.5, 0.5</span>
<span class="sd">        &gt;&gt;&gt; states.sinz = 0.0, 1.0, 10.0, 1.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; states.esnowinz = 0.0, 0.0, -1.0, -10.0, -100.0</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_tempsinz_v1(0))</span>
<span class="sd">        nan</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_tempsinz_v1(1))</span>
<span class="sd">        0.0</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_tempsinz_v1(2))</span>
<span class="sd">        -1.376498</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_tempsinz_v1(3))</span>
<span class="sd">        -137.649758</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_tempsinz_v1(4))</span>
<span class="sd">        -273.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fixed</span><span class="o">.</span><span class="n">CPWasser</span><span class="p">,</span> <span class="n">lland_fixed</span><span class="o">.</span><span class="n">CPEis</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">STInz</span><span class="p">,</span> <span class="n">lland_states</span><span class="o">.</span><span class="n">SInz</span><span class="p">,</span> <span class="n">lland_states</span><span class="o">.</span><span class="n">ESnowInz</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">sinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">d_ice</span> <span class="o">=</span> <span class="n">fix</span><span class="o">.</span><span class="n">cpeis</span> <span class="o">*</span> <span class="n">sta</span><span class="o">.</span><span class="n">stinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">d_water</span> <span class="o">=</span> <span class="n">fix</span><span class="o">.</span><span class="n">cpwasser</span> <span class="o">*</span> <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">sinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">sta</span><span class="o">.</span><span class="n">stinz</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">esnowinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">d_ice</span> <span class="o">+</span> <span class="n">d_water</span><span class="p">),</span> <span class="o">-</span><span class="mf">273.0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">nan</span></div>



<div class="viewcode-block" id="Calc_TempSInz_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_TempSInz_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_TempSInz_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the average temperature of the intercepted snow.</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(6)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER, LAUBW, MISCHW, NADELW, NADELW, NADELW)</span>
<span class="sd">        &gt;&gt;&gt; pwmax(2.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkor = -1.0</span>
<span class="sd">        &gt;&gt;&gt; states.stinz = 0.0, 0.5, 5.0, 5.0, 5.0, 5.0</span>
<span class="sd">        &gt;&gt;&gt; states.sinz = 0.0, 1.0, 10.0, 10.0, 10.0, 10.0</span>
<span class="sd">        &gt;&gt;&gt; states.esnowinz = 0.0, 0.0, -2.0, -2.0, -2.0, -2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_tempsinz_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.tempsinz</span>
<span class="sd">        tempsinz(nan, 0.0, -2.752995, -2.752995, -2.752995, -2.752995)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Return_TempSInz_V1</span><span class="p">,)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fixed</span><span class="o">.</span><span class="n">CPWasser</span><span class="p">,</span> <span class="n">lland_fixed</span><span class="o">.</span><span class="n">CPEis</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">STInz</span><span class="p">,</span> <span class="n">lland_states</span><span class="o">.</span><span class="n">SInz</span><span class="p">,</span> <span class="n">lland_states</span><span class="o">.</span><span class="n">ESnowInz</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_aides</span><span class="o">.</span><span class="n">TempSInz</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">tempsinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_tempsinz_v1</span><span class="p">(</span><span class="n">k</span><span class="p">)</span></div>



<div class="viewcode-block" id="Update_ASInz_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Update_ASInz_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Update_ASInz_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the dimensionless age of the intercepted snow.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      :math:`TauSInz_{new} = TauSInz_{old} \cdot max(1 - 0.1 \cdot SBesInz), 0) +</span>
<span class="sd">      \frac{r_1+r_2+r_3}{10^6} \cdot Seconds`</span>

<span class="sd">      :math:`r_1 = exp \left( 5000 \cdot</span>
<span class="sd">      \left( \frac{1}{273.15} - \frac{1}{273.15 + TempSInz} \right) \right)`</span>

<span class="sd">      :math:`r_2 = min \left(r_1^{10}, 1 \right)`</span>

<span class="sd">      :math:`r_3 = 0.03`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(10)</span>
<span class="sd">        &gt;&gt;&gt; derived.seconds(24*60*60)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.sbesinz = 0.0, 1.0, 5.0, 9.0, 10.0, 11.0, 11.0, 11.0, 11.0, 11.0</span>
<span class="sd">        &gt;&gt;&gt; states.sinz = 0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; states.asinz = 1.0, nan, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; aides.tempsinz = 0.0, 0.0, -10.0, -10.0, -10.0, -10.0, -1.0, 0.0, 1.0, 10.0</span>
<span class="sd">        &gt;&gt;&gt; model.update_asinz_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.asinz</span>
<span class="sd">        asinz(nan, 0.175392, 0.545768, 0.145768, 0.045768, 0.045768, 0.127468,</span>
<span class="sd">              0.175392, 0.181358, 0.253912)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">Seconds</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SBesInz</span><span class="p">,</span> <span class="n">lland_states</span><span class="o">.</span><span class="n">SInz</span><span class="p">,</span> <span class="n">lland_aides</span><span class="o">.</span><span class="n">TempSInz</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">ASInz</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">sinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">asinz</span><span class="p">[</span><span class="n">k</span><span class="p">]):</span>
                    <span class="n">sta</span><span class="o">.</span><span class="n">asinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">d_r1</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span>
                    <span class="mf">5000.0</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mf">273.15</span> <span class="o">-</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">273.15</span> <span class="o">+</span> <span class="n">aid</span><span class="o">.</span><span class="n">tempsinz</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>
                <span class="p">)</span>
                <span class="n">d_r2</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">d_r1</span><span class="o">**</span><span class="mi">10</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">asinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">sbesinz</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">)</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">asinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">d_r1</span> <span class="o">+</span> <span class="n">d_r2</span> <span class="o">+</span> <span class="mf">0.03</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1e6</span> <span class="o">*</span> <span class="n">der</span><span class="o">.</span><span class="n">seconds</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">asinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">nan</span></div>



<div class="viewcode-block" id="Calc_ActualAlbedoInz_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_ActualAlbedoInz_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_ActualAlbedoInz_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the current albedo of the intercepted snow.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`AlbedoSnowInz = Albedo0Snow \cdot</span>
<span class="sd">      \left( 1 - SnowAgingFactor \cdot \frac{ASInz}{1 + ASInz} \right)`</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(5)</span>
<span class="sd">        &gt;&gt;&gt; albedo0snow(0.8)</span>
<span class="sd">        &gt;&gt;&gt; snowagingfactor(0.35)</span>
<span class="sd">        &gt;&gt;&gt; states.asinz = nan, nan, 0.0, 1.0, 3.0</span>
<span class="sd">        &gt;&gt;&gt; states.sinz = 0.0, 0.0, 1.0, 1.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_actualalbedoinz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.actualalbedoinz</span>
<span class="sd">        actualalbedoinz(nan, nan, 0.8, 0.66, 0.59)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">SnowAgingFactor</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Albedo0Snow</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">ASInz</span><span class="p">,</span> <span class="n">lland_states</span><span class="o">.</span><span class="n">SInz</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ActualAlbedoInz</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">sinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">actualalbedoinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">albedo0snow</span> <span class="o">*</span> <span class="p">(</span>
                    <span class="mf">1.0</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">snowagingfactor</span> <span class="o">*</span> <span class="n">sta</span><span class="o">.</span><span class="n">asinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">sta</span><span class="o">.</span><span class="n">asinz</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">actualalbedoinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">nan</span></div>



<div class="viewcode-block" id="Calc_NetShortwaveRadiationInz_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_NetShortwaveRadiationInz_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_NetShortwaveRadiationInz_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the net shortwave radiation for the intercepted snow.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`NetShortwaveRadiationInz =</span>
<span class="sd">      (1 - Fr) \cdot (1.0 - ActualAlbedoInz) \cdot AdjustedGlobalRadiation`</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-30&quot;, &quot;2000-02-03&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(2)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER, LAUBW)</span>
<span class="sd">        &gt;&gt;&gt; derived.fr.acker_jan = 1.0</span>
<span class="sd">        &gt;&gt;&gt; derived.fr.acker_feb = 1.0</span>
<span class="sd">        &gt;&gt;&gt; derived.fr.laubw_jan = 0.5</span>
<span class="sd">        &gt;&gt;&gt; derived.fr.laubw_feb = 0.1</span>
<span class="sd">        &gt;&gt;&gt; derived.moy.update()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.globalradiation = 40.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.actualalbedoinz = 0.5</span>

<span class="sd">        &gt;&gt;&gt; model.idx_sim = pub.timegrids.init[&quot;2000-01-31&quot;]</span>
<span class="sd">        &gt;&gt;&gt; model.calc_netshortwaveradiationinz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.netshortwaveradiationinz</span>
<span class="sd">        netshortwaveradiationinz(0.0, 10.0)</span>

<span class="sd">        &gt;&gt;&gt; model.idx_sim = pub.timegrids.init[&quot;2000-02-01&quot;]</span>
<span class="sd">        &gt;&gt;&gt; model.calc_netshortwaveradiationinz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.netshortwaveradiationinz</span>
<span class="sd">        netshortwaveradiationinz(0.0, 18.0)</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">Fr</span><span class="p">,</span> <span class="n">lland_derived</span><span class="o">.</span><span class="n">MOY</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">GlobalRadiation</span><span class="p">,</span> <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ActualAlbedoInz</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NetShortwaveRadiationInz</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">LAUBW</span><span class="p">,</span> <span class="n">MISCHW</span><span class="p">,</span> <span class="n">NADELW</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">netshortwaveradiationinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">der</span><span class="o">.</span><span class="n">fr</span><span class="p">[</span><span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">der</span><span class="o">.</span><span class="n">moy</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">idx_sim</span><span class="p">]])</span>
                    <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">actualalbedoinz</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                    <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">globalradiation</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">netshortwaveradiationinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_SchmPotInz_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_SchmPotInz_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_SchmPotInz_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the potential melt of the intercepted snow according to its heat</span>
<span class="sd">    content.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`SchmPotInz = max \left( \frac{ESnowInz}{RSchmelz}, 0 \right)`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(4)</span>
<span class="sd">        &gt;&gt;&gt; states.sinz = 0.0, 1.0, 1.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; states.esnowinz = nan, 10.0, 5.0, -5.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_schmpotinz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.schmpotinz</span>
<span class="sd">        schmpotinz(0.0, 1.293413, 0.646707, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fixed</span><span class="o">.</span><span class="n">RSchmelz</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">ESnowInz</span><span class="p">,</span> <span class="n">lland_states</span><span class="o">.</span><span class="n">SInz</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SchmPotInz</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">sinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">schmpotinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">esnowinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">fix</span><span class="o">.</span><span class="n">rschmelz</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">schmpotinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_SchmInz_STInz_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_SchmInz_STInz_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_SchmInz_STInz_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the actual amount of snow melting within the snow interception</span>
<span class="sd">    storage.</span>

<span class="sd">    Basic equations:</span>

<span class="sd">      :math:`\frac{dSTInz}{dt} = -SchmInz`</span>

<span class="sd">      .. math::</span>
<span class="sd">        SchmInz = \begin{cases}</span>
<span class="sd">        SchmPotInz &amp;|\ STInz&gt; 0</span>
<span class="sd">        \\</span>
<span class="sd">        0 &amp;|\ STInz = 0</span>
<span class="sd">        \end{cases}</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(6)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER, LAUBW, MISCHW, NADELW, NADELW, NADELW)</span>
<span class="sd">        &gt;&gt;&gt; states.stinz = 0.0, 0.0, 2.0, 2.0, 2.0, 2.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.schmpotinz = 1.0, 1.0, 0.0, 1.0, 3.0, 5.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_schminz_stinz_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.stinz</span>
<span class="sd">        stinz(0.0, 0.0, 2.0, 1.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.schminz</span>
<span class="sd">        schminz(0.0, 0.0, 0.0, 1.0, 2.0, 2.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SchmPotInz</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SchmInz</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">STInz</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">LAUBW</span><span class="p">,</span> <span class="n">MISCHW</span><span class="p">,</span> <span class="n">NADELW</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">schminz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">schmpotinz</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">sta</span><span class="o">.</span><span class="n">stinz</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">stinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-=</span> <span class="n">flu</span><span class="o">.</span><span class="n">schminz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">schminz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_GefrPotInz_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_GefrPotInz_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_GefrPotInz_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the potential refreezing within the snow interception storage</span>
<span class="sd">    according to its thermal energy.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`GefrPotInz = max \left( -\frac{ESnowInz}{RSchmelz}, 0 \right)`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(4)</span>
<span class="sd">        &gt;&gt;&gt; states.sinz = 0.0, 1.0, 1.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; states.esnowinz = nan, -10.0, -5.0, 5.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_gefrpotinz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.gefrpotinz</span>
<span class="sd">        gefrpotinz(0.0, 1.293413, 0.646707, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fixed</span><span class="o">.</span><span class="n">RSchmelz</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">ESnowInz</span><span class="p">,</span> <span class="n">lland_states</span><span class="o">.</span><span class="n">SInz</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">GefrPotInz</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">sinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">gefrpotinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="n">sta</span><span class="o">.</span><span class="n">esnowinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">fix</span><span class="o">.</span><span class="n">rschmelz</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">gefrpotinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_GefrInz_STInz_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_GefrInz_STInz_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_GefrInz_STInz_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the actual amount of snow melting within the snow interception</span>
<span class="sd">    storage.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      :math:`\frac{dGefrInz}{dt} = -GefrInz`</span>

<span class="sd">      .. math::</span>
<span class="sd">        GefrInz = \begin{cases}</span>
<span class="sd">        GefrPotInz &amp;|\ SInz - STInz &gt; 0</span>
<span class="sd">        \\</span>
<span class="sd">        0 &amp;|\ SInz - STInz = 0</span>
<span class="sd">        \end{cases}</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(6)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER, LAUBW, LAUBW, LAUBW, MISCHW, NADELW)</span>
<span class="sd">        &gt;&gt;&gt; refreezeflag(True)</span>
<span class="sd">        &gt;&gt;&gt; states.stinz = 0.0, 0.0, 2.0, 2.0, 2.0, 2.0</span>
<span class="sd">        &gt;&gt;&gt; states.sinz = 0.0, 0.0, 4.0, 4.0, 4.0, 4.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.gefrpotinz = 1.0, 1.0, 0.0, 1.0, 3.0, 5.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_gefrinz_stinz_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.stinz</span>
<span class="sd">        stinz(0.0, 0.0, 2.0, 3.0, 4.0, 4.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.gefrinz</span>
<span class="sd">        gefrinz(0.0, 0.0, 0.0, 1.0, 2.0, 2.0)</span>

<span class="sd">        &gt;&gt;&gt; refreezeflag(False)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_gefrinz_stinz_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.stinz</span>
<span class="sd">        stinz(0.0, 0.0, 2.0, 3.0, 4.0, 4.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.gefrinz</span>
<span class="sd">        gefrinz(0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">RefreezeFlag</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">GefrPotInz</span><span class="p">,</span> <span class="n">lland_states</span><span class="o">.</span><span class="n">SInz</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">GefrInz</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">STInz</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">LAUBW</span><span class="p">,</span> <span class="n">MISCHW</span><span class="p">,</span> <span class="n">NADELW</span><span class="p">)</span> <span class="ow">and</span> <span class="n">con</span><span class="o">.</span><span class="n">refreezeflag</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">gefrinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">gefrpotinz</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">sinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">sta</span><span class="o">.</span><span class="n">stinz</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">stinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">gefrinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">gefrinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_EvSInz_SInz_STInz_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_EvSInz_SInz_STInz_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_EvSInz_SInz_STInz_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the evaporation from the snow interception storage, if any exists,</span>
<span class="sd">    and its content accordingly.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      :math:`SInz_{new} = f \cdot SInz_{old}`</span>

<span class="sd">      :math:`STInz_{new} = f \cdot STInz_{old}`</span>

<span class="sd">      :math:`f = \frac{SInz - EvSInz}{SInz}`</span>

<span class="sd">      :math:`EvSInz = max \left( \frac{WLatInz}{LWE}, SInz \right)`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(8)</span>
<span class="sd">        &gt;&gt;&gt; lnk(LAUBW, MISCHW, NADELW, NADELW, NADELW, NADELW, NADELW, ACKER)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wlatinz = -20.0, 0.0, 50.0, 100.0, 150.0, 150.0, 150.0, 150.0</span>
<span class="sd">        &gt;&gt;&gt; states.sinz = 2.0, 2.0, 2.0, 2.0, 2.0, 1.5, 0.0, 2.0</span>
<span class="sd">        &gt;&gt;&gt; states.stinz = 1.0, 1.0, 1.0, 1.0, 1.0, 0.5, 0.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_evsinz_sinz_stinz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evsinz</span>
<span class="sd">        evsinz(-0.323905, 0.0, 0.809762, 1.619524, 2.0, 1.5, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sinz</span>
<span class="sd">        sinz(2.323905, 2.0, 1.190238, 0.380476, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.stinz</span>
<span class="sd">        stinz(1.161952, 1.0, 0.595119, 0.190238, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fixed</span><span class="o">.</span><span class="n">LWE</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WLatInz</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">EvSInz</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">SInz</span><span class="p">,</span> <span class="n">lland_states</span><span class="o">.</span><span class="n">STInz</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">LAUBW</span><span class="p">,</span> <span class="n">MISCHW</span><span class="p">,</span> <span class="n">NADELW</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">sinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">evsinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">wlatinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">fix</span><span class="o">.</span><span class="n">lwe</span><span class="p">,</span> <span class="n">sta</span><span class="o">.</span><span class="n">sinz</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="n">d_frac</span> <span class="o">=</span> <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">sinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">evsinz</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">/</span> <span class="n">sta</span><span class="o">.</span><span class="n">sinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">sinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*=</span> <span class="n">d_frac</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">stinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*=</span> <span class="n">d_frac</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">evsinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">sinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">stinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Update_WaDaInz_SInz_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Update_WaDaInz_SInz_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Update_WaDaInz_SInz_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Update the actual water release from and the liquid water content of</span>
<span class="sd">    the snow interception storage due to melting.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      :math:`WaDaInz_{new} = WaDaInz_{old} + \Delta`</span>

<span class="sd">      :math:`SInz_{new} = SInz_{old} - \Delta`</span>

<span class="sd">      :math:`\Delta = max(SInz - PWMax \cdot STInz, 0)`</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(5)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER, LAUBW, LAUBW, MISCHW, NADELW)</span>
<span class="sd">        &gt;&gt;&gt; pwmax(2.0)</span>
<span class="sd">        &gt;&gt;&gt; states.stinz = 0.0, 0.0, 1.0, 1.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; states.sinz = 1.0, 0.0, 1.0, 2.0, 3.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wadainz = 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.update_wadainz_sinz_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.sinz</span>
<span class="sd">        sinz(1.0, 0.0, 1.0, 2.0, 2.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wadainz</span>
<span class="sd">        wadainz(1.0, 1.0, 1.0, 1.0, 2.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">PWMax</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">STInz</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">SInz</span><span class="p">,</span> <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WaDaInz</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">LAUBW</span><span class="p">,</span> <span class="n">MISCHW</span><span class="p">,</span> <span class="n">NADELW</span><span class="p">):</span>
                <span class="n">d_wadainz_corr</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">sinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">pwmax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">sta</span><span class="o">.</span><span class="n">stinz</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">)</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">wadainz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">d_wadainz_corr</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">sinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-=</span> <span class="n">d_wadainz_corr</span></div>



<div class="viewcode-block" id="Update_ESnowInz_V2">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Update_ESnowInz_V2">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Update_ESnowInz_V2</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Update the thermal energy content of the intercepted snow regarding snow</span>
<span class="sd">    melt and refreezing.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`\frac{dESnowInz}{dt} = RSchmelz \cdot (GefrInz - SchmInz)`</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(5)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER, NADELW, NADELW, NADELW, NADELW)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.gefrinz = 0.0, 0.0, 4.0, 0.0, 4.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.schminz = 0.0, 0.0, 0.0, 4.0, 4.0</span>
<span class="sd">        &gt;&gt;&gt; states.esnowinz = 20.0, 20.0, -40.0, 30.925926, 0.0</span>
<span class="sd">        &gt;&gt;&gt; states.sinz = 1.0, 0.0, 5.0, 5.0, 10.0</span>
<span class="sd">        &gt;&gt;&gt; model.update_esnowinz_v2()</span>
<span class="sd">        &gt;&gt;&gt; states.esnowinz</span>
<span class="sd">        esnowinz(0.0, 0.0, -9.074074, 0.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fixed</span><span class="o">.</span><span class="n">RSchmelz</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">GefrInz</span><span class="p">,</span> <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SchmInz</span><span class="p">,</span> <span class="n">lland_states</span><span class="o">.</span><span class="n">SInz</span><span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">ESnowInz</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">LAUBW</span><span class="p">,</span> <span class="n">MISCHW</span><span class="p">,</span> <span class="n">NADELW</span><span class="p">)</span> <span class="ow">and</span> <span class="n">sta</span><span class="o">.</span><span class="n">sinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">esnowinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">fix</span><span class="o">.</span><span class="n">rschmelz</span> <span class="o">*</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">gefrinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">schminz</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">esnowinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_WATS_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_WATS_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_WATS_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add the snow fall to the frozen water equivalent of the snow cover.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`\\frac{dW\\!ATS}{dt} = SBes`</span>

<span class="sd">    Example:</span>

<span class="sd">        On water surfaces, method |Calc_WATS_V1| never builds up a snow layer:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(4)</span>
<span class="sd">        &gt;&gt;&gt; lnk(WASSER, FLUSS, SEE, ACKER)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.sbes = 2.0</span>
<span class="sd">        &gt;&gt;&gt; states.wats = 5.5</span>
<span class="sd">        &gt;&gt;&gt; model.calc_wats_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.wats</span>
<span class="sd">        wats(0.0, 0.0, 0.0, 7.5)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SBes</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">WATS</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">WASSER</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">):</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">wats</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">wats</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">sbes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>



<div class="viewcode-block" id="Calc_WATS_V2">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_WATS_V2">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_WATS_V2</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Add the not intercepted snow fall to the frozen water equivalent of the</span>
<span class="sd">    snow cover.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`\frac{dW\!\!ATS}{dt} = SBes - SBesInz`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(3)</span>
<span class="sd">        &gt;&gt;&gt; lnk(WASSER, ACKER, LAUBW)</span>
<span class="sd">        &gt;&gt;&gt; states.wats = 0.0, 1.0, 2.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.sbes = 2.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.sbesinz = 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_wats_v2()</span>
<span class="sd">        &gt;&gt;&gt; states.wats</span>
<span class="sd">        wats(0.0, 3.0, 3.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SBes</span><span class="p">,</span> <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SBesInz</span><span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">WATS</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">WASSER</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">):</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">wats</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">elif</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">LAUBW</span><span class="p">,</span> <span class="n">MISCHW</span><span class="p">,</span> <span class="n">NADELW</span><span class="p">):</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">wats</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">sbes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">sbesinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">wats</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">sbes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>



<div class="viewcode-block" id="Calc_WaDa_WAeS_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_WaDa_WAeS_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_WaDa_WAeS_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add as much liquid precipitation to the snow cover as it is able to hold.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      :math:`\\frac{dW\\!AeS}{dt} = NBes - WaDa`</span>

<span class="sd">      :math:`W\\!AeS \\leq PWMax \\cdot W\\!ATS`</span>

<span class="sd">    Example:</span>

<span class="sd">        For simplicity, we set the threshold parameter |PWMax| to a value</span>
<span class="sd">        of two for each of the six initialised hydrological response units.</span>
<span class="sd">        Thus, the snow layer can hold as much liquid water as it contains</span>
<span class="sd">        frozen water.  Stand precipitation is also always set to the same</span>
<span class="sd">        value, but we vary the initial conditions of the snow cover:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(6)</span>
<span class="sd">        &gt;&gt;&gt; lnk(FLUSS, SEE, ACKER, ACKER, ACKER, ACKER)</span>
<span class="sd">        &gt;&gt;&gt; pwmax(2.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.nbes = 1.0</span>
<span class="sd">        &gt;&gt;&gt; states.wats = 0.0, 0.0, 0.0, 1.0, 1.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; states.waes = 1.0, 1.0, 0.0, 1.0, 1.5, 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_wada_waes_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.waes</span>
<span class="sd">        waes(0.0, 0.0, 0.0, 2.0, 2.0, 2.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wada</span>
<span class="sd">        wada(1.0, 1.0, 1.0, 0.0, 0.5, 1.0)</span>

<span class="sd">        Note the special cases of the first two response units of type |FLUSS|</span>
<span class="sd">        and |SEE|.  For water areas, stand precipitaton |NBes| is generally</span>
<span class="sd">        passed to |WaDa| and |WAeS| is set to zero.  For all other land</span>
<span class="sd">        use classes (of which only |ACKER| is selected), method</span>
<span class="sd">        |Calc_WaDa_WAeS_V1| only passes the part of |NBes| exceeding the</span>
<span class="sd">        actual snow holding capacity to |WaDa|.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">PWMax</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NBes</span><span class="p">,</span> <span class="n">lland_states</span><span class="o">.</span><span class="n">WATS</span><span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">WAeS</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WaDa</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">WASSER</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">):</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">wada</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">nbes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">nbes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">wada</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">pwmax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">sta</span><span class="o">.</span><span class="n">wats</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">)</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-=</span> <span class="n">flu</span><span class="o">.</span><span class="n">wada</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>



<div class="viewcode-block" id="Calc_WaDa_WAeS_V2">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_WaDa_WAeS_V2">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_WaDa_WAeS_V2</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Add as much liquid precipitation and interception melt to the snow cover</span>
<span class="sd">    as it is able to hold.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      :math:`\frac{dW\!\!AeS}{dt} = NBes - NBesInz + WaDaInz - WaDa`</span>

<span class="sd">      :math:`W\!\!AeS \leq PWMax \cdot W\!\!AT\!S`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(10)</span>
<span class="sd">        &gt;&gt;&gt; lnk(FLUSS, SEE, ACKER, ACKER, ACKER, ACKER, LAUBW, LAUBW, LAUBW, LAUBW)</span>
<span class="sd">        &gt;&gt;&gt; pwmax(2.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.nbes = 1.5</span>
<span class="sd">        &gt;&gt;&gt; fluxes.nbesinz = 1.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wadainz = 0.5</span>
<span class="sd">        &gt;&gt;&gt; states.wats = 0.0, 0.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; states.waes = 1.0, 1.0, 0.0, 1.0, 1.5, 2.0, 0.0, 1.0, 1.5, 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_wada_waes_v2()</span>
<span class="sd">        &gt;&gt;&gt; states.waes</span>
<span class="sd">        waes(0.0, 0.0, 0.0, 2.0, 2.0, 2.0, 0.0, 2.0, 2.0, 2.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wada</span>
<span class="sd">        wada(1.5, 1.5, 1.5, 0.5, 1.0, 1.5, 1.0, 0.0, 0.5, 1.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">PWMax</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NBes</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NBesInz</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WaDaInz</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">WATS</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">WAeS</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WaDa</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">WASSER</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">):</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">wada</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">nbes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">LAUBW</span><span class="p">,</span> <span class="n">MISCHW</span><span class="p">,</span> <span class="n">NADELW</span><span class="p">):</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">nbes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">nbesinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">wadainz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">wada</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">pwmax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">sta</span><span class="o">.</span><span class="n">wats</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">)</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-=</span> <span class="n">flu</span><span class="o">.</span><span class="n">wada</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">nbes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">wada</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">pwmax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">sta</span><span class="o">.</span><span class="n">wats</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">)</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-=</span> <span class="n">flu</span><span class="o">.</span><span class="n">wada</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>



<div class="viewcode-block" id="Calc_WGTF_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_WGTF_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_WGTF_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the heat flux according to the degree-day method according to</span>
<span class="sd">    :cite:t:`ref-LARSIM`.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`WGTF = GTF \\cdot (TKor - TRefT) \\cdot RSchmelz`</span>

<span class="sd">    Examples:</span>

<span class="sd">        Initialise six hydrological response units with identical degree-day</span>
<span class="sd">        factors and temperature thresholds, but different combinations of</span>
<span class="sd">        land use and air temperature:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(6)</span>
<span class="sd">        &gt;&gt;&gt; lnk(FLUSS, SEE, LAUBW, ACKER, ACKER, LAUBW)</span>
<span class="sd">        &gt;&gt;&gt; gtf(5.0)</span>
<span class="sd">        &gt;&gt;&gt; treft(0.0)</span>
<span class="sd">        &gt;&gt;&gt; trefn(1.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkor = 1.0, 1.0, 1.0, 1.0, 0.0, -1.0</span>

<span class="sd">        Note that the values of the degree-day factor are only half</span>
<span class="sd">        as much as the given value, due to the simulation step size</span>
<span class="sd">        being only half as long as the parameter step size:</span>

<span class="sd">        &gt;&gt;&gt; gtf</span>
<span class="sd">        gtf(5.0)</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import print_vector</span>
<span class="sd">        &gt;&gt;&gt; print_vector(gtf.values)</span>
<span class="sd">        2.5, 2.5, 2.5, 2.5, 2.5, 2.5</span>

<span class="sd">        The results of the first four hydrological response units show</span>
<span class="sd">        that |WGTF| is generally zero for water areas (here, |FLUSS| and</span>
<span class="sd">        |SEE|) in principally identical for all other landuse-use type</span>
<span class="sd">        (here, |ACKER| and |LAUBW|).  The results of the last three</span>
<span class="sd">        response units show the expectable linear relationship.  However,</span>
<span class="sd">        note that that |WGTF| is allowed to be negative:</span>

<span class="sd">        &gt;&gt;&gt; model.calc_wgtf_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wgtf</span>
<span class="sd">        wgtf(0.0, 0.0, 19.328704, 19.328704, 0.0, -19.328704)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">GTF</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">TRefT</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fixed</span><span class="o">.</span><span class="n">RSchmelz</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TKor</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WGTF</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">WASSER</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">wgtf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">wgtf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">gtf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">tkor</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">treft</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">*</span> <span class="n">fix</span><span class="o">.</span><span class="n">rschmelz</span></div>



<div class="viewcode-block" id="Calc_WNied_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_WNied_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_WNied_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the heat flux into the snow layer due to the total amount</span>
<span class="sd">    of ingoing precipitation (:cite:t:`ref-LARSIM`, modified).</span>

<span class="sd">    Method |Calc_WNied_V1| assumes that the temperature of precipitation</span>
<span class="sd">    equals air temperature minus |TRefN|.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`WNied = (TKor - TRefN) \\cdot</span>
<span class="sd">      (CPEis \\cdot SBes + CPWasser \\cdot (NBes - SBes))`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(5)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER, ACKER, ACKER, ACKER, WASSER)</span>
<span class="sd">        &gt;&gt;&gt; trefn(-2.0, 2.0, 2.0, 2.0, 2.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkor(1.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.nbes = 10.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.sbes = 0.0, 0.0, 5.0, 10.0, 10.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_wnied_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wnied</span>
<span class="sd">        wnied(2.9075, -0.969167, -0.726481, -0.483796, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">TRefN</span><span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fixed</span><span class="o">.</span><span class="n">CPWasser</span><span class="p">,</span> <span class="n">lland_fixed</span><span class="o">.</span><span class="n">CPEis</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TKor</span><span class="p">,</span> <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NBes</span><span class="p">,</span> <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SBes</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WNied</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">WASSER</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">wnied</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">d_ice</span> <span class="o">=</span> <span class="n">fix</span><span class="o">.</span><span class="n">cpeis</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">sbes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">d_water</span> <span class="o">=</span> <span class="n">fix</span><span class="o">.</span><span class="n">cpwasser</span> <span class="o">*</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">nbes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">sbes</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">wnied</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">tkor</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">trefn</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">d_ice</span> <span class="o">+</span> <span class="n">d_water</span><span class="p">)</span></div>



<div class="viewcode-block" id="Calc_WNied_ESnow_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_WNied_ESnow_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_WNied_ESnow_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the heat flux into the snow layer due to the amount</span>
<span class="sd">    of precipitation actually hold by the snow layer.</span>

<span class="sd">    Method |Calc_WNied_V1| assumes that the temperature of precipitation</span>
<span class="sd">    equals air temperature minus |TRefN|.  The same holds for the</span>
<span class="sd">    temperature of the fraction of precipitation not hold by the snow</span>
<span class="sd">    layer (in other words: no temperature mixing occurs).</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`\\frac{dESnow}{dt} = WNied`</span>

<span class="sd">      :math:`WNied = (TKor-TRefN) \\cdot</span>
<span class="sd">      (CPEis \\cdot SBes + CPWasser \\cdot (NBes - SBes - WaDa))`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(6)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER, ACKER, ACKER, ACKER, ACKER, WASSER)</span>
<span class="sd">        &gt;&gt;&gt; trefn(1.0)</span>
<span class="sd">        &gt;&gt;&gt; states.esnow = 0.5</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkor = 4.0, 0.0, 0.0, 0.0, 0.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.nbes = 10.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.sbes = 0.0, 0.0, 5.0, 10.0, 5.0, 5.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wada = 0.0, 0.0, 0.0, 0.0, 5.0, 5.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_wnied_esnow_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wnied</span>
<span class="sd">        wnied(2.9075, -0.969167, -0.726481, -0.483796, -0.241898, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.esnow</span>
<span class="sd">        esnow(3.4075, -0.469167, -0.226481, 0.016204, 0.258102, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">TRefN</span><span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fixed</span><span class="o">.</span><span class="n">CPWasser</span><span class="p">,</span> <span class="n">lland_fixed</span><span class="o">.</span><span class="n">CPEis</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TKor</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NBes</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SBes</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WaDa</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">ESnow</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WNied</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">WASSER</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">wnied</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">esnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">d_ice</span> <span class="o">=</span> <span class="n">fix</span><span class="o">.</span><span class="n">cpeis</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">sbes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">d_water</span> <span class="o">=</span> <span class="n">fix</span><span class="o">.</span><span class="n">cpwasser</span> <span class="o">*</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">nbes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">sbes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">wada</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">wnied</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">tkor</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">trefn</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">d_ice</span> <span class="o">+</span> <span class="n">d_water</span><span class="p">)</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">esnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">wnied</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>



<div class="viewcode-block" id="Return_SaturationVapourPressure_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Return_SaturationVapourPressure_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Return_SaturationVapourPressure_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate and return the saturation vapour pressure over an</span>
<span class="sd">    arbitrary surface for the given temperature according to :cite:t:`ref-LARSIM`</span>
<span class="sd">    (based on :cite:t:`ref-Weischet1983`).</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`6.1078 \cdot</span>
<span class="sd">      2.71828^{\frac{17.08085 \cdot temperature}{temperature + 234.175}}`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_saturationvapourpressure_v1(10.0))</span>
<span class="sd">        12.293852</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">temperature</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">6.1078</span> <span class="o">*</span> <span class="mf">2.71828</span> <span class="o">**</span> <span class="p">(</span><span class="mf">17.08085</span> <span class="o">*</span> <span class="n">temperature</span> <span class="o">/</span> <span class="p">(</span><span class="n">temperature</span> <span class="o">+</span> <span class="mf">234.175</span><span class="p">))</span></div>



<div class="viewcode-block" id="Calc_SaturationVapourPressure_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_SaturationVapourPressure_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_SaturationVapourPressure_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the saturation vapour pressure over arbitrary surfaces.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`SaturationVapourPressure =</span>
<span class="sd">      Return\\_SaturationVapourPressure\\_V1(TKor)`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(3)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkor = -10.0, 0.0, 10.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_saturationvapourpressure_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.saturationvapourpressure</span>
<span class="sd">        saturationvapourpressure(2.850871, 6.1078, 12.293852)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Return_SaturationVapourPressure_V1</span><span class="p">,)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TKor</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SaturationVapourPressure</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">saturationvapourpressure</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_saturationvapourpressure_v1</span><span class="p">(</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">tkor</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="p">)</span></div>



<div class="viewcode-block" id="Calc_ActualVapourPressure_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_ActualVapourPressure_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_ActualVapourPressure_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the actual vapour pressure.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`ActualVapourPressure =</span>
<span class="sd">      SaturationVapourPressure \cdot RelativeHumidity / 100`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(1)</span>
<span class="sd">        &gt;&gt;&gt; derived.nmblogentries.update()</span>
<span class="sd">        &gt;&gt;&gt; inputs.relativehumidity = 60.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.saturationvapourpressure = 20.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_actualvapourpressure_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.actualvapourpressure</span>
<span class="sd">        actualvapourpressure(12.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_inputs</span><span class="o">.</span><span class="n">RelativeHumidity</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SaturationVapourPressure</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ActualVapourPressure</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">actualvapourpressure</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">saturationvapourpressure</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">inp</span><span class="o">.</span><span class="n">relativehumidity</span> <span class="o">/</span> <span class="mf">100.0</span>
            <span class="p">)</span></div>



<div class="viewcode-block" id="Calc_RLAtm_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_RLAtm_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_RLAtm_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the longwave radiation emitted from the atmosphere according to</span>
<span class="sd">    :cite:t:`ref-LARSIM` (based on :cite:t:`ref-Thompson1981`).</span>

<span class="sd">    Basic equation:</span>

<span class="sd">      :math:`RLAtm =</span>
<span class="sd">      FrAtm \cdot Sigma \cdot  (Tkor + 273.15)^4 \cdot</span>
<span class="sd">      \left( \frac{ActualVapourPressure}{TKor + 273.15} \right) ^{1/7}</span>
<span class="sd">      \cdot \left(1 + 0.22 \cdot \left(</span>
<span class="sd">      1 - \frac{DailySunshineDuration}{DailyPossibleSunshineDuration} \right)^2</span>
<span class="sd">      \right)`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(2)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkor = 0.0, 10.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.actualvapourpressure = 6.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailysunshineduration = 12.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailypossiblesunshineduration = 14.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rlatm_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.rlatm</span>
<span class="sd">        rlatm(235.207154, 270.197425)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fixed</span><span class="o">.</span><span class="n">Sigma</span><span class="p">,</span> <span class="n">lland_fixed</span><span class="o">.</span><span class="n">FrAtm</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TKor</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ActualVapourPressure</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">DailySunshineDuration</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">DailyPossibleSunshineDuration</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_aides</span><span class="o">.</span><span class="n">RLAtm</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">d_rs</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">dailysunshineduration</span> <span class="o">/</span> <span class="n">flu</span><span class="o">.</span><span class="n">dailypossiblesunshineduration</span>
        <span class="n">d_common</span> <span class="o">=</span> <span class="n">fix</span><span class="o">.</span><span class="n">fratm</span> <span class="o">*</span> <span class="n">fix</span><span class="o">.</span><span class="n">sigma</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="mf">0.22</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">d_rs</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="n">d_t</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">tkor</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="mf">273.15</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">rlatm</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">d_common</span> <span class="o">*</span> <span class="p">(</span>
                <span class="n">d_t</span><span class="o">**</span><span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">actualvapourpressure</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">d_t</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="mf">7.0</span><span class="p">)</span>
            <span class="p">)</span></div>



<div class="viewcode-block" id="Return_NetLongwaveRadiationInz_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Return_NetLongwaveRadiationInz_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Return_NetLongwaveRadiationInz_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate and return the net longwave radiation for intercepted snow.</span>

<span class="sd">    The following equation is not part of the official `LARSIM`_ documentation.</span>
<span class="sd">    We think, it fits to the geometric assumtions underlying method</span>
<span class="sd">    |Return_NetLongwaveRadiationSnow_V1| but so far have not thoroughly checked</span>
<span class="sd">    if it results in realistic net longwave radiations.</span>

<span class="sd">    Basic equation:</span>

<span class="sd">      :math:`\big( 1 - Fr \big) \cdot \big( 0.97 \cdot Sigma \cdot (TempS + 273.15)^4</span>
<span class="sd">      - RLAtm \big)`</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-30&quot;, &quot;2000-02-03&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(2)</span>
<span class="sd">        &gt;&gt;&gt; lnk(LAUBW, NADELW)</span>
<span class="sd">        &gt;&gt;&gt; derived.moy.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.fr.laubw_jan = 0.4</span>
<span class="sd">        &gt;&gt;&gt; derived.fr.laubw_feb = 0.5</span>
<span class="sd">        &gt;&gt;&gt; derived.fr.nadelw_jan = 0.6</span>
<span class="sd">        &gt;&gt;&gt; derived.fr.nadelw_feb = 0.7</span>
<span class="sd">        &gt;&gt;&gt; aides.tempsinz = -1.0</span>
<span class="sd">        &gt;&gt;&gt; aides.rlatm = 100.0</span>

<span class="sd">        &gt;&gt;&gt; model.idx_sim = pub.timegrids.init[&quot;2000-01-31&quot;]</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import print_vector</span>
<span class="sd">        &gt;&gt;&gt; for hru in range(2):</span>
<span class="sd">        ...     print_vector([hru, model.return_netlongwaveradiationinz_v1(hru)])</span>
<span class="sd">        0, 126.624073</span>
<span class="sd">        1, 84.416049</span>

<span class="sd">        &gt;&gt;&gt; model.idx_sim = pub.timegrids.init[&quot;2000-02-01&quot;]</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import print_vector</span>
<span class="sd">        &gt;&gt;&gt; for hru in range(2):</span>
<span class="sd">        ...     print_vector([hru, model.return_netlongwaveradiationinz_v1(hru)])</span>
<span class="sd">        0, 105.520061</span>
<span class="sd">        1, 63.312037</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">MOY</span><span class="p">,</span> <span class="n">lland_derived</span><span class="o">.</span><span class="n">Fr</span><span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fixed</span><span class="o">.</span><span class="n">Sigma</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_aides</span><span class="o">.</span><span class="n">TempSInz</span><span class="p">,</span> <span class="n">lland_aides</span><span class="o">.</span><span class="n">RLAtm</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">d_fr</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">fr</span><span class="p">[</span><span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">der</span><span class="o">.</span><span class="n">moy</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">idx_sim</span><span class="p">]]</span>
        <span class="n">d_rlsnow</span> <span class="o">=</span> <span class="n">fix</span><span class="o">.</span><span class="n">sigma</span> <span class="o">*</span> <span class="p">(</span><span class="n">aid</span><span class="o">.</span><span class="n">tempsinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="mf">273.15</span><span class="p">)</span> <span class="o">**</span> <span class="mi">4</span>
        <span class="k">return</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">d_fr</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">d_rlsnow</span> <span class="o">-</span> <span class="n">aid</span><span class="o">.</span><span class="n">rlatm</span><span class="p">[</span><span class="n">k</span><span class="p">])</span></div>



<div class="viewcode-block" id="Return_NetLongwaveRadiationSnow_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Return_NetLongwaveRadiationSnow_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Return_NetLongwaveRadiationSnow_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate and return the net longwave radiation for snow-covered areas.</span>

<span class="sd">    Method |Return_NetLongwaveRadiationSnow_V1| differentiates between forests</span>
<span class="sd">    (|LAUBW|, |MISCHW|, and |NADELW|) and open areas.  The outgoing longwave radiation</span>
<span class="sd">    always depends on the snow surface temperature.  For open areas, the ingoing counter</span>
<span class="sd">    radiation stems from the atmosphere only.  This atmospheric radiation is partly</span>
<span class="sd">    replaced by the longwave radiation emitted by the tree canopies for forests.  The</span>
<span class="sd">    lower the value of parameter |Fr|, the higher this shading effect of the canopies.</span>
<span class="sd">    See :cite:t:`ref-LARSIM` and :cite:t:`ref-Thompson1981` for further information.</span>

<span class="sd">    Basic equation:</span>

<span class="sd">      .. math::</span>
<span class="sd">        Sigma \cdot (TempSSurface + 273.15)^4 - \begin{cases}</span>
<span class="sd">        Fr \cdot RLAtm + \big( 1 - Fr  \big) \cdot</span>
<span class="sd">        \big( 0.97 \cdot Sigma \cdot (TKor + 273.15)^4 \big)</span>
<span class="sd">        &amp;|\</span>
<span class="sd">        Lnk \in \{LAUBW, MISCHW, NADELW\}</span>
<span class="sd">        \\</span>
<span class="sd">        RLAtm</span>
<span class="sd">        &amp;|\</span>
<span class="sd">        Lnk \notin \{LAUBW, MISCHW, NADELW\}</span>
<span class="sd">        \end{cases}</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(2)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER, LAUBW)</span>
<span class="sd">        &gt;&gt;&gt; derived.moy.shape = 1</span>
<span class="sd">        &gt;&gt;&gt; derived.moy(5)</span>
<span class="sd">        &gt;&gt;&gt; derived.fr(0.3)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tempssurface = -5.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkor = 0.0</span>
<span class="sd">        &gt;&gt;&gt; aides.rlatm = 235.207154</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import print_vector</span>
<span class="sd">        &gt;&gt;&gt; for hru in range(2):</span>
<span class="sd">        ...     print_vector([hru, model.return_netlongwaveradiationsnow_v1(hru)])</span>
<span class="sd">        0, 57.945793</span>
<span class="sd">        1, 8.273292</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">MOY</span><span class="p">,</span> <span class="n">lland_derived</span><span class="o">.</span><span class="n">Fr</span><span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fixed</span><span class="o">.</span><span class="n">Sigma</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TempSSurface</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TKor</span><span class="p">,</span>
        <span class="n">lland_aides</span><span class="o">.</span><span class="n">RLAtm</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">d_temp</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">tkor</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="mf">273.15</span>
        <span class="n">d_counter</span> <span class="o">=</span> <span class="n">aid</span><span class="o">.</span><span class="n">rlatm</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">LAUBW</span><span class="p">,</span> <span class="n">MISCHW</span><span class="p">,</span> <span class="n">NADELW</span><span class="p">):</span>
            <span class="n">d_fr</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">fr</span><span class="p">[</span><span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">der</span><span class="o">.</span><span class="n">moy</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">idx_sim</span><span class="p">]]</span>
            <span class="n">d_counter</span> <span class="o">=</span> <span class="n">d_fr</span> <span class="o">*</span> <span class="n">d_counter</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">d_fr</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.97</span> <span class="o">*</span> <span class="n">fix</span><span class="o">.</span><span class="n">sigma</span> <span class="o">*</span> <span class="n">d_temp</span><span class="o">**</span><span class="mi">4</span>
        <span class="k">return</span> <span class="n">fix</span><span class="o">.</span><span class="n">sigma</span> <span class="o">*</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">tempssurface</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="mf">273.15</span><span class="p">)</span> <span class="o">**</span> <span class="mi">4</span> <span class="o">-</span> <span class="n">d_counter</span></div>



<div class="viewcode-block" id="Update_TauS_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Update_TauS_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Update_TauS_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the dimensionless age of the snow layer according to</span>
<span class="sd">    :cite:t:`ref-LARSIM` (based on :cite:t:`ref-LUBW2006b`).</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      :math:`TauS_{new} = TauS_{old} \\cdot max(1 - 0.1 \\cdot SBes), 0) +</span>
<span class="sd">      \\frac{r_1+r_2+r_3}{10^6} \\cdot Seconds`</span>

<span class="sd">      :math:`r_1 = exp\\left(5000 \\cdot</span>
<span class="sd">      \\left(\\frac{1}{273.15} - \\frac{1}{273.15+TempS}\\right)\\right)`</span>

<span class="sd">      :math:`r_2 = min\\left(r_1^{10}, 1\\right)`</span>

<span class="sd">      :math:`r_3 = 0.03`</span>

<span class="sd">    Example:</span>

<span class="sd">        For snow-free surfaces, |TauS| is not defined; snowfall rejuvenates</span>
<span class="sd">        an existing snow layer; high temperatures increase the speed of aging:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(10)</span>
<span class="sd">        &gt;&gt;&gt; derived.seconds(24*60*60)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.sbes = 0.0, 1.0, 5.0, 9.0, 10.0, 11.0, 11.0, 11.0, 11.0, 11.0</span>
<span class="sd">        &gt;&gt;&gt; states.waes = 0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; states.taus = 1.0, nan, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; aides.temps = (</span>
<span class="sd">        ...     0.0, 0.0, -10.0, -10.0, -10.0, -10.0, -1.0, 0.0, 1.0, 10.0)</span>
<span class="sd">        &gt;&gt;&gt; model.update_taus()</span>
<span class="sd">        &gt;&gt;&gt; states.taus</span>
<span class="sd">        taus(nan, 0.175392, 0.545768, 0.145768, 0.045768, 0.045768, 0.127468,</span>
<span class="sd">             0.175392, 0.181358, 0.253912)</span>

<span class="sd">        Note that an initial |numpy.nan| value serves as an indication that</span>
<span class="sd">        there has been no snow-layer in the last simulation step, meaning</span>
<span class="sd">        the snow is fresh and starts with an age of zero (see the first</span>
<span class="sd">        two hydrological response units).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">Seconds</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SBes</span><span class="p">,</span> <span class="n">lland_states</span><span class="o">.</span><span class="n">WAeS</span><span class="p">,</span> <span class="n">lland_aides</span><span class="o">.</span><span class="n">TempS</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">TauS</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">taus</span><span class="p">[</span><span class="n">k</span><span class="p">]):</span>
                    <span class="n">sta</span><span class="o">.</span><span class="n">taus</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">d_r1</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span>
                    <span class="mf">5000.0</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mf">273.15</span> <span class="o">-</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">273.15</span> <span class="o">+</span> <span class="n">aid</span><span class="o">.</span><span class="n">temps</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>
                <span class="p">)</span>
                <span class="n">d_r2</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">d_r1</span><span class="o">**</span><span class="mi">10</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">taus</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">sbes</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">)</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">taus</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">d_r1</span> <span class="o">+</span> <span class="n">d_r2</span> <span class="o">+</span> <span class="mf">0.03</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1e6</span> <span class="o">*</span> <span class="n">der</span><span class="o">.</span><span class="n">seconds</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">taus</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">nan</span></div>



<div class="viewcode-block" id="Calc_ActualAlbedo_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_ActualAlbedo_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_ActualAlbedo_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the current snow albedo according to :cite:t:`ref-LARSIM`, based on</span>
<span class="sd">    :cite:t:`ref-LUBW2006b`.</span>

<span class="sd">    For snow-free surfaces, method |Calc_ActualAlbedo_V1| sets |ActualAlbedo| to</span>
<span class="sd">    |numpy.nan|.  For snow conditions, it estimates the albedo based on the snow age,</span>
<span class="sd">    as shown by the following equation.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`ActualAlbedo = Albedo0Snow \cdot</span>
<span class="sd">      \left( 1 - SnowAgingFactor \cdot \frac{TauS}{1 + TauS} \right)`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(4)</span>
<span class="sd">        &gt;&gt;&gt; albedo0snow(0.8)</span>
<span class="sd">        &gt;&gt;&gt; snowagingfactor(0.35)</span>
<span class="sd">        &gt;&gt;&gt; states.waes = 0.0, 1.0, 1.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; states.taus = nan, 0.0, 1.0, 3.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_actualalbedo_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.actualalbedo</span>
<span class="sd">        actualalbedo(nan, 0.8, 0.66, 0.59)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">SnowAgingFactor</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Albedo0Snow</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">TauS</span><span class="p">,</span> <span class="n">lland_states</span><span class="o">.</span><span class="n">WAeS</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ActualAlbedo</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">actualalbedo</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">albedo0snow</span> <span class="o">*</span> <span class="p">(</span>
                    <span class="mf">1.0</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">snowagingfactor</span> <span class="o">*</span> <span class="n">sta</span><span class="o">.</span><span class="n">taus</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">sta</span><span class="o">.</span><span class="n">taus</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">actualalbedo</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">nan</span></div>



<div class="viewcode-block" id="Calc_NetShortwaveRadiationSnow_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_NetShortwaveRadiationSnow_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_NetShortwaveRadiationSnow_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the net shortwave radiation for snow-surfaces.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`NetShortwaveRadiationSnow =</span>
<span class="sd">      Fr \cdot (1.0 - ActualAlbedo) \cdot AdjustedGlobalRadiation`</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-30&quot;, &quot;2000-02-03&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(2)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER, LAUBW)</span>
<span class="sd">        &gt;&gt;&gt; derived.fr.acker_jan = 1.0</span>
<span class="sd">        &gt;&gt;&gt; derived.fr.acker_feb = 1.0</span>
<span class="sd">        &gt;&gt;&gt; derived.fr.laubw_jan = 0.5</span>
<span class="sd">        &gt;&gt;&gt; derived.fr.laubw_feb = 0.1</span>
<span class="sd">        &gt;&gt;&gt; derived.moy.update()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.globalradiation = 40.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.actualalbedo = 0.5</span>

<span class="sd">        &gt;&gt;&gt; model.idx_sim = pub.timegrids.init[&quot;2000-01-31&quot;]</span>
<span class="sd">        &gt;&gt;&gt; model.calc_netshortwaveradiationsnow_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.netshortwaveradiationsnow</span>
<span class="sd">        netshortwaveradiationsnow(20.0, 10.0)</span>

<span class="sd">        &gt;&gt;&gt; model.idx_sim = pub.timegrids.init[&quot;2000-02-01&quot;]</span>
<span class="sd">        &gt;&gt;&gt; model.calc_netshortwaveradiationsnow_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.netshortwaveradiationsnow</span>
<span class="sd">        netshortwaveradiationsnow(20.0, 2.0)</span>

<span class="sd">        &gt;&gt;&gt; fluxes.actualalbedo = nan</span>
<span class="sd">        &gt;&gt;&gt; model.calc_netshortwaveradiationsnow_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.netshortwaveradiationsnow</span>
<span class="sd">        netshortwaveradiationsnow(0.0, 0.0)</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">MOY</span><span class="p">,</span> <span class="n">lland_derived</span><span class="o">.</span><span class="n">Fr</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">GlobalRadiation</span><span class="p">,</span> <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ActualAlbedo</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NetShortwaveRadiationSnow</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">actualalbedo</span><span class="p">[</span><span class="n">k</span><span class="p">]):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">netshortwaveradiationsnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">netshortwaveradiationsnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">der</span><span class="o">.</span><span class="n">fr</span><span class="p">[</span><span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">der</span><span class="o">.</span><span class="n">moy</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">idx_sim</span><span class="p">]]</span>
                    <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">actualalbedo</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                    <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">globalradiation</span>
                <span class="p">)</span></div>



<div class="viewcode-block" id="Return_TempS_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Return_TempS_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Return_TempS_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate and return the average temperature of the snow layer according to</span>
<span class="sd">    :cite:t:`ref-LARSIM`.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`max\\left(</span>
<span class="sd">      \\frac{ESnow}{WATS \\cdot CPEis + (WAeS-WATS) \\cdot CPWasser},</span>
<span class="sd">      -273\\right)`</span>

<span class="sd">    Example:</span>

<span class="sd">        Note that we use |numpy.nan| values for snow-free surfaces</span>
<span class="sd">        (see the result of the first hydrological response unit) and</span>
<span class="sd">        that method |Return_TempS_V1| never returns temperature values</span>
<span class="sd">        lower than -273 °C (see the result of the fifth response unit):</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(5)</span>
<span class="sd">        &gt;&gt;&gt; states.wats = 0.0, 0.5, 5.0, 0.5, 0.5</span>
<span class="sd">        &gt;&gt;&gt; states.waes = 0.0, 1.0, 10.0, 1.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; states.esnow = 0.0, 0.0, -1.0, -10.0, -100.0</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_temps_v1(0))</span>
<span class="sd">        nan</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_temps_v1(1))</span>
<span class="sd">        0.0</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_temps_v1(2))</span>
<span class="sd">        -1.376498</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_temps_v1(3))</span>
<span class="sd">        -137.649758</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_temps_v1(4))</span>
<span class="sd">        -273.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fixed</span><span class="o">.</span><span class="n">CPWasser</span><span class="p">,</span> <span class="n">lland_fixed</span><span class="o">.</span><span class="n">CPEis</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">WATS</span><span class="p">,</span> <span class="n">lland_states</span><span class="o">.</span><span class="n">WAeS</span><span class="p">,</span> <span class="n">lland_states</span><span class="o">.</span><span class="n">ESnow</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">d_ice</span> <span class="o">=</span> <span class="n">fix</span><span class="o">.</span><span class="n">cpeis</span> <span class="o">*</span> <span class="n">sta</span><span class="o">.</span><span class="n">wats</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">d_water</span> <span class="o">=</span> <span class="n">fix</span><span class="o">.</span><span class="n">cpwasser</span> <span class="o">*</span> <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">sta</span><span class="o">.</span><span class="n">wats</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">esnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">d_ice</span> <span class="o">+</span> <span class="n">d_water</span><span class="p">),</span> <span class="o">-</span><span class="mf">273.0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">nan</span></div>



<div class="viewcode-block" id="Return_ESnowInz_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Return_ESnowInz_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Return_ESnowInz_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate and return the thermal energy content of the intercepted snow</span>
<span class="sd">    for its given bulk temperature.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`temps \cdot \big( STInz \cdot CPEis + (SInz - STInz) \cdot CPWasser \big)`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(3)</span>
<span class="sd">        &gt;&gt;&gt; states.stinz = 0.0, 0.5, 5.0</span>
<span class="sd">        &gt;&gt;&gt; states.sinz = 0.0, 1.0, 10.0</span>
<span class="sd">        &gt;&gt;&gt; states.esnowinz = 0.0, 0.0, -2.0</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_esnowinz_v1(0, 1.0))</span>
<span class="sd">        0.0</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_esnowinz_v1(1, 0.0))</span>
<span class="sd">        0.0</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_esnowinz_v1(2, -2.752995))</span>
<span class="sd">        -2.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fixed</span><span class="o">.</span><span class="n">CPWasser</span><span class="p">,</span> <span class="n">lland_fixed</span><span class="o">.</span><span class="n">CPEis</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">STInz</span><span class="p">,</span> <span class="n">lland_states</span><span class="o">.</span><span class="n">SInz</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">temps</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">d_ice</span> <span class="o">=</span> <span class="n">fix</span><span class="o">.</span><span class="n">cpeis</span> <span class="o">*</span> <span class="n">sta</span><span class="o">.</span><span class="n">stinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="n">d_water</span> <span class="o">=</span> <span class="n">fix</span><span class="o">.</span><span class="n">cpwasser</span> <span class="o">*</span> <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">sinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">sta</span><span class="o">.</span><span class="n">stinz</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">temps</span> <span class="o">*</span> <span class="p">(</span><span class="n">d_ice</span> <span class="o">+</span> <span class="n">d_water</span><span class="p">)</span></div>



<div class="viewcode-block" id="Return_ESnow_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Return_ESnow_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Return_ESnow_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate and return the thermal energy content of the snow layer for</span>
<span class="sd">    the given bulk temperature according to :cite:t:`ref-LARSIM`.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`temps \\cdot (WATS \\cdot CPEis + (WAeS-WATS)\\cdot CPWasser)`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(3)</span>
<span class="sd">        &gt;&gt;&gt; states.wats = 0.0, 0.5, 5.0</span>
<span class="sd">        &gt;&gt;&gt; states.waes = 0.0, 1.0, 10.0</span>
<span class="sd">        &gt;&gt;&gt; states.esnow = 0.0, 0.0, -2.0</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_esnow_v1(0, 1.0))</span>
<span class="sd">        0.0</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_esnow_v1(1, 0.0))</span>
<span class="sd">        0.0</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_esnow_v1(2, -2.752995))</span>
<span class="sd">        -2.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fixed</span><span class="o">.</span><span class="n">CPWasser</span><span class="p">,</span> <span class="n">lland_fixed</span><span class="o">.</span><span class="n">CPEis</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">WATS</span><span class="p">,</span> <span class="n">lland_states</span><span class="o">.</span><span class="n">WAeS</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">temps</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">d_ice</span> <span class="o">=</span> <span class="n">fix</span><span class="o">.</span><span class="n">cpeis</span> <span class="o">*</span> <span class="n">sta</span><span class="o">.</span><span class="n">wats</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="n">d_water</span> <span class="o">=</span> <span class="n">fix</span><span class="o">.</span><span class="n">cpwasser</span> <span class="o">*</span> <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">sta</span><span class="o">.</span><span class="n">wats</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">temps</span> <span class="o">*</span> <span class="p">(</span><span class="n">d_ice</span> <span class="o">+</span> <span class="n">d_water</span><span class="p">)</span></div>



<div class="viewcode-block" id="Calc_TempS_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_TempS_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_TempS_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the average temperature of the snow layer.</span>

<span class="sd">    Method |Calc_TempS_V1| uses method |Return_TempS_V1| to calculate</span>
<span class="sd">    the snow temperature of all hydrological response units.</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(3)</span>
<span class="sd">        &gt;&gt;&gt; pwmax(2.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkor = -1.0</span>
<span class="sd">        &gt;&gt;&gt; states.wats = 0.0, 0.5, 5</span>
<span class="sd">        &gt;&gt;&gt; states.waes = 0.0, 1.0, 10</span>
<span class="sd">        &gt;&gt;&gt; states.esnow = 0.0, 0.0, -2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_temps_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.temps</span>
<span class="sd">        temps(nan, 0.0, -2.752995)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Return_TempS_V1</span><span class="p">,)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fixed</span><span class="o">.</span><span class="n">CPWasser</span><span class="p">,</span> <span class="n">lland_fixed</span><span class="o">.</span><span class="n">CPEis</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">WATS</span><span class="p">,</span> <span class="n">lland_states</span><span class="o">.</span><span class="n">WAeS</span><span class="p">,</span> <span class="n">lland_states</span><span class="o">.</span><span class="n">ESnow</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_aides</span><span class="o">.</span><span class="n">TempS</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">temps</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_temps_v1</span><span class="p">(</span><span class="n">k</span><span class="p">)</span></div>



<div class="viewcode-block" id="Calc_TZ_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_TZ_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_TZ_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the mean temperature in the top-layer of the soil according to</span>
<span class="sd">    :cite:t:`ref-LARSIM` (based on :cite:t:`ref-LUBW2006b`).</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      .. math::</span>
<span class="sd">        TZ = \\begin{cases}</span>
<span class="sd">        \\frac{EBdn}{2 \\cdot z \\cdot CG}</span>
<span class="sd">        &amp;|\\</span>
<span class="sd">        EBdn \\leq 0</span>
<span class="sd">        \\\\</span>
<span class="sd">        0</span>
<span class="sd">        &amp;|\\</span>
<span class="sd">        0 &lt; EBdn \\leq HeatOfFusion</span>
<span class="sd">        \\\\</span>
<span class="sd">        \\frac{EBdn - HeatOfFusion}{2 \\cdot z \\cdot CG}</span>
<span class="sd">        &amp;|\\</span>
<span class="sd">        HeatOfFusion &lt; EBdn</span>
<span class="sd">        \\end{cases}</span>

<span class="sd">    Examples:</span>

<span class="sd">        We set |TZ| to |numpy.nan| for all types of water areas:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(7)</span>
<span class="sd">        &gt;&gt;&gt; lnk(WASSER, FLUSS, SEE, WASSER, SEE, FLUSS, WASSER)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_tz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tz</span>
<span class="sd">        tz(nan, nan, nan, nan, nan, nan, nan)</span>

<span class="sd">        For all other land use types, the above basic equation applies:</span>

<span class="sd">        &gt;&gt;&gt; lnk(ACKER)</span>
<span class="sd">        &gt;&gt;&gt; derived.heatoffusion(310.0)</span>
<span class="sd">        &gt;&gt;&gt; states.ebdn(-20.0, -10.0, 0.0, 310.0, 620.0, 630, 640.0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_tz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tz</span>
<span class="sd">        tz(-2.88, -1.44, 0.0, 0.0, 0.0, 1.44, 2.88)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">HeatOfFusion</span><span class="p">,)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fixed</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">lland_fixed</span><span class="o">.</span><span class="n">CG</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">EBdn</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TZ</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">WASSER</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">tz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">nan</span>
            <span class="k">elif</span> <span class="n">sta</span><span class="o">.</span><span class="n">ebdn</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">tz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">sta</span><span class="o">.</span><span class="n">ebdn</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">fix</span><span class="o">.</span><span class="n">z</span> <span class="o">*</span> <span class="n">fix</span><span class="o">.</span><span class="n">cg</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">sta</span><span class="o">.</span><span class="n">ebdn</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">der</span><span class="o">.</span><span class="n">heatoffusion</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">tz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">tz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">ebdn</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">der</span><span class="o">.</span><span class="n">heatoffusion</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">fix</span><span class="o">.</span><span class="n">z</span> <span class="o">*</span> <span class="n">fix</span><span class="o">.</span><span class="n">cg</span><span class="p">)</span></div>



<div class="viewcode-block" id="Return_WG_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Return_WG_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Return_WG_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate and return the &quot;dynamic&quot; soil heat flux according to</span>
<span class="sd">    :cite:t:`ref-LARSIM`.</span>

<span class="sd">    The soil heat flux |WG| depends on the temperature gradient between</span>
<span class="sd">    depth z and the surface.  We set the soil surface temperature to the air</span>
<span class="sd">    temperature for snow-free conditions and otherwise to the average</span>
<span class="sd">    temperature of the snow layer.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      .. math::</span>
<span class="sd">        \\begin{cases}</span>
<span class="sd">        LambdaG \\cdot \\frac{TZ-TempS}{Z}</span>
<span class="sd">        &amp;|\\</span>
<span class="sd">        WAeS &gt; 0</span>
<span class="sd">        \\\\</span>
<span class="sd">        LambdaG \\cdot \\frac{TZ-TKor}{Z}</span>
<span class="sd">        &amp;|\\</span>
<span class="sd">        WAeS = 0</span>
<span class="sd">        \\end{cases}</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(2)</span>
<span class="sd">        &gt;&gt;&gt; fixed.lambdag.restore()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tz = 2.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkor = 10.0</span>
<span class="sd">        &gt;&gt;&gt; states.waes = 0.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; aides.temps = nan, -1.0</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_wg_v1(0))</span>
<span class="sd">        -48.0</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_wg_v1(1))</span>
<span class="sd">        18.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fixed</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">lland_fixed</span><span class="o">.</span><span class="n">LambdaG</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TZ</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TKor</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">WAeS</span><span class="p">,</span>
        <span class="n">lland_aides</span><span class="o">.</span><span class="n">TempS</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">d_temp</span> <span class="o">=</span> <span class="n">aid</span><span class="o">.</span><span class="n">temps</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d_temp</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">tkor</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">fix</span><span class="o">.</span><span class="n">lambdag</span> <span class="o">*</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">tz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">d_temp</span><span class="p">)</span> <span class="o">/</span> <span class="n">fix</span><span class="o">.</span><span class="n">z</span></div>



<div class="viewcode-block" id="Calc_WG_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_WG_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_WG_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the soil heat flux.</span>

<span class="sd">    Method |Calc_WG_V1| uses method |Return_WG_V1| to calculate the</span>
<span class="sd">    &quot;dynamic&quot; soil heat flux for all hydrological response units that</span>
<span class="sd">    do not represent water areas.</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(5)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER, VERS, WASSER, FLUSS, SEE)</span>
<span class="sd">        &gt;&gt;&gt; fixed.lambdag.restore()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tz = 2.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkor = 10.0</span>
<span class="sd">        &gt;&gt;&gt; states.waes = 0.0, 1.0, 0.0, 0.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; aides.temps = nan, -1.0, nan, nan, nan</span>
<span class="sd">        &gt;&gt;&gt; model.calc_wg_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wg</span>
<span class="sd">        wg(-48.0, 18.0, 0.0, 0.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Return_WG_V1</span><span class="p">,)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fixed</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">lland_fixed</span><span class="o">.</span><span class="n">LambdaG</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TZ</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TKor</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">WAeS</span><span class="p">,</span>
        <span class="n">lland_aides</span><span class="o">.</span><span class="n">TempS</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WG</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">,</span> <span class="n">WASSER</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">wg</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">wg</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_wg_v1</span><span class="p">(</span><span class="n">k</span><span class="p">)</span></div>



<div class="viewcode-block" id="Update_EBdn_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Update_EBdn_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Update_EBdn_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update the thermal energy content of the upper soil layer according to</span>
<span class="sd">    :cite:t:`ref-LARSIM`.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`\\frac{dEBdn}{dt} = WG2Z - WG`</span>

<span class="sd">    Example:</span>

<span class="sd">        Water areas do not posses a soil energy content. For all other</span>
<span class="sd">        landuse types, the above equation applies:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(6)</span>
<span class="sd">        &gt;&gt;&gt; lnk(WASSER, FLUSS, SEE, ACKER, ACKER, ACKER)</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2019-04-29&quot;, &quot;2019-05-03&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; derived.moy.update()</span>
<span class="sd">        &gt;&gt;&gt; wg2z.apr = -0.347222</span>
<span class="sd">        &gt;&gt;&gt; wg2z.may = -0.462963</span>
<span class="sd">        &gt;&gt;&gt; states.ebdn = 0.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wg = 0.0, 0.0, 0.0, 5.787037, 11.574074, 23.148148</span>
<span class="sd">        &gt;&gt;&gt; model.idx_sim = 1</span>
<span class="sd">        &gt;&gt;&gt; model.update_ebdn_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.ebdn</span>
<span class="sd">        ebdn(0.0, 0.0, 0.0, -6.134259, -11.921296, -23.49537)</span>
<span class="sd">        &gt;&gt;&gt; model.idx_sim = 2</span>
<span class="sd">        &gt;&gt;&gt; model.update_ebdn_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.ebdn</span>
<span class="sd">        ebdn(0.0, 0.0, 0.0, -12.384259, -23.958333, -47.106481)</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">WG2Z</span><span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">MOY</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WG</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">EBdn</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">WASSER</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">):</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">ebdn</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">ebdn</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">con</span><span class="o">.</span><span class="n">wg2z</span><span class="p">[</span><span class="n">der</span><span class="o">.</span><span class="n">moy</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">idx_sim</span><span class="p">]]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">wg</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>



<div class="viewcode-block" id="Return_WSensInz_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Return_WSensInz_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Return_WSensInz_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate and return the sensible heat flux between the intercepted snow and</span>
<span class="sd">    the atmosphere.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`(Turb0 + Turb1 \cdot WindSpeed2m) \cdot (TempSInz - TKor)`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(2)</span>
<span class="sd">        &gt;&gt;&gt; turb0(2.0)</span>
<span class="sd">        &gt;&gt;&gt; turb1(2.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkor = -2.0, -1.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.reducedwindspeed2m = 3.0</span>
<span class="sd">        &gt;&gt;&gt; aides.tempsinz = -5.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_wsensinz_v1(0))</span>
<span class="sd">        -24.0</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_wsensinz_v1(1))</span>
<span class="sd">        8.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">Turb0</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">Turb1</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TKor</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ReducedWindSpeed2m</span><span class="p">,</span>
        <span class="n">lland_aides</span><span class="o">.</span><span class="n">TempSInz</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">turb0</span> <span class="o">+</span> <span class="n">con</span><span class="o">.</span><span class="n">turb1</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">reducedwindspeed2m</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">tempsinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">tkor</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="Return_WSensSnow_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Return_WSensSnow_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Return_WSensSnow_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate and return the sensible heat flux of the snow surface according to</span>
<span class="sd">    :cite:t:`ref-LARSIM`.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`(Turb0 + Turb1 \\cdot WindSpeed2m) \\cdot (TempSSurface - TKor)`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(2)</span>
<span class="sd">        &gt;&gt;&gt; turb0(2.0)</span>
<span class="sd">        &gt;&gt;&gt; turb1(2.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkor = -2.0, -1.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tempssurface = -5.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.reducedwindspeed2m = 3.0</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_wsenssnow_v1(0))</span>
<span class="sd">        -24.0</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_wsenssnow_v1(1))</span>
<span class="sd">        8.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">Turb0</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">Turb1</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TKor</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TempSSurface</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ReducedWindSpeed2m</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">turb0</span> <span class="o">+</span> <span class="n">con</span><span class="o">.</span><span class="n">turb1</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">reducedwindspeed2m</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">tempssurface</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">tkor</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="Return_WLatInz_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Return_WLatInz_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Return_WLatInz_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate and return the latent heat flux between the surface of the</span>
<span class="sd">    intercepted snow and the atmosphere.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`(Turb0 + Turb1 \cdot ReducedWindSpeed2m) \cdot</span>
<span class="sd">      PsiInv \cdot (SaturationVapourPressureInz - ActualVapourPressure))`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(2)</span>
<span class="sd">        &gt;&gt;&gt; turb0(2.0)</span>
<span class="sd">        &gt;&gt;&gt; turb1(2.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.reducedwindspeed2m = 3.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.saturationvapourpressureinz = 4.0, 8.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.actualvapourpressure = 6.108</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_wlatinz_v1(0))</span>
<span class="sd">        -29.68064</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_wlatinz_v1(1))</span>
<span class="sd">        26.63936</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">Turb0</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">Turb1</span><span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fixed</span><span class="o">.</span><span class="n">PsyInv</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ReducedWindSpeed2m</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SaturationVapourPressureInz</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ActualVapourPressure</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">turb0</span> <span class="o">+</span> <span class="n">con</span><span class="o">.</span><span class="n">turb1</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">reducedwindspeed2m</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="o">*</span> <span class="n">fix</span><span class="o">.</span><span class="n">psyinv</span>
            <span class="o">*</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">saturationvapourpressureinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">actualvapourpressure</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="Return_WLatSnow_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Return_WLatSnow_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Return_WLatSnow_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate and return the latent heat flux of the snow surface according to</span>
<span class="sd">    :cite:t:`ref-LARSIM`.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`(Turb0 + Turb1 \\cdot ReducedWindSpeed2m) \\cdot</span>
<span class="sd">      PsiInv \\cdot (SaturationVapourPressureSnow - ActualVapourPressure))`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(2)</span>
<span class="sd">        &gt;&gt;&gt; turb0(2.0)</span>
<span class="sd">        &gt;&gt;&gt; turb1(2.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.reducedwindspeed2m = 3.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.saturationvapourpressuresnow = 4.0, 8.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.actualvapourpressure = 6.108</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_wlatsnow_v1(0))</span>
<span class="sd">        -29.68064</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_wlatsnow_v1(1))</span>
<span class="sd">        26.63936</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">Turb0</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">Turb1</span><span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fixed</span><span class="o">.</span><span class="n">PsyInv</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ReducedWindSpeed2m</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SaturationVapourPressureSnow</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ActualVapourPressure</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">turb0</span> <span class="o">+</span> <span class="n">con</span><span class="o">.</span><span class="n">turb1</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">reducedwindspeed2m</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="o">*</span> <span class="n">fix</span><span class="o">.</span><span class="n">psyinv</span>
            <span class="o">*</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">saturationvapourpressuresnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">actualvapourpressure</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="Return_WSurf_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Return_WSurf_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Return_WSurf_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate and return the snow surface heat flux according to :cite:t:`ref-LARSIM`</span>
<span class="sd">    (based on :cite:t:`ref-LUBW2006b`).</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`KTSchnee \\cdot (TempS - TempSSurface)`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(1)</span>
<span class="sd">        &gt;&gt;&gt; ktschnee(5.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tempssurface = -4.0</span>
<span class="sd">        &gt;&gt;&gt; aides.temps = -2.0</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_wsurf_v1(0))</span>
<span class="sd">        10.0</span>

<span class="sd">        Method |Return_WSurf_V1| explicitely supports infinite</span>
<span class="sd">        |KTSchnee| values:</span>

<span class="sd">        &gt;&gt;&gt; ktschnee(inf)</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_wsurf_v1(0))</span>
<span class="sd">        inf</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">KTSchnee</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_aides</span><span class="o">.</span><span class="n">TempS</span><span class="p">,</span> <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TempSSurface</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">if</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">ktschnee</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">inf</span>
        <span class="k">return</span> <span class="n">con</span><span class="o">.</span><span class="n">ktschnee</span> <span class="o">*</span> <span class="p">(</span><span class="n">aid</span><span class="o">.</span><span class="n">temps</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">tempssurface</span><span class="p">[</span><span class="n">k</span><span class="p">])</span></div>



<div class="viewcode-block" id="Return_NetRadiation_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Return_NetRadiation_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Return_NetRadiation_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate and return the total net radiation.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`netshortwaveradiation - netlongwaveradiation`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_netradiation_v1(300.0, 200.0))</span>
<span class="sd">        100.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span>
        <span class="n">netshortwaveradiation</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">netlongwaveradiation</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">netshortwaveradiation</span> <span class="o">-</span> <span class="n">netlongwaveradiation</span></div>



<div class="viewcode-block" id="Return_EnergyGainSnowSurface_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Return_EnergyGainSnowSurface_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Return_EnergyGainSnowSurface_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate and return the net energy gain of the snow surface</span>
<span class="sd">    (:cite:t`ref-LARSIM` based on :cite:t:`ref-LUBW2006b`, modified).</span>

<span class="sd">    As surface cannot store any energy, method |Return_EnergyGainSnowSurface_V1|</span>
<span class="sd">    returns zero if one supplies it with the correct temperature of the</span>
<span class="sd">    snow surface.  Hence, this methods provides a means to find this</span>
<span class="sd">    &quot;correct&quot; temperature via root finding algorithms.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`WSurf(tempssurface) +</span>
<span class="sd">      NetshortwaveRadiation - NetlongwaveRadiation(tempssurface) -</span>
<span class="sd">      WSensSnow(tempssurface) - WLatSnow(tempssurface)`</span>

<span class="sd">    Example:</span>

<span class="sd">        Method |Return_EnergyGainSnowSurface_V1| relies on multiple</span>
<span class="sd">        submethods with different requirements.  Hence, we first need to</span>
<span class="sd">        specify a lot of input data (see the documentation on the</span>
<span class="sd">        different submethods for further information):</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(1)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER)</span>
<span class="sd">        &gt;&gt;&gt; turb0(2.0)</span>
<span class="sd">        &gt;&gt;&gt; turb1(2.0)</span>
<span class="sd">        &gt;&gt;&gt; ktschnee(5.0)</span>
<span class="sd">        &gt;&gt;&gt; inputs.relativehumidity = 60.0</span>
<span class="sd">        &gt;&gt;&gt; states.waes = 1.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkor = -3.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.reducedwindspeed2m = 3.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.actualvapourpressure = 2.9</span>
<span class="sd">        &gt;&gt;&gt; fluxes.netshortwaveradiationsnow = 20.0</span>
<span class="sd">        &gt;&gt;&gt; derived.nmblogentries.update()</span>
<span class="sd">        &gt;&gt;&gt; aides.temps = -2.0</span>
<span class="sd">        &gt;&gt;&gt; aides.rlatm = 200.0</span>

<span class="sd">        Under the defined conditions and for a snow surface temperature of</span>
<span class="sd">        -4 °C, the net energy gain would be negative:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; model.idx_hru = 0</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_energygainsnowsurface_v1(-4.0))</span>
<span class="sd">        -82.62933</span>

<span class="sd">        As a side-effect, method |Return_EnergyGainSnowSurface_V1| calculates</span>
<span class="sd">        the following flux sequences for the given snow surface temperature:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.saturationvapourpressuresnow</span>
<span class="sd">        saturationvapourpressuresnow(4.539126)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.netlongwaveradiationsnow</span>
<span class="sd">        netlongwaveradiationsnow(97.550439)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.netradiationsnow</span>
<span class="sd">        netradiationsnow(-77.550439)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wsenssnow</span>
<span class="sd">        wsenssnow(-8.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wlatsnow</span>
<span class="sd">        wlatsnow(23.078891)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wsurf</span>
<span class="sd">        wsurf(10.0)</span>

<span class="sd">    Technical checks:</span>

<span class="sd">        Note that method |Return_EnergyGainSnowSurface_V1| calculates the</span>
<span class="sd">        value of sequence |SaturationVapourPressureSnow| before its submethod</span>
<span class="sd">        |Return_WLatSnow_V1| uses it and that it assigns the given value to</span>
<span class="sd">        sequence |TempSSurface| before its submethods |Return_WSensSnow_V1|,</span>
<span class="sd">        |Return_NetLongwaveRadiationSnow_V1|, and |Return_WSurf_V1| use it:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.core.testtools import check_selectedvariables</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland.lland_model import (</span>
<span class="sd">        ...     Return_EnergyGainSnowSurface_V1)</span>
<span class="sd">        &gt;&gt;&gt; print(check_selectedvariables(Return_EnergyGainSnowSurface_V1))</span>
<span class="sd">        Possibly missing (REQUIREDSEQUENCES):</span>
<span class="sd">            Return_WLatSnow_V1: SaturationVapourPressureSnow</span>
<span class="sd">            Return_WSensSnow_V1: TempSSurface</span>
<span class="sd">            Return_NetLongwaveRadiationSnow_V1: TempSSurface</span>
<span class="sd">            Return_WSurf_V1: TempSSurface</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Return_SaturationVapourPressure_V1</span><span class="p">,</span>
        <span class="n">Return_WLatSnow_V1</span><span class="p">,</span>
        <span class="n">Return_WSensSnow_V1</span><span class="p">,</span>
        <span class="n">Return_NetLongwaveRadiationSnow_V1</span><span class="p">,</span>
        <span class="n">Return_NetRadiation_V1</span><span class="p">,</span>
        <span class="n">Return_WSurf_V1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">KTSchnee</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Turb0</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Turb1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">MOY</span><span class="p">,</span> <span class="n">lland_derived</span><span class="o">.</span><span class="n">Fr</span><span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fixed</span><span class="o">.</span><span class="n">PsyInv</span><span class="p">,</span> <span class="n">lland_fixed</span><span class="o">.</span><span class="n">Sigma</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NetShortwaveRadiationSnow</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TKor</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ReducedWindSpeed2m</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ActualVapourPressure</span><span class="p">,</span>
        <span class="n">lland_aides</span><span class="o">.</span><span class="n">TempS</span><span class="p">,</span>
        <span class="n">lland_aides</span><span class="o">.</span><span class="n">RLAtm</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TempSSurface</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SaturationVapourPressureSnow</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WSensSnow</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WLatSnow</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NetLongwaveRadiationSnow</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NetRadiationSnow</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WSurf</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">tempssurface</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>

        <span class="n">k</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">idx_hru</span>

        <span class="n">flu</span><span class="o">.</span><span class="n">tempssurface</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">tempssurface</span>

        <span class="n">flu</span><span class="o">.</span><span class="n">saturationvapourpressuresnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_saturationvapourpressure_v1</span><span class="p">(</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">tempssurface</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">wlatsnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_wlatsnow_v1</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">wsenssnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_wsenssnow_v1</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">netlongwaveradiationsnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_netlongwaveradiationsnow_v1</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">netradiationsnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_netradiation_v1</span><span class="p">(</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">netshortwaveradiationsnow</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">flu</span><span class="o">.</span><span class="n">netlongwaveradiationsnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">wsurf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_wsurf_v1</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">wsurf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">netradiationsnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">wsenssnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">wlatsnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="Return_TempSSurface_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Return_TempSSurface_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Return_TempSSurface_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Determine and return the snow surface temperature (:cite:t:`ref-LARSIM`</span>
<span class="sd">    based on :cite:t:`ref-LUBW2006b`, modified).</span>

<span class="sd">    |Return_TempSSurface_V1| needs to determine the snow surface temperature</span>
<span class="sd">    via iteration.  Therefore, it uses the class |PegasusTempSSurface|</span>
<span class="sd">    which searches the root of the net energy gain of the snow surface</span>
<span class="sd">    defined by method |Return_EnergyGainSnowSurface_V1|.</span>

<span class="sd">    For snow-free conditions, method |Return_TempSSurface_V1| sets the value</span>
<span class="sd">    of |TempSSurface| to |numpy.nan| and the values of |WSensSnow|,</span>
<span class="sd">    |WLatSnow|, and |WSurf| to zero.  For snow conditions, the side-effects</span>
<span class="sd">    discussed in the documentation on method |Return_EnergyGainSnowSurface_V1|</span>
<span class="sd">    apply.</span>

<span class="sd">    Example:</span>

<span class="sd">        We reuse the configuration of the documentation on method</span>
<span class="sd">        |Return_EnergyGainSnowSurface_V1|, except that we prepare six</span>
<span class="sd">        hydrological response units and calculate their snow surface temperature:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(6)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER)</span>
<span class="sd">        &gt;&gt;&gt; turb0(2.0)</span>
<span class="sd">        &gt;&gt;&gt; turb1(2.0)</span>
<span class="sd">        &gt;&gt;&gt; ktschnee(5.0)</span>
<span class="sd">        &gt;&gt;&gt; inputs.relativehumidity = 60.0</span>
<span class="sd">        &gt;&gt;&gt; states.waes = 0.0, 1.0, 1.0, 1.0, 1.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkor = -3.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.reducedwindspeed2m = 3.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.actualvapourpressure = 2.9</span>
<span class="sd">        &gt;&gt;&gt; fluxes.netshortwaveradiationsnow = 10.0, 10.0, 20.0, 20.0, 20.0, 200.0</span>
<span class="sd">        &gt;&gt;&gt; aides.temps = nan, -2.0, -2.0, -50.0, -200.0, -2.0</span>
<span class="sd">        &gt;&gt;&gt; aides.rlatm = 200.0</span>
<span class="sd">        &gt;&gt;&gt; for hru in range(6):</span>
<span class="sd">        ...     _ = model.return_tempssurface_v1(hru)</span>

<span class="sd">        For the first, snow-free response unit, we cannot define a reasonable</span>
<span class="sd">        snow surface temperature, of course:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(fluxes.tempssurface[0])</span>
<span class="sd">        nan</span>

<span class="sd">        Comparing response units two and three shows that a moderate increase</span>
<span class="sd">        in short wave radiation is compensated by a moderate increase in snow</span>
<span class="sd">        surface temperature:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import print_vector</span>
<span class="sd">        &gt;&gt;&gt; print_vector(fluxes.tempssurface[1:3])</span>
<span class="sd">        -8.307868, -7.828995</span>

<span class="sd">        To demonstrate the robustness of the implemented approach, response</span>
<span class="sd">        units three to five show the extreme decrease in surface temperature</span>
<span class="sd">        due to an even more extrem decrease in the bulk temperature of the</span>
<span class="sd">        snow layer:</span>

<span class="sd">        &gt;&gt;&gt; print_vector(fluxes.tempssurface[2:5])</span>
<span class="sd">        -7.828995, -20.191197, -66.644357</span>

<span class="sd">        The sixths response unit comes with a very high net radiation</span>
<span class="sd">        to clarify that the allowed maximum value of the snow surface temperature</span>
<span class="sd">        is 0°C.  Hence, the snow temperature gradient might actually be too</span>
<span class="sd">        small for conducting all available energy deeper into the snow layer.</span>
<span class="sd">        In reality, only the topmost snow layer would melt in such a situation.</span>
<span class="sd">        Here, we do not differentiate between melting processes in different</span>
<span class="sd">        layers and thus add the potential energy excess at the snow surface to</span>
<span class="sd">        |WSurf|:</span>

<span class="sd">        &gt;&gt;&gt; print_vector(fluxes.tempssurface[5:])</span>
<span class="sd">        0.0</span>

<span class="sd">        As to be expected, the energy fluxes of the snow surface neutralise</span>
<span class="sd">        each other (within the defined numerical accuracy):</span>

<span class="sd">        &gt;&gt;&gt; print_vector(fluxes.netradiationsnow -</span>
<span class="sd">        ...              fluxes.wsenssnow -</span>
<span class="sd">        ...              fluxes.wlatsnow +</span>
<span class="sd">        ...              fluxes.wsurf)</span>
<span class="sd">        nan, 0.0, 0.0, 0.0, 0.0, 0.0</span>

<span class="sd">        Through setting parameter |KTSchnee| to |numpy.inf|, we disable</span>
<span class="sd">        the iterative search for the correct surface temperature.  Instead,</span>
<span class="sd">        method |Return_TempSSurface_V1| simply uses the bulk temperature of</span>
<span class="sd">        the snow layer as its surface temperature and sets |WSurf| so that</span>
<span class="sd">        the energy gain of the snow surface is zero:</span>

<span class="sd">        &gt;&gt;&gt; ktschnee(inf)</span>
<span class="sd">        &gt;&gt;&gt; for hru in range(6):</span>
<span class="sd">        ...     _ = model.return_tempssurface_v1(hru)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tempssurface</span>
<span class="sd">        tempssurface(nan, -2.0, -2.0, -50.0, -200.0, -2.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wsurf</span>
<span class="sd">        wsurf(0.0, 137.892846, 127.892846, -495.403823, -1835.208545, -52.107154)</span>
<span class="sd">        &gt;&gt;&gt; print_vector(fluxes.netradiationsnow -</span>
<span class="sd">        ...              fluxes.wsenssnow -</span>
<span class="sd">        ...              fluxes.wlatsnow +</span>
<span class="sd">        ...              fluxes.wsurf)</span>
<span class="sd">        nan, 0.0, 0.0, 0.0, 0.0, 0.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Return_EnergyGainSnowSurface_V1</span><span class="p">,)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Turb0</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Turb1</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">KTSchnee</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">MOY</span><span class="p">,</span> <span class="n">lland_derived</span><span class="o">.</span><span class="n">Fr</span><span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fixed</span><span class="o">.</span><span class="n">Sigma</span><span class="p">,</span> <span class="n">lland_fixed</span><span class="o">.</span><span class="n">PsyInv</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NetShortwaveRadiationSnow</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TKor</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ReducedWindSpeed2m</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ActualVapourPressure</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">WAeS</span><span class="p">,</span>
        <span class="n">lland_aides</span><span class="o">.</span><span class="n">TempS</span><span class="p">,</span>
        <span class="n">lland_aides</span><span class="o">.</span><span class="n">RLAtm</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TempSSurface</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SaturationVapourPressureSnow</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WSensSnow</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WLatSnow</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NetLongwaveRadiationSnow</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NetRadiationSnow</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WSurf</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">ktschnee</span><span class="p">):</span>
                <span class="n">model</span><span class="o">.</span><span class="n">idx_hru</span> <span class="o">=</span> <span class="n">k</span>
                <span class="n">model</span><span class="o">.</span><span class="n">return_energygainsnowsurface_v1</span><span class="p">(</span><span class="n">aid</span><span class="o">.</span><span class="n">temps</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">wsurf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">wsenssnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">wlatsnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">netradiationsnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">model</span><span class="o">.</span><span class="n">idx_hru</span> <span class="o">=</span> <span class="n">k</span>
                <span class="n">model</span><span class="o">.</span><span class="n">pegasustempssurface</span><span class="o">.</span><span class="n">find_x</span><span class="p">(</span><span class="o">-</span><span class="mf">50.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">100.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1e-8</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">wsurf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_energygainsnowsurface_v1</span><span class="p">(</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">tempssurface</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">tempssurface</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">nan</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">saturationvapourpressuresnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">wsenssnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">wlatsnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">wsurf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">return</span> <span class="n">flu</span><span class="o">.</span><span class="n">tempssurface</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>



<div class="viewcode-block" id="Return_WSurfInz_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Return_WSurfInz_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Return_WSurfInz_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate and return the intercepted snow heat flux |WSurfInz|.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`WSurfInz = WSensInz + WLatInz - NetRadiationInz`</span>

<span class="sd">    Note that method |Return_WSurfInz_V1| calls a number of submethods and uses</span>
<span class="sd">    their results to update the corresponding sequences.  When calculating</span>
<span class="sd">    |SaturationVapourPressureInz| calls method |Return_SaturationVapourPressure_V1|,</span>
<span class="sd">    as follows:</span>

<span class="sd">      :math:`SaturationVapourPressureInz = Return_SaturationVapourPressure_V1(</span>
<span class="sd">      max(TempSInz, TKor)`</span>

<span class="sd">    The reason for using the maximum of the intercepted snow temperature (|TempSInz|)</span>
<span class="sd">    and the air temperature (|TKor|) is to increase the evaporation of intercepted</span>
<span class="sd">    snow (|EvSInz|). See :cite:t:`ref-LARSIM`.</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-01&quot;, &quot;2000-01-02&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(1)</span>
<span class="sd">        &gt;&gt;&gt; lnk(LAUBW)</span>
<span class="sd">        &gt;&gt;&gt; turb0(2.0)</span>
<span class="sd">        &gt;&gt;&gt; turb1(2.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.fr(0.5)</span>
<span class="sd">        &gt;&gt;&gt; derived.nmblogentries.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.moy.update()</span>
<span class="sd">        &gt;&gt;&gt; inputs.relativehumidity = 60.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkor = -3.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.reducedwindspeed2m = 3.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.actualvapourpressure = 2.9</span>
<span class="sd">        &gt;&gt;&gt; fluxes.netshortwaveradiationinz = 20.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailysunshineduration = 10.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailypossiblesunshineduration = 12.0</span>
<span class="sd">        &gt;&gt;&gt; aides.tempsinz = -6.675053</span>
<span class="sd">        &gt;&gt;&gt; aides.rlatm = 200.0</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_wsurfinz_v1(0))</span>
<span class="sd">        21.616068</span>

<span class="sd">        &gt;&gt;&gt; fluxes.saturationvapourpressureinz</span>
<span class="sd">        saturationvapourpressureinz(4.893489)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.netlongwaveradiationinz</span>
<span class="sd">        netlongwaveradiationinz(42.94817)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.netradiationinz</span>
<span class="sd">        netradiationinz(-22.94817)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wsensinz</span>
<span class="sd">        wsensinz(-29.400424)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wlatinz</span>
<span class="sd">        wlatinz(28.068322)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wsurfinz</span>
<span class="sd">        wsurfinz(21.616068)</span>

<span class="sd">    Technical checks:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.core.testtools import check_selectedvariables</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland.lland_model import Return_WSurfInz_V1</span>
<span class="sd">        &gt;&gt;&gt; print(check_selectedvariables(Return_WSurfInz_V1))</span>
<span class="sd">        Possibly missing (REQUIREDSEQUENCES):</span>
<span class="sd">            Return_WLatInz_V1: SaturationVapourPressureInz</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Return_SaturationVapourPressure_V1</span><span class="p">,</span>
        <span class="n">Return_WLatInz_V1</span><span class="p">,</span>
        <span class="n">Return_WSensInz_V1</span><span class="p">,</span>
        <span class="n">Return_NetLongwaveRadiationInz_V1</span><span class="p">,</span>
        <span class="n">Return_NetRadiation_V1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">Turb0</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">Turb1</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">MOY</span><span class="p">,</span> <span class="n">lland_derived</span><span class="o">.</span><span class="n">Fr</span><span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fixed</span><span class="o">.</span><span class="n">Sigma</span><span class="p">,</span> <span class="n">lland_fixed</span><span class="o">.</span><span class="n">PsyInv</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NetShortwaveRadiationInz</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TKor</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ReducedWindSpeed2m</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ActualVapourPressure</span><span class="p">,</span>
        <span class="n">lland_aides</span><span class="o">.</span><span class="n">TempSInz</span><span class="p">,</span>
        <span class="n">lland_aides</span><span class="o">.</span><span class="n">RLAtm</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SaturationVapourPressureInz</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WSensInz</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WLatInz</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NetLongwaveRadiationInz</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NetRadiationInz</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WSurfInz</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">saturationvapourpressureinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_saturationvapourpressure_v1</span><span class="p">(</span>
            <span class="nb">max</span><span class="p">(</span><span class="n">aid</span><span class="o">.</span><span class="n">tempsinz</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">flu</span><span class="o">.</span><span class="n">tkor</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">wlatinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_wlatinz_v1</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">wsensinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_wsensinz_v1</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">netlongwaveradiationinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_netlongwaveradiationinz_v1</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">netradiationinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_netradiation_v1</span><span class="p">(</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">netshortwaveradiationinz</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">flu</span><span class="o">.</span><span class="n">netlongwaveradiationinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">wsurfinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">wsensinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">wlatinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">netradiationinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">flu</span><span class="o">.</span><span class="n">wsurfinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>



<div class="viewcode-block" id="Return_BackwardEulerErrorInz_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Return_BackwardEulerErrorInz_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Return_BackwardEulerErrorInz_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate and return the &quot;Backward Euler error&quot; regarding the update of</span>
<span class="sd">    |ESnowInz| due to the energy flux |WSurfInz|.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`ESnowInz_{old} - esnowinz_{new} - WSurfInz(esnowinz{new})`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-01&quot;, &quot;2000-01-02&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(1)</span>
<span class="sd">        &gt;&gt;&gt; lnk(LAUBW)</span>
<span class="sd">        &gt;&gt;&gt; turb0(2.0)</span>
<span class="sd">        &gt;&gt;&gt; turb1(2.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.fr(0.5)</span>
<span class="sd">        &gt;&gt;&gt; derived.nmblogentries.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.moy.update()</span>
<span class="sd">        &gt;&gt;&gt; inputs.relativehumidity = 60.0</span>
<span class="sd">        &gt;&gt;&gt; states.sinz = 120.0</span>
<span class="sd">        &gt;&gt;&gt; states.stinz = 100.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkor = -3.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.reducedwindspeed2m = 3.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.actualvapourpressure = 2.9</span>
<span class="sd">        &gt;&gt;&gt; fluxes.netshortwaveradiationinz = 20.0</span>
<span class="sd">        &gt;&gt;&gt; states.esnowinz = -1.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailysunshineduration = 10.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailypossiblesunshineduration = 12.0</span>
<span class="sd">        &gt;&gt;&gt; aides.rlatm = 200.0</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; model.idx_hru = 0</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_backwardeulererrorinz_v1(-22.6160684))</span>
<span class="sd">        0.0</span>

<span class="sd">        &gt;&gt;&gt; aides.tempsinz</span>
<span class="sd">        tempsinz(-6.675053)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.saturationvapourpressureinz</span>
<span class="sd">        saturationvapourpressureinz(4.893489)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.netlongwaveradiationinz</span>
<span class="sd">        netlongwaveradiationinz(42.94817)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.netradiationinz</span>
<span class="sd">        netradiationinz(-22.94817)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wsensinz</span>
<span class="sd">        wsensinz(-29.400424)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wlatinz</span>
<span class="sd">        wlatinz(28.068322)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wsurfinz</span>
<span class="sd">        wsurfinz(21.616068)</span>

<span class="sd">        &gt;&gt;&gt; states.esnowinz</span>
<span class="sd">        esnowinz(-1.0)</span>


<span class="sd">        &gt;&gt;&gt; states.sinz = 0.0</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_backwardeulererrorinz_v1(-1.8516245536573426))</span>
<span class="sd">        nan</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wsurfinz</span>
<span class="sd">        wsurfinz(21.616068)</span>

<span class="sd">    Technical checks:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.core.testtools import check_selectedvariables</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland.lland_model import Return_BackwardEulerErrorInz_V1</span>
<span class="sd">        &gt;&gt;&gt; print(check_selectedvariables(Return_BackwardEulerErrorInz_V1))</span>
<span class="sd">        Possibly missing (REQUIREDSEQUENCES):</span>
<span class="sd">            Return_WLatInz_V1: SaturationVapourPressureInz</span>
<span class="sd">            Return_WSensInz_V1: TempSInz</span>
<span class="sd">            Return_NetLongwaveRadiationInz_V1: TempSInz</span>
<span class="sd">            Return_WSurfInz_V1: TempSInz</span>

<span class="sd">    .. testsetup::</span>

<span class="sd">        &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Return_TempSInz_V1</span><span class="p">,</span>
        <span class="n">Return_SaturationVapourPressure_V1</span><span class="p">,</span>
        <span class="n">Return_WLatInz_V1</span><span class="p">,</span>
        <span class="n">Return_WSensInz_V1</span><span class="p">,</span>
        <span class="n">Return_NetLongwaveRadiationInz_V1</span><span class="p">,</span>
        <span class="n">Return_NetRadiation_V1</span><span class="p">,</span>
        <span class="n">Return_WSurfInz_V1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">Turb0</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">Turb1</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">MOY</span><span class="p">,</span> <span class="n">lland_derived</span><span class="o">.</span><span class="n">Fr</span><span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">CPWasser</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">CPEis</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">Sigma</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">PsyInv</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">SInz</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">STInz</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NetShortwaveRadiationInz</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TKor</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ReducedWindSpeed2m</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ActualVapourPressure</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">ESnowInz</span><span class="p">,</span>
        <span class="n">lland_aides</span><span class="o">.</span><span class="n">RLAtm</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_aides</span><span class="o">.</span><span class="n">TempSInz</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SaturationVapourPressureInz</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WSensInz</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WLatInz</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NetLongwaveRadiationInz</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NetRadiationInz</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WSurfInz</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">esnowinz</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">idx_hru</span>
        <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">sinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">d_esnowinz_old</span> <span class="o">=</span> <span class="n">sta</span><span class="o">.</span><span class="n">esnowinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">sta</span><span class="o">.</span><span class="n">esnowinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">esnowinz</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">tempsinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_tempsinz_v1</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="n">sta</span><span class="o">.</span><span class="n">esnowinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">d_esnowinz_old</span>
            <span class="k">return</span> <span class="n">d_esnowinz_old</span> <span class="o">-</span> <span class="n">esnowinz</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">return_wsurfinz_v1</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">nan</span></div>



<div class="viewcode-block" id="Return_BackwardEulerError_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Return_BackwardEulerError_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Return_BackwardEulerError_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate and return the &quot;Backward Euler error&quot; regarding the</span>
<span class="sd">    update of |ESnow| due to the energy fluxes |WG| and |WSurf|</span>
<span class="sd">    (:cite:t:`ref-LARSIM` based on :cite:t:`ref-LUBW2006b`, modified).</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`ESnow_{old} - esnow_{new} + WG(esnow{new}) - WSurf(esnow{new})`</span>

<span class="sd">    Method |Return_BackwardEulerError_V1| does not calculate any hydrologically</span>
<span class="sd">    meaningfull property.  It is just a technical means to update the energy</span>
<span class="sd">    content of the snow layer with running into instability issues.  See the</span>
<span class="sd">    documentation on method |Update_ESnow_V1| for further information.</span>

<span class="sd">    Example:</span>

<span class="sd">        Method |Return_BackwardEulerError_V1| relies on multiple submethods</span>
<span class="sd">        with different requirements.  Hence, we first need to specify a lot</span>
<span class="sd">        of input data (see the documentation on the different submethods for</span>
<span class="sd">        further information):</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(1)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER)</span>
<span class="sd">        &gt;&gt;&gt; turb0(2.0)</span>
<span class="sd">        &gt;&gt;&gt; turb1(2.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.nmblogentries.update()</span>
<span class="sd">        &gt;&gt;&gt; inputs.relativehumidity = 60.0</span>
<span class="sd">        &gt;&gt;&gt; states.waes = 12.0</span>
<span class="sd">        &gt;&gt;&gt; states.wats = 10.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkor = -3.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.reducedwindspeed2m = 3.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.actualvapourpressure = 2.9</span>
<span class="sd">        &gt;&gt;&gt; fluxes.netshortwaveradiationsnow = 20.0</span>
<span class="sd">        &gt;&gt;&gt; states.esnow = -1.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tz = 0.0</span>
<span class="sd">        &gt;&gt;&gt; aides.rlatm = 200.0</span>

<span class="sd">        Under the defined conditions the &quot;correct&quot; next value of |ESnow|,</span>
<span class="sd">        when following the Backward Euler approach, is approximately</span>
<span class="sd">        -2.36 Wd/m²:</span>

<span class="sd">        &gt;&gt;&gt; ktschnee(inf)</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; model.idx_hru = 0</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_backwardeulererror_v1(-2.3582799))</span>
<span class="sd">        0.0</span>

<span class="sd">        As a side-effect, method |Return_BackwardEulerError_V1| calculates</span>
<span class="sd">        the following flux sequences for the given amount of energy:</span>

<span class="sd">        &gt;&gt;&gt; aides.temps</span>
<span class="sd">        temps(-6.96038)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tempssurface</span>
<span class="sd">        tempssurface(-6.96038)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.saturationvapourpressuresnow</span>
<span class="sd">        saturationvapourpressuresnow(3.619445)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.netlongwaveradiationsnow</span>
<span class="sd">        netlongwaveradiationsnow(84.673816)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.netradiationsnow</span>
<span class="sd">        netradiationsnow(-64.673816)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wsenssnow</span>
<span class="sd">        wsenssnow(-31.683041)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wlatsnow</span>
<span class="sd">        wlatsnow(10.129785)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wsurf</span>
<span class="sd">        wsurf(43.120561)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wg</span>
<span class="sd">        wg(41.762281)</span>

<span class="sd">        Note that the original value of |ESnow| remains unchanged, to allow</span>
<span class="sd">        for calling method |Return_BackwardEulerError_V1| multiple times</span>
<span class="sd">        during a root search without the need for an external reset:</span>

<span class="sd">        &gt;&gt;&gt; states.esnow</span>
<span class="sd">        esnow(-1.0)</span>

<span class="sd">        In the above example, |KTSchnee| is set to |numpy.inf|, which is</span>
<span class="sd">        why |TempSSurface| is identical with |TempS|.  After setting the</span>
<span class="sd">        common value of 5 W/m²/K, the surface temperature is</span>
<span class="sd">        calculated by another, embeded iteration approach (see method</span>
<span class="sd">        |Return_TempSSurface_V1|).  Hence, the values of |TempSSurface|</span>
<span class="sd">        and |TempS| differ and the energy amount of -2.36 Wd/m² is</span>
<span class="sd">        not correct anymore:</span>

<span class="sd">        &gt;&gt;&gt; ktschnee(5.0)</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_backwardeulererror_v1(-2.3582799))</span>
<span class="sd">        32.808687</span>
<span class="sd">        &gt;&gt;&gt; aides.temps</span>
<span class="sd">        temps(-6.96038)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tempssurface</span>
<span class="sd">        tempssurface(-9.022755)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.saturationvapourpressuresnow</span>
<span class="sd">        saturationvapourpressuresnow(3.080429)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.netlongwaveradiationsnow</span>
<span class="sd">        netlongwaveradiationsnow(75.953474)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.netradiationsnow</span>
<span class="sd">        netradiationsnow(-55.953474)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wsenssnow</span>
<span class="sd">        wsenssnow(-48.182039)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wlatsnow</span>
<span class="sd">        wlatsnow(2.540439)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wsurf</span>
<span class="sd">        wsurf(10.311874)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wg</span>
<span class="sd">        wg(41.762281)</span>
<span class="sd">        &gt;&gt;&gt; states.esnow</span>
<span class="sd">        esnow(-1.0)</span>

<span class="sd">        If there is no snow-cover, it makes little sense to call method</span>
<span class="sd">        |Return_BackwardEulerError_V1|.  For savety, we let it then</span>
<span class="sd">        return a |numpy.nan| value:</span>

<span class="sd">        &gt;&gt;&gt; states.waes = 0.0</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_backwardeulererror_v1(-2.3582799))</span>
<span class="sd">        nan</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wsurf</span>
<span class="sd">        wsurf(10.311874)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Return_TempS_V1</span><span class="p">,</span> <span class="n">Return_WG_V1</span><span class="p">,</span> <span class="n">Return_TempSSurface_V1</span><span class="p">)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Turb0</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Turb1</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">KTSchnee</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">MOY</span><span class="p">,</span> <span class="n">lland_derived</span><span class="o">.</span><span class="n">Fr</span><span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">CPWasser</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">CPEis</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">LambdaG</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">Sigma</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">PsyInv</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">WAeS</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">WATS</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NetShortwaveRadiationSnow</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TKor</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ReducedWindSpeed2m</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TZ</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ActualVapourPressure</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">ESnow</span><span class="p">,</span>
        <span class="n">lland_aides</span><span class="o">.</span><span class="n">TempS</span><span class="p">,</span>
        <span class="n">lland_aides</span><span class="o">.</span><span class="n">RLAtm</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TempSSurface</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SaturationVapourPressureSnow</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WSensSnow</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WLatSnow</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NetLongwaveRadiationSnow</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NetRadiationSnow</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WSurf</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WG</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">esnow</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">idx_hru</span>
        <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">d_esnow_old</span> <span class="o">=</span> <span class="n">sta</span><span class="o">.</span><span class="n">esnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">sta</span><span class="o">.</span><span class="n">esnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">esnow</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">temps</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_temps_v1</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="n">sta</span><span class="o">.</span><span class="n">esnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">d_esnow_old</span>
            <span class="n">model</span><span class="o">.</span><span class="n">return_tempssurface_v1</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">wg</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_wg_v1</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">d_esnow_old</span> <span class="o">-</span> <span class="n">esnow</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">wg</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">wsurf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">nan</span></div>



<div class="viewcode-block" id="Update_ESnowInz_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Update_ESnowInz_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Update_ESnowInz_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update the thermal energy content of the intercepted snow with regard to the</span>
<span class="sd">    energy fluxes from the atmosphere (except the one related to the heat content of</span>
<span class="sd">    precipitation).</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`\\frac{dESnow}{dt} = - WSurf`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-01&quot;, &quot;2000-01-02&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(8)</span>
<span class="sd">        &gt;&gt;&gt; lnk(LAUBW)</span>
<span class="sd">        &gt;&gt;&gt; turb0(2.0)</span>
<span class="sd">        &gt;&gt;&gt; turb1(2.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.fr(0.5)</span>
<span class="sd">        &gt;&gt;&gt; derived.nmblogentries.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.moy.update()</span>
<span class="sd">        &gt;&gt;&gt; inputs.relativehumidity = 60.0</span>
<span class="sd">        &gt;&gt;&gt; states.sinz = 0.0, 120.0, 12.0, 1.2, 0.12, 0.012, 1.2e-6, 1.2e-12</span>
<span class="sd">        &gt;&gt;&gt; states.stinz = 0.0, 100.0, 12.0, 1.0, 0.10, 0.010, 1.0e-6, 1.0e-12</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkor = -3.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.reducedwindspeed2m = 3.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.actualvapourpressure = 2.9</span>
<span class="sd">        &gt;&gt;&gt; fluxes.netshortwaveradiationinz = 20.0</span>
<span class="sd">        &gt;&gt;&gt; states.esnowinz = -1.0</span>
<span class="sd">        &gt;&gt;&gt; aides.rlatm = 200.0</span>

<span class="sd">        &gt;&gt;&gt; model.update_esnowinz_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.esnowinz</span>
<span class="sd">        esnowinz(0.0, -22.616068, -2.514108, -0.300877, -0.030179, -0.003019,</span>
<span class="sd">                 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.tempsinz</span>
<span class="sd">        tempsinz(nan, -6.675053, -8.661041, -8.880269, -8.907091, -8.909782,</span>
<span class="sd">                 -8.910081, -8.910081)</span>

<span class="sd">        &gt;&gt;&gt; esnowinz = states.esnowinz.values.copy()</span>
<span class="sd">        &gt;&gt;&gt; states.esnowinz = -1.0</span>
<span class="sd">        &gt;&gt;&gt; errors = []</span>
<span class="sd">        &gt;&gt;&gt; for hru in range(8):</span>
<span class="sd">        ...     model.idx_hru = hru</span>
<span class="sd">        ...     errors.append(model.return_backwardeulererrorinz_v1(esnowinz[hru]))</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import print_vector</span>
<span class="sd">        &gt;&gt;&gt; print_vector(errors)</span>
<span class="sd">        nan, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0</span>

<span class="sd">    Technical checks:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.core.testtools import check_selectedvariables</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland.lland_model import Update_ESnowInz_V1</span>
<span class="sd">        &gt;&gt;&gt; print(check_selectedvariables(Update_ESnowInz_V1))</span>
<span class="sd">        Possibly missing (REQUIREDSEQUENCES):</span>
<span class="sd">            Return_WSurfInz_V1: TempSInz</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Return_ESnowInz_V1</span><span class="p">,</span>
        <span class="n">Return_BackwardEulerErrorInz_V1</span><span class="p">,</span>
        <span class="n">Return_WSurfInz_V1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Turb0</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Turb1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">MOY</span><span class="p">,</span> <span class="n">lland_derived</span><span class="o">.</span><span class="n">Fr</span><span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">CPWasser</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">CPEis</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">Sigma</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">PsyInv</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NetShortwaveRadiationInz</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TKor</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ReducedWindSpeed2m</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ActualVapourPressure</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">STInz</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">SInz</span><span class="p">,</span>
        <span class="n">lland_aides</span><span class="o">.</span><span class="n">RLAtm</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">ESnowInz</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_aides</span><span class="o">.</span><span class="n">TempSInz</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SaturationVapourPressureInz</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WSensInz</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WLatInz</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NetLongwaveRadiationInz</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NetRadiationInz</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WSurfInz</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">sinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">model</span><span class="o">.</span><span class="n">idx_hru</span> <span class="o">=</span> <span class="n">k</span>
                <span class="n">d_esnowinz</span> <span class="o">=</span> <span class="n">sta</span><span class="o">.</span><span class="n">esnowinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">esnowinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">pegasusesnowinz</span><span class="o">.</span><span class="n">find_x</span><span class="p">(</span>
                    <span class="n">model</span><span class="o">.</span><span class="n">return_esnowinz_v1</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="o">-</span><span class="mf">30.0</span><span class="p">),</span>
                    <span class="n">model</span><span class="o">.</span><span class="n">return_esnowinz_v1</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="mf">30.0</span><span class="p">),</span>
                    <span class="n">model</span><span class="o">.</span><span class="n">return_esnowinz_v1</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="o">-</span><span class="mf">100.0</span><span class="p">),</span>
                    <span class="n">model</span><span class="o">.</span><span class="n">return_esnowinz_v1</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">),</span>
                    <span class="mf">0.0</span><span class="p">,</span>
                    <span class="mf">1e-8</span><span class="p">,</span>
                    <span class="mi">10</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">esnowinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">aid</span><span class="o">.</span><span class="n">tempsinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                    <span class="n">sta</span><span class="o">.</span><span class="n">esnowinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">d_esnowinz</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">return_wsurfinz_v1</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">esnowinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">aid</span><span class="o">.</span><span class="n">tempsinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">nan</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">netlongwaveradiationinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">netradiationinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">saturationvapourpressureinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">wsensinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">wlatinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">wsurfinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Update_ESnow_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Update_ESnow_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Update_ESnow_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update the thermal energy content of the snow layer with regard to the</span>
<span class="sd">    energy fluxes from the soil and the atmosphere (except the one related</span>
<span class="sd">    to the heat content of precipitation). :cite:t:`ref-LARSIM` based on</span>
<span class="sd">    :cite:t:`ref-LUBW2006b`, modified.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`\\frac{dESnow}{dt} = WG - WSurf`</span>

<span class="sd">    For a thin snow cover, small absolute changes in its energy content</span>
<span class="sd">    result in extreme temperature changes, which makes the above calculation</span>
<span class="sd">    stiff.  Furthermore, the nonlinearity of the term :math:`WSurf(ESnow(t))`</span>
<span class="sd">    prevents from finding an analytical solution of the problem.  This is why</span>
<span class="sd">    we apply the A-stable Backward Euler method.  Through our simplified</span>
<span class="sd">    approach of taking only one variable (|ESnow|) into account, we can solve</span>
<span class="sd">    the underlying root finding problem without any need to calculate or</span>
<span class="sd">    approximate derivatives.  Speaking plainly, we use the Pegasus iterator</span>
<span class="sd">    |PegasusESnow| to find the root of method |Return_BackwardEulerError_V1|</span>
<span class="sd">    whenever the surface is snow-covered.</span>

<span class="sd">    Example:</span>

<span class="sd">        We reuse the configuration of the documentation on method</span>
<span class="sd">        |Return_BackwardEulerError_V1|, except that we prepare five</span>
<span class="sd">        hydrological response units:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(8)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER)</span>
<span class="sd">        &gt;&gt;&gt; turb0(2.0)</span>
<span class="sd">        &gt;&gt;&gt; turb1(2.0)</span>
<span class="sd">        &gt;&gt;&gt; ktschnee(inf)</span>
<span class="sd">        &gt;&gt;&gt; derived.nmblogentries.update()</span>
<span class="sd">        &gt;&gt;&gt; inputs.relativehumidity = 60.0</span>
<span class="sd">        &gt;&gt;&gt; states.waes = 0.0, 120.0, 12.0, 1.2, 0.12, 0.012, 1.2e-6, 1.2e-12</span>
<span class="sd">        &gt;&gt;&gt; states.wats = 0.0, 100.0, 12.0, 1.0, 0.10, 0.010, 1.0e-6, 1.0e-12</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkor = -3.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.reducedwindspeed2m = 3.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.actualvapourpressure = 2.9</span>
<span class="sd">        &gt;&gt;&gt; fluxes.netshortwaveradiationsnow = 20.0</span>
<span class="sd">        &gt;&gt;&gt; states.esnow = -1.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tz = 0.0</span>
<span class="sd">        &gt;&gt;&gt; aides.rlatm = 200.0</span>

<span class="sd">        For the first, snow-free response unit, the energy content of the</span>
<span class="sd">        snow layer is zero.  For the other response units we see that the</span>
<span class="sd">        energy content decreases with decreasing snow thickness (This</span>
<span class="sd">        result is intuitively clear, but requires iteration in very different</span>
<span class="sd">        orders of magnitudes.  We hope, our implementation works always</span>
<span class="sd">        well.  Please tell us, if you encounter any cases where it does not):</span>

<span class="sd">        &gt;&gt;&gt; model.update_esnow_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.esnow</span>
<span class="sd">        esnow(0.0, -20.789871, -2.024799, -0.239061, -0.023939, -0.002394, 0.0,</span>
<span class="sd">              0.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.temps</span>
<span class="sd">        temps(nan, -6.136057, -6.975386, -7.055793, -7.065486, -7.066457,</span>
<span class="sd">              -7.066565, -7.066565)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tempssurface</span>
<span class="sd">        tempssurface(nan, -6.136057, -6.975386, -7.055793, -7.065486, -7.066457,</span>
<span class="sd">                     -7.066565, -7.066565)</span>

<span class="sd">        As to be expected, the requirement of the Backward Euler method</span>
<span class="sd">        is approximetely fullfilled for each response unit:</span>

<span class="sd">        &gt;&gt;&gt; esnow = states.esnow.values.copy()</span>
<span class="sd">        &gt;&gt;&gt; states.esnow = -1.0</span>
<span class="sd">        &gt;&gt;&gt; errors = []</span>
<span class="sd">        &gt;&gt;&gt; for hru in range(8):</span>
<span class="sd">        ...     model.idx_hru = hru</span>
<span class="sd">        ...     errors.append(model.return_backwardeulererror_v1(esnow[hru]))</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import print_vector</span>
<span class="sd">        &gt;&gt;&gt; print_vector(errors)</span>
<span class="sd">        nan, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0</span>

<span class="sd">        The following example repeats the above one, but enables the</span>
<span class="sd">        iterative adjustment of the snow surface temperature, which</span>
<span class="sd">        is embeded into the iterative adjustment of the energy content</span>
<span class="sd">        of the snow layer:</span>

<span class="sd">        &gt;&gt;&gt; ktschnee(5.0)</span>
<span class="sd">        &gt;&gt;&gt; model.update_esnow_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.esnow</span>
<span class="sd">        esnow(0.0, -9.695862, -1.085682, -0.130026, -0.013043, -0.001305, 0.0,</span>
<span class="sd">              0.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.temps</span>
<span class="sd">        temps(nan, -2.861699, -3.740149, -3.837669, -3.849607, -3.850805,</span>
<span class="sd">              -3.850938, -3.850938)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tempssurface</span>
<span class="sd">        tempssurface(nan, -8.034911, -8.245463, -8.268877, -8.271743, -8.272031,</span>
<span class="sd">                     -8.272063, -8.272063)</span>

<span class="sd">        The resulting energy amounts are, again, the &quot;correct&quot; ones:</span>

<span class="sd">        &gt;&gt;&gt; esnow = states.esnow.values.copy()</span>
<span class="sd">        &gt;&gt;&gt; states.esnow = -1.0</span>
<span class="sd">        &gt;&gt;&gt; errors = []</span>
<span class="sd">        &gt;&gt;&gt; for hru in range(8):</span>
<span class="sd">        ...     model.idx_hru = hru</span>
<span class="sd">        ...     errors.append(model.return_backwardeulererror_v1(esnow[hru]))</span>
<span class="sd">        &gt;&gt;&gt; print_vector(errors)</span>
<span class="sd">        nan, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Return_ESnow_V1</span><span class="p">,</span>
        <span class="n">Return_TempSSurface_V1</span><span class="p">,</span>
        <span class="n">Return_WG_V1</span><span class="p">,</span>
        <span class="n">Return_BackwardEulerError_V1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Turb0</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Turb1</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">KTSchnee</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">MOY</span><span class="p">,</span> <span class="n">lland_derived</span><span class="o">.</span><span class="n">Fr</span><span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">CPWasser</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">CPEis</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">LambdaG</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">Sigma</span><span class="p">,</span>
        <span class="n">lland_fixed</span><span class="o">.</span><span class="n">PsyInv</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NetShortwaveRadiationSnow</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TKor</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ReducedWindSpeed2m</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ActualVapourPressure</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TZ</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">WATS</span><span class="p">,</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">WAeS</span><span class="p">,</span>
        <span class="n">lland_aides</span><span class="o">.</span><span class="n">TempS</span><span class="p">,</span>
        <span class="n">lland_aides</span><span class="o">.</span><span class="n">RLAtm</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">ESnow</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SaturationVapourPressureSnow</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TempSSurface</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WSensSnow</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WLatSnow</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NetLongwaveRadiationSnow</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NetRadiationSnow</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WSurf</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WG</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">model</span><span class="o">.</span><span class="n">idx_hru</span> <span class="o">=</span> <span class="n">k</span>
                <span class="n">d_esnow</span> <span class="o">=</span> <span class="n">sta</span><span class="o">.</span><span class="n">esnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">esnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">pegasusesnow</span><span class="o">.</span><span class="n">find_x</span><span class="p">(</span>
                    <span class="n">model</span><span class="o">.</span><span class="n">return_esnow_v1</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="o">-</span><span class="mf">30.0</span><span class="p">),</span>
                    <span class="n">model</span><span class="o">.</span><span class="n">return_esnow_v1</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="mf">30.0</span><span class="p">),</span>
                    <span class="n">model</span><span class="o">.</span><span class="n">return_esnow_v1</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="o">-</span><span class="mf">100.0</span><span class="p">),</span>
                    <span class="n">model</span><span class="o">.</span><span class="n">return_esnow_v1</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">),</span>
                    <span class="mf">0.0</span><span class="p">,</span>
                    <span class="mf">1e-8</span><span class="p">,</span>
                    <span class="mi">10</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">esnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">aid</span><span class="o">.</span><span class="n">temps</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">tempssurface</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_tempssurface</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">wg</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_wg_v1</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                    <span class="n">sta</span><span class="o">.</span><span class="n">esnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">d_esnow</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">wg</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">wsurf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">esnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">aid</span><span class="o">.</span><span class="n">temps</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">nan</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">tempssurface</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">nan</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">netlongwaveradiationsnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">netradiationsnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">saturationvapourpressuresnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">wsenssnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">wlatsnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">wsurf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_SchmPot_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_SchmPot_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_SchmPot_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the potential snow melt according to the day degree method.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`SchmPot = max\\left(\\frac{WGTF + WNied}{RSchmelz}, 0\\right)`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(2)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wgtf = 20.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wnied = 10.0, 20.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_schmpot_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.schmpot</span>
<span class="sd">        schmpot(3.88024, 5.173653)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fixed</span><span class="o">.</span><span class="n">RSchmelz</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WGTF</span><span class="p">,</span> <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WNied</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SchmPot</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">schmpot</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">((</span><span class="n">flu</span><span class="o">.</span><span class="n">wgtf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">wnied</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">/</span> <span class="n">fix</span><span class="o">.</span><span class="n">rschmelz</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span></div>



<div class="viewcode-block" id="Calc_SchmPot_V2">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_SchmPot_V2">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_SchmPot_V2</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the potential snow melt according to the heat content of the</span>
<span class="sd">    snow layer.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`SchmPot = max\\left(\\frac{ESnow}{RSchmelz}, 0\\right)`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(4)</span>
<span class="sd">        &gt;&gt;&gt; states.waes = 0.0, 1.0, 1.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; states.esnow = nan, 100.0, 50.0, -50.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_schmpot_v2()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.schmpot</span>
<span class="sd">        schmpot(0.0, 12.934132, 6.467066, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fixed</span><span class="o">.</span><span class="n">RSchmelz</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">ESnow</span><span class="p">,</span> <span class="n">lland_states</span><span class="o">.</span><span class="n">WAeS</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SchmPot</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">schmpot</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">esnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">fix</span><span class="o">.</span><span class="n">rschmelz</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">schmpot</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_GefrPot_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_GefrPot_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_GefrPot_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the potential refreezing within the snow layer according</span>
<span class="sd">    to the thermal energy content of the snow layer.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`GefrPot = max\\left(-\\frac{ESnow}{RSchmelz}, 0\\right)`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(4)</span>
<span class="sd">        &gt;&gt;&gt; states.waes = 0.0, 1.0, 1.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; states.esnow = nan, -100.0, -50.0, 50.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_gefrpot_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.gefrpot</span>
<span class="sd">        gefrpot(0.0, 12.934132, 6.467066, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fixed</span><span class="o">.</span><span class="n">RSchmelz</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">ESnow</span><span class="p">,</span> <span class="n">lland_states</span><span class="o">.</span><span class="n">WAeS</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">GefrPot</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">gefrpot</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="n">sta</span><span class="o">.</span><span class="n">esnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">fix</span><span class="o">.</span><span class="n">rschmelz</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">gefrpot</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_Schm_WATS_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_Schm_WATS_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_Schm_WATS_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the actual amount of water melting within the snow layer.</span>

<span class="sd">    Basic equations:</span>

<span class="sd">      :math:`\\frac{dW\\!ATS}{dt} = -Schm`</span>

<span class="sd">      .. math::</span>
<span class="sd">        Schm = \\begin{cases}</span>
<span class="sd">        SchmPot</span>
<span class="sd">        &amp;|\\</span>
<span class="sd">        WATS &gt; 0</span>
<span class="sd">        \\\\</span>
<span class="sd">        0</span>
<span class="sd">        &amp;|\\</span>
<span class="sd">        WATS = 0</span>
<span class="sd">        \\end{cases}</span>


<span class="sd">    Examples:</span>

<span class="sd">        We initialise two water (|FLUSS| and |SEE|) and four arable land</span>
<span class="sd">        (|ACKER|) HRUs.  We assume the same values for the initial amount</span>
<span class="sd">        of frozen water (|WATS|) and the frozen part of stand precipitation</span>
<span class="sd">        (|SBes|), but different values for potential snowmelt (|SchmPot|):</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(6)</span>
<span class="sd">        &gt;&gt;&gt; lnk(FLUSS, SEE, ACKER, ACKER, ACKER, ACKER)</span>
<span class="sd">        &gt;&gt;&gt; states.wats = 0.0, 0.0, 2.0, 2.0, 2.0, 2.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.schmpot = 1.0, 1.0, 0.0, 1.0, 3.0, 5.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_schm_wats_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.wats</span>
<span class="sd">        wats(0.0, 0.0, 2.0, 1.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.schm</span>
<span class="sd">        schm(0.0, 0.0, 0.0, 1.0, 2.0, 2.0)</span>

<span class="sd">        Actual melt is either limited by potential melt or the available frozen</span>
<span class="sd">        water, which is the sum of initial frozen water and the frozen part</span>
<span class="sd">        of stand precipitation.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SchmPot</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">Schm</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">WATS</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">WASSER</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">schm</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">schm</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">schmpot</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">sta</span><span class="o">.</span><span class="n">wats</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">wats</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-=</span> <span class="n">flu</span><span class="o">.</span><span class="n">schm</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>



<div class="viewcode-block" id="Calc_Gefr_WATS_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_Gefr_WATS_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_Gefr_WATS_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the actual amount of water melting within the snow layer.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      :math:`\\frac{dGefr}{dt} = -Gefr`</span>

<span class="sd">      .. math::</span>
<span class="sd">        Gefr = \\begin{cases}</span>
<span class="sd">        GefrPot</span>
<span class="sd">        &amp;|\\</span>
<span class="sd">        WAeS - WATS &gt; 0</span>
<span class="sd">        \\\\</span>
<span class="sd">        0</span>
<span class="sd">        &amp;|\\</span>
<span class="sd">        WAeS - WATS = 0</span>
<span class="sd">        \\end{cases}</span>

<span class="sd">    Examples:</span>

<span class="sd">        We initialise two water (|FLUSS| and |SEE|) and four arable land</span>
<span class="sd">        (|ACKER|) HRUs.  We assume the same values for the initial amount</span>
<span class="sd">        of frozen water (|WATS|) and the frozen part of stand precipitation</span>
<span class="sd">        (|SBes|), but different values for potential snowmelt (|SchmPot|):</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(6)</span>
<span class="sd">        &gt;&gt;&gt; lnk(FLUSS, SEE, ACKER, ACKER, ACKER, ACKER)</span>
<span class="sd">        &gt;&gt;&gt; refreezeflag(True)</span>
<span class="sd">        &gt;&gt;&gt; states.wats = 0.0, 0.0, 2.0, 2.0, 2.0, 2.0</span>
<span class="sd">        &gt;&gt;&gt; states.waes = 0.0, 0.0, 4.0, 4.0, 4.0, 4.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.gefrpot = 1.0, 1.0, 0.0, 1.0, 3.0, 5.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_gefr_wats_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.wats</span>
<span class="sd">        wats(0.0, 0.0, 2.0, 3.0, 4.0, 4.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.gefr</span>
<span class="sd">        gefr(0.0, 0.0, 0.0, 1.0, 2.0, 2.0)</span>

<span class="sd">        If we deactivate the refreezing flag, liquid water in the snow layer</span>
<span class="sd">        does not refreeze. |Gefr| is set to 0 and |WATS| does not change:</span>

<span class="sd">        &gt;&gt;&gt; refreezeflag(False)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_gefr_wats_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.wats</span>
<span class="sd">        wats(0.0, 0.0, 2.0, 3.0, 4.0, 4.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.gefr</span>
<span class="sd">        gefr(0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>

<span class="sd">        Actual refreezing is either limited by potential refreezing or the</span>
<span class="sd">        available water.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">RefreezeFlag</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">GefrPot</span><span class="p">,</span> <span class="n">lland_states</span><span class="o">.</span><span class="n">WAeS</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">Gefr</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">WATS</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">WASSER</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">con</span><span class="o">.</span><span class="n">refreezeflag</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">gefr</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">gefr</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">gefrpot</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">sta</span><span class="o">.</span><span class="n">wats</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">wats</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">gefr</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>



<div class="viewcode-block" id="Update_WaDa_WAeS_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Update_WaDa_WAeS_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Update_WaDa_WAeS_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update the actual water release from and the liquid water content of</span>
<span class="sd">    the snow layer due to melting.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      :math:`WaDa_{new} = WaDa_{old} + \\Delta`</span>

<span class="sd">      :math:`WAeS_{new} = WAeS_{old} - \\Delta`</span>

<span class="sd">      :math:`\\Delta = max(WAeS-PWMax \\cdot WATS, 0)`</span>

<span class="sd">    Examples:</span>

<span class="sd">        We set the threshold parameter |PWMax| for each of the seven</span>
<span class="sd">        initialised hydrological response units to two.  Thus, the snow</span>
<span class="sd">        cover can hold as much liquid water as it contains frozen water.</span>
<span class="sd">        For the first three response units, which represent water</span>
<span class="sd">        surfaces, snow-related processes are ignored and the original</span>
<span class="sd">        values of |WaDa| and |WAeS| remain unchanged. For all other land</span>
<span class="sd">        use classes (of which we select |ACKER| arbitrarily), method</span>
<span class="sd">        |Update_WaDa_WAeS_V1| passes only the amount of |WAeS| exceeding</span>
<span class="sd">        the actual snow holding capacity to |WaDa|:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(7)</span>
<span class="sd">        &gt;&gt;&gt; lnk(WASSER, FLUSS, SEE, ACKER, ACKER, ACKER, ACKER)</span>
<span class="sd">        &gt;&gt;&gt; pwmax(2.0)</span>
<span class="sd">        &gt;&gt;&gt; states.wats = 0.0, 0.0, 0.0, 0.0, 1.0, 1.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; states.waes = 1.0, 1.0, 1.0, 0.0, 1.0, 2.0, 3.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wada = 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.update_wada_waes_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.waes</span>
<span class="sd">        waes(1.0, 1.0, 1.0, 0.0, 1.0, 2.0, 2.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wada</span>
<span class="sd">        wada(1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 2.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">PWMax</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">WATS</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">WAeS</span><span class="p">,</span> <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WaDa</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="n">WASSER</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">):</span>
                <span class="n">d_wada_corr</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">pwmax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">sta</span><span class="o">.</span><span class="n">wats</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">)</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">wada</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">d_wada_corr</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-=</span> <span class="n">d_wada_corr</span></div>



<div class="viewcode-block" id="Update_ESnow_V2">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Update_ESnow_V2">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Update_ESnow_V2</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update the thermal energy content of the snow layer regarding snow</span>
<span class="sd">    melt and refreezing.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`\\frac{dESNOW}{dt} = RSchmelz \\cdot (Gefr - Schm)`</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(7)</span>
<span class="sd">        &gt;&gt;&gt; lnk(WASSER, FLUSS, SEE, ACKER, ACKER, ACKER, ACKER)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.gefr = 0.0, 0.0, 0.0, 0.0, 4.0, 0.0, 4.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.schm = 0.0, 0.0, 0.0, 0.0, 0.0, 4.0, 4.0</span>
<span class="sd">        &gt;&gt;&gt; states.esnow = 20.0, 20.0, 20.0, 20.0, -40.0, 30.925926, 0.0</span>
<span class="sd">        &gt;&gt;&gt; states.waes = 1.0, 1.0, 1.0, 0.0, 5.0, 5.0, 10.0</span>
<span class="sd">        &gt;&gt;&gt; model.update_esnow_v2()</span>
<span class="sd">        &gt;&gt;&gt; states.esnow</span>
<span class="sd">        esnow(0.0, 0.0, 0.0, 0.0, -9.074074, 0.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fixed</span><span class="o">.</span><span class="n">RSchmelz</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">Gefr</span><span class="p">,</span> <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">Schm</span><span class="p">,</span> <span class="n">lland_states</span><span class="o">.</span><span class="n">WAeS</span><span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">ESnow</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">WASSER</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">):</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">esnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">esnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">fix</span><span class="o">.</span><span class="n">rschmelz</span> <span class="o">*</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">gefr</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">schm</span><span class="p">[</span><span class="n">k</span><span class="p">])</span></div>



<div class="viewcode-block" id="Calc_SFF_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_SFF_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_SFF_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the ratio between frozen water and total water within</span>
<span class="sd">    the top soil layer according to :cite:t:`ref-LARSIM`.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      :math:`SFF = min \left( max \left(</span>
<span class="sd">      1 - \frac{EBdn}{BoWa2Z \cdot RSchmelz}, 0 \right), 1 \right)`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(9)</span>
<span class="sd">        &gt;&gt;&gt; lnk(VERS, WASSER, FLUSS, SEE, ACKER, ACKER, ACKER, ACKER, ACKER)</span>
<span class="sd">        &gt;&gt;&gt; states.ebdn(0.0, 0.0, 0.0, 0.0, 620.0, 618.519, 309.259, 0.0, -1.0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_sff_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.sff</span>
<span class="sd">        sff(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.5, 1.0, 1.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fixed</span><span class="o">.</span><span class="n">BoWa2Z</span><span class="p">,</span> <span class="n">lland_fixed</span><span class="o">.</span><span class="n">RSchmelz</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">EBdn</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SFF</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">VERS</span><span class="p">,</span> <span class="n">WASSER</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">sff</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">d_sff</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">sta</span><span class="o">.</span><span class="n">ebdn</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">fix</span><span class="o">.</span><span class="n">bowa2z</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">fix</span><span class="o">.</span><span class="n">rschmelz</span><span class="p">)</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">sff</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">d_sff</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="mf">1.0</span><span class="p">)</span></div>



<div class="viewcode-block" id="Calc_FVG_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_FVG_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_FVG_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the degree of frost sealing of the soil according to</span>
<span class="sd">    :cite:t:`ref-LARSIM`.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`FVG = min\\bigl(FVF \\cdot SFF^{BSFF}, 1\\bigl)`</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(7)</span>
<span class="sd">        &gt;&gt;&gt; lnk(VERS, WASSER, FLUSS, SEE, ACKER, ACKER, ACKER)</span>
<span class="sd">        &gt;&gt;&gt; fvf(0.8)</span>
<span class="sd">        &gt;&gt;&gt; bsff(2.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.sff(1.0, 1.0, 1.0, 1.0, 0.0, 0.5, 1.0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_fvg_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.fvg</span>
<span class="sd">        fvg(0.0, 0.0, 0.0, 0.0, 0.0, 0.2, 0.8)</span>

<span class="sd">        The calculated degree of frost sealing does never exceed one,</span>
<span class="sd">        even when defining |FVF| values larger one:</span>

<span class="sd">        &gt;&gt;&gt; fvf(1.6)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_fvg_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.fvg</span>
<span class="sd">        fvg(0.0, 0.0, 0.0, 0.0, 0.0, 0.4, 1.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">BSFF</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">FVF</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">SFF</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">FVG</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">VERS</span><span class="p">,</span> <span class="n">WASSER</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">fvg</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">fvg</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">fvf</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">sff</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">**</span> <span class="n">con</span><span class="o">.</span><span class="n">bsff</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span></div>



<div class="viewcode-block" id="Calc_EvB_AETModel_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_EvB_AETModel_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_EvB_AETModel_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Let a submodel that follows the |AETModel_V1| submodel interface calculate</span>
<span class="sd">    soil evapotranspiration.</span>

<span class="sd">    Examples:</span>

<span class="sd">        We build an example based on |evap_aet_minhas|:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland_dd import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(5)</span>
<span class="sd">        &gt;&gt;&gt; lnk(VERS, ACKER, ACKER, MISCHW, WASSER)</span>
<span class="sd">        &gt;&gt;&gt; ft(1.0)</span>
<span class="sd">        &gt;&gt;&gt; fhru(0.05, 0.1, 0.2, 0.3, 0.35)</span>
<span class="sd">        &gt;&gt;&gt; wmax(100.0)</span>
<span class="sd">        &gt;&gt;&gt; with model.add_aetmodel_v1(&quot;evap_aet_minhas&quot;):</span>
<span class="sd">        ...     dissefactor(5.0)</span>

<span class="sd">        |Calc_EvB_AETModel_V1| stores the flux returned by the submodel without any</span>
<span class="sd">        modifications:</span>

<span class="sd">        &gt;&gt;&gt; states.bowa = 0.0, 0.0, 50.0, 100.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.aetmodel.sequences.fluxes.potentialinterceptionevaporation = 5.0</span>
<span class="sd">        &gt;&gt;&gt; model.aetmodel.sequences.fluxes.potentialsoilevapotranspiration = 5.0</span>
<span class="sd">        &gt;&gt;&gt; model.aetmodel.sequences.fluxes.interceptionevaporation = 3.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_evb_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evb</span>
<span class="sd">        evb(0.0, 0.0, 1.717962, 2.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">EvB</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">submodel</span><span class="p">:</span> <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">submodel</span><span class="o">.</span><span class="n">determine_soilevapotranspiration</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">VERS</span><span class="p">,</span> <span class="n">WASSER</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">evb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">evb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">submodel</span><span class="o">.</span><span class="n">get_soilevapotranspiration</span><span class="p">(</span><span class="n">k</span><span class="p">)</span></div>



<div class="viewcode-block" id="Calc_EvB_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_EvB_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_EvB_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Let a submodel that follows the |AETModel_V1| submodel interface calculate soil</span>
<span class="sd">    evapotranspiration.&quot;&quot;&quot;</span>

    <span class="n">SUBMODELINTERFACES</span> <span class="o">=</span> <span class="p">(</span><span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="p">,)</span>
    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Calc_EvB_AETModel_V1</span><span class="p">,)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">EvB</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">aetmodel_typeid</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">calc_evb_aetmodel_v1</span><span class="p">(</span><span class="n">cast</span><span class="p">(</span><span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">aetmodel</span><span class="p">))</span></div>

        <span class="c1"># ToDo:</span>
        <span class="c1">#     else:</span>
        <span class="c1">#         assert_never(model.petmodel)</span>


<div class="viewcode-block" id="Calc_EvS_WAeS_WATS_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_EvS_WAeS_WATS_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_EvS_WAeS_WATS_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the evaporation from the snow layer, if any exists, and</span>
<span class="sd">    update the snow cover accordingly.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      :math:`WAeS_{new} = f \\cdot WAeS_{old}`</span>

<span class="sd">      :math:`WATS_{new} = f \\cdot WATS_{old}`</span>

<span class="sd">      :math:`f = \\frac{WAeS-EvS}{WAeS}`</span>

<span class="sd">      :math:`EvS = max\\left(\\frac{WLatSnow}{L}, WAeS\\right)`</span>

<span class="sd">    Example:</span>

<span class="sd">        The first hydrological response unit shows that method</span>
<span class="sd">        |Calc_EvS_WAeS_WATS_V1| does calculate condensation and deposition</span>
<span class="sd">        if a negative flux of latent heat suggests so.  We define the</span>
<span class="sd">        relative amounts of condensation and deposition so that the fraction</span>
<span class="sd">        between the frozen and the total water content of the snow layer</span>
<span class="sd">        does not change.  The same holds for vaporisation and sublimation,</span>
<span class="sd">        as shown by response units to to seven.  Note that method</span>
<span class="sd">        |Calc_EvS_WAeS_WATS_V1| prevents negative water contents but does</span>
<span class="sd">        not prevent to high liquid water contents, which eventually needs</span>
<span class="sd">        to be corrected by another method called subsequentially.  The last</span>
<span class="sd">        response unit shows that method |Calc_EvS_WAeS_WATS_V1| sets |EvS|,</span>
<span class="sd">        |WATS| and |WAeS| to zero for water areas:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(8)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER, ACKER, ACKER, ACKER, ACKER, ACKER, ACKER, WASSER)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wlatsnow = -25.0, 0.0, 50.0, 90.0, 150.0, 150.0, 150.0, 150.0</span>
<span class="sd">        &gt;&gt;&gt; states.waes = 2.0, 2.0, 2.0, 2.0, 2.0, 1.5, 0.0, 2.0</span>
<span class="sd">        &gt;&gt;&gt; states.wats = 1.0, 1.0, 1.0, 1.0, 1.0, 0.5, 0.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_evs_waes_wats_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evs</span>
<span class="sd">        evs(-0.404881, 0.0, 0.809762, 1.457572, 2.0, 1.5, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.waes</span>
<span class="sd">        waes(2.404881, 2.0, 1.190238, 0.542428, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.wats</span>
<span class="sd">        wats(1.202441, 1.0, 0.595119, 0.271214, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fixed</span><span class="o">.</span><span class="n">LWE</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WLatSnow</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">EvS</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">WAeS</span><span class="p">,</span> <span class="n">lland_states</span><span class="o">.</span><span class="n">WATS</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">WASSER</span><span class="p">,</span> <span class="n">SEE</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">evs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">wats</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">evs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">wlatsnow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">fix</span><span class="o">.</span><span class="n">lwe</span><span class="p">,</span> <span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="n">d_frac</span> <span class="o">=</span> <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">evs</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">/</span> <span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">waes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*=</span> <span class="n">d_frac</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">wats</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*=</span> <span class="n">d_frac</span></div>



<div class="viewcode-block" id="Calc_EvI_Inzp_AETModel_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_EvI_Inzp_AETModel_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_EvI_Inzp_AETModel_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Let a submodel that follows the |AETModel_V1| submodel interface calculate</span>
<span class="sd">    interception evaporation and adjust the amount of intercepted water.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`\frac{dInzp_i}{dt} = -EvI_i`</span>

<span class="sd">    Examples:</span>

<span class="sd">        We build an example based on |evap_aet_minhas| for calculating interception</span>
<span class="sd">        evaporation, which uses |evap_ret_io| for querying potential</span>
<span class="sd">        evapotranspiration:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland_dd import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(5)</span>
<span class="sd">        &gt;&gt;&gt; lnk(VERS, ACKER, ACKER, MISCHW, WASSER)</span>
<span class="sd">        &gt;&gt;&gt; ft(1.0)</span>
<span class="sd">        &gt;&gt;&gt; fhru(0.05, 0.1, 0.2, 0.3, 0.35)</span>
<span class="sd">        &gt;&gt;&gt; derived.kinz.jun = 3.0</span>
<span class="sd">        &gt;&gt;&gt; wmax(50.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.moy.shape = 1</span>
<span class="sd">        &gt;&gt;&gt; derived.moy(5)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.nbes = 0.5</span>
<span class="sd">        &gt;&gt;&gt; with model.add_aetmodel_v1(&quot;evap_aet_minhas&quot;):</span>
<span class="sd">        ...     with model.add_petmodel_v1(&quot;evap_ret_io&quot;):</span>
<span class="sd">        ...         evapotranspirationfactor(0.6, 0.8, 1.0, 1.2, 1.4)</span>
<span class="sd">        ...         inputs.referenceevapotranspiration = 1.0</span>

<span class="sd">        For non-water areas, |Calc_EvI_Inzp_AETModel_V1| uses the flux returned by the</span>
<span class="sd">        submodel to adjust |Inzp|:</span>

<span class="sd">        &gt;&gt;&gt; states.inzp = 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_evi_inzp_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evi</span>
<span class="sd">        evi(0.6, 0.8, 1.0, 1.2, 1.4)</span>
<span class="sd">        &gt;&gt;&gt; states.inzp</span>
<span class="sd">        inzp(1.4, 1.2, 1.0, 0.8, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.nbes</span>
<span class="sd">        nbes(0.5, 0.5, 0.5, 0.5, 0.5)</span>

<span class="sd">        |Calc_EvI_Inzp_AETModel_V1| eventually reduces |EvI| so that |Inzp| does not</span>
<span class="sd">        become negative:</span>

<span class="sd">        &gt;&gt;&gt; model.aetmodel.petmodel.sequences.inputs.referenceevapotranspiration = 5.0</span>
<span class="sd">        &gt;&gt;&gt; states.inzp = 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_evi_inzp_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evi</span>
<span class="sd">        evi(2.0, 2.0, 2.0, 2.0, 7.0)</span>
<span class="sd">        &gt;&gt;&gt; states.inzp</span>
<span class="sd">        inzp(0.0, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.nbes</span>
<span class="sd">        nbes(0.5, 0.5, 0.5, 0.5, 0.5)</span>

<span class="sd">        In contrast, |Calc_EvI_Inzp_AETModel_V1| does not reduce negative |EvI| values</span>
<span class="sd">        (condensation) that cause an overshoot of the interception storage capacity:</span>

<span class="sd">        &gt;&gt;&gt; model.aetmodel.petmodel.sequences.inputs.referenceevapotranspiration = -3.0</span>
<span class="sd">        &gt;&gt;&gt; states.inzp = 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_evi_inzp_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evi</span>
<span class="sd">        evi(-1.8, -2.4, -3.0, -3.6, -4.2)</span>
<span class="sd">        &gt;&gt;&gt; states.inzp</span>
<span class="sd">        inzp(3.8, 4.4, 5.0, 5.6, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.nbes</span>
<span class="sd">        nbes(0.5, 0.5, 0.5, 0.5, 0.5)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">Inzp</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">EvI</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">submodel</span><span class="p">:</span> <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">submodel</span><span class="o">.</span><span class="n">determine_interceptionevaporation</span><span class="p">()</span>
        <span class="n">submodel</span><span class="o">.</span><span class="n">determine_waterevaporation</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">WASSER</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">evi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">submodel</span><span class="o">.</span><span class="n">get_waterevaporation</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">inzp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">evi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">submodel</span><span class="o">.</span><span class="n">get_interceptionevaporation</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">sta</span><span class="o">.</span><span class="n">inzp</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">inzp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-=</span> <span class="n">flu</span><span class="o">.</span><span class="n">evi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>



<div class="viewcode-block" id="Calc_EvI_Inzp_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_EvI_Inzp_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_EvI_Inzp_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Let a submodel that follows the |AETModel_V1| submodel interface calculate</span>
<span class="sd">    interception evaporation and adjust the amount of intercepted water.&quot;&quot;&quot;</span>

    <span class="n">SUBMODELINTERFACES</span> <span class="o">=</span> <span class="p">(</span><span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="p">,)</span>
    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Calc_EvI_Inzp_AETModel_V1</span><span class="p">,)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">Inzp</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">EvI</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">aetmodel_typeid</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">calc_evi_inzp_aetmodel_v1</span><span class="p">(</span>
                <span class="n">cast</span><span class="p">(</span><span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">aetmodel</span><span class="p">)</span>
            <span class="p">)</span></div>

        <span class="c1"># ToDo:</span>
        <span class="c1">#     else:</span>
        <span class="c1">#         assert_never(model.petmodel)</span>


<div class="viewcode-block" id="Calc_QKap_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_QKap_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_QKap_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the capillary rise.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`QKap = KapMax \\cdot min\\left(max\\left(1 -</span>
<span class="sd">      \\frac{BoWa-KapGrenz_1}{KapGrenz_2-KapGrenz_1}, 0 \\right), 1 \\right)`</span>

<span class="sd">    Examples:</span>

<span class="sd">        We prepare six hydrological response units of landuse type |ACKER|</span>
<span class="sd">        with different soil water contents:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(6)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER)</span>
<span class="sd">        &gt;&gt;&gt; wmax(100.0)</span>
<span class="sd">        &gt;&gt;&gt; states.bowa(0.0, 20.0, 40.0, 60.0, 80.0, 100.0)</span>

<span class="sd">        The maximum capillary rise is 3 mm/d (which is 1.5 mm for the</span>
<span class="sd">        actual simulation time step of 12 hours):</span>

<span class="sd">        &gt;&gt;&gt; kapmax(3.0)</span>

<span class="sd">        Please read the documentation on parameter |KapGrenz|, which gives</span>
<span class="sd">        some examples on how to configure the capillary rise thresholds.</span>
<span class="sd">        The following examples show the calculation results for with and</span>
<span class="sd">        without a range of linear transition:</span>

<span class="sd">        &gt;&gt;&gt; kapgrenz(20.0, 80.0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qkap_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qkap</span>
<span class="sd">        qkap(1.5, 1.5, 1.0, 0.5, 0.0, 0.0)</span>

<span class="sd">        &gt;&gt;&gt; kapgrenz(40.0, 40.0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qkap_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qkap</span>
<span class="sd">        qkap(1.5, 1.5, 1.5, 0.0, 0.0, 0.0)</span>

<span class="sd">        You are allowed to set the lower threshold to values lower than</span>
<span class="sd">        zero and the larger one to values larger than |WMax|:</span>

<span class="sd">        &gt;&gt;&gt; kapgrenz(-50.0, 150.0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qkap_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qkap</span>
<span class="sd">        qkap(1.125, 0.975, 0.825, 0.675, 0.525, 0.375)</span>

<span class="sd">        For water areas and sealed surfaces, capillary rise is always zero:</span>

<span class="sd">        &gt;&gt;&gt; lnk(WASSER, FLUSS, SEE, VERS, VERS, VERS)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qkap_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qkap</span>
<span class="sd">        qkap(0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">KapMax</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">KapGrenz</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">WMax</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">BoWa</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QKap</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">VERS</span><span class="p">,</span> <span class="n">WASSER</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">wmax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">qkap</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">elif</span> <span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">con</span><span class="o">.</span><span class="n">kapgrenz</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">]:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">qkap</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">kapmax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">con</span><span class="o">.</span><span class="n">kapgrenz</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">]:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">qkap</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">kapmax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span>
                    <span class="mf">1.0</span>
                    <span class="o">-</span> <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">kapgrenz</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
                    <span class="o">/</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">kapgrenz</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">kapgrenz</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">qkap</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span></div>



<div class="viewcode-block" id="Calc_QBB_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_QBB_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_QBB_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the amount of base flow released from the soil.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      .. math::</span>
<span class="sd">        QBB = \\begin{cases}</span>
<span class="sd">        0</span>
<span class="sd">        &amp;|\\</span>
<span class="sd">        BoWa \\leq PWP \\;\\; \\lor \\;\\;</span>
<span class="sd">        (BoWa \\leq FK \\;\\; \\land \\;\\; RBeta)</span>
<span class="sd">        \\\\</span>
<span class="sd">        Beta_{eff}  \\cdot (BoWa - PWP)</span>
<span class="sd">        &amp;|\\</span>
<span class="sd">        BoWa &gt; FK \\;\\; \\lor \\;\\;</span>
<span class="sd">        (BoWa &gt; PWP \\;\\; \\land \\;\\; \\overline{RBeta})</span>
<span class="sd">        \\end{cases}</span>

<span class="sd">      .. math::</span>
<span class="sd">        Beta_{eff} = \\begin{cases}</span>
<span class="sd">        Beta</span>
<span class="sd">        &amp;|\\</span>
<span class="sd">        BoWa \\leq FK</span>
<span class="sd">        \\\\</span>
<span class="sd">        Beta \\cdot \\left(1+(FBeta-1)\\cdot\\frac{BoWa-FK}{WMax-FK}\\right)</span>
<span class="sd">        &amp;|\\</span>
<span class="sd">        BoWa &gt; FK</span>
<span class="sd">        \\end{cases}</span>

<span class="sd">    Examples:</span>

<span class="sd">        For water and sealed areas, no base flow is calculated (see the</span>
<span class="sd">        first three hydrological response units of type |VERS|, |FLUSS|, and</span>
<span class="sd">        |SEE|).  No principal distinction is made between the remaining land</span>
<span class="sd">        use classes (arable land |ACKER| has been selected for the last five</span>
<span class="sd">        HRUs arbitrarily):</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(8)</span>
<span class="sd">        &gt;&gt;&gt; lnk(FLUSS, SEE, VERS, ACKER, ACKER, ACKER, ACKER, ACKER)</span>
<span class="sd">        &gt;&gt;&gt; beta(0.04)</span>
<span class="sd">        &gt;&gt;&gt; fbeta(2.0)</span>
<span class="sd">        &gt;&gt;&gt; wmax(0.0, 0.0, 0.0, 0.0, 100.0, 100.0, 100.0, 200.0)</span>
<span class="sd">        &gt;&gt;&gt; fk(70.0)</span>
<span class="sd">        &gt;&gt;&gt; pwp(10.0)</span>
<span class="sd">        &gt;&gt;&gt; rbeta(False)</span>

<span class="sd">        Note the time dependence of parameter |Beta|:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import print_vector</span>
<span class="sd">        &gt;&gt;&gt; beta</span>
<span class="sd">        beta(0.04)</span>
<span class="sd">        &gt;&gt;&gt; print_vector(beta.values)</span>
<span class="sd">        0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02</span>

<span class="sd">        In the first example, the actual soil water content |BoWa| is set</span>
<span class="sd">        to low values.  For values below the threshold |PWP|, no percolation</span>
<span class="sd">        occurs.  Above |PWP| (but below |FK|), |QBB| increases linearly by</span>
<span class="sd">        an amount defined by parameter |Beta|:</span>

<span class="sd">        &gt;&gt;&gt; states.bowa = 20.0, 20.0, 20.0, 0.0, 0.0, 10.0, 20.0, 20.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qbb_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qbb</span>
<span class="sd">        qbb(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.2, 0.2)</span>

<span class="sd">        Note that for the last two response units the same amount of base</span>
<span class="sd">        flow generation is determined, in spite of the fact that both exhibit</span>
<span class="sd">        different relative soil moistures.</span>

<span class="sd">        If we set the reduction option |RBeta| to |False|, |QBB| is</span>
<span class="sd">        reduced to zero as long as |BoWa| does not exceed |FK|:</span>

<span class="sd">        &gt;&gt;&gt; rbeta(True)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qbb_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qbb</span>
<span class="sd">        qbb(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>

<span class="sd">        In the second example, we set the actual soil water content |BoWa|</span>
<span class="sd">        to high values.  For values below threshold |FK|, the discussion above</span>
<span class="sd">        remains valid.  For values above |FK|, percolation shows a nonlinear</span>
<span class="sd">        behaviour when factor |FBeta| is set to values larger than one:</span>

<span class="sd">        &gt;&gt;&gt; rbeta(False)</span>
<span class="sd">        &gt;&gt;&gt; wmax(0.0, 0.0, 0.0, 100.0, 100.0, 100.0, 100.0, 200.0)</span>
<span class="sd">        &gt;&gt;&gt; fk(70.0)</span>
<span class="sd">        &gt;&gt;&gt; pwp(10.0)</span>
<span class="sd">        &gt;&gt;&gt; states.bowa = 0.0, 0.0, 0.0, 60.0, 70.0, 80.0, 100.0, 200.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qbb_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qbb</span>
<span class="sd">        qbb(0.0, 0.0, 0.0, 1.0, 1.2, 1.866667, 3.6, 7.6)</span>

<span class="sd">        &gt;&gt;&gt; rbeta(True)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qbb_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qbb</span>
<span class="sd">        qbb(0.0, 0.0, 0.0, 0.0, 0.0, 1.866667, 3.6, 7.6)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">WMax</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Beta</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">FBeta</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">RBeta</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">PWP</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">FK</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">BoWa</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QBB</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">VERS</span><span class="p">,</span> <span class="n">WASSER</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">))</span>
                <span class="ow">or</span> <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">con</span><span class="o">.</span><span class="n">pwp</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="ow">or</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">wmax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">qbb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">elif</span> <span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">con</span><span class="o">.</span><span class="n">fk</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">rbeta</span><span class="p">:</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">qbb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">qbb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">beta</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">pwp</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">qbb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">con</span><span class="o">.</span><span class="n">beta</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                    <span class="o">*</span> <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">pwp</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                    <span class="o">*</span> <span class="p">(</span>
                        <span class="mf">1.0</span>
                        <span class="o">+</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">fbeta</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span>
                        <span class="o">*</span> <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">fk</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                        <span class="o">/</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">wmax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">fk</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                    <span class="p">)</span>
                <span class="p">)</span></div>



<div class="viewcode-block" id="Calc_QIB1_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_QIB1_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_QIB1_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the first inflow component released from the soil.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`QIB1 = DMin \\cdot \\frac{BoWa}{WMax}`</span>

<span class="sd">    Examples:</span>

<span class="sd">        For water and sealed areas, no interflow is calculated (the first</span>
<span class="sd">        three HRUs are of type |FLUSS|, |SEE|, and |VERS|, respectively).</span>
<span class="sd">        No principal distinction is made between the remaining land use</span>
<span class="sd">        classes (arable land |ACKER| has been selected for the last five</span>
<span class="sd">        HRUs arbitrarily):</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(8)</span>
<span class="sd">        &gt;&gt;&gt; lnk(FLUSS, SEE, VERS, ACKER, ACKER, ACKER, ACKER, ACKER)</span>
<span class="sd">        &gt;&gt;&gt; dmax(10.0)</span>
<span class="sd">        &gt;&gt;&gt; dmin(4.0)</span>
<span class="sd">        &gt;&gt;&gt; wmax(101.0, 101.0, 101.0, 0.0, 101.0, 101.0, 101.0, 202.0)</span>
<span class="sd">        &gt;&gt;&gt; pwp(10.0)</span>
<span class="sd">        &gt;&gt;&gt; states.bowa = 10.1, 10.1, 10.1, 0.0, 0.0, 10.0, 10.1, 10.1</span>

<span class="sd">        Note the time dependence of parameter |DMin|:</span>

<span class="sd">        &gt;&gt;&gt; dmin</span>
<span class="sd">        dmin(4.0)</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import print_vector</span>
<span class="sd">        &gt;&gt;&gt; print_vector(dmin.values)</span>
<span class="sd">        2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0</span>

<span class="sd">        Compared to the calculation of |QBB|, the following results show</span>
<span class="sd">        some relevant differences:</span>

<span class="sd">        &gt;&gt;&gt; model.calc_qib1_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qib1</span>
<span class="sd">        qib1(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.2, 0.1)</span>

<span class="sd">        Firstly, as demonstrated with the help of the seventh and the</span>
<span class="sd">        eight HRU, the generation of the first interflow component |QIB1|</span>
<span class="sd">        depends on relative soil moisture.  Secondly, as demonstrated with</span>
<span class="sd">        the help the sixth and seventh HRU, it starts abruptly whenever</span>
<span class="sd">        the slightest exceedance of the threshold  parameter |PWP| occurs.</span>
<span class="sd">        Such sharp discontinuouties are a potential source of trouble.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">DMin</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">WMax</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">PWP</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">BoWa</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QIB1</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">VERS</span><span class="p">,</span> <span class="n">WASSER</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">con</span><span class="o">.</span><span class="n">pwp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">qib1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">qib1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">dmin</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">con</span><span class="o">.</span><span class="n">wmax</span><span class="p">[</span><span class="n">k</span><span class="p">])</span></div>



<div class="viewcode-block" id="Calc_QIB2_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_QIB2_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_QIB2_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the second inflow component released from the soil.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`QIB2 = (DMax-DMin) \\cdot</span>
<span class="sd">      \\left(\\frac{BoWa-FK}{WMax-FK}\\right)^\\frac{3}{2}`</span>

<span class="sd">    Examples:</span>

<span class="sd">        For water and sealed areas, no interflow is calculated (the first</span>
<span class="sd">        three HRUs are of type |FLUSS|, |SEE|, and |VERS|, respectively).</span>
<span class="sd">        No principal distinction is made between the remaining land use</span>
<span class="sd">        classes (arable land |ACKER| has been selected for the last</span>
<span class="sd">        five HRUs arbitrarily):</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(8)</span>
<span class="sd">        &gt;&gt;&gt; lnk(FLUSS, SEE, VERS, ACKER, ACKER, ACKER, ACKER, ACKER)</span>
<span class="sd">        &gt;&gt;&gt; dmax(10.0)</span>
<span class="sd">        &gt;&gt;&gt; dmin(4.0)</span>
<span class="sd">        &gt;&gt;&gt; wmax(100.0, 100.0, 100.0, 50.0, 100.0, 100.0, 100.0, 200.0)</span>
<span class="sd">        &gt;&gt;&gt; fk(50.0)</span>
<span class="sd">        &gt;&gt;&gt; states.bowa = 100.0, 100.0, 100.0, 50.1, 50.0, 75.0, 100.0, 100.0</span>

<span class="sd">        Note the time dependence of parameters |DMin| (see the example above)</span>
<span class="sd">        and |DMax|:</span>

<span class="sd">        &gt;&gt;&gt; dmax</span>
<span class="sd">        dmax(10.0)</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import print_vector</span>
<span class="sd">        &gt;&gt;&gt; print_vector(dmax.values)</span>
<span class="sd">        5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0</span>

<span class="sd">        The following results show that he calculation of |QIB2| both</span>
<span class="sd">        resembles those of |QBB| and |QIB1| in some regards:</span>

<span class="sd">        &gt;&gt;&gt; model.calc_qib2_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qib2</span>
<span class="sd">        qib2(0.0, 0.0, 0.0, 0.0, 0.0, 1.06066, 3.0, 0.57735)</span>

<span class="sd">        In the given example, the maximum rate of total interflow</span>
<span class="sd">        generation is 5 mm/12h (parameter |DMax|).  For the seventh zone,</span>
<span class="sd">        which contains a saturated soil, the value calculated for the</span>
<span class="sd">        second interflow component (|QIB2|) is 3 mm/h.  The &quot;missing&quot;</span>
<span class="sd">        value of 2 mm/12h is be calculated by method |Calc_QIB1_V1|.</span>

<span class="sd">        (The fourth zone, which is slightly oversaturated, is only intended</span>
<span class="sd">        to demonstrate that zero division due to |WMax| = |FK| is circumvented.)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">WMax</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">DMax</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">DMin</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">FK</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">BoWa</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QIB2</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">VERS</span><span class="p">,</span> <span class="n">WASSER</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">))</span>
                <span class="ow">or</span> <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">con</span><span class="o">.</span><span class="n">fk</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="ow">or</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">wmax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">con</span><span class="o">.</span><span class="n">fk</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">qib2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">qib2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">dmax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">dmin</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span>
                    <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">fk</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">wmax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">fk</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="p">)</span> <span class="o">**</span> <span class="mf">1.5</span></div>



<div class="viewcode-block" id="Calc_QDB_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_QDB_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_QDB_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate direct runoff released from the soil.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      .. math::</span>
<span class="sd">        QDB = \\begin{cases}</span>
<span class="sd">        max\\bigl(Exz, 0\\bigl)</span>
<span class="sd">        &amp;|\\</span>
<span class="sd">        SfA \\leq 0</span>
<span class="sd">        \\\\</span>
<span class="sd">        max\\bigl(Exz + WMax \\cdot SfA^{BSf+1}, 0\\bigl)</span>
<span class="sd">        &amp;|\\</span>
<span class="sd">        SfA &gt; 0</span>
<span class="sd">        \\end{cases}</span>

<span class="sd">      :math:`SFA = \\left(1 - \\frac{BoWa}{WMax}\\right)^\\frac{1}{BSf+1} -</span>
<span class="sd">      \\frac{WaDa}{(BSf+1) \\cdot WMax}`</span>

<span class="sd">      :math:`Exz = (BoWa + WaDa) - WMax`</span>

<span class="sd">    Examples:</span>

<span class="sd">        For water areas (|FLUSS| and |SEE|), sealed areas (|VERS|), and</span>
<span class="sd">        areas without any soil storage capacity, all water is completely</span>
<span class="sd">        routed as direct runoff |QDB| (see the first four HRUs).  No</span>
<span class="sd">        principal distinction is made between the remaining land use</span>
<span class="sd">        classes (arable land |ACKER| has been selected for the last five</span>
<span class="sd">        HRUs arbitrarily):</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(9)</span>
<span class="sd">        &gt;&gt;&gt; lnk(FLUSS, SEE, VERS, ACKER, ACKER, ACKER, ACKER, ACKER, ACKER)</span>
<span class="sd">        &gt;&gt;&gt; bsf(0.4)</span>
<span class="sd">        &gt;&gt;&gt; wmax(100.0, 100.0, 100.0, 0.0, 100.0, 100.0, 100.0, 100.0, 100.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wada = 10.0</span>
<span class="sd">        &gt;&gt;&gt; states.bowa = (</span>
<span class="sd">        ...     100.0, 100.0, 100.0, 0.0, -0.1, 0.0, 50.0, 100.0, 100.1)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qdb_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qdb</span>
<span class="sd">        qdb(10.0, 10.0, 10.0, 10.0, 0.142039, 0.144959, 1.993649, 10.0, 10.1)</span>

<span class="sd">        With the common |BSf| value of 0.4, the discharge coefficient</span>
<span class="sd">        increases more or less exponentially with soil moisture.</span>
<span class="sd">        For soil moisture values slightly below zero or above usable</span>
<span class="sd">        field capacity, plausible amounts of generated direct runoff</span>
<span class="sd">        are ensured.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">WMax</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">BSf</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WaDa</span><span class="p">,</span> <span class="n">lland_states</span><span class="o">.</span><span class="n">BoWa</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QDB</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">WASSER</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">qdb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">VERS</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">wmax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">qdb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">wada</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">con</span><span class="o">.</span><span class="n">wmax</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                    <span class="n">d_sfa</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">con</span><span class="o">.</span><span class="n">wmax</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">**</span> <span class="p">(</span>
                        <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">bsf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span>
                    <span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">wada</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="p">((</span><span class="n">con</span><span class="o">.</span><span class="n">bsf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">wmax</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">d_sfa</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">d_exz</span> <span class="o">=</span> <span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">wada</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">wmax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">qdb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">d_exz</span>
                <span class="k">if</span> <span class="n">d_sfa</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">qdb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">d_sfa</span> <span class="o">**</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">bsf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">wmax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">qdb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">qdb</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">)</span></div>



<div class="viewcode-block" id="Update_QDB_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Update_QDB_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Update_QDB_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update the direct runoff according to the degree of frost sealing.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`QDB_{updated} = QDB + FVG \\cdot (WaDa - QDB)`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(3)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qdb(5.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wada(10.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.fvg(0.2)</span>
<span class="sd">        &gt;&gt;&gt; model.update_qdb_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qdb</span>
<span class="sd">        qdb(6.0, 6.0, 6.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WaDa</span><span class="p">,</span> <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">FVG</span><span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QDB</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">qdb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">fvg</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">wada</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">qdb</span><span class="p">[</span><span class="n">k</span><span class="p">])</span></div>



<div class="viewcode-block" id="Calc_BoWa_Default_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_BoWa_Default_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_BoWa_Default_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Update the soil moisture and (if necessary) correct the fluxes to be added or</span>
<span class="sd">    subtracted.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">       :math:`\frac{dBoWa}{dt} = WaDa + Qkap - EvB - QBB - QIB1 - QIB2 - QDB`</span>

<span class="sd">       :math:`0 \leq BoWa \leq WMax`</span>

<span class="sd">    Examples:</span>

<span class="sd">        For water areas and sealed surfaces, we can set soil moisture (|BoWa|) to zero</span>
<span class="sd">        and do not need to perform any flux corrections:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(4)</span>
<span class="sd">        &gt;&gt;&gt; lnk(FLUSS, SEE, WASSER, VERS)</span>
<span class="sd">        &gt;&gt;&gt; states.bowa = 100.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_bowa_default_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.bowa</span>
<span class="sd">        bowa(0.0, 0.0, 0.0, 0.0)</span>

<span class="sd">        We make no principal distinction between the remaining land use classes and</span>
<span class="sd">        select arable land (|ACKER|) for the following examples.</span>

<span class="sd">        To prevent soil water contents from exceeding |WMax|, we might need to decrease</span>
<span class="sd">        |WaDa| and |QKap|:</span>

<span class="sd">        &gt;&gt;&gt; lnk(ACKER)</span>
<span class="sd">        &gt;&gt;&gt; wmax(100.0)</span>
<span class="sd">        &gt;&gt;&gt; states.bowa = 90.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wada = 0.0, 5.0, 10.0, 15.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qkap = 10.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evb = 5.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qbb = 0.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qib1 = 0.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qib2 = 0.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qdb = 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_bowa_default_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.bowa</span>
<span class="sd">        bowa(95.0, 100.0, 100.0, 100.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wada</span>
<span class="sd">        wada(0.0, 5.0, 2.5, 6.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qkap</span>
<span class="sd">        qkap(10.0, 10.0, 2.5, 4.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evb</span>
<span class="sd">        evb(5.0, 5.0, 5.0, 5.0)</span>

<span class="sd">        Additionally, to prevent storage overflows, we might need to decrease |EvB| if</span>
<span class="sd">        it is negative (when condensation increases the soil water storage):</span>

<span class="sd">        &gt;&gt;&gt; states.bowa = 90.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wada = 0.0, 5.0, 10.0, 15.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qkap = 2.5</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evb = -2.5</span>
<span class="sd">        &gt;&gt;&gt; model.calc_bowa_default_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.bowa</span>
<span class="sd">        bowa(95.0, 100.0, 100.0, 100.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wada</span>
<span class="sd">        wada(0.0, 5.0, 3.333333, 7.5)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qkap</span>
<span class="sd">        qkap(2.5, 2.5, 0.833333, 1.25)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evb</span>
<span class="sd">        evb(-2.5, -2.5, -0.833333, -1.25)</span>

<span class="sd">        To prevent negative |BoWa| values, we might need to decrease |QBB|, |QIB2|,</span>
<span class="sd">        |QIB1|, |QBB|, and |EvB|:</span>

<span class="sd">        &gt;&gt;&gt; states.bowa = 10.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.wada = 0.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qkap = 0.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evb = 0.0, 5.0, 10.0, 15.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qbb = 1.25</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qib1 = 1.25</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qib2 = 1.25</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qdb = 1.25</span>
<span class="sd">        &gt;&gt;&gt; model.calc_bowa_default_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.bowa</span>
<span class="sd">        bowa(5.0, 0.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evb</span>
<span class="sd">        evb(0.0, 5.0, 6.666667, 7.5)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qbb</span>
<span class="sd">        qbb(1.25, 1.25, 0.833333, 0.625)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qib1</span>
<span class="sd">        qib1(1.25, 1.25, 0.833333, 0.625)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qib2</span>
<span class="sd">        qib2(1.25, 1.25, 0.833333, 0.625)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qdb</span>
<span class="sd">        qdb(1.25, 1.25, 0.833333, 0.625)</span>

<span class="sd">        We do not modify negative |EvB| values (condensation) when preventing negative</span>
<span class="sd">        |BoWa| values:</span>

<span class="sd">        &gt;&gt;&gt; states.bowa = 10.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evb = -15.0, -10.0, -5.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qbb = 5.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qib1 = 5.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qib2 = 5.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qdb = 5.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_bowa_default_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.bowa</span>
<span class="sd">        bowa(5.0, 0.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evb</span>
<span class="sd">        evb(-15.0, -10.0, -5.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qbb</span>
<span class="sd">        qbb(5.0, 5.0, 3.75, 2.5)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qib1</span>
<span class="sd">        qib1(5.0, 5.0, 3.75, 2.5)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qib2</span>
<span class="sd">        qib2(5.0, 5.0, 3.75, 2.5)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qdb</span>
<span class="sd">        qdb(5.0, 5.0, 3.75, 2.5)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">WMax</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WaDa</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">BoWa</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">EvB</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QBB</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QIB1</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QIB2</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QDB</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QKap</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">VERS</span><span class="p">,</span> <span class="n">WASSER</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">):</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">d_decr</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">qbb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">qib1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">qib2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">qdb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">d_incr</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">wada</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">qkap</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">flu</span><span class="o">.</span><span class="n">evb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">d_decr</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">evb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">d_incr</span> <span class="o">-=</span> <span class="n">flu</span><span class="o">.</span><span class="n">evb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">d_decr</span> <span class="o">&gt;</span> <span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">d_incr</span><span class="p">:</span>
                    <span class="n">d_rvl</span> <span class="o">=</span> <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">d_incr</span><span class="p">)</span> <span class="o">/</span> <span class="n">d_decr</span>
                    <span class="k">if</span> <span class="n">flu</span><span class="o">.</span><span class="n">evb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                        <span class="n">flu</span><span class="o">.</span><span class="n">evb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*=</span> <span class="n">d_rvl</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">qbb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*=</span> <span class="n">d_rvl</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">qib1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*=</span> <span class="n">d_rvl</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">qib2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*=</span> <span class="n">d_rvl</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">qdb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*=</span> <span class="n">d_rvl</span>
                    <span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">d_incr</span><span class="p">)</span> <span class="o">-</span> <span class="n">d_decr</span>
                    <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">con</span><span class="o">.</span><span class="n">wmax</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                        <span class="n">d_factor</span> <span class="o">=</span> <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">wmax</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">/</span> <span class="n">d_incr</span>
                        <span class="k">if</span> <span class="n">flu</span><span class="o">.</span><span class="n">evb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
                            <span class="n">flu</span><span class="o">.</span><span class="n">evb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*=</span> <span class="n">d_factor</span>
                        <span class="n">flu</span><span class="o">.</span><span class="n">wada</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*=</span> <span class="n">d_factor</span>
                        <span class="n">flu</span><span class="o">.</span><span class="n">qkap</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*=</span> <span class="n">d_factor</span>
                        <span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">wmax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>



<div class="viewcode-block" id="Calc_BoWa_SoilModel_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_BoWa_SoilModel_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_BoWa_SoilModel_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Apply a submodel following the |SoilModel_V1| interface to include additional</span>
<span class="sd">    direct runoff and groundwater recharge components into the soil moisture update.</span>

<span class="sd">    Examples:</span>

<span class="sd">        We prepare a |lland| model instance consisting of four hydrological response</span>
<span class="sd">        units, which will serve as the main model:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland_dd import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nhru(4)</span>

<span class="sd">        As an example, we select |ga_garto_submodel1| as the submodel.  We define its</span>
<span class="sd">        parameter values like in the initial examples of the documentation on</span>
<span class="sd">        |ga_garto_submodel1| and its stand-alone counterpart |ga_garto| (soil type</span>
<span class="sd">        loam) but prepare - analogue to the main model&#39;s setting - four soil</span>
<span class="sd">        compartments.  The two first compartments have a soil depth of 1.0 m (&quot;deep</span>
<span class="sd">        soils&quot;) and the two last of 0.1 m (&quot;flat soils&quot;):</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import prepare_model, pub</span>
<span class="sd">        &gt;&gt;&gt; with model.add_soilmodel_v1(&quot;ga_garto_submodel1&quot;):</span>
<span class="sd">        ...     nmbsoils(4)</span>
<span class="sd">        ...     nmbbins(3)</span>
<span class="sd">        ...     with pub.options.parameterstep(&quot;1s&quot;):</span>
<span class="sd">        ...         dt(1.0)</span>
<span class="sd">        ...     sealed(False)</span>
<span class="sd">        ...     soildepth(1000.0, 1000.0, 100.0, 100.0)</span>
<span class="sd">        ...     residualmoisture(0.027)</span>
<span class="sd">        ...     saturationmoisture(0.434)</span>
<span class="sd">        ...     saturatedconductivity(13.2)</span>
<span class="sd">        ...     poresizedistribution(0.252)</span>
<span class="sd">        ...     airentrypotential(111.5)</span>

<span class="sd">        For water areas and sealed surfaces, |lland| does not apply its submodel and</span>
<span class="sd">        just sets |BoWa| to zero:</span>

<span class="sd">        &gt;&gt;&gt; lnk(FLUSS, SEE, WASSER, VERS)</span>
<span class="sd">        &gt;&gt;&gt; states.bowa = 100.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_bowa_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.bowa</span>
<span class="sd">        bowa(0.0, 0.0, 0.0, 0.0)</span>

<span class="sd">        |Calc_BoWa_SoilModel_V1| works the same for all other land use types.  We</span>
<span class="sd">        randomly select |ACKER| (arable land):</span>

<span class="sd">        &gt;&gt;&gt; lnk(ACKER)</span>

<span class="sd">        The water reaching the soil routine (|WaDa|) is 40 mm/h for each response unit</span>
<span class="sd">        in all examples:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.wada = 40.0</span>

<span class="sd">        We define a function that will help us to execute the following test runs.  It</span>
<span class="sd">        sets the values of the main model&#39;s flux sequences for direct runoff (|QDB|),</span>
<span class="sd">        both interflow components (|QIB2| and |QIB1|), base flow (|QBB|),</span>
<span class="sd">        evapotranspiration (|EvB|), and capillary rise (|QKap|).  Direct runoff is</span>
<span class="sd">        predefined to 40 mm/h for the first (deep) and third (flat) response unit and</span>
<span class="sd">        0 mm/h for the second (deep) and fourth (flat) response unit.  The other flux</span>
<span class="sd">        sequences&#39; values are customisable (default value 0 mm/h).  The initial</span>
<span class="sd">        relative soil moisture (|ga_states.Moisture|) is 10 %, which makes an absolute</span>
<span class="sd">        soil water content (|BoWa|) of 100 mm for the first two and 10 mm for the last</span>
<span class="sd">        two response units.  After applying method |Calc_BoWa_SoilModel_V1|, our test</span>
<span class="sd">        function checks for possible water balance violations and (if it does not find</span>
<span class="sd">        any) prints the updated soil moisture content and the eventually adjusted flux</span>
<span class="sd">        sequences&#39;s values:</span>

<span class="sd">        &gt;&gt;&gt; garto = model.soilmodel</span>
<span class="sd">        &gt;&gt;&gt; from numpy import array, round</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.core.objecttools import repr_values</span>
<span class="sd">        &gt;&gt;&gt; def check(qib2=0, qib1=0, qbb=0, evb=0, qkap=0):</span>
<span class="sd">        ...     fluxes.qdb = 40.0, 0.0, 40, 0.0</span>
<span class="sd">        ...     fluxes.qib2 = qib2</span>
<span class="sd">        ...     fluxes.qib1 = qib1</span>
<span class="sd">        ...     fluxes.qbb = qbb</span>
<span class="sd">        ...     fluxes.evb = evb</span>
<span class="sd">        ...     fluxes.qkap = qkap</span>
<span class="sd">        ...     garto.sequences.states.moisture = 0.1</span>
<span class="sd">        ...     garto.sequences.states.frontdepth = 0.0</span>
<span class="sd">        ...     garto.sequences.states.moisturechange = 0.0</span>
<span class="sd">        ...     old_bowa = array([garto.get_soilwatercontent(k) for k in range(4)])</span>
<span class="sd">        ...     model.calc_bowa_v1()</span>
<span class="sd">        ...     new_bowa = states.bowa.values.copy()</span>
<span class="sd">        ...     delta = (fluxes.wada + fluxes.qkap - fluxes.qdb - fluxes.qib2</span>
<span class="sd">        ...              - fluxes.qib1 - fluxes.qbb - fluxes.evb)</span>
<span class="sd">        ...     assert all(round(new_bowa, 11) == round(old_bowa + delta, 11))</span>
<span class="sd">        ...     print(&quot;bowa:&quot;, repr_values(states.bowa))</span>
<span class="sd">        ...     print(&quot;qdb:&quot;, repr_values(fluxes.qdb))</span>
<span class="sd">        ...     print(&quot;qib2:&quot;, repr_values(fluxes.qib2))</span>
<span class="sd">        ...     print(&quot;qib1:&quot;, repr_values(fluxes.qib1))</span>
<span class="sd">        ...     print(&quot;qbb:&quot;, repr_values(fluxes.qbb))</span>
<span class="sd">        ...     print(&quot;evb:&quot;, repr_values(fluxes.evb))</span>
<span class="sd">        ...     print(&quot;qkap:&quot;, repr_values(fluxes.qkap))</span>

<span class="sd">        If |WaDa| (the potential direct runoff amount) and |QDB| (the already</span>
<span class="sd">        calculated direct runoff amount) are equal, like for the hydrological response</span>
<span class="sd">        units one and three, there is no water left that could infiltrate into the</span>
<span class="sd">        soil.  For zero previously calculated direct runoff, |WaDa| could infiltrate</span>
<span class="sd">        completely.  Here, about 38.9 mm enter the deep soil, and the remainder</span>
<span class="sd">        (1.1 mm) becomes direct runoff (compare with example</span>
<span class="sd">        :ref:`ga_garto_5h_1000mm`).  The flat soil becomes completely saturated so that</span>
<span class="sd">        there is a larger amount of direct runoff (4.5 mm) and also a considerable</span>
<span class="sd">        amount of groundwater recharge (2.1 mm) (see example :ref:`ga_garto_5h_100mm`):</span>

<span class="sd">        &gt;&gt;&gt; check()</span>
<span class="sd">        bowa: 100.0, 138.896943, 10.0, 43.4</span>
<span class="sd">        qdb: 40.0, 1.103057, 40.0, 4.502667</span>
<span class="sd">        qib2: 0.0, 0.0, 0.0, 0.0</span>
<span class="sd">        qib1: 0.0, 0.0, 0.0, 0.0</span>
<span class="sd">        qbb: 0.0, 0.0, 0.0, 2.097333</span>
<span class="sd">        evb: 0.0, 0.0, 0.0, 0.0</span>
<span class="sd">        qkap: 0.0, 0.0, 0.0, 0.0</span>

<span class="sd">        |Calc_BoWa_SoilModel_V1| adds externally defined capillary rise after</span>
<span class="sd">        performing the infiltration and percolation routine.  Hence, passing a</span>
<span class="sd">        capillary rise value of 1.0 mm does not result in direct runoff or groundwater</span>
<span class="sd">        recharge differences compared to the previous example  Note that the fourths</span>
<span class="sd">        soil compartment cannot receive capillary rise due to its saturation.  Hence,</span>
<span class="sd">        |Calc_BoWa_SoilModel_V1| corrects |QKap| to zero:</span>

<span class="sd">        &gt;&gt;&gt; check(qkap=1.0)</span>
<span class="sd">        bowa: 101.0, 139.896943, 11.0, 43.4</span>
<span class="sd">        qdb: 40.0, 1.103057, 40.0, 4.502667</span>
<span class="sd">        qib2: 0.0, 0.0, 0.0, 0.0</span>
<span class="sd">        qib1: 0.0, 0.0, 0.0, 0.0</span>
<span class="sd">        qbb: 0.0, 0.0, 0.0, 2.097333</span>
<span class="sd">        evb: 0.0, 0.0, 0.0, 0.0</span>
<span class="sd">        qkap: 1.0, 1.0, 1.0, 0.0</span>

<span class="sd">        Passing an (extremely unrealistic) capillary rise of 40.0 mm requires also a</span>
<span class="sd">        reduction for the third soil compartment:</span>

<span class="sd">        &gt;&gt;&gt; check(qkap=40.0)</span>
<span class="sd">        bowa: 140.0, 178.896943, 43.4, 43.4</span>
<span class="sd">        qdb: 40.0, 1.103057, 40.0, 4.502667</span>
<span class="sd">        qib2: 0.0, 0.0, 0.0, 0.0</span>
<span class="sd">        qib1: 0.0, 0.0, 0.0, 0.0</span>
<span class="sd">        qbb: 0.0, 0.0, 0.0, 2.097333</span>
<span class="sd">        evb: 0.0, 0.0, 0.0, 0.0</span>
<span class="sd">        qkap: 40.0, 40.0, 33.4, 0.0</span>

<span class="sd">        |Calc_BoWa_SoilModel_V1| allows for negative evapotranspiration values and</span>
<span class="sd">        handles them like capillary rise.  If their sum exceeds the available soil</span>
<span class="sd">        water storage, |Calc_BoWa_SoilModel_V1| reduces both by the same factor:</span>

<span class="sd">        &gt;&gt;&gt; check(qkap=30.0, evb=-10.0)</span>
<span class="sd">        bowa: 140.0, 178.896943, 43.4, 43.4</span>
<span class="sd">        qdb: 40.0, 1.103057, 40.0, 4.502667</span>
<span class="sd">        qib2: 0.0, 0.0, 0.0, 0.0</span>
<span class="sd">        qib1: 0.0, 0.0, 0.0, 0.0</span>
<span class="sd">        qbb: 0.0, 0.0, 0.0, 2.097333</span>
<span class="sd">        evb: -10.0, -10.0, -8.35, 0.0</span>
<span class="sd">        qkap: 30.0, 30.0, 25.05, 0.0</span>

<span class="sd">        The last process triggered by |Calc_BoWa_SoilModel_V1| is removing of a</span>
<span class="sd">        defined water demand.  This demand is the sum of both interflow components,</span>
<span class="sd">        base flow, and evapotranspiration:</span>

<span class="sd">        &gt;&gt;&gt; check(qib2=6.0, qib1=3.0, qbb=2.0, evb=1.0)</span>
<span class="sd">        bowa: 88.0, 126.896943, 2.7, 31.4</span>
<span class="sd">        qdb: 40.0, 1.103057, 40.0, 4.502667</span>
<span class="sd">        qib2: 6.0, 6.0, 3.65, 6.0</span>
<span class="sd">        qib1: 3.0, 3.0, 1.825, 3.0</span>
<span class="sd">        qbb: 2.0, 2.0, 1.216667, 4.097333</span>
<span class="sd">        evb: 1.0, 1.0, 0.608333, 1.0</span>
<span class="sd">        qkap: 0.0, 0.0, 0.0, 0.0</span>

<span class="sd">        For soils that do not contain enough water to satisfy the whole demand,</span>
<span class="sd">        |Calc_BoWa_SoilModel_V1| reduces all mentioned components by the same factor:</span>

<span class="sd">        &gt;&gt;&gt; check(qib2=12.0, qib1=6.0, qbb=4.0, evb=2.0)</span>
<span class="sd">        bowa: 76.0, 114.896943, 2.7, 19.4</span>
<span class="sd">        qdb: 40.0, 1.103057, 40.0, 4.502667</span>
<span class="sd">        qib2: 12.0, 12.0, 3.65, 12.0</span>
<span class="sd">        qib1: 6.0, 6.0, 1.825, 6.0</span>
<span class="sd">        qbb: 4.0, 4.0, 1.216667, 6.097333</span>
<span class="sd">        evb: 2.0, 2.0, 0.608333, 2.0</span>
<span class="sd">        qkap: 0.0, 0.0, 0.0, 0.0</span>

<span class="sd">        Negative evapotranspiration values cannot contribute to soil overdrying.</span>
<span class="sd">        Hence, |Calc_BoWa_SoilModel_V1| does not modify negative evapotranspiration</span>
<span class="sd">        values when reducing the &quot;real&quot; loss terms:</span>

<span class="sd">        &gt;&gt;&gt; check(qib2=6.0, qib1=3.0, qbb=2.0, evb=-1.0, qkap=1.0)</span>
<span class="sd">        bowa: 91.0, 129.896943, 2.7, 32.4</span>
<span class="sd">        qdb: 40.0, 1.103057, 40.0, 4.502667</span>
<span class="sd">        qib2: 6.0, 6.0, 5.072727, 6.0</span>
<span class="sd">        qib1: 3.0, 3.0, 2.536364, 3.0</span>
<span class="sd">        qbb: 2.0, 2.0, 1.690909, 4.097333</span>
<span class="sd">        evb: -1.0, -1.0, -1.0, 0.0</span>
<span class="sd">        qkap: 1.0, 1.0, 1.0, 0.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WaDa</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">BoWa</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">EvB</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QBB</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QIB1</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QIB2</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QDB</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QKap</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">submodel</span><span class="p">:</span> <span class="n">soilinterfaces</span><span class="o">.</span><span class="n">SoilModel_V1</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">VERS</span><span class="p">,</span> <span class="n">WASSER</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">):</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># infiltration and percolation</span>
                <span class="n">submodel</span><span class="o">.</span><span class="n">set_initialsurfacewater</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">flu</span><span class="o">.</span><span class="n">wada</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="n">submodel</span><span class="o">.</span><span class="n">set_actualsurfacewater</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">flu</span><span class="o">.</span><span class="n">wada</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">qdb</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="n">submodel</span><span class="o">.</span><span class="n">set_soilwatersupply</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
                <span class="n">submodel</span><span class="o">.</span><span class="n">set_soilwaterdemand</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
                <span class="n">submodel</span><span class="o">.</span><span class="n">execute_infiltration</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="n">infiltration</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">submodel</span><span class="o">.</span><span class="n">get_infiltration</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">qdb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">wada</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">qdb</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">-</span> <span class="n">infiltration</span>
                <span class="n">qbb_soilmodel</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">submodel</span><span class="o">.</span><span class="n">get_percolation</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="c1"># capillary rise and negative evapotranspiration</span>
                <span class="n">supply</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">qkap</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">flu</span><span class="o">.</span><span class="n">evb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">supply</span> <span class="o">-=</span> <span class="n">flu</span><span class="o">.</span><span class="n">evb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">submodel</span><span class="o">.</span><span class="n">set_soilwatersupply</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">supply</span><span class="p">)</span>
                <span class="n">submodel</span><span class="o">.</span><span class="n">add_soilwater</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="n">addition</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">submodel</span><span class="o">.</span><span class="n">get_soilwateraddition</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">addition</span> <span class="o">&lt;</span> <span class="n">supply</span><span class="p">:</span>
                    <span class="n">factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">addition</span> <span class="o">/</span> <span class="n">supply</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">qkap</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*=</span> <span class="n">factor</span>
                    <span class="k">if</span> <span class="n">flu</span><span class="o">.</span><span class="n">evb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
                        <span class="n">flu</span><span class="o">.</span><span class="n">evb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*=</span> <span class="n">factor</span>
                <span class="c1"># LARSIM-type baseflow, interflow, and positive evaporation</span>
                <span class="n">demand</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">qbb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">qib1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">qib2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">flu</span><span class="o">.</span><span class="n">evb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">demand</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">evb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">submodel</span><span class="o">.</span><span class="n">set_soilwaterdemand</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">demand</span><span class="p">)</span>
                <span class="n">submodel</span><span class="o">.</span><span class="n">remove_soilwater</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="n">removal</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">submodel</span><span class="o">.</span><span class="n">get_soilwaterremoval</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">removal</span> <span class="o">&lt;</span> <span class="n">demand</span><span class="p">:</span>
                    <span class="n">factor</span> <span class="o">=</span> <span class="n">removal</span> <span class="o">/</span> <span class="n">demand</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">qbb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*=</span> <span class="n">factor</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">qib1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*=</span> <span class="n">factor</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">qib2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*=</span> <span class="n">factor</span>
                    <span class="k">if</span> <span class="n">flu</span><span class="o">.</span><span class="n">evb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                        <span class="n">flu</span><span class="o">.</span><span class="n">evb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*=</span> <span class="n">factor</span>
                <span class="c1"># sync soil moisture</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">submodel</span><span class="o">.</span><span class="n">get_soilwatercontent</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">qbb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">qbb_soilmodel</span></div>



<div class="viewcode-block" id="Calc_BoWa_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_BoWa_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_BoWa_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update the soil moisture.</span>

<span class="sd">    |Calc_BoWa_V1| serves as a switch method.  Its behaviour depends on whether the</span>
<span class="sd">    user activates a soil submodel following the |SoilModel_V1| interface or not.  If</span>
<span class="sd">    not, |Calc_BoWa_V1| applies |Calc_BoWa_Default_V1| to perform a &quot;simple&quot; soil</span>
<span class="sd">    moisture update.  If so, |Calc_BoWa_V1| uses |Calc_BoWa_SoilModel_V1| to include</span>
<span class="sd">    additional direct runoff and groundwater recharge components into the soil moisture</span>
<span class="sd">    update.  See the documentation of the mentioned submethods for more information.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMODELINTERFACES</span> <span class="o">=</span> <span class="p">(</span><span class="n">soilinterfaces</span><span class="o">.</span><span class="n">SoilModel_V1</span><span class="p">,)</span>
    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Calc_BoWa_Default_V1</span><span class="p">,</span> <span class="n">Calc_BoWa_SoilModel_V1</span><span class="p">)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">WMax</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">WaDa</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_states</span><span class="o">.</span><span class="n">BoWa</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">EvB</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QBB</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QIB1</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QIB2</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QDB</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QKap</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">soilmodel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">calc_bowa_default_v1</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">model</span><span class="o">.</span><span class="n">soilmodel_typeid</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">calc_bowa_soilmodel_v1</span><span class="p">(</span>
                <span class="n">cast</span><span class="p">(</span><span class="n">soilinterfaces</span><span class="o">.</span><span class="n">SoilModel_V1</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">soilmodel</span><span class="p">)</span>
            <span class="p">)</span></div>

        <span class="c1"># ToDo:</span>
        <span class="c1">#     else:</span>
        <span class="c1">#         assert_never(model.soilmodel)</span>


<div class="viewcode-block" id="Calc_QBGZ_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_QBGZ_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_QBGZ_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Aggregate the amount of base flow released by all &quot;soil type&quot; HRUs and the</span>
<span class="sd">    &quot;net precipitation&quot; above water areas of type |SEE|.</span>

<span class="sd">    Water areas of type |SEE| are assumed to be directly connected with groundwater,</span>
<span class="sd">    but not with the stream network.  This is modelled by adding their (positive or</span>
<span class="sd">    negative) &quot;net input&quot; (|NKor|-|EvI|) to the &quot;percolation output&quot; of the soil</span>
<span class="sd">    containing HRUs.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">       :math:`QBGZ = \Sigma \bigl( FHRU \cdot \bigl( QBB - Qkap \bigl) \bigl) +</span>
<span class="sd">       \Sigma \bigl (FHRU \cdot \bigl( NKor_{SEE} - EvI_{SEE} \bigl) \bigl)`</span>

<span class="sd">    Examples:</span>

<span class="sd">        The first example shows that |QBGZ| is the area weighted sum of |QBB| from</span>
<span class="sd">        &quot;soil type&quot; HRUs like arable land (|ACKER|) and of |NKor|-|EvI| from water</span>
<span class="sd">        areas of type |SEE|.  All other water areas (|WASSER| and |FLUSS|) and also</span>
<span class="sd">        sealed surfaces (|VERS|) have no impact on |QBGZ|:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(6)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER, ACKER, VERS, WASSER, FLUSS, SEE)</span>
<span class="sd">        &gt;&gt;&gt; fhru(0.1, 0.2, 0.1, 0.1, 0.1, 0.4)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qbb = 2., 4.0, 300.0, 300.0, 300.0, 300.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qkap = 1., 2.0, 150.0, 150.0, 150.0, 150.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.nkor = 200.0, 200.0, 200.0, 200.0, 200.0, 20.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evi = 100.0, 100.0, 100.0, 100.0, 100.0, 10.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qbgz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qbgz</span>
<span class="sd">        qbgz(4.5)</span>

<span class="sd">        The second example shows that large evaporation values above a HRU of type</span>
<span class="sd">        |SEE| can result in negative values of |QBGZ|:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.evi[5] = 30</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qbgz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qbgz</span>
<span class="sd">        qbgz(-3.5)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">FHRU</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NKor</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">EvI</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QBB</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QKap</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QBGZ</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">qbgz</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">SEE</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">qbgz</span> <span class="o">+=</span> <span class="n">con</span><span class="o">.</span><span class="n">fhru</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">nkor</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">evi</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="n">WASSER</span><span class="p">,</span> <span class="n">FLUSS</span><span class="p">,</span> <span class="n">VERS</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">qbgz</span> <span class="o">+=</span> <span class="n">con</span><span class="o">.</span><span class="n">fhru</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">qbb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">qkap</span><span class="p">[</span><span class="n">k</span><span class="p">])</span></div>



<div class="viewcode-block" id="Calc_QIGZ1_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_QIGZ1_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_QIGZ1_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Aggregate the amount of the first interflow component released by all HRUs.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">       :math:`QIGZ1 = \Sigma(FHRU \cdot QIB1)`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(2)</span>
<span class="sd">        &gt;&gt;&gt; fhru(0.75, 0.25)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qib1 = 1.0, 5.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qigz1_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qigz1</span>
<span class="sd">        qigz1(2.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">FHRU</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QIB1</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QIGZ1</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">qigz1</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">qigz1</span> <span class="o">+=</span> <span class="n">con</span><span class="o">.</span><span class="n">fhru</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">qib1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>



<div class="viewcode-block" id="Calc_QIGZ2_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_QIGZ2_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_QIGZ2_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Aggregate the amount of the second interflow component released by all HRUs.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">       :math:`QIGZ2 = \Sigma(FHRU \cdot QIB2)`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(2)</span>
<span class="sd">        &gt;&gt;&gt; fhru(0.75, 0.25)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qib2 = 1.0, 5.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qigz2_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qigz2</span>
<span class="sd">        qigz2(2.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">FHRU</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QIB2</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QIGZ2</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">qigz2</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">qigz2</span> <span class="o">+=</span> <span class="n">con</span><span class="o">.</span><span class="n">fhru</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">qib2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>



<div class="viewcode-block" id="Calc_QDGZ_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_QDGZ_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_QDGZ_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Aggregate the amount of total direct flow released by all HRUs.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">       :math:`QDGZ = \Sigma \bigl( FHRU \cdot QDB \bigl) +</span>
<span class="sd">       \Sigma \bigl (FHRU \cdot \bigl( NKor_{FLUSS} - EvI_{FLUSS} \bigl) \bigl)`</span>

<span class="sd">    Examples:</span>

<span class="sd">        The first example shows that |QDGZ| is the area weighted sum of |QDB| from</span>
<span class="sd">        &quot;land type&quot; HRUs like arable land (|ACKER|) and sealed surfaces (|VERS|) as</span>
<span class="sd">        well as of |NKor|-|EvI| from water areas of type |FLUSS|.  Water areas of type</span>
<span class="sd">        |WASSER| and |SEE| have no impact on |QDGZ|:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(5)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER, VERS, WASSER, SEE, FLUSS)</span>
<span class="sd">        &gt;&gt;&gt; fhru(0.1, 0.2, 0.1, 0.2, 0.4)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qdb = 2., 4.0, 300.0, 300.0, 300.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.nkor = 200.0, 200.0, 200.0, 200.0, 20.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evi = 100.0, 100.0, 100.0, 100.0, 10.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qdgz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qdgz</span>
<span class="sd">        qdgz(5.0)</span>

<span class="sd">        The second example shows that large evaporation values above a HRU of type</span>
<span class="sd">        |FLUSS| can result in negative values of |QDGZ|:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.evi[4] = 30</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qdgz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qdgz</span>
<span class="sd">        qdgz(-3.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">FHRU</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NKor</span><span class="p">,</span> <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">EvI</span><span class="p">,</span> <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QDB</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QDGZ</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">qdgz</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">FLUSS</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">qdgz</span> <span class="o">+=</span> <span class="n">con</span><span class="o">.</span><span class="n">fhru</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">nkor</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">evi</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="n">WASSER</span><span class="p">,</span> <span class="n">SEE</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">qdgz</span> <span class="o">+=</span> <span class="n">con</span><span class="o">.</span><span class="n">fhru</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">qdb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>



<div class="viewcode-block" id="Calc_QDGZ1_QDGZ2_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_QDGZ1_QDGZ2_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_QDGZ1_QDGZ2_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Separate total direct flow into a slower and a faster component.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">       :math:`QDGZ2 = \frac{(QDGZ - A2)^2}{QDGZ + A1 - A2}`</span>

<span class="sd">       :math:`QDGZ1 = QDGZ - QDGZ2`</span>

<span class="sd">    Examples:</span>

<span class="sd">        We borrowed the formula for calculating the amount of the faster component of</span>
<span class="sd">        direct flow from the well-known curve number approach.  Parameter |A2| would be</span>
<span class="sd">        the initial loss and parameter |A1| the maximum storage, but one should not</span>
<span class="sd">        take this analogy too literally.</span>

<span class="sd">        With the value of parameter |A1| set to zero, parameter |A2| defines the</span>
<span class="sd">        maximum amount of &quot;slow&quot; direct runoff per time step:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; a1(0.0)</span>

<span class="sd">        Let us set the value of |A2| to 4 mm/d, which is 2 mm/12h concerning the</span>
<span class="sd">        selected simulation step size:</span>

<span class="sd">        &gt;&gt;&gt; a2(4.0)</span>
<span class="sd">        &gt;&gt;&gt; a2</span>
<span class="sd">        a2(4.0)</span>
<span class="sd">        &gt;&gt;&gt; a2.value</span>
<span class="sd">        2.0</span>

<span class="sd">        Define a test function and let it calculate |QDGZ1| and |QDGZ1| for values of</span>
<span class="sd">        |QDGZ| ranging from -10 to 100 mm/12h:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import UnitTest</span>
<span class="sd">        &gt;&gt;&gt; test = UnitTest(model,</span>
<span class="sd">        ...                 model.calc_qdgz1_qdgz2_v1,</span>
<span class="sd">        ...                 last_example=6,</span>
<span class="sd">        ...                 parseqs=(fluxes.qdgz, fluxes.qdgz1, fluxes.qdgz2))</span>
<span class="sd">        &gt;&gt;&gt; test.nexts.qdgz = -10.0, 0.0, 1.0, 2.0, 3.0, 100.0</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. |  qdgz | qdgz1 | qdgz2 |</span>
<span class="sd">        -------------------------------</span>
<span class="sd">        |   1 | -10.0 | -10.0 |   0.0 |</span>
<span class="sd">        |   2 |   0.0 |   0.0 |   0.0 |</span>
<span class="sd">        |   3 |   1.0 |   1.0 |   0.0 |</span>
<span class="sd">        |   4 |   2.0 |   2.0 |   0.0 |</span>
<span class="sd">        |   5 |   3.0 |   2.0 |   1.0 |</span>
<span class="sd">        |   6 | 100.0 |   2.0 |  98.0 |</span>

<span class="sd">        Setting |A2| to zero and |A1| to 4 mm/d (or 2 mm/12h) results in a smoother</span>
<span class="sd">        transition:</span>

<span class="sd">        &gt;&gt;&gt; a2(0.0)</span>
<span class="sd">        &gt;&gt;&gt; a1(4.0)</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. |  qdgz |    qdgz1 |     qdgz2 |</span>
<span class="sd">        --------------------------------------</span>
<span class="sd">        |   1 | -10.0 |    -10.0 |       0.0 |</span>
<span class="sd">        |   2 |   0.0 |      0.0 |       0.0 |</span>
<span class="sd">        |   3 |   1.0 | 0.666667 |  0.333333 |</span>
<span class="sd">        |   4 |   2.0 |      1.0 |       1.0 |</span>
<span class="sd">        |   5 |   3.0 |      1.2 |       1.8 |</span>
<span class="sd">        |   6 | 100.0 | 1.960784 | 98.039216 |</span>

<span class="sd">        Alternatively, one can mix these two configurations by setting the values of</span>
<span class="sd">        both parameters to 2 mm/h:</span>

<span class="sd">        &gt;&gt;&gt; a2(2.0)</span>
<span class="sd">        &gt;&gt;&gt; a1(2.0)</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. |  qdgz |    qdgz1 |    qdgz2 |</span>
<span class="sd">        -------------------------------------</span>
<span class="sd">        |   1 | -10.0 |    -10.0 |      0.0 |</span>
<span class="sd">        |   2 |   0.0 |      0.0 |      0.0 |</span>
<span class="sd">        |   3 |   1.0 |      1.0 |      0.0 |</span>
<span class="sd">        |   4 |   2.0 |      1.5 |      0.5 |</span>
<span class="sd">        |   5 |   3.0 | 1.666667 | 1.333333 |</span>
<span class="sd">        |   6 | 100.0 |     1.99 |    98.01 |</span>

<span class="sd">        Note the similarity of the results for very high values of total direct flow</span>
<span class="sd">        |QDGZ| in all three examples, which converge to the sum of the values of</span>
<span class="sd">        parameter |A1| and |A2|, representing the maximum value of `slow` direct flow</span>
<span class="sd">        generation per simulation step</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">A2</span><span class="p">,</span> <span class="n">lland_control</span><span class="o">.</span><span class="n">A1</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QDGZ</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QDGZ2</span><span class="p">,</span> <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QDGZ1</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">if</span> <span class="n">flu</span><span class="o">.</span><span class="n">qdgz</span> <span class="o">&gt;</span> <span class="n">con</span><span class="o">.</span><span class="n">a2</span><span class="p">:</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">qdgz2</span> <span class="o">=</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">qdgz</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">a2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">qdgz</span> <span class="o">+</span> <span class="n">con</span><span class="o">.</span><span class="n">a1</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">a2</span><span class="p">)</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">qdgz1</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">qdgz</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">qdgz2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">qdgz2</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">qdgz1</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">qdgz</span></div>



<div class="viewcode-block" id="Return_SG_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Return_SG_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Return_SG_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Return the new storage value after applying the analytical solution for the</span>
<span class="sd">    linear storage differential equation under the assumption of constant inflow.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">       :math:`k \cdot qz - (k \cdot qz - s) \cdot exp(-1 / k)`</span>

<span class="sd">    Examples:</span>

<span class="sd">        The first &quot;normal&quot; test relies on the given basic equation:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_sg_v1(3.0, 1.0, 2.0, 1.0))</span>
<span class="sd">        2.417343</span>

<span class="sd">        Zero concentration time does not result in zero division errors:</span>

<span class="sd">        &gt;&gt;&gt; round_(model.return_sg_v1(0.0, 1.0, 2.0, 1.0))</span>
<span class="sd">        0.0</span>

<span class="sd">        Also, it is safe to apply infinite concentration time:</span>

<span class="sd">        &gt;&gt;&gt; round_(model.return_sg_v1(inf, 1.0, 2.0, 1.0))</span>
<span class="sd">        3.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">qz</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span>
        <span class="k">if</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">s</span> <span class="o">+</span> <span class="n">qz</span>
        <span class="k">return</span> <span class="n">k</span> <span class="o">*</span> <span class="n">qz</span> <span class="o">-</span> <span class="p">(</span><span class="n">k</span> <span class="o">*</span> <span class="n">qz</span> <span class="o">-</span> <span class="n">s</span><span class="p">)</span> <span class="o">*</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">dt</span> <span class="o">/</span> <span class="n">k</span><span class="p">)</span></div>



<div class="viewcode-block" id="Calc_QBGA_SBG_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_QBGA_SBG_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_QBGA_SBG_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Update the base flow storage and calculate its outflow.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">       :math:`SBG = Return\_SG\_V1(KB, SBG, QBGZ)`</span>

<span class="sd">       :math:`QBGA = SBG_{old} - SBG_{new} + QBGZ`</span>

<span class="sd">    Example:</span>

<span class="sd">        Method |Calc_QBGA_SBG_V1| relies on the analytical solution of the linear</span>
<span class="sd">        storage equation implemented by method |Return_SG_V1|, from which we take the</span>
<span class="sd">        following test configuration:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; derived.kb(3.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sbg.old = 1.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qbgz = 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qbga_sbg_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.sbg</span>
<span class="sd">        sbg(2.417343)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qbga</span>
<span class="sd">        qbga(0.582657)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Return_SG_V1</span><span class="p">,)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">KB</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QBGZ</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">SBG</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QBGA</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">old</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess_old</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess_new</span>
        <span class="n">new</span><span class="o">.</span><span class="n">sbg</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_sg_v1</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">kb</span><span class="p">,</span> <span class="n">old</span><span class="o">.</span><span class="n">sbg</span><span class="p">,</span> <span class="n">flu</span><span class="o">.</span><span class="n">qbgz</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">qbga</span> <span class="o">=</span> <span class="n">old</span><span class="o">.</span><span class="n">sbg</span> <span class="o">-</span> <span class="n">new</span><span class="o">.</span><span class="n">sbg</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">qbgz</span></div>



<div class="viewcode-block" id="Calc_QBGA_SBG_QBGZ_QDGZ_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_QBGA_SBG_QBGZ_QDGZ_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_QBGA_SBG_QBGZ_QDGZ_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Update the base flow storage and calculate its outflow, taking possible</span>
<span class="sd">    &quot;groundwater restrictions&quot; into account.</span>

<span class="sd">    .. _`issue 87`: https://github.com/hydpy-dev/hydpy/issues/87</span>

<span class="sd">    Without active restrictions, method |Calc_QBGA_SBG_QBGZ_QDGZ_V1| works like</span>
<span class="sd">    |Calc_QBGA_SBG_V1|.  There are two restrictions, one being volume- and the other</span>
<span class="sd">    one rise-related.</span>

<span class="sd">    In the &quot;volume-related&quot; case, |Calc_QBGA_SBG_QBGZ_QDGZ_V1| redirects groundwater</span>
<span class="sd">    recharge to the direct flow components as soon as the groundwater amount reaches</span>
<span class="sd">    its limit (the available aquifer volume), defined by the parameters |VolBMax| and</span>
<span class="sd">    |GSBMax|.</span>

<span class="sd">    The &quot;rise-related&quot; restriction redirects water in the same direction but reacts to</span>
<span class="sd">    a too fast rise of the groundwater table instead of a too high groundwater amount.</span>
<span class="sd">    It is a linear interpolation approach, with parameter |GSBGrad1| representing the</span>
<span class="sd">    highest possible rise without any reduction of the groundwater inflow and</span>
<span class="sd">    |GSBGrad2| representing the rise where groundwater recharge would become zero.</span>

<span class="sd">    Conceptually, both restrictions follow :cite:t:`ref-LARSIM` but their</span>
<span class="sd">    implementations differ in a way that may lead to relevant differences in the</span>
<span class="sd">    results.</span>

<span class="sd">    The implementation of |Calc_QBGA_SBG_QBGZ_QDGZ_V1| is quite complex due to a huge</span>
<span class="sd">    of edge cases requiring special handling.  See issue `issue 87`_ for a detailed</span>
<span class="sd">    discussion of its development and the underlying math (there, you can also report</span>
<span class="sd">    edge cases we might not handle well so far).  Here, we give only the basic</span>
<span class="sd">    ordinary differential equation solved by |Calc_QBGA_SBG_QBGZ_QDGZ_V1|.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      .. math::</span>
<span class="sd">        SBG&#39;(t) = \begin{cases}</span>
<span class="sd">            0</span>
<span class="sd">            &amp;|\</span>
<span class="sd">            SBG(t) = GSBMax \cdot VolBMax \ \land \  SBG&#39;(t) &gt; 0</span>
<span class="sd">        \\[5pt]</span>
<span class="sd">            QBGZ - \frac{SBG(t)}{KB}</span>
<span class="sd">            &amp;|\</span>
<span class="sd">            (SBG(t) &lt; GSBMax \cdot VolBMax \ \lor \ SBG&#39;(t) \leq 0)</span>
<span class="sd">            \ \land \ SBG&#39;(t) \leq GSBGrad1</span>
<span class="sd">        \\[5pt]</span>
<span class="sd">            \frac{GSBGrad2-SBG&#39;(t)}{GSBGrad2-GSBGrad1} \cdot QBGZ - \frac{SBG(t)}{KB}</span>
<span class="sd">            &amp;|\</span>
<span class="sd">            (SBG(t) &lt; GSBMax \cdot VolBMax \ \lor \ SBG&#39;(t) \leq 0)</span>
<span class="sd">            \ \land\  SBG&#39;(t) &gt; GSBGrad1</span>
<span class="sd">        \end{cases}</span>

<span class="sd">        Examples:</span>

<span class="sd">            To give some context, we start our explanations based on method</span>
<span class="sd">            |Calc_QBGA_SBG_V1|:</span>

<span class="sd">            &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">            &gt;&gt;&gt; simulationstep(&quot;1d&quot;)</span>
<span class="sd">            &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">            &gt;&gt;&gt; derived.kb(10.0)</span>
<span class="sd">            &gt;&gt;&gt; states.sbg.old = 5.0</span>
<span class="sd">            &gt;&gt;&gt; fluxes.qbgz = 2.0</span>
<span class="sd">            &gt;&gt;&gt; model.calc_qbga_sbg_v1()</span>
<span class="sd">            &gt;&gt;&gt; states.sbg</span>
<span class="sd">            sbg(6.427439)</span>
<span class="sd">            &gt;&gt;&gt; fluxes.qbga</span>
<span class="sd">            qbga(0.572561)</span>

<span class="sd">            The content of the storage for base flow (groundwater amount) increases</span>
<span class="sd">            from 5 mm to about 6.43 mm.</span>

<span class="sd">            At the beginning of the interval, the increase of the content of the base</span>
<span class="sd">            flow storage (groundwater rise) is 1.5 mm/d:</span>

<span class="sd">            &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">            &gt;&gt;&gt; round_(fluxes.qbgz - states.sbg.old / derived.kb)</span>
<span class="sd">            1.5</span>

<span class="sd">            With increasing groundwater amount during the interval, base flow also</span>
<span class="sd">            increases, dampening the groundwater rise.  Hence, it is only about 1.36 at</span>
<span class="sd">            the end of the interval:</span>

<span class="sd">            &gt;&gt;&gt; round_(fluxes.qbgz - states.sbg.new / derived.kb)</span>
<span class="sd">            1.357256</span>

<span class="sd">            Capturing all branches of |Calc_QBGA_SBG_QBGZ_QDGZ_V1| requires extensive</span>
<span class="sd">            testing.  Therefore, we define function `check`, which compares the given</span>
<span class="sd">            analytical solution with a numerical approximation of the original ODE and</span>
<span class="sd">            performs some balance-related tests (`sm` stands for the maximum</span>
<span class="sd">            groundwater amount and `g1` and `g2` for |GSBGrad1| and |GSBGrad2|):</span>

<span class="sd">            &gt;&gt;&gt; from numpy import exp</span>
<span class="sd">            &gt;&gt;&gt; from scipy.integrate import ode</span>
<span class="sd">            &gt;&gt;&gt; def check(sm, g1, g2):</span>
<span class="sd">            ...     # update the parameters:</span>
<span class="sd">            ...     volbmax(sm)</span>
<span class="sd">            ...     gsbgrad1.value = g1</span>
<span class="sd">            ...     gsbgrad2.value = g2</span>
<span class="sd">            ...     # reset the fluxes (eventually changed by previous calls):</span>
<span class="sd">            ...     fluxes.qbgz = 2.0</span>
<span class="sd">            ...     fluxes.qdgz = 1.0</span>
<span class="sd">            ...     # apply a numerical solver:</span>
<span class="sd">            ...     integrator = ode(f_ode)</span>
<span class="sd">            ...     _ = integrator.set_integrator(&quot;zvode&quot;, method=&quot;bdf&quot;, rtol=1e-10)</span>
<span class="sd">            ...     _ = integrator.set_initial_value([min(states.sbg.old, sm), 0.0])</span>
<span class="sd">            ...     sbg_est, qbga_est = integrator.integrate(1.0).real</span>
<span class="sd">            ...     qbga_est += max(states.sbg.old - sm, 0.0)</span>
<span class="sd">            ...     # calculate the analytical solution:</span>
<span class="sd">            ...     model.calc_qbga_sbg_qbgz_qdgz_v1()</span>
<span class="sd">            ...     # compare the analytical with the numerical solution:</span>
<span class="sd">            ...     assert round(states.sbg.new, 6) == round(sbg_est, 6)</span>
<span class="sd">            ...     assert round(fluxes.qbga, 6) == round(qbga_est, 6)</span>
<span class="sd">            ...     # check water balances:</span>
<span class="sd">            ...     assert states.sbg.new == states.sbg.old + fluxes.qbgz - fluxes.qbga</span>
<span class="sd">            ...     assert 2.0 + 1.0 == fluxes.qbgz + fluxes.qdgz</span>
<span class="sd">            ...     # print the resulting values of all modified sequences:</span>
<span class="sd">            ...     print(states.sbg, fluxes.qbga, fluxes.qbgz, fluxes.qdgz, sep=&quot;, &quot;)</span>

<span class="sd">            Function `check` requires a function that implements the given ODE.  We</span>
<span class="sd">            define function `f_ode` for this purpose, which needs lot of special</span>
<span class="sd">            casing.  It returns the current groundwater change (inflow minus outflow)</span>
<span class="sd">            and the outflow itself. Note that handling :math:`k = \infty` is highly ad</span>
<span class="sd">            hoc and only thought to work for the following tests:</span>

<span class="sd">            &gt;&gt;&gt; def f_ode(t, x):</span>
<span class="sd">            ...     k = derived.kb.value</span>
<span class="sd">            ...     z = fluxes.qbgz.value</span>
<span class="sd">            ...     sm = control.gsbmax.value * control.volbmax.value</span>
<span class="sd">            ...     g1 = control.gsbgrad1.value</span>
<span class="sd">            ...     g2 = control.gsbgrad2.value</span>
<span class="sd">            ...     s = x[0]</span>
<span class="sd">            ...     if s &lt;= 0.0:</span>
<span class="sd">            ...         ds = 0.0</span>
<span class="sd">            ...     elif s &gt;= sm:</span>
<span class="sd">            ...         ds = 0.0</span>
<span class="sd">            ...     elif k == 0.0:</span>
<span class="sd">            ...         ds = -5e3</span>
<span class="sd">            ...     elif z - s / k &lt;= g1:</span>
<span class="sd">            ...         ds = z - s / k</span>
<span class="sd">            ...     elif g1 == g2:</span>
<span class="sd">            ...         ds = g1</span>
<span class="sd">            ...     elif numpy.isinf(k):</span>
<span class="sd">            ...         ds = g2 / ((g2 - g1) / z + 1.0)</span>
<span class="sd">            ...     else:</span>
<span class="sd">            ...         ds = (g2 * (s - k * z) - g1 * s) / (k * (g1 - g2 - z))</span>
<span class="sd">            ...     if s &lt;= 0.0:</span>
<span class="sd">            ...         return [[ds, 0.0]]</span>
<span class="sd">            ...     elif k == 0.0:</span>
<span class="sd">            ...         return [[ds, 7e3]]</span>
<span class="sd">            ...     return [[ds, s / k]]</span>

<span class="sd">            We start by demonstrating pure volume-related restrictions.  Therefore, we</span>
<span class="sd">            set |GSBMax| to one so that values for `sm` correspond to the highest</span>
<span class="sd">            possible groundwater amount:</span>

<span class="sd">            &gt;&gt;&gt; gsbmax(1.0)</span>

<span class="sd">            If `sm` is higher than the final groundwater amount, applying</span>
<span class="sd">            |Calc_QBGA_SBG_QBGZ_QDGZ_V1| leads to the same results as</span>
<span class="sd">            |Calc_QBGA_SBG_V1|:</span>

<span class="sd">            &gt;&gt;&gt; check(sm=10.0, g1=1.5, g2=2.0)</span>
<span class="sd">            sbg(6.427439), qbga(0.572561), qbgz(2.0), qdgz(1.0)</span>

<span class="sd">            An active volume-related restriction decreases the groundwater inflow</span>
<span class="sd">            (which reduces base flow) and increases the amount of direct runoff:</span>

<span class="sd">            &gt;&gt;&gt; check(sm=6.0, g1=1.5, g2=2.0)</span>
<span class="sd">            sbg(6.0), qbga(0.5659), qbgz(1.5659), qdgz(1.4341)</span>

<span class="sd">            Starting with an already activated volume-related restriction works as</span>
<span class="sd">            expected:</span>

<span class="sd">            &gt;&gt;&gt; check(sm=5.0, g1=1.5, g2=2.0)</span>
<span class="sd">            sbg(5.0), qbga(0.5), qbgz(0.5), qdgz(2.5)</span>

<span class="sd">            |Calc_QBGA_SBG_QBGZ_QDGZ_V1| handles possible initial violations of</span>
<span class="sd">            volume-related restrictions by adding the excess to base flow:</span>

<span class="sd">            &gt;&gt;&gt; check(sm=4.0, g1=1.5, g2=2.0)</span>
<span class="sd">            sbg(4.0), qbga(1.4), qbgz(0.4), qdgz(2.6)</span>

<span class="sd">            Setting |KB| to |numpy.inf| works (in case someone will ever need it):</span>

<span class="sd">            &gt;&gt;&gt; derived.kb(inf)</span>
<span class="sd">            &gt;&gt;&gt; check(sm=10.0, g1=inf, g2=inf)</span>
<span class="sd">            sbg(7.0), qbga(0.0), qbgz(2.0), qdgz(1.0)</span>
<span class="sd">            &gt;&gt;&gt; check(sm=6.0, g1=inf, g2=inf)</span>
<span class="sd">            sbg(6.0), qbga(0.0), qbgz(1.0), qdgz(2.0)</span>
<span class="sd">            &gt;&gt;&gt; check(sm=5.0, g1=inf, g2=inf)</span>
<span class="sd">            sbg(5.0), qbga(0.0), qbgz(0.0), qdgz(3.0)</span>
<span class="sd">            &gt;&gt;&gt; check(sm=4.0, g1=inf, g2=inf)</span>
<span class="sd">            sbg(4.0), qbga(1.0), qbgz(0.0), qdgz(3.0)</span>

<span class="sd">            Next, we demonstrate pure rise-related restrictions.</span>

<span class="sd">            If |GSBGrad1| (and subsequently |GSBGrad2|) is not smaller than the initial</span>
<span class="sd">            groundwater rise, |Calc_QBGA_SBG_QBGZ_QDGZ_V1| calculates the same results</span>
<span class="sd">            as |Calc_QBGA_SBG_V1|:</span>

<span class="sd">            &gt;&gt;&gt; derived.kb(10.0)</span>
<span class="sd">            &gt;&gt;&gt; check(sm=10.0, g1=1.5, g2=2.0)</span>
<span class="sd">            sbg(6.427439), qbga(0.572561), qbgz(2.0), qdgz(1.0)</span>
<span class="sd">            &gt;&gt;&gt; check(sm=inf, g1=1.5, g2=2.0)</span>
<span class="sd">            sbg(6.427439), qbga(0.572561), qbgz(2.0), qdgz(1.0)</span>

<span class="sd">            The following examples deal with a situation where (only) |GSBGrad1| is</span>
<span class="sd">            smaller than the groundwater rise at the interval&#39;s start and end time:</span>

<span class="sd">            &gt;&gt;&gt; check(sm=10.0, g1=1.0, g2=2.0)</span>
<span class="sd">            sbg(6.147436), qbga(0.557691), qbgz(1.705127), qdgz(1.294873)</span>
<span class="sd">            &gt;&gt;&gt; check(sm=inf, g1=1.0, g2=2.0)</span>
<span class="sd">            sbg(6.147436), qbga(0.557691), qbgz(1.705127), qdgz(1.294873)</span>
<span class="sd">            &gt;&gt;&gt; check(sm=5.0, g1=1.0, g2=2.0)</span>
<span class="sd">            sbg(5.0), qbga(0.5), qbgz(0.5), qdgz(2.5)</span>
<span class="sd">            &gt;&gt;&gt; check(sm=4.0, g1=1.0, g2=2.0)</span>
<span class="sd">            sbg(4.0), qbga(1.4), qbgz(0.4), qdgz(2.6)</span>

<span class="sd">            Now, both |GSBGrad1| and |GSBGrad2| are smaller than the groundwater rise</span>
<span class="sd">            at the interval&#39;s start and end time:</span>

<span class="sd">            &gt;&gt;&gt; check(sm=10.0, g1=0.5, g2=1.0)</span>
<span class="sd">            sbg(5.693046), qbga(0.534768), qbgz(1.227814), qdgz(1.772186)</span>
<span class="sd">            &gt;&gt;&gt; check(sm=inf, g1=0.5, g2=1.0)</span>
<span class="sd">            sbg(5.693046), qbga(0.534768), qbgz(1.227814), qdgz(1.772186)</span>
<span class="sd">            &gt;&gt;&gt; check(sm=5.0, g1=0.5, g2=1.0)</span>
<span class="sd">            sbg(5.0), qbga(0.5), qbgz(0.5), qdgz(2.5)</span>
<span class="sd">            &gt;&gt;&gt; check(sm=4.0, g1=0.5, g2=1.0)</span>
<span class="sd">            sbg(4.0), qbga(1.4), qbgz(0.4), qdgz(2.6)</span>

<span class="sd">            It is acceptable to set |GSBGrad1| to zero:</span>

<span class="sd">            &gt;&gt;&gt; check(sm=10.0, g1=0.0, g2=1.0)</span>
<span class="sd">            sbg(5.491758), qbga(0.524725), qbgz(1.016483), qdgz(1.983517)</span>
<span class="sd">            &gt;&gt;&gt; derived.kb(0.0)</span>
<span class="sd">            &gt;&gt;&gt; check(sm=10.0, g1=0.0, g2=0.0)</span>
<span class="sd">            sbg(0.0), qbga(7.0), qbgz(2.0), qdgz(1.0)</span>

<span class="sd">            The same holds for setting both |GSBGrad1| and |GSBGrad2| to zero:</span>

<span class="sd">            &gt;&gt;&gt; derived.kb(10.0)</span>
<span class="sd">            &gt;&gt;&gt; check(sm=10.0, g1=0.0, g2=0.0)</span>
<span class="sd">            sbg(5.0), qbga(0.5), qbgz(0.5), qdgz(2.5)</span>

<span class="sd">            Also, it is okay to set |GSBGrad1| and |GSBGrad2| to the same non-zero</span>
<span class="sd">            value:</span>

<span class="sd">            &gt;&gt;&gt; check(sm=10.0, g1=1.0, g2=1.0)</span>
<span class="sd">            sbg(6.0), qbga(0.55), qbgz(1.55), qdgz(1.45)</span>
<span class="sd">            &gt;&gt;&gt; check(sm=10.0, g1=1.4, g2=1.4)</span>
<span class="sd">            sbg(6.39434), qbga(0.569946), qbgz(1.964286), qdgz(1.035714)</span>

<span class="sd">            As for the volume-related case, one can apply rise-related restrictions</span>
<span class="sd">            when the value of |KB| is |numpy.inf|:</span>

<span class="sd">            &gt;&gt;&gt; derived.kb(inf)</span>
<span class="sd">            &gt;&gt;&gt; check(sm=10.0, g1=0.0, g2=0.0)</span>
<span class="sd">            sbg(5.0), qbga(0.0), qbgz(0.0), qdgz(3.0)</span>
<span class="sd">            &gt;&gt;&gt; check(sm=10.0, g1=1.0, g2=1.0)</span>
<span class="sd">            sbg(6.0), qbga(0.0), qbgz(1.0), qdgz(2.0)</span>
<span class="sd">            &gt;&gt;&gt; check(sm=10.0, g1=0.0, g2=2.0)</span>
<span class="sd">            sbg(6.0), qbga(0.0), qbgz(1.0), qdgz(2.0)</span>
<span class="sd">            &gt;&gt;&gt; check(sm=10.0, g1=1.0, g2=2.0)</span>
<span class="sd">            sbg(6.333333), qbga(0.0), qbgz(1.333333), qdgz(1.666667)</span>

<span class="sd">            Finally, we demonstrate combinations of volume- and rise-related</span>
<span class="sd">            restrictions.</span>

<span class="sd">            In the first combinational example, the rise-related restriction is active</span>
<span class="sd">            right from the start.  After a while, the groundwater amount reaches its</span>
<span class="sd">            highest possible value (5.8 mm).  From then on, the groundwater table is</span>
<span class="sd">            not allowed to rise anymore, which deactivates the rise-related</span>
<span class="sd">            restriction:</span>

<span class="sd">            &gt;&gt;&gt; derived.kb(10.0)</span>
<span class="sd">            &gt;&gt;&gt; check(sm=5.8, g1=1.4, g2=1.4)</span>
<span class="sd">            sbg(5.8), qbga(0.557143), qbgz(1.357143), qdgz(1.642857)</span>

<span class="sd">            The second combinational example is even more complex.  The groundwater</span>
<span class="sd">            rise slows down until it does not exceed `g1` anymore.  Then, no</span>
<span class="sd">            restriction is active anymore, and the evolution of |SGD| follows the</span>
<span class="sd">            simple linear storage model.  However, this happens only for a short while</span>
<span class="sd">            due to |SGD| reaching `sm` soon afterwards:</span>

<span class="sd">            &gt;&gt;&gt; check(sm=6.2, g1=1.4, g2=1.4)</span>
<span class="sd">            sbg(6.2), qbga(0.568565), qbgz(1.768565), qdgz(1.231435)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">VolBMax</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">GSBMax</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">GSBGrad1</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">GSBGrad2</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">KB</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">SBG</span><span class="p">,</span> <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QDGZ</span><span class="p">,</span> <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QBGZ</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QBGA</span><span class="p">,)</span>
    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Calc_QBGA_SBG_V1</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># pylint: disable=too-many-branches</span>
        <span class="c1"># (I know this method is much too complex but I do not see a good way to</span>
        <span class="c1"># refactor it)</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">old</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess_old</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess_new</span>
        <span class="n">k</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">kb</span>
        <span class="n">sm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">gsbmax</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">volbmax</span>
        <span class="n">g1</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">gsbgrad1</span>
        <span class="n">g2</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">gsbgrad2</span>
        <span class="n">s0</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">old</span><span class="o">.</span><span class="n">sbg</span>
        <span class="n">z</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">qbgz</span>
        <span class="k">if</span> <span class="n">s0</span> <span class="o">&gt;</span> <span class="n">sm</span><span class="p">:</span>
            <span class="n">excess</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">s0</span> <span class="o">-</span> <span class="n">sm</span>
            <span class="n">s0</span> <span class="o">=</span> <span class="n">sm</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">excess</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">new</span><span class="o">.</span><span class="n">sbg</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">qbga</span> <span class="o">=</span> <span class="n">s0</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">qbgz</span>
        <span class="k">elif</span> <span class="n">z</span> <span class="o">-</span> <span class="n">s0</span> <span class="o">/</span> <span class="n">k</span> <span class="o">&lt;=</span> <span class="n">g1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
                <span class="n">new</span><span class="o">.</span><span class="n">sbg</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">s0</span> <span class="o">+</span> <span class="n">z</span><span class="p">,</span> <span class="n">sm</span><span class="p">)</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">qbga</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">sm</span><span class="p">):</span>
                    <span class="n">t</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">fraction</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="p">(</span><span class="n">k</span> <span class="o">*</span> <span class="n">z</span> <span class="o">-</span> <span class="n">sm</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">k</span> <span class="o">*</span> <span class="n">z</span> <span class="o">-</span> <span class="n">s0</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">fraction</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                        <span class="n">t</span> <span class="o">=</span> <span class="o">-</span><span class="n">k</span> <span class="o">*</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">fraction</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">t</span> <span class="o">=</span> <span class="mf">1.0</span>
                <span class="k">if</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
                    <span class="n">new</span><span class="o">.</span><span class="n">sbg</span> <span class="o">=</span> <span class="n">sm</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">qbga</span> <span class="o">=</span> <span class="n">s0</span> <span class="o">-</span> <span class="n">sm</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">qbgz</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">qbga</span> <span class="o">+=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="n">sm</span> <span class="o">/</span> <span class="n">k</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">new</span><span class="o">.</span><span class="n">sbg</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_sg_v1</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">s0</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">qbga</span> <span class="o">=</span> <span class="n">s0</span> <span class="o">-</span> <span class="n">new</span><span class="o">.</span><span class="n">sbg</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">qbgz</span>
        <span class="k">elif</span> <span class="n">g2</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">qbga</span> <span class="o">=</span> <span class="n">s0</span> <span class="o">/</span> <span class="n">k</span>
            <span class="n">new</span><span class="o">.</span><span class="n">sbg</span> <span class="o">=</span> <span class="n">s0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">g2</span> <span class="o">&gt;</span> <span class="n">g1</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">qbga</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">new</span><span class="o">.</span><span class="n">sbg</span> <span class="o">=</span> <span class="n">s0</span> <span class="o">+</span> <span class="n">g2</span> <span class="o">/</span> <span class="p">((</span><span class="n">g2</span> <span class="o">-</span> <span class="n">g1</span><span class="p">)</span> <span class="o">/</span> <span class="n">z</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">st</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">k</span> <span class="o">*</span> <span class="p">(</span><span class="n">z</span> <span class="o">-</span> <span class="n">g1</span><span class="p">),</span> <span class="n">sm</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">g1</span> <span class="o">==</span> <span class="n">g2</span><span class="p">:</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="nb">min</span><span class="p">((</span><span class="n">st</span> <span class="o">-</span> <span class="n">s0</span><span class="p">)</span> <span class="o">/</span> <span class="n">g1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">qbga</span> <span class="o">=</span> <span class="n">t</span> <span class="o">*</span> <span class="p">(</span><span class="n">g1</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">s0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">k</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">c1</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="p">(</span><span class="n">g2</span> <span class="o">-</span> <span class="n">g1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">g1</span> <span class="o">-</span> <span class="n">g2</span> <span class="o">-</span> <span class="n">z</span><span class="p">)</span>
                    <span class="n">c2</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="p">(</span><span class="n">g2</span> <span class="o">*</span> <span class="n">k</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">g1</span> <span class="o">-</span> <span class="n">g2</span><span class="p">)</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">k</span> <span class="o">/</span> <span class="n">c1</span> <span class="o">*</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">log</span><span class="p">((</span><span class="n">st</span> <span class="o">+</span> <span class="n">c2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">s0</span> <span class="o">+</span> <span class="n">c2</span><span class="p">)),</span> <span class="mf">1.0</span><span class="p">)</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">qbga</span> <span class="o">=</span> <span class="p">(</span><span class="n">s0</span> <span class="o">+</span> <span class="n">c2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
                        <span class="n">modelutils</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">c1</span> <span class="o">*</span> <span class="n">t</span> <span class="o">/</span> <span class="n">k</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.0</span>
                    <span class="p">)</span> <span class="o">/</span> <span class="n">c1</span> <span class="o">-</span> <span class="n">c2</span> <span class="o">*</span> <span class="n">t</span> <span class="o">/</span> <span class="n">k</span>
                <span class="k">if</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">st</span> <span class="o">==</span> <span class="n">sm</span><span class="p">:</span>
                        <span class="n">new</span><span class="o">.</span><span class="n">sbg</span> <span class="o">=</span> <span class="n">sm</span>
                        <span class="n">flu</span><span class="o">.</span><span class="n">qbga</span> <span class="o">+=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="n">sm</span> <span class="o">/</span> <span class="n">k</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">fraction</span> <span class="o">=</span> <span class="p">(</span><span class="n">k</span> <span class="o">*</span> <span class="n">z</span> <span class="o">-</span> <span class="n">sm</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">k</span> <span class="o">*</span> <span class="n">z</span> <span class="o">-</span> <span class="n">st</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">fraction</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                            <span class="n">tt</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="n">k</span> <span class="o">*</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">fraction</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">tt</span> <span class="o">=</span> <span class="mf">1.0</span>
                        <span class="k">if</span> <span class="n">t</span> <span class="o">+</span> <span class="n">tt</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
                            <span class="n">new</span><span class="o">.</span><span class="n">sbg</span> <span class="o">=</span> <span class="n">sm</span>
                            <span class="n">flu</span><span class="o">.</span><span class="n">qbga</span> <span class="o">+=</span> <span class="n">st</span> <span class="o">-</span> <span class="n">sm</span> <span class="o">+</span> <span class="n">tt</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">qbgz</span>
                            <span class="n">flu</span><span class="o">.</span><span class="n">qbga</span> <span class="o">+=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">t</span> <span class="o">-</span> <span class="n">tt</span><span class="p">)</span> <span class="o">*</span> <span class="n">sm</span> <span class="o">/</span> <span class="n">k</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">new</span><span class="o">.</span><span class="n">sbg</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_sg_v1</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">st</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">t</span><span class="p">)</span>
                            <span class="n">flu</span><span class="o">.</span><span class="n">qbga</span> <span class="o">+=</span> <span class="n">st</span> <span class="o">-</span> <span class="n">new</span><span class="o">.</span><span class="n">sbg</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">qbgz</span>
                <span class="k">elif</span> <span class="n">g1</span> <span class="o">==</span> <span class="n">g2</span><span class="p">:</span>
                    <span class="n">new</span><span class="o">.</span><span class="n">sbg</span> <span class="o">=</span> <span class="n">s0</span> <span class="o">+</span> <span class="n">g1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">new</span><span class="o">.</span><span class="n">sbg</span> <span class="o">=</span> <span class="p">(</span><span class="n">s0</span> <span class="o">+</span> <span class="n">c2</span><span class="p">)</span> <span class="o">*</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">k</span> <span class="o">*</span> <span class="n">c1</span><span class="p">)</span> <span class="o">-</span> <span class="n">c2</span>
        <span class="n">qbgz</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">qbgz</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">qbgz</span> <span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">sbg</span> <span class="o">-</span> <span class="n">s0</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">qbga</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">qdgz</span> <span class="o">+=</span> <span class="n">qbgz</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">qbgz</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">qbga</span> <span class="o">+=</span> <span class="n">excess</span></div>



<div class="viewcode-block" id="Calc_QIGA1_SIG1_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_QIGA1_SIG1_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_QIGA1_SIG1_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Update the storage of the first interflow component and calculate its outflow.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">       :math:`SIG1 = Return\_SG\_V1(KI1, SIG1, QIGZ1)`</span>

<span class="sd">       :math:`QIGA1 = SIG1_{old} - SIG1_{new} + QIGZ1`</span>

<span class="sd">    Example:</span>

<span class="sd">        Method |Calc_QIGA1_SIG1_V1| relies on the analytical solution of the linear</span>
<span class="sd">        storage equation implemented by method |Return_SG_V1|, from which we take the</span>
<span class="sd">        following test configuration:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; derived.ki1(3.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sig1.old = 1.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qigz1 = 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qiga1_sig1_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.sig1</span>
<span class="sd">        sig1(2.417343)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qiga1</span>
<span class="sd">        qiga1(0.582657)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">KI1</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QIGZ1</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">SIG1</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QIGA1</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">old</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess_old</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess_new</span>
        <span class="n">new</span><span class="o">.</span><span class="n">sig1</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_sg_v1</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">ki1</span><span class="p">,</span> <span class="n">old</span><span class="o">.</span><span class="n">sig1</span><span class="p">,</span> <span class="n">flu</span><span class="o">.</span><span class="n">qigz1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">qiga1</span> <span class="o">=</span> <span class="n">old</span><span class="o">.</span><span class="n">sig1</span> <span class="o">-</span> <span class="n">new</span><span class="o">.</span><span class="n">sig1</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">qigz1</span></div>



<div class="viewcode-block" id="Calc_QIGA2_SIG2_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_QIGA2_SIG2_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_QIGA2_SIG2_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Update the storage of the second interflow component and calculate its outflow.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">       :math:`SIG2 = Return\_SG\_V2(KI2, SIG2, QIGZ2)`</span>

<span class="sd">       :math:`QIGA2 = SIG2_{old} - SIG2_{new} + QIGZ2`</span>

<span class="sd">    Example:</span>

<span class="sd">        Method |Calc_QIGA2_SIG2_V1| relies on the analytical solution of the linear</span>
<span class="sd">        storage equation implemented by method |Return_SG_V1|, from which we take the</span>
<span class="sd">        following test configuration:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; derived.ki2(3.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sig2.old = 1.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qigz2 = 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qiga2_sig2_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.sig2</span>
<span class="sd">        sig2(2.417343)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qiga2</span>
<span class="sd">        qiga2(0.582657)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">KI2</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QIGZ2</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">SIG2</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QIGA2</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">old</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess_old</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess_new</span>
        <span class="n">new</span><span class="o">.</span><span class="n">sig2</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_sg_v1</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">ki2</span><span class="p">,</span> <span class="n">old</span><span class="o">.</span><span class="n">sig2</span><span class="p">,</span> <span class="n">flu</span><span class="o">.</span><span class="n">qigz2</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">qiga2</span> <span class="o">=</span> <span class="n">old</span><span class="o">.</span><span class="n">sig2</span> <span class="o">-</span> <span class="n">new</span><span class="o">.</span><span class="n">sig2</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">qigz2</span></div>



<div class="viewcode-block" id="Calc_QDGA1_SDG1_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_QDGA1_SDG1_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_QDGA1_SDG1_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Update the storage of the slow direct runoff component and calculate its</span>
<span class="sd">    outflow.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">       :math:`QBDA1 = Return\_SG\_V1(KD1, SDG1, QDGZ1)`</span>

<span class="sd">       :math:`QDGA1 = SDG1_{old} - SDG1_{new} + QDGZ1`</span>

<span class="sd">    Example:</span>

<span class="sd">        Method |Calc_QDGA1_SDG1_V1| relies on the analytical solution of the linear</span>
<span class="sd">        storage equation implemented by method |Return_SG_V1|, from which we take the</span>
<span class="sd">        following test configuration:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; derived.kd1(3.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sdg1.old = 1.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qdgz1 = 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qdga1_sdg1_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.sdg1</span>
<span class="sd">        sdg1(2.417343)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qdga1</span>
<span class="sd">        qdga1(0.582657)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">KD1</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QDGZ1</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">SDG1</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QDGA1</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">old</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess_old</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess_new</span>
        <span class="n">new</span><span class="o">.</span><span class="n">sdg1</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_sg_v1</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">kd1</span><span class="p">,</span> <span class="n">old</span><span class="o">.</span><span class="n">sdg1</span><span class="p">,</span> <span class="n">flu</span><span class="o">.</span><span class="n">qdgz1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">qdga1</span> <span class="o">=</span> <span class="n">old</span><span class="o">.</span><span class="n">sdg1</span> <span class="o">-</span> <span class="n">new</span><span class="o">.</span><span class="n">sdg1</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">qdgz1</span></div>



<div class="viewcode-block" id="Calc_QDGA2_SDG2_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_QDGA2_SDG2_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_QDGA2_SDG2_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Update the storage of the fast direct runoff component and calculate its</span>
<span class="sd">    outflow.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">       :math:`QBDA2 = Return\_SG\_V1(KD2, SDG2, QDGZ2)`</span>

<span class="sd">       :math:`QDGA2 = SDG2_{old} - SDG2_{new} + QDGZ2`</span>

<span class="sd">    Example:</span>

<span class="sd">        Method |Calc_QDGA2_SDG2_V1| relies on the analytical solution of the linear</span>
<span class="sd">        storage equation implemented by method |Return_SG_V1|, from which we take the</span>
<span class="sd">        following test configuration:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; derived.kd2(3.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sdg2.old = 1.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qdgz2 = 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qdga2_sdg2_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.sdg2</span>
<span class="sd">        sdg2(2.417343)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qdga2</span>
<span class="sd">        qdga2(0.582657)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">KD2</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QDGZ2</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">SDG2</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QDGA2</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">old</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess_old</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess_new</span>
        <span class="n">new</span><span class="o">.</span><span class="n">sdg2</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_sg_v1</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">kd2</span><span class="p">,</span> <span class="n">old</span><span class="o">.</span><span class="n">sdg2</span><span class="p">,</span> <span class="n">flu</span><span class="o">.</span><span class="n">qdgz2</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">qdga2</span> <span class="o">=</span> <span class="n">old</span><span class="o">.</span><span class="n">sdg2</span> <span class="o">-</span> <span class="n">new</span><span class="o">.</span><span class="n">sdg2</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">qdgz2</span></div>



<div class="viewcode-block" id="Calc_QAH_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_QAH_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_QAH_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the final runoff in mm.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">       :math:`QAH = QZH + QBGA + QIGA1 + QIGA2 + QDGA1 + QDGA2 +</span>
<span class="sd">       NKor_{WASSER} - EvI_{WASSER}`</span>

<span class="sd">    In case there are water areas of type |WASSER|, their |NKor| values are added and</span>
<span class="sd">    their |EvI| values are subtracted from the &quot;potential&quot; runoff value, if possible.</span>
<span class="sd">    This can result in problematic modifications of simulated runoff series. It seems</span>
<span class="sd">    advisable to use the water types |FLUSS| and |SEE| instead.</span>

<span class="sd">    Examples:</span>

<span class="sd">        When there are no water areas in the respective subbasin (we choose arable land</span>
<span class="sd">        |ACKER| arbitrarily), the inflow (|QZH|) and the different runoff components</span>
<span class="sd">        (|QBGA|, |QIGA1|, |QIGA2|, |QDGA1|, and |QDGA2|) are simply summed up:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(3)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER, ACKER, ACKER)</span>
<span class="sd">        &gt;&gt;&gt; fhru(0.5, 0.2, 0.3)</span>
<span class="sd">        &gt;&gt;&gt; negq(False)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qbga = 0.1</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qiga1 = 0.2</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qiga2 = 0.3</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qdga1 = 0.4</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qdga2 = 0.5</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qzh = 1.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.nkor = 10.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evi = 4.0, 5.0, 3.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qah_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qah</span>
<span class="sd">        qah(2.5)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evi</span>
<span class="sd">        evi(4.0, 5.0, 3.0)</span>

<span class="sd">        The defined values of interception evaporation do not show any impact on the</span>
<span class="sd">        result of the given example, the predefined values for sequence |EvI| remain</span>
<span class="sd">        unchanged.  But when we define the first hydrological as a water area</span>
<span class="sd">        (|WASSER|), |Calc_QAH_V1| adds the adjusted precipitaton (|NKor|) to and</span>
<span class="sd">        subtracts the interception evaporation (|EvI|) from |lland_fluxes.QAH|:</span>

<span class="sd">        &gt;&gt;&gt; control.lnk(WASSER, VERS, NADELW)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qah_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qah</span>
<span class="sd">        qah(5.5)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evi</span>
<span class="sd">        evi(4.0, 5.0, 3.0)</span>

<span class="sd">        Note that only 5 mm are added (instead of the |NKor| value 10 mm) and that only</span>
<span class="sd">        2 mm are substracted (instead of the |EvI| value 4 mm, as the first response</span>
<span class="sd">        unit area only accounts for 50 % of the total subbasin area.</span>

<span class="sd">        Setting also the land use class of the second response unit to water type</span>
<span class="sd">        |WASSER| and resetting |NKor| to zero would result in overdrying.  To avoid</span>
<span class="sd">        this, both actual water evaporation values stored in sequence |EvI| are reduced</span>
<span class="sd">        by the same factor:</span>

<span class="sd">        &gt;&gt;&gt; control.lnk(WASSER, WASSER, NADELW)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.nkor = 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qah_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qah</span>
<span class="sd">        qah(0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evi</span>
<span class="sd">        evi(3.333333, 4.166667, 3.0)</span>

<span class="sd">        The handling of water areas of type |FLUSS| and |SEE| differs from those of</span>
<span class="sd">        type |WASSER|, as these do receive their net input before the runoff</span>
<span class="sd">        concentration routines are applied.  This should be more realistic in most</span>
<span class="sd">        cases (especially for type |SEE|, representing lakes not directly connected to</span>
<span class="sd">        the stream network).  But it could also, at least for very dry periods, result</span>
<span class="sd">        in negative outflow values. We avoid this by setting |lland_fluxes.QAH| to zero</span>
<span class="sd">        and adding the truncated negative outflow value to the |EvI| value of all</span>
<span class="sd">        response units of type |FLUSS| and |SEE|:</span>

<span class="sd">        &gt;&gt;&gt; control.lnk(FLUSS, SEE, NADELW)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qbga = -1.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qdga2 = -1.9</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evi = 4.0, 5.0, 3.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qah_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qah</span>
<span class="sd">        qah(0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evi</span>
<span class="sd">        evi(2.571429, 3.571429, 3.0)</span>

<span class="sd">        This adjustment of |EvI| is only correct regarding the total water balance.</span>
<span class="sd">        Neither spatial nor temporal consistency of the resulting |EvI| values are</span>
<span class="sd">        assured.  In the most extreme case, even negative |EvI| values might occur.</span>
<span class="sd">        This seems acceptable, as long as the adjustment of |EvI| is rarely triggered.</span>
<span class="sd">        When in doubt about this, check sequence |EvI| for all |FLUSS| and |SEE| units</span>
<span class="sd">        for possible discrepancies.  Also note that |lland_fluxes.QAH| might perform</span>
<span class="sd">        unnecessary corrections when you combine water type |WASSER| with water type</span>
<span class="sd">        |SEE| or |FLUSS|.</span>

<span class="sd">        For some model configurations, negative discharges for dry conditions are</span>
<span class="sd">        acceptable or even preferable, which is possible through setting parameter</span>
<span class="sd">        |NegQ| to |True|:</span>

<span class="sd">        &gt;&gt;&gt; negq(True)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evi = 4.0, 5.0, 3.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qah_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qah</span>
<span class="sd">        qah(-1.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.evi</span>
<span class="sd">        evi(4.0, 5.0, 3.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NegQ</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">NHRU</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">lland_control</span><span class="o">.</span><span class="n">FHRU</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QBGA</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QIGA1</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QIGA2</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QDGA1</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QDGA2</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NKor</span><span class="p">,</span>
        <span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QZH</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">EvI</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QAH</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">qah</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">qzh</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">qbga</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">qiga1</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">qiga2</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">qdga1</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">qdga2</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">con</span><span class="o">.</span><span class="n">negq</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">qah</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">):</span>
            <span class="n">d_area</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">):</span>
                    <span class="n">d_area</span> <span class="o">+=</span> <span class="n">con</span><span class="o">.</span><span class="n">fhru</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">d_area</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">FLUSS</span><span class="p">,</span> <span class="n">SEE</span><span class="p">):</span>
                        <span class="n">flu</span><span class="o">.</span><span class="n">evi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">qah</span> <span class="o">/</span> <span class="n">d_area</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">qah</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">d_epw</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">WASSER</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">qah</span> <span class="o">+=</span> <span class="n">con</span><span class="o">.</span><span class="n">fhru</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">nkor</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">d_epw</span> <span class="o">+=</span> <span class="n">con</span><span class="o">.</span><span class="n">fhru</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">evi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">qah</span> <span class="o">&gt;</span> <span class="n">d_epw</span><span class="p">)</span> <span class="ow">or</span> <span class="n">con</span><span class="o">.</span><span class="n">negq</span><span class="p">:</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">qah</span> <span class="o">-=</span> <span class="n">d_epw</span>
        <span class="k">elif</span> <span class="n">d_epw</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nhru</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">WASSER</span><span class="p">:</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">evi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*=</span> <span class="n">flu</span><span class="o">.</span><span class="n">qah</span> <span class="o">/</span> <span class="n">d_epw</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">qah</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_QA_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Calc_QA_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_QA_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the final runoff in m³/s.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">       :math:`QA = QFactor \\cdot QAH`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; derived.qfactor(2.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qah = 3.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qa_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qa</span>
<span class="sd">        qa(6.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_derived</span><span class="o">.</span><span class="n">QFactor</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QAH</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QA</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">qa</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">qfactor</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">qah</span></div>



<div class="viewcode-block" id="Pass_QA_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Pass_QA_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Pass_QA_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update the outlet link sequence.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">       :math:`Q_{outlets} = QA`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">QA</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_outlets</span><span class="o">.</span><span class="n">Q</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">outlets</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">out</span><span class="o">.</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">qa</span></div>



<div class="viewcode-block" id="Get_Temperature_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Get_Temperature_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Get_Temperature_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the selected zone&#39;s current temperature.</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(2)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tkor = 2.0, 4.0</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(model.get_temperature_v1(0))</span>
<span class="sd">        2.0</span>
<span class="sd">        &gt;&gt;&gt; round_(model.get_temperature_v1(1))</span>
<span class="sd">        4.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">TKor</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>

        <span class="k">return</span> <span class="n">flu</span><span class="o">.</span><span class="n">tkor</span><span class="p">[</span><span class="n">s</span><span class="p">]</span></div>



<div class="viewcode-block" id="Get_MeanTemperature_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Get_MeanTemperature_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Get_MeanTemperature_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the basin&#39;s current mean temperature.</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; inputs.teml = 2.0</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(model.get_meantemperature_v1())</span>
<span class="sd">        2.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_inputs</span><span class="o">.</span><span class="n">TemL</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">fastaccess</span>

        <span class="k">return</span> <span class="n">inp</span><span class="o">.</span><span class="n">teml</span></div>



<div class="viewcode-block" id="Get_Precipitation_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Get_Precipitation_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Get_Precipitation_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the current precipitation from the selected hydrological response unit.</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(2)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.nkor = 2.0, 4.0</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(model.get_precipitation_v1(0))</span>
<span class="sd">        2.0</span>
<span class="sd">        &gt;&gt;&gt; round_(model.get_precipitation_v1(1))</span>
<span class="sd">        4.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">NKor</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>

        <span class="k">return</span> <span class="n">flu</span><span class="o">.</span><span class="n">nkor</span><span class="p">[</span><span class="n">s</span><span class="p">]</span></div>



<div class="viewcode-block" id="Get_InterceptedWater_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Get_InterceptedWater_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Get_InterceptedWater_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the selected response unit&#39;s current amount of intercepted water.</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(2)</span>
<span class="sd">        &gt;&gt;&gt; states.inzp = 2.0, 4.0</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(model.get_interceptedwater_v1(0))</span>
<span class="sd">        2.0</span>
<span class="sd">        &gt;&gt;&gt; round_(model.get_interceptedwater_v1(1))</span>
<span class="sd">        4.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">Inzp</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>

        <span class="k">return</span> <span class="n">sta</span><span class="o">.</span><span class="n">inzp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>



<div class="viewcode-block" id="Get_SoilWater_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Get_SoilWater_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Get_SoilWater_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the selected response unit&#39;s current soil water content.</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(2)</span>
<span class="sd">        &gt;&gt;&gt; states.bowa = 2.0, 4.0</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(model.get_soilwater_v1(0))</span>
<span class="sd">        2.0</span>
<span class="sd">        &gt;&gt;&gt; round_(model.get_soilwater_v1(1))</span>
<span class="sd">        4.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">BoWa</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>

        <span class="k">return</span> <span class="n">sta</span><span class="o">.</span><span class="n">bowa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>



<div class="viewcode-block" id="Get_SnowCover_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Get_SnowCover_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Get_SnowCover_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the selected response unit&#39;s current snow cover degree.</span>

<span class="sd">    Example:</span>

<span class="sd">        Each response unit with a non-zero amount of snow counts as completely covered:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(2)</span>
<span class="sd">        &gt;&gt;&gt; states.wats = 0.0, 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.get_snowcover_v1(0)</span>
<span class="sd">        0.0</span>
<span class="sd">        &gt;&gt;&gt; model.get_snowcover_v1(1)</span>
<span class="sd">        1.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">WATS</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>

        <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">wats</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">1.0</span>
        <span class="k">return</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Get_SnowyCanopy_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Get_SnowyCanopy_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Get_SnowyCanopy_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the selected response unit&#39;s current snow cover degree in the canopies of</span>
<span class="sd">    tree-like vegetation (or |numpy.nan| if the zone&#39;s vegetation is not tree-like).</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(4)</span>
<span class="sd">        &gt;&gt;&gt; lnk(LAUBW, MISCHW, NADELW, ACKER)</span>
<span class="sd">        &gt;&gt;&gt; states.stinz = 0.0</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import print_vector</span>
<span class="sd">        &gt;&gt;&gt; print_vector(model.get_snowycanopy_v1(i) for i in range(4))</span>
<span class="sd">        0.0, 0.0, 0.0, nan</span>
<span class="sd">        &gt;&gt;&gt; states.stinz = 0.1</span>
<span class="sd">        &gt;&gt;&gt; print_vector(model.get_snowycanopy_v1(i) for i in range(4))</span>
<span class="sd">        1.0, 1.0, 1.0, nan</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_states</span><span class="o">.</span><span class="n">STInz</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>

        <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lnk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">LAUBW</span><span class="p">,</span> <span class="n">MISCHW</span><span class="p">,</span> <span class="n">NADELW</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">stinz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">nan</span></div>



<div class="viewcode-block" id="Get_SnowAlbedo_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Get_SnowAlbedo_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Get_SnowAlbedo_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the selected response unit&#39;s current albedo as a fraction.</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(2)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.actualalbedo = 2.0, 4.0</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(model.get_snowalbedo_v1(0))</span>
<span class="sd">        2.0</span>
<span class="sd">        &gt;&gt;&gt; round_(model.get_snowalbedo_v1(1))</span>
<span class="sd">        4.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lland_fluxes</span><span class="o">.</span><span class="n">ActualAlbedo</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>

        <span class="k">return</span> <span class="n">flu</span><span class="o">.</span><span class="n">actualalbedo</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>



<div class="viewcode-block" id="PegasusESnowInz">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.PegasusESnowInz">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">PegasusESnowInz</span><span class="p">(</span><span class="n">roottools</span><span class="o">.</span><span class="n">Pegasus</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pegasus iterator for finding the correct energy content of the intercepted</span>
<span class="sd">    snow.&quot;&quot;&quot;</span>

    <span class="n">METHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Return_BackwardEulerErrorInz_V1</span><span class="p">,)</span></div>



<div class="viewcode-block" id="PegasusESnow">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.PegasusESnow">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">PegasusESnow</span><span class="p">(</span><span class="n">roottools</span><span class="o">.</span><span class="n">Pegasus</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pegasus iterator for finding the correct snow energy content.&quot;&quot;&quot;</span>

    <span class="n">METHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Return_BackwardEulerError_V1</span><span class="p">,)</span></div>



<div class="viewcode-block" id="PegasusTempSSurface">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.PegasusTempSSurface">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">PegasusTempSSurface</span><span class="p">(</span><span class="n">roottools</span><span class="o">.</span><span class="n">Pegasus</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pegasus iterator for finding the correct snow surface temperature.&quot;&quot;&quot;</span>

    <span class="n">METHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Return_EnergyGainSnowSurface_V1</span><span class="p">,)</span></div>



<div class="viewcode-block" id="Model">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Model">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Model</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">AdHocModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;|lland.DOCNAME.complete|.&quot;&quot;&quot;</span>

    <span class="n">DOCNAME</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">DocName</span><span class="p">(</span><span class="n">short</span><span class="o">=</span><span class="s2">&quot;L&quot;</span><span class="p">)</span>
    <span class="n">__HYDPY_ROOTMODEL__</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">INLET_METHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Pick_QZ_V1</span><span class="p">,)</span>
    <span class="n">RECEIVER_METHODS</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">INTERFACE_METHODS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Get_Temperature_V1</span><span class="p">,</span>
        <span class="n">Get_MeanTemperature_V1</span><span class="p">,</span>
        <span class="n">Get_Precipitation_V1</span><span class="p">,</span>
        <span class="n">Get_InterceptedWater_V1</span><span class="p">,</span>
        <span class="n">Get_SoilWater_V1</span><span class="p">,</span>
        <span class="n">Get_SnowCover_V1</span><span class="p">,</span>
        <span class="n">Get_SnowyCanopy_V1</span><span class="p">,</span>
        <span class="n">Get_SnowAlbedo_V1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ADD_METHODS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Calc_EvI_Inzp_AETModel_V1</span><span class="p">,</span>
        <span class="n">Calc_EvB_AETModel_V1</span><span class="p">,</span>
        <span class="n">Return_NetLongwaveRadiationInz_V1</span><span class="p">,</span>
        <span class="n">Return_NetLongwaveRadiationSnow_V1</span><span class="p">,</span>
        <span class="n">Return_EnergyGainSnowSurface_V1</span><span class="p">,</span>
        <span class="n">Return_SaturationVapourPressure_V1</span><span class="p">,</span>
        <span class="n">Return_NetRadiation_V1</span><span class="p">,</span>
        <span class="n">Return_WSensInz_V1</span><span class="p">,</span>
        <span class="n">Return_WSensSnow_V1</span><span class="p">,</span>
        <span class="n">Return_WLatInz_V1</span><span class="p">,</span>
        <span class="n">Return_WLatSnow_V1</span><span class="p">,</span>
        <span class="n">Return_WSurfInz_V1</span><span class="p">,</span>
        <span class="n">Return_WSurf_V1</span><span class="p">,</span>
        <span class="n">Return_BackwardEulerErrorInz_V1</span><span class="p">,</span>
        <span class="n">Return_BackwardEulerError_V1</span><span class="p">,</span>
        <span class="n">Return_TempSInz_V1</span><span class="p">,</span>
        <span class="n">Return_TempS_V1</span><span class="p">,</span>
        <span class="n">Return_WG_V1</span><span class="p">,</span>
        <span class="n">Return_ESnowInz_V1</span><span class="p">,</span>
        <span class="n">Return_ESnow_V1</span><span class="p">,</span>
        <span class="n">Return_TempSSurface_V1</span><span class="p">,</span>
        <span class="n">Return_SG_V1</span><span class="p">,</span>
        <span class="n">Calc_BoWa_Default_V1</span><span class="p">,</span>
        <span class="n">Calc_BoWa_SoilModel_V1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RUN_METHODS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Calc_QZH_V1</span><span class="p">,</span>
        <span class="n">Process_RadiationModel_V1</span><span class="p">,</span>
        <span class="n">Calc_PossibleSunshineDuration_V1</span><span class="p">,</span>
        <span class="n">Calc_SunshineDuration_V1</span><span class="p">,</span>
        <span class="n">Calc_GlobalRadiation_V1</span><span class="p">,</span>
        <span class="n">Update_LoggedSunshineDuration_V1</span><span class="p">,</span>
        <span class="n">Calc_DailySunshineDuration_V1</span><span class="p">,</span>
        <span class="n">Update_LoggedPossibleSunshineDuration_V1</span><span class="p">,</span>
        <span class="n">Calc_DailyPossibleSunshineDuration_V1</span><span class="p">,</span>
        <span class="n">Calc_NKor_V1</span><span class="p">,</span>
        <span class="n">Calc_TKor_V1</span><span class="p">,</span>
        <span class="n">Calc_WindSpeed2m_V1</span><span class="p">,</span>
        <span class="n">Calc_ReducedWindSpeed2m_V1</span><span class="p">,</span>
        <span class="n">Calc_SaturationVapourPressure_V1</span><span class="p">,</span>
        <span class="n">Calc_ActualVapourPressure_V1</span><span class="p">,</span>
        <span class="n">Calc_NBes_Inzp_V1</span><span class="p">,</span>
        <span class="n">Calc_SNRatio_V1</span><span class="p">,</span>
        <span class="n">Calc_SBes_V1</span><span class="p">,</span>
        <span class="n">Calc_SnowIntMax_V1</span><span class="p">,</span>
        <span class="n">Calc_SnowIntRate_V1</span><span class="p">,</span>
        <span class="n">Calc_NBesInz_V1</span><span class="p">,</span>
        <span class="n">Calc_SBesInz_V1</span><span class="p">,</span>
        <span class="n">Calc_STInz_V1</span><span class="p">,</span>
        <span class="n">Calc_WaDaInz_SInz_V1</span><span class="p">,</span>
        <span class="n">Calc_WNiedInz_ESnowInz_V1</span><span class="p">,</span>
        <span class="n">Calc_TempSInz_V1</span><span class="p">,</span>
        <span class="n">Update_ASInz_V1</span><span class="p">,</span>
        <span class="n">Calc_NetShortwaveRadiationInz_V1</span><span class="p">,</span>
        <span class="n">Calc_ActualAlbedoInz_V1</span><span class="p">,</span>
        <span class="n">Update_ESnowInz_V1</span><span class="p">,</span>
        <span class="n">Calc_SchmPotInz_V1</span><span class="p">,</span>
        <span class="n">Calc_SchmInz_STInz_V1</span><span class="p">,</span>
        <span class="n">Calc_GefrPotInz_V1</span><span class="p">,</span>
        <span class="n">Calc_GefrInz_STInz_V1</span><span class="p">,</span>
        <span class="n">Calc_EvSInz_SInz_STInz_V1</span><span class="p">,</span>
        <span class="n">Update_WaDaInz_SInz_V1</span><span class="p">,</span>
        <span class="n">Update_ESnowInz_V2</span><span class="p">,</span>
        <span class="n">Calc_WATS_V1</span><span class="p">,</span>
        <span class="n">Calc_WATS_V2</span><span class="p">,</span>
        <span class="n">Calc_WaDa_WAeS_V1</span><span class="p">,</span>
        <span class="n">Calc_WaDa_WAeS_V2</span><span class="p">,</span>
        <span class="n">Calc_WGTF_V1</span><span class="p">,</span>
        <span class="n">Calc_WNied_V1</span><span class="p">,</span>
        <span class="n">Calc_WNied_ESnow_V1</span><span class="p">,</span>
        <span class="n">Calc_TZ_V1</span><span class="p">,</span>
        <span class="n">Calc_WG_V1</span><span class="p">,</span>
        <span class="n">Calc_TempS_V1</span><span class="p">,</span>
        <span class="n">Update_TauS_V1</span><span class="p">,</span>
        <span class="n">Calc_ActualAlbedo_V1</span><span class="p">,</span>
        <span class="n">Calc_NetShortwaveRadiationSnow_V1</span><span class="p">,</span>
        <span class="n">Calc_RLAtm_V1</span><span class="p">,</span>
        <span class="n">Update_EBdn_V1</span><span class="p">,</span>
        <span class="n">Update_ESnow_V1</span><span class="p">,</span>
        <span class="n">Calc_EvI_Inzp_V1</span><span class="p">,</span>
        <span class="n">Calc_EvB_V1</span><span class="p">,</span>
        <span class="n">Calc_SchmPot_V1</span><span class="p">,</span>
        <span class="n">Calc_SchmPot_V2</span><span class="p">,</span>
        <span class="n">Calc_GefrPot_V1</span><span class="p">,</span>
        <span class="n">Calc_Schm_WATS_V1</span><span class="p">,</span>
        <span class="n">Calc_Gefr_WATS_V1</span><span class="p">,</span>
        <span class="n">Calc_EvS_WAeS_WATS_V1</span><span class="p">,</span>
        <span class="n">Update_WaDa_WAeS_V1</span><span class="p">,</span>
        <span class="n">Update_ESnow_V2</span><span class="p">,</span>
        <span class="n">Calc_SFF_V1</span><span class="p">,</span>
        <span class="n">Calc_FVG_V1</span><span class="p">,</span>
        <span class="n">Calc_QKap_V1</span><span class="p">,</span>
        <span class="n">Calc_QBB_V1</span><span class="p">,</span>
        <span class="n">Calc_QIB1_V1</span><span class="p">,</span>
        <span class="n">Calc_QIB2_V1</span><span class="p">,</span>
        <span class="n">Calc_QDB_V1</span><span class="p">,</span>
        <span class="n">Update_QDB_V1</span><span class="p">,</span>
        <span class="n">Calc_BoWa_V1</span><span class="p">,</span>
        <span class="n">Calc_QBGZ_V1</span><span class="p">,</span>
        <span class="n">Calc_QIGZ1_V1</span><span class="p">,</span>
        <span class="n">Calc_QIGZ2_V1</span><span class="p">,</span>
        <span class="n">Calc_QDGZ_V1</span><span class="p">,</span>
        <span class="n">Calc_QBGA_SBG_V1</span><span class="p">,</span>
        <span class="n">Calc_QBGA_SBG_QBGZ_QDGZ_V1</span><span class="p">,</span>
        <span class="n">Calc_QIGA1_SIG1_V1</span><span class="p">,</span>
        <span class="n">Calc_QIGA2_SIG2_V1</span><span class="p">,</span>
        <span class="n">Calc_QDGZ1_QDGZ2_V1</span><span class="p">,</span>
        <span class="n">Calc_QDGA1_SDG1_V1</span><span class="p">,</span>
        <span class="n">Calc_QDGA2_SDG2_V1</span><span class="p">,</span>
        <span class="n">Calc_QAH_V1</span><span class="p">,</span>
        <span class="n">Calc_QA_V1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">OUTLET_METHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Pass_QA_V1</span><span class="p">,)</span>
    <span class="n">SENDER_METHODS</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">SUBMODELINTERFACES</span> <span class="o">=</span> <span class="p">(</span><span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="p">,</span> <span class="n">soilinterfaces</span><span class="o">.</span><span class="n">SoilModel_V1</span><span class="p">)</span>
    <span class="n">SUBMODELS</span> <span class="o">=</span> <span class="p">(</span><span class="n">PegasusESnowInz</span><span class="p">,</span> <span class="n">PegasusESnow</span><span class="p">,</span> <span class="n">PegasusTempSSurface</span><span class="p">)</span>

    <span class="n">idx_hru</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Idx_HRU</span><span class="p">()</span>

    <span class="n">radiationmodel</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelProperty</span><span class="p">(</span>
        <span class="n">radiationinterfaces</span><span class="o">.</span><span class="n">RadiationModel_V1</span><span class="p">,</span> <span class="n">radiationinterfaces</span><span class="o">.</span><span class="n">RadiationModel_V4</span>
    <span class="p">)</span>
    <span class="n">radiationmodel_is_mainmodel</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelIsMainmodelProperty</span><span class="p">()</span>
    <span class="n">radiationmodel_typeid</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelTypeIDProperty</span><span class="p">()</span>

    <span class="n">aetmodel</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelProperty</span><span class="p">(</span><span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="p">)</span>
    <span class="n">aetmodel_is_mainmodel</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelIsMainmodelProperty</span><span class="p">()</span>
    <span class="n">aetmodel_typeid</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelTypeIDProperty</span><span class="p">()</span>

    <span class="n">soilmodel</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelProperty</span><span class="p">(</span><span class="n">soilinterfaces</span><span class="o">.</span><span class="n">SoilModel_V1</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">soilmodel_is_mainmodel</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelIsMainmodelProperty</span><span class="p">()</span>
    <span class="n">soilmodel_typeid</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelTypeIDProperty</span><span class="p">()</span></div>



<div class="viewcode-block" id="Main_RadiationModel_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Main_RadiationModel_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Main_RadiationModel_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">AdHocModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for |lland.DOCNAME.long| models that support submodels that comply</span>
<span class="sd">    with the |RadiationModel_V1| interface.&quot;&quot;&quot;</span>

    <span class="n">radiationmodel</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelProperty</span>
    <span class="n">radiationmodel_is_mainmodel</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelIsMainmodelProperty</span><span class="p">()</span>
    <span class="n">radiationmodel_typeid</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelTypeIDProperty</span><span class="p">()</span>

    <span class="nd">@importtools</span><span class="o">.</span><span class="n">prepare_submodel</span><span class="p">(</span>
        <span class="s2">&quot;radiationmodel&quot;</span><span class="p">,</span> <span class="n">radiationinterfaces</span><span class="o">.</span><span class="n">RadiationModel_V1</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_radiationmodel_v1</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">radiationmodel</span><span class="p">:</span> <span class="n">radiationinterfaces</span><span class="o">.</span><span class="n">RadiationModel_V1</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">refresh</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add the given radiation model that follows the |RadiationModel_V1|</span>
<span class="sd">        interface.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-01&quot;, &quot;2000-01-02&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland_knauf import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; with model.add_radiationmodel_v1(&quot;meteo_sun_morsim&quot;):</span>
<span class="sd">        ...     latitude(50.0)</span>
<span class="sd">        &gt;&gt;&gt; model.radiationmodel.parameters.control.latitude</span>
<span class="sd">        latitude(50.0)</span>
<span class="sd">        &quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="Main_RadiationModel_V4">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Main_RadiationModel_V4">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Main_RadiationModel_V4</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">AdHocModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for |lland.DOCNAME.long| models that support submodels that comply</span>
<span class="sd">    with the |RadiationModel_V4| interface.&quot;&quot;&quot;</span>

    <span class="n">radiationmodel</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelProperty</span>
    <span class="n">radiationmodel_is_mainmodel</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelIsMainmodelProperty</span><span class="p">()</span>
    <span class="n">radiationmodel_typeid</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelTypeIDProperty</span><span class="p">()</span>

    <span class="nd">@importtools</span><span class="o">.</span><span class="n">prepare_submodel</span><span class="p">(</span>
        <span class="s2">&quot;radiationmodel&quot;</span><span class="p">,</span> <span class="n">radiationinterfaces</span><span class="o">.</span><span class="n">RadiationModel_V4</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_radiationmodel_v4</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">radiationmodel</span><span class="p">:</span> <span class="n">radiationinterfaces</span><span class="o">.</span><span class="n">RadiationModel_V4</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">refresh</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add the given radiation model that follows the |RadiationModel_V4|</span>
<span class="sd">        interface.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-01&quot;, &quot;2000-01-02&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland_knauf import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; with model.add_radiationmodel_v4(&quot;meteo_psun_sun_glob_io&quot;):</span>
<span class="sd">        ...     inputs.globalradiation = 100.0</span>
<span class="sd">        &gt;&gt;&gt; model.radiationmodel.sequences.inputs.globalradiation</span>
<span class="sd">        globalradiation(100.0)</span>
<span class="sd">        &quot;&quot;&quot;</span></div>



<span class="k">class</span><span class="w"> </span><span class="nc">_Main_AETModel_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">AdHocModel</span><span class="p">):</span>

    <span class="n">aetmodel</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelProperty</span>
    <span class="n">aetmodel_is_mainmodel</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelIsMainmodelProperty</span><span class="p">()</span>
    <span class="n">aetmodel_typeid</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelTypeIDProperty</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_add_aetmodel_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aetmodel</span><span class="p">:</span> <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">control</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span>
        <span class="n">nhru</span> <span class="o">=</span> <span class="n">control</span><span class="o">.</span><span class="n">nhru</span><span class="o">.</span><span class="n">value</span>
        <span class="n">lnk</span> <span class="o">=</span> <span class="n">control</span><span class="o">.</span><span class="n">lnk</span><span class="o">.</span><span class="n">values</span>

        <span class="n">aetmodel</span><span class="o">.</span><span class="n">prepare_nmbzones</span><span class="p">(</span><span class="n">nhru</span><span class="p">)</span>
        <span class="n">aetmodel</span><span class="o">.</span><span class="n">prepare_zonetypes</span><span class="p">(</span><span class="n">lnk</span><span class="p">)</span>
        <span class="n">aetmodel</span><span class="o">.</span><span class="n">prepare_subareas</span><span class="p">(</span><span class="n">control</span><span class="o">.</span><span class="n">fhru</span><span class="o">.</span><span class="n">values</span> <span class="o">*</span> <span class="n">control</span><span class="o">.</span><span class="n">ft</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="n">aetmodel</span><span class="o">.</span><span class="n">prepare_leafareaindex</span><span class="p">(</span><span class="n">control</span><span class="o">.</span><span class="n">lai</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">aetmodel</span><span class="o">.</span><span class="n">prepare_maxsoilwater</span><span class="p">(</span><span class="n">control</span><span class="o">.</span><span class="n">wmax</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">sel</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">nhru</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">NP_BOOL</span><span class="p">)</span>
        <span class="n">sel</span><span class="p">[</span><span class="n">lnk</span> <span class="o">==</span> <span class="n">WASSER</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">sel</span><span class="p">[</span><span class="n">lnk</span> <span class="o">==</span> <span class="n">FLUSS</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">sel</span><span class="p">[</span><span class="n">lnk</span> <span class="o">==</span> <span class="n">SEE</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">aetmodel</span><span class="o">.</span><span class="n">prepare_water</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span>
        <span class="n">aetmodel</span><span class="o">.</span><span class="n">prepare_interception</span><span class="p">(</span><span class="o">~</span><span class="n">sel</span><span class="p">)</span>
        <span class="n">sel</span><span class="p">[</span><span class="n">lnk</span> <span class="o">==</span> <span class="n">VERS</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">aetmodel</span><span class="o">.</span><span class="n">prepare_soil</span><span class="p">(</span><span class="o">~</span><span class="n">sel</span><span class="p">)</span>
        <span class="n">sel</span><span class="p">[</span><span class="n">lnk</span> <span class="o">==</span> <span class="n">BODEN</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">sel</span><span class="p">[</span><span class="n">lnk</span> <span class="o">==</span> <span class="n">GLETS</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">aetmodel</span><span class="o">.</span><span class="n">prepare_plant</span><span class="p">(</span><span class="o">~</span><span class="n">sel</span><span class="p">)</span>
        <span class="n">sel</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">nhru</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">NP_BOOL</span><span class="p">)</span>
        <span class="n">sel</span><span class="p">[</span><span class="n">lnk</span> <span class="o">==</span> <span class="n">NADELW</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">aetmodel</span><span class="o">.</span><span class="n">prepare_conifer</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span>
        <span class="n">sel</span><span class="p">[</span><span class="n">lnk</span> <span class="o">==</span> <span class="n">LAUBW</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">sel</span><span class="p">[</span><span class="n">lnk</span> <span class="o">==</span> <span class="n">MISCHW</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">aetmodel</span><span class="o">.</span><span class="n">prepare_tree</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span>


<div class="viewcode-block" id="Main_AETModel_V1A">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Main_AETModel_V1A">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Main_AETModel_V1A</span><span class="p">(</span><span class="n">_Main_AETModel_V1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for |lland.DOCNAME.long| models that support submodels that comply</span>
<span class="sd">    with the |AETModel_V1| interface and cannot provide information on the measuring</span>
<span class="sd">    height of wind speed.&quot;&quot;&quot;</span>

    <span class="nd">@importtools</span><span class="o">.</span><span class="n">prepare_submodel</span><span class="p">(</span>
        <span class="s2">&quot;aetmodel&quot;</span><span class="p">,</span>
        <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="p">,</span>
        <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="o">.</span><span class="n">prepare_nmbzones</span><span class="p">,</span>
        <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="o">.</span><span class="n">prepare_zonetypes</span><span class="p">,</span>
        <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="o">.</span><span class="n">prepare_subareas</span><span class="p">,</span>
        <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="o">.</span><span class="n">prepare_water</span><span class="p">,</span>
        <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="o">.</span><span class="n">prepare_interception</span><span class="p">,</span>
        <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="o">.</span><span class="n">prepare_soil</span><span class="p">,</span>
        <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="o">.</span><span class="n">prepare_plant</span><span class="p">,</span>
        <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="o">.</span><span class="n">prepare_tree</span><span class="p">,</span>
        <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="o">.</span><span class="n">prepare_conifer</span><span class="p">,</span>
        <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="o">.</span><span class="n">prepare_leafareaindex</span><span class="p">,</span>
        <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="o">.</span><span class="n">prepare_maxsoilwater</span><span class="p">,</span>
        <span class="n">landtype_constants</span><span class="o">=</span><span class="n">lland_constants</span><span class="o">.</span><span class="n">CONSTANTS</span><span class="p">,</span>
        <span class="n">landtype_refindices</span><span class="o">=</span><span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">refweights</span><span class="o">=</span><span class="n">lland_control</span><span class="o">.</span><span class="n">FHRU</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_aetmodel_v1</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">aetmodel</span><span class="p">:</span> <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="p">,</span>
        <span class="o">/</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">refresh</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>  <span class="c1"># pylint: disable=unused-argument</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialise the given submodel that follows the |AETModel_V1| interface and</span>
<span class="sd">        is responsible for calculating the different kinds of actual</span>
<span class="sd">        evapotranspiration.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-01&quot;, &quot;2001-01-01&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland_dd import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(9)</span>
<span class="sd">        &gt;&gt;&gt; ft(10.0)</span>
<span class="sd">        &gt;&gt;&gt; fhru(0.07, 0.08, 0.09, 0.1, 0.11, 0.12, 0.13, 0.14, 0.16)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER, LAUBW, NADELW, VERS, WASSER, FLUSS, SEE, BODEN, GLETS)</span>
<span class="sd">        &gt;&gt;&gt; lai(1.0)</span>
<span class="sd">        &gt;&gt;&gt; lai.acker_jan = 2.0</span>
<span class="sd">        &gt;&gt;&gt; lai.laubw_dec = 3.0</span>
<span class="sd">        &gt;&gt;&gt; wmax(50.0)</span>
<span class="sd">        &gt;&gt;&gt; with model.add_aetmodel_v1(&quot;evap_aet_morsim&quot;):</span>
<span class="sd">        ...     nmbhru</span>
<span class="sd">        ...     hrutype</span>
<span class="sd">        ...     water</span>
<span class="sd">        ...     interception</span>
<span class="sd">        ...     soil</span>
<span class="sd">        ...     tree</span>
<span class="sd">        ...     conifer</span>
<span class="sd">        ...     maxsoilwater</span>
<span class="sd">        ...     soilmoisturelimit(acker=0.7, laubw=0.8, nadelw=0.9, boden=1.0, \</span>
<span class="sd">glets=1.1)</span>
<span class="sd">        ...     my_lai = leafareaindex</span>
<span class="sd">        ...     &quot;my_lai&quot;, my_lai.nadelw_jun, my_lai.acker_jan, my_lai.laubw_dec</span>
<span class="sd">        ...     for method, arguments in model.preparemethod2arguments.items():</span>
<span class="sd">        ...         print(method, arguments[0][0], sep=&quot;: &quot;)  # doctest: +ELLIPSIS</span>
<span class="sd">        nmbhru(9)</span>
<span class="sd">        hrutype(ACKER, LAUBW, NADELW, VERS, WASSER, FLUSS, SEE, BODEN, GLETS)</span>
<span class="sd">        water(acker=False, boden=False, fluss=True, glets=False, laubw=False,</span>
<span class="sd">              nadelw=False, see=True, vers=False, wasser=True)</span>
<span class="sd">        interception(acker=True, boden=True, fluss=False, glets=True,</span>
<span class="sd">                     laubw=True, nadelw=True, see=False, vers=True,</span>
<span class="sd">                     wasser=False)</span>
<span class="sd">        soil(acker=True, boden=True, fluss=False, glets=True, laubw=True,</span>
<span class="sd">             nadelw=True, see=False, vers=False, wasser=False)</span>
<span class="sd">        tree(acker=False, boden=False, fluss=False, glets=False, laubw=True,</span>
<span class="sd">             nadelw=True, see=False, vers=False, wasser=False)</span>
<span class="sd">        conifer(acker=False, boden=False, fluss=False, glets=False,</span>
<span class="sd">                laubw=False, nadelw=True, see=False, vers=False, wasser=False)</span>
<span class="sd">        maxsoilwater(50.0)</span>
<span class="sd">        (&#39;my_lai&#39;, 1.0, 2.0, 3.0)</span>
<span class="sd">        prepare_nmbzones: 9</span>
<span class="sd">        prepare_zonetypes: [ 4 14 13  3 16 17 18  7  8]</span>
<span class="sd">        prepare_subareas: [0.7 0.8 0.9 1.  1.1 1.2 1.3 1.4 1.6]</span>
<span class="sd">        prepare_leafareaindex: [[1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.]</span>
<span class="sd">        ...</span>
<span class="sd">        prepare_maxsoilwater: [50. 50. 50. 50. 50. 50. 50. 50. 50.]</span>
<span class="sd">        prepare_water: [False False False False  True  True  True False False]</span>
<span class="sd">        prepare_interception: [ True  True  True  True False False False  True  True]</span>
<span class="sd">        prepare_soil: [ True  True  True False False False False  True  True]</span>
<span class="sd">        prepare_plant: [ True  True  True False False False False False False]</span>
<span class="sd">        prepare_conifer: [False False  True False False False False False False]</span>
<span class="sd">        prepare_tree: [False  True  True False False False False False False]</span>

<span class="sd">        &gt;&gt;&gt; model.aetmodel.parameters.control.leafareaindex.acker_jan</span>
<span class="sd">        2.0</span>

<span class="sd">        &gt;&gt;&gt; sml = model.aetmodel.parameters.control.soilmoisturelimit</span>
<span class="sd">        &gt;&gt;&gt; sml</span>
<span class="sd">        soilmoisturelimit(acker=0.7, boden=1.0, glets=1.0, laubw=0.8,</span>
<span class="sd">                          nadelw=0.9)</span>
<span class="sd">        &gt;&gt;&gt; lnk(NADELW, LAUBW, ACKER, VERS, WASSER, FLUSS, SEE, BODEN, GLETS)</span>
<span class="sd">        &gt;&gt;&gt; sml</span>
<span class="sd">        soilmoisturelimit(acker=0.9, boden=1.0, glets=1.0, laubw=0.8,</span>
<span class="sd">                          nadelw=0.7)</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(sml.average_values())</span>
<span class="sd">        0.914815</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_aetmodel_v1</span><span class="p">(</span><span class="n">aetmodel</span><span class="p">)</span></div>



<div class="viewcode-block" id="Main_AETModel_V1B">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Main_AETModel_V1B">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Main_AETModel_V1B</span><span class="p">(</span><span class="n">_Main_AETModel_V1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for |lland.DOCNAME.long| models that support submodels that comply</span>
<span class="sd">    with the |AETModel_V1| interface and can provide information on the measuring</span>
<span class="sd">    height of wind speed.&quot;&quot;&quot;</span>

    <span class="nd">@importtools</span><span class="o">.</span><span class="n">prepare_submodel</span><span class="p">(</span>
        <span class="s2">&quot;aetmodel&quot;</span><span class="p">,</span>
        <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="p">,</span>
        <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="o">.</span><span class="n">prepare_nmbzones</span><span class="p">,</span>
        <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="o">.</span><span class="n">prepare_zonetypes</span><span class="p">,</span>
        <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="o">.</span><span class="n">prepare_subareas</span><span class="p">,</span>
        <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="o">.</span><span class="n">prepare_water</span><span class="p">,</span>
        <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="o">.</span><span class="n">prepare_interception</span><span class="p">,</span>
        <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="o">.</span><span class="n">prepare_soil</span><span class="p">,</span>
        <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="o">.</span><span class="n">prepare_plant</span><span class="p">,</span>
        <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="o">.</span><span class="n">prepare_tree</span><span class="p">,</span>
        <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="o">.</span><span class="n">prepare_conifer</span><span class="p">,</span>
        <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="o">.</span><span class="n">prepare_measuringheightwindspeed</span><span class="p">,</span>
        <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="o">.</span><span class="n">prepare_leafareaindex</span><span class="p">,</span>
        <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="o">.</span><span class="n">prepare_maxsoilwater</span><span class="p">,</span>
        <span class="n">landtype_constants</span><span class="o">=</span><span class="n">lland_constants</span><span class="o">.</span><span class="n">CONSTANTS</span><span class="p">,</span>
        <span class="n">landtype_refindices</span><span class="o">=</span><span class="n">lland_control</span><span class="o">.</span><span class="n">Lnk</span><span class="p">,</span>
        <span class="n">refweights</span><span class="o">=</span><span class="n">lland_control</span><span class="o">.</span><span class="n">FHRU</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_aetmodel_v1</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">aetmodel</span><span class="p">:</span> <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="p">,</span>
        <span class="o">/</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">refresh</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>  <span class="c1"># pylint: disable=unused-argument</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialise the given submodel that follows the |AETModel_V1| interface and</span>
<span class="sd">        is responsible for calculating the different kinds of actual</span>
<span class="sd">        evapotranspiration.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-01&quot;, &quot;2001-01-01&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland_knauf import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(2)</span>
<span class="sd">        &gt;&gt;&gt; ft(10.0)</span>
<span class="sd">        &gt;&gt;&gt; fhru(0.5, 0.5)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER, LAUBW)</span>
<span class="sd">        &gt;&gt;&gt; measuringheightwindspeed(10.0)</span>
<span class="sd">        &gt;&gt;&gt; lai(1.0)</span>
<span class="sd">        &gt;&gt;&gt; wmax(50.0)</span>
<span class="sd">        &gt;&gt;&gt; with model.add_aetmodel_v1(&quot;evap_aet_morsim&quot;):</span>
<span class="sd">        ...     nmbhru</span>
<span class="sd">        ...     hrutype</span>
<span class="sd">        ...     measuringheightwindspeed</span>
<span class="sd">        nmbhru(2)</span>
<span class="sd">        hrutype(ACKER, LAUBW)</span>
<span class="sd">        measuringheightwindspeed(10.0)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_aetmodel_v1</span><span class="p">(</span><span class="n">aetmodel</span><span class="p">)</span>
        <span class="n">aetmodel</span><span class="o">.</span><span class="n">prepare_measuringheightwindspeed</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">measuringheightwindspeed</span><span class="o">.</span><span class="n">value</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="Main_SoilModel_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Main_SoilModel_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Main_SoilModel_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">AdHocModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for |lland.DOCNAME.long| models that support submodels that comply</span>
<span class="sd">    with the |SoilModel_V1| interface.&quot;&quot;&quot;</span>

    <span class="n">soilmodel</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelProperty</span>
    <span class="n">soilmodel_is_mainmodel</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelIsMainmodelProperty</span><span class="p">()</span>
    <span class="n">soilmodel_typeid</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelTypeIDProperty</span><span class="p">()</span>

    <span class="nd">@importtools</span><span class="o">.</span><span class="n">prepare_submodel</span><span class="p">(</span>
        <span class="s2">&quot;soilmodel&quot;</span><span class="p">,</span>
        <span class="n">soilinterfaces</span><span class="o">.</span><span class="n">SoilModel_V1</span><span class="p">,</span>
        <span class="n">soilinterfaces</span><span class="o">.</span><span class="n">SoilModel_V1</span><span class="o">.</span><span class="n">prepare_nmbzones</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_soilmodel_v1</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">soilmodel</span><span class="p">:</span> <span class="n">soilinterfaces</span><span class="o">.</span><span class="n">SoilModel_V1</span><span class="p">,</span>
        <span class="o">/</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">refresh</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>  <span class="c1"># pylint: disable=unused-argument</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialise the given soil model that follows the |SoilModel_V1| interface.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland_dd import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(2)</span>
<span class="sd">        &gt;&gt;&gt; ft(10.0)</span>
<span class="sd">        &gt;&gt;&gt; fhru(0.2, 0.8)</span>
<span class="sd">        &gt;&gt;&gt; with model.add_soilmodel_v1(&quot;ga_garto_submodel1&quot;, update=False):</span>
<span class="sd">        ...     nmbsoils</span>
<span class="sd">        nmbsoils(2)</span>
<span class="sd">        &gt;&gt;&gt; model.soilmodel.parameters.control.nmbsoils</span>
<span class="sd">        nmbsoils(2)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">control</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span>
        <span class="n">soilmodel</span><span class="o">.</span><span class="n">prepare_nmbzones</span><span class="p">(</span><span class="n">control</span><span class="o">.</span><span class="n">nhru</span><span class="o">.</span><span class="n">value</span><span class="p">)</span></div>



<div class="viewcode-block" id="Sub_TempModel_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Sub_TempModel_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Sub_TempModel_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">AdHocModel</span><span class="p">,</span> <span class="n">tempinterfaces</span><span class="o">.</span><span class="n">TempModel_V1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for |lland.DOCNAME.long| models that comply with the |TempModel_V1|</span>
<span class="sd">    submodel interface.&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="Sub_PrecipModel_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Sub_PrecipModel_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Sub_PrecipModel_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">AdHocModel</span><span class="p">,</span> <span class="n">precipinterfaces</span><span class="o">.</span><span class="n">PrecipModel_V1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for |lland.DOCNAME.long| models that comply with the |PrecipModel_V1|</span>
<span class="sd">    submodel interface.&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="Sub_IntercModel_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Sub_IntercModel_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Sub_IntercModel_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">AdHocModel</span><span class="p">,</span> <span class="n">stateinterfaces</span><span class="o">.</span><span class="n">IntercModel_V1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for |lland.DOCNAME.long| models that comply with the |IntercModel_V1|</span>
<span class="sd">    submodel interface.&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="Sub_SoilWaterModel_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Sub_SoilWaterModel_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Sub_SoilWaterModel_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">AdHocModel</span><span class="p">,</span> <span class="n">stateinterfaces</span><span class="o">.</span><span class="n">SoilWaterModel_V1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for |lland.DOCNAME.long| models that comply with the</span>
<span class="sd">    |SoilWaterModel_V1| submodel interface.&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="Sub_SnowCoverModel_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Sub_SnowCoverModel_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Sub_SnowCoverModel_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">AdHocModel</span><span class="p">,</span> <span class="n">stateinterfaces</span><span class="o">.</span><span class="n">SnowCoverModel_V1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for |lland.DOCNAME.long| models that comply with the</span>
<span class="sd">    |SnowCoverModel_V1| submodel interface.&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="Sub_SnowyCanopyModel_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Sub_SnowyCanopyModel_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Sub_SnowyCanopyModel_V1</span><span class="p">(</span>
    <span class="n">modeltools</span><span class="o">.</span><span class="n">AdHocModel</span><span class="p">,</span> <span class="n">stateinterfaces</span><span class="o">.</span><span class="n">SnowyCanopyModel_V1</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for |lland.DOCNAME.long| models that comply with the</span>
<span class="sd">    |SnowyCanopyModel_V1| submodel interface.&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="Sub_SnowAlbedoModel_V1">
<a class="viewcode-back" href="../../../../lland.html#hydpy.models.lland.lland_model.Sub_SnowAlbedoModel_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Sub_SnowAlbedoModel_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">AdHocModel</span><span class="p">,</span> <span class="n">stateinterfaces</span><span class="o">.</span><span class="n">SnowAlbedoModel_V1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for |lland.DOCNAME.long| models that comply with the</span>
<span class="sd">    |SnowAlbedoModel_V1| submodel interface.&quot;&quot;&quot;</span></div>

</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">HydPy 6.1.5 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">hydpy.models.lland.lland_model</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2013-2025, HydPy Developers.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.2.3.
    </div>
  </body>
</html>