
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>hydpy.auxs.xmltools &#8212; HydPy 4.0.1 documentation</title>
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">HydPy 4.0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">hydpy.auxs.xmltools</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for hydpy.auxs.xmltools</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;This module provides features for executing *HydPy* workflows based on</span>
<span class="sd">XML configuration files.</span>

<span class="sd">.. _HydPy release: https://github.com/hydpy-dev/hydpy/releases</span>

<span class="sd">At the heart of module |xmltools| lies function |run_simulation|, which is</span>
<span class="sd">thought to be applied via a command line (see the documentation</span>
<span class="sd">on script |hyd| for further information).  |run_simulation| expects that</span>
<span class="sd">the *HydPy* project you want to work with is available in your current</span>
<span class="sd">working directory and contains an XML configuration file (as `single_run.xml`</span>
<span class="sd">in the example project folder `LahnH`).  This configuration file must</span>
<span class="sd">agree with the XML schema file `HydPyConfigSingleRun.xsd`, which is available</span>
<span class="sd">in the :ref:`configuration` subpackage and also downloadable for each</span>
<span class="sd">`HydPy release`_.  In case you did implement new or changed existing</span>
<span class="sd">models, you have to update this schema file.  *HydPy* does this automatically</span>
<span class="sd">through its setup mechanism (see the documentation on class |XSDWriter|).</span>

<span class="sd">To show how to apply |run_simulation| via a command line, we first</span>
<span class="sd">copy the `LahnH` project into the `iotesting` folder via calling</span>
<span class="sd">function |prepare_full_example_1|:</span>

<span class="sd">&gt;&gt;&gt; from hydpy.examples import prepare_full_example_1</span>
<span class="sd">&gt;&gt;&gt; prepare_full_example_1()</span>

<span class="sd">Running the simulation requires defining the main script (`hyd.py`),</span>
<span class="sd">the function specifying the actual workflow (`run_simulation`), the</span>
<span class="sd">name of the project of interest (`LahnH`), and the name of the</span>
<span class="sd">relevant XMK configuration file (`single_run.xml`).  To simulate using</span>
<span class="sd">the command line, we pass the required text to function |run_subprocess|:</span>

<span class="sd">&gt;&gt;&gt; from hydpy import run_subprocess, TestIO</span>
<span class="sd">&gt;&gt;&gt; import subprocess</span>
<span class="sd">&gt;&gt;&gt; with TestIO():    # doctest: +ELLIPSIS</span>
<span class="sd">...     result = run_subprocess(&quot;hyd.py run_simulation LahnH single_run.xml&quot;)</span>
<span class="sd">Start HydPy project `LahnH` (...).</span>
<span class="sd">Read configuration file `single_run.xml` (...).</span>
<span class="sd">Interpret the defined options (...).</span>
<span class="sd">Interpret the defined period (...).</span>
<span class="sd">Read all network files (...).</span>
<span class="sd">Activate the selected network (...).</span>
<span class="sd">Read the required control files (...).</span>
<span class="sd">Read the required condition files (...).</span>
<span class="sd">Read the required time series files (...).</span>
<span class="sd">Perform the simulation run (...).</span>
<span class="sd">Write the desired condition files (...).</span>
<span class="sd">Write the desired time series files (...).</span>

<span class="sd">As defined by the XML configuration file, the simulation started on the</span>
<span class="sd">first and ended at the sixths January 1996.  The following example shows</span>
<span class="sd">the read initial conditions and the written final conditions of</span>
<span class="sd">sequence |hland_states.SM| for the 12 hydrological response units of the</span>
<span class="sd">subcatchment `land_dill`:</span>

<span class="sd">&gt;&gt;&gt; with TestIO():</span>
<span class="sd">...     filepath = &quot;LahnH/conditions/init_1996_01_01_00_00_00/land_dill.py&quot;</span>
<span class="sd">...     with open(filepath) as file_:</span>
<span class="sd">...         print(&quot;&quot;.join(file_.readlines()[10:12]))</span>
<span class="sd">...     filepath = &quot;LahnH/conditions/init_1996_01_06/land_dill.py&quot;</span>
<span class="sd">...     with open(filepath) as file_:</span>
<span class="sd">...         print(&quot;&quot;.join(file_.readlines()[9:12]))</span>
<span class="sd">sm(185.13164, 181.18755, 199.80432, 196.55888, 212.04018, 209.48859,</span>
<span class="sd">   222.12115, 220.12671, 230.30756, 228.70779, 236.91943, 235.64427)</span>
<span class="sd">&lt;BLANKLINE&gt;</span>
<span class="sd">sm(183.873078, 179.955801, 198.446011, 195.222634, 210.598689,</span>
<span class="sd">   208.064445, 220.611126, 218.630245, 228.741883, 227.152989,</span>
<span class="sd">   235.308805, 234.042313)</span>
<span class="sd">&lt;BLANKLINE&gt;</span>

<span class="sd">The intermediate soil moisture values are stored in a NetCDF file called</span>
<span class="sd">`hland_v1_state_sm.nc`:</span>

<span class="sd">&gt;&gt;&gt; import numpy</span>
<span class="sd">&gt;&gt;&gt; from hydpy import print_values</span>
<span class="sd">&gt;&gt;&gt; from hydpy.core.netcdftools import netcdf4, chars2str, query_variable</span>
<span class="sd">&gt;&gt;&gt; with TestIO():</span>
<span class="sd">...     ncfile = netcdf4.Dataset(&quot;LahnH/series/output/hland_v1_state_sm.nc&quot;)</span>
<span class="sd">...     chars2str(query_variable(ncfile, &quot;station_id&quot;))[:3]</span>
<span class="sd">...     print_values(query_variable(ncfile, &quot;state_sm&quot;)[:, 0])</span>
<span class="sd">[&#39;land_dill_0&#39;, &#39;land_dill_1&#39;, &#39;land_dill_2&#39;]</span>
<span class="sd">184.926173, 184.603966, 184.386666, 184.098541, 183.873078</span>
<span class="sd">&gt;&gt;&gt; ncfile.close()</span>

<span class="sd">Spatially averaged time series values are stored in files ending with</span>
<span class="sd">the suffix `_mean`:</span>

<span class="sd">&gt;&gt;&gt; with TestIO(clear_all=True):</span>
<span class="sd">...     print_values((numpy.load(</span>
<span class="sd">...         &quot;LahnH/series/output/lahn_1_sim_q_mean.npy&quot;)[13:]))</span>
<span class="sd">9.647824, 8.517795, 7.781311, 7.344944, 7.153142</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1"># import...</span>
<span class="c1"># ...from standard library</span>
<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">xml.etree</span> <span class="kn">import</span> <span class="n">ElementTree</span>
<span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Literal</span>  <span class="c1"># type: ignore[misc]</span>

<span class="c1"># ...from HydPy</span>
<span class="kn">import</span> <span class="nn">hydpy</span>
<span class="kn">from</span> <span class="nn">hydpy</span> <span class="kn">import</span> <span class="n">conf</span>
<span class="kn">from</span> <span class="nn">hydpy</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="kn">import</span> <span class="n">devicetools</span>
<span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="kn">import</span> <span class="n">exceptiontools</span>
<span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="kn">import</span> <span class="n">hydpytools</span>
<span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="kn">import</span> <span class="n">importtools</span>
<span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="kn">import</span> <span class="n">itemtools</span>
<span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="kn">import</span> <span class="n">netcdftools</span>
<span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="kn">import</span> <span class="n">objecttools</span>
<span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="kn">import</span> <span class="n">selectiontools</span>
<span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="kn">import</span> <span class="n">sequencetools</span>
<span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="kn">import</span> <span class="n">timetools</span>
<span class="kn">from</span> <span class="nn">hydpy.exe</span> <span class="kn">import</span> <span class="n">commandtools</span>
<span class="kn">from</span> <span class="nn">hydpy.core.typingtools</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="c1"># pylint: disable=ungrouped-imports</span>
    <span class="kn">import</span> <span class="nn">netCDF4</span> <span class="k">as</span> <span class="nn">netcdf4</span>
    <span class="kn">import</span> <span class="nn">xmlschema</span>
    <span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="kn">import</span> <span class="n">modeltools</span>
    <span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="kn">import</span> <span class="n">variabletools</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">netcdf4</span> <span class="o">=</span> <span class="n">exceptiontools</span><span class="o">.</span><span class="n">OptionalImport</span><span class="p">(</span>
        <span class="s2">&quot;netcdf4&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;netCDF4&quot;</span><span class="p">,</span> <span class="s2">&quot;h5netcdf.legacyapi&quot;</span><span class="p">],</span> <span class="nb">locals</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="n">xmlschema</span> <span class="o">=</span> <span class="n">exceptiontools</span><span class="o">.</span><span class="n">OptionalImport</span><span class="p">(</span><span class="s2">&quot;xmlschema&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;xmlschema&quot;</span><span class="p">],</span> <span class="nb">locals</span><span class="p">())</span>

<span class="n">_SetOrAddItem</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;_SetOrAddItem&quot;</span><span class="p">,</span> <span class="n">itemtools</span><span class="o">.</span><span class="n">SetItem</span><span class="p">,</span> <span class="n">itemtools</span><span class="o">.</span><span class="n">AddItem</span><span class="p">)</span>
<span class="n">_GetOrChangeItem</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;_GetOrChangeItem&quot;</span><span class="p">,</span> <span class="n">itemtools</span><span class="o">.</span><span class="n">GetItem</span><span class="p">,</span> <span class="n">itemtools</span><span class="o">.</span><span class="n">ChangeItem</span><span class="p">)</span>

<span class="n">namespace</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;{https://github.com/hydpy-dev/hydpy/releases/download/&quot;</span>
    <span class="s2">&quot;your-hydpy-version/HydPyConfigBase.xsd}&quot;</span>
<span class="p">)</span>
<span class="n">_ITEMGROUP2ITEMCLASS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;setitems&quot;</span><span class="p">:</span> <span class="n">itemtools</span><span class="o">.</span><span class="n">SetItem</span><span class="p">,</span>
    <span class="s2">&quot;additems&quot;</span><span class="p">:</span> <span class="n">itemtools</span><span class="o">.</span><span class="n">AddItem</span><span class="p">,</span>
    <span class="s2">&quot;getitems&quot;</span><span class="p">:</span> <span class="n">itemtools</span><span class="o">.</span><span class="n">GetItem</span><span class="p">,</span>
<span class="p">}</span>


<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">find</span><span class="p">(</span>
    <span class="n">root</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">optional</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Optional version of function |find|.&quot;&quot;&quot;</span>


<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">find</span><span class="p">(</span>
    <span class="n">root</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">optional</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="kc">False</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Non-optional version of function |find|.&quot;&quot;&quot;</span>


<div class="viewcode-block" id="find"><a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.find">[docs]</a><span class="k">def</span> <span class="nf">find</span><span class="p">(</span>
    <span class="n">root</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">optional</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Return the first XML element with the given name found in the given</span>
<span class="sd">    XML root.</span>

<span class="sd">    &gt;&gt;&gt; from hydpy.auxs.xmltools import find, XMLInterface</span>
<span class="sd">    &gt;&gt;&gt; from hydpy.data import make_filepath</span>
<span class="sd">    &gt;&gt;&gt; interface = XMLInterface(&quot;single_run.xml&quot;, make_filepath(&quot;LahnH&quot;))</span>
<span class="sd">    &gt;&gt;&gt; find(interface.root, &quot;timegrid&quot;).tag.endswith(&quot;timegrid&quot;)</span>
<span class="sd">    True</span>

<span class="sd">    By default, function |find| returns |None| in case the required element</span>
<span class="sd">    is missing:</span>

<span class="sd">    &gt;&gt;&gt; find(interface.root, &quot;wrong&quot;)</span>

<span class="sd">    Set the argument `optional` to |False| to let function |find| raise</span>
<span class="sd">    errors instead:</span>

<span class="sd">    &gt;&gt;&gt; find(interface.root, &quot;wrong&quot;, optional=False)</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    AttributeError: The actual XML element `config` does not define \</span>
<span class="sd">a XML subelement named `wrong`.  Please make sure your XML file \</span>
<span class="sd">follows the relevant XML schema.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">element</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">namespace</span><span class="si">}{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">element</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">optional</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;The actual XML element `</span><span class="si">{</span><span class="n">root</span><span class="o">.</span><span class="n">tag</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;}&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">` does &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;not define a XML subelement named `</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">`.  Please make &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;sure your XML file follows the relevant XML schema.&quot;</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">element</span></div>


<span class="k">def</span> <span class="nf">_query_selections</span><span class="p">(</span><span class="n">xmlelement</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">selectiontools</span><span class="o">.</span><span class="n">Selections</span><span class="p">:</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">xmlelement</span><span class="o">.</span><span class="n">text</span>
    <span class="k">if</span> <span class="n">text</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">selectiontools</span><span class="o">.</span><span class="n">Selections</span><span class="p">()</span>
    <span class="n">selections</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">selections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">selections</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The XML configuration file tries to define a selection &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;using the text `</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">`, but the actual project does not &quot;</span>
                <span class="sa">f</span><span class="s2">&quot; handle such a `Selection` object.&quot;</span>
            <span class="p">)</span> <span class="kn">from</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="n">selectiontools</span><span class="o">.</span><span class="n">Selections</span><span class="p">(</span><span class="o">*</span><span class="n">selections</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_query_devices</span><span class="p">(</span><span class="n">xmlelement</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">selectiontools</span><span class="o">.</span><span class="n">Selection</span><span class="p">:</span>
    <span class="n">selection</span> <span class="o">=</span> <span class="n">selectiontools</span><span class="o">.</span><span class="n">Selection</span><span class="p">(</span><span class="s2">&quot;temporary_result_of_xml_parsing&quot;</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">xmlelement</span><span class="o">.</span><span class="n">text</span>
    <span class="k">if</span> <span class="n">text</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">selection</span>
    <span class="n">elements</span> <span class="o">=</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">selections</span><span class="o">.</span><span class="n">complete</span><span class="o">.</span><span class="n">elements</span>
    <span class="n">nodes</span> <span class="o">=</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">selections</span><span class="o">.</span><span class="n">complete</span><span class="o">.</span><span class="n">nodes</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">selection</span><span class="o">.</span><span class="n">elements</span> <span class="o">+=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">selection</span><span class="o">.</span><span class="n">nodes</span> <span class="o">+=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;The XML configuration file tries to define additional &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;devices using the text `</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">`, but the complete &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;selection of the actual project does neither handle a &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;`Node` or `Element` object with such a name or keyword.&quot;</span>
                <span class="p">)</span> <span class="kn">from</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="n">selection</span>


<div class="viewcode-block" id="strip"><a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.strip">[docs]</a><span class="k">def</span> <span class="nf">strip</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Remove the XML namespace from the given string and return it.</span>

<span class="sd">    &gt;&gt;&gt; from hydpy.auxs.xmltools import strip</span>
<span class="sd">    &gt;&gt;&gt; strip(&quot;{https://github.com/something.xsd}something&quot;)</span>
<span class="sd">    &#39;something&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;}&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></div>


<div class="viewcode-block" id="run_simulation"><a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.run_simulation">[docs]</a><span class="k">def</span> <span class="nf">run_simulation</span><span class="p">(</span><span class="n">projectname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">xmlfile</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Perform a HydPy workflow in agreement with the given XML configuration</span>
<span class="sd">    file available in the directory of the given project. ToDo</span>

<span class="sd">    Function |run_simulation| is a &quot;script function&quot; and is normally used as</span>
<span class="sd">    explained in the main documentation on module |xmltools|.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">write</span> <span class="o">=</span> <span class="n">commandtools</span><span class="o">.</span><span class="n">print_textandtime</span>
    <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">printprogress</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Start HydPy project `</span><span class="si">{</span><span class="n">projectname</span><span class="si">}</span><span class="s2">`&quot;</span><span class="p">)</span>
    <span class="n">hp</span> <span class="o">=</span> <span class="n">hydpytools</span><span class="o">.</span><span class="n">HydPy</span><span class="p">(</span><span class="n">projectname</span><span class="p">)</span>
    <span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Read configuration file `</span><span class="si">{</span><span class="n">xmlfile</span><span class="si">}</span><span class="s2">`&quot;</span><span class="p">)</span>
    <span class="n">interface</span> <span class="o">=</span> <span class="n">XMLInterface</span><span class="p">(</span><span class="n">xmlfile</span><span class="p">)</span>
    <span class="n">write</span><span class="p">(</span><span class="s2">&quot;Interpret the defined options&quot;</span><span class="p">)</span>
    <span class="n">interface</span><span class="o">.</span><span class="n">update_options</span><span class="p">()</span>
    <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">printprogress</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">write</span><span class="p">(</span><span class="s2">&quot;Interpret the defined period&quot;</span><span class="p">)</span>
    <span class="n">interface</span><span class="o">.</span><span class="n">update_timegrids</span><span class="p">()</span>
    <span class="n">write</span><span class="p">(</span><span class="s2">&quot;Read all network files&quot;</span><span class="p">)</span>
    <span class="n">hp</span><span class="o">.</span><span class="n">prepare_network</span><span class="p">()</span>
    <span class="n">write</span><span class="p">(</span><span class="s2">&quot;Activate the selected network&quot;</span><span class="p">)</span>
    <span class="n">hp</span><span class="o">.</span><span class="n">update_devices</span><span class="p">(</span>
        <span class="n">selection</span><span class="o">=</span><span class="n">interface</span><span class="o">.</span><span class="n">fullselection</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">write</span><span class="p">(</span><span class="s2">&quot;Read the required control files&quot;</span><span class="p">)</span>
    <span class="n">hp</span><span class="o">.</span><span class="n">prepare_models</span><span class="p">()</span>
    <span class="n">write</span><span class="p">(</span><span class="s2">&quot;Read the required condition files&quot;</span><span class="p">)</span>
    <span class="n">interface</span><span class="o">.</span><span class="n">conditions_io</span><span class="o">.</span><span class="n">load_conditions</span><span class="p">()</span>
    <span class="n">write</span><span class="p">(</span><span class="s2">&quot;Read the required time series files&quot;</span><span class="p">)</span>
    <span class="n">interface</span><span class="o">.</span><span class="n">series_io</span><span class="o">.</span><span class="n">prepare_series</span><span class="p">()</span>
    <span class="n">interface</span><span class="o">.</span><span class="n">series_io</span><span class="o">.</span><span class="n">load_series</span><span class="p">()</span>
    <span class="n">write</span><span class="p">(</span><span class="s2">&quot;Perform the simulation run&quot;</span><span class="p">)</span>
    <span class="n">hp</span><span class="o">.</span><span class="n">simulate</span><span class="p">()</span>
    <span class="n">write</span><span class="p">(</span><span class="s2">&quot;Write the desired condition files&quot;</span><span class="p">)</span>
    <span class="n">interface</span><span class="o">.</span><span class="n">conditions_io</span><span class="o">.</span><span class="n">save_conditions</span><span class="p">()</span>
    <span class="n">write</span><span class="p">(</span><span class="s2">&quot;Write the desired time series files&quot;</span><span class="p">)</span>
    <span class="n">interface</span><span class="o">.</span><span class="n">series_io</span><span class="o">.</span><span class="n">save_series</span><span class="p">()</span></div>


<div class="viewcode-block" id="XMLBase"><a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLBase">[docs]</a><span class="k">class</span> <span class="nc">XMLBase</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Base class for the concrete classes |XMLInterface|, |XMLConditions|,</span>
<span class="sd">    |XMLSeries|, and |XMLSubseries|.</span>

<span class="sd">    Subclasses of |XMLBase| support iterating XML subelements, while</span>
<span class="sd">    skipping those named `selections` or `devices`:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy.auxs.xmltools import XMLInterface</span>
<span class="sd">    &gt;&gt;&gt; from hydpy.data import make_filepath</span>
<span class="sd">    &gt;&gt;&gt; interface = XMLInterface(&quot;multiple_runs.xml&quot;, make_filepath(&quot;LahnH&quot;))</span>
<span class="sd">    &gt;&gt;&gt; itemgroup = interface.exchange.itemgroups[1]</span>
<span class="sd">    &gt;&gt;&gt; for element in itemgroup:</span>
<span class="sd">    ...     print(strip(element.tag))</span>
<span class="sd">    hland_v1</span>
<span class="sd">    &gt;&gt;&gt; for element in itemgroup.models[0].subvars[0].vars[0]:</span>
<span class="sd">    ...     print(strip(element.tag))</span>
<span class="sd">    alias</span>
<span class="sd">    dim</span>
<span class="sd">    init</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">root</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Apply function |strip| to the root of the object of the |XMLBase|</span>
<span class="sd">        subclass.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XMLInterface</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.data import make_filepath</span>
<span class="sd">        &gt;&gt;&gt; interface = XMLInterface(&quot;single_run.xml&quot;, make_filepath(&quot;LahnH&quot;))</span>
<span class="sd">        &gt;&gt;&gt; interface.name</span>
<span class="sd">        &#39;config&#39;</span>
<span class="sd">        &gt;&gt;&gt; interface.series_io.readers[0].name</span>
<span class="sd">        &#39;reader&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">strip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>

    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="nf">find</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">optional</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Optional version of method |XMLBase.find|.&quot;&quot;&quot;</span>

    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="nf">find</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">optional</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="kc">False</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Non-optional version of function |XMLBase.find|.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="XMLBase.find"><a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLBase.find">[docs]</a>    <span class="k">def</span> <span class="nf">find</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">optional</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Apply function |find| to the root of the object of the |XMLBase|</span>
<span class="sd">        subclass.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XMLInterface</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.data import make_filepath</span>
<span class="sd">        &gt;&gt;&gt; interface = XMLInterface(&quot;single_run.xml&quot;, make_filepath(&quot;LahnH&quot;))</span>
<span class="sd">        &gt;&gt;&gt; interface.find(&quot;timegrid&quot;).tag.endswith(&quot;timegrid&quot;)</span>
<span class="sd">        True</span>

<span class="sd">        &gt;&gt;&gt; interface.find(&quot;wrong&quot;)</span>

<span class="sd">        &gt;&gt;&gt; interface.find(&quot;wrong&quot;, optional=False)</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        AttributeError: The actual XML element `config` does not define \</span>
<span class="sd">a XML subelement named `wrong`.  Please make sure your XML file \</span>
<span class="sd">follows the relevant XML schema.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">find</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">optional</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">strip</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;selections&quot;</span><span class="p">,</span> <span class="s2">&quot;devices&quot;</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">element</span></div>


<div class="viewcode-block" id="XMLInterface"><a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLInterface">[docs]</a><span class="k">class</span> <span class="nc">XMLInterface</span><span class="p">(</span><span class="n">XMLBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An interface to XML configuration files that are valid concerning</span>
<span class="sd">     schema file `HydPyConfigSingleRun.xsd` or `HydPyConfigMultipleRuns.xsd`.</span>

<span class="sd">    &gt;&gt;&gt; from hydpy.auxs.xmltools import XMLInterface</span>
<span class="sd">    &gt;&gt;&gt; from hydpy.data import make_filepath</span>
<span class="sd">    &gt;&gt;&gt; interface = XMLInterface(&quot;single_run.xml&quot;, make_filepath(&quot;LahnH&quot;))</span>
<span class="sd">    &gt;&gt;&gt; interface.root.tag</span>
<span class="sd">    &#39;{https://github.com/hydpy-dev/hydpy/releases/download/your-hydpy-version/\</span>
<span class="sd">HydPyConfigSingleRun.xsd}config&#39;</span>
<span class="sd">    &gt;&gt;&gt; interface = XMLInterface(&#39;multiple_runs.xml&#39;, make_filepath(&#39;LahnH&#39;))</span>
<span class="sd">    &gt;&gt;&gt; interface.root.tag</span>
<span class="sd">    &#39;{https://github.com/hydpy-dev/hydpy/releases/download/your-hydpy-version/\</span>
<span class="sd">HydPyConfigMultipleRuns.xsd}config&#39;</span>
<span class="sd">    &gt;&gt;&gt; XMLInterface(&#39;wrongfilepath.xml&#39;, &#39;wrongdir&#39;)    # doctest: +ELLIPSIS</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    FileNotFoundError: While trying to parse the XML configuration \</span>
<span class="sd">file ...wrongfilepath.xml, the following error occurred: \</span>
<span class="sd">[Errno 2] No such file or directory: &#39;...wrongfilepath.xml&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">directory</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">directory</span> <span class="o">=</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">projectname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">filename</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">)</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
            <span class="n">objecttools</span><span class="o">.</span><span class="n">augment_excmessage</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;While trying to parse the XML configuration file &quot;</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

<div class="viewcode-block" id="XMLInterface.validate_xml"><a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLInterface.validate_xml">[docs]</a>    <span class="k">def</span> <span class="nf">validate_xml</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Raise an error if the actual XML does not agree with one of the</span>
<span class="sd">        available schema files.</span>

<span class="sd">        # ToDo: should it be accompanied by a script function?</span>

<span class="sd">        The first example relies on a distorted version of the configuration</span>
<span class="sd">        file `single_run.xml`:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.examples import prepare_full_example_1</span>
<span class="sd">        &gt;&gt;&gt; prepare_full_example_1()</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import TestIO, xml_replace</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XMLInterface</span>
<span class="sd">        &gt;&gt;&gt; import os</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():    # doctest: +ELLIPSIS</span>
<span class="sd">        ...     xml_replace(&quot;LahnH/single_run&quot;,</span>
<span class="sd">        ...                 firstdate=&quot;1996-01-32T00:00:00&quot;)</span>
<span class="sd">        template file: LahnH/single_run.xmlt</span>
<span class="sd">        target file: LahnH/single_run.xml</span>
<span class="sd">        replacements:</span>
<span class="sd">          config_start --&gt; &lt;...HydPyConfigBase.xsd&quot;</span>
<span class="sd">                      ...HydPyConfigSingleRun.xsd&quot;&gt; (default argument)</span>
<span class="sd">          firstdate --&gt; 1996-01-32T00:00:00 (given argument)</span>
<span class="sd">          zip_ --&gt; false (default argument)</span>
<span class="sd">          zip_ --&gt; false (default argument)</span>
<span class="sd">          config_end --&gt; &lt;/hpcsr:config&gt; (default argument)</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     interface = XMLInterface(&quot;single_run.xml&quot;, &quot;LahnH&quot;)</span>
<span class="sd">        &gt;&gt;&gt; interface.validate_xml()    # doctest: +ELLIPSIS</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        xmlschema.validators.exceptions.XMLSchemaDecodeError: While trying to \</span>
<span class="sd">validate XML file `...single_run.xml`, the following error occurred: failed \</span>
<span class="sd">validating &#39;1996-01-32T00:00:00&#39; with XsdAtomicBuiltin(name=&#39;xs:dateTime&#39;)...</span>
<span class="sd">        ...</span>
<span class="sd">        Reason: day is out of range for month</span>
<span class="sd">        ...</span>
<span class="sd">        Schema:</span>
<span class="sd">        ...</span>
<span class="sd">        Instance:</span>
<span class="sd">        ...</span>
<span class="sd">          &lt;firstdate xmlns=&quot;https://github.com/hydpy-dev/hydpy/releases/\</span>
<span class="sd">download/your-hydpy-version/HydPyConfigBase.xsd&quot;&gt;1996-01-32T00:00:00&lt;/firstdate&gt;</span>
<span class="sd">        ...</span>
<span class="sd">        Path: /hpcsr:config/timegrid/firstdate</span>
<span class="sd">        ...</span>

<span class="sd">        In the second example, we examine a correct configuration file:</span>

<span class="sd">        &gt;&gt;&gt; with TestIO():    # doctest: +ELLIPSIS</span>
<span class="sd">        ...     xml_replace(&quot;LahnH/single_run&quot;)</span>
<span class="sd">        ...     interface = XMLInterface(&quot;single_run.xml&quot;, &quot;LahnH&quot;)</span>
<span class="sd">        template file: LahnH/single_run.xmlt</span>
<span class="sd">        target file: LahnH/single_run.xml</span>
<span class="sd">        replacements:</span>
<span class="sd">          config_start --&gt; &lt;...HydPyConfigBase.xsd&quot;</span>
<span class="sd">                      ...HydPyConfigSingleRun.xsd&quot;&gt; (default argument)</span>
<span class="sd">          firstdate --&gt; 1996-01-01T00:00:00 (default argument)</span>
<span class="sd">          zip_ --&gt; false (default argument)</span>
<span class="sd">          zip_ --&gt; false (default argument)</span>
<span class="sd">          config_end --&gt; &lt;/hpcsr:config&gt; (default argument)</span>
<span class="sd">        &gt;&gt;&gt; interface.validate_xml()</span>

<span class="sd">        The XML configuration file must correctly refer to the corresponding</span>
<span class="sd">        schema file:</span>

<span class="sd">        &gt;&gt;&gt; with TestIO():    # doctest: +ELLIPSIS</span>
<span class="sd">        ...     xml_replace(&quot;LahnH/single_run&quot;,</span>
<span class="sd">        ...                 config_start=&quot;&lt;config&gt;&quot;,</span>
<span class="sd">        ...                 config_end=&quot;&lt;/config&gt;&quot;)</span>
<span class="sd">        ...     interface = XMLInterface(&quot;single_run.xml&quot;, &quot;LahnH&quot;)</span>
<span class="sd">        template file: LahnH/single_run.xmlt</span>
<span class="sd">        target file: LahnH/single_run.xml</span>
<span class="sd">        replacements:</span>
<span class="sd">          config_start --&gt; &lt;config&gt; (given argument)</span>
<span class="sd">          firstdate --&gt; 1996-01-01T00:00:00 (default argument)</span>
<span class="sd">          zip_ --&gt; false (default argument)</span>
<span class="sd">          zip_ --&gt; false (default argument)</span>
<span class="sd">          config_end --&gt; &lt;/config&gt; (given argument)</span>
<span class="sd">        &gt;&gt;&gt; interface.validate_xml()    # doctest: +ELLIPSIS</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        RuntimeError: While trying to validate XML file `...single_run.xml`, \</span>
<span class="sd">the following error occurred: Configuration file `single_run.xml` does not \</span>
<span class="sd">correctly refer to one of the available XML schema files \</span>
<span class="sd">(HydPyConfigSingleRun.xsd and HydPyConfigMultipleRuns.xsd).</span>

<span class="sd">        XML files based on `HydPyConfigMultipleRuns.xsd` can be validated</span>
<span class="sd">        as well:</span>

<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     interface = XMLInterface(&quot;multiple_runs.xml&quot;, &quot;LahnH&quot;)</span>
<span class="sd">        &gt;&gt;&gt; interface.validate_xml()    # doctest: +ELLIPSIS</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">filenames</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;HydPyConfigSingleRun.xsd&quot;</span><span class="p">,</span> <span class="s2">&quot;HydPyConfigMultipleRuns.xsd&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">tag</span><span class="p">:</span>
                    <span class="n">schemafile</span> <span class="o">=</span> <span class="n">name</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Configuration file `</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">` &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;does not correctly refer to one of the available XML &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;schema files (</span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">enumeration</span><span class="p">(</span><span class="n">filenames</span><span class="p">)</span><span class="si">}</span><span class="s2">).&quot;</span>
                <span class="p">)</span>
            <span class="n">confpath</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">__path__</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># type: ignore[attr-defined, name-defined] # pylint: disable=line-too-long</span>
            <span class="n">schemapath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">confpath</span><span class="p">,</span> <span class="n">schemafile</span><span class="p">)</span>
            <span class="n">schema</span> <span class="o">=</span> <span class="n">xmlschema</span><span class="o">.</span><span class="n">XMLSchema</span><span class="p">(</span><span class="n">schemapath</span><span class="p">)</span>
            <span class="n">schema</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
            <span class="n">objecttools</span><span class="o">.</span><span class="n">augment_excmessage</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;While trying to validate XML file `</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="si">}</span><span class="s2">`&quot;</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="XMLInterface.update_options"><a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLInterface.update_options">[docs]</a>    <span class="k">def</span> <span class="nf">update_options</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Update the |Options| object available in module |pub| with the</span>
<span class="sd">        values defined in the `options` XML element.</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">            &gt;&gt;&gt; del pub.options.simulationstep</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XMLInterface</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.data import make_filepath</span>
<span class="sd">        &gt;&gt;&gt; interface = XMLInterface(&quot;single_run.xml&quot;, make_filepath(&quot;LahnH&quot;))</span>
<span class="sd">        &gt;&gt;&gt; pub.options.ellipsis = 0</span>
<span class="sd">        &gt;&gt;&gt; pub.options.parameterstep = &quot;1h&quot;</span>
<span class="sd">        &gt;&gt;&gt; pub.options.printprogress = True</span>
<span class="sd">        &gt;&gt;&gt; pub.options.printincolor = True</span>
<span class="sd">        &gt;&gt;&gt; pub.options.reprdigits = -1</span>
<span class="sd">        &gt;&gt;&gt; pub.options.utcoffset = -60</span>
<span class="sd">        &gt;&gt;&gt; pub.options.warnsimulationstep = 0</span>
<span class="sd">        &gt;&gt;&gt; interface.update_options()</span>
<span class="sd">        &gt;&gt;&gt; pub.options</span>
<span class="sd">        Options(</span>
<span class="sd">            autocompile -&gt; 1</span>
<span class="sd">            checkseries -&gt; 1</span>
<span class="sd">            dirverbose -&gt; 0</span>
<span class="sd">            ellipsis -&gt; 0</span>
<span class="sd">            flattennetcdf -&gt; 1</span>
<span class="sd">            forcecompiling -&gt; 0</span>
<span class="sd">            isolatenetcdf -&gt; 1</span>
<span class="sd">            parameterstep -&gt; Period(&quot;1d&quot;)</span>
<span class="sd">            printprogress -&gt; 0</span>
<span class="sd">            printincolor -&gt; 0</span>
<span class="sd">            reprcomments -&gt; 0</span>
<span class="sd">            reprdigits -&gt; 6</span>
<span class="sd">            simulationstep -&gt; Period()</span>
<span class="sd">            skipdoctests -&gt; 0</span>
<span class="sd">            timeaxisnetcdf -&gt; 0</span>
<span class="sd">            trimvariables -&gt; 1</span>
<span class="sd">            usecython -&gt; 1</span>
<span class="sd">            usedefaultvalues -&gt; 0</span>
<span class="sd">            utclongitude -&gt; 15</span>
<span class="sd">            utcoffset -&gt; 60</span>
<span class="sd">            warnmissingcontrolfile -&gt; 0</span>
<span class="sd">            warnmissingobsfile -&gt; 1</span>
<span class="sd">            warnmissingsimfile -&gt; 1</span>
<span class="sd">            warnsimulationstep -&gt; 0</span>
<span class="sd">            warntrim -&gt; 1</span>
<span class="sd">        )</span>
<span class="sd">        &gt;&gt;&gt; pub.options.printprogress = False</span>
<span class="sd">        &gt;&gt;&gt; pub.options.reprdigits = 6</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">options</span> <span class="o">=</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">options</span>
        <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;options&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">option</span><span class="o">.</span><span class="n">text</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="s2">&quot;false&quot;</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">strip</span><span class="p">(</span><span class="n">option</span><span class="o">.</span><span class="n">tag</span><span class="p">),</span> <span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">strip</span><span class="p">(</span><span class="n">option</span><span class="o">.</span><span class="n">tag</span><span class="p">),</span> <span class="n">value</span><span class="p">)</span>
        <span class="n">options</span><span class="o">.</span><span class="n">printprogress</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">options</span><span class="o">.</span><span class="n">printincolor</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="XMLInterface.update_timegrids"><a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLInterface.update_timegrids">[docs]</a>    <span class="k">def</span> <span class="nf">update_timegrids</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Update the |Timegrids| object available in module |pub| with the</span>
<span class="sd">        values defined in the `timegrid` XML element.</span>

<span class="sd">        Usually, one would prefer to define `firstdate`, `lastdate`, and</span>
<span class="sd">        `stepsize` elements as in the XML configuration file of the</span>
<span class="sd">        `LahnH` example project:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.examples import prepare_full_example_1</span>
<span class="sd">        &gt;&gt;&gt; prepare_full_example_1()</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import HydPy, pub, TestIO</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XMLInterface</span>

<span class="sd">        &gt;&gt;&gt; hp = HydPy(&quot;LahnH&quot;)</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     hp.prepare_network()</span>
<span class="sd">        ...     XMLInterface(&quot;single_run.xml&quot;).update_timegrids()</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids</span>
<span class="sd">        Timegrids(&quot;1996-01-01T00:00:00&quot;,</span>
<span class="sd">                  &quot;1996-01-06T00:00:00&quot;,</span>
<span class="sd">                  &quot;1d&quot;)</span>

<span class="sd">        Alternatively, one can provide the file path to a `seriesfile`,</span>
<span class="sd">        which must be a valid NetCDF file.  The |XMLInterface| object</span>
<span class="sd">        then interprets the file&#39;s time information:</span>

<span class="sd">        &gt;&gt;&gt; name = &quot;LahnH/series/input/hland_v1_input_p.nc&quot;</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     with open(&quot;LahnH/single_run.xml&quot;) as file_:</span>
<span class="sd">        ...         lines = file_.readlines()</span>
<span class="sd">        ...     for idx, line in enumerate(lines):</span>
<span class="sd">        ...         if &quot;&lt;timegrid&gt;&quot; in line:</span>
<span class="sd">        ...             break</span>
<span class="sd">        ...     with open(&quot;LahnH/single_run.xml&quot;, &quot;w&quot;) as file_:</span>
<span class="sd">        ...         _ = file_.write(&quot;&quot;.join(lines[:idx+1]))</span>
<span class="sd">        ...         _ = file_.write(</span>
<span class="sd">        ...             f&quot;        &lt;seriesfile&gt;{name}&lt;/seriesfile&gt;\\n&quot;)</span>
<span class="sd">        ...         _ = file_.write(&quot;&quot;.join(lines[idx+4:]))</span>
<span class="sd">        ...     XMLInterface(&quot;single_run.xml&quot;).update_timegrids()</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids</span>
<span class="sd">        Timegrids(&quot;1996-01-01 00:00:00&quot;,</span>
<span class="sd">                  &quot;2007-01-01 00:00:00&quot;,</span>
<span class="sd">                  &quot;1d&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">timegrid_xml</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;timegrid&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">timegrids</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">timegrid_xml</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
                <span class="n">timegrid_xml</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
                <span class="n">timegrid_xml</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="n">seriesfile</span> <span class="o">=</span> <span class="n">find</span><span class="p">(</span><span class="n">timegrid_xml</span><span class="p">,</span> <span class="s2">&quot;seriesfile&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
            <span class="k">with</span> <span class="n">netcdf4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">seriesfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">ncfile</span><span class="p">:</span>
                <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">timegrids</span> <span class="o">=</span> <span class="n">timetools</span><span class="o">.</span><span class="n">Timegrids</span><span class="p">(</span>
                    <span class="n">netcdftools</span><span class="o">.</span><span class="n">query_timegrid</span><span class="p">(</span><span class="n">ncfile</span><span class="p">)</span>
                <span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">selections</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">selectiontools</span><span class="o">.</span><span class="n">Selections</span><span class="p">:</span>
        <span class="c1"># noinspection PyUnresolvedReferences</span>
        <span class="sd">&quot;&quot;&quot;The |Selections| object defined on the main level of the actual</span>
<span class="sd">        XML file.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.examples import prepare_full_example_1</span>
<span class="sd">        &gt;&gt;&gt; prepare_full_example_1()</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import HydPy, TestIO, XMLInterface</span>
<span class="sd">        &gt;&gt;&gt; hp = HydPy(&quot;LahnH&quot;)</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     hp.prepare_network()</span>
<span class="sd">        ...     interface = XMLInterface(&quot;single_run.xml&quot;)</span>
<span class="sd">        &gt;&gt;&gt; interface.find(&quot;selections&quot;).text = &quot;headwaters streams&quot;</span>
<span class="sd">        &gt;&gt;&gt; selections = interface.selections</span>
<span class="sd">        &gt;&gt;&gt; for selection in selections:</span>
<span class="sd">        ...     print(selection.name)</span>
<span class="sd">        headwaters</span>
<span class="sd">        streams</span>
<span class="sd">        &gt;&gt;&gt; selections.headwaters</span>
<span class="sd">        Selection(&quot;headwaters&quot;,</span>
<span class="sd">                  nodes=(&quot;dill&quot;, &quot;lahn_1&quot;),</span>
<span class="sd">                  elements=(&quot;land_dill&quot;, &quot;land_lahn_1&quot;))</span>
<span class="sd">        &gt;&gt;&gt; interface.find(&quot;selections&quot;).text = &quot;head_waters&quot;</span>
<span class="sd">        &gt;&gt;&gt; interface.selections</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        NameError: The XML configuration file tries to define a selection \</span>
<span class="sd">using the text `head_waters`, but the actual project does not  handle such \</span>
<span class="sd">a `Selection` object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_query_selections</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;selections&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">devices</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">selectiontools</span><span class="o">.</span><span class="n">Selection</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;The additional devices defined on the main level of the actual</span>
<span class="sd">        XML file collected by a |Selection| object.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.examples import prepare_full_example_1</span>
<span class="sd">        &gt;&gt;&gt; prepare_full_example_1()</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import HydPy, TestIO, XMLInterface</span>
<span class="sd">        &gt;&gt;&gt; hp = HydPy(&quot;LahnH&quot;)</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     hp.prepare_network()</span>
<span class="sd">        ...     interface = XMLInterface(&quot;single_run.xml&quot;)</span>
<span class="sd">        &gt;&gt;&gt; interface.devices</span>
<span class="sd">        Selection(&quot;temporary_result_of_xml_parsing&quot;,</span>
<span class="sd">                  nodes=&quot;dill&quot;,</span>
<span class="sd">                  elements=(&quot;land_dill&quot;, &quot;land_lahn_1&quot;))</span>
<span class="sd">        &gt;&gt;&gt; interface.find(&quot;devices&quot;).text = &quot;land_lahn1&quot;</span>
<span class="sd">        &gt;&gt;&gt; interface.devices</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        NameError: The XML configuration file tries to define additional \</span>
<span class="sd">devices using the text `land_lahn1`, but the complete selection of the \</span>
<span class="sd">actual project does neither handle a `Node` or `Element` object with such \</span>
<span class="sd">a name or keyword.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_query_devices</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;devices&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">elements</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">devicetools</span><span class="o">.</span><span class="n">Element</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Yield all |Element| objects returned by |XMLInterface.selections|</span>
<span class="sd">        and |XMLInterface.devices| without duplicates.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.examples import prepare_full_example_1</span>
<span class="sd">        &gt;&gt;&gt; prepare_full_example_1()</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import HydPy, TestIO, XMLInterface</span>
<span class="sd">        &gt;&gt;&gt; hp = HydPy(&quot;LahnH&quot;)</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     hp.prepare_network()</span>
<span class="sd">        ...     interface = XMLInterface(&quot;single_run.xml&quot;)</span>
<span class="sd">        &gt;&gt;&gt; interface.find(&quot;selections&quot;).text = &quot;headwaters streams&quot;</span>
<span class="sd">        &gt;&gt;&gt; for element in interface.elements:</span>
<span class="sd">        ...      print(element.name)</span>
<span class="sd">        land_dill</span>
<span class="sd">        land_lahn_1</span>
<span class="sd">        stream_dill_lahn_2</span>
<span class="sd">        stream_lahn_1_lahn_2</span>
<span class="sd">        stream_lahn_2_lahn_3</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">selections</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">)</span>
        <span class="n">selections</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">devices</span>
        <span class="n">elements</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">devicetools</span><span class="o">.</span><span class="n">Element</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">selection</span> <span class="ow">in</span> <span class="n">selections</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">selection</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">element</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
                    <span class="n">elements</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
                    <span class="k">yield</span> <span class="n">element</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fullselection</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">selectiontools</span><span class="o">.</span><span class="n">Selection</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;A |Selection| object containing all |Element| and |Node| objects</span>
<span class="sd">        defined by |XMLInterface.selections| and |XMLInterface.devices|.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.examples import prepare_full_example_1</span>
<span class="sd">        &gt;&gt;&gt; prepare_full_example_1()</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import HydPy, TestIO, XMLInterface</span>
<span class="sd">        &gt;&gt;&gt; hp = HydPy(&quot;LahnH&quot;)</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     hp.prepare_network()</span>
<span class="sd">        ...     interface = XMLInterface(&quot;single_run.xml&quot;)</span>
<span class="sd">        &gt;&gt;&gt; interface.find(&quot;selections&quot;).text = &quot;nonheadwaters&quot;</span>
<span class="sd">        &gt;&gt;&gt; interface.fullselection</span>
<span class="sd">        Selection(&quot;fullselection&quot;,</span>
<span class="sd">                  nodes=(&quot;dill&quot;, &quot;lahn_2&quot;, &quot;lahn_3&quot;),</span>
<span class="sd">                  elements=(&quot;land_dill&quot;, &quot;land_lahn_1&quot;, &quot;land_lahn_2&quot;,</span>
<span class="sd">                            &quot;land_lahn_3&quot;))</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fullselection</span> <span class="o">=</span> <span class="n">selectiontools</span><span class="o">.</span><span class="n">Selection</span><span class="p">(</span><span class="s2">&quot;fullselection&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">selection</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">:</span>
            <span class="n">fullselection</span> <span class="o">+=</span> <span class="n">selection</span>
        <span class="n">fullselection</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">devices</span>
        <span class="k">return</span> <span class="n">fullselection</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">conditions_io</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;XMLConditions&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;The `condition_io` element defined in the actual XML file.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XMLInterface, strip</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.data import make_filepath</span>
<span class="sd">        &gt;&gt;&gt; interface = XMLInterface(&quot;single_run.xml&quot;, make_filepath(&quot;LahnH&quot;))</span>
<span class="sd">        &gt;&gt;&gt; strip(interface.series_io.root.tag)</span>
<span class="sd">        &#39;series_io&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">XMLConditions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;conditions_io&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">series_io</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;XMLSeries&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;The `series_io` element defined in the actual XML file.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XMLInterface, strip</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.data import make_filepath</span>
<span class="sd">        &gt;&gt;&gt; interface = XMLInterface(&quot;single_run.xml&quot;, make_filepath(&quot;LahnH&quot;))</span>
<span class="sd">        &gt;&gt;&gt; strip(interface.series_io.root.tag)</span>
<span class="sd">        &#39;series_io&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">XMLSeries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;series_io&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">exchange</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;XMLExchange&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;The `exchange` element defined in the actual XML file.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XMLInterface, strip</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.data import make_filepath</span>
<span class="sd">        &gt;&gt;&gt; interface = XMLInterface(</span>
<span class="sd">        ...     &quot;multiple_runs.xml&quot;, make_filepath(&quot;LahnH&quot;))</span>
<span class="sd">        &gt;&gt;&gt; strip(interface.exchange.root.tag)</span>
<span class="sd">        &#39;exchange&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">XMLExchange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;exchange&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span></div>


<div class="viewcode-block" id="XMLConditions"><a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLConditions">[docs]</a><span class="k">class</span> <span class="nc">XMLConditions</span><span class="p">(</span><span class="n">XMLBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Helper class for |XMLInterface| responsible for loading and</span>
<span class="sd">    saving initial conditions.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">master</span><span class="p">:</span> <span class="n">XMLInterface</span><span class="p">,</span> <span class="n">root</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="p">:</span> <span class="n">XMLInterface</span> <span class="o">=</span> <span class="n">master</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span> <span class="o">=</span> <span class="n">root</span>

<div class="viewcode-block" id="XMLConditions.load_conditions"><a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLConditions.load_conditions">[docs]</a>    <span class="k">def</span> <span class="nf">load_conditions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Load the condition files of the |Model| objects of all |Element|</span>
<span class="sd">        objects returned by |XMLInterface.elements|:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.examples import prepare_full_example_1</span>
<span class="sd">        &gt;&gt;&gt; prepare_full_example_1()</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import HydPy, pub, TestIO, XMLInterface</span>
<span class="sd">        &gt;&gt;&gt; hp = HydPy(&quot;LahnH&quot;)</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;1996-01-01&quot;, &quot;1996-01-06&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     hp.prepare_network()</span>
<span class="sd">        ...     hp.prepare_models()</span>
<span class="sd">        ...     interface = XMLInterface(&quot;single_run.xml&quot;)</span>
<span class="sd">        ...     interface.find(&quot;selections&quot;).text = &quot;headwaters&quot;</span>
<span class="sd">        ...     interface.conditions_io.load_conditions()</span>
<span class="sd">        &gt;&gt;&gt; hp.elements.land_lahn_1.model.sequences.states.lz</span>
<span class="sd">        lz(8.18711)</span>
<span class="sd">        &gt;&gt;&gt; hp.elements.land_lahn_2.model.sequences.states.lz</span>
<span class="sd">        lz(nan)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">conditionmanager</span><span class="o">.</span><span class="n">currentdir</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;inputdir&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
            <span class="n">element</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">load_conditions</span><span class="p">()</span></div>

<div class="viewcode-block" id="XMLConditions.save_conditions"><a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLConditions.save_conditions">[docs]</a>    <span class="k">def</span> <span class="nf">save_conditions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Save the condition files of the |Model| objects of all |Element|</span>
<span class="sd">        objects returned by |XMLInterface.elements|:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.examples import prepare_full_example_1</span>
<span class="sd">        &gt;&gt;&gt; prepare_full_example_1()</span>

<span class="sd">        &gt;&gt;&gt; import os</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import HydPy, pub, TestIO, XMLInterface</span>
<span class="sd">        &gt;&gt;&gt; hp = HydPy(&quot;LahnH&quot;)</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;1996-01-01&quot;, &quot;1996-01-06&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     hp.prepare_network()</span>
<span class="sd">        ...     hp.prepare_models()</span>
<span class="sd">        ...     hp.elements.land_dill.model.sequences.states.lz = 999.0</span>
<span class="sd">        ...     interface = XMLInterface(&quot;single_run.xml&quot;)</span>
<span class="sd">        ...     interface.find(&quot;selections&quot;).text = &quot;headwaters&quot;</span>
<span class="sd">        ...     interface.conditions_io.save_conditions()</span>
<span class="sd">        ...     dirpath = &quot;LahnH/conditions/init_1996_01_06&quot;</span>
<span class="sd">        ...     with open(os.path.join(dirpath, &quot;land_dill.py&quot;)) as file_:</span>
<span class="sd">        ...         print(file_.readlines()[11].strip())</span>
<span class="sd">        ...     os.path.exists(os.path.join(dirpath, &quot;land_lahn_2.py&quot;))</span>
<span class="sd">        lz(999.0)</span>
<span class="sd">        False</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import xml_replace</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     xml_replace(&quot;LahnH/single_run&quot;, printflag=False, zip_=&quot;true&quot;)</span>
<span class="sd">        ...     interface = XMLInterface(&quot;single_run.xml&quot;)</span>
<span class="sd">        ...     interface.find(&quot;selections&quot;).text = &quot;headwaters&quot;</span>
<span class="sd">        ...     os.path.exists(&quot;LahnH/conditions/init_1996_01_06.zip&quot;)</span>
<span class="sd">        ...     interface.conditions_io.save_conditions()</span>
<span class="sd">        ...     os.path.exists(&quot;LahnH/conditions/init_1996_01_06.zip&quot;)</span>
<span class="sd">        False</span>
<span class="sd">        True</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">conditionmanager</span><span class="o">.</span><span class="n">currentdir</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;outputdir&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
            <span class="n">element</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">save_conditions</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;zip&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
            <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">conditionmanager</span><span class="o">.</span><span class="n">zip_currentdir</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="XMLSeries"><a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLSeries">[docs]</a><span class="k">class</span> <span class="nc">XMLSeries</span><span class="p">(</span><span class="n">XMLBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Helper class for |XMLInterface| responsible for loading and</span>
<span class="sd">    saving time series data, which is further delegated to suitable</span>
<span class="sd">    instances of class |XMLSubseries|.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">master</span><span class="p">:</span> <span class="n">XMLInterface</span><span class="p">,</span> <span class="n">root</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="p">:</span> <span class="n">XMLInterface</span> <span class="o">=</span> <span class="n">master</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span> <span class="o">=</span> <span class="n">root</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">readers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;XMLSubseries&quot;</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;The reader XML elements defined in the actual XML file.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XMLInterface</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.data import make_filepath</span>
<span class="sd">        &gt;&gt;&gt; interface = XMLInterface(&quot;single_run.xml&quot;, make_filepath(&quot;LahnH&quot;))</span>
<span class="sd">        &gt;&gt;&gt; for reader in interface.series_io.readers:</span>
<span class="sd">        ...     print(reader.info)</span>
<span class="sd">        all input data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">XMLSubseries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;readers&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">)]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">writers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;XMLSubseries&quot;</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;The writer XML elements defined in the actual XML file.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XMLInterface</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.data import make_filepath</span>
<span class="sd">        &gt;&gt;&gt; interface = XMLInterface(&quot;single_run.xml&quot;, make_filepath(&quot;LahnH&quot;))</span>
<span class="sd">        &gt;&gt;&gt; for writer in interface.series_io.writers:</span>
<span class="sd">        ...     print(writer.info)</span>
<span class="sd">        precipitation</span>
<span class="sd">        soilmoisture</span>
<span class="sd">        averaged</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">XMLSubseries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;writers&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">)]</span>

<div class="viewcode-block" id="XMLSeries.prepare_series"><a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLSeries.prepare_series">[docs]</a>    <span class="k">def</span> <span class="nf">prepare_series</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># noinspection PyUnresolvedReferences</span>
        <span class="sd">&quot;&quot;&quot;Call |XMLSubseries.prepare_series| of all |XMLSubseries|</span>
<span class="sd">        objects with the same memory |set| object.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XMLInterface, XMLSubseries</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.data import make_filepath</span>
<span class="sd">        &gt;&gt;&gt; interface = XMLInterface(&quot;single_run.xml&quot;, make_filepath(&quot;LahnH&quot;))</span>
<span class="sd">        &gt;&gt;&gt; series_io = interface.series_io</span>
<span class="sd">        &gt;&gt;&gt; from unittest import mock</span>
<span class="sd">        &gt;&gt;&gt; prepare_series = XMLSubseries.prepare_series</span>
<span class="sd">        &gt;&gt;&gt; XMLSubseries.prepare_series = mock.MagicMock()</span>
<span class="sd">        &gt;&gt;&gt; series_io.prepare_series()</span>
<span class="sd">        &gt;&gt;&gt; args = XMLSubseries.prepare_series.call_args_list</span>
<span class="sd">        &gt;&gt;&gt; len(args) == len(series_io.readers) + len(series_io.writers)</span>
<span class="sd">        True</span>
<span class="sd">        &gt;&gt;&gt; args[0][0][0]</span>
<span class="sd">        set()</span>
<span class="sd">        &gt;&gt;&gt; args[0][0][0] is args[-1][0][0]</span>
<span class="sd">        True</span>
<span class="sd">        &gt;&gt;&gt; XMLSubseries.prepare_series = prepare_series</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">memory</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">sequencetools</span><span class="o">.</span><span class="n">IOSequence</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">readers</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">writers</span><span class="p">):</span>
            <span class="n">output</span><span class="o">.</span><span class="n">prepare_series</span><span class="p">(</span><span class="n">memory</span><span class="p">)</span></div>

<div class="viewcode-block" id="XMLSeries.load_series"><a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLSeries.load_series">[docs]</a>    <span class="k">def</span> <span class="nf">load_series</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Call |XMLSubseries.load_series| of all |XMLSubseries| objects</span>
<span class="sd">        handles as &quot;readers&quot;.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">input_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">readers</span><span class="p">:</span>
            <span class="n">input_</span><span class="o">.</span><span class="n">load_series</span><span class="p">()</span></div>

<div class="viewcode-block" id="XMLSeries.save_series"><a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLSeries.save_series">[docs]</a>    <span class="k">def</span> <span class="nf">save_series</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Call |XMLSubseries.load_series| of all |XMLSubseries| objects</span>
<span class="sd">        handles as &quot;writers&quot;.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">writer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">writers</span><span class="p">:</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">save_series</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="XMLSelector"><a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLSelector">[docs]</a><span class="k">class</span> <span class="nc">XMLSelector</span><span class="p">(</span><span class="n">XMLBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;ToDo&quot;&quot;&quot;</span>

    <span class="n">master</span><span class="p">:</span> <span class="n">XMLBase</span>
    <span class="n">root</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">selections</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">selectiontools</span><span class="o">.</span><span class="n">Selections</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;The |Selections| object defined for the respective `reader`</span>
<span class="sd">        or `writer` element of the actual XML file. ToDo</span>

<span class="sd">        If the `reader` or `writer` element does not define a special</span>
<span class="sd">        selections element, the general |XMLInterface.selections| element</span>
<span class="sd">        of |XMLInterface| is used.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.examples import prepare_full_example_1</span>
<span class="sd">        &gt;&gt;&gt; prepare_full_example_1()</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import HydPy, pub, TestIO, XMLInterface</span>
<span class="sd">        &gt;&gt;&gt; hp = HydPy(&quot;LahnH&quot;)</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;1996-01-01&quot;, &quot;1996-01-06&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     hp.prepare_network()</span>
<span class="sd">        ...     hp.prepare_models()</span>
<span class="sd">        ...     interface = XMLInterface(&quot;single_run.xml&quot;)</span>
<span class="sd">        &gt;&gt;&gt; series_io = interface.series_io</span>
<span class="sd">        &gt;&gt;&gt; for seq in (series_io.readers + series_io.writers):</span>
<span class="sd">        ...     print(seq.info, seq.selections.names)</span>
<span class="sd">        all input data ()</span>
<span class="sd">        precipitation (&#39;headwaters&#39;,)</span>
<span class="sd">        soilmoisture (&#39;complete&#39;,)</span>
<span class="sd">        averaged (&#39;complete&#39;,)</span>

<span class="sd">        If property |XMLSelector.selections| does not find the definition</span>
<span class="sd">        of a |Selections| object, it raises the following error:</span>

<span class="sd">        &gt;&gt;&gt; interface.root.remove(interface.find(&quot;selections&quot;))</span>
<span class="sd">        &gt;&gt;&gt; series_io = interface.series_io</span>
<span class="sd">        &gt;&gt;&gt; for seq in (series_io.readers + series_io.writers):</span>
<span class="sd">        ...     print(seq.info, seq.selections.names)</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        AttributeError: Unable to find a XML element named &quot;selections&quot;.  \</span>
<span class="sd">Please make sure your XML file follows the relevant XML schema.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">selections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;selections&quot;</span><span class="p">)</span>
        <span class="n">master</span><span class="p">:</span> <span class="n">XMLBase</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">while</span> <span class="n">selections</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">master</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">master</span><span class="p">,</span> <span class="s2">&quot;master&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">master</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                    <span class="s1">&#39;Unable to find a XML element named &quot;selections&quot;.  &#39;</span>
                    <span class="s2">&quot;Please make sure your XML file follows the &quot;</span>
                    <span class="s2">&quot;relevant XML schema.&quot;</span>
                <span class="p">)</span>
            <span class="n">selections</span> <span class="o">=</span> <span class="n">master</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;selections&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_query_selections</span><span class="p">(</span><span class="n">selections</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">devices</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">selectiontools</span><span class="o">.</span><span class="n">Selection</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;The additional devices defined for the respective `reader`</span>
<span class="sd">        or `writer` element contained within a |Selection| object. ToDo</span>

<span class="sd">        If the `reader` or `writer` element does not define its own additional</span>
<span class="sd">        devices, |XMLInterface.devices| of |XMLInterface| is used.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.examples import prepare_full_example_1</span>
<span class="sd">        &gt;&gt;&gt; prepare_full_example_1()</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import HydPy, TestIO, XMLInterface</span>
<span class="sd">        &gt;&gt;&gt; hp = HydPy(&quot;LahnH&quot;)</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     hp.prepare_network()</span>
<span class="sd">        ...     interface = XMLInterface(&quot;single_run.xml&quot;)</span>
<span class="sd">        &gt;&gt;&gt; series_io = interface.series_io</span>
<span class="sd">        &gt;&gt;&gt; for seq in (series_io.readers + series_io.writers):</span>
<span class="sd">        ...     print(seq.info, seq.devices.nodes, seq.devices.elements)</span>
<span class="sd">        all input data Nodes() \</span>
<span class="sd">Elements(&quot;land_dill&quot;, &quot;land_lahn_1&quot;, &quot;land_lahn_2&quot;, &quot;land_lahn_3&quot;)</span>
<span class="sd">        precipitation Nodes() Elements(&quot;land_lahn_1&quot;, &quot;land_lahn_2&quot;)</span>
<span class="sd">        soilmoisture Nodes(&quot;dill&quot;) Elements(&quot;land_dill&quot;, &quot;land_lahn_1&quot;)</span>
<span class="sd">        averaged Nodes() Elements()</span>

<span class="sd">        If property |XMLSelector.selections| does not find the definition</span>
<span class="sd">        of a |Selections| object, it raises the following error:</span>

<span class="sd">        &gt;&gt;&gt; interface.root.remove(interface.find(&quot;devices&quot;))</span>
<span class="sd">        &gt;&gt;&gt; series_io = interface.series_io</span>
<span class="sd">        &gt;&gt;&gt; for seq in (series_io.readers + series_io.writers):</span>
<span class="sd">        ...     print(seq.info, seq.devices.nodes, seq.devices.elements)</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        AttributeError: Unable to find a XML element named &quot;devices&quot;.  \</span>
<span class="sd">Please make sure your XML file follows the relevant XML schema.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">devices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;devices&quot;</span><span class="p">)</span>
        <span class="n">master</span><span class="p">:</span> <span class="n">XMLBase</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">while</span> <span class="n">devices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">master</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">master</span><span class="p">,</span> <span class="s2">&quot;master&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">master</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                    <span class="s1">&#39;Unable to find a XML element named &quot;devices&quot;.  &#39;</span>
                    <span class="s2">&quot;Please make sure your XML file follows the &quot;</span>
                    <span class="s2">&quot;relevant XML schema.&quot;</span>
                <span class="p">)</span>
            <span class="n">devices</span> <span class="o">=</span> <span class="n">master</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;devices&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_query_devices</span><span class="p">(</span><span class="n">devices</span><span class="p">)</span>

    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="nf">_get_devices</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">attr</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">devicetools</span><span class="o">.</span><span class="n">Node</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Extract all nodes.&quot;&quot;&quot;</span>

    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="nf">_get_devices</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">attr</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;elements&quot;</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">devicetools</span><span class="o">.</span><span class="n">Element</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Extract all elements.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_get_devices</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">attr</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">,</span> <span class="s2">&quot;elements&quot;</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Iterator</span><span class="p">[</span><span class="n">devicetools</span><span class="o">.</span><span class="n">Node</span><span class="p">],</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">devicetools</span><span class="o">.</span><span class="n">Element</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;Extract all nodes or elements.&quot;&quot;&quot;</span>
        <span class="n">selections</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">)</span>
        <span class="n">selections</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">devices</span>
        <span class="n">devices</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">selection</span> <span class="ow">in</span> <span class="n">selections</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">selection</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">device</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">:</span>
                    <span class="n">devices</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
                    <span class="k">yield</span> <span class="n">device</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">elements</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">devicetools</span><span class="o">.</span><span class="n">Element</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Return the |Element| objects selected by the actual</span>
<span class="sd">        `reader` or `writer` element. ToDo</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.examples import prepare_full_example_1</span>
<span class="sd">        &gt;&gt;&gt; prepare_full_example_1()</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import HydPy, TestIO, XMLInterface</span>
<span class="sd">        &gt;&gt;&gt; hp = HydPy(&quot;LahnH&quot;)</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     hp.prepare_network()</span>
<span class="sd">        ...     interface = XMLInterface(&quot;single_run.xml&quot;)</span>
<span class="sd">        &gt;&gt;&gt; for element in interface.series_io.writers[0].elements:</span>
<span class="sd">        ...     print(element.name)</span>
<span class="sd">        land_dill</span>
<span class="sd">        land_lahn_1</span>
<span class="sd">        land_lahn_2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_devices</span><span class="p">(</span><span class="s2">&quot;elements&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">devicetools</span><span class="o">.</span><span class="n">Node</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Return the |Node| objects selected by the actual</span>
<span class="sd">        `reader` or `writer` element. ToDo</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.examples import prepare_full_example_1</span>
<span class="sd">        &gt;&gt;&gt; prepare_full_example_1()</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import HydPy, TestIO, XMLInterface</span>
<span class="sd">        &gt;&gt;&gt; hp = HydPy(&quot;LahnH&quot;)</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     hp.prepare_network()</span>
<span class="sd">        ...     interface = XMLInterface(&quot;single_run.xml&quot;)</span>
<span class="sd">        &gt;&gt;&gt; for node in interface.series_io.writers[0].nodes:</span>
<span class="sd">        ...     print(node.name)</span>
<span class="sd">        dill</span>
<span class="sd">        lahn_1</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_devices</span><span class="p">(</span><span class="s2">&quot;nodes&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="XMLSubseries"><a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLSubseries">[docs]</a><span class="k">class</span> <span class="nc">XMLSubseries</span><span class="p">(</span><span class="n">XMLSelector</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Helper class for |XMLSeries| responsible for loading and</span>
<span class="sd">    saving time series data.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">master</span><span class="p">:</span> <span class="n">XMLSeries</span><span class="p">,</span> <span class="n">root</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="p">:</span> <span class="n">XMLSeries</span> <span class="o">=</span> <span class="n">master</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span> <span class="o">=</span> <span class="n">root</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Info attribute of the actual XML `reader` or `writer` element.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;info&quot;</span><span class="p">]</span>

<div class="viewcode-block" id="XMLSubseries.prepare_sequencemanager"><a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLSubseries.prepare_sequencemanager">[docs]</a>    <span class="k">def</span> <span class="nf">prepare_sequencemanager</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Configure the |SequenceManager| object available in module</span>
<span class="sd">        |pub| following the definitions of the actual XML `reader` or</span>
<span class="sd">        `writer` element when available; if not use those of the XML</span>
<span class="sd">        `series_io` element.</span>

<span class="sd">        Compare the following results with `single_run.xml` to see that the</span>
<span class="sd">        first `writer` element defines the input file type specifically,</span>
<span class="sd">        that the second `writer` element defines a general file type, and</span>
<span class="sd">        that the third `writer` element does not define any file type (the</span>
<span class="sd">        principle mechanism is the same for other options, e.g. the</span>
<span class="sd">        aggregation mode):</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.examples import prepare_full_example_1</span>
<span class="sd">        &gt;&gt;&gt; prepare_full_example_1()</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import HydPy, TestIO, XMLInterface, pub</span>
<span class="sd">        &gt;&gt;&gt; hp = HydPy(&quot;LahnH&quot;)</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     hp.prepare_network()</span>
<span class="sd">        ...     interface = XMLInterface(&quot;single_run.xml&quot;)</span>
<span class="sd">        &gt;&gt;&gt; series_io = interface.series_io</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     series_io.writers[0].prepare_sequencemanager()</span>
<span class="sd">        &gt;&gt;&gt; pub.sequencemanager.inputfiletype</span>
<span class="sd">        &#39;asc&#39;</span>
<span class="sd">        &gt;&gt;&gt; pub.sequencemanager.fluxfiletype</span>
<span class="sd">        &#39;npy&#39;</span>
<span class="sd">        &gt;&gt;&gt; pub.sequencemanager.fluxaggregation</span>
<span class="sd">        &#39;none&#39;</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     series_io.writers[1].prepare_sequencemanager()</span>
<span class="sd">        &gt;&gt;&gt; pub.sequencemanager.statefiletype</span>
<span class="sd">        &#39;nc&#39;</span>
<span class="sd">        &gt;&gt;&gt; pub.sequencemanager.stateoverwrite</span>
<span class="sd">        False</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     series_io.writers[2].prepare_sequencemanager()</span>
<span class="sd">        &gt;&gt;&gt; pub.sequencemanager.statefiletype</span>
<span class="sd">        &#39;npy&#39;</span>
<span class="sd">        &gt;&gt;&gt; pub.sequencemanager.fluxaggregation</span>
<span class="sd">        &#39;mean&#39;</span>
<span class="sd">        &gt;&gt;&gt; pub.sequencemanager.inputoverwrite</span>
<span class="sd">        True</span>
<span class="sd">        &gt;&gt;&gt; pub.sequencemanager.inputdirpath</span>
<span class="sd">        &#39;LahnH/series/input&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">config</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;filetype&quot;</span><span class="p">,</span> <span class="s2">&quot;aggregation&quot;</span><span class="p">,</span> <span class="s2">&quot;overwrite&quot;</span><span class="p">,</span> <span class="s2">&quot;dirpath&quot;</span><span class="p">):</span>
            <span class="n">xml_special</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
            <span class="n">xml_general</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">name_manager</span><span class="p">,</span> <span class="n">name_xml</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                <span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;flux&quot;</span><span class="p">,</span> <span class="s2">&quot;state&quot;</span><span class="p">,</span> <span class="s2">&quot;node&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;inputs&quot;</span><span class="p">,</span> <span class="s2">&quot;fluxes&quot;</span><span class="p">,</span> <span class="s2">&quot;states&quot;</span><span class="p">,</span> <span class="s2">&quot;nodes&quot;</span><span class="p">),</span>
            <span class="p">):</span>
                <span class="n">value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">for</span> <span class="n">xml</span><span class="p">,</span> <span class="n">attr_xml</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">xml_special</span><span class="p">,</span> <span class="n">xml_special</span><span class="p">,</span> <span class="n">xml_general</span><span class="p">,</span> <span class="n">xml_general</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">name_xml</span><span class="p">,</span> <span class="s2">&quot;general&quot;</span><span class="p">,</span> <span class="n">name_xml</span><span class="p">,</span> <span class="s2">&quot;general&quot;</span><span class="p">),</span>
                <span class="p">):</span>
                    <span class="k">if</span> <span class="n">xml</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">element</span> <span class="o">=</span> <span class="n">find</span><span class="p">(</span><span class="n">xml</span><span class="p">,</span> <span class="n">attr_xml</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">element</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">value</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">text</span>
                            <span class="k">break</span>
                <span class="n">attr</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span> <span class="k">if</span> <span class="n">config</span> <span class="o">==</span> <span class="s2">&quot;overwrite&quot;</span> <span class="k">else</span> <span class="n">value</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">sequencemanager</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name_manager</span><span class="si">}{</span><span class="n">config</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">model2subs2seqs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]:</span>
        <span class="sd">&quot;&quot;&quot;A nested |collections.defaultdict| containing the model specific</span>
<span class="sd">        information provided by the XML `sequences` element.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XMLInterface</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.data import make_filepath</span>
<span class="sd">        &gt;&gt;&gt; interface = XMLInterface(&quot;single_run.xml&quot;, make_filepath(&quot;LahnH&quot;))</span>
<span class="sd">        &gt;&gt;&gt; series_io = interface.series_io</span>
<span class="sd">        &gt;&gt;&gt; model2subs2seqs = series_io.writers[2].model2subs2seqs</span>
<span class="sd">        &gt;&gt;&gt; for model, subs2seqs in sorted(model2subs2seqs.items()):</span>
<span class="sd">        ...     for subs, seq in sorted(subs2seqs.items()):</span>
<span class="sd">        ...         print(model, subs, seq)</span>
<span class="sd">        hland_v1 fluxes [&#39;pc&#39;, &#39;tf&#39;]</span>
<span class="sd">        hland_v1 states [&#39;sm&#39;]</span>
<span class="sd">        hstream_v1 states [&#39;qjoints&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">model2subs2seqs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;sequences&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="n">model_name</span> <span class="o">=</span> <span class="n">strip</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s2">&quot;node&quot;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">model</span><span class="p">:</span>
                <span class="n">group_name</span> <span class="o">=</span> <span class="n">strip</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">sequence</span> <span class="ow">in</span> <span class="n">group</span><span class="p">:</span>
                    <span class="n">seq_name</span> <span class="o">=</span> <span class="n">strip</span><span class="p">(</span><span class="n">sequence</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
                    <span class="n">model2subs2seqs</span><span class="p">[</span><span class="n">model_name</span><span class="p">][</span><span class="n">group_name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seq_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">model2subs2seqs</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">subs2seqs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;A |collections.defaultdict| containing the node-specific</span>
<span class="sd">        information provided by XML `sequences` element.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XMLInterface</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.data import make_filepath</span>
<span class="sd">        &gt;&gt;&gt; interface = XMLInterface(&quot;single_run.xml&quot;, make_filepath(&quot;LahnH&quot;))</span>
<span class="sd">        &gt;&gt;&gt; series_io = interface.series_io</span>
<span class="sd">        &gt;&gt;&gt; subs2seqs = series_io.writers[2].subs2seqs</span>
<span class="sd">        &gt;&gt;&gt; for subs, seq in sorted(subs2seqs.items()):</span>
<span class="sd">        ...     print(subs, seq)</span>
<span class="sd">        node [&#39;sim&#39;, &#39;obs&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">subs2seqs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="n">find</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;sequences&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span> <span class="s2">&quot;node&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nodes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
                <span class="n">subs2seqs</span><span class="p">[</span><span class="s2">&quot;node&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">strip</span><span class="p">(</span><span class="n">seq</span><span class="o">.</span><span class="n">tag</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">subs2seqs</span>

    <span class="k">def</span> <span class="nf">_iterate_sequences</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">sequencetools</span><span class="o">.</span><span class="n">IOSequence</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_iterate_model_sequences</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iterate_node_sequences</span><span class="p">()</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_iterate_model_sequences</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">sequencetools</span><span class="o">.</span><span class="n">IOSequence</span><span class="p">]:</span>
        <span class="n">m2s2s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model2subs2seqs</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">model</span>
            <span class="k">for</span> <span class="n">subseqs_name</span><span class="p">,</span> <span class="n">seq_names</span> <span class="ow">in</span> <span class="n">m2s2s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">subseqs</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="p">,</span> <span class="n">subseqs_name</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">seq_name</span> <span class="ow">in</span> <span class="n">seq_names</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">subseqs</span><span class="p">,</span> <span class="n">seq_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_iterate_node_sequences</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">sequencetools</span><span class="o">.</span><span class="n">IOSequence</span><span class="p">]:</span>
        <span class="n">s2s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subs2seqs</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">seq_names</span> <span class="ow">in</span> <span class="n">s2s</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">seq_name</span> <span class="ow">in</span> <span class="n">seq_names</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">sequences</span><span class="p">,</span> <span class="n">seq_name</span><span class="p">)</span>

<div class="viewcode-block" id="XMLSubseries.prepare_series"><a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLSubseries.prepare_series">[docs]</a>    <span class="k">def</span> <span class="nf">prepare_series</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memory</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">sequencetools</span><span class="o">.</span><span class="n">IOSequence</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Call |IOSequence.activate_ram| of all sequences selected by</span>
<span class="sd">        the given output element of the actual XML file.</span>

<span class="sd">        Use the memory argument to pass in already prepared sequences;</span>
<span class="sd">        newly prepared sequences will be added.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.examples import prepare_full_example_1</span>
<span class="sd">        &gt;&gt;&gt; prepare_full_example_1()</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import HydPy, pub, TestIO, XMLInterface</span>
<span class="sd">        &gt;&gt;&gt; hp = HydPy(&quot;LahnH&quot;)</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;1996-01-01&quot;, &quot;1996-01-06&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     hp.prepare_network()</span>
<span class="sd">        ...     hp.prepare_models()</span>
<span class="sd">        ...     interface = XMLInterface(&quot;single_run.xml&quot;)</span>
<span class="sd">        &gt;&gt;&gt; interface.update_timegrids()</span>
<span class="sd">        &gt;&gt;&gt; series_io = interface.series_io</span>

<span class="sd">        &gt;&gt;&gt; memory = set()</span>
<span class="sd">        &gt;&gt;&gt; pc = hp.elements.land_dill.model.sequences.fluxes.pc</span>
<span class="sd">        &gt;&gt;&gt; pc.ramflag</span>
<span class="sd">        False</span>
<span class="sd">        &gt;&gt;&gt; series_io.writers[0].prepare_series(memory)</span>
<span class="sd">        &gt;&gt;&gt; pc in memory</span>
<span class="sd">        True</span>
<span class="sd">        &gt;&gt;&gt; pc.ramflag</span>
<span class="sd">        True</span>

<span class="sd">        &gt;&gt;&gt; pc.deactivate_ram()</span>
<span class="sd">        &gt;&gt;&gt; pc.ramflag</span>
<span class="sd">        False</span>
<span class="sd">        &gt;&gt;&gt; series_io.writers[0].prepare_series(memory)</span>
<span class="sd">        &gt;&gt;&gt; pc.ramflag</span>
<span class="sd">        False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">sequence</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iterate_sequences</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">sequence</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">memory</span><span class="p">:</span>
                <span class="n">memory</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span>
                <span class="n">sequence</span><span class="o">.</span><span class="n">activate_ram</span><span class="p">()</span></div>

<div class="viewcode-block" id="XMLSubseries.load_series"><a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLSubseries.load_series">[docs]</a>    <span class="k">def</span> <span class="nf">load_series</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Load time series data as defined by the actual XML `reader`</span>
<span class="sd">        element.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.examples import prepare_full_example_1</span>
<span class="sd">        &gt;&gt;&gt; prepare_full_example_1()</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import HydPy, pub, TestIO, XMLInterface</span>
<span class="sd">        &gt;&gt;&gt; hp = HydPy(&quot;LahnH&quot;)</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;1996-01-01&quot;, &quot;1996-01-06&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     hp.prepare_network()</span>
<span class="sd">        ...     hp.prepare_models()</span>
<span class="sd">        ...     interface = XMLInterface(&quot;single_run.xml&quot;)</span>
<span class="sd">        ...     interface.update_options()</span>
<span class="sd">        ...     interface.update_timegrids()</span>
<span class="sd">        ...     series_io = interface.series_io</span>
<span class="sd">        ...     series_io.prepare_series()</span>
<span class="sd">        ...     series_io.load_series()</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import print_values</span>
<span class="sd">        &gt;&gt;&gt; print_values(</span>
<span class="sd">        ...     hp.elements.land_dill.model.sequences.inputs.t.series[:3])</span>
<span class="sd">        -0.298846, -0.811539, -2.493848</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">sequencemanager</span><span class="o">.</span><span class="n">open_netcdfreader</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prepare_sequencemanager</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">sequence</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iterate_sequences</span><span class="p">():</span>
            <span class="n">sequence</span><span class="o">.</span><span class="n">load_ext</span><span class="p">()</span>
        <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">sequencemanager</span><span class="o">.</span><span class="n">close_netcdfreader</span><span class="p">()</span></div>

<div class="viewcode-block" id="XMLSubseries.save_series"><a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLSubseries.save_series">[docs]</a>    <span class="k">def</span> <span class="nf">save_series</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Save time series data as defined by the actual XML `writer`</span>
<span class="sd">        element.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.examples import prepare_full_example_1</span>
<span class="sd">        &gt;&gt;&gt; prepare_full_example_1()</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import HydPy, pub, TestIO, XMLInterface</span>
<span class="sd">        &gt;&gt;&gt; hp = HydPy(&quot;LahnH&quot;)</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;1996-01-01&quot;, &quot;1996-01-06&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     hp.prepare_network()</span>
<span class="sd">        ...     hp.prepare_models()</span>
<span class="sd">        ...     interface = XMLInterface(&quot;single_run.xml&quot;)</span>
<span class="sd">        ...     interface.update_options()</span>
<span class="sd">        &gt;&gt;&gt; interface.update_timegrids()</span>
<span class="sd">        &gt;&gt;&gt; series_io = interface.series_io</span>
<span class="sd">        &gt;&gt;&gt; series_io.prepare_series()</span>
<span class="sd">        &gt;&gt;&gt; hp.elements.land_dill.model.sequences.fluxes.pc.series[2, 3] = 9.0</span>
<span class="sd">        &gt;&gt;&gt; hp.nodes.lahn_2.sequences.sim.series[4] = 7.0</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     series_io.save_series()</span>
<span class="sd">        &gt;&gt;&gt; import numpy</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     os.path.exists(</span>
<span class="sd">        ...         &quot;LahnH/series/output/land_lahn_2_flux_pc.npy&quot;)</span>
<span class="sd">        ...     os.path.exists(</span>
<span class="sd">        ...         &quot;LahnH/series/output/land_lahn_3_flux_pc.npy&quot;)</span>
<span class="sd">        ...     numpy.load(</span>
<span class="sd">        ...         &quot;LahnH/series/output/land_dill_flux_pc.npy&quot;)[13+2, 3]</span>
<span class="sd">        ...     numpy.load(</span>
<span class="sd">        ...         &quot;LahnH/series/output/lahn_2_sim_q_mean.npy&quot;)[13+4]</span>
<span class="sd">        True</span>
<span class="sd">        False</span>
<span class="sd">        9.0</span>
<span class="sd">        7.0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">sequencemanager</span><span class="o">.</span><span class="n">open_netcdfwriter</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prepare_sequencemanager</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">sequence</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iterate_sequences</span><span class="p">():</span>
            <span class="n">sequence</span><span class="o">.</span><span class="n">save_ext</span><span class="p">()</span>
        <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">sequencemanager</span><span class="o">.</span><span class="n">close_netcdfwriter</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="XMLExchange"><a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLExchange">[docs]</a><span class="k">class</span> <span class="nc">XMLExchange</span><span class="p">(</span><span class="n">XMLBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Helper class for |XMLInterface| responsible for interpreting exchange</span>
<span class="sd">    items, accessible via different instances of class |XMLItemgroup|.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">master</span><span class="p">:</span> <span class="n">XMLInterface</span><span class="p">,</span> <span class="n">root</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="p">:</span> <span class="n">XMLInterface</span> <span class="o">=</span> <span class="n">master</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span> <span class="o">=</span> <span class="n">root</span>

    <span class="k">def</span> <span class="nf">_get_items_of_certain_item_types</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">itemgroups</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">itemtype</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">_GetOrChangeItem</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">_GetOrChangeItem</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Return either all |GetItem| or all |ChangeItem| objects.&quot;&quot;&quot;</span>
        <span class="n">items</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">_GetOrChangeItem</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">itemgroup</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">itemgroups</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="nb">issubclass</span><span class="p">(</span><span class="n">itemtype</span><span class="p">,</span> <span class="n">itemtools</span><span class="o">.</span><span class="n">GetItem</span><span class="p">)</span>
                <span class="ow">and</span> <span class="p">(</span><span class="n">itemgroup</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;getitems&quot;</span><span class="p">)</span>
            <span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
                <span class="nb">issubclass</span><span class="p">(</span><span class="n">itemtype</span><span class="p">,</span> <span class="n">itemtools</span><span class="o">.</span><span class="n">ChangeItem</span><span class="p">)</span>
                <span class="ow">and</span> <span class="p">(</span><span class="n">itemgroup</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;getitems&quot;</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="p">(</span>
                    <span class="n">var</span>
                    <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">itemgroup</span><span class="o">.</span><span class="n">models</span>
                    <span class="k">for</span> <span class="n">subvars</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">subvars</span>
                    <span class="k">if</span> <span class="n">subvars</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">itemgroups</span>
                    <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">subvars</span><span class="o">.</span><span class="n">vars</span>
                <span class="p">):</span>
                    <span class="n">item</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">item</span>
                    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">itemtype</span><span class="p">)</span>
                    <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;nodes&quot;</span> <span class="ow">in</span> <span class="n">itemgroups</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="p">(</span><span class="n">var</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">itemgroup</span><span class="o">.</span><span class="n">nodes</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">vars</span><span class="p">):</span>
                        <span class="n">item</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">item</span>
                        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">itemtype</span><span class="p">)</span>
                        <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">items</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">parameteritems</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">itemtools</span><span class="o">.</span><span class="n">ChangeItem</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Create and return all items for changing control parameter values.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.examples import prepare_full_example_1</span>
<span class="sd">        &gt;&gt;&gt; prepare_full_example_1()</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import HydPy, pub, TestIO, XMLInterface</span>
<span class="sd">        &gt;&gt;&gt; hp = HydPy(&quot;LahnH&quot;)</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;1996-01-01&quot;, &quot;1996-01-06&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     hp.prepare_everything()</span>
<span class="sd">        ...     interface = XMLInterface(&quot;multiple_runs.xml&quot;)</span>
<span class="sd">        &gt;&gt;&gt; for item in interface.exchange.parameteritems:</span>
<span class="sd">        ...     print(item.name)</span>
<span class="sd">        alpha</span>
<span class="sd">        beta</span>
<span class="sd">        lag</span>
<span class="sd">        damp</span>
<span class="sd">        sfcf_1</span>
<span class="sd">        sfcf_2</span>
<span class="sd">        sfcf_3</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_items_of_certain_item_types</span><span class="p">(</span>
            <span class="n">itemgroups</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;control&quot;</span><span class="p">,),</span>
            <span class="n">itemtype</span><span class="o">=</span><span class="n">itemtools</span><span class="o">.</span><span class="n">ChangeItem</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">conditionitems</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">itemtools</span><span class="o">.</span><span class="n">ChangeItem</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Return all items for changing condition sequence values.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.examples import prepare_full_example_1</span>
<span class="sd">        &gt;&gt;&gt; prepare_full_example_1()</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import HydPy, pub, TestIO, XMLInterface</span>
<span class="sd">        &gt;&gt;&gt; hp = HydPy(&quot;LahnH&quot;)</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;1996-01-01&quot;, &quot;1996-01-06&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     hp.prepare_everything()</span>
<span class="sd">        ...     interface = XMLInterface(&quot;multiple_runs.xml&quot;)</span>
<span class="sd">        &gt;&gt;&gt; for item in interface.exchange.conditionitems:</span>
<span class="sd">        ...     print(item.name)</span>
<span class="sd">        sm_lahn_2</span>
<span class="sd">        sm_lahn_1</span>
<span class="sd">        quh</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_items_of_certain_item_types</span><span class="p">(</span>
            <span class="n">itemgroups</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;states&quot;</span><span class="p">,</span> <span class="s2">&quot;logs&quot;</span><span class="p">),</span>
            <span class="n">itemtype</span><span class="o">=</span><span class="n">itemtools</span><span class="o">.</span><span class="n">ChangeItem</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">getitems</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">itemtools</span><span class="o">.</span><span class="n">GetItem</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Return all items for querying the current values or the complete</span>
<span class="sd">        time series of sequences.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.examples import prepare_full_example_1</span>
<span class="sd">        &gt;&gt;&gt; prepare_full_example_1()</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import HydPy, pub, TestIO, XMLInterface</span>
<span class="sd">        &gt;&gt;&gt; hp = HydPy(&quot;LahnH&quot;)</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;1996-01-01&quot;, &quot;1996-01-06&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     hp.prepare_everything()</span>
<span class="sd">        ...     interface = XMLInterface(&quot;multiple_runs.xml&quot;)</span>
<span class="sd">        &gt;&gt;&gt; for item in interface.exchange.getitems:</span>
<span class="sd">        ...     print(item.target)</span>
<span class="sd">        fluxes_qt</span>
<span class="sd">        fluxes_qt_series</span>
<span class="sd">        states_sm</span>
<span class="sd">        states_sm_series</span>
<span class="sd">        nodes_sim_series</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_items_of_certain_item_types</span><span class="p">(</span>
            <span class="n">itemgroups</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;control&quot;</span><span class="p">,</span> <span class="s2">&quot;inputs&quot;</span><span class="p">,</span> <span class="s2">&quot;fluxes&quot;</span><span class="p">,</span> <span class="s2">&quot;states&quot;</span><span class="p">,</span> <span class="s2">&quot;logs&quot;</span><span class="p">,</span> <span class="s2">&quot;nodes&quot;</span><span class="p">),</span>
            <span class="n">itemtype</span><span class="o">=</span><span class="n">itemtools</span><span class="o">.</span><span class="n">GetItem</span><span class="p">,</span>
        <span class="p">)</span>

<div class="viewcode-block" id="XMLExchange.prepare_series"><a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLExchange.prepare_series">[docs]</a>    <span class="k">def</span> <span class="nf">prepare_series</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Prepare all required |IOSequence.series| arrays via calling method</span>
<span class="sd">        |IOSequence.activate_ram|.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conditionitems</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getitems</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">device2target</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">targetspecs</span><span class="o">.</span><span class="n">series</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">target</span><span class="o">.</span><span class="n">ramflag</span><span class="p">:</span>
                    <span class="n">target</span><span class="o">.</span><span class="n">activate_ram</span><span class="p">()</span></div>
                <span class="c1"># for base in getattr(item, &quot;device2base&quot;, {}).values():</span>
                <span class="c1">#     if item.basespecs.series and not base.ramflag:</span>
                <span class="c1">#         base.activate_ram()   ToDo</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">itemgroups</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;XMLItemgroup&quot;</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;The relevant |XMLItemgroup| objects.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">XMLItemgroup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">)</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span></div>


<div class="viewcode-block" id="XMLItemgroup"><a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLItemgroup">[docs]</a><span class="k">class</span> <span class="nc">XMLItemgroup</span><span class="p">(</span><span class="n">XMLBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Helper class for |XMLExchange| responsible for handling the exchange</span>
<span class="sd">    items related to model parameter and sequences separately from the</span>
<span class="sd">    exchange items of node sequences.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">master</span><span class="p">:</span> <span class="n">XMLExchange</span><span class="p">,</span> <span class="n">root</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="p">:</span> <span class="n">XMLExchange</span> <span class="o">=</span> <span class="n">master</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span> <span class="o">=</span> <span class="n">root</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">models</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;XMLModel&quot;</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;The required |XMLModel| objects.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">XMLModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">)</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">strip</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;nodes&quot;</span>
        <span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;XMLNode&quot;</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;The required |XMLNode| objects.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">XMLNode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">)</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">strip</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;nodes&quot;</span>
        <span class="p">]</span></div>


<div class="viewcode-block" id="XMLModel"><a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLModel">[docs]</a><span class="k">class</span> <span class="nc">XMLModel</span><span class="p">(</span><span class="n">XMLBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Helper class for |XMLItemgroup| responsible for handling the exchange</span>
<span class="sd">    items related to different parameter or sequence groups of |Model|</span>
<span class="sd">    objects.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">master</span><span class="p">:</span> <span class="n">XMLItemgroup</span><span class="p">,</span> <span class="n">root</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="p">:</span> <span class="n">XMLItemgroup</span> <span class="o">=</span> <span class="n">master</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span> <span class="o">=</span> <span class="n">root</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">subvars</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;XMLSubvars&quot;</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;The required |XMLSubVars| objects.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">XMLSubvars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">)</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span></div>


<div class="viewcode-block" id="XMLSubvars"><a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLSubvars">[docs]</a><span class="k">class</span> <span class="nc">XMLSubvars</span><span class="p">(</span><span class="n">XMLBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Helper class for |XMLModel| responsible for handling the exchange</span>
<span class="sd">    items related to individual parameters or sequences of |Model| objects.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">master</span><span class="p">:</span> <span class="n">XMLModel</span><span class="p">,</span> <span class="n">root</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="p">:</span> <span class="n">XMLModel</span> <span class="o">=</span> <span class="n">master</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span> <span class="o">=</span> <span class="n">root</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;XMLVar&quot;</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;The required |XMLVar| objects.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">XMLVar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">)</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span></div>


<div class="viewcode-block" id="XMLNode"><a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLNode">[docs]</a><span class="k">class</span> <span class="nc">XMLNode</span><span class="p">(</span><span class="n">XMLBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Helper class for |XMLItemgroup| responsible for handling the exchange</span>
<span class="sd">    items related to individual parameters or sequences of |Node| objects.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">master</span><span class="p">:</span> <span class="n">XMLItemgroup</span><span class="p">,</span> <span class="n">root</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="p">:</span> <span class="n">XMLItemgroup</span> <span class="o">=</span> <span class="n">master</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span> <span class="o">=</span> <span class="n">root</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;XMLVar&quot;</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;The required |XMLVar| objects.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">XMLVar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">)</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span></div>


<div class="viewcode-block" id="XMLVar"><a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLVar">[docs]</a><span class="k">class</span> <span class="nc">XMLVar</span><span class="p">(</span><span class="n">XMLSelector</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Helper class for |XMLSubvars| and |XMLNode| responsible for creating</span>
<span class="sd">    a defined exchange item.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">master</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">XMLSubvars</span><span class="p">,</span> <span class="n">XMLNode</span><span class="p">],</span> <span class="n">root</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">XMLSubvars</span><span class="p">,</span> <span class="n">XMLNode</span><span class="p">]</span> <span class="o">=</span> <span class="n">master</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span> <span class="o">=</span> <span class="n">root</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">item</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">itemtools</span><span class="o">.</span><span class="n">ExchangeItem</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;The actually defined |ExchangeItem| object.</span>

<span class="sd">        We first prepare the `LahnH` example project and then create</span>
<span class="sd">        the related |XMLInterface| object defined by the XML configuration</span>
<span class="sd">        file `multiple_runs`:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.examples import prepare_full_example_1</span>
<span class="sd">        &gt;&gt;&gt; prepare_full_example_1()</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import HydPy, pub, TestIO, XMLInterface</span>
<span class="sd">        &gt;&gt;&gt; hp = HydPy(&quot;LahnH&quot;)</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;1996-01-01&quot;, &quot;1996-01-06&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     hp.prepare_everything()</span>
<span class="sd">        ...     interface = XMLInterface(&quot;multiple_runs.xml&quot;)</span>

<span class="sd">        One of the defined |SetItem| objects modifies the values of all</span>
<span class="sd">        |hland_control.Alpha| objects of application model |hland_v1|.</span>
<span class="sd">        We demonstrate this for the control parameter object handled by</span>
<span class="sd">        element `land_dill`:</span>

<span class="sd">        &gt;&gt;&gt; var = interface.exchange.itemgroups[0].models[0].subvars[0].vars[0]</span>
<span class="sd">        &gt;&gt;&gt; item = var.item</span>
<span class="sd">        &gt;&gt;&gt; item.value</span>
<span class="sd">        array(2.0)</span>
<span class="sd">        &gt;&gt;&gt; hp.elements.land_dill.model.parameters.control.alpha</span>
<span class="sd">        alpha(1.0)</span>
<span class="sd">        &gt;&gt;&gt; item.update_variables()</span>
<span class="sd">        &gt;&gt;&gt; hp.elements.land_dill.model.parameters.control.alpha</span>
<span class="sd">        alpha(2.0)</span>

<span class="sd">        The second example is comparable but focusses on a |SetItem|</span>
<span class="sd">        modifying control parameter |hstream_control.Lag| of application</span>
<span class="sd">        model |hstream_v1|:</span>

<span class="sd">        &gt;&gt;&gt; var = interface.exchange.itemgroups[0].models[2].subvars[0].vars[0]</span>
<span class="sd">        &gt;&gt;&gt; item = var.item</span>
<span class="sd">        &gt;&gt;&gt; item.value</span>
<span class="sd">        array(5.0)</span>
<span class="sd">        &gt;&gt;&gt; hp.elements.stream_dill_lahn_2.model.parameters.control.lag</span>
<span class="sd">        lag(0.0)</span>
<span class="sd">        &gt;&gt;&gt; item.update_variables()</span>
<span class="sd">        &gt;&gt;&gt; hp.elements.stream_dill_lahn_2.model.parameters.control.lag</span>
<span class="sd">        lag(5.0)</span>

<span class="sd">        The third discussed |SetItem| assigns the same value to all entries</span>
<span class="sd">        of state sequence |hland_states.SM|, resulting in the some soil</span>
<span class="sd">        moisture for all individual hydrological response units of element</span>
<span class="sd">        `land_lahn_2`:</span>

<span class="sd">        &gt;&gt;&gt; var = interface.exchange.itemgroups[1].models[0].subvars[0].vars[0]</span>
<span class="sd">        &gt;&gt;&gt; item = var.item</span>
<span class="sd">        &gt;&gt;&gt; item.name</span>
<span class="sd">        &#39;sm_lahn_2&#39;</span>
<span class="sd">        &gt;&gt;&gt; item.value</span>
<span class="sd">        array(123.0)</span>
<span class="sd">        &gt;&gt;&gt; hp.elements.land_lahn_2.model.sequences.states.sm</span>
<span class="sd">        sm(138.31396, 135.71124, 147.54968, 145.47142, 154.96405, 153.32805,</span>
<span class="sd">           160.91917, 159.62434, 165.65575, 164.63255)</span>
<span class="sd">        &gt;&gt;&gt; item.update_variables()</span>
<span class="sd">        &gt;&gt;&gt; hp.elements.land_lahn_2.model.sequences.states.sm</span>
<span class="sd">        sm(123.0, 123.0, 123.0, 123.0, 123.0, 123.0, 123.0, 123.0, 123.0, 123.0)</span>

<span class="sd">        The fourth |SetItem| is, in contrast to the last example,</span>
<span class="sd">        1-dimensional and thus allows to assign different values to the</span>
<span class="sd">        individual hydrological response units of element `land_lahn_1`:</span>

<span class="sd">        &gt;&gt;&gt; var = interface.exchange.itemgroups[1].models[0].subvars[0].vars[1]</span>
<span class="sd">        &gt;&gt;&gt; item = var.item</span>
<span class="sd">        &gt;&gt;&gt; item.name</span>
<span class="sd">        &#39;sm_lahn_1&#39;</span>
<span class="sd">        &gt;&gt;&gt; item.value</span>
<span class="sd">        array([ 110.,  120.,  130.,  140.,  150.,  160.,  170.,  180.,  190.,</span>
<span class="sd">                200.,  210.,  220.,  230.])</span>
<span class="sd">        &gt;&gt;&gt; hp.elements.land_lahn_1.model.sequences.states.sm</span>
<span class="sd">        sm(99.27505, 96.17726, 109.16576, 106.39745, 117.97304, 115.56252,</span>
<span class="sd">           125.81523, 123.73198, 132.80035, 130.91684, 138.95523, 137.25983,</span>
<span class="sd">           142.84148)</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; with pub.options.warntrim(False):</span>
<span class="sd">        ...     item.update_variables()</span>
<span class="sd">        &gt;&gt;&gt; hp.elements.land_lahn_1.model.sequences.states.sm</span>
<span class="sd">        sm(110.0, 120.0, 130.0, 140.0, 150.0, 160.0, 170.0, 180.0, 190.0, 200.0,</span>
<span class="sd">           206.0, 206.0, 206.0)</span>

<span class="sd">        |AddItem| `sfcf_1`, `sfcf_2`, and `sfcf_3` serve to demonstrate</span>
<span class="sd">        how a scalar value (`sfcf_1` and `sfcf_2`) or a vector of values</span>
<span class="sd">        can be used to change the value of a &quot;target&quot; parameter</span>
<span class="sd">        (|hland_control.SfCF|) in relation to a &quot;base&quot; parameter</span>
<span class="sd">        (|hland_control.RfCF|):</span>

<span class="sd">        &gt;&gt;&gt; for element in pub.selections.headwaters.elements:</span>
<span class="sd">        ...     element.model.parameters.control.rfcf(1.1)</span>
<span class="sd">        &gt;&gt;&gt; for element in pub.selections.nonheadwaters.elements:</span>
<span class="sd">        ...     element.model.parameters.control.rfcf(1.0)</span>

<span class="sd">        &gt;&gt;&gt; for subvars in interface.exchange.itemgroups[2].models[0].subvars:</span>
<span class="sd">        ...     for var in subvars.vars:</span>
<span class="sd">        ...         var.item.update_variables()</span>
<span class="sd">        &gt;&gt;&gt; for element in hp.elements.catchment:</span>
<span class="sd">        ...     print(element, repr(element.model.parameters.control.sfcf))</span>
<span class="sd">        land_dill sfcf(1.4)</span>
<span class="sd">        land_lahn_1 sfcf(1.4)</span>
<span class="sd">        land_lahn_2 sfcf(1.2)</span>
<span class="sd">        land_lahn_3 sfcf(field=1.1, forest=1.2)</span>

<span class="sd">        The final three examples focus on |GetItem| objects.  One |GetItem|</span>
<span class="sd">        object queries the actual values of the |hland_states.SM| states</span>
<span class="sd">        of all relevant elements:</span>

<span class="sd">        &gt;&gt;&gt; var = interface.exchange.itemgroups[3].models[0].subvars[1].vars[0]</span>
<span class="sd">        &gt;&gt;&gt; hp.elements.land_dill.model.sequences.states.sm = 1.0</span>
<span class="sd">        &gt;&gt;&gt; for name, target in var.item.yield_name2value():</span>
<span class="sd">        ...     print(name, target)    # doctest: +ELLIPSIS</span>
<span class="sd">        land_dill_states_sm [1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, \</span>
<span class="sd">1.0, 1.0, 1.0]</span>
<span class="sd">        land_lahn_1_states_sm [110.0, 120.0, 130.0, 140.0, 150.0, 160.0, \</span>
<span class="sd">170.0, 180.0, 190.0, 200.0, 206.0, 206.0, 206.0]</span>
<span class="sd">        land_lahn_2_states_sm [123.0, 123.0, 123.0, 123.0, 123.0, 123.0, \</span>
<span class="sd">123.0, 123.0, 123.0, 123.0]</span>
<span class="sd">        land_lahn_3_states_sm [101.3124...]</span>

<span class="sd">        Another |GetItem| object queries both the actual and the time</span>
<span class="sd">        series values of the |hland_fluxes.QT| flux sequence of element</span>
<span class="sd">        `land_dill`:</span>

<span class="sd">        &gt;&gt;&gt; vars_ = interface.exchange.itemgroups[3].models[0].subvars[0].vars</span>
<span class="sd">        &gt;&gt;&gt; qt = hp.elements.land_dill.model.sequences.fluxes.qt</span>
<span class="sd">        &gt;&gt;&gt; qt(1.0)</span>
<span class="sd">        &gt;&gt;&gt; qt.series = 2.0</span>
<span class="sd">        &gt;&gt;&gt; for var in vars_:</span>
<span class="sd">        ...     for name, target in var.item.yield_name2value():</span>
<span class="sd">        ...         print(name, target)    # doctest: +ELLIPSIS</span>
<span class="sd">        land_dill_fluxes_qt 1.0</span>
<span class="sd">        land_dill_fluxes_qt_series [2.0, 2.0, 2.0, 2.0, 2.0]</span>

<span class="sd">        Last but not least, one |GetItem| queries the simulated time</span>
<span class="sd">        series values avaiable through node `dill`:</span>

<span class="sd">        &gt;&gt;&gt; var = interface.exchange.itemgroups[3].nodes[0].vars[0]</span>
<span class="sd">        &gt;&gt;&gt; hp.nodes.dill.sequences.sim.series = range(5)</span>
<span class="sd">        &gt;&gt;&gt; for name, target in var.item.yield_name2value():</span>
<span class="sd">        ...     print(name, target)    # doctest: +ELLIPSIS</span>
<span class="sd">        dill_nodes_sim_series [0.0, 1.0, 2.0, 3.0, 4.0]</span>
<span class="sd">        &gt;&gt;&gt; for name, target in var.item.yield_name2value(2, 4):</span>
<span class="sd">        ...     print(name, target)    # doctest: +ELLIPSIS</span>
<span class="sd">        dill_nodes_sim_series [2.0, 3.0]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">target</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;nodes&quot;</span><span class="p">:</span>
            <span class="n">master</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">name</span>
            <span class="n">itemgroup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">master</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">name</span>
            <span class="n">itemgroup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">name</span>
        <span class="n">itemtype</span> <span class="o">=</span> <span class="n">_ITEMGROUP2ITEMCLASS</span><span class="p">[</span><span class="n">itemgroup</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">itemgroup</span> <span class="o">==</span> <span class="s2">&quot;getitems&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_getitem</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">master</span><span class="p">,</span> <span class="n">itemtype</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">itemgroup</span> <span class="o">==</span> <span class="s2">&quot;setitems&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_changeitem</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">master</span><span class="p">,</span> <span class="n">itemtype</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_changeitem</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">master</span><span class="p">,</span> <span class="n">itemtype</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_getitem</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">master</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">itemtype</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">itemtools</span><span class="o">.</span><span class="n">GetItem</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">itemtools</span><span class="o">.</span><span class="n">GetItem</span><span class="p">:</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">itemtype</span><span class="p">(</span><span class="n">master</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_collect_variables</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">item</span>

    <span class="k">def</span> <span class="nf">_get_changeitem</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">target</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">master</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">itemtype</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">_SetOrAddItem</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_SetOrAddItem</span><span class="p">:</span>
        <span class="n">dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;dim&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
        <span class="n">init</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;init&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
        <span class="n">alias</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;alias&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
        <span class="n">item</span><span class="p">:</span> <span class="n">_SetOrAddItem</span>
        <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">itemtype</span><span class="p">,</span> <span class="n">itemtools</span><span class="o">.</span><span class="n">AddItem</span><span class="p">):</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">itemtype</span><span class="p">,</span> <span class="n">itemtools</span><span class="o">.</span><span class="n">SetItem</span><span class="p">)</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">itemtype</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">alias</span><span class="p">,</span>
                <span class="n">master</span><span class="o">=</span><span class="n">master</span><span class="p">,</span>
                <span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span>
                <span class="n">base</span><span class="o">=</span><span class="n">strip</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tag</span><span class="p">),</span>
                <span class="n">ndim</span><span class="o">=</span><span class="n">dim</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">itemtype</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">alias</span><span class="p">,</span>
                <span class="n">master</span><span class="o">=</span><span class="n">master</span><span class="p">,</span>
                <span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span>
                <span class="n">ndim</span><span class="o">=</span><span class="n">dim</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_collect_variables</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="n">item</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">init</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">item</span>

    <span class="k">def</span> <span class="nf">_collect_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="n">itemtools</span><span class="o">.</span><span class="n">ExchangeItem</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">selections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selections</span>
        <span class="n">selections</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">devices</span>
        <span class="n">item</span><span class="o">.</span><span class="n">collect_variables</span><span class="p">(</span><span class="n">selections</span><span class="p">)</span></div>


<div class="viewcode-block" id="XSDWriter"><a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XSDWriter">[docs]</a><span class="k">class</span> <span class="nc">XSDWriter</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A pure |classmethod| class for writing the actual XML schema file</span>
<span class="sd">    `HydPyConfigBase.xsd`, which makes sure that an XML configuration file</span>
<span class="sd">    is readable by class |XMLInterface|.</span>

<span class="sd">    Unless you are interested in enhancing HydPy&#39;s XML functionalities,</span>
<span class="sd">    you should, if any, be interested in method |XSDWriter.write_xsd| only.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">confpath</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">__path__</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># type: ignore[attr-defined, name-defined]</span>
    <span class="n">filepath_source</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">confpath</span><span class="p">,</span> <span class="s2">&quot;HydPyConfigBase&quot;</span> <span class="o">+</span> <span class="s2">&quot;.xsdt&quot;</span><span class="p">)</span>
    <span class="n">filepath_target</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">filepath_source</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<div class="viewcode-block" id="XSDWriter.write_xsd"><a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XSDWriter.write_xsd">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">write_xsd</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Write the complete base schema file `HydPyConfigBase.xsd` based</span>
<span class="sd">        on the template file `HydPyConfigBase.xsdt`.</span>

<span class="sd">        Method |XSDWriter.write_xsd| adds model-specific information to the</span>
<span class="sd">        general information of template file `HydPyConfigBase.xsdt` regarding</span>
<span class="sd">        reading and writing of time series data and exchanging parameter</span>
<span class="sd">        and sequence values e.g. during calibration.</span>

<span class="sd">        The following example shows that after writing a new schema file,</span>
<span class="sd">        method |XMLInterface.validate_xml| does not raise an error when</span>
<span class="sd">        either applied on the XML configuration files `single_run.xml` or</span>
<span class="sd">        `multiple_runs.xml` of the `LahnH` example project:</span>

<span class="sd">        &gt;&gt;&gt; import os</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XSDWriter, XMLInterface</span>
<span class="sd">        &gt;&gt;&gt; if os.path.exists(XSDWriter.filepath_target):</span>
<span class="sd">        ...     os.remove(XSDWriter.filepath_target)</span>
<span class="sd">        &gt;&gt;&gt; os.path.exists(XSDWriter.filepath_target)</span>
<span class="sd">        False</span>
<span class="sd">        &gt;&gt;&gt; XSDWriter.write_xsd()</span>
<span class="sd">        &gt;&gt;&gt; os.path.exists(XSDWriter.filepath_target)</span>
<span class="sd">        True</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.data import make_filepath</span>
<span class="sd">        &gt;&gt;&gt; for configfile in (&quot;single_run.xml&quot;, &quot;multiple_runs.xml&quot;):</span>
<span class="sd">        ...     XMLInterface(configfile, make_filepath(&quot;LahnH&quot;)).validate_xml()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">filepath_source</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_</span><span class="p">:</span>
            <span class="n">template</span> <span class="o">=</span> <span class="n">file_</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
            <span class="s2">&quot;&lt;!--include model sequence groups--&gt;&quot;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_insertion</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
            <span class="s2">&quot;&lt;!--include exchange items--&gt;&quot;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_exchangeinsertion</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">filepath_target</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_</span><span class="p">:</span>
            <span class="n">file_</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">template</span><span class="p">)</span></div>

<div class="viewcode-block" id="XSDWriter.get_modelnames"><a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XSDWriter.get_modelnames">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_modelnames</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Return a sorted |list| containing all application model names.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XSDWriter</span>
<span class="sd">        &gt;&gt;&gt; print(XSDWriter.get_modelnames())    # doctest: +ELLIPSIS</span>
<span class="sd">        [...&#39;dam_v001&#39;, &#39;dam_v002&#39;, &#39;dam_v003&#39;, &#39;dam_v004&#39;, &#39;dam_v005&#39;,...]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">modelspath</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">__path__</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># type: ignore[attr-defined, name-defined] # pylint: disable=line-too-long</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">fn</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">modelspath</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">fn</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.py&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">fn</span> <span class="o">!=</span> <span class="s2">&quot;__init__.py&quot;</span><span class="p">))</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="XSDWriter.get_insertion"><a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XSDWriter.get_insertion">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_insertion</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return the complete string to be inserted into the string of the</span>
<span class="sd">        template file.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XSDWriter</span>
<span class="sd">        &gt;&gt;&gt; print(XSDWriter.get_insertion())    # doctest: +ELLIPSIS</span>
<span class="sd">             &lt;element name=&quot;arma_v1&quot;</span>
<span class="sd">                      substitutionGroup=&quot;hpcb:sequenceGroup&quot;</span>
<span class="sd">                      type=&quot;hpcb:arma_v1Type&quot;/&gt;</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">             &lt;complexType name=&quot;arma_v1Type&quot;&gt;</span>
<span class="sd">                 &lt;complexContent&gt;</span>
<span class="sd">                     &lt;extension base=&quot;hpcb:sequenceGroupType&quot;&gt;</span>
<span class="sd">                         &lt;sequence&gt;</span>
<span class="sd">                            &lt;element name=&quot;fluxes&quot;</span>
<span class="sd">                                     minOccurs=&quot;0&quot;&gt;</span>
<span class="sd">                                &lt;complexType&gt;</span>
<span class="sd">                                    &lt;sequence&gt;</span>
<span class="sd">                                        &lt;element</span>
<span class="sd">                                            name=&quot;qin&quot;</span>
<span class="sd">                                            minOccurs=&quot;0&quot;/&gt;</span>
<span class="sd">        ...</span>
<span class="sd">                                &lt;/complexType&gt;</span>
<span class="sd">                            &lt;/element&gt;</span>
<span class="sd">                         &lt;/sequence&gt;</span>
<span class="sd">                     &lt;/extension&gt;</span>
<span class="sd">                 &lt;/complexContent&gt;</span>
<span class="sd">             &lt;/complexType&gt;</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">indent</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">blanks</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">indent</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">subs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_modelnames</span><span class="p">():</span>
            <span class="n">subs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">&lt;element name=&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">         substitutionGroup=&quot;hpcb:sequenceGroup&quot;&#39;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">         type=&quot;hpcb:</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">Type&quot;/&gt;&#39;</span><span class="p">,</span>
                    <span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">&lt;complexType name=&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">Type&quot;&gt;&#39;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">    &lt;complexContent&gt;&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">        &lt;extension base=&quot;hpcb:sequenceGroupType&quot;&gt;&#39;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">            &lt;sequence&gt;&quot;</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">importtools</span><span class="o">.</span><span class="n">prepare_model</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">subs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">get_modelinsertion</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">indent</span> <span class="o">+</span> <span class="mi">4</span><span class="p">))</span>
            <span class="n">subs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">            &lt;/sequence&gt;&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">        &lt;/extension&gt;&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">    &lt;/complexContent&gt;&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">&lt;/complexType&gt;&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subs</span><span class="p">)</span></div>

<div class="viewcode-block" id="XSDWriter.get_modelinsertion"><a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XSDWriter.get_modelinsertion">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_modelinsertion</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="s2">&quot;modeltools.Model&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return the insertion string required for the given application model.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XSDWriter</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import prepare_model</span>
<span class="sd">        &gt;&gt;&gt; model = prepare_model(&quot;hland_v1&quot;)</span>
<span class="sd">        &gt;&gt;&gt; print(XSDWriter.get_modelinsertion(model, 1))   # doctest: +ELLIPSIS</span>
<span class="sd">            &lt;element name=&quot;inputs&quot;</span>
<span class="sd">                     minOccurs=&quot;0&quot;&gt;</span>
<span class="sd">                &lt;complexType&gt;</span>
<span class="sd">                    &lt;sequence&gt;</span>
<span class="sd">                        &lt;element</span>
<span class="sd">                            name=&quot;p&quot;</span>
<span class="sd">                            minOccurs=&quot;0&quot;/&gt;</span>
<span class="sd">        ...</span>
<span class="sd">            &lt;/element&gt;</span>
<span class="sd">            &lt;element name=&quot;fluxes&quot;</span>
<span class="sd">                     minOccurs=&quot;0&quot;&gt;</span>
<span class="sd">        ...</span>
<span class="sd">            &lt;/element&gt;</span>
<span class="sd">            &lt;element name=&quot;states&quot;</span>
<span class="sd">                     minOccurs=&quot;0&quot;&gt;</span>
<span class="sd">        ...</span>
<span class="sd">            &lt;/element&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">texts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;inputs&quot;</span><span class="p">,</span> <span class="s2">&quot;fluxes&quot;</span><span class="p">,</span> <span class="s2">&quot;states&quot;</span><span class="p">):</span>
            <span class="n">subsequences</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">subsequences</span><span class="p">:</span>
                <span class="n">texts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">get_subsequencesinsertion</span><span class="p">(</span><span class="n">subsequences</span><span class="p">,</span> <span class="n">indent</span><span class="p">))</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">texts</span><span class="p">)</span></div>

<div class="viewcode-block" id="XSDWriter.get_subsequencesinsertion"><a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XSDWriter.get_subsequencesinsertion">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_subsequencesinsertion</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">subsequences</span><span class="p">:</span> <span class="n">sequencetools</span><span class="o">.</span><span class="n">SubSequences</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return the insertion string required for the given group of</span>
<span class="sd">        sequences.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XSDWriter</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import prepare_model</span>
<span class="sd">        &gt;&gt;&gt; model = prepare_model(&quot;hland_v1&quot;)</span>
<span class="sd">        &gt;&gt;&gt; print(XSDWriter.get_subsequencesinsertion(</span>
<span class="sd">        ...     model.sequences.fluxes, 1))    # doctest: +ELLIPSIS</span>
<span class="sd">            &lt;element name=&quot;fluxes&quot;</span>
<span class="sd">                     minOccurs=&quot;0&quot;&gt;</span>
<span class="sd">                &lt;complexType&gt;</span>
<span class="sd">                    &lt;sequence&gt;</span>
<span class="sd">                        &lt;element</span>
<span class="sd">                            name=&quot;tmean&quot;</span>
<span class="sd">                            minOccurs=&quot;0&quot;/&gt;</span>
<span class="sd">                        &lt;element</span>
<span class="sd">                            name=&quot;tc&quot;</span>
<span class="sd">                            minOccurs=&quot;0&quot;/&gt;</span>
<span class="sd">        ...</span>
<span class="sd">                        &lt;element</span>
<span class="sd">                            name=&quot;qt&quot;</span>
<span class="sd">                            minOccurs=&quot;0&quot;/&gt;</span>
<span class="sd">                    &lt;/sequence&gt;</span>
<span class="sd">                &lt;/complexType&gt;</span>
<span class="sd">            &lt;/element&gt;</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">blanks</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">indent</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">&lt;element name=&quot;</span><span class="si">{</span><span class="n">subsequences</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">         minOccurs=&quot;0&quot;&gt;&#39;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">    &lt;complexType&gt;&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">        &lt;sequence&gt;&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">sequence</span> <span class="ow">in</span> <span class="n">subsequences</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">get_sequenceinsertion</span><span class="p">(</span><span class="n">sequence</span><span class="p">,</span> <span class="n">indent</span> <span class="o">+</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">        &lt;/sequence&gt;&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">    &lt;/complexType&gt;&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">&lt;/element&gt;&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span></div>

<div class="viewcode-block" id="XSDWriter.get_sequenceinsertion"><a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XSDWriter.get_sequenceinsertion">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_sequenceinsertion</span><span class="p">(</span><span class="n">sequence</span><span class="p">:</span> <span class="n">sequencetools</span><span class="o">.</span><span class="n">Sequence_</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return the insertion string required for the given sequence.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XSDWriter</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import prepare_model</span>
<span class="sd">        &gt;&gt;&gt; model = prepare_model(&quot;hland_v1&quot;)</span>
<span class="sd">        &gt;&gt;&gt; print(XSDWriter.get_sequenceinsertion(model.sequences.fluxes.pc, 1))</span>
<span class="sd">            &lt;element</span>
<span class="sd">                name=&quot;pc&quot;</span>
<span class="sd">                minOccurs=&quot;0&quot;/&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">blanks</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">indent</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">&lt;element</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">    name=&quot;</span><span class="si">{</span><span class="n">sequence</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&quot;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">    minOccurs=&quot;0&quot;/&gt;&#39;</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="XSDWriter.get_exchangeinsertion"><a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XSDWriter.get_exchangeinsertion">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_exchangeinsertion</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return the complete string related to the definition of exchange</span>
<span class="sd">        items to be inserted into the string of the template file.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XSDWriter</span>
<span class="sd">        &gt;&gt;&gt; print(XSDWriter.get_exchangeinsertion())    # doctest: +ELLIPSIS</span>
<span class="sd">            &lt;complexType name=&quot;arma_v1_mathitemType&quot;&gt;</span>
<span class="sd">        ...</span>
<span class="sd">            &lt;element name=&quot;setitems&quot;&gt;</span>
<span class="sd">        ...</span>
<span class="sd">            &lt;complexType name=&quot;arma_v1_setitemsType&quot;&gt;</span>
<span class="sd">        ...</span>
<span class="sd">            &lt;element name=&quot;additems&quot;&gt;</span>
<span class="sd">        ...</span>
<span class="sd">            &lt;element name=&quot;getitems&quot;&gt;</span>
<span class="sd">        ...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">indent</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">subs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="n">get_mathitemsinsertion</span><span class="p">(</span><span class="n">indent</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">groupname</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;setitems&quot;</span><span class="p">,</span> <span class="s2">&quot;additems&quot;</span><span class="p">,</span> <span class="s2">&quot;getitems&quot;</span><span class="p">):</span>
            <span class="n">subs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">get_itemsinsertion</span><span class="p">(</span><span class="n">groupname</span><span class="p">,</span> <span class="n">indent</span><span class="p">))</span>
            <span class="n">subs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">get_itemtypesinsertion</span><span class="p">(</span><span class="n">groupname</span><span class="p">,</span> <span class="n">indent</span><span class="p">))</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subs</span><span class="p">)</span></div>

<div class="viewcode-block" id="XSDWriter.get_mathitemsinsertion"><a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XSDWriter.get_mathitemsinsertion">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_mathitemsinsertion</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return a string defining a model-specific XML type extending</span>
<span class="sd">        `ItemType`.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XSDWriter</span>
<span class="sd">        &gt;&gt;&gt; print(XSDWriter.get_mathitemsinsertion(1))    # doctest: +ELLIPSIS</span>
<span class="sd">            &lt;complexType name=&quot;arma_v1_mathitemType&quot;&gt;</span>
<span class="sd">                &lt;complexContent&gt;</span>
<span class="sd">                    &lt;extension base=&quot;hpcb:setitemType&quot;&gt;</span>
<span class="sd">                        &lt;choice&gt;</span>
<span class="sd">                            &lt;element name=&quot;control.responses&quot;/&gt;</span>
<span class="sd">        ...</span>
<span class="sd">                            &lt;element name=&quot;logs.logout&quot;/&gt;</span>
<span class="sd">                        &lt;/choice&gt;</span>
<span class="sd">                    &lt;/extension&gt;</span>
<span class="sd">                &lt;/complexContent&gt;</span>
<span class="sd">            &lt;/complexType&gt;</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">            &lt;complexType name=&quot;conv_v001_mathitemType&quot;&gt;</span>
<span class="sd">        ...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">blanks</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">indent</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">subs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">modelname</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_modelnames</span><span class="p">():</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">importtools</span><span class="o">.</span><span class="n">prepare_model</span><span class="p">(</span><span class="n">modelname</span><span class="p">)</span>
            <span class="n">subs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">&lt;complexType name=&quot;</span><span class="si">{</span><span class="n">modelname</span><span class="si">}</span><span class="s1">_mathitemType&quot;&gt;&#39;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">    &lt;complexContent&gt;&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">        &lt;extension base=&quot;hpcb:setitemType&quot;&gt;&#39;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">            &lt;choice&gt;&quot;</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">subvars</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_subvars</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">subvars</span><span class="p">:</span>
                    <span class="n">subs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">                &quot;</span>
                        <span class="sa">f</span><span class="s1">&#39;&lt;element name=&quot;</span><span class="si">{</span><span class="n">subvars</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&quot;/&gt;&#39;</span>
                    <span class="p">)</span>
            <span class="n">subs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">            &lt;/choice&gt;&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">        &lt;/extension&gt;&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">    &lt;/complexContent&gt;&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">&lt;/complexType&gt;&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subs</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_itemstype</span><span class="p">(</span><span class="n">modelname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">itemgroup</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">modelname</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">itemgroup</span><span class="si">}</span><span class="s2">Type&quot;</span>

<div class="viewcode-block" id="XSDWriter.get_itemsinsertion"><a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XSDWriter.get_itemsinsertion">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_itemsinsertion</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">itemgroup</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return a string defining the XML element for the given</span>
<span class="sd">        exchange item group.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XSDWriter</span>
<span class="sd">        &gt;&gt;&gt; print(XSDWriter.get_itemsinsertion(</span>
<span class="sd">        ...     &quot;setitems&quot;, 1))    # doctest: +ELLIPSIS</span>
<span class="sd">            &lt;element name=&quot;setitems&quot;&gt;</span>
<span class="sd">                &lt;complexType&gt;</span>
<span class="sd">                    &lt;sequence&gt;</span>
<span class="sd">                        &lt;element ref=&quot;hpcb:selections&quot;</span>
<span class="sd">                                 minOccurs=&quot;0&quot;/&gt;</span>
<span class="sd">                        &lt;element ref=&quot;hpcb:devices&quot;</span>
<span class="sd">                                 minOccurs=&quot;0&quot;/&gt;</span>
<span class="sd">        ...</span>
<span class="sd">                        &lt;element name=&quot;hland_v1&quot;</span>
<span class="sd">                                 type=&quot;hpcb:hland_v1_setitemsType&quot;</span>
<span class="sd">                                 minOccurs=&quot;0&quot;</span>
<span class="sd">                                 maxOccurs=&quot;unbounded&quot;/&gt;</span>
<span class="sd">        ...</span>
<span class="sd">                        &lt;element name=&quot;nodes&quot;</span>
<span class="sd">                                 type=&quot;hpcb:nodes_setitemsType&quot;</span>
<span class="sd">                                 minOccurs=&quot;0&quot;</span>
<span class="sd">                                 maxOccurs=&quot;unbounded&quot;/&gt;</span>
<span class="sd">                    &lt;/sequence&gt;</span>
<span class="sd">                    &lt;attribute name=&quot;info&quot; type=&quot;string&quot;/&gt;</span>
<span class="sd">                &lt;/complexType&gt;</span>
<span class="sd">            &lt;/element&gt;</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">blanks</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">indent</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">subs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">subs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">&lt;element name=&quot;</span><span class="si">{</span><span class="n">itemgroup</span><span class="si">}</span><span class="s1">&quot;&gt;&#39;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">    &lt;complexType&gt;&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">        &lt;sequence&gt;&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">            &lt;element ref=&quot;hpcb:selections&quot;&#39;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">                     minOccurs=&quot;0&quot;/&gt;&#39;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">            &lt;element ref=&quot;hpcb:devices&quot;&#39;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">                     minOccurs=&quot;0&quot;/&gt;&#39;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">modelname</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_modelnames</span><span class="p">():</span>
            <span class="n">type_</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_itemstype</span><span class="p">(</span><span class="n">modelname</span><span class="p">,</span> <span class="n">itemgroup</span><span class="p">)</span>
            <span class="n">subs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">            &lt;element name=&quot;</span><span class="si">{</span><span class="n">modelname</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
            <span class="n">subs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">                     type=&quot;hpcb:</span><span class="si">{</span><span class="n">type_</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
            <span class="n">subs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">                     minOccurs=&quot;0&quot;&#39;</span><span class="p">)</span>
            <span class="n">subs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">                     maxOccurs=&quot;unbounded&quot;/&gt;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">itemgroup</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;setitems&quot;</span><span class="p">,</span> <span class="s2">&quot;getitems&quot;</span><span class="p">):</span>
            <span class="n">type_</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;nodes_</span><span class="si">{</span><span class="n">itemgroup</span><span class="si">}</span><span class="s2">Type&quot;</span>
            <span class="n">subs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">            &lt;element name=&quot;nodes&quot;&#39;</span><span class="p">)</span>
            <span class="n">subs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">                     type=&quot;hpcb:</span><span class="si">{</span><span class="n">type_</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
            <span class="n">subs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">                     minOccurs=&quot;0&quot;&#39;</span><span class="p">)</span>
            <span class="n">subs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">                     maxOccurs=&quot;unbounded&quot;/&gt;&#39;</span><span class="p">)</span>
        <span class="n">subs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">        &lt;/sequence&gt;&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">        &lt;attribute name=&quot;info&quot; type=&quot;string&quot;/&gt;&#39;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">    &lt;/complexType&gt;&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">&lt;/element&gt;&quot;</span><span class="p">,</span>
                <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subs</span><span class="p">)</span></div>

<div class="viewcode-block" id="XSDWriter.get_itemtypesinsertion"><a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XSDWriter.get_itemtypesinsertion">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_itemtypesinsertion</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">itemgroup</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return a string defining the required types for the given</span>
<span class="sd">        exchange item group.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XSDWriter</span>
<span class="sd">        &gt;&gt;&gt; print(XSDWriter.get_itemtypesinsertion(</span>
<span class="sd">        ...     &quot;setitems&quot;, 1))    # doctest: +ELLIPSIS</span>
<span class="sd">            &lt;complexType name=&quot;arma_v1_setitemsType&quot;&gt;</span>
<span class="sd">        ...</span>
<span class="sd">            &lt;/complexType&gt;</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">            &lt;complexType name=&quot;dam_v001_setitemsType&quot;&gt;</span>
<span class="sd">        ...</span>
<span class="sd">            &lt;complexType name=&quot;nodes_setitemsType&quot;&gt;</span>
<span class="sd">        ...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">subs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">modelname</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_modelnames</span><span class="p">():</span>
            <span class="n">subs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">get_itemtypeinsertion</span><span class="p">(</span><span class="n">itemgroup</span><span class="p">,</span> <span class="n">modelname</span><span class="p">,</span> <span class="n">indent</span><span class="p">))</span>
        <span class="n">subs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">get_nodesitemtypeinsertion</span><span class="p">(</span><span class="n">itemgroup</span><span class="p">,</span> <span class="n">indent</span><span class="p">))</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subs</span><span class="p">)</span></div>

<div class="viewcode-block" id="XSDWriter.get_itemtypeinsertion"><a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XSDWriter.get_itemtypeinsertion">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_itemtypeinsertion</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">itemgroup</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">modelname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return a string defining the required types for the given</span>
<span class="sd">        combination of an exchange item group and an application model.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XSDWriter</span>
<span class="sd">        &gt;&gt;&gt; print(XSDWriter.get_itemtypeinsertion(</span>
<span class="sd">        ...     &quot;setitems&quot;, &quot;hland_v1&quot;, 1))    # doctest: +ELLIPSIS</span>
<span class="sd">            &lt;complexType name=&quot;hland_v1_setitemsType&quot;&gt;</span>
<span class="sd">                &lt;sequence&gt;</span>
<span class="sd">                    &lt;element ref=&quot;hpcb:selections&quot;</span>
<span class="sd">                             minOccurs=&quot;0&quot;/&gt;</span>
<span class="sd">                    &lt;element ref=&quot;hpcb:devices&quot;</span>
<span class="sd">                             minOccurs=&quot;0&quot;/&gt;</span>
<span class="sd">                    &lt;element name=&quot;control&quot;</span>
<span class="sd">                             minOccurs=&quot;0&quot;</span>
<span class="sd">                             maxOccurs=&quot;unbounded&quot;&gt;</span>
<span class="sd">        ...</span>
<span class="sd">                &lt;/sequence&gt;</span>
<span class="sd">            &lt;/complexType&gt;</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">blanks</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">indent</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">type_</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_itemstype</span><span class="p">(</span><span class="n">modelname</span><span class="p">,</span> <span class="n">itemgroup</span><span class="p">)</span>
        <span class="n">subs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">&lt;complexType name=&quot;</span><span class="si">{</span><span class="n">type_</span><span class="si">}</span><span class="s1">&quot;&gt;&#39;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">    &lt;sequence&gt;&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">        &lt;element ref=&quot;hpcb:selections&quot;&#39;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">                 minOccurs=&quot;0&quot;/&gt;&#39;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">        &lt;element ref=&quot;hpcb:devices&quot;&#39;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">                 minOccurs=&quot;0&quot;/&gt;&#39;</span><span class="p">,</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">get_subgroupsiteminsertion</span><span class="p">(</span><span class="n">itemgroup</span><span class="p">,</span> <span class="n">modelname</span><span class="p">,</span> <span class="n">indent</span> <span class="o">+</span> <span class="mi">2</span><span class="p">),</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">    &lt;/sequence&gt;&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">&lt;/complexType&gt;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subs</span><span class="p">)</span></div>

<div class="viewcode-block" id="XSDWriter.get_nodesitemtypeinsertion"><a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XSDWriter.get_nodesitemtypeinsertion">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_nodesitemtypeinsertion</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">itemgroup</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return a string defining the required types for the given</span>
<span class="sd">        combination of an exchange item group and |Node| objects.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XSDWriter</span>
<span class="sd">        &gt;&gt;&gt; print(XSDWriter.get_nodesitemtypeinsertion(</span>
<span class="sd">        ...     &quot;setitems&quot;, 1))    # doctest: +ELLIPSIS</span>
<span class="sd">            &lt;complexType name=&quot;nodes_setitemsType&quot;&gt;</span>
<span class="sd">                &lt;sequence&gt;</span>
<span class="sd">                    &lt;element ref=&quot;hpcb:selections&quot;</span>
<span class="sd">                             minOccurs=&quot;0&quot;/&gt;</span>
<span class="sd">                    &lt;element ref=&quot;hpcb:devices&quot;</span>
<span class="sd">                             minOccurs=&quot;0&quot;/&gt;</span>
<span class="sd">                    &lt;element name=&quot;sim&quot;</span>
<span class="sd">                             type=&quot;hpcb:setitemType&quot;</span>
<span class="sd">                             minOccurs=&quot;0&quot;</span>
<span class="sd">                             maxOccurs=&quot;unbounded&quot;/&gt;</span>
<span class="sd">                    &lt;element name=&quot;obs&quot;</span>
<span class="sd">                             type=&quot;hpcb:setitemType&quot;</span>
<span class="sd">                             minOccurs=&quot;0&quot;</span>
<span class="sd">                             maxOccurs=&quot;unbounded&quot;/&gt;</span>
<span class="sd">                    &lt;element name=&quot;sim.series&quot;</span>
<span class="sd">                             type=&quot;hpcb:setitemType&quot;</span>
<span class="sd">                             minOccurs=&quot;0&quot;</span>
<span class="sd">                             maxOccurs=&quot;unbounded&quot;/&gt;</span>
<span class="sd">                    &lt;element name=&quot;obs.series&quot;</span>
<span class="sd">                             type=&quot;hpcb:setitemType&quot;</span>
<span class="sd">                             minOccurs=&quot;0&quot;</span>
<span class="sd">                             maxOccurs=&quot;unbounded&quot;/&gt;</span>
<span class="sd">                &lt;/sequence&gt;</span>
<span class="sd">            &lt;/complexType&gt;</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">blanks</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">indent</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">subs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">&lt;complexType name=&quot;nodes_</span><span class="si">{</span><span class="n">itemgroup</span><span class="si">}</span><span class="s1">Type&quot;&gt;&#39;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">    &lt;sequence&gt;&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">        &lt;element ref=&quot;hpcb:selections&quot;&#39;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">                 minOccurs=&quot;0&quot;/&gt;&#39;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">        &lt;element ref=&quot;hpcb:devices&quot;&#39;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">                 minOccurs=&quot;0&quot;/&gt;&#39;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">type_</span> <span class="o">=</span> <span class="s2">&quot;getitemType&quot;</span> <span class="k">if</span> <span class="n">itemgroup</span> <span class="o">==</span> <span class="s2">&quot;getitems&quot;</span> <span class="k">else</span> <span class="s2">&quot;setitemType&quot;</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;sim&quot;</span><span class="p">,</span> <span class="s2">&quot;obs&quot;</span><span class="p">,</span> <span class="s2">&quot;sim.series&quot;</span><span class="p">,</span> <span class="s2">&quot;obs.series&quot;</span><span class="p">):</span>
            <span class="n">subs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">        &lt;element name=&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">                 type=&quot;hpcb:</span><span class="si">{</span><span class="n">type_</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">                 minOccurs=&quot;0&quot;&#39;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">                 maxOccurs=&quot;unbounded&quot;/&gt;&#39;</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="n">subs</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">    &lt;/sequence&gt;&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">&lt;/complexType&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subs</span><span class="p">)</span></div>

<div class="viewcode-block" id="XSDWriter.get_subgroupsiteminsertion"><a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XSDWriter.get_subgroupsiteminsertion">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_subgroupsiteminsertion</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">itemgroup</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">modelname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return a string defining the required types for the given</span>
<span class="sd">        combination of an exchange item group and an application model.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XSDWriter</span>
<span class="sd">        &gt;&gt;&gt; print(XSDWriter.get_subgroupsiteminsertion(</span>
<span class="sd">        ...     &quot;setitems&quot;, &quot;hland_v1&quot;, 1))    # doctest: +ELLIPSIS</span>
<span class="sd">            &lt;element name=&quot;control&quot;</span>
<span class="sd">                     minOccurs=&quot;0&quot;</span>
<span class="sd">                     maxOccurs=&quot;unbounded&quot;&gt;</span>
<span class="sd">        ...</span>
<span class="sd">            &lt;/element&gt;</span>
<span class="sd">            &lt;element name=&quot;inputs&quot;</span>
<span class="sd">        ...</span>
<span class="sd">            &lt;element name=&quot;fluxes&quot;</span>
<span class="sd">        ...</span>
<span class="sd">            &lt;element name=&quot;states&quot;</span>
<span class="sd">        ...</span>
<span class="sd">            &lt;element name=&quot;logs&quot;</span>
<span class="sd">        ...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">subs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">importtools</span><span class="o">.</span><span class="n">prepare_model</span><span class="p">(</span><span class="n">modelname</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">subvars</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_subvars</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
            <span class="n">subs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">get_subgroupiteminsertion</span><span class="p">(</span><span class="n">itemgroup</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">subvars</span><span class="p">,</span> <span class="n">indent</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subs</span><span class="p">)</span></div>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_get_subvars</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="s2">&quot;modeltools.Model&quot;</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="s2">&quot;variabletools.SubVariables&quot;</span><span class="p">]:</span>
        <span class="k">yield</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;inputs&quot;</span><span class="p">,</span> <span class="s2">&quot;fluxes&quot;</span><span class="p">,</span> <span class="s2">&quot;states&quot;</span><span class="p">,</span> <span class="s2">&quot;logs&quot;</span><span class="p">):</span>
            <span class="n">subseqs</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">subseqs</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">subseqs</span>

<div class="viewcode-block" id="XSDWriter.get_subgroupiteminsertion"><a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XSDWriter.get_subgroupiteminsertion">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_subgroupiteminsertion</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">itemgroup</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="s2">&quot;modeltools.Model&quot;</span><span class="p">,</span>
        <span class="n">subgroup</span><span class="p">:</span> <span class="s2">&quot;variabletools.SubVariables&quot;</span><span class="p">,</span>
        <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return a string defining the required types for the given</span>
<span class="sd">        combination of an exchange item group and a specific variable</span>
<span class="sd">        subgroup of an application model or class |Node|.</span>

<span class="sd">        Note that for `setitems` and `getitems` `setitemType` and</span>
<span class="sd">        `getitemType` are referenced, respectively, and for all others</span>
<span class="sd">        the model-specific `mathitemType`:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import prepare_model</span>
<span class="sd">        &gt;&gt;&gt; model = prepare_model(&quot;hland_v1&quot;)</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XSDWriter</span>
<span class="sd">        &gt;&gt;&gt; print(XSDWriter.get_subgroupiteminsertion(    # doctest: +ELLIPSIS</span>
<span class="sd">        ...     &quot;setitems&quot;, model, model.parameters.control, 1))</span>
<span class="sd">            &lt;element name=&quot;control&quot;</span>
<span class="sd">                     minOccurs=&quot;0&quot;</span>
<span class="sd">                     maxOccurs=&quot;unbounded&quot;&gt;</span>
<span class="sd">                &lt;complexType&gt;</span>
<span class="sd">                    &lt;sequence&gt;</span>
<span class="sd">                        &lt;element ref=&quot;hpcb:selections&quot;</span>
<span class="sd">                                 minOccurs=&quot;0&quot;/&gt;</span>
<span class="sd">                        &lt;element ref=&quot;hpcb:devices&quot;</span>
<span class="sd">                                 minOccurs=&quot;0&quot;/&gt;</span>
<span class="sd">                        &lt;element name=&quot;area&quot;</span>
<span class="sd">                                 type=&quot;hpcb:setitemType&quot;</span>
<span class="sd">                                 minOccurs=&quot;0&quot;</span>
<span class="sd">                                 maxOccurs=&quot;unbounded&quot;/&gt;</span>
<span class="sd">                        &lt;element name=&quot;nmbzones&quot;</span>
<span class="sd">        ...</span>
<span class="sd">                    &lt;/sequence&gt;</span>
<span class="sd">                &lt;/complexType&gt;</span>
<span class="sd">            &lt;/element&gt;</span>

<span class="sd">        &gt;&gt;&gt; print(XSDWriter.get_subgroupiteminsertion(    # doctest: +ELLIPSIS</span>
<span class="sd">        ...     &quot;getitems&quot;, model, model.parameters.control, 1))</span>
<span class="sd">            &lt;element name=&quot;control&quot;</span>
<span class="sd">        ...</span>
<span class="sd">                        &lt;element name=&quot;area&quot;</span>
<span class="sd">                                 type=&quot;hpcb:getitemType&quot;</span>
<span class="sd">                                 minOccurs=&quot;0&quot;</span>
<span class="sd">                                 maxOccurs=&quot;unbounded&quot;/&gt;</span>
<span class="sd">        ...</span>

<span class="sd">        &gt;&gt;&gt; print(XSDWriter.get_subgroupiteminsertion(    # doctest: +ELLIPSIS</span>
<span class="sd">        ...     &quot;additems&quot;, model, model.parameters.control, 1))</span>
<span class="sd">            &lt;element name=&quot;control&quot;</span>
<span class="sd">        ...</span>
<span class="sd">                        &lt;element name=&quot;area&quot;</span>
<span class="sd">                                 type=&quot;hpcb:hland_v1_mathitemType&quot;</span>
<span class="sd">                                 minOccurs=&quot;0&quot;</span>
<span class="sd">                                 maxOccurs=&quot;unbounded&quot;/&gt;</span>
<span class="sd">        ...</span>

<span class="sd">        For sequence classes, additional &quot;series&quot; elements are added:</span>

<span class="sd">        &gt;&gt;&gt; print(XSDWriter.get_subgroupiteminsertion(    # doctest: +ELLIPSIS</span>
<span class="sd">        ...     &quot;setitems&quot;, model, model.sequences.fluxes, 1))</span>
<span class="sd">            &lt;element name=&quot;fluxes&quot;</span>
<span class="sd">        ...</span>
<span class="sd">                        &lt;element name=&quot;tmean&quot;</span>
<span class="sd">                                 type=&quot;hpcb:setitemType&quot;</span>
<span class="sd">                                 minOccurs=&quot;0&quot;</span>
<span class="sd">                                 maxOccurs=&quot;unbounded&quot;/&gt;</span>
<span class="sd">                        &lt;element name=&quot;tmean.series&quot;</span>
<span class="sd">                                 type=&quot;hpcb:setitemType&quot;</span>
<span class="sd">                                 minOccurs=&quot;0&quot;</span>
<span class="sd">                                 maxOccurs=&quot;unbounded&quot;/&gt;</span>
<span class="sd">                        &lt;element name=&quot;tc&quot;</span>
<span class="sd">        ...</span>
<span class="sd">                    &lt;/sequence&gt;</span>
<span class="sd">                &lt;/complexType&gt;</span>
<span class="sd">            &lt;/element&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">blanks1</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">indent</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">blanks2</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="p">((</span><span class="n">indent</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">subs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks1</span><span class="si">}</span><span class="s1">&lt;element name=&quot;</span><span class="si">{</span><span class="n">subgroup</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks1</span><span class="si">}</span><span class="s1">         minOccurs=&quot;0&quot;&#39;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks1</span><span class="si">}</span><span class="s1">         maxOccurs=&quot;unbounded&quot;&gt;&#39;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks1</span><span class="si">}</span><span class="s2">    &lt;complexType&gt;&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks1</span><span class="si">}</span><span class="s2">        &lt;sequence&gt;&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks1</span><span class="si">}</span><span class="s1">            &lt;element ref=&quot;hpcb:selections&quot;&#39;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks1</span><span class="si">}</span><span class="s1">                     minOccurs=&quot;0&quot;/&gt;&#39;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks1</span><span class="si">}</span><span class="s1">            &lt;element ref=&quot;hpcb:devices&quot;&#39;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks1</span><span class="si">}</span><span class="s1">                     minOccurs=&quot;0&quot;/&gt;&#39;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">seriesflags</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="k">if</span> <span class="n">subgroup</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;control&quot;</span> <span class="k">else</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="n">subgroup</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">series</span> <span class="ow">in</span> <span class="n">seriesflags</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.series&quot;</span> <span class="k">if</span> <span class="n">series</span> <span class="k">else</span> <span class="n">variable</span><span class="o">.</span><span class="n">name</span>
                <span class="n">subs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks1</span><span class="si">}</span><span class="s1">            &lt;element name=&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">itemgroup</span> <span class="o">==</span> <span class="s2">&quot;setitems&quot;</span><span class="p">:</span>
                    <span class="n">subs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks2</span><span class="si">}</span><span class="s1">type=&quot;hpcb:setitemType&quot;&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">itemgroup</span> <span class="o">==</span> <span class="s2">&quot;getitems&quot;</span><span class="p">:</span>
                    <span class="n">subs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks2</span><span class="si">}</span><span class="s1">type=&quot;hpcb:getitemType&quot;&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">subs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks2</span><span class="si">}</span><span class="s1">type=&quot;hpcb:</span><span class="si">{</span><span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">_mathitemType&quot;&#39;</span><span class="p">)</span>
                <span class="n">subs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks2</span><span class="si">}</span><span class="s1">minOccurs=&quot;0&quot;&#39;</span><span class="p">)</span>
                <span class="n">subs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks2</span><span class="si">}</span><span class="s1">maxOccurs=&quot;unbounded&quot;/&gt;&#39;</span><span class="p">)</span>
        <span class="n">subs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks1</span><span class="si">}</span><span class="s2">        &lt;/sequence&gt;&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks1</span><span class="si">}</span><span class="s2">    &lt;/complexType&gt;&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks1</span><span class="si">}</span><span class="s2">&lt;/element&gt;&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subs</span><span class="p">)</span></div></div>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/HydPy_Logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="../../../index.html">Table of Contents</a></h3>
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installation Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../how_to.html">How to</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../framework.html">Framework Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modelcollection.html">Model Collection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../development.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples.html">Example Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../zbibliography.html">Bibliography</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">HydPy 4.0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">hydpy.auxs.xmltools</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2021, HydPy Developers.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.5.2.
    </div>
  </body>
</html>