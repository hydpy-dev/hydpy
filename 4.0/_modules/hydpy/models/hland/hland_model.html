
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>hydpy.models.hland.hland_model &#8212; HydPy 4.0.1 documentation</title>
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/graphviz.css" />
    
    <script id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
    <script src="../../../../_static/jquery.js"></script>
    <script src="../../../../_static/underscore.js"></script>
    <script src="../../../../_static/doctools.js"></script>
    
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">HydPy 4.0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">hydpy.models.hland.hland_model</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for hydpy.models.hland.hland_model</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># pylint: disable=missing-docstring</span>
<span class="c1"># pylint: enable=missing-docstring</span>

<span class="c1"># imports...</span>
<span class="c1"># ...from standard library</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1"># ...from HydPy</span>
<span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="kn">import</span> <span class="n">modeltools</span>
<span class="kn">from</span> <span class="nn">hydpy.cythons</span> <span class="kn">import</span> <span class="n">modelutils</span>

<span class="c1"># ...from hland</span>
<span class="kn">from</span> <span class="nn">hydpy.models.hland.hland_constants</span> <span class="kn">import</span> <span class="n">FIELD</span><span class="p">,</span> <span class="n">FOREST</span><span class="p">,</span> <span class="n">GLACIER</span><span class="p">,</span> <span class="n">ILAKE</span>
<span class="kn">from</span> <span class="nn">hydpy.models.hland</span> <span class="kn">import</span> <span class="n">hland_control</span>
<span class="kn">from</span> <span class="nn">hydpy.models.hland</span> <span class="kn">import</span> <span class="n">hland_derived</span>
<span class="kn">from</span> <span class="nn">hydpy.models.hland</span> <span class="kn">import</span> <span class="n">hland_inputs</span>
<span class="kn">from</span> <span class="nn">hydpy.models.hland</span> <span class="kn">import</span> <span class="n">hland_fluxes</span>
<span class="kn">from</span> <span class="nn">hydpy.models.hland</span> <span class="kn">import</span> <span class="n">hland_states</span>
<span class="kn">from</span> <span class="nn">hydpy.models.hland</span> <span class="kn">import</span> <span class="n">hland_logs</span>
<span class="kn">from</span> <span class="nn">hydpy.models.hland</span> <span class="kn">import</span> <span class="n">hland_outlets</span>


<div class="viewcode-block" id="Calc_TC_V1"><a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_TC_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_TC_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Adjust the measured air temperature to the altitude of the</span>
<span class="sd">    individual zones.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`TC = T - TCAlt \\cdot (ZoneZ-ZRelT)`</span>

<span class="sd">    Examples:</span>

<span class="sd">        Prepare two zones, the first one lying at the reference</span>
<span class="sd">        height and the second one 200 meters above:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(2)</span>
<span class="sd">        &gt;&gt;&gt; zrelt(2.0)</span>
<span class="sd">        &gt;&gt;&gt; zonez(2.0, 4.0)</span>

<span class="sd">        Applying the usual temperature lapse rate of 0.6°C/100m does</span>
<span class="sd">        not affect the temperature of the first zone but reduces the</span>
<span class="sd">        temperature of the second zone by 1.2°C:</span>

<span class="sd">        &gt;&gt;&gt; tcalt(0.6)</span>
<span class="sd">        &gt;&gt;&gt; inputs.t = 5.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_tc_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tc</span>
<span class="sd">        tc(5.0, 3.8)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">TCAlt</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneZ</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">ZRelT</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_inputs</span><span class="o">.</span><span class="n">T</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">TC</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">tc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">inp</span><span class="o">.</span><span class="n">t</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">tcalt</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">zonez</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">zrelt</span><span class="p">)</span></div>


<div class="viewcode-block" id="Calc_TMean_V1"><a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_TMean_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_TMean_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the areal mean temperature of the subbasin.</span>

<span class="sd">    Examples:</span>

<span class="sd">        Prepare two zones, the first one being twice as large</span>
<span class="sd">        as the second one:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(2)</span>
<span class="sd">        &gt;&gt;&gt; derived.relzonearea(2.0/3.0, 1.0/3.0)</span>

<span class="sd">        With temperature values of 5°C and 8°C  of the respective zones,</span>
<span class="sd">        the mean temperature is 6°C:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.tc = 5.0, 8.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_tmean_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tmean</span>
<span class="sd">        tmean(6.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_derived</span><span class="o">.</span><span class="n">RelZoneArea</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">TC</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">TMean</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">tmean</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">tmean</span> <span class="o">+=</span> <span class="n">der</span><span class="o">.</span><span class="n">relzonearea</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">tc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>


<div class="viewcode-block" id="Calc_FracRain_V1"><a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_FracRain_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_FracRain_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Determine the temperature-dependent fraction of (liquid) rainfall</span>
<span class="sd">    and (total) precipitation.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`FracRain = \\frac{TC-(TT-\\frac{TTInt}{2})}{TTInt}`</span>

<span class="sd">    Restriction:</span>
<span class="sd">      :math:`0 \\leq FracRain \\leq 1`</span>

<span class="sd">    Examples:</span>

<span class="sd">        The threshold temperature of seven zones is 0°C and the corresponding</span>
<span class="sd">        temperature interval of mixed precipitation 2°C:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(7)</span>
<span class="sd">        &gt;&gt;&gt; tt(0.0)</span>
<span class="sd">        &gt;&gt;&gt; ttint(2.0)</span>

<span class="sd">        The fraction of rainfall is zero below -1°C, is one above 1°C and</span>
<span class="sd">        increases linearly in between:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.tc = -10.0, -1.0, -0.5, 0.0, 0.5, 1.0, 10.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_fracrain_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.fracrain</span>
<span class="sd">        fracrain(0.0, 0.0, 0.25, 0.5, 0.75, 1.0, 1.0)</span>

<span class="sd">        Note the special case of a zero temperature interval.  With a</span>
<span class="sd">        actual temperature being equal to the threshold temperature, the</span>
<span class="sd">        rainfall fraction is one:</span>

<span class="sd">        &gt;&gt;&gt; ttint(0.0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_fracrain_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.fracrain</span>
<span class="sd">        fracrain(0.0, 0.0, 0.0, 1.0, 1.0, 1.0, 1.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">TT</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">TTInt</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">TC</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">FracRain</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">flu</span><span class="o">.</span><span class="n">tc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">tt</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">con</span><span class="o">.</span><span class="n">ttint</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">fracrain</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="k">elif</span> <span class="n">flu</span><span class="o">.</span><span class="n">tc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">tt</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">ttint</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">fracrain</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">fracrain</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">tc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">tt</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">ttint</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
                <span class="p">)</span> <span class="o">/</span> <span class="n">con</span><span class="o">.</span><span class="n">ttint</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>


<div class="viewcode-block" id="Calc_RFC_SFC_V1"><a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_RFC_SFC_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_RFC_SFC_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the corrected fractions rainfall/snowfall and total</span>
<span class="sd">    precipitation.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      :math:`RfC = RfCF \\cdot FracRain` \n</span>
<span class="sd">      :math:`SfC = SfCF \\cdot (1 - FracRain)`</span>

<span class="sd">    Examples:</span>

<span class="sd">        Assume five zones with different temperatures and hence</span>
<span class="sd">        different fractions of rainfall and total precipitation:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(5)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.fracrain = 0.0, 0.25, 0.5, 0.75, 1.0</span>

<span class="sd">        With no rainfall and no snowfall correction (implied by the</span>
<span class="sd">        respective factors being one), the corrected fraction related</span>
<span class="sd">        to rainfall is identical with the original fraction and the</span>
<span class="sd">        corrected fraction related to snowfall behaves opposite:</span>

<span class="sd">        &gt;&gt;&gt; rfcf(1.0)</span>
<span class="sd">        &gt;&gt;&gt; sfcf(1.0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rfc_sfc_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.rfc</span>
<span class="sd">        rfc(0.0, 0.25, 0.5, 0.75, 1.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.sfc</span>
<span class="sd">        sfc(1.0, 0.75, 0.5, 0.25, 0.0)</span>

<span class="sd">        With a negative rainfall correction of 20% and a positive</span>
<span class="sd">        snowfall correction of 20 % the corrected fractions are:</span>

<span class="sd">        &gt;&gt;&gt; rfcf(0.8)</span>
<span class="sd">        &gt;&gt;&gt; sfcf(1.2)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rfc_sfc_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.rfc</span>
<span class="sd">        rfc(0.0, 0.2, 0.4, 0.6, 0.8)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.sfc</span>
<span class="sd">        sfc(1.2, 0.9, 0.6, 0.3, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">RfCF</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">SfCF</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">FracRain</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_fluxes</span><span class="o">.</span><span class="n">RfC</span><span class="p">,</span>
        <span class="n">hland_fluxes</span><span class="o">.</span><span class="n">SfC</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">rfc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">fracrain</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">rfcf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">sfc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">fracrain</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">sfcf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>


<div class="viewcode-block" id="Calc_PC_V1"><a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_PC_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_PC_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Apply the precipitation correction factors and adjust precipitation</span>
<span class="sd">    to the altitude of the individual zones.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`PC = P \\cdot PCorr</span>
<span class="sd">      \\cdot (1+PCAlt \\cdot (ZoneZ-ZRelP))</span>
<span class="sd">      \\cdot (RfC + SfC)`</span>

<span class="sd">    Examples:</span>

<span class="sd">        Five zones are at an elevation of 200 m.  A precipitation value</span>
<span class="sd">        of 5 mm has been measured at a gauge at an elevation of 300 m:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(5)</span>
<span class="sd">        &gt;&gt;&gt; zrelp(2.0)</span>
<span class="sd">        &gt;&gt;&gt; zonez(3.0)</span>
<span class="sd">        &gt;&gt;&gt; inputs.p = 5.0</span>

<span class="sd">        The first four zones illustrate the individual precipitation</span>
<span class="sd">        corrections due to the general precipitation correction factor</span>
<span class="sd">        (|PCorr|, first zone), the altitude correction factor (|PCAlt|,</span>
<span class="sd">        second zone), the rainfall related correction (|RfC|, third zone),</span>
<span class="sd">        and the snowfall related correction factor (|SfC|, fourth zone).</span>
<span class="sd">        The fifth zone illustrates the interaction between all corrections:</span>

<span class="sd">        &gt;&gt;&gt; pcorr(1.3, 1.0, 1.0, 1.0, 1.3)</span>
<span class="sd">        &gt;&gt;&gt; pcalt(0.0, 0.1, 0.0, 0.0, 0.1)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.rfc = 0.5, 0.5, 0.4, 0.5, 0.4</span>
<span class="sd">        &gt;&gt;&gt; fluxes.sfc = 0.5, 0.5, 0.5, 0.7, 0.7</span>
<span class="sd">        &gt;&gt;&gt; model.calc_pc_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.pc</span>
<span class="sd">        pc(6.5, 5.5, 4.5, 6.0, 7.865)</span>

<span class="sd">        Usually, one would set zero or positive values for parameter |PCAlt|.</span>
<span class="sd">        But it is also allowed to set negative values, in order to reflect</span>
<span class="sd">        possible negative relationships between precipitation and altitude.</span>
<span class="sd">        To prevent from calculating negative precipitation when too large</span>
<span class="sd">        negative values are applied, a truncation is performed:</span>

<span class="sd">        &gt;&gt;&gt; pcalt(-1.0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_pc_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.pc</span>
<span class="sd">        pc(0.0, 0.0, 0.0, 0.0, 0.0)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">PCAlt</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneZ</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">ZRelP</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">PCorr</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_inputs</span><span class="o">.</span><span class="n">P</span><span class="p">,</span>
        <span class="n">hland_fluxes</span><span class="o">.</span><span class="n">RfC</span><span class="p">,</span>
        <span class="n">hland_fluxes</span><span class="o">.</span><span class="n">SfC</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">PC</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">pc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">inp</span><span class="o">.</span><span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">con</span><span class="o">.</span><span class="n">pcalt</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">zonez</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">zrelp</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">flu</span><span class="o">.</span><span class="n">pc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">pc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">pc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*=</span> <span class="n">con</span><span class="o">.</span><span class="n">pcorr</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">rfc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">sfc</span><span class="p">[</span><span class="n">k</span><span class="p">])</span></div>


<div class="viewcode-block" id="Calc_EP_V1"><a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_EP_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_EP_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Adjust potential norm evaporation to the actual temperature.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`EP = EPN \\cdot (1 + ETF \\cdot (TMean - TN))`</span>

<span class="sd">    Restriction:</span>
<span class="sd">      :math:`0 \\leq EP \\leq 2 \\cdot EPN`</span>

<span class="sd">    Examples:</span>

<span class="sd">        Assume four zones with different values of the temperature</span>
<span class="sd">        related factor for the adjustment of evaporation (the</span>
<span class="sd">        negative value of the first zone is not meaningful, but used</span>
<span class="sd">        for illustration purporses):</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(4)</span>
<span class="sd">        &gt;&gt;&gt; etf(-0.5, 0.0, 0.1, 0.5)</span>
<span class="sd">        &gt;&gt;&gt; inputs.tn = 20.0</span>
<span class="sd">        &gt;&gt;&gt; inputs.epn = 2.0</span>

<span class="sd">        With mean temperature equal to norm temperature, actual</span>
<span class="sd">        (uncorrected) evaporation is equal to norm evaporation:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.tmean = 20.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_ep_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.ep</span>
<span class="sd">        ep(2.0, 2.0, 2.0, 2.0)</span>

<span class="sd">        With mean temperature 5°C higher than norm temperature, potential</span>
<span class="sd">        evaporation is increased by 1 mm for the third zone, which</span>
<span class="sd">        possesses a very common adjustment factor.  For the first zone,</span>
<span class="sd">        potential evaporation is 0 mm (which is the smallest value</span>
<span class="sd">        allowed), and for the fourth zone it is the double value of the</span>
<span class="sd">        norm evaporation (which is the largest value allowed):</span>

<span class="sd">        &gt;&gt;&gt; fluxes.tmean  = 25.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_ep_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.ep</span>
<span class="sd">        ep(0.0, 2.0, 3.0, 4.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">ETF</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_inputs</span><span class="o">.</span><span class="n">EPN</span><span class="p">,</span>
        <span class="n">hland_inputs</span><span class="o">.</span><span class="n">TN</span><span class="p">,</span>
        <span class="n">hland_fluxes</span><span class="o">.</span><span class="n">TMean</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">EP</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">ep</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">inp</span><span class="o">.</span><span class="n">epn</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">con</span><span class="o">.</span><span class="n">etf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">tmean</span> <span class="o">-</span> <span class="n">inp</span><span class="o">.</span><span class="n">tn</span><span class="p">))</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">ep</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">ep</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">),</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">inp</span><span class="o">.</span><span class="n">epn</span><span class="p">)</span></div>


<div class="viewcode-block" id="Calc_EPC_V1"><a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_EPC_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_EPC_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Apply the evaporation correction factors and adjust evaporation</span>
<span class="sd">    to the altitude of the individual zones.</span>

<span class="sd">    Calculate the areal mean of (uncorrected) potential evaporation</span>
<span class="sd">    for the subbasin, adjust it to the individual zones in accordance</span>
<span class="sd">    with their heights and perform some corrections, among which one</span>
<span class="sd">    depends on the actual precipitation.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`EPC = EP \\cdot ECorr</span>
<span class="sd">      \\cdot (1+ECAlt \\cdot (ZoneZ-ZRelE))</span>
<span class="sd">      \\cdot exp(-EPF \\cdot PC)`</span>


<span class="sd">    Examples:</span>

<span class="sd">        Four zones are at an elevation of 200 m.  A (uncorrected)</span>
<span class="sd">        potential evaporation value of 2 mm and a (corrected) precipitation</span>
<span class="sd">        value of 5 mm have been determined for each zone beforehand:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(4)</span>
<span class="sd">        &gt;&gt;&gt; zrele(2.0)</span>
<span class="sd">        &gt;&gt;&gt; zonez(3.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.ep = 2.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.pc = 5.0</span>

<span class="sd">        The first three zones  illustrate the individual evaporation</span>
<span class="sd">        corrections due to the general evaporation correction factor</span>
<span class="sd">        (|ECorr|, first zone), the altitude correction factor (|ECAlt|,</span>
<span class="sd">        second zone), the precipitation related correction factor</span>
<span class="sd">        (|EPF|, third zone).  The fourth zone illustrates the interaction</span>
<span class="sd">        between all corrections:</span>

<span class="sd">        &gt;&gt;&gt; ecorr(1.3, 1.0, 1.0, 1.3)</span>
<span class="sd">        &gt;&gt;&gt; ecalt(0.0, 0.1, 0.0, 0.1)</span>
<span class="sd">        &gt;&gt;&gt; epf(0.0, 0.0, -numpy.log(0.7)/10.0, -numpy.log(0.7)/10.0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_epc_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.epc</span>
<span class="sd">        epc(2.6, 1.8, 1.4, 1.638)</span>

<span class="sd">        To prevent from calculating negative evaporation values when too</span>
<span class="sd">        large values for parameter |ECAlt| are set, a truncation is performed:</span>

<span class="sd">        &gt;&gt;&gt; ecalt(2.0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_epc_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.epc</span>
<span class="sd">        epc(0.0, 0.0, 0.0, 0.0)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">ECorr</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">ECAlt</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneZ</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">ZRelE</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">EPF</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_fluxes</span><span class="o">.</span><span class="n">EP</span><span class="p">,</span>
        <span class="n">hland_fluxes</span><span class="o">.</span><span class="n">PC</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">EPC</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">epc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">ep</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">ecorr</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">ecalt</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">zonez</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">zrele</span><span class="p">))</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">flu</span><span class="o">.</span><span class="n">epc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">epc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">epc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">con</span><span class="o">.</span><span class="n">epf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">pc</span><span class="p">[</span><span class="n">k</span><span class="p">])</span></div>


<div class="viewcode-block" id="Calc_TF_Ic_V1"><a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_TF_Ic_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_TF_Ic_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate throughfall and update the interception storage</span>
<span class="sd">    accordingly.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`TF = \\Bigl \\lbrace</span>
<span class="sd">      {</span>
<span class="sd">      {PC \\ | \\ Ic = IcMax}</span>
<span class="sd">      \\atop</span>
<span class="sd">      {0 \\ | \\ Ic &lt; IcMax}</span>
<span class="sd">      }`</span>

<span class="sd">    Examples:</span>

<span class="sd">        Initialize six zones of different types.  Assume a</span>
<span class="sd">        generall maximum interception capacity of 2 mm. All zones receive</span>
<span class="sd">        a 0.5 mm input of precipitation:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(6)</span>
<span class="sd">        &gt;&gt;&gt; zonetype(GLACIER, ILAKE, FIELD, FOREST, FIELD, FIELD)</span>
<span class="sd">        &gt;&gt;&gt; icmax(2.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.pc = 0.5</span>
<span class="sd">        &gt;&gt;&gt; states.ic = 0.0, 0.0, 0.0, 0.0, 1.0, 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_tf_ic_v1()</span>

<span class="sd">        For glaciers (first zone) and internal lakes (second zone) the</span>
<span class="sd">        interception routine does not apply.  Hence, all precipitation is</span>
<span class="sd">        routed as throughfall. For fields and forests, the interception</span>
<span class="sd">        routine is identical (usually, only larger capacities for forests</span>
<span class="sd">        are assumed, due to their higher leaf area index).  Hence, the</span>
<span class="sd">        results of the third and the second zone are equal.  The last</span>
<span class="sd">        three zones demonstrate, that all precipitation is stored until</span>
<span class="sd">        the interception capacity is reached; afterwards, all precepitation</span>
<span class="sd">        is routed as throughfall.  Initial storage reduces the effective</span>
<span class="sd">        capacity of the respective simulation step:</span>

<span class="sd">        &gt;&gt;&gt; states.ic</span>
<span class="sd">        ic(0.0, 0.0, 0.5, 0.5, 1.5, 2.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tf</span>
<span class="sd">        tf(0.5, 0.5, 0.0, 0.0, 0.0, 0.5)</span>

<span class="sd">        A zero precipitation example:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.pc = 0.0</span>
<span class="sd">        &gt;&gt;&gt; states.ic = 0.0, 0.0, 0.0, 0.0, 1.0, 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_tf_ic_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.ic</span>
<span class="sd">        ic(0.0, 0.0, 0.0, 0.0, 1.0, 2.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tf</span>
<span class="sd">        tf(0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>

<span class="sd">        A high precipitation example:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.pc = 5.0</span>
<span class="sd">        &gt;&gt;&gt; states.ic = 0.0, 0.0, 0.0, 0.0, 1.0, 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_tf_ic_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.ic</span>
<span class="sd">        ic(0.0, 0.0, 2.0, 2.0, 2.0, 2.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tf</span>
<span class="sd">        tf(5.0, 5.0, 3.0, 3.0, 4.0, 5.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneType</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">IcMax</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">PC</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_states</span><span class="o">.</span><span class="n">Ic</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">TF</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">zonetype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">FIELD</span><span class="p">,</span> <span class="n">FOREST</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">tf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">pc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">icmax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">sta</span><span class="o">.</span><span class="n">ic</span><span class="p">[</span><span class="n">k</span><span class="p">]),</span> <span class="mf">0.0</span><span class="p">)</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">ic</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">pc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">tf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">tf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">pc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">ic</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>


<div class="viewcode-block" id="Calc_EI_Ic_V1"><a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_EI_Ic_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_EI_Ic_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate interception evaporation and update the interception</span>
<span class="sd">    storage accordingly.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`EI = \\Bigl \\lbrace</span>
<span class="sd">      {</span>
<span class="sd">      {EPC \\ | \\ Ic &gt; 0}</span>
<span class="sd">      \\atop</span>
<span class="sd">      {0 \\ | \\ Ic = 0}</span>
<span class="sd">      }`</span>

<span class="sd">    Examples:</span>

<span class="sd">        Initialize six zones of different types.  For all zones</span>
<span class="sd">        a (corrected) potential evaporation of 0.5 mm is given:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(6)</span>
<span class="sd">        &gt;&gt;&gt; zonetype(GLACIER, ILAKE, FIELD, FOREST, FIELD, FIELD)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.epc = 0.5</span>
<span class="sd">        &gt;&gt;&gt; states.ic = 0.0, 0.0, 0.0, 0.0, 1.0, 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_ei_ic_v1()</span>

<span class="sd">        For glaciers (first zone) and internal lakes (second zone) the</span>
<span class="sd">        interception routine does not apply.  Hence, no interception</span>
<span class="sd">        evaporation can occur.  For fields and forests, the interception</span>
<span class="sd">        routine is identical (usually, only larger capacities for forests</span>
<span class="sd">        are assumed, due to their higher leaf area index).  Hence, the</span>
<span class="sd">        results of the third and the second zone are equal.  The last</span>
<span class="sd">        three zones demonstrate, that all interception evaporation is equal</span>
<span class="sd">        to potential evaporation until the interception storage is empty;</span>
<span class="sd">        afterwards, interception evaporation is zero:</span>

<span class="sd">        &gt;&gt;&gt; states.ic</span>
<span class="sd">        ic(0.0, 0.0, 0.0, 0.0, 0.5, 1.5)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.ei</span>
<span class="sd">        ei(0.0, 0.0, 0.0, 0.0, 0.5, 0.5)</span>

<span class="sd">        A zero evaporation example:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.epc = 0.0</span>
<span class="sd">        &gt;&gt;&gt; states.ic = 0.0, 0.0, 0.0, 0.0, 1.0, 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_ei_ic_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.ic</span>
<span class="sd">        ic(0.0, 0.0, 0.0, 0.0, 1.0, 2.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.ei</span>
<span class="sd">        ei(0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>

<span class="sd">        A high evaporation example:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.epc = 5.0</span>
<span class="sd">        &gt;&gt;&gt; states.ic = 0.0, 0.0, 0.0, 0.0, 1.0, 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_ei_ic_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.ic</span>
<span class="sd">        ic(0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.ei</span>
<span class="sd">        ei(0.0, 0.0, 0.0, 0.0, 1.0, 2.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneType</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">EPC</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_states</span><span class="o">.</span><span class="n">Ic</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">EI</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">zonetype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">FIELD</span><span class="p">,</span> <span class="n">FOREST</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">ei</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">epc</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">sta</span><span class="o">.</span><span class="n">ic</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">ic</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-=</span> <span class="n">flu</span><span class="o">.</span><span class="n">ei</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">ei</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">ic</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>


<div class="viewcode-block" id="Calc_SP_WC_V1"><a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_SP_WC_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_SP_WC_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Add throughfall to the snow layer.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      :math:`\\frac{dSP}{dt} = TF \\cdot \\frac{SfC}{SfC+RfC}` \n</span>
<span class="sd">      :math:`\\frac{dWC}{dt} = TF \\cdot \\frac{RfC}{SfC+RfC}`</span>

<span class="sd">    Exemples:</span>

<span class="sd">        Consider the following setting, in which eight zones of</span>
<span class="sd">        different type receive a throughfall of 10mm:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(8)</span>
<span class="sd">        &gt;&gt;&gt; zonetype(ILAKE, GLACIER, FIELD, FOREST, FIELD, FIELD, FIELD, FIELD)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tf = 10.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.sfc = 0.5, 0.5, 0.5, 0.5, 0.2, 0.8, 1.0, 4.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.rfc = 0.5, 0.5, 0.5, 0.5, 0.8, 0.2, 4.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; states.sp = 0.0</span>
<span class="sd">        &gt;&gt;&gt; states.wc = 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_sp_wc_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.sp</span>
<span class="sd">        sp(0.0, 5.0, 5.0, 5.0, 2.0, 8.0, 2.0, 8.0)</span>
<span class="sd">        &gt;&gt;&gt; states.wc</span>
<span class="sd">        wc(0.0, 5.0, 5.0, 5.0, 8.0, 2.0, 8.0, 2.0)</span>

<span class="sd">        The snow routine does not apply for internal lakes, which is why</span>
<span class="sd">        both  the ice storage and the water storage of the first zone</span>
<span class="sd">        remain unchanged.  The snow routine is identical for glaciers,</span>
<span class="sd">        fields and forests in the current context, which is why the</span>
<span class="sd">        results of the second, third, and fourth zone are equal.  The</span>
<span class="sd">        last four zones illustrate that the corrected snowfall fraction</span>
<span class="sd">        as well as the corrected rainfall fraction are applied in a</span>
<span class="sd">        relative manner, as the total amount of water yield has been</span>
<span class="sd">        corrected in the interception module already.</span>

<span class="sd">        When both factors are zero, the neither the water nor the ice</span>
<span class="sd">        content of the snow layer changes:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.sfc = 0.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.rfc = 0.0</span>
<span class="sd">        &gt;&gt;&gt; states.sp = 2.0</span>
<span class="sd">        &gt;&gt;&gt; states.wc = 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_sp_wc_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.sp</span>
<span class="sd">        sp(0.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0)</span>
<span class="sd">        &gt;&gt;&gt; states.wc</span>
<span class="sd">        wc(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneType</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_fluxes</span><span class="o">.</span><span class="n">TF</span><span class="p">,</span>
        <span class="n">hland_fluxes</span><span class="o">.</span><span class="n">RfC</span><span class="p">,</span>
        <span class="n">hland_fluxes</span><span class="o">.</span><span class="n">SfC</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_states</span><span class="o">.</span><span class="n">WC</span><span class="p">,</span>
        <span class="n">hland_states</span><span class="o">.</span><span class="n">SP</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">zonetype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">!=</span> <span class="n">ILAKE</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">rfc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">sfc</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">sta</span><span class="o">.</span><span class="n">wc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">tf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">rfc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">rfc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">sfc</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                    <span class="n">sta</span><span class="o">.</span><span class="n">sp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">tf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">sfc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">rfc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">sfc</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">wc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">sp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>


<div class="viewcode-block" id="Calc_Melt_SP_WC_V1"><a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_Melt_SP_WC_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_Melt_SP_WC_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate melting of the ice content within the snow layer and</span>
<span class="sd">    update both the snow layers ice and the water content.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      :math:`\\frac{dSP}{dt} = - Melt` \n</span>
<span class="sd">      :math:`\\frac{dWC}{dt} = + Melt` \n</span>
<span class="sd">      :math:`Melt = min(cfmax \\cdot (TC-TTM), SP)` \n</span>

<span class="sd">    Examples:</span>

<span class="sd">        Six zones are initialized with the same threshold</span>
<span class="sd">        temperature and degree day factor, but  with different zone types</span>
<span class="sd">        and initial ice contents:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(6)</span>
<span class="sd">        &gt;&gt;&gt; zonetype(ILAKE, GLACIER, FIELD, FOREST, FIELD, FIELD)</span>
<span class="sd">        &gt;&gt;&gt; cfmax(4.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.ttm = 2.0</span>
<span class="sd">        &gt;&gt;&gt; states.sp = 0.0, 10.0, 10.0, 10.0, 5.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; states.wc = 2.0</span>

<span class="sd">        Note that the assumed length of the simulation step is only a</span>
<span class="sd">        half day.  Hence the effective value of the degree day factor</span>
<span class="sd">        is not 4 but 2:</span>

<span class="sd">        &gt;&gt;&gt; cfmax</span>
<span class="sd">        cfmax(4.0)</span>
<span class="sd">        &gt;&gt;&gt; cfmax.values</span>
<span class="sd">        array([ 2.,  2.,  2.,  2.,  2.,  2.])</span>

<span class="sd">        When the actual temperature is equal to the threshold</span>
<span class="sd">        temperature for melting and refreezing, no melting  occurs</span>
<span class="sd">        and the states remain unchanged:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.tc = 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_melt_sp_wc_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.melt</span>
<span class="sd">        melt(0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sp</span>
<span class="sd">        sp(0.0, 10.0, 10.0, 10.0, 5.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.wc</span>
<span class="sd">        wc(0.0, 2.0, 2.0, 2.0, 2.0, 2.0)</span>

<span class="sd">        The same holds true for an actual temperature lower than the</span>
<span class="sd">        threshold temperature:</span>

<span class="sd">        &gt;&gt;&gt; states.sp = 0.0, 10.0, 10.0, 10.0, 5.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; states.wc = 2.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tc = -1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_melt_sp_wc_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.melt</span>
<span class="sd">        melt(0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sp</span>
<span class="sd">        sp(0.0, 10.0, 10.0, 10.0, 5.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.wc</span>
<span class="sd">        wc(0.0, 2.0, 2.0, 2.0, 2.0, 2.0)</span>

<span class="sd">        With an actual temperature 3°C above the threshold temperature,</span>
<span class="sd">        melting can occur. Actual melting is consistent with potential</span>
<span class="sd">        melting, except for the first zone, which is an internal lake,</span>
<span class="sd">        and the last two zones, for which potential melting exceeds the</span>
<span class="sd">        available frozen water content of the snow layer:</span>

<span class="sd">        &gt;&gt;&gt; states.sp = 0.0, 10.0, 10.0, 10.0, 5.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; states.wc = 2.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tc = 5.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_melt_sp_wc_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.melt</span>
<span class="sd">        melt(0.0, 6.0, 6.0, 6.0, 5.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sp</span>
<span class="sd">        sp(0.0, 4.0, 4.0, 4.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.wc</span>
<span class="sd">        wc(0.0, 8.0, 8.0, 8.0, 7.0, 2.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneType</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">CFMax</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_derived</span><span class="o">.</span><span class="n">TTM</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">TC</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_states</span><span class="o">.</span><span class="n">WC</span><span class="p">,</span>
        <span class="n">hland_states</span><span class="o">.</span><span class="n">SP</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">Melt</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">zonetype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">!=</span> <span class="n">ILAKE</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">flu</span><span class="o">.</span><span class="n">tc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">der</span><span class="o">.</span><span class="n">ttm</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">melt</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
                        <span class="n">con</span><span class="o">.</span><span class="n">cfmax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">tc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">der</span><span class="o">.</span><span class="n">ttm</span><span class="p">[</span><span class="n">k</span><span class="p">]),</span> <span class="n">sta</span><span class="o">.</span><span class="n">sp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                    <span class="p">)</span>
                    <span class="n">sta</span><span class="o">.</span><span class="n">sp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-=</span> <span class="n">flu</span><span class="o">.</span><span class="n">melt</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                    <span class="n">sta</span><span class="o">.</span><span class="n">wc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">melt</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">melt</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">melt</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">wc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">sp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>


<div class="viewcode-block" id="Calc_Refr_SP_WC_V1"><a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_Refr_SP_WC_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_Refr_SP_WC_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate refreezing of the water content within the snow layer and</span>
<span class="sd">    update both the snow layers ice and the water content.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      :math:`\\frac{dSP}{dt} =  + Refr` \n</span>
<span class="sd">      :math:`\\frac{dWC}{dt} =  - Refr` \n</span>
<span class="sd">      :math:`Refr = min(cfr \\cdot cfmax \\cdot (TTM-TC), WC)`</span>

<span class="sd">    Examples:</span>

<span class="sd">        Six zones are initialized with the same threshold</span>
<span class="sd">        temperature, degree day factor and refreezing coefficient, but</span>
<span class="sd">        with different zone types and initial states:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(6)</span>
<span class="sd">        &gt;&gt;&gt; zonetype(ILAKE, GLACIER, FIELD, FOREST, FIELD, FIELD)</span>
<span class="sd">        &gt;&gt;&gt; cfmax(4.0)</span>
<span class="sd">        &gt;&gt;&gt; cfr(0.1)</span>
<span class="sd">        &gt;&gt;&gt; derived.ttm = 2.0</span>
<span class="sd">        &gt;&gt;&gt; states.sp = 2.0</span>
<span class="sd">        &gt;&gt;&gt; states.wc = 0.0, 1.0, 1.0, 1.0, 0.5, 0.0</span>

<span class="sd">        Note that the assumed length of the simulation step is only</span>
<span class="sd">        a half day.  Hence the effective value of the degree day</span>
<span class="sd">        factor is not 4 but 2:</span>

<span class="sd">        &gt;&gt;&gt; cfmax</span>
<span class="sd">        cfmax(4.0)</span>
<span class="sd">        &gt;&gt;&gt; cfmax.values</span>
<span class="sd">        array([ 2.,  2.,  2.,  2.,  2.,  2.])</span>

<span class="sd">        When the actual temperature is equal to the threshold</span>
<span class="sd">        temperature for melting and refreezing, neither no refreezing</span>
<span class="sd">        occurs and the states remain unchanged:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.tc = 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_refr_sp_wc_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.refr</span>
<span class="sd">        refr(0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sp</span>
<span class="sd">        sp(0.0, 2.0, 2.0, 2.0, 2.0, 2.0)</span>
<span class="sd">        &gt;&gt;&gt; states.wc</span>
<span class="sd">        wc(0.0, 1.0, 1.0, 1.0, 0.5, 0.0)</span>

<span class="sd">        The same holds true for an actual temperature higher than the</span>
<span class="sd">        threshold temperature:</span>

<span class="sd">        &gt;&gt;&gt; states.sp = 2.0</span>
<span class="sd">        &gt;&gt;&gt; states.wc = 0.0, 1.0, 1.0, 1.0, 0.5, 0.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tc = 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_refr_sp_wc_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.refr</span>
<span class="sd">        refr(0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sp</span>
<span class="sd">        sp(0.0, 2.0, 2.0, 2.0, 2.0, 2.0)</span>
<span class="sd">        &gt;&gt;&gt; states.wc</span>
<span class="sd">        wc(0.0, 1.0, 1.0, 1.0, 0.5, 0.0)</span>

<span class="sd">        With an actual temperature 3°C above the threshold temperature,</span>
<span class="sd">        only melting can occur. Actual melting is consistent with</span>
<span class="sd">        potential melting, except for the first zone, which is an</span>
<span class="sd">        internal lake, and the last two zones, for which potential</span>
<span class="sd">        melting exceeds the available frozen water content of the</span>
<span class="sd">        snow layer:</span>

<span class="sd">        &gt;&gt;&gt; states.sp = 2.0</span>
<span class="sd">        &gt;&gt;&gt; states.wc = 0.0, 1.0, 1.0, 1.0, 0.5, 0.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tc = 5.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_refr_sp_wc_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.refr</span>
<span class="sd">        refr(0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sp</span>
<span class="sd">        sp(0.0, 2.0, 2.0, 2.0, 2.0, 2.0)</span>
<span class="sd">        &gt;&gt;&gt; states.wc</span>
<span class="sd">        wc(0.0, 1.0, 1.0, 1.0, 0.5, 0.0)</span>

<span class="sd">        With an actual temperature 3°C below the threshold temperature,</span>
<span class="sd">        refreezing can occur. Actual refreezing is consistent with</span>
<span class="sd">        potential refreezing, except for the first zone, which is an</span>
<span class="sd">        internal lake, and the last two zones, for which potential</span>
<span class="sd">        refreezing exceeds the available liquid water content of the</span>
<span class="sd">        snow layer:</span>

<span class="sd">        &gt;&gt;&gt; states.sp = 2.0</span>
<span class="sd">        &gt;&gt;&gt; states.wc = 0.0, 1.0, 1.0, 1.0, 0.5, 0.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tc = -1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_refr_sp_wc_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.refr</span>
<span class="sd">        refr(0.0, 0.6, 0.6, 0.6, 0.5, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sp</span>
<span class="sd">        sp(0.0, 2.6, 2.6, 2.6, 2.5, 2.0)</span>
<span class="sd">        &gt;&gt;&gt; states.wc</span>
<span class="sd">        wc(0.0, 0.4, 0.4, 0.4, 0.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneType</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">CFR</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">CFMax</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_derived</span><span class="o">.</span><span class="n">TTM</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">TC</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_states</span><span class="o">.</span><span class="n">WC</span><span class="p">,</span>
        <span class="n">hland_states</span><span class="o">.</span><span class="n">SP</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">Refr</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">zonetype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">!=</span> <span class="n">ILAKE</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">flu</span><span class="o">.</span><span class="n">tc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">der</span><span class="o">.</span><span class="n">ttm</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">refr</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
                        <span class="n">con</span><span class="o">.</span><span class="n">cfr</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">cfmax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">ttm</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">tc</span><span class="p">[</span><span class="n">k</span><span class="p">]),</span> <span class="n">sta</span><span class="o">.</span><span class="n">wc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                    <span class="p">)</span>
                    <span class="n">sta</span><span class="o">.</span><span class="n">sp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">refr</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                    <span class="n">sta</span><span class="o">.</span><span class="n">wc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-=</span> <span class="n">flu</span><span class="o">.</span><span class="n">refr</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">refr</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">refr</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">wc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">sp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>


<div class="viewcode-block" id="Calc_In_WC_V1"><a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_In_WC_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_In_WC_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the actual water release from the snow layer due to the</span>
<span class="sd">    exceedance of the snow layers capacity for (liquid) water.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      :math:`\\frac{dWC}{dt} = -In` \n</span>
<span class="sd">      :math:`-In = max(WC - WHC \\cdot SP, 0)`</span>

<span class="sd">    Examples:</span>

<span class="sd">        Initialize six zones of different types and frozen water</span>
<span class="sd">        contents of the snow layer and set the relative water holding</span>
<span class="sd">        capacity to 20% of the respective frozen water content:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(6)</span>
<span class="sd">        &gt;&gt;&gt; zonetype(ILAKE, GLACIER, FIELD, FOREST, FIELD, FIELD)</span>
<span class="sd">        &gt;&gt;&gt; whc(0.2)</span>
<span class="sd">        &gt;&gt;&gt; states.sp = 0.0, 10.0, 10.0, 10.0, 5.0, 0.0</span>

<span class="sd">        Also set the actual value of stand precipitation to 5 mm/d:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.tf = 5.0</span>

<span class="sd">        When there is no (liquid) water content in the snow layer, no water</span>
<span class="sd">        can be released:</span>

<span class="sd">        &gt;&gt;&gt; states.wc = 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_in_wc_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.in_</span>
<span class="sd">        in_(5.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.wc</span>
<span class="sd">        wc(0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>

<span class="sd">        When there is a (liquid) water content in the snow layer, the water</span>
<span class="sd">        release depends on the frozen water content.  Note the special</span>
<span class="sd">        cases of the first zone being an internal lake, for which the snow</span>
<span class="sd">        routine does not apply, and of the last zone, which has no ice</span>
<span class="sd">        content and thus effectively not really a snow layer:</span>

<span class="sd">        &gt;&gt;&gt; states.wc = 5.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_in_wc_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.in_</span>
<span class="sd">        in_(5.0, 3.0, 3.0, 3.0, 4.0, 5.0)</span>
<span class="sd">        &gt;&gt;&gt; states.wc</span>
<span class="sd">        wc(0.0, 2.0, 2.0, 2.0, 1.0, 0.0)</span>

<span class="sd">        When the relative water holding capacity is assumed to be zero,</span>
<span class="sd">        all liquid water is released:</span>

<span class="sd">        &gt;&gt;&gt; whc(0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.wc = 5.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_in_wc_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.in_</span>
<span class="sd">        in_(5.0, 5.0, 5.0, 5.0, 5.0, 5.0)</span>
<span class="sd">        &gt;&gt;&gt; states.wc</span>
<span class="sd">        wc(0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>

<span class="sd">        Note that for the single lake zone, stand precipitation is</span>
<span class="sd">        directly passed to `in_` in all three examples.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneType</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">WHC</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_fluxes</span><span class="o">.</span><span class="n">TF</span><span class="p">,</span>
        <span class="n">hland_states</span><span class="o">.</span><span class="n">SP</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_states</span><span class="o">.</span><span class="n">WC</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">In_</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">zonetype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">!=</span> <span class="n">ILAKE</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">in_</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">wc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">whc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">sta</span><span class="o">.</span><span class="n">sp</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">)</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">wc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-=</span> <span class="n">flu</span><span class="o">.</span><span class="n">in_</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">in_</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">tf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">wc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>


<div class="viewcode-block" id="Calc_GlMelt_In_V1"><a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_GlMelt_In_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_GlMelt_In_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate melting from glaciers which are actually not covered by</span>
<span class="sd">    a snow layer and add it to the water release of the snow module.</span>

<span class="sd">    Basic equation:</span>

<span class="sd">      :math:`GlMelt = \\Bigl \\lbrace</span>
<span class="sd">      {</span>
<span class="sd">      {max(GMelt \\cdot (TC-TTM), 0) \\ | \\ SP = 0}</span>
<span class="sd">      \\atop</span>
<span class="sd">      {0 \\ | \\ SP &gt; 0}</span>
<span class="sd">      }`</span>

<span class="sd">    Examples:</span>

<span class="sd">        Seven zones are prepared, but glacier melting occurs only</span>
<span class="sd">        in the fourth one, as the first three zones are no glaciers, the</span>
<span class="sd">        fifth zone is covered by a snow layer and the actual temperature</span>
<span class="sd">        of the last two zones is not above the threshold temperature:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(7)</span>
<span class="sd">        &gt;&gt;&gt; zonetype(FIELD, FOREST, ILAKE, GLACIER, GLACIER, GLACIER, GLACIER)</span>
<span class="sd">        &gt;&gt;&gt; gmelt(4.)</span>
<span class="sd">        &gt;&gt;&gt; derived.ttm(2.)</span>
<span class="sd">        &gt;&gt;&gt; states.sp = 0., 0., 0., 0., .1, 0., 0.</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tc = 3., 3., 3., 3., 3., 2., 1.</span>
<span class="sd">        &gt;&gt;&gt; fluxes.in_ = 3.</span>
<span class="sd">        &gt;&gt;&gt; model.calc_glmelt_in_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.glmelt</span>
<span class="sd">        glmelt(0.0, 0.0, 0.0, 2.0, 0.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.in_</span>
<span class="sd">        in_(3.0, 3.0, 3.0, 5.0, 3.0, 3.0, 3.0)</span>

<span class="sd">        Note that the assumed length of the simulation step is only</span>
<span class="sd">        a half day. Hence the effective value of the degree day factor</span>
<span class="sd">        is not 4 but 2:</span>

<span class="sd">        &gt;&gt;&gt; gmelt</span>
<span class="sd">        gmelt(4.0)</span>
<span class="sd">        &gt;&gt;&gt; gmelt.values</span>
<span class="sd">        array([ 2.,  2.,  2.,  2.,  2.,  2.,  2.])</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneType</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">GMelt</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_derived</span><span class="o">.</span><span class="n">TTM</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_states</span><span class="o">.</span><span class="n">SP</span><span class="p">,</span>
        <span class="n">hland_fluxes</span><span class="o">.</span><span class="n">TC</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">In_</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">GlMelt</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">zonetype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">GLACIER</span><span class="p">)</span>
                <span class="ow">and</span> <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">sp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">)</span>
                <span class="ow">and</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">tc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">der</span><span class="o">.</span><span class="n">ttm</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">glmelt</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">gmelt</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">tc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">der</span><span class="o">.</span><span class="n">ttm</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">in_</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">glmelt</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">glmelt</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>


<div class="viewcode-block" id="Calc_R_SM_V1"><a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_R_SM_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_R_SM_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate effective precipitation and update soil moisture.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      :math:`\\frac{dSM}{dt} = IN - R` \n</span>
<span class="sd">      :math:`R = IN \\cdot \\left(\\frac{SM}{FC}\\right)^{Beta}`</span>


<span class="sd">    Examples:</span>

<span class="sd">        Initialize six zones of different types.  The field</span>
<span class="sd">        capacity of all fields and forests is set to 200mm, the input</span>
<span class="sd">        of each zone is 10mm:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(6)</span>
<span class="sd">        &gt;&gt;&gt; zonetype(ILAKE, GLACIER, FIELD, FOREST, FIELD, FIELD)</span>
<span class="sd">        &gt;&gt;&gt; fc(200.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.in_ = 10.0</span>

<span class="sd">        With a common nonlinearity parameter value of 2, a relative</span>
<span class="sd">        soil moisture of 50%  (zones three and four) results in a</span>
<span class="sd">        discharge coefficient of 25%. For a soil completely dried</span>
<span class="sd">        (zone five) or completely saturated (one six) the discharge</span>
<span class="sd">        coefficient does not depend on the nonlinearity parameter and</span>
<span class="sd">        is 0% and 100% respectively.  Glaciers and internal lakes also</span>
<span class="sd">        always route 100% of their input as effective precipitation:</span>

<span class="sd">        &gt;&gt;&gt; beta(2.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sm = 0.0, 0.0, 100.0, 100.0, 0.0, 200.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_r_sm_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.r</span>
<span class="sd">        r(10.0, 10.0, 2.5, 2.5, 0.0, 10.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sm</span>
<span class="sd">        sm(0.0, 0.0, 107.5, 107.5, 10.0, 200.0)</span>

<span class="sd">        Through decreasing the nonlinearity parameter, the discharge</span>
<span class="sd">        coefficient increases.  A parameter value of zero leads to a</span>
<span class="sd">        discharge coefficient of 100% for any soil moisture:</span>

<span class="sd">        &gt;&gt;&gt; beta(0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sm = 0.0, 0.0, 100.0, 100.0, 0.0, 200.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_r_sm_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.r</span>
<span class="sd">        r(10.0, 10.0, 10.0, 10.0, 10.0, 10.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sm</span>
<span class="sd">        sm(0.0, 0.0, 100.0, 100.0, 0.0, 200.0)</span>

<span class="sd">        With zero field capacity, the discharge coefficient also always</span>
<span class="sd">        equates to 100%:</span>

<span class="sd">        &gt;&gt;&gt; fc(0.0)</span>
<span class="sd">        &gt;&gt;&gt; beta(2.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sm = 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_r_sm_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.r</span>
<span class="sd">        r(10.0, 10.0, 10.0, 10.0, 10.0, 10.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sm</span>
<span class="sd">        sm(0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneType</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">FC</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">Beta</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">In_</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_states</span><span class="o">.</span><span class="n">SM</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">R</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">zonetype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">FIELD</span><span class="p">,</span> <span class="n">FOREST</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">fc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">in_</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">sm</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">con</span><span class="o">.</span><span class="n">fc</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">**</span> <span class="n">con</span><span class="o">.</span><span class="n">beta</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">sta</span><span class="o">.</span><span class="n">sm</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">in_</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">fc</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">in_</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">sm</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">in_</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">in_</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">sm</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>


<div class="viewcode-block" id="Calc_CF_SM_V1"><a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_CF_SM_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_CF_SM_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate capillary flow and update soil moisture.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      :math:`\\frac{dSM}{dt} = CF` \n</span>
<span class="sd">      :math:`CF = CFLUX \\cdot (1 - \\frac{SM}{FC})`</span>

<span class="sd">    Examples:</span>

<span class="sd">        Initialize six zones of different types.  The field</span>
<span class="sd">        capacity of als fields and forests is set to 200mm, the maximum</span>
<span class="sd">        capillary flow rate is 4mm/d:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(6)</span>
<span class="sd">        &gt;&gt;&gt; zonetype(ILAKE, GLACIER, FIELD, FOREST, FIELD, FIELD)</span>
<span class="sd">        &gt;&gt;&gt; fc(200.0)</span>
<span class="sd">        &gt;&gt;&gt; cflux(4.0)</span>

<span class="sd">        Note that the assumed length of the simulation step is only</span>
<span class="sd">        a half day.  Hence the maximum capillary flow per simulation</span>
<span class="sd">        step is 2 instead of 4:</span>

<span class="sd">        &gt;&gt;&gt; cflux</span>
<span class="sd">        cflux(4.0)</span>
<span class="sd">        &gt;&gt;&gt; cflux.values</span>
<span class="sd">        array([ 2.,  2.,  2.,  2.,  2.,  2.])</span>

<span class="sd">        For fields and forests, the actual capillary return flow depends</span>
<span class="sd">        on the relative soil moisture deficite, if either the upper zone</span>
<span class="sd">        layer provides enough water...</span>

<span class="sd">        &gt;&gt;&gt; fluxes.r = 0.0</span>
<span class="sd">        &gt;&gt;&gt; states.sm = 0.0, 0.0, 100.0, 100.0, 0.0, 200.0</span>
<span class="sd">        &gt;&gt;&gt; states.uz = 20.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_cf_sm_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.cf</span>
<span class="sd">        cf(0.0, 0.0, 1.0, 1.0, 2.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sm</span>
<span class="sd">        sm(0.0, 0.0, 101.0, 101.0, 2.0, 200.0)</span>

<span class="sd">        ...our enough effective precipitation is generated, which can be</span>
<span class="sd">        rerouted directly:</span>

<span class="sd">        &gt;&gt;&gt; cflux(4.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.r = 10.0</span>
<span class="sd">        &gt;&gt;&gt; states.sm = 0.0, 0.0, 100.0, 100.0, 0.0, 200.0</span>
<span class="sd">        &gt;&gt;&gt; states.uz = 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_cf_sm_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.cf</span>
<span class="sd">        cf(0.0, 0.0, 1.0, 1.0, 2.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sm</span>
<span class="sd">        sm(0.0, 0.0, 101.0, 101.0, 2.0, 200.0)</span>

<span class="sd">        If the upper zone layer is empty and no effective precipitation is</span>
<span class="sd">        generated, capillary flow is zero:</span>

<span class="sd">        &gt;&gt;&gt; cflux(4.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.r = 0.0</span>
<span class="sd">        &gt;&gt;&gt; states.sm = 0.0, 0.0, 100.0, 100.0, 0.0, 200.0</span>
<span class="sd">        &gt;&gt;&gt; states.uz = 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_cf_sm_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.cf</span>
<span class="sd">        cf(0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sm</span>
<span class="sd">        sm(0.0, 0.0, 100.0, 100.0, 0.0, 200.0)</span>

<span class="sd">        Here an example, where both the upper zone layer and effective</span>
<span class="sd">        precipitation provide water for the capillary flow, but less then</span>
<span class="sd">        the maximum flow rate times the relative soil moisture:</span>

<span class="sd">        &gt;&gt;&gt; cflux(4.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.r = 0.1</span>
<span class="sd">        &gt;&gt;&gt; states.sm = 0.0, 0.0, 100.0, 100.0, 0.0, 200.0</span>
<span class="sd">        &gt;&gt;&gt; states.uz = 0.2</span>
<span class="sd">        &gt;&gt;&gt; model.calc_cf_sm_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.cf</span>
<span class="sd">        cf(0.0, 0.0, 0.3, 0.3, 0.3, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sm</span>
<span class="sd">        sm(0.0, 0.0, 100.3, 100.3, 0.3, 200.0)</span>

<span class="sd">        Even unrealistic high maximum capillary flow rates do not result</span>
<span class="sd">        in overfilled soils:</span>

<span class="sd">        &gt;&gt;&gt; cflux(1000.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.r = 200.0</span>
<span class="sd">        &gt;&gt;&gt; states.sm = 0.0, 0.0, 100.0, 100.0, 0.0, 200.0</span>
<span class="sd">        &gt;&gt;&gt; states.uz = 200.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_cf_sm_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.cf</span>
<span class="sd">        cf(0.0, 0.0, 100.0, 100.0, 200.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sm</span>
<span class="sd">        sm(0.0, 0.0, 200.0, 200.0, 200.0, 200.0)</span>

<span class="sd">        For (unrealistic) soils with zero field capacity, capillary flow</span>
<span class="sd">        is always zero:</span>

<span class="sd">        &gt;&gt;&gt; fc(0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sm = 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_cf_sm_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.cf</span>
<span class="sd">        cf(0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sm</span>
<span class="sd">        sm(0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneType</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">FC</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">CFlux</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_fluxes</span><span class="o">.</span><span class="n">R</span><span class="p">,</span>
        <span class="n">hland_states</span><span class="o">.</span><span class="n">UZ</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_states</span><span class="o">.</span><span class="n">SM</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">CF</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">zonetype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">FIELD</span><span class="p">,</span> <span class="n">FOREST</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">fc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">cf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cflux</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">sta</span><span class="o">.</span><span class="n">sm</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">con</span><span class="o">.</span><span class="n">fc</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">cf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">cf</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">sta</span><span class="o">.</span><span class="n">uz</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">cf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">cf</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">con</span><span class="o">.</span><span class="n">fc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">sta</span><span class="o">.</span><span class="n">sm</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">cf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">sm</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">cf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">cf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">sm</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>


<div class="viewcode-block" id="Calc_EA_SM_V1"><a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_EA_SM_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_EA_SM_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate soil evaporation and update soil moisture.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      :math:`\\frac{dSM}{dt} = - EA` \n</span>
<span class="sd">      :math:`EA_{temp} = \\biggl \\lbrace</span>
<span class="sd">      {</span>
<span class="sd">      {EPC \\cdot min\\left(\\frac{SM}{LP \\cdot FC}, 1\\right)</span>
<span class="sd">      \\ | \\ SP = 0}</span>
<span class="sd">      \\atop</span>
<span class="sd">      {0 \\ | \\ SP &gt; 0}</span>
<span class="sd">      }` \n</span>
<span class="sd">      :math:`EA = EA_{temp} - max(ERED \\cdot (EA_{temp} + EI - EPC), 0)`</span>

<span class="sd">    Examples:</span>

<span class="sd">        Initialize seven zones of different types.  The field capacity</span>
<span class="sd">         of all fields and forests is set to 200mm, potential evaporation</span>
<span class="sd">         and interception evaporation are 2mm and 1mm respectively:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(7)</span>
<span class="sd">        &gt;&gt;&gt; zonetype(ILAKE, GLACIER, FIELD, FOREST, FIELD, FIELD, FIELD)</span>
<span class="sd">        &gt;&gt;&gt; fc(200.0)</span>
<span class="sd">        &gt;&gt;&gt; lp(0.0, 0.0, 0.5, 0.5, 0.0, 0.8, 1.0)</span>
<span class="sd">        &gt;&gt;&gt; ered(0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.epc = 2.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.ei = 1.0</span>
<span class="sd">        &gt;&gt;&gt; states.sp = 0.0</span>

<span class="sd">        Only fields and forests include soils; for glaciers and zones (the</span>
<span class="sd">        first two zones) no soil evaporation is performed.  For fields and</span>
<span class="sd">        forests, the underlying calculations are the same. In the following</span>
<span class="sd">        example, the relative soil moisture is 50% in all field and forest</span>
<span class="sd">        zones.  Hence, differences in soil evaporation are related to the</span>
<span class="sd">        different soil evaporation parameter values only:</span>

<span class="sd">        &gt;&gt;&gt; states.sm = 100.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_ea_sm_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.ea</span>
<span class="sd">        ea(0.0, 0.0, 2.0, 2.0, 2.0, 1.25, 1.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sm</span>
<span class="sd">        sm(0.0, 0.0, 98.0, 98.0, 98.0, 98.75, 99.0)</span>

<span class="sd">        In the last example, evaporation values of 2mm have been calculated</span>
<span class="sd">        for some zones despite the fact, that these 2mm added to the actual</span>
<span class="sd">        interception evaporation of 1mm exceed potential evaporation.  This</span>
<span class="sd">        behaviour can be reduced...</span>

<span class="sd">        &gt;&gt;&gt; states.sm = 100.0</span>
<span class="sd">        &gt;&gt;&gt; ered(0.5)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_ea_sm_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.ea</span>
<span class="sd">        ea(0.0, 0.0, 1.5, 1.5, 1.5, 1.125, 1.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sm</span>
<span class="sd">        sm(0.0, 0.0, 98.5, 98.5, 98.5, 98.875, 99.0)</span>

<span class="sd">        ...or be completely excluded:</span>

<span class="sd">        &gt;&gt;&gt; states.sm = 100.0</span>
<span class="sd">        &gt;&gt;&gt; ered(1.0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_ea_sm_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.ea</span>
<span class="sd">        ea(0.0, 0.0, 1.0, 1.0, 1.0, 1.0, 1.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sm</span>
<span class="sd">        sm(0.0, 0.0, 99.0, 99.0, 99.0, 99.0, 99.0)</span>

<span class="sd">        Any occurrence of a snow layer suppresses soil evaporation</span>
<span class="sd">        completely:</span>

<span class="sd">        &gt;&gt;&gt; states.sp = 0.01</span>
<span class="sd">        &gt;&gt;&gt; states.sm = 100.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_ea_sm_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.ea</span>
<span class="sd">        ea(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sm</span>
<span class="sd">        sm(0.0, 0.0, 100.0, 100.0, 100.0, 100.0, 100.0)</span>

<span class="sd">        For (unrealistic) soils with zero field capacity, soil evaporation</span>
<span class="sd">        is always zero:</span>

<span class="sd">        &gt;&gt;&gt; fc(0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sm = 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_ea_sm_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.ea</span>
<span class="sd">        ea(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sm</span>
<span class="sd">        sm(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneType</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">LP</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">FC</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">ERed</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_states</span><span class="o">.</span><span class="n">SP</span><span class="p">,</span>
        <span class="n">hland_fluxes</span><span class="o">.</span><span class="n">EPC</span><span class="p">,</span>
        <span class="n">hland_fluxes</span><span class="o">.</span><span class="n">EI</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_states</span><span class="o">.</span><span class="n">SM</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">EA</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">zonetype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">FIELD</span><span class="p">,</span> <span class="n">FOREST</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">sp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">lp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">fc</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                        <span class="n">flu</span><span class="o">.</span><span class="n">ea</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">epc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">sta</span><span class="o">.</span><span class="n">sm</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">lp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">fc</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                        <span class="n">flu</span><span class="o">.</span><span class="n">ea</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">ea</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">flu</span><span class="o">.</span><span class="n">epc</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">flu</span><span class="o">.</span><span class="n">ea</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">epc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">ea</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-=</span> <span class="nb">max</span><span class="p">(</span>
                        <span class="n">con</span><span class="o">.</span><span class="n">ered</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">ea</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">ei</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">epc</span><span class="p">[</span><span class="n">k</span><span class="p">]),</span> <span class="mf">0.0</span>
                    <span class="p">)</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">ea</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">ea</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">sta</span><span class="o">.</span><span class="n">sm</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">ea</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">sm</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-=</span> <span class="n">flu</span><span class="o">.</span><span class="n">ea</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">ea</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">sm</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>


<div class="viewcode-block" id="Calc_InUZ_V1"><a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_InUZ_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_InUZ_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Accumulate the total inflow into the upper zone layer.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`InUZ = R - CF`</span>

<span class="sd">    Examples:</span>

<span class="sd">        Initialize three zones of different relative `land sizes`</span>
<span class="sd">        (area related to the total size of the subbasin except lake areas):</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(3)</span>
<span class="sd">        &gt;&gt;&gt; zonetype(FIELD, ILAKE, GLACIER)</span>
<span class="sd">        &gt;&gt;&gt; derived.rellandzonearea = 2.0/3.0, 0.0, 1.0/3.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.r = 6.0, 0.0, 2.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.cf = 2.0, 0.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_inuz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.inuz</span>
<span class="sd">        inuz(3.0)</span>

<span class="sd">        Internal lakes do not contribute to the upper zone layer.  Hence</span>
<span class="sd">        for a subbasin consisting only of interal lakes a zero input</span>
<span class="sd">        value would be calculated:</span>

<span class="sd">        &gt;&gt;&gt; zonetype(ILAKE, ILAKE, ILAKE)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_inuz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.inuz</span>
<span class="sd">        inuz(0.0)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneType</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_derived</span><span class="o">.</span><span class="n">RelLandZoneArea</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_fluxes</span><span class="o">.</span><span class="n">R</span><span class="p">,</span>
        <span class="n">hland_fluxes</span><span class="o">.</span><span class="n">CF</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">InUZ</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">inuz</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">zonetype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">!=</span> <span class="n">ILAKE</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">inuz</span> <span class="o">+=</span> <span class="n">der</span><span class="o">.</span><span class="n">rellandzonearea</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">cf</span><span class="p">[</span><span class="n">k</span><span class="p">])</span></div>


<div class="viewcode-block" id="Calc_ContriArea_V1"><a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_ContriArea_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_ContriArea_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Determine the relative size of the contributing area of the whole</span>
<span class="sd">    subbasin.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`ContriArea = \\left( \\frac{SM}{FC} \\right)^{Beta}`</span>

<span class="sd">    Examples:</span>

<span class="sd">        Four zones are initialized, but only the first two zones</span>
<span class="sd">        of type field and forest are taken into account in the calculation</span>
<span class="sd">        of the relative contributing area of the catchment (even, if also</span>
<span class="sd">        glaciers contribute to the inflow of the upper zone layer):</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(4)</span>
<span class="sd">        &gt;&gt;&gt; zonetype(FIELD, FOREST, GLACIER, ILAKE)</span>
<span class="sd">        &gt;&gt;&gt; beta(2.0)</span>
<span class="sd">        &gt;&gt;&gt; fc(200.0)</span>
<span class="sd">        &gt;&gt;&gt; resparea(True)</span>
<span class="sd">        &gt;&gt;&gt; derived.relsoilarea(0.5)</span>
<span class="sd">        &gt;&gt;&gt; derived.relsoilzonearea(1.0/3.0, 2.0/3.0, 0.0, 0.0)</span>

<span class="sd">        With a relative soil moisture of 100 % in the whole subbasin, the</span>
<span class="sd">        contributing area is also estimated as 100 %,...</span>

<span class="sd">        &gt;&gt;&gt; states.sm = 200.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_contriarea_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.contriarea</span>
<span class="sd">        contriarea(1.0)</span>

<span class="sd">        ...and relative soil moistures of 0% result in an contributing</span>
<span class="sd">        area of 0 %:</span>

<span class="sd">        &gt;&gt;&gt; states.sm = 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_contriarea_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.contriarea</span>
<span class="sd">        contriarea(0.0)</span>

<span class="sd">        With the given value 2 of the nonlinearity parameter Beta, soil</span>
<span class="sd">        moisture of 50 % results in a contributing area estimate of 25%:</span>

<span class="sd">        &gt;&gt;&gt; states.sm = 100.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_contriarea_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.contriarea</span>
<span class="sd">        contriarea(0.25)</span>

<span class="sd">        Setting the response area option to False,...</span>

<span class="sd">        &gt;&gt;&gt; resparea(False)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_contriarea_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.contriarea</span>
<span class="sd">        contriarea(1.0)</span>

<span class="sd">        ... setting the soil area (total area of all field and forest</span>
<span class="sd">        zones in the subbasin) to zero...,</span>

<span class="sd">        &gt;&gt;&gt; resparea(True)</span>
<span class="sd">        &gt;&gt;&gt; derived.relsoilarea(0.0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_contriarea_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.contriarea</span>
<span class="sd">        contriarea(1.0)</span>

<span class="sd">        ...or setting all field capacities to zero...</span>

<span class="sd">        &gt;&gt;&gt; derived.relsoilarea(0.5)</span>
<span class="sd">        &gt;&gt;&gt; fc(0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.sm = 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_contriarea_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.contriarea</span>
<span class="sd">        contriarea(1.0)</span>

<span class="sd">        ...leads to contributing area values of 100 %.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">RespArea</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneType</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">FC</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">Beta</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_derived</span><span class="o">.</span><span class="n">RelSoilArea</span><span class="p">,</span>
        <span class="n">hland_derived</span><span class="o">.</span><span class="n">RelSoilZoneArea</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_states</span><span class="o">.</span><span class="n">SM</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">ContriArea</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">contriarea</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">resparea</span> <span class="ow">and</span> <span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">relsoilarea</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">zonetype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">FIELD</span><span class="p">,</span> <span class="n">FOREST</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">fc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                        <span class="n">flu</span><span class="o">.</span><span class="n">contriarea</span> <span class="o">*=</span> <span class="p">(</span>
                            <span class="n">sta</span><span class="o">.</span><span class="n">sm</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">con</span><span class="o">.</span><span class="n">fc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                        <span class="p">)</span> <span class="o">**</span> <span class="n">der</span><span class="o">.</span><span class="n">relsoilzonearea</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">contriarea</span> <span class="o">**=</span> <span class="n">con</span><span class="o">.</span><span class="n">beta</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>


<div class="viewcode-block" id="Calc_Q0_Perc_UZ_V1"><a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_Q0_Perc_UZ_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_Q0_Perc_UZ_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Perform the upper zone layer routine which determines percolation</span>
<span class="sd">    to the lower zone layer and the fast response of the hland model.</span>

<span class="sd">    Note that the system behaviour of this method depends strongly on the</span>
<span class="sd">    specifications of the options |RespArea| and |RecStep|.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      :math:`\\frac{dUZ}{dt} = InUZ - Perc - Q0` \n</span>
<span class="sd">      :math:`Perc = PercMax \\cdot ContriArea` \n</span>
<span class="sd">      :math:`Q0 = K * \\cdot \\left( \\frac{UZ}{ContriArea} \\right)^{1+Alpha}`</span>

<span class="sd">    Examples:</span>

<span class="sd">        The upper zone layer routine is an exception compared to</span>
<span class="sd">        the other routines of the HydPy-H-Land model, regarding its</span>
<span class="sd">        consideration of numerical accuracy.  To increase the accuracy of</span>
<span class="sd">        the numerical integration of the underlying ordinary differential</span>
<span class="sd">        equation, each simulation step can be divided into substeps, which</span>
<span class="sd">        are all solved with first order accuracy.  In the first example,</span>
<span class="sd">        this option is omitted through setting the |RecStep| parameter to</span>
<span class="sd">        one:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; recstep(2)</span>
<span class="sd">        &gt;&gt;&gt; derived.dt = 1/recstep</span>
<span class="sd">        &gt;&gt;&gt; percmax(2.0)</span>
<span class="sd">        &gt;&gt;&gt; alpha(1.0)</span>
<span class="sd">        &gt;&gt;&gt; k(2.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.contriarea = 1.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.inuz = 0.0</span>
<span class="sd">        &gt;&gt;&gt; states.uz = 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_q0_perc_uz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.perc</span>
<span class="sd">        perc(1.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.q0</span>
<span class="sd">        q0(0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.uz</span>
<span class="sd">        uz(0.0)</span>

<span class="sd">        Due to the sequential calculation of the upper zone routine, the</span>
<span class="sd">        upper zone storage is drained completely through percolation and</span>
<span class="sd">        no water is left for fast discharge response.  By dividing the</span>
<span class="sd">        simulation step in 100 substeps, the results are quite different:</span>

<span class="sd">        &gt;&gt;&gt; recstep(200)</span>
<span class="sd">        &gt;&gt;&gt; derived.dt = 1.0/recstep</span>
<span class="sd">        &gt;&gt;&gt; states.uz = 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_q0_perc_uz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.perc</span>
<span class="sd">        perc(0.786934)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.q0</span>
<span class="sd">        q0(0.213066)</span>
<span class="sd">        &gt;&gt;&gt; states.uz</span>
<span class="sd">        uz(0.0)</span>

<span class="sd">        Note that the assumed length of the simulation step is only a</span>
<span class="sd">        half day. Hence the effective values of the maximum percolation</span>
<span class="sd">        rate and the storage coefficient is not 2 but 1:</span>

<span class="sd">        &gt;&gt;&gt; percmax</span>
<span class="sd">        percmax(2.0)</span>
<span class="sd">        &gt;&gt;&gt; k</span>
<span class="sd">        k(2.0)</span>
<span class="sd">        &gt;&gt;&gt; percmax.value</span>
<span class="sd">        1.0</span>
<span class="sd">        &gt;&gt;&gt; k.value</span>
<span class="sd">        1.0</span>

<span class="sd">        By decreasing the contributing area one decreases percolation but</span>
<span class="sd">        increases fast discharge response:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.contriarea = 0.5</span>
<span class="sd">        &gt;&gt;&gt; states.uz = 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_q0_perc_uz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.perc</span>
<span class="sd">        perc(0.434108)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.q0</span>
<span class="sd">        q0(0.565892)</span>
<span class="sd">        &gt;&gt;&gt; states.uz</span>
<span class="sd">        uz(0.0)</span>

<span class="sd">        Without any contributing area, the complete amount of water stored in</span>
<span class="sd">        the upper zone layer is released as direct discharge immediately:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.contriarea = 0.0</span>
<span class="sd">        &gt;&gt;&gt; states.uz = 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_q0_perc_uz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.perc</span>
<span class="sd">        perc(0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.q0</span>
<span class="sd">        q0(1.0)</span>
<span class="sd">        &gt;&gt;&gt; states.uz</span>
<span class="sd">        uz(0.0)</span>

<span class="sd">        Resetting |RecStep| leads to more transparent results.  Note that, due</span>
<span class="sd">        to the large value of the storage coefficient and the low accuracy</span>
<span class="sd">        of the numerical approximation, direct discharge drains the rest of</span>
<span class="sd">        the upper zone storage:</span>

<span class="sd">        &gt;&gt;&gt; recstep(2)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.contriarea = 0.5</span>
<span class="sd">        &gt;&gt;&gt; derived.dt = 1.0/recstep</span>
<span class="sd">        &gt;&gt;&gt; states.uz = 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_q0_perc_uz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.perc</span>
<span class="sd">        perc(0.5)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.q0</span>
<span class="sd">        q0(0.5)</span>
<span class="sd">        &gt;&gt;&gt; states.uz</span>
<span class="sd">        uz(0.0)</span>

<span class="sd">        Applying a more reasonable storage coefficient results in:</span>

<span class="sd">        &gt;&gt;&gt; k(0.5)</span>
<span class="sd">        &gt;&gt;&gt; states.uz = 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_q0_perc_uz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.perc</span>
<span class="sd">        perc(0.5)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.q0</span>
<span class="sd">        q0(0.25)</span>
<span class="sd">        &gt;&gt;&gt; states.uz</span>
<span class="sd">        uz(0.25)</span>

<span class="sd">        Adding an input of 0.3 mm results the same percolation value (which,</span>
<span class="sd">        in the given example, is determined by the maximum percolation rate</span>
<span class="sd">        only), but in an increases value of the direct response (which</span>
<span class="sd">        always depends on the actual upper zone storage directly):</span>

<span class="sd">        &gt;&gt;&gt; fluxes.inuz = 0.3</span>
<span class="sd">        &gt;&gt;&gt; states.uz = 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_q0_perc_uz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.perc</span>
<span class="sd">        perc(0.5)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.q0</span>
<span class="sd">        q0(0.64)</span>
<span class="sd">        &gt;&gt;&gt; states.uz</span>
<span class="sd">        uz(0.16)</span>

<span class="sd">        Due to the same reasons, another increase in numerical accuracy has</span>
<span class="sd">        no impact on percolation but decreases the direct response in the</span>
<span class="sd">        given example:</span>

<span class="sd">        &gt;&gt;&gt; recstep(200)</span>
<span class="sd">        &gt;&gt;&gt; derived.dt = 1.0/recstep</span>
<span class="sd">        &gt;&gt;&gt; states.uz = 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_q0_perc_uz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.perc</span>
<span class="sd">        perc(0.5)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.q0</span>
<span class="sd">        q0(0.421708)</span>
<span class="sd">        &gt;&gt;&gt; states.uz</span>
<span class="sd">        uz(0.378292)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">RecStep</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">PercMax</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">K</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">Alpha</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_derived</span><span class="o">.</span><span class="n">DT</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_fluxes</span><span class="o">.</span><span class="n">ContriArea</span><span class="p">,</span>
        <span class="n">hland_fluxes</span><span class="o">.</span><span class="n">InUZ</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_states</span><span class="o">.</span><span class="n">UZ</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_fluxes</span><span class="o">.</span><span class="n">Perc</span><span class="p">,</span>
        <span class="n">hland_fluxes</span><span class="o">.</span><span class="n">Q0</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">perc</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">q0</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">dummy</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">recstep</span><span class="p">):</span>
            <span class="n">sta</span><span class="o">.</span><span class="n">uz</span> <span class="o">+=</span> <span class="n">der</span><span class="o">.</span><span class="n">dt</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">inuz</span>
            <span class="n">d_perc</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">dt</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">percmax</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">contriarea</span><span class="p">,</span> <span class="n">sta</span><span class="o">.</span><span class="n">uz</span><span class="p">)</span>
            <span class="n">sta</span><span class="o">.</span><span class="n">uz</span> <span class="o">-=</span> <span class="n">d_perc</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">perc</span> <span class="o">+=</span> <span class="n">d_perc</span>
            <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">uz</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">flu</span><span class="o">.</span><span class="n">contriarea</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">d_q0</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">der</span><span class="o">.</span><span class="n">dt</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">uz</span> <span class="o">/</span> <span class="n">flu</span><span class="o">.</span><span class="n">contriarea</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">con</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="n">d_q0</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">d_q0</span><span class="p">,</span> <span class="n">sta</span><span class="o">.</span><span class="n">uz</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">d_q0</span> <span class="o">=</span> <span class="n">sta</span><span class="o">.</span><span class="n">uz</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">uz</span> <span class="o">-=</span> <span class="n">d_q0</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">q0</span> <span class="o">+=</span> <span class="n">d_q0</span></div>


<div class="viewcode-block" id="Calc_LZ_V1"><a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_LZ_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_LZ_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Update the lower zone layer in accordance with percolation from</span>
<span class="sd">    upper groundwater to lower groundwater and/or in accordance with</span>
<span class="sd">    lake precipitation.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`\\frac{dLZ}{dt} = Perc + Pc`</span>

<span class="sd">    Examples:</span>

<span class="sd">        At first, a subbasin with two field zones is assumed (the zones</span>
<span class="sd">        could be of type forest or glacier as well).  In such zones,</span>
<span class="sd">        precipitation does not fall directly into the lower zone layer,</span>
<span class="sd">        hence the given precipitation of 2mm has no impact.  Only</span>
<span class="sd">        the actual percolation from the upper zone layer (underneath</span>
<span class="sd">        both field zones) is added to the lower zone storage:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(2)</span>
<span class="sd">        &gt;&gt;&gt; zonetype(FIELD, FIELD)</span>
<span class="sd">        &gt;&gt;&gt; derived.rellandarea = 1.0</span>
<span class="sd">        &gt;&gt;&gt; derived.relzonearea = 2.0/3.0, 1.0/3.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.perc = 2.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.pc = 5.0</span>
<span class="sd">        &gt;&gt;&gt; states.lz = 10.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_lz_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.lz</span>
<span class="sd">        lz(12.0)</span>

<span class="sd">        If the second zone is an internal lake, its precipitation falls</span>
<span class="sd">        on the lower zone layer directly.  Note that only 5/3mm</span>
<span class="sd">        precipitation are added, due to the relative size of the</span>
<span class="sd">        internal lake within the subbasin. Percolation from the upper</span>
<span class="sd">        zone layer increases the lower zone storage only by two thirds</span>
<span class="sd">        of its original value, due to the larger spatial extend of</span>
<span class="sd">        the lower zone layer:</span>

<span class="sd">        &gt;&gt;&gt; zonetype(FIELD, ILAKE)</span>
<span class="sd">        &gt;&gt;&gt; derived.rellandarea = 2.0/3.0</span>
<span class="sd">        &gt;&gt;&gt; derived.relzonearea = 2.0/3.0, 1.0/3.0</span>
<span class="sd">        &gt;&gt;&gt; states.lz = 10.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_lz_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.lz</span>
<span class="sd">        lz(13.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneType</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_derived</span><span class="o">.</span><span class="n">RelLandArea</span><span class="p">,</span>
        <span class="n">hland_derived</span><span class="o">.</span><span class="n">RelZoneArea</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_fluxes</span><span class="o">.</span><span class="n">Perc</span><span class="p">,</span>
        <span class="n">hland_fluxes</span><span class="o">.</span><span class="n">PC</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_states</span><span class="o">.</span><span class="n">LZ</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span><span class="o">.</span><span class="n">lz</span> <span class="o">+=</span> <span class="n">der</span><span class="o">.</span><span class="n">rellandarea</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">perc</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">zonetype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">ILAKE</span><span class="p">:</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">lz</span> <span class="o">+=</span> <span class="n">der</span><span class="o">.</span><span class="n">relzonearea</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">pc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>


<div class="viewcode-block" id="Calc_EL_LZ_V1"><a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_EL_LZ_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_EL_LZ_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate lake evaporation.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">        :math:`\\frac{dLZ}{dt} = -EL` \n</span>
<span class="sd">        :math:`EL = \\Bigl \\lbrace</span>
<span class="sd">        {</span>
<span class="sd">        {EPC \\ | \\ TC &gt; TTIce}</span>
<span class="sd">        \\atop</span>
<span class="sd">        {0 \\ | \\ TC \\leq TTIce}</span>
<span class="sd">        }`</span>

<span class="sd">    Examples:</span>

<span class="sd">        Six zones of the same size are initialized.  The first three</span>
<span class="sd">        zones are no internal lakes, they can not exhibit any lake</span>
<span class="sd">        evaporation.  Of the last three zones, which are internal lakes,</span>
<span class="sd">        only the last one evaporates water.  For zones five and six,</span>
<span class="sd">        evaporation is suppressed due to an assumed ice layer, whenever</span>
<span class="sd">        the associated theshold temperature is not exceeded:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(6)</span>
<span class="sd">        &gt;&gt;&gt; zonetype(FIELD, FOREST, GLACIER, ILAKE, ILAKE, ILAKE)</span>
<span class="sd">        &gt;&gt;&gt; ttice(-1.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.relzonearea = 1.0/6.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.epc = 0.6</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tc = 0.0, 0.0, 0.0, 0.0, -1.0, -2.0</span>
<span class="sd">        &gt;&gt;&gt; states.lz = 10.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_el_lz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.el</span>
<span class="sd">        el(0.0, 0.0, 0.0, 0.6, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.lz</span>
<span class="sd">        lz(9.9)</span>

<span class="sd">        Note that internal lakes always contain water.  Hence, the</span>
<span class="sd">        HydPy-H-Land model allows for negative values of the lower</span>
<span class="sd">        zone storage:</span>

<span class="sd">        &gt;&gt;&gt; states.lz = 0.05</span>
<span class="sd">        &gt;&gt;&gt; model.calc_el_lz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.el</span>
<span class="sd">        el(0.0, 0.0, 0.0, 0.6, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.lz</span>
<span class="sd">        lz(-0.05)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">ZoneType</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">TTIce</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_derived</span><span class="o">.</span><span class="n">RelZoneArea</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_fluxes</span><span class="o">.</span><span class="n">TC</span><span class="p">,</span>
        <span class="n">hland_fluxes</span><span class="o">.</span><span class="n">EPC</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_states</span><span class="o">.</span><span class="n">LZ</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">EL</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">zonetype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">ILAKE</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">tc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">con</span><span class="o">.</span><span class="n">ttice</span><span class="p">[</span><span class="n">k</span><span class="p">]):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">el</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">epc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">lz</span> <span class="o">-=</span> <span class="n">der</span><span class="o">.</span><span class="n">relzonearea</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">el</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">el</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>


<div class="viewcode-block" id="Calc_Q1_LZ_V1"><a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_Q1_LZ_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_Q1_LZ_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the slow response of the lower zone layer.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">        :math:`\\frac{dLZ}{dt} = -Q1` \n</span>
<span class="sd">        :math:`Q1 = \\Bigl \\lbrace</span>
<span class="sd">        {</span>
<span class="sd">        {K4 \\cdot LZ^{1+Gamma} \\ | \\ LZ &gt; 0}</span>
<span class="sd">        \\atop</span>
<span class="sd">        {0 \\ | \\ LZ\\leq 0}</span>
<span class="sd">        }`</span>

<span class="sd">    Examples:</span>

<span class="sd">        As long as the lower zone storage is negative...</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; k4(0.2)</span>
<span class="sd">        &gt;&gt;&gt; gamma(0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.lz = -2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_q1_lz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.q1</span>
<span class="sd">        q1(0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.lz</span>
<span class="sd">        lz(-2.0)</span>

<span class="sd">        ...or zero, no slow discharge response occurs:</span>

<span class="sd">        &gt;&gt;&gt; states.lz = 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_q1_lz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.q1</span>
<span class="sd">        q1(0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.lz</span>
<span class="sd">        lz(0.0)</span>

<span class="sd">        For storage values above zero the linear...</span>

<span class="sd">        &gt;&gt;&gt; states.lz = 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_q1_lz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.q1</span>
<span class="sd">        q1(0.2)</span>
<span class="sd">        &gt;&gt;&gt; states.lz</span>
<span class="sd">        lz(1.8)</span>

<span class="sd">        ...or nonlinear storage routing equation applies:</span>

<span class="sd">        &gt;&gt;&gt; gamma(1.)</span>
<span class="sd">        &gt;&gt;&gt; states.lz = 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_q1_lz_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.q1</span>
<span class="sd">        q1(0.4)</span>
<span class="sd">        &gt;&gt;&gt; states.lz</span>
<span class="sd">        lz(1.6)</span>

<span class="sd">        Note that the assumed length of the simulation step is only a</span>
<span class="sd">        half day. Hence the effective value of the storage coefficient</span>
<span class="sd">        is not 0.2 but 0.1:</span>

<span class="sd">        &gt;&gt;&gt; k4</span>
<span class="sd">        k4(0.2)</span>
<span class="sd">        &gt;&gt;&gt; k4.value</span>
<span class="sd">        0.1</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">K4</span><span class="p">,</span>
        <span class="n">hland_control</span><span class="o">.</span><span class="n">Gamma</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_states</span><span class="o">.</span><span class="n">LZ</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">Q1</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">lz</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">q1</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">k4</span> <span class="o">*</span> <span class="n">sta</span><span class="o">.</span><span class="n">lz</span> <span class="o">**</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">con</span><span class="o">.</span><span class="n">gamma</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">q1</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">sta</span><span class="o">.</span><span class="n">lz</span> <span class="o">-=</span> <span class="n">flu</span><span class="o">.</span><span class="n">q1</span></div>


<div class="viewcode-block" id="Calc_InUH_V1"><a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_InUH_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_InUH_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the unit hydrograph input.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">        :math:`InUH = Q0 + Q1`</span>

<span class="sd">    Example:</span>

<span class="sd">        The unit hydrographs receives base flow from the whole subbasin</span>
<span class="sd">        and direct flow from zones of type field, forest and glacier only.</span>
<span class="sd">        In the following example, these occupy only one half of the</span>
<span class="sd">        subbasin, which is why the partial input of q0 is halved:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; derived.rellandarea = 0.5</span>
<span class="sd">        &gt;&gt;&gt; fluxes.q0 = 4.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.q1 = 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_inuh_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.inuh</span>
<span class="sd">        inuh(3.0)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_derived</span><span class="o">.</span><span class="n">RelLandArea</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hland_fluxes</span><span class="o">.</span><span class="n">Q0</span><span class="p">,</span>
        <span class="n">hland_fluxes</span><span class="o">.</span><span class="n">Q1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">InUH</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">inuh</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">rellandarea</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">q0</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">q1</span></div>


<div class="viewcode-block" id="Calc_OutUH_QUH_V1"><a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_OutUH_QUH_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_OutUH_QUH_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the unit hydrograph output (convolution).</span>

<span class="sd">    Examples:</span>

<span class="sd">        Prepare a unit hydrograph with only three ordinates ---</span>
<span class="sd">        representing a fast catchment response compared to the selected</span>
<span class="sd">        step size:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; derived.uh.shape = 3</span>
<span class="sd">        &gt;&gt;&gt; derived.uh = 0.3, 0.5, 0.2</span>
<span class="sd">        &gt;&gt;&gt; logs.quh.shape = 3</span>
<span class="sd">        &gt;&gt;&gt; logs.quh = 1.0, 3.0, 0.0</span>

<span class="sd">        Without new input, the actual output is simply the first value</span>
<span class="sd">        stored in the logging sequence and the values of the logging</span>
<span class="sd">        sequence are shifted to the left:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.inuh = 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_outuh_quh_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.outuh</span>
<span class="sd">        outuh(1.0)</span>
<span class="sd">        &gt;&gt;&gt; logs.quh</span>
<span class="sd">        quh(3.0, 0.0, 0.0)</span>

<span class="sd">        With an new input of 4mm, the actual output consists of the first</span>
<span class="sd">        value stored in the logging sequence and the input value</span>
<span class="sd">        multiplied with the first unit hydrograph ordinate.  The updated</span>
<span class="sd">        logging sequence values result from the multiplication of the</span>
<span class="sd">        input values and the remaining ordinates:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.inuh = 4.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_outuh_quh_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.outuh</span>
<span class="sd">        outuh(4.2)</span>
<span class="sd">        &gt;&gt;&gt; logs.quh</span>
<span class="sd">        quh(2.0, 0.8, 0.0)</span>

<span class="sd">        The next example demonstates the updating of non empty logging</span>
<span class="sd">        sequence:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.inuh = 4.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_outuh_quh_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.outuh</span>
<span class="sd">        outuh(3.2)</span>
<span class="sd">        &gt;&gt;&gt; logs.quh</span>
<span class="sd">        quh(2.8, 0.8, 0.0)</span>

<span class="sd">        A unit hydrograph with only one ordinate results in the direct</span>
<span class="sd">        routing of the input:</span>

<span class="sd">        &gt;&gt;&gt; derived.uh.shape = 1</span>
<span class="sd">        &gt;&gt;&gt; derived.uh = 1.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.inuh = 0.0</span>
<span class="sd">        &gt;&gt;&gt; logs.quh.shape = 1</span>
<span class="sd">        &gt;&gt;&gt; logs.quh = 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_outuh_quh_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.outuh</span>
<span class="sd">        outuh(0.0)</span>
<span class="sd">        &gt;&gt;&gt; logs.quh</span>
<span class="sd">        quh(0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.inuh = 4.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_outuh_quh()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.outuh</span>
<span class="sd">        outuh(4.0)</span>
<span class="sd">        &gt;&gt;&gt; logs.quh</span>
<span class="sd">        quh(0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_derived</span><span class="o">.</span><span class="n">UH</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">InUH</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_logs</span><span class="o">.</span><span class="n">QUH</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">OutUH</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">logs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">outuh</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">uh</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">inuh</span> <span class="o">+</span> <span class="n">log</span><span class="o">.</span><span class="n">quh</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">jdx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">uh</span><span class="p">)):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">quh</span><span class="p">[</span><span class="n">jdx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">uh</span><span class="p">[</span><span class="n">jdx</span><span class="p">]</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">inuh</span> <span class="o">+</span> <span class="n">log</span><span class="o">.</span><span class="n">quh</span><span class="p">[</span><span class="n">jdx</span><span class="p">]</span></div>


<div class="viewcode-block" id="Calc_QT_V1"><a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Calc_QT_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_QT_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the total discharge after possible abstractions.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">        :math:`QT = max(QFactor \\cdot OutUH - Abstr, 0)`</span>

<span class="sd">    Examples:</span>

<span class="sd">        Trying to abstract less then available, as much as available and</span>
<span class="sd">        less then available results in:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; abstr(1.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.qfactor(0.5)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.outuh = 4.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qt_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qt</span>
<span class="sd">        qt(1.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.outuh = 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qt_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qt</span>
<span class="sd">        qt(0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.outuh = 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qt_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qt</span>
<span class="sd">        qt(0.0)</span>

<span class="sd">        Note that &quot;negative abstractions&quot; are allowed:</span>

<span class="sd">        &gt;&gt;&gt; abstr(-1.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.outuh = 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qt_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qt</span>
<span class="sd">        qt(2.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_control</span><span class="o">.</span><span class="n">Abstr</span><span class="p">,)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_derived</span><span class="o">.</span><span class="n">QFactor</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">OutUH</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">QT</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">qt</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">qfactor</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">outuh</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">abstr</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span></div>


<div class="viewcode-block" id="Pass_Q_v1"><a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Pass_Q_v1">[docs]</a><span class="k">class</span> <span class="nc">Pass_Q_v1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Update the outlet link sequence.&quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_fluxes</span><span class="o">.</span><span class="n">QT</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">hland_outlets</span><span class="o">.</span><span class="n">Q</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">outlets</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">out</span><span class="o">.</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">qt</span></div>


<div class="viewcode-block" id="Model"><a class="viewcode-back" href="../../../../hland.html#hydpy.models.hland.hland_model.Model">[docs]</a><span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">AdHocModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The HydPy-H-Land base model.&quot;&quot;&quot;</span>

    <span class="n">INLET_METHODS</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">RECEIVER_METHODS</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">RUN_METHODS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Calc_TC_V1</span><span class="p">,</span>
        <span class="n">Calc_TMean_V1</span><span class="p">,</span>
        <span class="n">Calc_FracRain_V1</span><span class="p">,</span>
        <span class="n">Calc_RFC_SFC_V1</span><span class="p">,</span>
        <span class="n">Calc_PC_V1</span><span class="p">,</span>
        <span class="n">Calc_EP_V1</span><span class="p">,</span>
        <span class="n">Calc_EPC_V1</span><span class="p">,</span>
        <span class="n">Calc_TF_Ic_V1</span><span class="p">,</span>
        <span class="n">Calc_EI_Ic_V1</span><span class="p">,</span>
        <span class="n">Calc_SP_WC_V1</span><span class="p">,</span>
        <span class="n">Calc_Melt_SP_WC_V1</span><span class="p">,</span>
        <span class="n">Calc_Refr_SP_WC_V1</span><span class="p">,</span>
        <span class="n">Calc_In_WC_V1</span><span class="p">,</span>
        <span class="n">Calc_GlMelt_In_V1</span><span class="p">,</span>
        <span class="n">Calc_R_SM_V1</span><span class="p">,</span>
        <span class="n">Calc_CF_SM_V1</span><span class="p">,</span>
        <span class="n">Calc_EA_SM_V1</span><span class="p">,</span>
        <span class="n">Calc_InUZ_V1</span><span class="p">,</span>
        <span class="n">Calc_ContriArea_V1</span><span class="p">,</span>
        <span class="n">Calc_Q0_Perc_UZ_V1</span><span class="p">,</span>
        <span class="n">Calc_LZ_V1</span><span class="p">,</span>
        <span class="n">Calc_EL_LZ_V1</span><span class="p">,</span>
        <span class="n">Calc_Q1_LZ_V1</span><span class="p">,</span>
        <span class="n">Calc_InUH_V1</span><span class="p">,</span>
        <span class="n">Calc_OutUH_QUH_V1</span><span class="p">,</span>
        <span class="n">Calc_QT_V1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ADD_METHODS</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">OUTLET_METHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Pass_Q_v1</span><span class="p">,)</span>
    <span class="n">SENDER_METHODS</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">SUBMODELS</span> <span class="o">=</span> <span class="p">()</span></div>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../../index.html">
              <img class="logo" src="../../../../_static/HydPy_Logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="../../../../index.html">Table of Contents</a></h3>
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../install.html">Installation Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../how_to.html">How to…</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../framework.html">Framework Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../modelcollection.html">Model Collection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../development.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../examples.html">Example Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../zbibliography.html">Bibliography</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">HydPy 4.0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">hydpy.models.hland.hland_model</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2021, HydPy Developers.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.5.2.
    </div>
  </body>
</html>