<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>hydpy.exe.servertools &#8212; HydPy 5.0.3 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../../_static/classic.css?v=127cebf3" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=eafc0fe6" />
    
    <script src="../../../_static/documentation_options.js?v=f98c4cc8"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">HydPy 5.0.3 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">hydpy.exe.servertools</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/HydPy_Logo.png" alt="Logo"/>
            </a></p>
  <div>
    <h3><a href="../../../index.html">Table of Contents</a></h3>
    <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installation Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../how_to.html">How toâ€¦</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../framework.html">Framework Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modelcollection.html">Model Collection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../development.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples.html">Example Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../zbibliography.html">Bibliography</a></li>
</ul>

  </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for hydpy.exe.servertools</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;This module facilitates using *HydPy* as an HTTP server application.</span>

<span class="sd">.. _`OpenDA`: https://www.openda.org/</span>
<span class="sd">.. _`curl`: https://curl.haxx.se/</span>
<span class="sd">.. _`HydPy-OpenDA-Black-Box-Model-Wrapper`: \</span>
<span class="sd">https://github.com/hydpy-dev/OpenDA/tree/master/extensions/\</span>
<span class="sd">HydPyOpenDABBModelWrapper</span>
<span class="sd">.. _`issue`: https://github.com/hydpy-dev/OpenDA/issues</span>

<span class="sd">*HydPy* is designed to be used interactively or by executing individual Python scripts.</span>
<span class="sd">Consider the typical steps of calibrating model parameters.  Usually, one first</span>
<span class="sd">prepares an instance of class |HydPy|, then changes some parameter values and performs</span>
<span class="sd">a simulation, and finally inspects whether the new simulation results are better than</span>
<span class="sd">the ones of the original parameterisation or not.  One can perform these steps</span>
<span class="sd">manually (in a Python console) or apply optimisation tools like those provided by</span>
<span class="sd">|scipy| (usually in a Python script).</span>

<span class="sd">Performing or implementing such procedures is relatively simple, as long as all tools</span>
<span class="sd">are written in Python or come with a Python interface, which is not the case for some</span>
<span class="sd">relevant optimisation tools.  One example is `OpenDA`_, being written in Java, which</span>
<span class="sd">was the original reason for adding module |servertools| to the *HydPy* framework.</span>

<span class="sd">Module |servertools| solves such integration problems by running *HydPy* within an</span>
<span class="sd">HTTP server.  After starting such a server, one can use any HTTP client (e.g. `curl`_)</span>
<span class="sd">to perform the above steps.</span>

<span class="sd">The server&#39;s API is relatively simple, allowing performing a &quot;normal&quot; calibration using</span>
<span class="sd">only a few server methods.  However, it is also more restrictive than controlling</span>
<span class="sd">*HydPy* within a Python process.  Within a Python process, you are free to do anything.</span>
<span class="sd">Using the *HydPy* server, you are much more restricted to what was anticipated by the</span>
<span class="sd">framework developers.</span>

<span class="sd">Commonly but not mandatory, one configures the initial state of a *HydPy* server with</span>
<span class="sd">an XML file.  As an example, we prepare the `LahnH` project by calling function</span>
<span class="sd">|prepare_full_example_1|, which contains the XML configuration file</span>
<span class="sd">`multiple_runs_alpha.xml`:</span>

<span class="sd">&gt;&gt;&gt; from hydpy.examples import prepare_full_example_1</span>
<span class="sd">&gt;&gt;&gt; prepare_full_example_1()</span>

<span class="sd">To start the server in a new process, open a command-line tool and insert the following</span>
<span class="sd">command (see module |hyd| for general information on how to use *HydPy* via the command</span>
<span class="sd">line):</span>

<span class="sd">&gt;&gt;&gt; command = &quot;hyd.py start_server 8080 LahnH multiple_runs_alpha.xml&quot;</span>
<span class="sd">&gt;&gt;&gt; from hydpy import run_subprocess, TestIO</span>
<span class="sd">&gt;&gt;&gt; with TestIO():</span>
<span class="sd">...     process = run_subprocess(command, blocking=False, verbose=False)</span>
<span class="sd">...     result = run_subprocess(&quot;hyd.py await_server 8080 10&quot;, verbose=False)</span>

<span class="sd">The *HydPy* server should now be running on port 8080.  You can use any HTTP client to</span>
<span class="sd">check it is working.  For example, you can type the following URLs in your web browser</span>
<span class="sd">to get information on the types and initial values of the exchange items defined in</span>
<span class="sd">`multiple_runs_alpha.xml` (in a format required by the</span>
<span class="sd">`HydPy-OpenDA-Black-Box-Model-Wrapper`_):</span>

<span class="sd">&gt;&gt;&gt; from urllib import request</span>
<span class="sd">&gt;&gt;&gt; url = &quot;http://127.0.0.1:8080/query_itemtypes&quot;</span>
<span class="sd">&gt;&gt;&gt; print(str(request.urlopen(url).read(), encoding=&quot;utf-8&quot;))</span>
<span class="sd">alpha = Double0D</span>
<span class="sd">dill_nodes_sim_series = TimeSeries0D</span>

<span class="sd">&gt;&gt;&gt; url = &quot;http://127.0.0.1:8080/query_initialitemvalues&quot;</span>
<span class="sd">&gt;&gt;&gt; print(str(request.urlopen(url).read(), encoding=&quot;utf-8&quot;))</span>
<span class="sd">alpha = 2.0</span>
<span class="sd">dill_nodes_sim_series = [nan, nan, nan, nan, nan]</span>

<span class="sd">It is generally possible to control the *HydPy* server via invoking each method with a</span>
<span class="sd">separate HTTP request.  However, alternatively, one can use methods</span>
<span class="sd">|HydPyServer.GET_execute| and |HydPyServer.POST_execute| to execute many methods with</span>
<span class="sd">only one HTTP request.  We now define three such metafunctions.  The first one changes</span>
<span class="sd">the value of the parameter |hland_control.Alpha|  The second one runs a simulation.</span>
<span class="sd">The third one prints the newly calculated discharge at the outlet of the headwater</span>
<span class="sd">catchment `Dill`.  All of this is very similar to what the</span>
<span class="sd">`HydPy-OpenDA-Black-Box-Model-Wrapper`_ does.</span>

<span class="sd">Function `set_itemvalues` wraps the POST methods</span>
<span class="sd">|HydPyServer.POST_register_simulationdates|,</span>
<span class="sd">|HydPyServer.POST_register_parameteritemvalues|, and</span>
<span class="sd">|HydPyServer.POST_register_conditionitemvalues|.  The *HydPy* server will execute</span>
<span class="sd">these methods in the given order.   The arguments `firstdate_sim`, `lastdate_sim`,</span>
<span class="sd">and `alpha` allow changing the start and end date of the simulation period and the</span>
<span class="sd">value of parameter |hland_control.alpha| later:</span>

<span class="sd">&gt;&gt;&gt; def set_itemvalues(id_, firstdate, lastdate, alpha):</span>
<span class="sd">...     content = (f&quot;firstdate_sim = {firstdate}\\n&quot;</span>
<span class="sd">...                f&quot;lastdate_sim = {lastdate}\\n&quot;</span>
<span class="sd">...                f&quot;alpha = {alpha}&quot;).encode(&quot;utf-8&quot;)</span>
<span class="sd">...     methods = &quot;,&quot;.join((&quot;POST_register_simulationdates&quot;,</span>
<span class="sd">...                         &quot;POST_register_parameteritemvalues&quot;,</span>
<span class="sd">...                         &quot;POST_register_conditionitemvalues&quot;))</span>
<span class="sd">...     url = f&quot;http://127.0.0.1:8080/execute?id={id_}&amp;methods={methods}&quot;</span>
<span class="sd">...     request.urlopen(url, data=content)</span>

<span class="sd">Function `simulate` wraps only GET methods and triggers the next simulation run.  As</span>
<span class="sd">for all GET and POST methods, one should pass the query parameter `id`, used by the</span>
<span class="sd">*HydPy* server for internal bookmarking:</span>

<span class="sd">&gt;&gt;&gt; def simulate(id_):</span>
<span class="sd">...     methods = &quot;,&quot;.join((&quot;GET_activate_simulationdates&quot;,</span>
<span class="sd">...                         &quot;GET_activate_parameteritemvalues&quot;,</span>
<span class="sd">...                         &quot;GET_load_internalconditions&quot;,</span>
<span class="sd">...                         &quot;GET_activate_conditionitemvalues&quot;,</span>
<span class="sd">...                         &quot;GET_simulate&quot;,</span>
<span class="sd">...                         &quot;GET_save_internalconditions&quot;,</span>
<span class="sd">...                         &quot;GET_update_conditionitemvalues&quot;,</span>
<span class="sd">...                         &quot;GET_update_getitemvalues&quot;))</span>
<span class="sd">...     url = f&quot;http://127.0.0.1:8080/execute?id={id_}&amp;methods={methods}&quot;</span>
<span class="sd">...     request.urlopen(url)</span>

<span class="sd">Function `print_itemvalues` also wraps only GET methods and prints the current value of</span>
<span class="sd">parameter |hland_control.Alpha| as well as the lastly simulated discharge values</span>
<span class="sd">corresponding to the given `id` value:</span>

<span class="sd">&gt;&gt;&gt; from hydpy import print_values</span>
<span class="sd">&gt;&gt;&gt; def print_itemvalues(id_):</span>
<span class="sd">...     methods = &quot;,&quot;.join((&quot;GET_query_simulationdates&quot;,</span>
<span class="sd">...                         &quot;GET_query_parameteritemvalues&quot;,</span>
<span class="sd">...                         &quot;GET_query_conditionitemvalues&quot;,</span>
<span class="sd">...                         &quot;GET_query_getitemvalues&quot;))</span>
<span class="sd">...     url = f&quot;http://127.0.0.1:8080/execute?id={id_}&amp;methods={methods}&quot;</span>
<span class="sd">...     data = str(request.urlopen(url).read(), encoding=&quot;utf-8&quot;)</span>
<span class="sd">...     for line in data.split(&quot;\\n&quot;):</span>
<span class="sd">...         if line.startswith(&quot;alpha&quot;):</span>
<span class="sd">...             alpha = line.split(&quot;=&quot;)[1].strip()</span>
<span class="sd">...         if line.startswith(&quot;dill&quot;):</span>
<span class="sd">...             discharge = eval(line.split(&quot;=&quot;)[1])</span>
<span class="sd">...     print(f&quot;{alpha}: &quot;, end=&quot;&quot;)</span>
<span class="sd">...     print_values(discharge)</span>

<span class="sd">For the sake of brevity, we also define `do_everything` for calling the other functions</span>
<span class="sd">at once:</span>

<span class="sd">&gt;&gt;&gt; def do_everything(id_, firstdate, lastdate, alpha):</span>
<span class="sd">...     set_itemvalues(id_, firstdate, lastdate, alpha)</span>
<span class="sd">...     simulate(id_)</span>
<span class="sd">...     print_itemvalues(id_)</span>

<span class="sd">In the simplest example, we perform a simulation throughout five days for an</span>
<span class="sd">|hland_control.Alpha| value of 2:</span>

<span class="sd">&gt;&gt;&gt; do_everything(&quot;1a&quot;, &quot;1996-01-01&quot;, &quot;1996-01-06&quot;, 2.0)</span>
<span class="sd">2.0: 35.537828, 7.741064, 5.018981, 4.501784, 4.238874</span>

<span class="sd">The following example shows interlocked simulation runs.  The first call only triggers</span>
<span class="sd">a simulation run for the first initialised day:</span>

<span class="sd">&gt;&gt;&gt; do_everything(&quot;1b&quot;, &quot;1996-01-01&quot;, &quot;1996-01-02&quot;, 2.0)</span>
<span class="sd">2.0: 35.537828</span>

<span class="sd">The second call repeats the first one with a different `id` value:</span>

<span class="sd">&gt;&gt;&gt; do_everything(&quot;2&quot;, &quot;1996-01-01&quot;, &quot;1996-01-02&quot;, 2.0)</span>
<span class="sd">2.0: 35.537828</span>

<span class="sd">The third call covers the first three initialisation days:</span>

<span class="sd">&gt;&gt;&gt; do_everything(&quot;3&quot;, &quot;1996-01-01&quot;, &quot;1996-01-04&quot;, 2.0)</span>
<span class="sd">2.0: 35.537828, 7.741064, 5.018981</span>

<span class="sd">The fourth call continues the simulation of the first call, covering the last four</span>
<span class="sd">initialised days:</span>

<span class="sd">&gt;&gt;&gt; do_everything(&quot;1b&quot;, &quot;1996-01-02&quot;, &quot;1996-01-06&quot;, 2.0)</span>
<span class="sd">2.0: 7.741064, 5.018981, 4.501784, 4.238874</span>

<span class="sd">The results of the very first call of function `do_everything` (with`id=1`) are</span>
<span class="sd">identical with the pulled-together discharge values of the calls with `id=1b`, made</span>
<span class="sd">possible by the internal bookmarking feature of the *HydPy* server.  Here we use</span>
<span class="sd">numbers, but any other strings are valid `id` values.</span>

<span class="sd">This example extends the last one by applying different parameter values:</span>

<span class="sd">&gt;&gt;&gt; do_everything(&quot;4&quot;, &quot;1996-01-01&quot;, &quot;1996-01-04&quot;, 2.0)</span>
<span class="sd">2.0: 35.537828, 7.741064, 5.018981</span>
<span class="sd">&gt;&gt;&gt; do_everything(&quot;5&quot;, &quot;1996-01-01&quot;, &quot;1996-01-04&quot;, 1.0)</span>
<span class="sd">1.0: 11.78038, 8.901179, 7.131072</span>
<span class="sd">&gt;&gt;&gt; do_everything(&quot;4&quot;, &quot;1996-01-04&quot;, &quot;1996-01-06&quot;, 2.0)</span>
<span class="sd">2.0: 4.501784, 4.238874</span>
<span class="sd">&gt;&gt;&gt; do_everything(&quot;5&quot;, &quot;1996-01-04&quot;, &quot;1996-01-06&quot;, 1.0)</span>
<span class="sd">1.0: 6.017787, 5.313211</span>
<span class="sd">&gt;&gt;&gt; do_everything(&quot;5&quot;, &quot;1996-01-01&quot;, &quot;1996-01-06&quot;, 1.0)</span>
<span class="sd">1.0: 11.78038, 8.901179, 7.131072, 6.017787, 5.313211</span>

<span class="sd">The order in which function `do_everything` calls its subfunctions seems quite natural,</span>
<span class="sd">but some tools might require do deviate from it.  For example, `OpenDA`_ offers</span>
<span class="sd">ensemble-based algorithms triggering the simulation of all memberse before starting to</span>
<span class="sd">query any simulation results.  The final example shows that the underlying atomic</span>
<span class="sd">methods support such an execution sequence:</span>

<span class="sd">&gt;&gt;&gt; set_itemvalues(&quot;6&quot;, &quot;1996-01-01&quot;, &quot;1996-01-03&quot;, 2.0)</span>
<span class="sd">&gt;&gt;&gt; simulate(&quot;6&quot;)</span>
<span class="sd">&gt;&gt;&gt; set_itemvalues(&quot;7&quot;, &quot;1996-01-01&quot;, &quot;1996-01-03&quot;, 1.0)</span>
<span class="sd">&gt;&gt;&gt; simulate(&quot;7&quot;)</span>
<span class="sd">&gt;&gt;&gt; print_itemvalues(&quot;6&quot;)</span>
<span class="sd">2.0: 35.537828, 7.741064</span>
<span class="sd">&gt;&gt;&gt; print_itemvalues(&quot;7&quot;)</span>
<span class="sd">1.0: 11.78038, 8.901179</span>

<span class="sd">When working in parallel mode, `OpenDA`_ might not always call the functions</span>
<span class="sd">`set_itemvalues` and `simulate` for the same `id` directly one after another, which</span>
<span class="sd">also causes no problem:</span>

<span class="sd">&gt;&gt;&gt; set_itemvalues(&quot;6&quot;, &quot;1996-01-03&quot;, &quot;1996-01-06&quot;, 2.0)</span>
<span class="sd">&gt;&gt;&gt; set_itemvalues(&quot;7&quot;, &quot;1996-01-03&quot;, &quot;1996-01-06&quot;, 1.0)</span>
<span class="sd">&gt;&gt;&gt; simulate(&quot;6&quot;)</span>
<span class="sd">&gt;&gt;&gt; simulate(&quot;7&quot;)</span>
<span class="sd">&gt;&gt;&gt; print_itemvalues(&quot;6&quot;)</span>
<span class="sd">2.0: 5.018981, 4.501784, 4.238874</span>
<span class="sd">&gt;&gt;&gt; print_itemvalues(&quot;7&quot;)</span>
<span class="sd">1.0: 7.131072, 6.017787, 5.313211</span>

<span class="sd">Finally, we close the server and kill its process (just closing your command-line tool</span>
<span class="sd">works likewise):</span>

<span class="sd">&gt;&gt;&gt; _ = request.urlopen(&quot;http://127.0.0.1:8080/close_server&quot;)</span>
<span class="sd">&gt;&gt;&gt; process.kill()</span>
<span class="sd">&gt;&gt;&gt; _ = process.communicate()</span>

<span class="sd">The above description focussed on coupling *HydPy* to `OpenDA`_.  However, the applied</span>
<span class="sd">atomic submethods of class |HydPyServer| also allow coupling *HydPy*  with other</span>
<span class="sd">software products. See the documentation on class |HydPyServer| for further information.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1"># import...</span>
<span class="c1"># ...from standard library</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">import</span> <span class="nn">mimetypes</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># import http.server  # moved below for efficiency reasons</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">urllib.error</span>
<span class="kn">import</span> <span class="nn">urllib.parse</span>
<span class="kn">import</span> <span class="nn">urllib.request</span>
<span class="kn">import</span> <span class="nn">types</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1"># ...from site-packages</span>
<span class="kn">import</span> <span class="nn">numpy</span>

<span class="c1"># ...from HydPy</span>
<span class="kn">import</span> <span class="nn">hydpy</span>
<span class="kn">from</span> <span class="nn">hydpy</span> <span class="kn">import</span> <span class="n">conf</span>
<span class="kn">from</span> <span class="nn">hydpy</span> <span class="kn">import</span> <span class="n">config</span>
<span class="kn">from</span> <span class="nn">hydpy.auxs</span> <span class="kn">import</span> <span class="n">xmltools</span>
<span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="kn">import</span> <span class="n">hydpytools</span>
<span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="kn">import</span> <span class="n">itemtools</span>
<span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="kn">import</span> <span class="n">objecttools</span>
<span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="kn">import</span> <span class="n">timetools</span>
<span class="kn">from</span> <span class="nn">hydpy.exe</span> <span class="kn">import</span> <span class="n">commandtools</span>
<span class="kn">from</span> <span class="nn">hydpy.core.typingtools</span> <span class="kn">import</span> <span class="o">*</span>


<span class="c1"># pylint: disable=wrong-import-position, wrong-import-order</span>
<span class="c1"># see the documentation on method `start_server` for explanations</span>
<span class="n">mimetypes</span><span class="o">.</span><span class="n">inited</span> <span class="o">=</span> <span class="kc">True</span>
<span class="kn">import</span> <span class="nn">http.server</span>

<span class="n">mimetypes</span><span class="o">.</span><span class="n">inited</span> <span class="o">=</span> <span class="kc">False</span>
<span class="c1"># pylint: enable=wrong-import-position, wrong-import-order</span>


<span class="n">ID</span> <span class="o">=</span> <span class="n">NewType</span><span class="p">(</span><span class="s2">&quot;ID&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
<span class="n">ID</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Type for strings that identify &quot;artificial&quot; *HydPy* instances (from a </span>
<span class="s2">client&#39;s point of view).&quot;&quot;&quot;</span>


<div class="viewcode-block" id="ServerState">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.ServerState">[docs]</a>
<span class="k">class</span> <span class="nc">ServerState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Singleton class handling states like the current |HydPy| instance exchange items.</span>

<span class="sd">    The instance of class |ServerState| is available as the member `state` of class</span>
<span class="sd">    |HydPyServer| after calling the function |start_server|.  You could create other</span>
<span class="sd">    instances (like we do in the following examples), but you most likely shouldn&#39;t.</span>
<span class="sd">    The primary purpose of this instance is to store information between successive</span>
<span class="sd">    initialisations of class |HydPyServer|.</span>

<span class="sd">    We use the `LahnH` project and its (complicated) XML configuration file</span>
<span class="sd">    `multiple_runs.xml` as an example (module |xmltools| provides information on</span>
<span class="sd">    interpreting this file):</span>

<span class="sd">    &gt;&gt;&gt; from hydpy.examples import prepare_full_example_1</span>
<span class="sd">    &gt;&gt;&gt; prepare_full_example_1()</span>
<span class="sd">    &gt;&gt;&gt; from hydpy import print_values, TestIO</span>
<span class="sd">    &gt;&gt;&gt; from hydpy.exe.servertools import ServerState</span>
<span class="sd">    &gt;&gt;&gt; with TestIO():  # doctest: +ELLIPSIS</span>
<span class="sd">    ...     state = ServerState(&quot;LahnH&quot;, &quot;multiple_runs.xml&quot;)</span>
<span class="sd">    Start HydPy project `LahnH` (...).</span>
<span class="sd">    Read configuration file `multiple_runs.xml` (...).</span>
<span class="sd">    Interpret the defined options (...).</span>
<span class="sd">    Interpret the defined period (...).</span>
<span class="sd">    Read all network files (...).</span>
<span class="sd">    Activate the selected network (...).</span>
<span class="sd">    Read the required control files (...).</span>
<span class="sd">    Read the required condition files (...).</span>
<span class="sd">    Read the required time series files (...).</span>

<span class="sd">    After initialisation, all defined exchange items are available:</span>

<span class="sd">    &gt;&gt;&gt; for item in state.parameteritems:</span>
<span class="sd">    ...     print(item)</span>
<span class="sd">    SetItem(&quot;alpha&quot;, &quot;hland_v1&quot;, &quot;control.alpha&quot;, None, &quot;global&quot;)</span>
<span class="sd">    SetItem(&quot;beta&quot;, &quot;hland_v1&quot;, &quot;control.beta&quot;, None, &quot;global&quot;)</span>
<span class="sd">    SetItem(&quot;lag&quot;, &quot;musk_classic&quot;, &quot;control.nmbsegments&quot;, &quot;lag&quot;, &quot;global&quot;)</span>
<span class="sd">    SetItem(&quot;damp&quot;, &quot;musk_classic&quot;, &quot;control.coefficients&quot;, &quot;damp&quot;, &quot;global&quot;)</span>
<span class="sd">    AddItem(&quot;sfcf_1&quot;, &quot;hland_v1&quot;, &quot;control.sfcf&quot;, &quot;control.rfcf&quot;, &quot;global&quot;)</span>
<span class="sd">    AddItem(&quot;sfcf_2&quot;, &quot;hland_v1&quot;, &quot;control.sfcf&quot;, &quot;control.rfcf&quot;, &quot;global&quot;)</span>
<span class="sd">    AddItem(&quot;sfcf_3&quot;, &quot;hland_v1&quot;, &quot;control.sfcf&quot;, &quot;control.rfcf&quot;, &quot;subunit&quot;)</span>
<span class="sd">    MultiplyItem(&quot;k4&quot;, &quot;hland_v1&quot;, &quot;control.k4&quot;, &quot;control.k&quot;, &quot;global&quot;)</span>
<span class="sd">    &gt;&gt;&gt; for item in state.conditionitems:</span>
<span class="sd">    ...     print(item)</span>
<span class="sd">    SetItem(&quot;ic_lahn_2&quot;, &quot;hland_v1&quot;, &quot;states.ic&quot;, None, &quot;device&quot;)</span>
<span class="sd">    SetItem(&quot;ic_lahn_1&quot;, &quot;hland_v1&quot;, &quot;states.ic&quot;, None, &quot;subunit&quot;)</span>
<span class="sd">    SetItem(&quot;sm_lahn_2&quot;, &quot;hland_v1&quot;, &quot;states.sm&quot;, None, &quot;device&quot;)</span>
<span class="sd">    SetItem(&quot;sm_lahn_1&quot;, &quot;hland_v1&quot;, &quot;states.sm&quot;, None, &quot;subunit&quot;)</span>
<span class="sd">    SetItem(&quot;quh&quot;, &quot;hland_v1&quot;, &quot;logs.quh&quot;, None, &quot;device&quot;)</span>
<span class="sd">    &gt;&gt;&gt; for item in state.getitems:</span>
<span class="sd">    ...     print(item)</span>
<span class="sd">    GetItem(&quot;?&quot;, &quot;hland_v1&quot;, &quot;factors.tmean&quot;)</span>
<span class="sd">    GetItem(&quot;current_discharge&quot;, &quot;hland_v1&quot;, &quot;fluxes.qt&quot;)</span>
<span class="sd">    GetItem(&quot;entire_discharge_series&quot;, &quot;hland_v1&quot;, &quot;fluxes.qt.series&quot;)</span>
<span class="sd">    GetItem(&quot;?&quot;, &quot;hland_v1&quot;, &quot;states.sm&quot;)</span>
<span class="sd">    GetItem(&quot;?&quot;, &quot;hland_v1&quot;, &quot;states.sm.series&quot;)</span>
<span class="sd">    GetItem(&quot;?&quot;, &quot;nodes&quot;, &quot;nodes.sim.series&quot;)</span>

<span class="sd">    The initialisation also memorises the initial conditions of all elements:</span>

<span class="sd">    &gt;&gt;&gt; for element in state.init_conditions:</span>
<span class="sd">    ...     print(element)</span>
<span class="sd">    land_dill</span>
<span class="sd">    land_lahn_1</span>
<span class="sd">    land_lahn_2</span>
<span class="sd">    land_lahn_3</span>
<span class="sd">    stream_dill_lahn_2</span>
<span class="sd">    stream_lahn_1_lahn_2</span>
<span class="sd">    stream_lahn_2_lahn_3</span>

<span class="sd">    The initialisation also prepares all selected series arrays and reads the</span>
<span class="sd">    required input data:</span>

<span class="sd">    &gt;&gt;&gt; print_values(state.hp.elements.land_dill.model.sequences.inputs.t.series)</span>
<span class="sd">    -0.298846, -0.811539, -2.493848, -5.968849, -6.999618</span>
<span class="sd">    &gt;&gt;&gt; state.hp.nodes.dill.sequences.sim.series</span>
<span class="sd">    InfoArray([nan, nan, nan, nan, nan])</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">interface</span><span class="p">:</span> <span class="n">xmltools</span><span class="o">.</span><span class="n">XMLInterface</span>
    <span class="n">hp</span><span class="p">:</span> <span class="n">hydpytools</span><span class="o">.</span><span class="n">HydPy</span>
    <span class="n">parameteritems</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">itemtools</span><span class="o">.</span><span class="n">ChangeItem</span><span class="p">]</span>
    <span class="n">inputitems</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">itemtools</span><span class="o">.</span><span class="n">SetItem</span><span class="p">]</span>
    <span class="n">conditionitems</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">itemtools</span><span class="o">.</span><span class="n">SetItem</span><span class="p">]</span>
    <span class="n">outputitems</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">itemtools</span><span class="o">.</span><span class="n">SetItem</span><span class="p">]</span>
    <span class="n">getitems</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">itemtools</span><span class="o">.</span><span class="n">GetItem</span><span class="p">]</span>
    <span class="n">conditions</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">ID</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">hydpytools</span><span class="o">.</span><span class="n">ConditionsType</span><span class="p">]]</span>
    <span class="n">parameteritemvalues</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">ID</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Name</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>
    <span class="n">inputitemvalues</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">ID</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Name</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>
    <span class="n">conditionitemvalues</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">ID</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Name</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>
    <span class="n">outputitemvalues</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">ID</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Name</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>
    <span class="n">getitemvalues</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">ID</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Name</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span>
    <span class="n">initialparameteritemvalues</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Name</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
    <span class="n">initialinputitemvalues</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Name</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
    <span class="n">initialconditionitemvalues</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Name</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
    <span class="n">initialgetitemvalues</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Name</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
    <span class="n">timegrids</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">ID</span><span class="p">,</span> <span class="n">timetools</span><span class="o">.</span><span class="n">Timegrid</span><span class="p">]</span>
    <span class="n">init_conditions</span><span class="p">:</span> <span class="n">hydpytools</span><span class="o">.</span><span class="n">ConditionsType</span>
    <span class="n">inputconditiondirs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">ID</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
    <span class="n">outputconditiondirs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">ID</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
    <span class="n">serieswriterdirs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">ID</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
    <span class="n">seriesreaderdirs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">ID</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
    <span class="n">outputcontroldirs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">ID</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
    <span class="n">idx1</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">idx2</span><span class="p">:</span> <span class="nb">int</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">projectname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">xmlfile</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">load_conditions</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">load_series</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">write</span> <span class="o">=</span> <span class="n">commandtools</span><span class="o">.</span><span class="n">print_textandtime</span>
        <span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Start HydPy project `</span><span class="si">{</span><span class="n">projectname</span><span class="si">}</span><span class="s2">`&quot;</span><span class="p">)</span>
        <span class="n">hp</span> <span class="o">=</span> <span class="n">hydpytools</span><span class="o">.</span><span class="n">HydPy</span><span class="p">(</span><span class="n">projectname</span><span class="p">)</span>
        <span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Read configuration file `</span><span class="si">{</span><span class="n">xmlfile</span><span class="si">}</span><span class="s2">`&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span> <span class="o">=</span> <span class="n">xmltools</span><span class="o">.</span><span class="n">XMLInterface</span><span class="p">(</span><span class="n">xmlfile</span><span class="p">)</span>
        <span class="n">write</span><span class="p">(</span><span class="s2">&quot;Interpret the defined options&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">update_options</span><span class="p">()</span>
        <span class="n">write</span><span class="p">(</span><span class="s2">&quot;Interpret the defined period&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">update_timegrids</span><span class="p">()</span>
        <span class="n">write</span><span class="p">(</span><span class="s2">&quot;Read all network files&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">network_io</span><span class="o">.</span><span class="n">prepare_network</span><span class="p">()</span>
        <span class="n">write</span><span class="p">(</span><span class="s2">&quot;Create the custom selections (if defined)&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">update_selections</span><span class="p">()</span>
        <span class="n">write</span><span class="p">(</span><span class="s2">&quot;Activate the selected network&quot;</span><span class="p">)</span>
        <span class="n">hp</span><span class="o">.</span><span class="n">update_devices</span><span class="p">(</span><span class="n">selection</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">fullselection</span><span class="p">)</span>
        <span class="n">write</span><span class="p">(</span><span class="s2">&quot;Read the required control files&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">control_io</span><span class="o">.</span><span class="n">prepare_models</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">load_conditions</span><span class="p">:</span>
            <span class="n">write</span><span class="p">(</span><span class="s2">&quot;Read the required condition files&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">conditions_io</span><span class="o">.</span><span class="n">load_conditions</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">load_series</span><span class="p">:</span>
            <span class="n">write</span><span class="p">(</span><span class="s2">&quot;Read the required time series files&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">series_io</span><span class="o">.</span><span class="n">prepare_series</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">exchange</span><span class="o">.</span><span class="n">prepare_series</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">load_series</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">series_io</span><span class="o">.</span><span class="n">load_series</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hp</span> <span class="o">=</span> <span class="n">hp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameteritems</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">exchange</span><span class="o">.</span><span class="n">parameteritems</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inputitems</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">exchange</span><span class="o">.</span><span class="n">inputitems</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conditionitems</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">exchange</span><span class="o">.</span><span class="n">conditionitems</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outputitems</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">exchange</span><span class="o">.</span><span class="n">outputitems</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">getitems</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">exchange</span><span class="o">.</span><span class="n">getitems</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialparameteritemvalues</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameteritems</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialinputitemvalues</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputitems</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialconditionitemvalues</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">conditionitems</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialoutputitemvalues</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputitems</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialgetitemvalues</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">name</span><span class="p">:</span> <span class="n">value</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getitems</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">yield_name2value</span><span class="p">(</span><span class="o">*</span><span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">timegrids</span><span class="o">.</span><span class="n">simindices</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conditions</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameteritemvalues</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inputitemvalues</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conditionitemvalues</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outputitemvalues</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">getitemvalues</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_conditions</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">conditions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timegrids</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">serieswriterdirs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seriesreaderdirs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inputconditiondirs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outputconditiondirs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outputcontroldirs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idx1</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idx2</span> <span class="o">=</span> <span class="mi">0</span></div>



<div class="viewcode-block" id="HydPyServer">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer">[docs]</a>
<span class="k">class</span> <span class="nc">HydPyServer</span><span class="p">(</span><span class="n">http</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">BaseHTTPRequestHandler</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The API of the *HydPy* server.</span>

<span class="sd">    Technically and strictly speaking, |HydPyServer| is, only the HTTP request handler</span>
<span class="sd">    for the real HTTP server class (from the standard library).</span>

<span class="sd">    After initialising the *HydPy* server, each communication via a GET or POST request</span>
<span class="sd">    is handled by a new instance of |HydPyServer|.  This handling occurs in a unified</span>
<span class="sd">    way using either method |HydPyServer.do_GET| or [HydPyServer.do_POST|, which select</span>
<span class="sd">    and apply the actual GET or POST method.  All methods provided by class</span>
<span class="sd">    |HydPyServer| starting with &quot;GET&quot; or &quot;POST&quot; are accessible via HTTP.</span>

<span class="sd">    In the main documentation on module |servertools|, we use the</span>
<span class="sd">    `multiple_runs_alpha.xml` file of the `LahnH` project as an example.  However, now</span>
<span class="sd">    we select the more complex XML configuration file `multiple_runs.xml`, covering a</span>
<span class="sd">    higher number of cases:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy.examples import prepare_full_example_1</span>
<span class="sd">    &gt;&gt;&gt; prepare_full_example_1()</span>
<span class="sd">    &gt;&gt;&gt; from hydpy import run_subprocess, TestIO</span>
<span class="sd">    &gt;&gt;&gt; with TestIO():</span>
<span class="sd">    ...     process = run_subprocess(</span>
<span class="sd">    ...         &quot;hyd.py start_server 8080 LahnH multiple_runs.xml debugging=enable&quot;,</span>
<span class="sd">    ...         blocking=False, verbose=False)</span>
<span class="sd">    ...     result = run_subprocess(&quot;hyd.py await_server 8080 10&quot;, verbose=False)</span>

<span class="sd">    We define a test function that simplifies sending the following requests and offers</span>
<span class="sd">    two optional arguments.  When passing a value to `id_`, `test` adds this value as</span>
<span class="sd">    the query parameter `id` to the URL.  When passing a string to `data`, `test` sends</span>
<span class="sd">    a POST request containing the given data; otherwise, a GET request without</span>
<span class="sd">    additional data:</span>

<span class="sd">    &gt;&gt;&gt; from urllib import request</span>
<span class="sd">    &gt;&gt;&gt; def test(name, id_=None, data=None, return_result=False):</span>
<span class="sd">    ...     url = f&quot;http://127.0.0.1:8080/{name}&quot;</span>
<span class="sd">    ...     if id_:</span>
<span class="sd">    ...         url = f&quot;{url}?id={id_}&quot;</span>
<span class="sd">    ...     if data:</span>
<span class="sd">    ...         data = bytes(data, encoding=&quot;utf-8&quot;)</span>
<span class="sd">    ...     response = request.urlopen(url, data=data)</span>
<span class="sd">    ...     result = str(response.read(), encoding=&quot;utf-8&quot;)</span>
<span class="sd">    ...     print(result)</span>
<span class="sd">    ...     return result if return_result else None</span>

<span class="sd">    Asking for its status tells us that the server is ready (which may take a while,</span>
<span class="sd">    depending on the project&#39;s size):</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;status&quot;)</span>
<span class="sd">    status = ready</span>

<span class="sd">    You can query the current version number of the *HydPy* installation used to start</span>
<span class="sd">    the server:</span>

<span class="sd">    &gt;&gt;&gt; result = test(&quot;version&quot;, return_result=True)  # doctest: +ELLIPSIS</span>
<span class="sd">    version = ...</span>
<span class="sd">    &gt;&gt;&gt; hydpy.__version__ in result</span>
<span class="sd">    True</span>

<span class="sd">    |HydPyServer| returns the error code `400` if it realises the URL to be wrong:</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;missing&quot;)</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    urllib.error.HTTPError: HTTP Error 400: RuntimeError: No method `GET_missing` \</span>
<span class="sd">available.</span>

<span class="sd">    The error code is `500` in all other cases of error:</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;register_parameteritemvalues&quot;, id_=&quot;0&quot;, data=&quot;alpha = []&quot;)</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    urllib.error.HTTPError: HTTP Error 500: RuntimeError: While trying to execute \</span>
<span class="sd">method `POST_register_parameteritemvalues`, the following error occurred: A value for \</span>
<span class="sd">parameter item `beta` is missing.</span>

<span class="sd">    Some methods require identity information, passed as query parameter `id`, used for</span>
<span class="sd">    internal bookmarking:</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;query_parameteritemvalues&quot;)</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    urllib.error.HTTPError: HTTP Error 500: RuntimeError: While trying to execute \</span>
<span class="sd">method `GET_query_parameteritemvalues`, the following error occurred: For the GET \</span>
<span class="sd">method `query_parameteritemvalues` no query parameter `id` is given.</span>

<span class="sd">    POST methods always expect an arbitrary number of lines, each one assigning some</span>
<span class="sd">    values to some variable (in most cases, numbers to exchange items):</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;parameteritemvalues&quot;,</span>
<span class="sd">    ...      id_=&quot;a&quot;,</span>
<span class="sd">    ...      data=(&quot;x = y\\n&quot;</span>
<span class="sd">    ...            &quot;   \\n&quot;</span>
<span class="sd">    ...            &quot;x == y\\n&quot;</span>
<span class="sd">    ...            &quot;x = y&quot;))</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    urllib.error.HTTPError: HTTP Error 400: RuntimeError: The POST method \</span>
<span class="sd">`parameteritemvalues` received a wrongly formated data body.  The following line has \</span>
<span class="sd">been extracted but cannot be further processed: `x == y`.</span>

<span class="sd">    Before explaining the more offical methods, we introduce the method</span>
<span class="sd">    |HydPyServer.POST_evaluate|, which evaluates arbitrary valid Python code within the</span>
<span class="sd">    server process.  Its most likely use-case is to access the (sub)attributes of the</span>
<span class="sd">    single instance of class |ServerState|, available as a member of class</span>
<span class="sd">    |HydPyServer|.  This method can help when being puzzled about the state of the</span>
<span class="sd">    *HydPy* server.  Use it, for example, to find out which |Node| objects are</span>
<span class="sd">    available and to see which one is the outlet node of the |Element| object</span>
<span class="sd">    `land_dill`:</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;evaluate&quot;,</span>
<span class="sd">    ...      data=(&quot;nodes = HydPyServer.state.hp.nodes\\n&quot;</span>
<span class="sd">    ...            &quot;elements = HydPyServer.state.hp.elements.land_dill&quot;))</span>
<span class="sd">    nodes = Nodes(&quot;dill&quot;, &quot;lahn_1&quot;, &quot;lahn_2&quot;, &quot;lahn_3&quot;)</span>
<span class="sd">    elements = Element(&quot;land_dill&quot;, outlets=&quot;dill&quot;, keywords=&quot;catchment&quot;)</span>

<span class="sd">    Method |HydPyServer.GET_query_itemtypes|, already described in the main</span>
<span class="sd">    documentation of module |servertools|, returns all available exchange item types</span>
<span class="sd">    at once.  However, it is also possible to query those that are related to setting</span>
<span class="sd">    parameter values (|HydPyServer.GET_query_parameteritemtypes|), setting condition</span>
<span class="sd">    values (|HydPyServer.GET_query_conditionitemtypes|), setting input time series</span>
<span class="sd">    (|HydPyServer.GET_query_inputitemtypes|), getting values or series of factors or</span>
<span class="sd">    fluxes in the &quot;setitem style&quot; (|HydPyServer.GET_query_outputitemtypes|) and getting</span>
<span class="sd">    different kinds of values or series in the &quot;getitem style&quot;</span>
<span class="sd">    (|HydPyServer.GET_query_getitemtypes|) separately:</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;query_parameteritemtypes&quot;)</span>
<span class="sd">    alpha = Double0D</span>
<span class="sd">    beta = Double0D</span>
<span class="sd">    lag = Double0D</span>
<span class="sd">    damp = Double0D</span>
<span class="sd">    sfcf_1 = Double0D</span>
<span class="sd">    sfcf_2 = Double0D</span>
<span class="sd">    sfcf_3 = Double1D</span>
<span class="sd">    k4 = Double0D</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;query_conditionitemtypes&quot;)</span>
<span class="sd">    ic_lahn_2 = Double1D</span>
<span class="sd">    ic_lahn_1 = Double1D</span>
<span class="sd">    sm_lahn_2 = Double1D</span>
<span class="sd">    sm_lahn_1 = Double1D</span>
<span class="sd">    quh = Double1D</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;query_inputitemtypes&quot;)</span>
<span class="sd">    t_headwaters = TimeSeries1D</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;query_outputitemtypes&quot;)</span>
<span class="sd">    swe_headwaters = TimeSeries1D</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;query_getitemtypes&quot;)</span>
<span class="sd">    land_dill_factors_tmean = Double0D</span>
<span class="sd">    land_dill_fluxes_qt = Double0D</span>
<span class="sd">    land_dill_fluxes_qt_series = TimeSeries0D</span>
<span class="sd">    land_dill_states_sm = Double1D</span>
<span class="sd">    land_lahn_1_states_sm = Double1D</span>
<span class="sd">    land_lahn_2_states_sm = Double1D</span>
<span class="sd">    land_lahn_3_states_sm = Double1D</span>
<span class="sd">    land_lahn_3_states_sm_series = TimeSeries1D</span>
<span class="sd">    dill_nodes_sim_series = TimeSeries0D</span>

<span class="sd">    The same holds for the initial values of the exchange items.  Method</span>
<span class="sd">    |HydPyServer.GET_query_initialitemvalues| returns them all at once, while the</span>
<span class="sd">    methods |HydPyServer.GET_query_initialparameteritemvalues|,</span>
<span class="sd">    |HydPyServer.GET_query_initialconditionitemvalues|,</span>
<span class="sd">    |HydPyServer.GET_query_initialinputitemvalues|,</span>
<span class="sd">    |HydPyServer.GET_query_initialoutputitemvalues|, and</span>
<span class="sd">    (|HydPyServer.GET_query_initialgetitemvalues| return the relevant subgroup only.</span>
<span class="sd">    Note that for the exchange items related to state sequence |hland_states.SM|</span>
<span class="sd">    (`sm_lahn_1` and `sm_lahn_2`), the initial values stem from the XML file.  For the</span>
<span class="sd">    items related to state sequence |hland_states.Ic| and input sequence</span>
<span class="sd">    |hland_inputs.T|, the XML file does not provide such information.  Thus, the</span>
<span class="sd">    initial values of `ic_lahn_1`, `ic_lahn_2`, and `t_headwaters` stem from the</span>
<span class="sd">    corresponding sequences themselves (and thus, indirectly, from the respective</span>
<span class="sd">    condition and time series files):</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;query_initialparameteritemvalues&quot;)</span>
<span class="sd">    alpha = 2.0</span>
<span class="sd">    beta = 1.0</span>
<span class="sd">    lag = 5.0</span>
<span class="sd">    damp = 0.5</span>
<span class="sd">    sfcf_1 = 0.3</span>
<span class="sd">    sfcf_2 = 0.2</span>
<span class="sd">    sfcf_3 = [0.1, 0.2, 0.1, 0.2, 0.1, 0.2, 0.1, 0.2, 0.1, 0.2, 0.1, 0.2, 0.2, 0.2]</span>
<span class="sd">    k4 = 10.0</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;query_initialconditionitemvalues&quot;)</span>
<span class="sd">    ic_lahn_2 = [1.184948]</span>
<span class="sd">    ic_lahn_1 = [0.96404, 1.36332, 0.96458, 1.46458, 0.96512, 1.46512, 0.96565, \</span>
<span class="sd">1.46569, 0.96617, 1.46617, 0.96668, 1.46668, 1.46719]</span>
<span class="sd">    sm_lahn_2 = [123.0]</span>
<span class="sd">    sm_lahn_1 = [110.0, 120.0, 130.0, 140.0, 150.0, 160.0, 170.0, 180.0, 190.0, 200.0, \</span>
<span class="sd">210.0, 220.0, 230.0]</span>
<span class="sd">    quh = [10.0]</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;query_initialinputitemvalues&quot;)</span>
<span class="sd">    t_headwaters = [[-0.298846, -0.811539, -2.493848, -5.968849, -6.999618], \</span>
<span class="sd">[-0.705395, -1.505553, -4.221268, -7.446349, -8.119366]]</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;query_initialoutputitemvalues&quot;)</span>
<span class="sd">    swe_headwaters = [[nan, nan, nan, nan, nan], [nan, nan, nan, nan, nan]]</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;query_initialgetitemvalues&quot;)  # doctest: +ELLIPSIS</span>
<span class="sd">    land_dill_factors_tmean = nan</span>
<span class="sd">    land_dill_fluxes_qt = nan</span>
<span class="sd">    land_dill_fluxes_qt_series = [nan, nan, nan, nan, nan]</span>
<span class="sd">    land_dill_states_sm = [185.13164...]</span>
<span class="sd">    land_lahn_1_states_sm = [99.27505...]</span>
<span class="sd">    land_lahn_2_states_sm = [138.31396...]</span>
<span class="sd">    land_lahn_3_states_sm = [101.31248...]</span>
<span class="sd">    land_lahn_3_states_sm_series = [[nan, ...], [nan, ...], ..., [nan, ...]]</span>
<span class="sd">    dill_nodes_sim_series = [nan, nan, nan, nan, nan]</span>

<span class="sd">    Some external tools require ways to identify specific sub-values of different</span>
<span class="sd">    exchange items.  For example, they need to map those sub-values to location data</span>
<span class="sd">    available in a separate database. Method |HydPyServer.GET_query_itemsubnames|</span>
<span class="sd">    provides artificial sub names suitable for such a mapping. See property</span>
<span class="sd">    |ChangeItem.subnames| of class |ChangeItem| and method |GetItem.yield_name2subnames|</span>
<span class="sd">    of class |GetItem| for the specification of the sub names. Here, note the special</span>
<span class="sd">    handling for change items addressing the `global` level, for which we cannot define</span>
<span class="sd">    a meaningful sub name.  Method |HydPyServer.GET_query_itemsubnames| returns the</span>
<span class="sd">    string `*global*` in such cases:</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;query_itemsubnames&quot;) # doctest: +ELLIPSIS</span>
<span class="sd">    alpha = *global*</span>
<span class="sd">    beta = *global*</span>
<span class="sd">    lag = *global*</span>
<span class="sd">    damp = *global*</span>
<span class="sd">    sfcf_1 = *global*</span>
<span class="sd">    sfcf_2 = *global*</span>
<span class="sd">    sfcf_3 = [land_lahn_3_0, ..., land_lahn_3_13]</span>
<span class="sd">    k4 = *global*</span>
<span class="sd">    t_headwaters = [land_dill, land_lahn_1]</span>
<span class="sd">    ic_lahn_2 = [land_lahn_2]</span>
<span class="sd">    ic_lahn_1 = [land_lahn_1_0, ..., land_lahn_1_12]</span>
<span class="sd">    sm_lahn_2 = [land_lahn_2]</span>
<span class="sd">    sm_lahn_1 = [land_lahn_1_0, ..., land_lahn_1_12]</span>
<span class="sd">    quh = [land_lahn_2]</span>
<span class="sd">    swe_headwaters = [land_dill, land_lahn_1]</span>
<span class="sd">    land_dill_factors_tmean = land_dill</span>
<span class="sd">    land_dill_fluxes_qt = land_dill</span>
<span class="sd">    land_dill_fluxes_qt_series = land_dill</span>
<span class="sd">    land_dill_states_sm = (&#39;land_dill_0&#39;, ..., &#39;land_dill_11&#39;)</span>
<span class="sd">    land_lahn_1_states_sm = (&#39;land_lahn_1_0&#39;, ..., &#39;land_lahn_1_12&#39;)</span>
<span class="sd">    land_lahn_2_states_sm = (&#39;land_lahn_2_0&#39;, ..., &#39;land_lahn_2_9&#39;)</span>
<span class="sd">    land_lahn_3_states_sm = (&#39;land_lahn_3_0&#39;, ..., &#39;land_lahn_3_13&#39;)</span>
<span class="sd">    land_lahn_3_states_sm_series = (&#39;land_lahn_3_0&#39;, ..., &#39;land_lahn_3_13&#39;)</span>
<span class="sd">    dill_nodes_sim_series = dill</span>

<span class="sd">    The |Timegrids.init| time grid is immutable once the server is ready.  Method</span>
<span class="sd">    |HydPyServer.GET_query_initialisationtimegrid| returns the fixed first date, last</span>
<span class="sd">    date, and stepsize of the whole initialised period:</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;query_initialisationtimegrid&quot;)</span>
<span class="sd">    firstdate_init = 1996-01-01T00:00:00+01:00</span>
<span class="sd">    lastdate_init = 1996-01-06T00:00:00+01:00</span>
<span class="sd">    stepsize = 1d</span>

<span class="sd">    The dates of the |Timegrids.sim| time grid, on the other hand, are mutable and can</span>
<span class="sd">    vary for different `id` query parameters.  This flexibility makes things a little</span>
<span class="sd">    more complicated, as the |Timegrids| object of the global |pub| module handles only</span>
<span class="sd">    one |Timegrids.sim| object at once.  Hence, we differentiate between registered</span>
<span class="sd">    simulation dates of the respective `id` values and the current simulation dates of</span>
<span class="sd">    the |Timegrids| object.</span>

<span class="sd">    Method |HydPyServer.GET_query_simulationdates| asks for registered simulation dates</span>
<span class="sd">    and thus fails at first:</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;query_simulationdates&quot;, id_=&quot;0&quot;)</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    urllib.error.HTTPError: HTTP Error 500: RuntimeError: While trying to execute \</span>
<span class="sd">method `GET_query_simulationdates`, the following error occurred: Nothing registered \</span>
<span class="sd">under the id `0`.  There is nothing registered, so far.</span>

<span class="sd">    After logging new simulation dates via the POST method</span>
<span class="sd">    |HydPyServer.POST_register_simulationdates|, method</span>
<span class="sd">    |HydPyServer.GET_query_simulationdates| returns them correctly:</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;register_simulationdates&quot;, id_=&quot;0&quot;,</span>
<span class="sd">    ...      data=(&quot;firstdate_sim = 1996-01-01\\n&quot;</span>
<span class="sd">    ...            &quot;lastdate_sim = 1996-01-02&quot;))</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;query_simulationdates&quot;, id_=&quot;0&quot;)</span>
<span class="sd">    firstdate_sim = 1996-01-01T00:00:00+01:00</span>
<span class="sd">    lastdate_sim = 1996-01-02T00:00:00+01:00</span>

<span class="sd">    Our initial call to the POST method |HydPyServer.POST_register_simulationdates| did</span>
<span class="sd">    not affect the currently active simulation dates.  We need to do this manually by</span>
<span class="sd">    calling method |HydPyServer.GET_activate_simulationdates|:</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;evaluate&quot;, data=&quot;lastdate = hydpy.pub.timegrids.sim.lastdate&quot;)</span>
<span class="sd">    lastdate = Date(&quot;1996-01-06T00:00:00&quot;)</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;activate_simulationdates&quot;, id_=&quot;0&quot;)</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;evaluate&quot;, data=&quot;lastdate = hydpy.pub.timegrids.sim.lastdate&quot;)</span>
<span class="sd">    lastdate = Date(&quot;1996-01-02 00:00:00&quot;)</span>

<span class="sd">    Generally, passing a missing `id` while others are available results in error</span>
<span class="sd">    messages like the following:</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;activate_simulationdates&quot;, id_=&quot;1&quot;)</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    urllib.error.HTTPError: HTTP Error 500: RuntimeError: While trying to execute \</span>
<span class="sd">method `GET_activate_simulationdates`, the following error occurred: Nothing \</span>
<span class="sd">registered under the id `1`.  The available ids are: 0.</span>

<span class="sd">    The logic of the parameter-related GET and POST methods is very similar to the one</span>
<span class="sd">    of the simulation date-related methods discussed above.  Method</span>
<span class="sd">    |HydPyServer.POST_register_parameteritemvalues| registers new values of the</span>
<span class="sd">    exchange items, and method |HydPyServer.GET_activate_parameteritemvalues| activates</span>
<span class="sd">    them (assigns them to the relevant parameters):</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;register_parameteritemvalues&quot;, id_=&quot;0&quot;,</span>
<span class="sd">    ...      data=(&quot;alpha = 3.0\\n&quot;</span>
<span class="sd">    ...            &quot;beta = 2.0\\n&quot;</span>
<span class="sd">    ...            &quot;lag = 1.0\\n&quot;</span>
<span class="sd">    ...            &quot;damp = 0.5\\n&quot;</span>
<span class="sd">    ...            &quot;sfcf_1 = 0.3\\n&quot;</span>
<span class="sd">    ...            &quot;sfcf_2 = 0.2\\n&quot;</span>
<span class="sd">    ...            &quot;sfcf_3 = 0.1\\n&quot;</span>
<span class="sd">    ...            &quot;k4 = 10.0\\n&quot;))</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    &gt;&gt;&gt; control = &quot;HydPyServer.state.hp.elements.land_dill.model.parameters.control&quot;</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;evaluate&quot;,</span>
<span class="sd">    ...      data=(f&quot;alpha = {control}.alpha\\n&quot;</span>
<span class="sd">    ...            f&quot;sfcf = {control}.sfcf&quot;))</span>
<span class="sd">    alpha = alpha(1.0)</span>
<span class="sd">    sfcf = sfcf(1.1)</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;activate_parameteritemvalues&quot;, id_=&quot;0&quot;)</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;evaluate&quot;,</span>
<span class="sd">    ...      data=(f&quot;alpha = {control}.alpha\\n&quot;</span>
<span class="sd">    ...            f&quot;sfcf = {control}.sfcf&quot;))</span>
<span class="sd">    alpha = alpha(3.0)</span>
<span class="sd">    sfcf = sfcf(1.34283)</span>

<span class="sd">    The list of exchange items must be complete:</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;register_parameteritemvalues&quot;, id_=&quot;0&quot;,</span>
<span class="sd">    ...      data=(&quot;alpha = 3.0\\n&quot;</span>
<span class="sd">    ...            &quot;beta = 2.0&quot;))</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    urllib.error.HTTPError: HTTP Error 500: RuntimeError: While trying to execute \</span>
<span class="sd">method `POST_register_parameteritemvalues`, the following error occurred: A value for \</span>
<span class="sd">parameter item `lag` is missing.</span>

<span class="sd">    Note that the related query method (|HydPyServer.GET_query_parameteritemvalues|)</span>
<span class="sd">    returns the logged values of the |ChangeItem| objects instead of the (eventually</span>
<span class="sd">    modified) values of the |Parameter| objects:</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;query_parameteritemvalues&quot;, id_=&quot;0&quot;)</span>
<span class="sd">    alpha = 3.0</span>
<span class="sd">    beta = 2.0</span>
<span class="sd">    lag = 1.0</span>
<span class="sd">    damp = 0.5</span>
<span class="sd">    sfcf_1 = 0.3</span>
<span class="sd">    sfcf_2 = 0.2</span>
<span class="sd">    sfcf_3 = 0.1</span>
<span class="sd">    k4 = 10.0</span>

<span class="sd">    The condition-related methods |HydPyServer.POST_register_conditionitemvalues|,</span>
<span class="sd">    |HydPyServer.GET_activate_conditionitemvalues|, and</span>
<span class="sd">    |HydPyServer.GET_query_conditionitemvalues| work like the parameter-related</span>
<span class="sd">    methods described above:</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;register_conditionitemvalues&quot;, id_=&quot;0&quot;,</span>
<span class="sd">    ...      data=(&quot;sm_lahn_2 = 246.0\\n&quot;</span>
<span class="sd">    ...            &quot;sm_lahn_1 = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13]\\n&quot;</span>
<span class="sd">    ...            &quot;ic_lahn_2 = 642.0\\n&quot;</span>
<span class="sd">    ...            &quot;ic_lahn_1 = [13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1]\\n&quot;</span>
<span class="sd">    ...            &quot;quh = 1.0\\n&quot;))</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;query_conditionitemvalues&quot;, id_=&quot;0&quot;)</span>
<span class="sd">    ic_lahn_2 = 642.0</span>
<span class="sd">    ic_lahn_1 = [13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1]</span>
<span class="sd">    sm_lahn_2 = 246.0</span>
<span class="sd">    sm_lahn_1 = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13]</span>
<span class="sd">    quh = 1.0</span>

<span class="sd">    Note the trimming of the too-high value for the state sequence |hland_states.SM| to</span>
<span class="sd">    its highest possible value defined by control parameter |hland_control.FC|):</span>

<span class="sd">    &gt;&gt;&gt; for element in (&quot;land_lahn_1&quot;, &quot;land_lahn_2&quot;):</span>
<span class="sd">    ...     sequences = f&quot;HydPyServer.state.hp.elements.{element}.model.sequences&quot;</span>
<span class="sd">    ...     test(&quot;evaluate&quot;,</span>
<span class="sd">    ...          data=(f&quot;sm = {sequences}.states.sm \\n&quot;</span>
<span class="sd">    ...                f&quot;quh = {sequences}.logs.quh&quot;))  # doctest: +ELLIPSIS</span>
<span class="sd">    sm = sm(99.27505, ..., 142.84148)</span>
<span class="sd">    quh = quh(0.0)</span>
<span class="sd">    sm = sm(138.31396, ..., 164.63255)</span>
<span class="sd">    quh = quh(0.7, 0.0)</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;activate_conditionitemvalues&quot;, id_=&quot;0&quot;)</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    &gt;&gt;&gt; for element in (&quot;land_lahn_1&quot;, &quot;land_lahn_2&quot;):</span>
<span class="sd">    ...     sequences = f&quot;HydPyServer.state.hp.elements.{element}.model.sequences&quot;</span>
<span class="sd">    ...     test(&quot;evaluate&quot;,</span>
<span class="sd">    ...          data=(f&quot;sm = {sequences}.states.sm \\n&quot;</span>
<span class="sd">    ...                f&quot;quh = {sequences}.logs.quh&quot;))  # doctest: +ELLIPSIS</span>
<span class="sd">    sm = sm(1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0, 10.0, 11.0, 12.0, 13.0)</span>
<span class="sd">    quh = quh(0.0)</span>
<span class="sd">    sm = sm(197.0, 197.0, 197.0, 197.0, 197.0, 197.0, 197.0, 197.0, 197.0, 197.0)</span>
<span class="sd">    quh = quh(1.0, 0.0)</span>

<span class="sd">    The methods |HydPyServer.POST_register_inputitemvalues|,</span>
<span class="sd">    |HydPyServer.GET_activate_inputitemvalues|, and</span>
<span class="sd">    |HydPyServer.GET_query_inputitemvalues| always focus on the currently relevant</span>
<span class="sd">    simulation time grid:</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;update_inputitemvalues&quot;, id_=&quot;0&quot;)</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;query_inputitemvalues&quot;, id_=&quot;0&quot;)</span>
<span class="sd">    t_headwaters = [[-0.298846], [-0.705395]]</span>
<span class="sd">    &gt;&gt;&gt; t = &quot;HydPyServer.state.hp.elements.land_lahn_1.model.sequences.inputs.t&quot;</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;evaluate&quot;, data=(f&quot;t_series = {t}.series\\n&quot;</span>
<span class="sd">    ...                        f&quot;t_simseries = {t}.simseries\\n&quot;))</span>
<span class="sd">    t_series = InfoArray([-0.70539496, -1.50555283, -4.22126769, -7.44634946, \</span>
<span class="sd">-8.11936591])</span>
<span class="sd">    t_simseries = InfoArray([-0.70539496])</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;register_inputitemvalues&quot;, id_=&quot;0&quot;,</span>
<span class="sd">    ...      data=&quot;t_headwaters = [[1.0], [2.0]]\\n&quot;)</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;activate_inputitemvalues&quot;, id_=&quot;0&quot;)</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;evaluate&quot;, data=(f&quot;t_series = {t}.series\\n&quot;</span>
<span class="sd">    ...                        f&quot;t_simseries = {t}.simseries\\n&quot;))</span>
<span class="sd">    t_series = InfoArray([ 2.        , -1.50555283, -4.22126769, -7.44634946, \</span>
<span class="sd">-8.11936591])</span>
<span class="sd">    t_simseries = InfoArray([2.])</span>

<span class="sd">    The &quot;official&quot; way to gain information on modified parameters or conditions is to</span>
<span class="sd">    use the method |HydPyServer.GET_query_getitemvalues|:</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;query_getitemvalues&quot;, id_=&quot;0&quot;)</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    urllib.error.HTTPError: HTTP Error 500: RuntimeError: While trying to execute \</span>
<span class="sd">method `GET_query_getitemvalues`, the following error occurred: Nothing registered \</span>
<span class="sd">under the id `0`.  There is nothing registered, so far.</span>

<span class="sd">    As the error message explains, we first need to fill the registry for the given</span>
<span class="sd">    `id` parameter.  Unlike the examples above, we do not do this by sending external</span>
<span class="sd">    data via a POST request but by retrieving the server&#39;s currently active data.  We</span>
<span class="sd">    accomplish this task by calling the GET method</span>
<span class="sd">    |HydPyServer.GET_update_getitemvalues|:</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;update_getitemvalues&quot;, id_=&quot;0&quot;)</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;query_getitemvalues&quot;, id_=&quot;0&quot;)  # doctest: +ELLIPSIS</span>
<span class="sd">    land_dill_factors_tmean = nan</span>
<span class="sd">    land_dill_fluxes_qt = nan</span>
<span class="sd">    land_dill_fluxes_qt_series = [nan]</span>
<span class="sd">    land_dill_states_sm = [185.13164, ...]</span>
<span class="sd">    land_lahn_1_states_sm = [1.0, 2.0, ..., 12.0, 13.0]</span>
<span class="sd">    land_lahn_2_states_sm = [197.0, ..., 197.0]</span>
<span class="sd">    land_lahn_3_states_sm = [101.31248, ...]</span>
<span class="sd">    land_lahn_3_states_sm_series = [[nan, ..., nan]]</span>
<span class="sd">    dill_nodes_sim_series = [nan]</span>

<span class="sd">    Besides the &quot;official&quot; way for retrieving information (which we sometimes call the</span>
<span class="sd">    &quot;getitem style), some sequences types (namely those derived from |FactorSequence|</span>
<span class="sd">    and |FluxSequence|) also allow retrieving information in the so-called &quot;setitem</span>
<span class="sd">    style&quot; via the methods |HydPyServer.GET_update_outputitemvalues| and</span>
<span class="sd">    |HydPyServer.GET_query_outputitemvalues|:</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;query_outputitemvalues&quot;, id_=&quot;0&quot;)</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    urllib.error.HTTPError: HTTP Error 500: RuntimeError: While trying to execute \</span>
<span class="sd">method `GET_query_outputitemvalues`, the following error occurred: Nothing registered \</span>
<span class="sd">under the id `0`.  There is nothing registered, so far.</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;update_outputitemvalues&quot;, id_=&quot;0&quot;)</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;query_outputitemvalues&quot;, id_=&quot;0&quot;)</span>
<span class="sd">    swe_headwaters = [[nan], [nan]]</span>

<span class="sd">    We now modify the parameter, condition, and input time series values again, but</span>
<span class="sd">    this time in one step through calling |HydPyServer.POST_register_changeitemvalues|</span>
<span class="sd">    and |HydPyServer.GET_activate_changeitemvalues|:</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;register_changeitemvalues&quot;, id_=&quot;0&quot;,</span>
<span class="sd">    ...      data=(&quot;alpha = 1.0\\n&quot;</span>
<span class="sd">    ...            &quot;beta = 1.0\\n&quot;</span>
<span class="sd">    ...            &quot;lag = 0.0\\n&quot;</span>
<span class="sd">    ...            &quot;damp = 0.0\\n&quot;</span>
<span class="sd">    ...            &quot;sfcf_1 = 0.0\\n&quot;</span>
<span class="sd">    ...            &quot;sfcf_2 = 0.0\\n&quot;</span>
<span class="sd">    ...            &quot;sfcf_3 = 0.0\\n&quot;</span>
<span class="sd">    ...            &quot;k4 = 5.0\\n&quot;</span>
<span class="sd">    ...            &quot;ic_lahn_1 = 1.0\\n&quot;</span>
<span class="sd">    ...            &quot;ic_lahn_2 = 2.0\\n&quot;</span>
<span class="sd">    ...            &quot;sm_lahn_1 = 50.0\\n&quot;</span>
<span class="sd">    ...            &quot;sm_lahn_2 = 100.0\\n&quot;</span>
<span class="sd">    ...            &quot;quh = 0.0\\n&quot;</span>
<span class="sd">    ...            &quot;t_headwaters = [[-0.29884643], [-0.70539496]]\\n&quot;))</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;activate_changeitemvalues&quot;, id_=&quot;0&quot;)</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;query_changeitemvalues&quot;, id_=&quot;0&quot;)  # doctest: +ELLIPSIS</span>
<span class="sd">    alpha = 1.0</span>
<span class="sd">    beta = 1.0</span>
<span class="sd">    lag = 0.0</span>
<span class="sd">    damp = 0.0</span>
<span class="sd">    sfcf_1 = 0.0</span>
<span class="sd">    sfcf_2 = 0.0</span>
<span class="sd">    sfcf_3 = 0.0</span>
<span class="sd">    k4 = 5.0</span>
<span class="sd">    t_headwaters = [[-0.29884...], [-0.70539...]]</span>
<span class="sd">    ic_lahn_2 = 2.0</span>
<span class="sd">    ic_lahn_1 = 1.0</span>
<span class="sd">    sm_lahn_2 = 100.0</span>
<span class="sd">    sm_lahn_1 = 50.0</span>
<span class="sd">    quh = 0.0</span>

<span class="sd">    Next, we trigger a simulation run by calling the GET method</span>
<span class="sd">    |HydPyServer.GET_simulate|:</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;simulate&quot;, id_=&quot;0&quot;)</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>

<span class="sd">    Calling methods |HydPyServer.GET_update_getitemvalues| and</span>
<span class="sd">    |HydPyServer.GET_query_getitemvalues| as well as methods</span>
<span class="sd">    |HydPyServer.GET_update_outputitemvalues| and</span>
<span class="sd">    |HydPyServer.GET_query_outputitemvalues| reveals how the simulation results:</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;update_getitemvalues&quot;, id_=&quot;0&quot;)</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;query_getitemvalues&quot;, id_=&quot;0&quot;)  # doctest: +ELLIPSIS</span>
<span class="sd">    land_dill_factors_tmean = -0.572053</span>
<span class="sd">    land_dill_fluxes_qt = 5.515321</span>
<span class="sd">    ...</span>
<span class="sd">    land_lahn_2_states_sm = [99.848023, ..., 99.848023]</span>
<span class="sd">    ...</span>
<span class="sd">    dill_nodes_sim_series = [5.515321]</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;update_outputitemvalues&quot;, id_=&quot;0&quot;)</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;query_outputitemvalues&quot;, id_=&quot;0&quot;)</span>
<span class="sd">    swe_headwaters = [[0.0], [0.0]]</span>

<span class="sd">    So far, we have explained how the *HydPy* server memorises different exchange item</span>
<span class="sd">    values for different values of query parameter `id`.  Complicating matters,</span>
<span class="sd">    memorising condition values must also consider the relevant time point.  You load</span>
<span class="sd">    conditions for the simulation period&#39;s current start date with method</span>
<span class="sd">    |HydPyServer.GET_load_internalconditions| and save them for the current end date</span>
<span class="sd">    with method |HydPyServer.GET_save_internalconditions|.  For example, we first save</span>
<span class="sd">    the states calculated for the end time of the last simulation run (January 2):</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;query_simulationdates&quot;, id_=&quot;0&quot;)</span>
<span class="sd">    firstdate_sim = 1996-01-01T00:00:00+01:00</span>
<span class="sd">    lastdate_sim = 1996-01-02T00:00:00+01:00</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;evaluate&quot;,</span>
<span class="sd">    ...      data=f&quot;sm_lahn2 = {sequences}.states.sm&quot;)  # doctest: +ELLIPSIS</span>
<span class="sd">    sm_lahn2 = sm(99.848023, ..., 99.848023)</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;save_internalconditions&quot;, id_=&quot;0&quot;)</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>

<span class="sd">    Calling method |HydPyServer.GET_load_internalconditions| without changing the</span>
<span class="sd">    simulation dates reloads the initial conditions for January 1, originally read from</span>
<span class="sd">    disk:</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;load_internalconditions&quot;, id_=&quot;0&quot;)</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;evaluate&quot;,</span>
<span class="sd">    ...      data=f&quot;sm_lahn2 = {sequences}.states.sm&quot;)  # doctest: +ELLIPSIS</span>
<span class="sd">    sm_lahn2 = sm(138.31396, ..., 164.63255)</span>

<span class="sd">    If we set the first date of the simulation period to January 2, method</span>
<span class="sd">    |HydPyServer.GET_load_internalconditions| loads the conditions we saved for</span>
<span class="sd">    January 2 previously:</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;register_simulationdates&quot;, id_=&quot;0&quot;,</span>
<span class="sd">    ...      data=(&quot;firstdate_sim = 1996-01-02\\n&quot;</span>
<span class="sd">    ...            &quot;lastdate_sim = 1996-01-03&quot;))</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;activate_simulationdates&quot;, id_=&quot;0&quot;)</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;load_internalconditions&quot;, id_=&quot;0&quot;)</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;evaluate&quot;,</span>
<span class="sd">    ...      data=f&quot;sm_lahn2 = {sequences}.states.sm&quot;)  # doctest: +ELLIPSIS</span>
<span class="sd">    sm_lahn2 = sm(99.848023, ..., 99.848023)</span>

<span class="sd">    Loading condition values for a specific time point requires saving them before:</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;register_simulationdates&quot;, id_=&quot;0&quot;,</span>
<span class="sd">    ...      data=(&quot;firstdate_sim = 1996-01-03\\n&quot;</span>
<span class="sd">    ...            &quot;lastdate_sim = 1996-01-05&quot;))</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;activate_simulationdates&quot;, id_=&quot;0&quot;)</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;load_internalconditions&quot;, id_=&quot;0&quot;)</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    urllib.error.HTTPError: HTTP Error 500: RuntimeError: While trying to execute \</span>
<span class="sd">method `GET_load_internalconditions`, the following error occurred: Conditions for \</span>
<span class="sd">ID `0` and time point `1996-01-03 00:00:00` are required, but have not been \</span>
<span class="sd">calculated so far.</span>

<span class="sd">    For example, when restarting data assimilation subsequent forecasting periods, you</span>
<span class="sd">    might need to get and set all internal conditions from the client side.  Then, you</span>
<span class="sd">    have two options.  The more efficient way relies on methods</span>
<span class="sd">    |HydPyServer.GET_query_internalconditions| and</span>
<span class="sd">    |HydPyServer.POST_register_internalconditions|.  Method</span>
<span class="sd">    |HydPyServer.GET_query_internalconditions| returns the information registered for</span>
<span class="sd">    the end of the current simulation period.  All data is within a single nested</span>
<span class="sd">    |dict| object (created  by the |HydPy.conditions| property of class |HydPy|):</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;register_simulationdates&quot;, id_=&quot;0&quot;,</span>
<span class="sd">    ...      data=(&quot;firstdate_sim = 1996-01-01\\n&quot;</span>
<span class="sd">    ...            &quot;lastdate_sim = 1996-01-02&quot;))</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;activate_simulationdates&quot;, id_=&quot;0&quot;)</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    &gt;&gt;&gt; conditions = test(&quot;query_internalconditions&quot;, id_=&quot;0&quot;,</span>
<span class="sd">    ...                   return_result=True)[13:]  # doctest: +ELLIPSIS</span>
<span class="sd">    conditions = {&#39;land_dill&#39;: {&#39;states&#39;: {&#39;ic&#39;: array([0.69171697, 1.19171697...</span>

<span class="sd">    Due to the steps above, the returned dictionary agrees with the current state of</span>
<span class="sd">    the |HydPy| instance:</span>

<span class="sd">    &gt;&gt;&gt; sequences = f&quot;HydPyServer.state.hp.elements.land_dill.model.sequences&quot;</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;evaluate&quot;,</span>
<span class="sd">    ...      data=f&quot;ic_dill = {sequences}.states.ic&quot;)  # doctest: +ELLIPSIS</span>
<span class="sd">    ic_dill = ic(0.691717, 1.191717, 0.692897,...</span>

<span class="sd">    To show that registering new internal conditions also works, we first convert the</span>
<span class="sd">    string representation of the data to actual Python objects by using Python&#39;s |eval|</span>
<span class="sd">    function.  Therefore, we need to clarify that &quot;array&quot; means the array creation</span>
<span class="sd">    function |numpy.array| of |numpy|:</span>

<span class="sd">    &gt;&gt;&gt; import numpy</span>
<span class="sd">    &gt;&gt;&gt; conditions = eval(conditions, {&quot;array&quot;: numpy.array})</span>

<span class="sd">    Next, we modify an arbitrary state and convert the dictionary back to a single-line</span>
<span class="sd">    string:</span>

<span class="sd">    &gt;&gt;&gt; conditions[&quot;land_dill&quot;][&quot;states&quot;][&quot;ic&quot;][:2] = 0.5, 2.0</span>
<span class="sd">    &gt;&gt;&gt; conditions = str(conditions).replace(&quot;\\n&quot;, &quot; &quot;)</span>

<span class="sd">    Now we can send the modified data back to the server by using the</span>
<span class="sd">    |HydPyServer.POST_register_internalconditions| method, which stores it for the</span>
<span class="sd">    start of the simulation period:</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;register_internalconditions&quot;, id_=&quot;0&quot;, data=f&quot;conditions = {conditions}&quot;)</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    &gt;&gt;&gt; ic_dill = &quot;self.state.conditions[&#39;0&#39;][0][&#39;land_dill&#39;][&#39;states&#39;][&#39;ic&#39;]&quot;</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;evaluate&quot;,</span>
<span class="sd">    ...      data=f&quot;ic_dill = {ic_dill}&quot;)  # doctest: +ELLIPSIS</span>
<span class="sd">    ic_dill = array([0.5       , 2.        , 0.69289697,...</span>

<span class="sd">    After calling method |HydPyServer.GET_load_internalconditions|, the freshly</span>
<span class="sd">    registered states are ready to be used by the next simulation run:</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;load_internalconditions&quot;, id_=&quot;0&quot;)</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;evaluate&quot;,</span>
<span class="sd">    ...      data=f&quot;ic_dill = {sequences}.states.ic&quot;)  # doctest: +ELLIPSIS</span>
<span class="sd">    ic_dill = ic(0.5, 1.5, 0.692897,...</span>

<span class="sd">    Keeping the internal conditions for multiple time points can use plenty of RAM.</span>
<span class="sd">    Use the GET method |HydPyServer.GET_deregister_internalconditions| to remove all</span>
<span class="sd">    conditions data available under the given `id` to avoid that:</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;query_internalconditions&quot;, id_=&quot;0&quot;)  # doctest: +ELLIPSIS</span>
<span class="sd">    conditions = {&#39;land_dill&#39;: {&#39;states&#39;: {&#39;ic&#39;: array([0.6917...</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;deregister_internalconditions&quot;, id_=&quot;0&quot;)</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;query_internalconditions&quot;, id_=&quot;0&quot;)</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    urllib.error.HTTPError: HTTP Error 500: RuntimeError: While trying to execute \</span>
<span class="sd">method `GET_query_internalconditions`, the following error occurred: No internal \</span>
<span class="sd">conditions registered under the id `0` for `1996-01-02 00:00:00`.</span>

<span class="sd">    Some algorithms provide new information about initial conditions and require</span>
<span class="sd">    information on how they evolve during a simulation.  For such purposes, you can</span>
<span class="sd">    use method |HydPyServer.GET_update_conditionitemvalues| to store the current</span>
<span class="sd">    conditions under an arbitrary `id` and use method</span>
<span class="sd">    |HydPyServer.GET_query_conditionitemvalues| to query them later.  Note that this</span>
<span class="sd">    approach so far only works when using |SetItem| objects that modify their target</span>
<span class="sd">    sequence on the `device` or `subunit` level (please tell us if you encounter other</span>
<span class="sd">    relevant use-cases):</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;update_conditionitemvalues&quot;, id_=&quot;0&quot;)</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;query_conditionitemvalues&quot;, id_=&quot;0&quot;)  # doctest: +ELLIPSIS</span>
<span class="sd">    ic_lahn_2 = [0.953246...]</span>
<span class="sd">    ic_lahn_1 = [0.738365, ...]</span>
<span class="sd">    sm_lahn_2 = [99.84802...]</span>
<span class="sd">    sm_lahn_1 = [49.92944...]</span>
<span class="sd">    quh = [0.00038...]</span>

<span class="sd">    The second option for handling multiple &quot;simultaneous&quot; initial conditions is</span>
<span class="sd">    telling the *HydPy* server to read them from and write them to disk, which is</span>
<span class="sd">    easier but often less efficient due to higher IO activity.  Use methods</span>
<span class="sd">    |HydPyServer.GET_load_conditions| and |HydPyServer.GET_save_conditions| for this</span>
<span class="sd">    purpose.  Reading from or writing to different directories than those defined in</span>
<span class="sd">    `multiple_runs.xml` requires registering them beforehand.  If we, for example,</span>
<span class="sd">    create a new empty directory with method</span>
<span class="sd">    |HydPyServer.POST_register_inputconditiondir|, loading conditions from it must</span>
<span class="sd">    fail:</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;register_inputconditiondir&quot;, id_=&quot;0&quot;, data=&quot;inputconditiondir = new&quot;)</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;load_conditions&quot;, id_=&quot;0&quot;)  # doctest: +ELLIPSIS</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    urllib.error.HTTPError: HTTP Error 500: FileNotFoundError: While trying to \</span>
<span class="sd">execute method `GET_load_conditions`, the following error occurred: While trying to \</span>
<span class="sd">load the initial conditions of element `land_dill`, the following error occurred: \</span>
<span class="sd">[Errno 2] No such file or directory: ...land_dill.py&#39;</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;register_outputconditiondir&quot;, id_=&quot;0&quot;, data=&quot;outputconditiondir = new&quot;)</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;save_conditions&quot;, id_=&quot;0&quot;)</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>

<span class="sd">    Hence, we better first write suitable conditions into the new directory:</span>

<span class="sd">    &gt;&gt;&gt; lz_dill = &quot;self.state.hp.elements.land_dill.model.sequences.states.lz&quot;</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;evaluate&quot;, data=f&quot;lz_dill = {lz_dill}&quot;)  # doctest: +ELLIPSIS</span>
<span class="sd">    lz_dill = lz(9.4921...)</span>

<span class="sd">    To prove reading and writing conditions works, we first set the current value of</span>
<span class="sd">    sequence |hland_states.LZ| of catchment &quot;Dill&quot; to zero:</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;evaluate&quot;, data=f&quot;nothing = {lz_dill}(0.0)&quot;)</span>
<span class="sd">    nothing = None</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;evaluate&quot;, data=f&quot;lz_dill = {lz_dill}&quot;)</span>
<span class="sd">    lz_dill = lz(0.0)</span>

<span class="sd">    As expected, applying |HydPyServer.GET_load_conditions| on the previously written</span>
<span class="sd">    data resets the value of |hland_states.LZ|:</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;load_conditions&quot;, id_=&quot;0&quot;)</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;evaluate&quot;, data=f&quot;lz_dill = {lz_dill}&quot;)  # doctest: +ELLIPSIS</span>
<span class="sd">    lz_dill = lz(9.4921...)</span>

<span class="sd">    Use the GET methods |HydPyServer.GET_query_inputconditiondir| and</span>
<span class="sd">    |HydPyServer.GET_deregister_inputconditiondir| to query or remove the currently</span>
<span class="sd">    registered input condition directory:</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;query_inputconditiondir&quot;, id_=&quot;0&quot;)</span>
<span class="sd">    inputconditiondir = new</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;deregister_inputconditiondir&quot;, id_=&quot;0&quot;)</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;query_inputconditiondir&quot;, id_=&quot;0&quot;)</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    urllib.error.HTTPError: HTTP Error 500: RuntimeError: While trying to execute \</span>
<span class="sd">method `GET_query_inputconditiondir`, the following error occurred: Nothing \</span>
<span class="sd">registered under the id `0`.  There is nothing registered, so far.</span>

<span class="sd">    Use the GET methods |HydPyServer.GET_query_outputconditiondir| and</span>
<span class="sd">    |HydPyServer.GET_deregister_outputconditiondir| to query or remove the currently</span>
<span class="sd">    registered output condition directory:</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;query_outputconditiondir&quot;, id_=&quot;0&quot;)</span>
<span class="sd">    outputconditiondir = new</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;deregister_outputconditiondir&quot;, id_=&quot;0&quot;)</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;query_outputconditiondir&quot;, id_=&quot;0&quot;)</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    urllib.error.HTTPError: HTTP Error 500: RuntimeError: While trying to execute \</span>
<span class="sd">method `GET_query_outputconditiondir`, the following error occurred: Nothing \</span>
<span class="sd">registered under the id `0`.  There is nothing registered, so far.</span>

<span class="sd">    Above, we explained the recommended way to query the initial values of all or a</span>
<span class="sd">    subgroup of the available exchange items.  Alternatively, you can first register</span>
<span class="sd">    the initial values and query them later, which is a workaround for retrieving</span>
<span class="sd">    initial and intermediate values with the same HTTP request (an `OpenDA`_</span>
<span class="sd">    requirement):</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;register_initialitemvalues&quot;, id_=&quot;1&quot;)</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;query_itemvalues&quot;, id_=&quot;1&quot;)  # doctest: +ELLIPSIS</span>
<span class="sd">    alpha = 2.0</span>
<span class="sd">    beta = 1.0</span>
<span class="sd">    lag = 5.0</span>
<span class="sd">    damp = 0.5</span>
<span class="sd">    sfcf_1 = 0.3</span>
<span class="sd">    sfcf_2 = 0.2</span>
<span class="sd">    sfcf_3 = [0.1, 0.2, 0.1, 0.2, 0.1, 0.2, 0.1, 0.2, 0.1, 0.2, 0.1, 0.2, 0.2, 0.2]</span>
<span class="sd">    k4 = 10.0</span>
<span class="sd">    t_headwaters = [[-0.29884...], [-0.70539...]]</span>
<span class="sd">    ic_lahn_2 = [1.18494...]</span>
<span class="sd">    ic_lahn_1 = [0.96404...]</span>
<span class="sd">    sm_lahn_2 = [123.0]</span>
<span class="sd">    sm_lahn_1 = [110.0, 120.0, 130.0, 140.0, 150.0, 160.0, 170.0, 180.0, 190.0, \</span>
<span class="sd">200.0, 210.0, 220.0, 230.0]</span>
<span class="sd">    quh = [10.0]</span>
<span class="sd">    swe_headwaters = [[nan, nan, nan, nan, nan], [nan, nan, nan, nan, nan]]</span>
<span class="sd">    land_dill_factors_tmean = nan</span>
<span class="sd">    land_dill_fluxes_qt = nan</span>
<span class="sd">    land_dill_fluxes_qt_series = [nan, nan, nan, nan, nan]</span>
<span class="sd">    land_dill_states_sm = [185.13164...]</span>
<span class="sd">    land_lahn_1_states_sm = [99.27505...]</span>
<span class="sd">    land_lahn_2_states_sm = [138.31396...]</span>
<span class="sd">    land_lahn_3_states_sm = [101.31248...]</span>
<span class="sd">    land_lahn_3_states_sm_series = [[nan, ...], [nan, ...], ..., [nan, ...]]</span>
<span class="sd">    dill_nodes_sim_series = [nan, nan, nan, nan, nan]</span>

<span class="sd">    In contrast to running a single simulation via method |run_simulation|, the *HydPy*</span>
<span class="sd">    server does (usually) not write calculated time series automatically.  Instead, one</span>
<span class="sd">    must manually call method |HydPyServer.GET_save_allseries|:</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;save_allseries&quot;, id_=&quot;0&quot;)</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>

<span class="sd">    According to the fixed configuration of `multiple_runs.xml`,</span>
<span class="sd">    |HydPyServer.GET_save_allseries| wrote averaged soil moisture values into the</span>
<span class="sd">    directory `mean_sm`:</span>

<span class="sd">    &gt;&gt;&gt; import netCDF4</span>
<span class="sd">    &gt;&gt;&gt; from hydpy import print_values</span>
<span class="sd">    &gt;&gt;&gt; filepath = &quot;LahnH/series/mean_sm/hland_v1_state_sm_mean.nc&quot;</span>
<span class="sd">    &gt;&gt;&gt; with TestIO(), netCDF4.Dataset(filepath) as ncfile:</span>
<span class="sd">    ...     print_values(ncfile[&quot;state_sm&quot;][:, 0])</span>
<span class="sd">    211.238178, 0.0, 0.0, 0.0, 0.0</span>

<span class="sd">    To save the results of subsequent simulations without overwriting the previous</span>
<span class="sd">    ones, change the current series writer directory by the GET method</span>
<span class="sd">    |HydPyServer.POST_register_serieswriterdir|:</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;register_serieswriterdir&quot;, id_=&quot;0&quot;, data=&quot;serieswriterdir = sm_averaged&quot;)</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;save_allseries&quot;, id_=&quot;0&quot;)</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    &gt;&gt;&gt; filepath = &quot;LahnH/series/sm_averaged/hland_v1_state_sm_mean.nc&quot;</span>
<span class="sd">    &gt;&gt;&gt; with TestIO(), netCDF4.Dataset(filepath) as ncfile:</span>
<span class="sd">    ...     print_values(ncfile[&quot;state_sm&quot;][:, 0])</span>
<span class="sd">    211.238178, 0.0, 0.0, 0.0, 0.0</span>

<span class="sd">    |HydPyServer.GET_deregister_serieswriterdir| removes the currently set directory</span>
<span class="sd">    from the registry so that the HydPy server falls back to the</span>
<span class="sd">    configuration of `multiple_runs.xml`:</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;query_serieswriterdir&quot;, id_=&quot;0&quot;)</span>
<span class="sd">    serieswriterdir = sm_averaged</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;deregister_serieswriterdir&quot;, id_=&quot;0&quot;)</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;query_serieswriterdir&quot;, id_=&quot;0&quot;)</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    urllib.error.HTTPError: HTTP Error 500: RuntimeError: While trying to execute \</span>
<span class="sd">method `GET_query_serieswriterdir`, the following error occurred: Nothing registered \</span>
<span class="sd">under the id `0`.  There is nothing registered, so far.</span>

<span class="sd">    The same holds for time series to be written &quot;just in time&quot; during simulation runs.</span>
<span class="sd">    The `temperature` writer in `multiple_runs.xml` select the `jit` mode.  This</span>
<span class="sd">    setting triggered that the *HydPy* server wrote the time series of sequences</span>
<span class="sd">    |hland_inputs.T| and |hland_inputs.TN| to the directory `temperature` during the</span>
<span class="sd">    last simulation:</span>

<span class="sd">    &gt;&gt;&gt; filepath = &quot;LahnH/series/temperature/hland_v1_input_t.nc&quot;</span>
<span class="sd">    &gt;&gt;&gt; with TestIO(), netCDF4.Dataset(filepath) as ncfile:</span>
<span class="sd">    ...     print_values(ncfile[&quot;input_t&quot;][:, 0])</span>
<span class="sd">    -0.298846, 0.0, 0.0, 0.0, 0.0</span>

<span class="sd">    The input sequences |hland_inputs.P| and |hland_inputs.EPN| are instead reading</span>
<span class="sd">    their time series &quot;just in time&quot; (reading and writing data for the same |IOSequence|</span>
<span class="sd">    object is not supported).  We query the last read value of |hland_inputs.EPN| for</span>
<span class="sd">    the Dill catchment:</span>

<span class="sd">    &gt;&gt;&gt; epn = f&quot;HydPyServer.state.hp.elements.land_dill.model.sequences.inputs.epn&quot;</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;evaluate&quot;, data=f&quot;epn_dill = {epn}&quot;)  # doctest: +ELLIPSIS</span>
<span class="sd">    epn_dill = epn(0.2854...)</span>

<span class="sd">    We can change the series writer directory before starting another simulation run to</span>
<span class="sd">    write the time series of |hland_inputs.T| and |hland_inputs.TN| to another</span>
<span class="sd">    directory:</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;register_serieswriterdir&quot;, id_=&quot;0&quot;, data=&quot;serieswriterdir = temp&quot;)</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;simulate&quot;, id_=&quot;0&quot;)</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    &gt;&gt;&gt; filepath = &quot;LahnH/series/temp/hland_v1_input_t.nc&quot;</span>
<span class="sd">    &gt;&gt;&gt; with TestIO(), netCDF4.Dataset(filepath) as ncfile:</span>
<span class="sd">    ...     print_values(ncfile[&quot;input_t&quot;][:, 0])</span>
<span class="sd">    -0.298846, 0.0, 0.0, 0.0, 0.0</span>

<span class="sd">    The &quot;just in time&quot; reading of the series of &quot;P&quot; and &quot;EPN&quot; still worked, showing the</span>
<span class="sd">    registered series directory &quot;temp&quot; only applied for writing data:</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;evaluate&quot;, data=f&quot;epn_dill = {epn}&quot;)  # doctest: +ELLIPSIS</span>
<span class="sd">    epn_dill = epn(0.2854...)</span>

<span class="sd">    Changing the series reader directory works as explained for the series writer</span>
<span class="sd">    directory.  After setting it to an empty folder, |HydPyServer.GET_load_allseries|</span>
<span class="sd">    and |HydPyServer.GET_simulate| cannot find suitable files and report this problem:</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;register_seriesreaderdir&quot;, id_=&quot;0&quot;, data=&quot;seriesreaderdir = no_data&quot;)</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;query_seriesreaderdir&quot;, id_=&quot;0&quot;)</span>
<span class="sd">    seriesreaderdir = no_data</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;load_allseries&quot;, id_=&quot;0&quot;)  # doctest: +ELLIPSIS</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    urllib.error.HTTPError: HTTP Error 500: FileNotFoundError: While trying to \</span>
<span class="sd">execute method `GET_load_allseries`, the following error occurred: While trying to \</span>
<span class="sd">load the time-series data of sequence `t` of element `land_dill`, the following error \</span>
<span class="sd">occurred: [Errno 2] No such file or directory: ...land_dill_input_t.asc&#39;</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;simulate&quot;, id_=&quot;0&quot;)  # doctest: +ELLIPSIS</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    urllib.error.HTTPError: HTTP Error 500: FileNotFoundError: While trying to \</span>
<span class="sd">execute method `GET_simulate`, the following error occurred: While trying to prepare \</span>
<span class="sd">NetCDF files for reading or writing data &quot;just in time&quot; during the current simulation \</span>
<span class="sd">run, the following error occurred: No file `...hland_v1_input_p.nc` available for \</span>
<span class="sd">reading.</span>

<span class="sd">    After deregistering the &quot;no_data&quot; directory, both methods work again:</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;deregister_seriesreaderdir&quot;, id_=&quot;0&quot;)</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;query_seriesreaderdir&quot;, id_=&quot;0&quot;)</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    urllib.error.HTTPError: HTTP Error 500: RuntimeError: While trying to execute \</span>
<span class="sd">method `GET_query_seriesreaderdir`, the following error occurred: Nothing registered \</span>
<span class="sd">under the id `0`.  There is nothing registered, so far.</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;load_allseries&quot;, id_=&quot;0&quot;)</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;simulate&quot;, id_=&quot;0&quot;)</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>

<span class="sd">    As described for time series, one must explicitly pass (comparable) requests to</span>
<span class="sd">    the *HydPy* Server to let it write parameter control files.  The control files</span>
<span class="sd">    reflect the current parameter values of all model instances:</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;register_outputcontroldir&quot;, id_=&quot;0&quot;, data=&quot;outputcontroldir = calibrated&quot;)</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;query_outputcontroldir&quot;, id_=&quot;0&quot;)</span>
<span class="sd">    outputcontroldir = calibrated</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;save_controls&quot;, id_=&quot;0&quot;)</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    &gt;&gt;&gt; with TestIO(), open(&quot;LahnH/control/calibrated/land_dill.py&quot;) as file_:</span>
<span class="sd">    ...     print(file_.read())  # doctest: +ELLIPSIS</span>
<span class="sd">    # -*- coding: utf-8 -*-</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    from hydpy.models.hland_v1 import *</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    simulationstep(&quot;1d&quot;)</span>
<span class="sd">    parameterstep(&quot;1d&quot;)</span>
<span class="sd">    ...</span>
<span class="sd">    beta(1.0)</span>
<span class="sd">    ...</span>

<span class="sd">    &gt;&gt;&gt; parameterstep = &quot;hydpy.pub.options.parameterstep&quot;</span>
<span class="sd">    &gt;&gt;&gt; simulationstep = &quot;hydpy.pub.options.simulationstep&quot;</span>
<span class="sd">    &gt;&gt;&gt; beta = &quot;HydPyServer.state.hp.elements.land_dill.model.parameters.control.beta&quot;</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;evaluate&quot;, data=(f&quot;simulationstep = {simulationstep}\\n&quot;</span>
<span class="sd">    ...                        f&quot;parameterstep = {parameterstep}\\n&quot;</span>
<span class="sd">    ...                        f&quot;beta = {beta}&quot;))</span>
<span class="sd">    simulationstep = Period(&quot;1d&quot;)</span>
<span class="sd">    parameterstep = Period(&quot;1d&quot;)</span>
<span class="sd">    beta = beta(1.0)</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;deregister_outputcontroldir&quot;, id_=&quot;0&quot;)</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    &gt;&gt;&gt; test(&quot;query_outputcontroldir&quot;, id_=&quot;0&quot;)</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    urllib.error.HTTPError: HTTP Error 500: RuntimeError: While trying to execute \</span>
<span class="sd">method `GET_query_outputcontroldir`, the following error occurred: Nothing registered \</span>
<span class="sd">under the id `0`.  There is nothing registered, so far.</span>

<span class="sd">    To close the *HydPy* server, call |HydPyServer.GET_close_server|:</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;close_server&quot;)</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    &gt;&gt;&gt; process.kill()</span>
<span class="sd">    &gt;&gt;&gt; _ = process.communicate()</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># pylint: disable=invalid-name</span>
    <span class="c1"># due to &quot;GET&quot; and &quot;POST&quot; method names in accordance with BaseHTTPRequestHandler</span>

    <span class="n">server</span><span class="p">:</span> <span class="n">_HTTPServerBase</span>
    <span class="n">state</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">ServerState</span><span class="p">]</span>
    <span class="n">extensions_map</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span>
    <span class="n">_requesttype</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;POST&quot;</span><span class="p">]</span>
    <span class="n">_statuscode</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="mi">200</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">500</span><span class="p">]</span>
    <span class="n">_inputs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
    <span class="n">_outputs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">]</span>

<div class="viewcode-block" id="HydPyServer.do_GET">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.do_GET">[docs]</a>
    <span class="k">def</span> <span class="nf">do_GET</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Select and apply the currently requested GET method.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_requesttype</span> <span class="o">=</span> <span class="s2">&quot;GET&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_do_get_or_post</span><span class="p">()</span></div>


<div class="viewcode-block" id="HydPyServer.do_POST">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.do_POST">[docs]</a>
    <span class="k">def</span> <span class="nf">do_POST</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Select and apply the currently requested POST method.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_requesttype</span> <span class="o">=</span> <span class="s2">&quot;POST&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_do_get_or_post</span><span class="p">()</span></div>


    <span class="k">def</span> <span class="nf">_do_get_or_post</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_statuscode</span> <span class="o">=</span> <span class="mi">200</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_requesttype</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_inputs</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_outputs</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">()</span>
            <span class="n">method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_method</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_methodname</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_apply_method</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_write_output</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_statuscode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">400</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_statuscode</span> <span class="o">=</span> <span class="mi">500</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">send_error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_statuscode</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_prepare_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">content_length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">&quot;Content-Length&quot;</span><span class="p">])</span>
        <span class="n">string</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rfile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">content_length</span><span class="p">),</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_inputs</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_inputs</span><span class="p">[</span><span class="n">key</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_statuscode</span> <span class="o">=</span> <span class="mi">400</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;The POST method `</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_externalname</span><span class="si">}</span><span class="s2">` received a wrongly &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;formated data body.  The following line has been extracted but &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;cannot be further processed: `</span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">`.&quot;</span>
                <span class="p">)</span> <span class="kn">from</span> <span class="nn">exc</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ID</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_queryparameter</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_queryparameter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ID</span><span class="p">:</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlparse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">query</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">parse_qs</span><span class="p">(</span><span class="n">query</span><span class="p">)[</span><span class="n">name</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_statuscode</span> <span class="o">=</span> <span class="mi">400</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;For the </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_requesttype</span><span class="si">}</span><span class="s2"> method `</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_externalname</span><span class="si">}</span><span class="s2">` no query &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;parameter `</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">` is given.&quot;</span>
            <span class="p">)</span> <span class="kn">from</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_externalname</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlparse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">path</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_methodname</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_requesttype</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_externalname</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span> <span class="nf">_get_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">types</span><span class="o">.</span><span class="n">MethodType</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">MethodType</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">method</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_statuscode</span> <span class="o">=</span> <span class="mi">400</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No method `</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">` available.&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_apply_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="n">types</span><span class="o">.</span><span class="n">MethodType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">method</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_statuscode</span> <span class="o">=</span> <span class="mi">500</span>
            <span class="n">objecttools</span><span class="o">.</span><span class="n">augment_excmessage</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;While trying to execute method `</span><span class="si">{</span><span class="n">method</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">`&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_write_output</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">string</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outputs</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="n">bstring</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_response</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_statuscode</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="s2">&quot;Content-type&quot;</span><span class="p">,</span> <span class="s2">&quot;text/html&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_headers</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">bstring</span><span class="p">)</span>

<div class="viewcode-block" id="HydPyServer.GET_execute">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_execute">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_execute</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute an arbitrary number of GET methods.</span>

<span class="sd">        The method names must be passed as query parameters, as explained in the main</span>
<span class="sd">        documentation on module |servertools|.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_execute</span><span class="p">()</span></div>


<div class="viewcode-block" id="HydPyServer.POST_execute">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.POST_execute">[docs]</a>
    <span class="k">def</span> <span class="nf">POST_execute</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute an arbitrary number of POST and GET methods.</span>

<span class="sd">        The method names must be passed as query parameters, as explained in the main</span>
<span class="sd">        documentation on module |servertools|.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_execute</span><span class="p">()</span></div>


    <span class="k">def</span> <span class="nf">_execute</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_queryparameter</span><span class="p">(</span><span class="s2">&quot;methods&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_apply_method</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_method</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

<div class="viewcode-block" id="HydPyServer.POST_evaluate">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.POST_evaluate">[docs]</a>
    <span class="k">def</span> <span class="nf">POST_evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluate any valid Python expression with the *HydPy* server process and get</span>
<span class="sd">        its result.</span>

<span class="sd">        Method |HydPyServer.POST_evaluate| serves to test and debug, primarily.  The</span>
<span class="sd">        main documentation on class |HydPyServer| explains its usage.</span>

<span class="sd">        For safety purposes, method |HydPyServer.POST_evaluate| only works if you start</span>
<span class="sd">        the *HydPy* Server in debug mode by writing &quot;debugging=enable&quot;, as we do in the</span>
<span class="sd">        examples of the main documentation on class |HydPyServer|.  When not working in</span>
<span class="sd">        debug mode, invoking this method results in the following error message:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.examples import prepare_full_example_1</span>
<span class="sd">        &gt;&gt;&gt; prepare_full_example_1()</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import run_subprocess, TestIO</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     process = run_subprocess(</span>
<span class="sd">        ...         &quot;hyd.py start_server 8080 LahnH multiple_runs_alpha.xml&quot;,</span>
<span class="sd">        ...         blocking=False, verbose=False)</span>
<span class="sd">        ...     _ = run_subprocess(&quot;hyd.py await_server 8080 10&quot;, verbose=False)</span>
<span class="sd">        &gt;&gt;&gt; from urllib import request</span>
<span class="sd">        &gt;&gt;&gt; request.urlopen(&quot;http://127.0.0.1:8080/evaluate&quot;, data=b&quot;&quot;)</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        urllib.error.HTTPError: HTTP Error 500: RuntimeError: While trying to execute \</span>
<span class="sd">method `POST_evaluate`, the following error occurred: You can only use the POST \</span>
<span class="sd">method `evaluate` if you have started the `HydPy Server` in debugging mode.</span>

<span class="sd">        &gt;&gt;&gt; _ = request.urlopen(&quot;http://127.0.0.1:8080/close_server&quot;)</span>
<span class="sd">        &gt;&gt;&gt; process.kill()</span>
<span class="sd">        &gt;&gt;&gt; _ = process.communicate()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">debugmode</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;You can only use the POST method `evaluate` if you have started the &quot;</span>
                <span class="s2">&quot;`HydPy Server` in debugging mode.&quot;</span>
            <span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inputs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">result</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_outputs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">flatten_repr</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></div>


<div class="viewcode-block" id="HydPyServer.GET_status">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_status">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_status</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return &quot;status = ready&quot; as soon as possible.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_outputs</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ready&quot;</span></div>


<div class="viewcode-block" id="HydPyServer.GET_version">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_version">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_version</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return Hydpy&#39;s version number.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_outputs</span><span class="p">[</span><span class="s2">&quot;version&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">__version__</span></div>


<div class="viewcode-block" id="HydPyServer.GET_close_server">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_close_server">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_close_server</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Stop and close the *HydPy* server.&quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">_close_server</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">server_close</span><span class="p">()</span>

        <span class="n">shutter</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">_close_server</span><span class="p">)</span>
        <span class="n">shutter</span><span class="o">.</span><span class="n">start</span><span class="p">()</span></div>


    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_query_itemtype</span><span class="p">(</span><span class="n">item</span><span class="p">:</span> <span class="n">itemtools</span><span class="o">.</span><span class="n">ExchangeItem</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">targetspecs</span><span class="o">.</span><span class="n">series</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;TimeSeries</span><span class="si">{</span><span class="n">item</span><span class="o">.</span><span class="n">ndim</span><span class="o">-</span><span class="mi">1</span><span class="si">}</span><span class="s2">D&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Double</span><span class="si">{</span><span class="n">item</span><span class="o">.</span><span class="n">ndim</span><span class="si">}</span><span class="s2">D&quot;</span>

<div class="viewcode-block" id="HydPyServer.GET_query_itemtypes">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_query_itemtypes">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_query_itemtypes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the types of all current exchange items.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GET_query_changeitemtypes</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GET_query_outputitemtypes</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GET_query_getitemtypes</span><span class="p">()</span></div>


<div class="viewcode-block" id="HydPyServer.GET_query_changeitemtypes">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_query_changeitemtypes">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_query_changeitemtypes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the types of all current exchange items supposed to change the values of</span>
<span class="sd">        |Parameter|, |StateSequence|, or |LogSequence| objects.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GET_query_parameteritemtypes</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GET_query_inputitemtypes</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GET_query_conditionitemtypes</span><span class="p">()</span></div>


<div class="viewcode-block" id="HydPyServer.GET_query_parameteritemtypes">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_query_parameteritemtypes">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_query_parameteritemtypes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the types of all current exchange items supposed to change the values of</span>
<span class="sd">        |Parameter| objects.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">parameteritems</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_outputs</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_query_itemtype</span><span class="p">(</span><span class="n">item</span><span class="p">)</span></div>


<div class="viewcode-block" id="HydPyServer.GET_query_inputitemtypes">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_query_inputitemtypes">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_query_inputitemtypes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the types of all current exchange items supposed to change the series of</span>
<span class="sd">        |InputSequence| objects.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">inputitems</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_outputs</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_query_itemtype</span><span class="p">(</span><span class="n">item</span><span class="p">)</span></div>


<div class="viewcode-block" id="HydPyServer.GET_query_conditionitemtypes">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_query_conditionitemtypes">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_query_conditionitemtypes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the types of all current exchange items supposed to change the values of</span>
<span class="sd">        |StateSequence| or |LogSequence| objects.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">conditionitems</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_outputs</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_query_itemtype</span><span class="p">(</span><span class="n">item</span><span class="p">)</span></div>


<div class="viewcode-block" id="HydPyServer.GET_query_outputitemtypes">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_query_outputitemtypes">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_query_outputitemtypes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the types of all current exchange items supposed to return the values or</span>
<span class="sd">        series of |FactorSequence| or |FluxSequence| objects in the &quot;setitem style&quot;.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">outputitems</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_outputs</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_query_itemtype</span><span class="p">(</span><span class="n">item</span><span class="p">)</span></div>


<div class="viewcode-block" id="HydPyServer.GET_query_getitemtypes">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_query_getitemtypes">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_query_getitemtypes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the types of all current exchange items supposed to return the values of</span>
<span class="sd">        |Parameter| or |Sequence_| objects or the time series of |IOSequence|</span>
<span class="sd">        objects in the &quot;getitem style&quot;.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">getitems</span><span class="p">:</span>
            <span class="n">type_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_query_itemtype</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">yield_name2value</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_outputs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">type_</span></div>


<div class="viewcode-block" id="HydPyServer.GET_query_itemsubnames">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_query_itemsubnames">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_query_itemsubnames</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get names (suitable as IDs) describing the individual values of all current</span>
<span class="sd">        exchange objects.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GET_query_changeitemsubnames</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GET_query_outputitemnames</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GET_query_getitemsubnames</span><span class="p">()</span></div>


<div class="viewcode-block" id="HydPyServer.GET_query_changeitemsubnames">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_query_changeitemsubnames">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_query_changeitemsubnames</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get names (suitable as IDs) describing the individual values of all current</span>
<span class="sd">        exchange objects supposed to change the values of |Parameter|, |StateSequence|,</span>
<span class="sd">        or |LogSequence| objects.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GET_query_parameteritemnames</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GET_query_inputitemnames</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GET_query_conditionitemnames</span><span class="p">()</span></div>


<div class="viewcode-block" id="HydPyServer.GET_query_parameteritemnames">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_query_parameteritemnames">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_query_parameteritemnames</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get names (suitable as IDs) describing the individual values of all current</span>
<span class="sd">        exchange objects supposed to change the values of |Parameter| objects.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_query_changeitemsubnames</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">parameteritems</span><span class="p">)</span></div>


<div class="viewcode-block" id="HydPyServer.GET_query_inputitemnames">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_query_inputitemnames">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_query_inputitemnames</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get names (suitable as IDs) describing the individual values of all current</span>
<span class="sd">        exchange objects supposed to change the values of |InputSequence| objects.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_query_changeitemsubnames</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">inputitems</span><span class="p">)</span></div>


<div class="viewcode-block" id="HydPyServer.GET_query_conditionitemnames">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_query_conditionitemnames">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_query_conditionitemnames</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get names (suitable as IDs) describing the individual values of all current</span>
<span class="sd">        exchange objects supposed to change the values of |StateSequence| or</span>
<span class="sd">        |LogSequence| objects.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_query_changeitemsubnames</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">conditionitems</span><span class="p">)</span></div>


<div class="viewcode-block" id="HydPyServer.GET_query_outputitemnames">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_query_outputitemnames">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_query_outputitemnames</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get names (suitable as IDs) describing the individual values of all current</span>
<span class="sd">        exchange objects supposed to return the values of or series of |FactorSequence|</span>
<span class="sd">        or |FluxSequence| objects in the &quot;setitem style&quot;.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_query_changeitemsubnames</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">outputitems</span><span class="p">)</span></div>


<div class="viewcode-block" id="HydPyServer.GET_query_getitemsubnames">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_query_getitemsubnames">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_query_getitemsubnames</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get names (suitable as IDs) describing the individual values of all current</span>
<span class="sd">        exchange objects supposed to return the values of |Parameter| or |Sequence_|</span>
<span class="sd">        objects or the time series of |IOSequence| objects in the &quot;getitem style&quot;.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">getitems</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">subnames</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">yield_name2subnames</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_outputs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">subnames</span></div>


    <span class="k">def</span> <span class="nf">_query_changeitemsubnames</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">items</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">itemtools</span><span class="o">.</span><span class="n">ChangeItem</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="n">subnames</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">subnames</span>
            <span class="k">if</span> <span class="n">subnames</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_outputs</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;*global*&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_outputs</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subnames</span><span class="p">)</span><span class="si">}</span><span class="s2">]&quot;</span>

<div class="viewcode-block" id="HydPyServer.GET_query_initialitemvalues">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_query_initialitemvalues">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_query_initialitemvalues</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the initial values of all current exchange items.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GET_query_initialchangeitemvalues</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GET_query_initialoutputitemvalues</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GET_query_initialgetitemvalues</span><span class="p">()</span></div>


<div class="viewcode-block" id="HydPyServer.GET_register_initialitemvalues">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_register_initialitemvalues">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_register_initialitemvalues</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Register the initial values of all current exchange items under the given</span>
<span class="sd">        `id`.</span>

<span class="sd">        Implemented as a workaround to support `OpenDA`_.  Better use method</span>
<span class="sd">        |HydPyServer.GET_query_initialitemvalues|.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GET_register_initialchangeitemvalues</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GET_register_initialoutputitemvalues</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GET_register_initialgetitemvalues</span><span class="p">()</span></div>


<div class="viewcode-block" id="HydPyServer.GET_query_initialchangeitemvalues">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_query_initialchangeitemvalues">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_query_initialchangeitemvalues</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the initial values of all current exchange items supposed to change the</span>
<span class="sd">        values of |Parameter|, |InputSequence|, |StateSequence|, or |LogSequence|</span>
<span class="sd">        objects.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GET_query_initialparameteritemvalues</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GET_query_initialinputitemvalues</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GET_query_initialconditionitemvalues</span><span class="p">()</span></div>


<div class="viewcode-block" id="HydPyServer.GET_register_initialchangeitemvalues">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_register_initialchangeitemvalues">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_register_initialchangeitemvalues</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Register the initial values of all current exchange items supposed to change</span>
<span class="sd">        the values of |Parameter|, |InputSequence|, |StateSequence|, or |LogSequence|</span>
<span class="sd">        objects under the given `id`.</span>

<span class="sd">        Implemented as a workaround to support `OpenDA`_.  Better use method</span>
<span class="sd">        |HydPyServer.GET_query_initialchangeitemvalues|.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GET_register_initialparameteritemvalues</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GET_register_initialinputitemvalues</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GET_register_initialconditionitemvalues</span><span class="p">()</span></div>


    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_array2output</span><span class="p">(</span><span class="n">values</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">VectorInput</span><span class="p">[</span><span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="c1"># duck-typing for simplicity:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">assignrepr_list2</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">repr_list</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>  <span class="c1"># type: ignore[arg-type]</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">repr_</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>

<div class="viewcode-block" id="HydPyServer.GET_query_initialparameteritemvalues">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_query_initialparameteritemvalues">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_query_initialparameteritemvalues</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the initial values of all current exchange items supposed to change the</span>
<span class="sd">        values of |Parameter| objects.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">initialparameteritemvalues</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_outputs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_array2output</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>


<div class="viewcode-block" id="HydPyServer.GET_register_initialparameteritemvalues">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_register_initialparameteritemvalues">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_register_initialparameteritemvalues</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Register the initial values of all current exchange items supposed to change</span>
<span class="sd">        the values of |Parameter| objects under the given `id`.</span>

<span class="sd">        Implemented as a workaround to support `OpenDA`_.  Better use method</span>
<span class="sd">        |HydPyServer.GET_query_initialparameteritemvalues|.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span>
        <span class="n">state</span><span class="o">.</span><span class="n">parameteritemvalues</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">initialparameteritemvalues</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></div>


<div class="viewcode-block" id="HydPyServer.GET_query_initialinputitemvalues">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_query_initialinputitemvalues">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_query_initialinputitemvalues</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the initial values of all current exchange items supposed to change the</span>
<span class="sd">        series of |InputSequence| objects.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">initialinputitemvalues</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_outputs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_array2output</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>


<div class="viewcode-block" id="HydPyServer.GET_register_initialinputitemvalues">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_register_initialinputitemvalues">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_register_initialinputitemvalues</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Register the initial series of all current exchange items supposed to change</span>
<span class="sd">        the values of |InputSequence| objects under the given `id`.</span>

<span class="sd">        Implemented as a workaround to support `OpenDA`_.  Better use method</span>
<span class="sd">        |HydPyServer.GET_query_initialinputitemvalues|.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">inputitemvalues</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">initialinputitemvalues</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></div>


<div class="viewcode-block" id="HydPyServer.GET_query_initialconditionitemvalues">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_query_initialconditionitemvalues">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_query_initialconditionitemvalues</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the initial values of all current exchange items supposed to change the</span>
<span class="sd">        values of |StateSequence| or |LogSequence| objects.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">initialconditionitemvalues</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_outputs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_array2output</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>


<div class="viewcode-block" id="HydPyServer.GET_register_initialconditionitemvalues">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_register_initialconditionitemvalues">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_register_initialconditionitemvalues</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Register the initial values of all current exchange items supposed to change</span>
<span class="sd">        the values of |StateSequence| or |LogSequence| objects under the given `id`.</span>

<span class="sd">        Implemented as a workaround to support `OpenDA`_.  Better use method</span>
<span class="sd">        |HydPyServer.GET_query_initialconditionitemvalues|.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span>
        <span class="n">state</span><span class="o">.</span><span class="n">conditionitemvalues</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">initialconditionitemvalues</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></div>


<div class="viewcode-block" id="HydPyServer.GET_query_initialoutputitemvalues">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_query_initialoutputitemvalues">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_query_initialoutputitemvalues</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the initial values of all current exchange items supposed to return the</span>
<span class="sd">        values or sequences of |FactorSequence| or |FluxSequence| objects in the</span>
<span class="sd">        &quot;setitem style&quot;.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">initialoutputitemvalues</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_outputs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_array2output</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>


<div class="viewcode-block" id="HydPyServer.GET_register_initialoutputitemvalues">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_register_initialoutputitemvalues">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_register_initialoutputitemvalues</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Register the initial values of all current exchange items supposed to return</span>
<span class="sd">        the values or sequences of |FactorSequence| or |FluxSequence| objects in the</span>
<span class="sd">        &quot;setitem style&quot; under the given `id`.</span>

<span class="sd">        Implemented as a workaround to support `OpenDA`_.  Better use method</span>
<span class="sd">        |HydPyServer.GET_query_initialoutputitemvalues|.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span>
        <span class="n">state</span><span class="o">.</span><span class="n">outputitemvalues</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">initialoutputitemvalues</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></div>


<div class="viewcode-block" id="HydPyServer.GET_query_initialgetitemvalues">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_query_initialgetitemvalues">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_query_initialgetitemvalues</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the initial values of all current exchange items supposed to return the</span>
<span class="sd">        values of |Parameter| or |Sequence_| objects or the time series of |IOSequence|</span>
<span class="sd">        objects in the &quot;getitems style&quot;.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">initialgetitemvalues</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_outputs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>


<div class="viewcode-block" id="HydPyServer.GET_register_initialgetitemvalues">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_register_initialgetitemvalues">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_register_initialgetitemvalues</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Register the initial values of all current exchange items supposed to return</span>
<span class="sd">        the values of |Parameter| or |Sequence_| objects or the time series of</span>
<span class="sd">        |IOSequence| objects in the &quot;getitem style&quot; under the given `id`.</span>

<span class="sd">        Implemented as a workaround to support `OpenDA`_.  Better use method</span>
<span class="sd">        |HydPyServer.GET_query_initialgetitemvalues|.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">getitemvalues</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">initialgetitemvalues</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></div>


<div class="viewcode-block" id="HydPyServer.GET_query_initialisationtimegrid">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_query_initialisationtimegrid">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_query_initialisationtimegrid</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the general |Timegrids.init| time grid.&quot;&quot;&quot;</span>
        <span class="n">tg</span> <span class="o">=</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">timegrids</span><span class="o">.</span><span class="n">init</span>
        <span class="n">utc</span> <span class="o">=</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">utcoffset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_outputs</span><span class="p">[</span><span class="s2">&quot;firstdate_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tg</span><span class="o">.</span><span class="n">firstdate</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="s2">&quot;iso1&quot;</span><span class="p">,</span> <span class="n">utc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_outputs</span><span class="p">[</span><span class="s2">&quot;lastdate_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tg</span><span class="o">.</span><span class="n">lastdate</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="s2">&quot;iso1&quot;</span><span class="p">,</span> <span class="n">utc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_outputs</span><span class="p">[</span><span class="s2">&quot;stepsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tg</span><span class="o">.</span><span class="n">stepsize</span></div>


    <span class="k">def</span> <span class="nf">_get_registered_content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dict_</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">ID</span><span class="p">,</span> <span class="n">T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">dict_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_id</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Nothing registered under the id `</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_id</span><span class="si">}</span><span class="s2">`.&quot;</span>
            <span class="k">if</span> <span class="n">dict_</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;  The available ids are: </span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">enumeration</span><span class="p">(</span><span class="n">dict_</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;  There is nothing registered, so far.&quot;</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span> <span class="kn">from</span> <span class="kc">None</span>

<div class="viewcode-block" id="HydPyServer.POST_register_simulationdates">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.POST_register_simulationdates">[docs]</a>
    <span class="k">def</span> <span class="nf">POST_register_simulationdates</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Register the send simulation dates under the given `id`.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">timegrids</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">timetools</span><span class="o">.</span><span class="n">Timegrid</span><span class="p">(</span>
            <span class="n">firstdate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_inputs</span><span class="p">[</span><span class="s2">&quot;firstdate_sim&quot;</span><span class="p">],</span>
            <span class="n">lastdate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_inputs</span><span class="p">[</span><span class="s2">&quot;lastdate_sim&quot;</span><span class="p">],</span>
            <span class="n">stepsize</span><span class="o">=</span><span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">timegrids</span><span class="o">.</span><span class="n">stepsize</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="HydPyServer.GET_activate_simulationdates">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_activate_simulationdates">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_activate_simulationdates</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Activate the simulation dates registered under the given `id`.&quot;&quot;&quot;</span>
        <span class="n">init</span> <span class="o">=</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">timegrids</span><span class="o">.</span><span class="n">init</span>
        <span class="n">sim</span> <span class="o">=</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">timegrids</span><span class="o">.</span><span class="n">sim</span>
        <span class="n">sim</span><span class="o">.</span><span class="n">dates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_registered_content</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">timegrids</span><span class="p">)</span><span class="o">.</span><span class="n">dates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">idx1</span> <span class="o">=</span> <span class="n">init</span><span class="p">[</span><span class="n">sim</span><span class="o">.</span><span class="n">firstdate</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">idx2</span> <span class="o">=</span> <span class="n">init</span><span class="p">[</span><span class="n">sim</span><span class="o">.</span><span class="n">lastdate</span><span class="p">]</span></div>


<div class="viewcode-block" id="HydPyServer.GET_query_simulationdates">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_query_simulationdates">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_query_simulationdates</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the simulation dates registered under the given `id`.&quot;&quot;&quot;</span>
        <span class="n">tg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_registered_content</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">timegrids</span><span class="p">)</span>
        <span class="n">utc</span> <span class="o">=</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">utcoffset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_outputs</span><span class="p">[</span><span class="s2">&quot;firstdate_sim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tg</span><span class="o">.</span><span class="n">firstdate</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="s2">&quot;iso1&quot;</span><span class="p">,</span> <span class="n">utc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_outputs</span><span class="p">[</span><span class="s2">&quot;lastdate_sim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tg</span><span class="o">.</span><span class="n">lastdate</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="s2">&quot;iso1&quot;</span><span class="p">,</span> <span class="n">utc</span><span class="p">)</span></div>


<div class="viewcode-block" id="HydPyServer.GET_query_itemvalues">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_query_itemvalues">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_query_itemvalues</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the values of all |ExchangeItem| objects registered under the given</span>
<span class="sd">        `id`.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GET_query_changeitemvalues</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GET_query_outputitemvalues</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GET_query_getitemvalues</span><span class="p">()</span></div>


<div class="viewcode-block" id="HydPyServer.POST_register_changeitemvalues">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.POST_register_changeitemvalues">[docs]</a>
    <span class="k">def</span> <span class="nf">POST_register_changeitemvalues</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Register the send values of all |ChangeItem| objects under the given `id`.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">POST_register_parameteritemvalues</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">POST_register_inputitemvalues</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">POST_register_conditionitemvalues</span><span class="p">()</span></div>


<div class="viewcode-block" id="HydPyServer.GET_activate_changeitemvalues">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_activate_changeitemvalues">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_activate_changeitemvalues</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Activate the values of the |ChangeItem| objects registered under the given</span>
<span class="sd">        `id`.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GET_activate_parameteritemvalues</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GET_activate_inputitemvalues</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GET_activate_conditionitemvalues</span><span class="p">()</span></div>


<div class="viewcode-block" id="HydPyServer.GET_query_changeitemvalues">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_query_changeitemvalues">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_query_changeitemvalues</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the values of all |ChangeItem| objects registered under the given</span>
<span class="sd">        `id`.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GET_query_parameteritemvalues</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GET_query_inputitemvalues</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GET_query_conditionitemvalues</span><span class="p">()</span></div>


    <span class="k">def</span> <span class="nf">_post_register_itemvalues</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">typename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">items</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">itemtools</span><span class="o">.</span><span class="n">ChangeItem</span><span class="p">],</span>
        <span class="n">itemvalues</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">ID</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Name</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">item2value</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Name</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inputs</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_statuscode</span> <span class="o">=</span> <span class="mi">500</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;A value for </span><span class="si">{</span><span class="n">typename</span><span class="si">}</span><span class="s2"> item `</span><span class="si">{</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">` is missing.&quot;</span>
                <span class="p">)</span> <span class="kn">from</span> <span class="kc">None</span>
            <span class="n">item2value</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="n">itemvalues</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">item2value</span>

<div class="viewcode-block" id="HydPyServer.POST_register_parameteritemvalues">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.POST_register_parameteritemvalues">[docs]</a>
    <span class="k">def</span> <span class="nf">POST_register_parameteritemvalues</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Register the send parameter values under the given `id`.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_post_register_itemvalues</span><span class="p">(</span>
            <span class="n">typename</span><span class="o">=</span><span class="s2">&quot;parameter&quot;</span><span class="p">,</span>
            <span class="n">items</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">parameteritems</span><span class="p">,</span>
            <span class="n">itemvalues</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">parameteritemvalues</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="HydPyServer.GET_activate_parameteritemvalues">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_activate_parameteritemvalues">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_activate_parameteritemvalues</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Activate the parameter values registered under the given `id`.&quot;&quot;&quot;</span>
        <span class="n">item2value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_registered_content</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">parameteritemvalues</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">parameteritems</span><span class="p">:</span>
            <span class="n">item</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">item2value</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
            <span class="n">item</span><span class="o">.</span><span class="n">update_variables</span><span class="p">()</span></div>


<div class="viewcode-block" id="HydPyServer.GET_query_parameteritemvalues">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_query_parameteritemvalues">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_query_parameteritemvalues</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the parameter values registered under the given `id`.&quot;&quot;&quot;</span>
        <span class="n">item2value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_registered_content</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">parameteritemvalues</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">item2value</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_outputs</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_array2output</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>


<div class="viewcode-block" id="HydPyServer.POST_register_inputitemvalues">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.POST_register_inputitemvalues">[docs]</a>
    <span class="k">def</span> <span class="nf">POST_register_inputitemvalues</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Register the send input item values under the given `id`.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_post_register_itemvalues</span><span class="p">(</span>
            <span class="n">typename</span><span class="o">=</span><span class="s2">&quot;input&quot;</span><span class="p">,</span>
            <span class="n">items</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">inputitems</span><span class="p">,</span>
            <span class="n">itemvalues</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">inputitemvalues</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="HydPyServer.GET_activate_inputitemvalues">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_activate_inputitemvalues">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_activate_inputitemvalues</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply the input item values registered under the given `id` to modify the</span>
<span class="sd">        current |InputSequence| values.&quot;&quot;&quot;</span>
        <span class="n">item2value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_registered_content</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">inputitemvalues</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">inputitems</span><span class="p">:</span>
            <span class="n">item</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">item2value</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
            <span class="n">item</span><span class="o">.</span><span class="n">update_variables</span><span class="p">()</span></div>


<div class="viewcode-block" id="HydPyServer.GET_update_inputitemvalues">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_update_inputitemvalues">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_update_inputitemvalues</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert the current |InputSequence| values to input item values (when</span>
<span class="sd">        necessary) and register them under the given `id`.&quot;&quot;&quot;</span>
        <span class="n">item2value</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">inputitems</span><span class="p">:</span>
            <span class="n">item</span><span class="o">.</span><span class="n">extract_values</span><span class="p">()</span>
            <span class="n">item2value</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">inputitemvalues</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">item2value</span></div>


<div class="viewcode-block" id="HydPyServer.GET_query_inputitemvalues">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_query_inputitemvalues">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_query_inputitemvalues</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the input item values registered under the given `id`.&quot;&quot;&quot;</span>
        <span class="n">item2value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_registered_content</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">inputitemvalues</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">item2value</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_outputs</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_array2output</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>


<div class="viewcode-block" id="HydPyServer.POST_register_conditionitemvalues">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.POST_register_conditionitemvalues">[docs]</a>
    <span class="k">def</span> <span class="nf">POST_register_conditionitemvalues</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Register the send condition item values under the given `id`.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_post_register_itemvalues</span><span class="p">(</span>
            <span class="n">typename</span><span class="o">=</span><span class="s2">&quot;condition&quot;</span><span class="p">,</span>
            <span class="n">items</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">conditionitems</span><span class="p">,</span>
            <span class="n">itemvalues</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">conditionitemvalues</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="HydPyServer.GET_activate_conditionitemvalues">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_activate_conditionitemvalues">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_activate_conditionitemvalues</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply the condition item values registered under the given `id` to modify</span>
<span class="sd">        the current |StateSequence| and |LogSequence| values.&quot;&quot;&quot;</span>
        <span class="n">item2value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_registered_content</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">conditionitemvalues</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">conditionitems</span><span class="p">:</span>
            <span class="n">item</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">item2value</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
            <span class="n">item</span><span class="o">.</span><span class="n">update_variables</span><span class="p">()</span></div>


<div class="viewcode-block" id="HydPyServer.GET_update_conditionitemvalues">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_update_conditionitemvalues">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_update_conditionitemvalues</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert the current |StateSequence| and |LogSequence| values to condition</span>
<span class="sd">        item values (when necessary) and register them under the given `id`.&quot;&quot;&quot;</span>
        <span class="n">item2value</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">conditionitems</span><span class="p">:</span>
            <span class="n">item</span><span class="o">.</span><span class="n">extract_values</span><span class="p">()</span>
            <span class="n">item2value</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">conditionitemvalues</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">item2value</span></div>


<div class="viewcode-block" id="HydPyServer.GET_query_conditionitemvalues">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_query_conditionitemvalues">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_query_conditionitemvalues</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the condition item values registered under the given `id`.&quot;&quot;&quot;</span>
        <span class="n">item2value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_registered_content</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">conditionitemvalues</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">item2value</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_outputs</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_array2output</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>


<div class="viewcode-block" id="HydPyServer.GET_update_outputitemvalues">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_update_outputitemvalues">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_update_outputitemvalues</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert the current |FactorSequence| and |FluxSequence| values or series to</span>
<span class="sd">        output item values (when necessary) and register them under the given `id`.&quot;&quot;&quot;</span>
        <span class="n">item2value</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">outputitems</span><span class="p">:</span>
            <span class="n">item</span><span class="o">.</span><span class="n">extract_values</span><span class="p">()</span>
            <span class="n">item2value</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">outputitemvalues</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">item2value</span></div>


<div class="viewcode-block" id="HydPyServer.GET_query_outputitemvalues">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_query_outputitemvalues">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_query_outputitemvalues</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the output item values registered under the given `id`.&quot;&quot;&quot;</span>
        <span class="n">item2value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_registered_content</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">outputitemvalues</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">item2value</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_outputs</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_array2output</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>


<div class="viewcode-block" id="HydPyServer.GET_save_internalconditions">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_save_internalconditions">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_save_internalconditions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Register the |StateSequence| and |LogSequence| values of the |HydPy|</span>
<span class="sd">        instance for the current simulation endpoint under the given `id`.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">conditions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">conditions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_id</span><span class="p">,</span> <span class="p">{})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">conditions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_id</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">idx2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">hp</span><span class="o">.</span><span class="n">conditions</span></div>


<div class="viewcode-block" id="HydPyServer.GET_load_internalconditions">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_load_internalconditions">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_load_internalconditions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Activate the |StateSequence| or |LogSequence| values registered for the</span>
<span class="sd">        current simulation start point under the given `id`.</span>

<span class="sd">        When the simulation start point is identical with the initialisation time</span>
<span class="sd">        point, and you do not register alternative conditions manually, method</span>
<span class="sd">        |HydPyServer.GET_load_internalconditions| uses the &quot;original&quot; initial</span>
<span class="sd">        conditions of the current process (usually those of the conditions files of the</span>
<span class="sd">        respective *HydPy*  project).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">hp</span><span class="o">.</span><span class="n">conditions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">conditions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_id</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">idx1</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">idx1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_statuscode</span> <span class="o">=</span> <span class="mi">500</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Conditions for ID `</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_id</span><span class="si">}</span><span class="s2">` and time point &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">timegrids</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">firstdate</span><span class="si">}</span><span class="s2">` are required, but have &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;not been calculated so far.&quot;</span>
                <span class="p">)</span> <span class="kn">from</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">hp</span><span class="o">.</span><span class="n">conditions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">init_conditions</span></div>


<div class="viewcode-block" id="HydPyServer.POST_register_internalconditions">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.POST_register_internalconditions">[docs]</a>
    <span class="k">def</span> <span class="nf">POST_register_internalconditions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Register the send internal conditions under the given `id`.&quot;&quot;&quot;</span>
        <span class="n">conditions</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_inputs</span><span class="p">[</span><span class="s2">&quot;conditions&quot;</span><span class="p">],</span> <span class="p">{</span><span class="s2">&quot;array&quot;</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">conditions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_id</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">idx1</span><span class="p">]</span> <span class="o">=</span> <span class="n">conditions</span></div>


<div class="viewcode-block" id="HydPyServer.GET_deregister_internalconditions">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_deregister_internalconditions">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_deregister_internalconditions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove all internal condition directories registered under the given `id`.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">conditions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span></div>


<div class="viewcode-block" id="HydPyServer.GET_query_internalconditions">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_query_internalconditions">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_query_internalconditions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the internal conditions registered under the given `id`.&quot;&quot;&quot;</span>
        <span class="n">all_conditions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_registered_content</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">conditions</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">relevant_conditons</span> <span class="o">=</span> <span class="n">all_conditions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">idx2</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;No internal conditions registered under the id `</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_id</span><span class="si">}</span><span class="s2">` for &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">timegrids</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_id</span><span class="p">]</span><span class="o">.</span><span class="n">lastdate</span><span class="si">}</span><span class="s2">`.&quot;</span>
            <span class="p">)</span> <span class="kn">from</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_outputs</span><span class="p">[</span><span class="s2">&quot;conditions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">relevant_conditons</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="HydPyServer.POST_register_inputconditiondir">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.POST_register_inputconditiondir">[docs]</a>
    <span class="k">def</span> <span class="nf">POST_register_inputconditiondir</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Register the send input condition directory under the given `id`.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">inputconditiondirs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inputs</span><span class="p">[</span><span class="s2">&quot;inputconditiondir&quot;</span><span class="p">]</span></div>


<div class="viewcode-block" id="HydPyServer.GET_deregister_inputconditiondir">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_deregister_inputconditiondir">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_deregister_inputconditiondir</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove the input condition directory registered under the `id`.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">inputconditiondirs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_id</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>


<div class="viewcode-block" id="HydPyServer.GET_query_inputconditiondir">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_query_inputconditiondir">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_query_inputconditiondir</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the input condition directory registered under the `id`.&quot;&quot;&quot;</span>
        <span class="n">dir_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_registered_content</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">inputconditiondirs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_outputs</span><span class="p">[</span><span class="s2">&quot;inputconditiondir&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dir_</span></div>


<div class="viewcode-block" id="HydPyServer.POST_register_outputconditiondir">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.POST_register_outputconditiondir">[docs]</a>
    <span class="k">def</span> <span class="nf">POST_register_outputconditiondir</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Register the send output condition directory under the given `id`.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">outputconditiondirs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inputs</span><span class="p">[</span><span class="s2">&quot;outputconditiondir&quot;</span><span class="p">]</span></div>


<div class="viewcode-block" id="HydPyServer.GET_deregister_outputconditiondir">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_deregister_outputconditiondir">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_deregister_outputconditiondir</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove the output condition directory registered under the `id`.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">outputconditiondirs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_id</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>


<div class="viewcode-block" id="HydPyServer.GET_query_outputconditiondir">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_query_outputconditiondir">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_query_outputconditiondir</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the output condition directory registered under the `id`.&quot;&quot;&quot;</span>
        <span class="n">dir_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_registered_content</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">outputconditiondirs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_outputs</span><span class="p">[</span><span class="s2">&quot;outputconditiondir&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dir_</span></div>


<div class="viewcode-block" id="HydPyServer.GET_load_conditions">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_load_conditions">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_load_conditions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load the (initial) conditions.&quot;&quot;&quot;</span>
        <span class="n">dir_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">inputconditiondirs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">conditions_io</span><span class="o">.</span><span class="n">load_conditions</span><span class="p">(</span><span class="n">dir_</span><span class="p">)</span></div>


<div class="viewcode-block" id="HydPyServer.GET_save_conditions">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_save_conditions">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_save_conditions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save the (resulting) conditions.&quot;&quot;&quot;</span>
        <span class="n">dir_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">outputconditiondirs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">conditions_io</span><span class="o">.</span><span class="n">save_conditions</span><span class="p">(</span><span class="n">dir_</span><span class="p">)</span></div>


<div class="viewcode-block" id="HydPyServer.GET_update_getitemvalues">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_update_getitemvalues">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_update_getitemvalues</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Register the current |GetItem| values under the given `id`.</span>

<span class="sd">        For |GetItem| objects observing time series, method</span>
<span class="sd">        |HydPyServer.GET_update_getitemvalues| registers only the values within the</span>
<span class="sd">        current simulation period.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">item2value</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">getitems</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">yield_name2value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">idx1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">idx2</span><span class="p">):</span>
                <span class="n">item2value</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">getitemvalues</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">item2value</span></div>


<div class="viewcode-block" id="HydPyServer.GET_query_getitemvalues">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_query_getitemvalues">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_query_getitemvalues</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the |GetItem| values registered under the given `id`.&quot;&quot;&quot;</span>
        <span class="n">item2value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_registered_content</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">getitemvalues</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">item2value</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_outputs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>


<div class="viewcode-block" id="HydPyServer.GET_simulate">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_simulate">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_simulate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform a simulation run.&quot;&quot;&quot;</span>
        <span class="n">readerdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">seriesreaderdirs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_id</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">writerdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">serieswriterdirs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_id</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">sio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">series_io</span>
        <span class="k">with</span> <span class="n">sio</span><span class="o">.</span><span class="n">modify_inputdir</span><span class="p">(</span><span class="n">readerdir</span><span class="p">),</span> <span class="n">sio</span><span class="o">.</span><span class="n">modify_outputdir</span><span class="p">(</span><span class="n">writerdir</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">hp</span><span class="o">.</span><span class="n">simulate</span><span class="p">()</span></div>


<div class="viewcode-block" id="HydPyServer.POST_register_seriesreaderdir">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.POST_register_seriesreaderdir">[docs]</a>
    <span class="k">def</span> <span class="nf">POST_register_seriesreaderdir</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Register the send series reader directory under the given `id`.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">seriesreaderdirs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inputs</span><span class="p">[</span><span class="s2">&quot;seriesreaderdir&quot;</span><span class="p">]</span></div>


<div class="viewcode-block" id="HydPyServer.GET_deregister_seriesreaderdir">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_deregister_seriesreaderdir">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_deregister_seriesreaderdir</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove the series reader directory registered under the `id`.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">seriesreaderdirs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_id</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>


<div class="viewcode-block" id="HydPyServer.GET_query_seriesreaderdir">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_query_seriesreaderdir">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_query_seriesreaderdir</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the series reader directory registered under the `id`.&quot;&quot;&quot;</span>
        <span class="n">dir_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_registered_content</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">seriesreaderdirs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_outputs</span><span class="p">[</span><span class="s2">&quot;seriesreaderdir&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dir_</span></div>


<div class="viewcode-block" id="HydPyServer.POST_register_serieswriterdir">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.POST_register_serieswriterdir">[docs]</a>
    <span class="k">def</span> <span class="nf">POST_register_serieswriterdir</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Register the send series writer directory under the given `id`.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">serieswriterdirs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inputs</span><span class="p">[</span><span class="s2">&quot;serieswriterdir&quot;</span><span class="p">]</span></div>


<div class="viewcode-block" id="HydPyServer.GET_deregister_serieswriterdir">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_deregister_serieswriterdir">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_deregister_serieswriterdir</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove the series writer directory registered under the `id`.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">serieswriterdirs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_id</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>


<div class="viewcode-block" id="HydPyServer.GET_query_serieswriterdir">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_query_serieswriterdir">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_query_serieswriterdir</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the series writer directory registered under the `id`.&quot;&quot;&quot;</span>
        <span class="n">dir_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_registered_content</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">serieswriterdirs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_outputs</span><span class="p">[</span><span class="s2">&quot;serieswriterdir&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dir_</span></div>


<div class="viewcode-block" id="HydPyServer.GET_load_allseries">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_load_allseries">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_load_allseries</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load the time series of all sequences selected for (non-jit) reading.&quot;&quot;&quot;</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span>
        <span class="n">state</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">series_io</span><span class="o">.</span><span class="n">load_series</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">seriesreaderdirs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_id</span><span class="p">))</span></div>


<div class="viewcode-block" id="HydPyServer.GET_save_allseries">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_save_allseries">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_save_allseries</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save the time series of all sequences selected for (non-jit) writing.&quot;&quot;&quot;</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span>
        <span class="n">state</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">series_io</span><span class="o">.</span><span class="n">save_series</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">serieswriterdirs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_id</span><span class="p">))</span></div>


<div class="viewcode-block" id="HydPyServer.POST_register_outputcontroldir">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.POST_register_outputcontroldir">[docs]</a>
    <span class="k">def</span> <span class="nf">POST_register_outputcontroldir</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Register the send output control directory under the given `id`.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">outputcontroldirs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inputs</span><span class="p">[</span><span class="s2">&quot;outputcontroldir&quot;</span><span class="p">]</span></div>


<div class="viewcode-block" id="HydPyServer.GET_deregister_outputcontroldir">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_deregister_outputcontroldir">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_deregister_outputcontroldir</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove the output control directory registered under the `id`.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">outputcontroldirs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_id</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>


<div class="viewcode-block" id="HydPyServer.GET_query_outputcontroldir">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_query_outputcontroldir">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_query_outputcontroldir</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the output control directory registered under the `id`.&quot;&quot;&quot;</span>
        <span class="n">dir_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_registered_content</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">outputcontroldirs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_outputs</span><span class="p">[</span><span class="s2">&quot;outputcontroldir&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dir_</span></div>


<div class="viewcode-block" id="HydPyServer.GET_save_controls">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.HydPyServer.GET_save_controls">[docs]</a>
    <span class="k">def</span> <span class="nf">GET_save_controls</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save the control files of all model instances.&quot;&quot;&quot;</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span>
        <span class="n">controldir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_registered_content</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">outputcontroldirs</span><span class="p">)</span>
        <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">controlmanager</span><span class="o">.</span><span class="n">currentdir</span> <span class="o">=</span> <span class="n">controldir</span>
        <span class="n">state</span><span class="o">.</span><span class="n">hp</span><span class="o">.</span><span class="n">save_controls</span><span class="p">()</span></div>
</div>



<span class="k">class</span> <span class="nc">_HTTPServerBase</span><span class="p">(</span><span class="n">http</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">HTTPServer</span><span class="p">):</span>
    <span class="n">debugmode</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>


<div class="viewcode-block" id="start_server">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.start_server">[docs]</a>
<span class="k">def</span> <span class="nf">start_server</span><span class="p">(</span>
    <span class="n">socket</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
    <span class="n">projectname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">xmlfilename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">load_conditions</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">load_series</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">maxrequests</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">debugging</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;enable&quot;</span><span class="p">,</span> <span class="s2">&quot;disable&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;disable&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Start the *HydPy* server using the given socket.</span>

<span class="sd">    The folder with the given `projectname` must be available within the current</span>
<span class="sd">    working directory.  The XML configuration file must be placed within the project</span>
<span class="sd">    folder unless `xmlfilename` is an absolute file path. The XML configuration file</span>
<span class="sd">    must be valid concerning the schema file `HydPyConfigMultipleRuns.xsd` (see class</span>
<span class="sd">    |ServerState| for further information).</span>

<span class="sd">    The |HydPyServer| allows for five still unhandled requests before refusing new</span>
<span class="sd">    connections by default.  Use the optional `maxrequests` argument to increase this</span>
<span class="sd">    number (which might be necessary when parallelising optimisation or data</span>
<span class="sd">    assimilation):</span>

<span class="sd">    &gt;&gt;&gt; from hydpy.examples import prepare_full_example_1</span>
<span class="sd">    &gt;&gt;&gt; prepare_full_example_1()</span>
<span class="sd">    &gt;&gt;&gt; command = (</span>
<span class="sd">    ...     &quot;hyd.py start_server 8080 LahnH multiple_runs_alpha.xml &quot;</span>
<span class="sd">    ...     &quot;debugging=enable maxrequests=100&quot;)</span>
<span class="sd">    &gt;&gt;&gt; from hydpy import run_subprocess, TestIO</span>
<span class="sd">    &gt;&gt;&gt; with TestIO():</span>
<span class="sd">    ...     process = run_subprocess(command, blocking=False, verbose=False)</span>
<span class="sd">    ...     result = run_subprocess(&quot;hyd.py await_server 8080 10&quot;, verbose=False)</span>

<span class="sd">    &gt;&gt;&gt; from urllib import request</span>
<span class="sd">    &gt;&gt;&gt; command = &quot;maxrequests = self.server.request_queue_size&quot;</span>
<span class="sd">    &gt;&gt;&gt; response = request.urlopen(&quot;http://127.0.0.1:8080/evaluate&quot;,</span>
<span class="sd">    ...                            data=bytes(command, encoding=&quot;utf-8&quot;))</span>
<span class="sd">    &gt;&gt;&gt; print(str(response.read(), encoding=&quot;utf-8&quot;))</span>
<span class="sd">    maxrequests = 100</span>

<span class="sd">    &gt;&gt;&gt; _ = request.urlopen(&quot;http://127.0.0.1:8080/close_server&quot;)</span>
<span class="sd">    &gt;&gt;&gt; process.kill()</span>
<span class="sd">    &gt;&gt;&gt; _ = process.communicate()</span>

<span class="sd">    Please see the documentation on method |HydPyServer.POST_evaluate| that explains</span>
<span class="sd">    the &quot;debugging&quot; argument.</span>

<span class="sd">    Note that function |start_server| tries to read the &quot;mime types&quot; from a dictionary</span>
<span class="sd">    stored in the file `mimetypes.txt` available in subpackage `conf` and passes it as</span>
<span class="sd">    attribute `extension_map` to class |HydPyServer|.  The reason is to avoid the long</span>
<span class="sd">    computation time of function |mimetypes.init| of module |mimetypes|, usually called</span>
<span class="sd">    when defining class `BaseHTTPRequestHandler` of module `http.server`.  If file</span>
<span class="sd">    `mimetypes.txt` does not exist or does not work for , |start_server| calls</span>
<span class="sd">    |mimetypes.init| as usual, (over)writes `mimetypes.txt` and tries to proceed as</span>
<span class="sd">    expected.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">confpath</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">__path__</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">confpath</span><span class="p">,</span> <span class="s2">&quot;mimetypes.txt&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">ENCODING</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_</span><span class="p">:</span>
            <span class="n">types_map</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">file_</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span>
    <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
        <span class="n">mimetypes</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
        <span class="n">types_map</span> <span class="o">=</span> <span class="n">mimetypes</span><span class="o">.</span><span class="n">types_map</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">types_map</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;&quot;</span><span class="p">:</span> <span class="s2">&quot;application/octet-stream&quot;</span><span class="p">,</span>
                <span class="s2">&quot;.py&quot;</span><span class="p">:</span> <span class="s2">&quot;text/plain&quot;</span><span class="p">,</span>
                <span class="s2">&quot;.c&quot;</span><span class="p">:</span> <span class="s2">&quot;text/plain&quot;</span><span class="p">,</span>
                <span class="s2">&quot;.h&quot;</span><span class="p">:</span> <span class="s2">&quot;text/plain&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">ENCODING</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_</span><span class="p">:</span>
            <span class="n">file_</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">types_map</span><span class="p">))</span>
    <span class="n">HydPyServer</span><span class="o">.</span><span class="n">extensions_map</span> <span class="o">=</span> <span class="n">types_map</span>
    <span class="n">HydPyServer</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">ServerState</span><span class="p">(</span>
        <span class="n">projectname</span><span class="o">=</span><span class="n">projectname</span><span class="p">,</span>
        <span class="n">xmlfile</span><span class="o">=</span><span class="n">xmlfilename</span><span class="p">,</span>
        <span class="n">load_conditions</span><span class="o">=</span><span class="n">objecttools</span><span class="o">.</span><span class="n">value2bool</span><span class="p">(</span><span class="s2">&quot;load_conditions&quot;</span><span class="p">,</span> <span class="n">load_conditions</span><span class="p">),</span>
        <span class="n">load_series</span><span class="o">=</span><span class="n">objecttools</span><span class="o">.</span><span class="n">value2bool</span><span class="p">(</span><span class="s2">&quot;load_series&quot;</span><span class="p">,</span> <span class="n">load_series</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="k">class</span> <span class="nc">_HTTPServer</span><span class="p">(</span><span class="n">_HTTPServerBase</span><span class="p">):</span>
        <span class="n">debugmode</span> <span class="o">=</span> <span class="n">debugging</span> <span class="o">==</span> <span class="s2">&quot;enable&quot;</span>
        <span class="n">request_queue_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">maxrequests</span><span class="p">)</span>

    <span class="n">server</span> <span class="o">=</span> <span class="n">_HTTPServer</span><span class="p">((</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">socket</span><span class="p">)),</span> <span class="n">HydPyServer</span><span class="p">)</span>
    <span class="n">server</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span></div>



<div class="viewcode-block" id="await_server">
<a class="viewcode-back" href="../../../servertools.html#hydpy.exe.servertools.await_server">[docs]</a>
<span class="k">def</span> <span class="nf">await_server</span><span class="p">(</span>
    <span class="n">port</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
    <span class="n">seconds</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Block the current process until either the *HydPy* server is responding on the</span>
<span class="sd">    given `port` or the given number of `seconds` elapsed.</span>

<span class="sd">    &gt;&gt;&gt; from hydpy import run_subprocess, TestIO</span>
<span class="sd">    &gt;&gt;&gt; with TestIO():  # doctest: +ELLIPSIS</span>
<span class="sd">    ...     result = run_subprocess(&quot;hyd.py await_server 8080 0.1&quot;)</span>
<span class="sd">    Invoking hyd.py with arguments `await_server, 8080, 0.1` resulted in the \</span>
<span class="sd">following error:</span>
<span class="sd">    &lt;urlopen error Waited for 0.1 seconds without response on port 8080.&gt;</span>
<span class="sd">    ...</span>

<span class="sd">    &gt;&gt;&gt; from hydpy.examples import prepare_full_example_1</span>
<span class="sd">    &gt;&gt;&gt; prepare_full_example_1()</span>
<span class="sd">    &gt;&gt;&gt; with TestIO():</span>
<span class="sd">    ...     process = run_subprocess(</span>
<span class="sd">    ...         &quot;hyd.py start_server 8080 LahnH multiple_runs.xml&quot;,</span>
<span class="sd">    ...         blocking=False, verbose=False)</span>
<span class="sd">    ...     result = run_subprocess(&quot;hyd.py await_server 8080 10&quot;, verbose=False)</span>

<span class="sd">    &gt;&gt;&gt; from urllib import request</span>
<span class="sd">    &gt;&gt;&gt; _ = request.urlopen(&quot;http://127.0.0.1:8080/close_server&quot;)</span>
<span class="sd">    &gt;&gt;&gt; process.kill()</span>
<span class="sd">    &gt;&gt;&gt; _ = process.communicate()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">now</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">seconds</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">now</span> <span class="o">&lt;=</span> <span class="n">end</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;http://127.0.0.1:</span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s2">/status&quot;</span><span class="p">):</span>
                <span class="k">break</span>
        <span class="k">except</span> <span class="n">urllib</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">URLError</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
            <span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">urllib</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">URLError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Waited for </span><span class="si">{</span><span class="n">seconds</span><span class="si">}</span><span class="s2"> seconds without response on port </span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span></div>

</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">HydPy 5.0.3 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">hydpy.exe.servertools</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2023, HydPy Developers.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    </div>
  </body>
</html>