<!DOCTYPE html>

<html lang="en" data-content_root="../../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>hydpy.models.whmod.whmod_model &#8212; HydPy 6.2.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/classic.css?v=127cebf3" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/graphviz.css?v=4ae1632d" />
    
    <script src="../../../../_static/documentation_options.js?v=f13f159b"></script>
    <script src="../../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">HydPy 6.2.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">hydpy.models.whmod.whmod_model</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../../index.html">
              <img class="logo" src="../../../../_static/HydPy_Logo.png" alt="Logo"/>
            </a></p>
  <div>
    <h3><a href="../../../../index.html">Table of Contents</a></h3>
    <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../example_projects.html">Example Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../user_guide.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer_guide.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference_manual.html">Reference Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../zbibliography.html">Bibliography</a></li>
</ul>

  </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for hydpy.models.whmod.whmod_model</h1><div class="highlight"><pre>
<span></span><span class="c1"># pylint: disable=missing-module-docstring</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy</span><span class="w"> </span><span class="kn">import</span> <span class="n">config</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">importtools</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">modeltools</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.interfaces</span><span class="w"> </span><span class="kn">import</span> <span class="n">aetinterfaces</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.interfaces</span><span class="w"> </span><span class="kn">import</span> <span class="n">precipinterfaces</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.interfaces</span><span class="w"> </span><span class="kn">import</span> <span class="n">stateinterfaces</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.interfaces</span><span class="w"> </span><span class="kn">import</span> <span class="n">tempinterfaces</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.cythons</span><span class="w"> </span><span class="kn">import</span> <span class="n">modelutils</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.whmod.whmod_constants</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.whmod</span><span class="w"> </span><span class="kn">import</span> <span class="n">whmod_constants</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.whmod</span><span class="w"> </span><span class="kn">import</span> <span class="n">whmod_control</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.whmod</span><span class="w"> </span><span class="kn">import</span> <span class="n">whmod_derived</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.whmod</span><span class="w"> </span><span class="kn">import</span> <span class="n">whmod_inputs</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.whmod</span><span class="w"> </span><span class="kn">import</span> <span class="n">whmod_factors</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.whmod</span><span class="w"> </span><span class="kn">import</span> <span class="n">whmod_fluxes</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.whmod</span><span class="w"> </span><span class="kn">import</span> <span class="n">whmod_states</span>


<div class="viewcode-block" id="Calc_Throughfall_InterceptedWater_V1">
<a class="viewcode-back" href="../../../../whmod.html#hydpy.models.whmod.whmod_model.Calc_Throughfall_InterceptedWater_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_Throughfall_InterceptedWater_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the interception storage&#39;s throughfall and change in water content due</span>
<span class="sd">    to precipitation.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      .. math::</span>
<span class="sd">        T = \begin{cases}</span>
<span class="sd">        P &amp;|\ I = C \\</span>
<span class="sd">        0 &amp;|\ I \leq C</span>
<span class="sd">        \end{cases}</span>
<span class="sd">        \\</span>
<span class="sd">        I_{new} = I_{old} + P - I</span>
<span class="sd">        \\ \\</span>
<span class="sd">        T = Throughfall \\</span>
<span class="sd">        P = Precipitation \\</span>
<span class="sd">        I = InterceptedWater \\</span>
<span class="sd">        C = InterceptionCapacity</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.whmod import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(5)</span>
<span class="sd">        &gt;&gt;&gt; landtype(CORN, CORN, CORN, CORN, WATER)</span>
<span class="sd">        &gt;&gt;&gt; interceptioncapacity.corn_jun = 2.0</span>
<span class="sd">        &gt;&gt;&gt; interceptioncapacity.corn_jul = 2.5</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2001-06-29&quot;, &quot;2001-07-03&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; derived.moy.update()</span>

<span class="sd">        &gt;&gt;&gt; inputs.precipitation = 1.0</span>
<span class="sd">        &gt;&gt;&gt; states.interceptedwater = 0.0, 1.0, 2.0, 3.0, nan</span>
<span class="sd">        &gt;&gt;&gt; model.idx_sim = 1</span>
<span class="sd">        &gt;&gt;&gt; model.calc_throughfall_interceptedwater_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.interceptedwater</span>
<span class="sd">        interceptedwater(1.0, 2.0, 2.0, 2.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.throughfall</span>
<span class="sd">        throughfall(0.0, 0.0, 1.0, 2.0, 0.0)</span>

<span class="sd">        &gt;&gt;&gt; inputs.precipitation = 0.0</span>
<span class="sd">        &gt;&gt;&gt; states.interceptedwater = 0.0, 1.0, 2.0, 3.0, nan</span>
<span class="sd">        &gt;&gt;&gt; model.idx_sim = 2</span>
<span class="sd">        &gt;&gt;&gt; model.calc_throughfall_interceptedwater_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.interceptedwater</span>
<span class="sd">        interceptedwater(0.0, 1.0, 2.0, 2.5, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.throughfall</span>
<span class="sd">        throughfall(0.0, 0.0, 0.0, 0.5, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">whmod_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span>
        <span class="n">whmod_control</span><span class="o">.</span><span class="n">LandType</span><span class="p">,</span>
        <span class="n">whmod_control</span><span class="o">.</span><span class="n">InterceptionCapacity</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_derived</span><span class="o">.</span><span class="n">MOY</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_inputs</span><span class="o">.</span><span class="n">Precipitation</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_states</span><span class="o">.</span><span class="n">InterceptedWater</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">Throughfall</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">month</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">moy</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">idx_sim</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">landtype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">WATER</span><span class="p">:</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">interceptedwater</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">throughfall</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ic</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">interceptioncapacity</span><span class="p">[</span><span class="n">con</span><span class="o">.</span><span class="n">landtype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">month</span><span class="p">]</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">throughfall</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                    <span class="n">inp</span><span class="o">.</span><span class="n">precipitation</span> <span class="o">+</span> <span class="n">sta</span><span class="o">.</span><span class="n">interceptedwater</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">ic</span><span class="p">,</span> <span class="mf">0.0</span>
                <span class="p">)</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">interceptedwater</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">inp</span><span class="o">.</span><span class="n">precipitation</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">throughfall</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>



<div class="viewcode-block" id="Calc_InterceptionEvaporation_InterceptedWater_AETModel_V1">
<a class="viewcode-back" href="../../../../whmod.html#hydpy.models.whmod.whmod_model.Calc_InterceptionEvaporation_InterceptedWater_AETModel_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_InterceptionEvaporation_InterceptedWater_AETModel_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Let a submodel that follows the |AETModel_V1| submodel interface calculate</span>
<span class="sd">    interception evaporation and adjust the amount of intercepted water.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      .. math::</span>
<span class="sd">        E = get\_interceptionevaporation()</span>
<span class="sd">        \\</span>
<span class="sd">        I_{new} = I_{old} - E</span>
<span class="sd">        \\ \\</span>
<span class="sd">        I = InterceptedWater \\</span>
<span class="sd">        E = InterceptionEvaporation</span>

<span class="sd">    Examples:</span>

<span class="sd">        We build an example based on |evap_aet_minhas| for calculating interception</span>
<span class="sd">        evaporation, which uses |evap_ret_io| for querying potential</span>
<span class="sd">        evapotranspiration:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.whmod_rural import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; area(1.0)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(5)</span>
<span class="sd">        &gt;&gt;&gt; landtype(GRASS, DECIDUOUS, CORN, SEALED, WATER)</span>
<span class="sd">        &gt;&gt;&gt; zonearea(0.05, 0.1, 0.2, 0.3, 0.35)</span>
<span class="sd">        &gt;&gt;&gt; interceptioncapacity.jun = 3.0</span>
<span class="sd">        &gt;&gt;&gt; derived.moy.shape = 1</span>
<span class="sd">        &gt;&gt;&gt; derived.moy(5)</span>
<span class="sd">        &gt;&gt;&gt; availablefieldcapacity(100.0)</span>
<span class="sd">        &gt;&gt;&gt; rootingdepth(0.1)</span>
<span class="sd">        &gt;&gt;&gt; groundwaterdepth(0.1)</span>
<span class="sd">        &gt;&gt;&gt; with model.add_aetmodel_v1(&quot;evap_aet_minhas&quot;):</span>
<span class="sd">        ...     with model.add_petmodel_v1(&quot;evap_ret_io&quot;):</span>
<span class="sd">        ...         evapotranspirationfactor(0.6, 0.8, 1.0, 1.2, 1.4)</span>
<span class="sd">        ...         inputs.referenceevapotranspiration = 1.0</span>

<span class="sd">        |Calc_InterceptionEvaporation_InterceptedWater_AETModel_V1| uses the flux</span>
<span class="sd">        returned by the submodel to adjust |InterceptedWater|:</span>

<span class="sd">        &gt;&gt;&gt; states.interceptedwater = 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_interceptionevaporation_interceptedwater_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.interceptionevaporation</span>
<span class="sd">        interceptionevaporation(0.6, 0.8, 1.0, 1.2, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.interceptedwater</span>
<span class="sd">        interceptedwater(1.4, 1.2, 1.0, 0.8, 0.0)</span>

<span class="sd">        |Calc_InterceptionEvaporation_InterceptedWater_AETModel_V1| eventually reduces</span>
<span class="sd">        |InterceptionEvaporation| so that |InterceptedWater| does not become negative:</span>

<span class="sd">        &gt;&gt;&gt; model.aetmodel.petmodel.sequences.inputs.referenceevapotranspiration = 5.0</span>
<span class="sd">        &gt;&gt;&gt; states.interceptedwater = 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_interceptionevaporation_interceptedwater_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.interceptionevaporation</span>
<span class="sd">        interceptionevaporation(2.0, 2.0, 2.0, 2.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.interceptedwater</span>
<span class="sd">        interceptedwater(0.0, 0.0, 0.0, 0.0, 0.0)</span>

<span class="sd">        In contrast, |Calc_InterceptionEvaporation_InterceptedWater_AETModel_V1| does</span>
<span class="sd">        not reduce negative |InterceptionEvaporation| values (condensation) that cause</span>
<span class="sd">        an overshoot of the interception storage capacity:</span>

<span class="sd">        &gt;&gt;&gt; model.aetmodel.petmodel.sequences.inputs.referenceevapotranspiration = -3.0</span>
<span class="sd">        &gt;&gt;&gt; states.interceptedwater = 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_interceptionevaporation_interceptedwater_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.interceptionevaporation</span>
<span class="sd">        interceptionevaporation(-1.8, -2.4, -3.0, -3.6, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.interceptedwater</span>
<span class="sd">        interceptedwater(3.8, 4.4, 5.0, 5.6, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span> <span class="n">whmod_control</span><span class="o">.</span><span class="n">LandType</span><span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_states</span><span class="o">.</span><span class="n">InterceptedWater</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">InterceptionEvaporation</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">submodel</span><span class="p">:</span> <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">submodel</span><span class="o">.</span><span class="n">determine_interceptionevaporation</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">landtype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">WATER</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">interceptionevaporation</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">interceptedwater</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">interceptionevaporation</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
                    <span class="n">submodel</span><span class="o">.</span><span class="n">get_interceptionevaporation</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">sta</span><span class="o">.</span><span class="n">interceptedwater</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">interceptedwater</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-=</span> <span class="n">flu</span><span class="o">.</span><span class="n">interceptionevaporation</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>



<div class="viewcode-block" id="Calc_InterceptionEvaporation_InterceptedWater_V1">
<a class="viewcode-back" href="../../../../whmod.html#hydpy.models.whmod.whmod_model.Calc_InterceptionEvaporation_InterceptedWater_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_InterceptionEvaporation_InterceptedWater_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Let a submodel that follows the |AETModel_V1| submodel interface calculate</span>
<span class="sd">    interception evaporation and adjust the amount of intercepted water.&quot;&quot;&quot;</span>

    <span class="n">SUBMODELINTERFACES</span> <span class="o">=</span> <span class="p">(</span><span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="p">,)</span>
    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Calc_InterceptionEvaporation_InterceptedWater_AETModel_V1</span><span class="p">,)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span> <span class="n">whmod_control</span><span class="o">.</span><span class="n">LandType</span><span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_states</span><span class="o">.</span><span class="n">InterceptedWater</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">InterceptionEvaporation</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">aetmodel_typeid</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">calc_interceptionevaporation_interceptedwater_aetmodel_v1</span><span class="p">(</span>
                <span class="n">cast</span><span class="p">(</span><span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">aetmodel</span><span class="p">)</span>
            <span class="p">)</span></div>



<div class="viewcode-block" id="Calc_LakeEvaporation_AETModel_V1">
<a class="viewcode-back" href="../../../../whmod.html#hydpy.models.whmod.whmod_model.Calc_LakeEvaporation_AETModel_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_LakeEvaporation_AETModel_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Let a submodel that follows the |AETModel_V1| submodel interface calculate</span>
<span class="sd">    lake evaporation.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      .. math::</span>
<span class="sd">        LakeEvaporation = get\_waterevaporation()</span>

<span class="sd">    Example:</span>

<span class="sd">        We build an example based on |evap_aet_minhas| for calculating water</span>
<span class="sd">        evaporation, which uses |evap_ret_io| for querying potential</span>
<span class="sd">        evapotranspiration:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.whmod_rural import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; area(1.0)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(5)</span>
<span class="sd">        &gt;&gt;&gt; landtype(GRASS, DECIDUOUS, CORN, SEALED, WATER)</span>
<span class="sd">        &gt;&gt;&gt; zonearea(0.05, 0.1, 0.2, 0.3, 0.35)</span>
<span class="sd">        &gt;&gt;&gt; interceptioncapacity.jun = 3.0</span>
<span class="sd">        &gt;&gt;&gt; derived.moy.shape = 1</span>
<span class="sd">        &gt;&gt;&gt; derived.moy(5)</span>
<span class="sd">        &gt;&gt;&gt; availablefieldcapacity(100.0)</span>
<span class="sd">        &gt;&gt;&gt; rootingdepth(0.1)</span>
<span class="sd">        &gt;&gt;&gt; groundwaterdepth(0.1)</span>
<span class="sd">        &gt;&gt;&gt; with model.add_aetmodel_v1(&quot;evap_aet_minhas&quot;):</span>
<span class="sd">        ...     with model.add_petmodel_v1(&quot;evap_ret_io&quot;):</span>
<span class="sd">        ...         evapotranspirationfactor(0.6, 0.8, 1.0, 1.2, 1.4)</span>
<span class="sd">        ...         inputs.referenceevapotranspiration = 1.0</span>

<span class="sd">        |Calc_LakeEvaporation_AETModel_V1| stores the flux returned by the submodel</span>
<span class="sd">        without any modifications:</span>

<span class="sd">        &gt;&gt;&gt; model.aetmodel.determine_interceptionevaporation()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_lakeevaporation_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.lakeevaporation</span>
<span class="sd">        lakeevaporation(0.0, 0.0, 0.0, 0.0, 1.4)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span> <span class="n">whmod_control</span><span class="o">.</span><span class="n">LandType</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">LakeEvaporation</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">submodel</span><span class="p">:</span> <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">submodel</span><span class="o">.</span><span class="n">determine_waterevaporation</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">landtype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">WATER</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">lakeevaporation</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">submodel</span><span class="o">.</span><span class="n">get_waterevaporation</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">lakeevaporation</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_LakeEvaporation_V1">
<a class="viewcode-back" href="../../../../whmod.html#hydpy.models.whmod.whmod_model.Calc_LakeEvaporation_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_LakeEvaporation_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Let a submodel that follows the |AETModel_V1| submodel interface calculate</span>
<span class="sd">    lake evaporation.&quot;&quot;&quot;</span>

    <span class="n">SUBMODELINTERFACES</span> <span class="o">=</span> <span class="p">(</span><span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="p">,)</span>
    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Calc_LakeEvaporation_AETModel_V1</span><span class="p">,)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span> <span class="n">whmod_control</span><span class="o">.</span><span class="n">LandType</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">LakeEvaporation</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">aetmodel_typeid</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">calc_lakeevaporation_aetmodel_v1</span><span class="p">(</span>
                <span class="n">cast</span><span class="p">(</span><span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">aetmodel</span><span class="p">)</span>
            <span class="p">)</span></div>



<div class="viewcode-block" id="Calc_PotentialSnowmelt_V1">
<a class="viewcode-back" href="../../../../whmod.html#hydpy.models.whmod.whmod_model.Calc_PotentialSnowmelt_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_PotentialSnowmelt_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculcate the potential snowmelt with the degree day method.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      .. math::</span>
<span class="sd">        P = \begin{cases}</span>
<span class="sd">        0 &amp;|\ T \leq 0 \\</span>
<span class="sd">        D \cdot T &amp;|\ T &gt; 0</span>
<span class="sd">        \end{cases}</span>
<span class="sd">        \\ \\</span>
<span class="sd">        P = PotentialSnowmelt \\</span>
<span class="sd">        D = DegreeDayFactor \\</span>
<span class="sd">        T = Temperature</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.whmod import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(3)</span>
<span class="sd">        &gt;&gt;&gt; landtype(GRASS, SEALED, WATER)</span>
<span class="sd">        &gt;&gt;&gt; degreedayfactor(grass=3.0, sealed=4.0)</span>

<span class="sd">        &gt;&gt;&gt; inputs.temperature = -2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_potentialsnowmelt_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.potentialsnowmelt</span>
<span class="sd">        potentialsnowmelt(0.0, 0.0, 0.0)</span>

<span class="sd">        &gt;&gt;&gt; inputs.temperature = 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_potentialsnowmelt_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.potentialsnowmelt</span>
<span class="sd">        potentialsnowmelt(0.0, 0.0, 0.0)</span>

<span class="sd">        &gt;&gt;&gt; inputs.temperature = 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_potentialsnowmelt_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.potentialsnowmelt</span>
<span class="sd">        potentialsnowmelt(6.0, 8.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">whmod_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span>
        <span class="n">whmod_control</span><span class="o">.</span><span class="n">LandType</span><span class="p">,</span>
        <span class="n">whmod_control</span><span class="o">.</span><span class="n">DegreeDayFactor</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_inputs</span><span class="o">.</span><span class="n">Temperature</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">PotentialSnowmelt</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">landtype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">WATER</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">inp</span><span class="o">.</span><span class="n">temperature</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">potentialsnowmelt</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">potentialsnowmelt</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">degreedayfactor</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">inp</span><span class="o">.</span><span class="n">temperature</span></div>



<div class="viewcode-block" id="Calc_Snowmelt_Snowpack_V1">
<a class="viewcode-back" href="../../../../whmod.html#hydpy.models.whmod.whmod_model.Calc_Snowmelt_Snowpack_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_Snowmelt_Snowpack_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculatethe actual snowmelt and update the snow&#39;s water content.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      .. math::</span>
<span class="sd">        M = \begin{cases}</span>
<span class="sd">        0 &amp;|\ T \leq 0 \\</span>
<span class="sd">        min(P, \, S_{old}) &amp;|\ T &gt; 0</span>
<span class="sd">        \end{cases}</span>
<span class="sd">        \\</span>
<span class="sd">        S_{new} = \begin{cases}</span>
<span class="sd">        S_{old} + F &amp;|\ T \leq 0</span>
<span class="sd">        \\</span>
<span class="sd">        S_{old} - M &amp;|\ T &gt; 0</span>
<span class="sd">        \end{cases}</span>
<span class="sd">        \\ \\</span>
<span class="sd">        M = Snowmelt \\</span>
<span class="sd">        P = PotentialSnowmelt \\</span>
<span class="sd">        S = SnowPack \\</span>
<span class="sd">        T = Temperature \\</span>
<span class="sd">        F = Throughfall</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.whmod import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(3)</span>
<span class="sd">        &gt;&gt;&gt; landtype(GRASS, SEALED, WATER)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.throughfall = 1.0</span>

<span class="sd">        &gt;&gt;&gt; inputs.temperature = 0.0</span>
<span class="sd">        &gt;&gt;&gt; states.snowpack = 0.0, 2.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_snowmelt_snowpack_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.snowmelt</span>
<span class="sd">        snowmelt(0.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.snowpack</span>
<span class="sd">        snowpack(1.0, 3.0, 0.0)</span>

<span class="sd">        &gt;&gt;&gt; inputs.temperature = 1.0</span>
<span class="sd">        &gt;&gt;&gt; states.snowpack = 0.0, 3.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.potentialsnowmelt = 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_snowmelt_snowpack_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.snowmelt</span>
<span class="sd">        snowmelt(0.0, 2.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.snowpack</span>
<span class="sd">        snowpack(0.0, 1.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span> <span class="n">whmod_control</span><span class="o">.</span><span class="n">LandType</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">whmod_inputs</span><span class="o">.</span><span class="n">Temperature</span><span class="p">,</span>
        <span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">Throughfall</span><span class="p">,</span>
        <span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">PotentialSnowmelt</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_states</span><span class="o">.</span><span class="n">Snowpack</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">Snowmelt</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">landtype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">WATER</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">snowmelt</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">snowpack</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">elif</span> <span class="n">inp</span><span class="o">.</span><span class="n">temperature</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">snowmelt</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">snowpack</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">throughfall</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">flu</span><span class="o">.</span><span class="n">potentialsnowmelt</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">sta</span><span class="o">.</span><span class="n">snowpack</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">snowmelt</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">potentialsnowmelt</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">snowpack</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-=</span> <span class="n">flu</span><span class="o">.</span><span class="n">snowmelt</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">snowmelt</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">sta</span><span class="o">.</span><span class="n">snowpack</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">snowpack</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_Ponding_V1">
<a class="viewcode-back" href="../../../../whmod.html#hydpy.models.whmod.whmod_model.Calc_Ponding_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_Ponding_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the (potential) ponding of throughfall and snowmelt of land surfaces.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      .. math::</span>
<span class="sd">        P = \begin{cases}</span>
<span class="sd">        0 &amp;|\ T \leq 0 \\</span>
<span class="sd">        F + M &amp;|\ T &gt; 0</span>
<span class="sd">        \end{cases}</span>
<span class="sd">        \\ \\</span>
<span class="sd">        P = Ponding \\</span>
<span class="sd">        F = Throughfall \\</span>
<span class="sd">        M = Snowmelt \\</span>
<span class="sd">        T = Temperature</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.whmod import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(3)</span>
<span class="sd">        &gt;&gt;&gt; landtype(GRASS, SEALED, WATER)</span>

<span class="sd">        &gt;&gt;&gt; inputs.temperature = 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_ponding_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.ponding</span>
<span class="sd">        ponding(0.0, 0.0, 0.0)</span>

<span class="sd">        &gt;&gt;&gt; inputs.temperature = 1.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.throughfall = 2.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.snowmelt = 3.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_ponding_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.ponding</span>
<span class="sd">        ponding(5.0, 5.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span> <span class="n">whmod_control</span><span class="o">.</span><span class="n">LandType</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">whmod_inputs</span><span class="o">.</span><span class="n">Temperature</span><span class="p">,</span>
        <span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">Throughfall</span><span class="p">,</span>
        <span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">Snowmelt</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">Ponding</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">landtype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">WATER</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">inp</span><span class="o">.</span><span class="n">temperature</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">ponding</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">ponding</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">throughfall</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">snowmelt</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>



<div class="viewcode-block" id="Calc_SurfaceRunoff_V1">
<a class="viewcode-back" href="../../../../whmod.html#hydpy.models.whmod.whmod_model.Calc_SurfaceRunoff_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_SurfaceRunoff_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the surface runoff from sealed areas.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      .. math::</span>
<span class="sd">        SurfaceRunoff = Ponding</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.whmod import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(3)</span>
<span class="sd">        &gt;&gt;&gt; landtype(SEALED, WATER, GRASS)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.ponding = 3.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_surfacerunoff_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.surfacerunoff</span>
<span class="sd">        surfacerunoff(3.0, 0.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span> <span class="n">whmod_control</span><span class="o">.</span><span class="n">LandType</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">Ponding</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">SurfaceRunoff</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">landtype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">SEALED</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">surfacerunoff</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">ponding</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">surfacerunoff</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_RelativeSoilMoisture_V1">
<a class="viewcode-back" href="../../../../whmod.html#hydpy.models.whmod.whmod_model.Calc_RelativeSoilMoisture_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_RelativeSoilMoisture_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the relative soil water content.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      .. math::</span>
<span class="sd">        R = S / M</span>
<span class="sd">        \\ \\</span>
<span class="sd">        R = RelativeSoilMoisture \\</span>
<span class="sd">        S = SoilMoisture \\</span>
<span class="sd">        M = MaxSoilWater</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.whmod import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(7)</span>
<span class="sd">        &gt;&gt;&gt; landtype(GRASS, GRASS, GRASS, GRASS, GRASS, GRASS, SEALED)</span>
<span class="sd">        &gt;&gt;&gt; soiltype(SAND, SAND_COHESIVE, LOAM, CLAY, SILT, PEAT, NONE)</span>
<span class="sd">        &gt;&gt;&gt; derived.maxsoilwater(200.0, 200.0, 200.0, 200.0, 200.0, 0.0, nan)</span>
<span class="sd">        &gt;&gt;&gt; states.soilmoisture = 0.0, 50.0, 100.0, 150.0, 200.0, 0.0, nan</span>
<span class="sd">        &gt;&gt;&gt; model.calc_relativesoilmoisture_v1()</span>
<span class="sd">        &gt;&gt;&gt; factors.relativesoilmoisture</span>
<span class="sd">        relativesoilmoisture(0.0, 0.25, 0.5, 0.75, 1.0, 0.0, 0.0)</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span> <span class="n">whmod_control</span><span class="o">.</span><span class="n">SoilType</span><span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_derived</span><span class="o">.</span><span class="n">MaxSoilWater</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_states</span><span class="o">.</span><span class="n">SoilMoisture</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_factors</span><span class="o">.</span><span class="n">RelativeSoilMoisture</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">soiltype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">NONE</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">maxsoilwater</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">):</span>
                <span class="n">fac</span><span class="o">.</span><span class="n">relativesoilmoisture</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fac</span><span class="o">.</span><span class="n">relativesoilmoisture</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">sta</span><span class="o">.</span><span class="n">soilmoisture</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">der</span><span class="o">.</span><span class="n">maxsoilwater</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>



<div class="viewcode-block" id="Calc_CisternInflow_V1">
<a class="viewcode-back" href="../../../../whmod.html#hydpy.models.whmod.whmod_model.Calc_CisternInflow_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_CisternInflow_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the inflow into the cistern.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      .. math::</span>
<span class="sd">        I = \sum_{k=1}^N \frac{A_k}{1000} \cdot \begin{cases}</span>
<span class="sd">        S_k &amp;|\ L_k = SEALED \, \land \, C_k \\</span>
<span class="sd">        P_k &amp;|\ L_k \neq SEALED \, \land \, C_k</span>
<span class="sd">        \end{cases}</span>
<span class="sd">        \\ \\</span>
<span class="sd">        I = CisternInflow\\</span>
<span class="sd">        N = NmbZones \\</span>
<span class="sd">        T = LandType \\</span>
<span class="sd">        C = CisternSource \\</span>
<span class="sd">        A = ZoneArea \\</span>
<span class="sd">        S = SurfaceRunoff \\</span>
<span class="sd">        P = Percolation</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.whmod import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(5)</span>
<span class="sd">        &gt;&gt;&gt; landtype(GRASS, GRASS, SEALED, SEALED, WATER)</span>
<span class="sd">        &gt;&gt;&gt; cisternsource(False, True, False, True, False)</span>
<span class="sd">        &gt;&gt;&gt; area(15.0)</span>
<span class="sd">        &gt;&gt;&gt; zonearea(1.0, 2.0, 3.0, 4.0, 5.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.percolation = nan, 6.0, nan, nan, nan</span>
<span class="sd">        &gt;&gt;&gt; fluxes.surfacerunoff = nan, nan, nan, 7.0, nan</span>
<span class="sd">        &gt;&gt;&gt; model.calc_cisterninflow_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.cisterninflow</span>
<span class="sd">        cisterninflow(0.04)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">whmod_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span>
        <span class="n">whmod_control</span><span class="o">.</span><span class="n">ZoneArea</span><span class="p">,</span>
        <span class="n">whmod_control</span><span class="o">.</span><span class="n">LandType</span><span class="p">,</span>
        <span class="n">whmod_control</span><span class="o">.</span><span class="n">CisternSource</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">SurfaceRunoff</span><span class="p">,</span> <span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">Percolation</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">CisternInflow</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>

        <span class="n">flu</span><span class="o">.</span><span class="n">cisterninflow</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">cisternsource</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">landtype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">SEALED</span><span class="p">:</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">cisterninflow</span> <span class="o">+=</span> <span class="n">con</span><span class="o">.</span><span class="n">zonearea</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">surfacerunoff</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">con</span><span class="o">.</span><span class="n">landtype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">!=</span> <span class="n">WATER</span><span class="p">:</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">cisterninflow</span> <span class="o">+=</span> <span class="n">con</span><span class="o">.</span><span class="n">zonearea</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">percolation</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">cisterninflow</span> <span class="o">/=</span> <span class="mf">1000.0</span></div>



<div class="viewcode-block" id="Calc_CisternOverflow_CisternWater_V1">
<a class="viewcode-back" href="../../../../whmod.html#hydpy.models.whmod.whmod_model.Calc_CisternOverflow_CisternWater_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_CisternOverflow_CisternWater_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Take the inflow into the cistern to update its content and calculate eventual</span>
<span class="sd">    overflow.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      .. math::</span>
<span class="sd">        O(t) = \begin{cases}</span>
<span class="sd">        0 &amp;|\ W(t) \leq C \\</span>
<span class="sd">        I(t) &amp;|\ W(t) = C</span>
<span class="sd">        \end{cases}</span>
<span class="sd">        \\</span>
<span class="sd">        \frac{d W(t)}{d t} = I(t) - O(t)</span>
<span class="sd">        \\ \\</span>
<span class="sd">        O = CisternOverflow \\</span>
<span class="sd">        I = CisternInflow \\</span>
<span class="sd">        W = CisternWater \\</span>
<span class="sd">        C = CisternCapacity</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.whmod import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; cisterncapacity(5.0)</span>
<span class="sd">        &gt;&gt;&gt; states.cisternwater = 1.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.cisterninflow = 3.0</span>

<span class="sd">        &gt;&gt;&gt; model.calc_cisternoverflow_cisternwater_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.cisternwater</span>
<span class="sd">        cisternwater(4.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.cisternoverflow</span>
<span class="sd">        cisternoverflow(0.0)</span>

<span class="sd">        &gt;&gt;&gt; model.calc_cisternoverflow_cisternwater_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.cisternwater</span>
<span class="sd">        cisternwater(5.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.cisternoverflow</span>
<span class="sd">        cisternoverflow(2.0)</span>

<span class="sd">        &gt;&gt;&gt; model.calc_cisternoverflow_cisternwater_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.cisternwater</span>
<span class="sd">        cisternwater(5.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.cisternoverflow</span>
<span class="sd">        cisternoverflow(3.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_control</span><span class="o">.</span><span class="n">CisternCapacity</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">CisternInflow</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_states</span><span class="o">.</span><span class="n">CisternWater</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">CisternOverflow</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>

        <span class="n">sta</span><span class="o">.</span><span class="n">cisternwater</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">cisterninflow</span>
        <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">cisternwater</span> <span class="o">&lt;=</span> <span class="n">con</span><span class="o">.</span><span class="n">cisterncapacity</span><span class="p">:</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">cisternoverflow</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">cisternoverflow</span> <span class="o">=</span> <span class="n">sta</span><span class="o">.</span><span class="n">cisternwater</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">cisterncapacity</span>
            <span class="n">sta</span><span class="o">.</span><span class="n">cisternwater</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cisterncapacity</span></div>



<div class="viewcode-block" id="Calc_Percolation_V1">
<a class="viewcode-back" href="../../../../whmod.html#hydpy.models.whmod.whmod_model.Calc_Percolation_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_Percolation_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the percolation out of the soil storage.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      .. math::</span>
<span class="sd">        Percolation = P \cdot R ^ {\beta}</span>
<span class="sd">        \\ \\</span>
<span class="sd">        P = Ponding \\</span>
<span class="sd">        R = RelativeSoilMoisture \\</span>
<span class="sd">        \beta = BETA</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.whmod import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(7)</span>
<span class="sd">        &gt;&gt;&gt; landtype(GRASS, GRASS, GRASS, GRASS, GRASS, GRASS, SEALED)</span>
<span class="sd">        &gt;&gt;&gt; soiltype(SAND, SAND_COHESIVE, LOAM, CLAY, SILT, PEAT, NONE)</span>
<span class="sd">        &gt;&gt;&gt; derived.beta(2.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.ponding(10.0)</span>
<span class="sd">        &gt;&gt;&gt; factors.relativesoilmoisture = 0.0, 0.2, 0.4, 0.6, 0.8, 1.0, nan</span>
<span class="sd">        &gt;&gt;&gt; model.calc_percolation_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.percolation</span>
<span class="sd">        percolation(0.0, 0.4, 1.6, 3.6, 6.4, 10.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span> <span class="n">whmod_control</span><span class="o">.</span><span class="n">SoilType</span><span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_derived</span><span class="o">.</span><span class="n">Beta</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">Ponding</span><span class="p">,</span> <span class="n">whmod_factors</span><span class="o">.</span><span class="n">RelativeSoilMoisture</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">Percolation</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">soiltype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">NONE</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">percolation</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">percolation</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">ponding</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">fac</span><span class="o">.</span><span class="n">relativesoilmoisture</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">**</span> <span class="n">der</span><span class="o">.</span><span class="n">beta</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="p">)</span></div>



<div class="viewcode-block" id="Calc_SoilEvapotranspiration_AETModel_V1">
<a class="viewcode-back" href="../../../../whmod.html#hydpy.models.whmod.whmod_model.Calc_SoilEvapotranspiration_AETModel_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_SoilEvapotranspiration_AETModel_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Let a submodel that follows the |AETModel_V1| submodel interface calculate</span>
<span class="sd">    soil evapotranspiration.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      .. math::</span>
<span class="sd">        SoilEvapotranspiration = get\_soilevapotranspiration()</span>

<span class="sd">    Example:</span>

<span class="sd">        We build an example based on |evap_aet_minhas|:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.whmod_rural import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; area(1.0)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(5)</span>
<span class="sd">        &gt;&gt;&gt; landtype(GRASS, GRASS, GRASS, GRASS, WATER)</span>
<span class="sd">        &gt;&gt;&gt; soiltype(SAND, SAND, SAND, SAND, NONE)</span>
<span class="sd">        &gt;&gt;&gt; zonearea(0.05, 0.1, 0.2, 0.3, 0.35)</span>
<span class="sd">        &gt;&gt;&gt; availablefieldcapacity(100.0)</span>
<span class="sd">        &gt;&gt;&gt; rootingdepth(1.0)</span>
<span class="sd">        &gt;&gt;&gt; groundwaterdepth(1.0)</span>
<span class="sd">        &gt;&gt;&gt; with model.add_aetmodel_v1(&quot;evap_aet_minhas&quot;):</span>
<span class="sd">        ...     dissefactor(5.0)</span>

<span class="sd">        |Calc_SoilEvapotranspiration_AETModel_V1| stores the flux returned by the</span>
<span class="sd">        submodel without any modifications:</span>

<span class="sd">        &gt;&gt;&gt; states.soilmoisture = 0.0, 0.0, 50.0, 100.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.aetmodel.sequences.fluxes.potentialinterceptionevaporation = 5.0</span>
<span class="sd">        &gt;&gt;&gt; model.aetmodel.sequences.fluxes.potentialsoilevapotranspiration = 5.0</span>
<span class="sd">        &gt;&gt;&gt; model.aetmodel.sequences.fluxes.interceptionevaporation = 3.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_soilevapotranspiration_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.soilevapotranspiration</span>
<span class="sd">        soilevapotranspiration(0.0, 0.0, 1.717962, 2.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span> <span class="n">whmod_control</span><span class="o">.</span><span class="n">SoilType</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">SoilEvapotranspiration</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">submodel</span><span class="p">:</span> <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">submodel</span><span class="o">.</span><span class="n">determine_soilevapotranspiration</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">soiltype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">NONE</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">soilevapotranspiration</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">soilevapotranspiration</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">submodel</span><span class="o">.</span><span class="n">get_soilevapotranspiration</span><span class="p">(</span><span class="n">k</span><span class="p">)</span></div>



<div class="viewcode-block" id="Calc_SoilEvapotranspiration_V1">
<a class="viewcode-back" href="../../../../whmod.html#hydpy.models.whmod.whmod_model.Calc_SoilEvapotranspiration_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_SoilEvapotranspiration_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Let a submodel that follows the |AETModel_V1| submodel interface calculate soil</span>
<span class="sd">    evapotranspiration.&quot;&quot;&quot;</span>

    <span class="n">SUBMODELINTERFACES</span> <span class="o">=</span> <span class="p">(</span><span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="p">,)</span>
    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Calc_SoilEvapotranspiration_AETModel_V1</span><span class="p">,)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span> <span class="n">whmod_control</span><span class="o">.</span><span class="n">SoilType</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">SoilEvapotranspiration</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">aetmodel_typeid</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">calc_soilevapotranspiration_aetmodel_v1</span><span class="p">(</span>
                <span class="n">cast</span><span class="p">(</span><span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">aetmodel</span><span class="p">)</span>
            <span class="p">)</span></div>



<div class="viewcode-block" id="Calc_TotalEvapotranspiration_V1">
<a class="viewcode-back" href="../../../../whmod.html#hydpy.models.whmod.whmod_model.Calc_TotalEvapotranspiration_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_TotalEvapotranspiration_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the sum of interception evaporation, lake evaporation, and soil</span>
<span class="sd">    evapotranspiration.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      .. math::</span>
<span class="sd">        T = I + S + L</span>
<span class="sd">        \\ \\</span>
<span class="sd">        T = TotalEvapotranspiration \\</span>
<span class="sd">        I = InterceptionEvaporation \\</span>
<span class="sd">        S = SoilEvapotranspiration \\</span>
<span class="sd">        L = LakeEvaporation</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.whmod import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(3)</span>
<span class="sd">        &gt;&gt;&gt; landtype(GRASS, SEALED, WATER)</span>
<span class="sd">        &gt;&gt;&gt; soiltype(SAND, NONE, NONE)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.interceptionevaporation = 1.0, 2.0, nan</span>
<span class="sd">        &gt;&gt;&gt; fluxes.soilevapotranspiration = 3.0, nan, nan</span>
<span class="sd">        &gt;&gt;&gt; fluxes.lakeevaporation = nan, nan, 5.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_totalevapotranspiration_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.totalevapotranspiration</span>
<span class="sd">        totalevapotranspiration(4.0, 2.0, 5.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">whmod_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span>
        <span class="n">whmod_control</span><span class="o">.</span><span class="n">LandType</span><span class="p">,</span>
        <span class="n">whmod_control</span><span class="o">.</span><span class="n">SoilType</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">InterceptionEvaporation</span><span class="p">,</span>
        <span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">SoilEvapotranspiration</span><span class="p">,</span>
        <span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">LakeEvaporation</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">TotalEvapotranspiration</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">landtype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">WATER</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">totalevapotranspiration</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">lakeevaporation</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">totalevapotranspiration</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">interceptionevaporation</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">soiltype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">!=</span> <span class="n">NONE</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">totalevapotranspiration</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">soilevapotranspiration</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>



<div class="viewcode-block" id="Calc_CapillaryRise_V1">
<a class="viewcode-back" href="../../../../whmod.html#hydpy.models.whmod.whmod_model.Calc_CapillaryRise_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_CapillaryRise_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the actual capillary rise if requested.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      .. math::</span>
<span class="sd">        C = P \cdot (1 - R) ^ 3</span>
<span class="sd">        \\ \\</span>
<span class="sd">        C = CapillaryRise \\</span>
<span class="sd">        P = PotentialCapillaryRise \\</span>
<span class="sd">        R = RelativeSoilMoisture</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.whmod import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(7)</span>
<span class="sd">        &gt;&gt;&gt; landtype(GRASS, GRASS, GRASS, GRASS, GRASS, SEALED, WATER)</span>
<span class="sd">        &gt;&gt;&gt; soiltype(SAND, SAND, SAND, SAND, SAND, NONE, NONE)</span>
<span class="sd">        &gt;&gt;&gt; derived.potentialcapillaryrise(2.0)</span>
<span class="sd">        &gt;&gt;&gt; factors.relativesoilmoisture = 0.0, 0.25, 0.5, 0.75, 1.0, nan, nan</span>

<span class="sd">        &gt;&gt;&gt; withcapillaryrise(True)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_capillaryrise_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.capillaryrise</span>
<span class="sd">        capillaryrise(2.0, 0.84375, 0.25, 0.03125, 0.0, 0.0, 0.0)</span>

<span class="sd">        &gt;&gt;&gt; withcapillaryrise(False)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_capillaryrise_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.capillaryrise</span>
<span class="sd">        capillaryrise(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">whmod_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span>
        <span class="n">whmod_control</span><span class="o">.</span><span class="n">SoilType</span><span class="p">,</span>
        <span class="n">whmod_control</span><span class="o">.</span><span class="n">WithCapillaryRise</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_derived</span><span class="o">.</span><span class="n">PotentialCapillaryRise</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_factors</span><span class="o">.</span><span class="n">RelativeSoilMoisture</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">CapillaryRise</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">soiltype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">NONE</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">con</span><span class="o">.</span><span class="n">withcapillaryrise</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">capillaryrise</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">capillaryrise</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">der</span><span class="o">.</span><span class="n">potentialcapillaryrise</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                    <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">fac</span><span class="o">.</span><span class="n">relativesoilmoisture</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">**</span> <span class="mi">3</span>
                <span class="p">)</span></div>



<div class="viewcode-block" id="Calc_CapillaryRise_V2">
<a class="viewcode-back" href="../../../../whmod.html#hydpy.models.whmod.whmod_model.Calc_CapillaryRise_V2">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_CapillaryRise_V2</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the actual capillary rise if requested.</span>

<span class="sd">    Method |Calc_CapillaryRise_V2| works like method |Calc_CapillaryRise_V1| except</span>
<span class="sd">    that it does not calculate any capillary rise for zones connected to the cistern.</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.whmod import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(7)</span>
<span class="sd">        &gt;&gt;&gt; landtype(GRASS, GRASS, GRASS, GRASS, GRASS, SEALED, WATER)</span>
<span class="sd">        &gt;&gt;&gt; soiltype(SAND, SAND, SAND, SAND, SAND, NONE, NONE)</span>
<span class="sd">        &gt;&gt;&gt; cisternsource(False, True, True, False, False, False, False)</span>
<span class="sd">        &gt;&gt;&gt; derived.potentialcapillaryrise(2.0)</span>
<span class="sd">        &gt;&gt;&gt; factors.relativesoilmoisture = 0.0, 0.25, 0.5, 0.75, 1.0, nan, nan</span>

<span class="sd">        &gt;&gt;&gt; withcapillaryrise(True)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_capillaryrise_v2()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.capillaryrise</span>
<span class="sd">        capillaryrise(2.0, 0.0, 0.0, 0.03125, 0.0, 0.0, 0.0)</span>

<span class="sd">        &gt;&gt;&gt; withcapillaryrise(False)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_capillaryrise_v2()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.capillaryrise</span>
<span class="sd">        capillaryrise(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">whmod_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span>
        <span class="n">whmod_control</span><span class="o">.</span><span class="n">SoilType</span><span class="p">,</span>
        <span class="n">whmod_control</span><span class="o">.</span><span class="n">CisternSource</span><span class="p">,</span>
        <span class="n">whmod_control</span><span class="o">.</span><span class="n">WithCapillaryRise</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_derived</span><span class="o">.</span><span class="n">PotentialCapillaryRise</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_factors</span><span class="o">.</span><span class="n">RelativeSoilMoisture</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">CapillaryRise</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">soiltype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">NONE</span><span class="p">)</span>
                <span class="ow">or</span> <span class="n">con</span><span class="o">.</span><span class="n">cisternsource</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="ow">or</span> <span class="ow">not</span> <span class="n">con</span><span class="o">.</span><span class="n">withcapillaryrise</span>
            <span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">capillaryrise</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">capillaryrise</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">der</span><span class="o">.</span><span class="n">potentialcapillaryrise</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                    <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">fac</span><span class="o">.</span><span class="n">relativesoilmoisture</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">**</span> <span class="mi">3</span>
                <span class="p">)</span></div>



<div class="viewcode-block" id="Calc_SoilMoisture_V1">
<a class="viewcode-back" href="../../../../whmod.html#hydpy.models.whmod.whmod_model.Calc_SoilMoisture_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_SoilMoisture_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Update the actual soil storage&#39;s water content.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      .. math::</span>
<span class="sd">        M = I - E - P + C</span>
<span class="sd">        \\ \\</span>
<span class="sd">        M = SoilMoisture \\</span>
<span class="sd">        I = Ponding \\</span>
<span class="sd">        E = SoilEvapotranspiration \\</span>
<span class="sd">        P = Percolation \\</span>
<span class="sd">        C = CapillaryRise</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.whmod import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(5)</span>
<span class="sd">        &gt;&gt;&gt; landtype(GRASS, GRASS, GRASS, GRASS, SEALED)</span>
<span class="sd">        &gt;&gt;&gt; soiltype(SAND, SAND, SAND, SAND, NONE)</span>
<span class="sd">        &gt;&gt;&gt; derived.maxsoilwater(10.0)</span>

<span class="sd">        Cases where the given basic equation does not need further adjustment:</span>

<span class="sd">        &gt;&gt;&gt; states.soilmoisture(5.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.ponding = 2.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.soilevapotranspiration = 2.5, -2.5, 5.0, -5.0, nan</span>
<span class="sd">        &gt;&gt;&gt; fluxes.percolation = 5.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.capillaryrise = 3.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_soilmoisture_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.soilmoisture</span>
<span class="sd">        soilmoisture(2.5, 7.5, 0.0, 10.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.soilevapotranspiration</span>
<span class="sd">        soilevapotranspiration(2.5, -2.5, 5.0, -5.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.percolation</span>
<span class="sd">        percolation(5.0, 5.0, 5.0, 5.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.capillaryrise</span>
<span class="sd">        capillaryrise(3.0, 3.0, 3.0, 3.0, 0.0)</span>

<span class="sd">        Cases where the soil moisture would become negative (we prevent this by</span>
<span class="sd">        reducing percolation and, if positive, evapotranspiration by the same factor):</span>

<span class="sd">        &gt;&gt;&gt; states.soilmoisture(2.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.ponding = 1.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.soilevapotranspiration = 5.0, 0.0, -1.0, 7.0, nan</span>
<span class="sd">        &gt;&gt;&gt; fluxes.percolation = 0.0, 5.0, 6.0, 1.0, nan</span>
<span class="sd">        &gt;&gt;&gt; fluxes.capillaryrise = 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_soilmoisture_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.soilmoisture</span>
<span class="sd">        soilmoisture(0.0, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.soilevapotranspiration</span>
<span class="sd">        soilevapotranspiration(4.0, 0.0, -1.0, 3.5, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.percolation</span>
<span class="sd">        percolation(0.0, 4.0, 5.0, 0.5, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.capillaryrise</span>
<span class="sd">        capillaryrise(1.0, 1.0, 1.0, 1.0, 0.0)</span>

<span class="sd">        Cases where the soil moisture would exceed the available storage volume (we</span>
<span class="sd">        prevent this by first reducing capillary rise and, if necessary, also</span>
<span class="sd">        increasing percolation):</span>

<span class="sd">        &gt;&gt;&gt; states.soilmoisture(8.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.ponding = 1.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.soilevapotranspiration = 1.0, -1.0, -3.0, -4.0, nan</span>
<span class="sd">        &gt;&gt;&gt; fluxes.percolation = 1.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.capillaryrise = 5.0, 2.0, 1.0, 0.0, nan</span>
<span class="sd">        &gt;&gt;&gt; model.calc_soilmoisture_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.soilmoisture</span>
<span class="sd">        soilmoisture(10.0, 10.0, 10.0, 10.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.soilevapotranspiration</span>
<span class="sd">        soilevapotranspiration(1.0, -1.0, -3.0, -4.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.percolation</span>
<span class="sd">        percolation(1.0, 1.0, 2.0, 3.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.capillaryrise</span>
<span class="sd">        capillaryrise(3.0, 1.0, 0.0, 0.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span> <span class="n">whmod_control</span><span class="o">.</span><span class="n">SoilType</span><span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_derived</span><span class="o">.</span><span class="n">MaxSoilWater</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">Ponding</span><span class="p">,</span>
        <span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">SoilEvapotranspiration</span><span class="p">,</span>
        <span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">Percolation</span><span class="p">,</span>
        <span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">CapillaryRise</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_states</span><span class="o">.</span><span class="n">SoilMoisture</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">old</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess_old</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess_new</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">soiltype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">NONE</span><span class="p">:</span>
                <span class="n">new</span><span class="o">.</span><span class="n">soilmoisture</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">percolation</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">capillaryrise</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">soilevapotranspiration</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">increase</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">ponding</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">capillaryrise</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">decrease</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">percolation</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">flu</span><span class="o">.</span><span class="n">soilevapotranspiration</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">increase</span> <span class="o">-=</span> <span class="n">flu</span><span class="o">.</span><span class="n">soilevapotranspiration</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">decrease</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">soilevapotranspiration</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">new</span><span class="o">.</span><span class="n">soilmoisture</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">old</span><span class="o">.</span><span class="n">soilmoisture</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">increase</span> <span class="o">-</span> <span class="n">decrease</span>
                <span class="k">if</span> <span class="n">new</span><span class="o">.</span><span class="n">soilmoisture</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="p">(</span><span class="n">old</span><span class="o">.</span><span class="n">soilmoisture</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">increase</span><span class="p">)</span> <span class="o">/</span> <span class="n">decrease</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">percolation</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*=</span> <span class="n">factor</span>
                    <span class="k">if</span> <span class="n">flu</span><span class="o">.</span><span class="n">soilevapotranspiration</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">:</span>
                        <span class="n">flu</span><span class="o">.</span><span class="n">soilevapotranspiration</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*=</span> <span class="n">factor</span>
                    <span class="n">new</span><span class="o">.</span><span class="n">soilmoisture</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="k">elif</span> <span class="n">new</span><span class="o">.</span><span class="n">soilmoisture</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">der</span><span class="o">.</span><span class="n">maxsoilwater</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                    <span class="n">delta</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">soilmoisture</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">der</span><span class="o">.</span><span class="n">maxsoilwater</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">flu</span><span class="o">.</span><span class="n">capillaryrise</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">delta</span><span class="p">:</span>
                        <span class="n">flu</span><span class="o">.</span><span class="n">capillaryrise</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-=</span> <span class="n">delta</span>
                        <span class="n">new</span><span class="o">.</span><span class="n">soilmoisture</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">maxsoilwater</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">new</span><span class="o">.</span><span class="n">soilmoisture</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-=</span> <span class="n">flu</span><span class="o">.</span><span class="n">capillaryrise</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                        <span class="n">flu</span><span class="o">.</span><span class="n">capillaryrise</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                        <span class="n">flu</span><span class="o">.</span><span class="n">percolation</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">new</span><span class="o">.</span><span class="n">soilmoisture</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">der</span><span class="o">.</span><span class="n">maxsoilwater</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                        <span class="n">new</span><span class="o">.</span><span class="n">soilmoisture</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">maxsoilwater</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>



<div class="viewcode-block" id="Calc_RequiredIrrigation_V1">
<a class="viewcode-back" href="../../../../whmod.html#hydpy.models.whmod.whmod_model.Calc_RequiredIrrigation_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_RequiredIrrigation_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the individual zones&#39; irrigation demand.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      .. math::</span>
<span class="sd">        I = \begin{cases}</span>
<span class="sd">        (T_1 - R) \cdot M &amp;|\ R &lt; T_0 \\</span>
<span class="sd">        0 &amp;|\ R \geq T_0</span>
<span class="sd">        \end{cases}</span>
<span class="sd">        \\ \\</span>
<span class="sd">        I = RequiredIrrigation \\</span>
<span class="sd">        T_0 = IrrigationTrigger \\</span>
<span class="sd">        T_1 = IrrigationTarget \\</span>
<span class="sd">        R = RelativeSoilMoisture \\</span>
<span class="sd">        M = MaxSoilWater</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.whmod import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(8)</span>
<span class="sd">        &gt;&gt;&gt; landtype(GRASS, GRASS, CORN, CORN, CORN, CORN, CORN, SEALED)</span>
<span class="sd">        &gt;&gt;&gt; soiltype(SAND, SAND, SAND, SAND, SAND, SAND, SAND, NONE)</span>
<span class="sd">        &gt;&gt;&gt; trigger = irrigationtrigger</span>
<span class="sd">        &gt;&gt;&gt; target = irrigationtarget</span>
<span class="sd">        &gt;&gt;&gt; trigger.grass, target.grass = 0.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; trigger.corn_jun, target.corn_jun = 0.7, 0.7</span>
<span class="sd">        &gt;&gt;&gt; trigger.corn_jul, target.corn_jul = 0.6, 0.8</span>
<span class="sd">        &gt;&gt;&gt; derived.maxsoilwater(100.0)</span>
<span class="sd">        &gt;&gt;&gt; factors.relativesoilmoisture = 0.0, 0.1, 0.5, 0.6, 0.7, 0.8, 0.9, nan</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2001-06-29&quot;, &quot;2001-07-03&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; derived.moy.update()</span>

<span class="sd">        &gt;&gt;&gt; model.idx_sim = 1</span>
<span class="sd">        &gt;&gt;&gt; model.calc_requiredirrigation_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.requiredirrigation</span>
<span class="sd">        requiredirrigation(0.0, 0.0, 20.0, 10.0, 0.0, 0.0, 0.0, 0.0)</span>

<span class="sd">        &gt;&gt;&gt; model.idx_sim = 2</span>
<span class="sd">        &gt;&gt;&gt; model.calc_requiredirrigation_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.requiredirrigation</span>
<span class="sd">        requiredirrigation(0.0, 0.0, 30.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">whmod_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span>
        <span class="n">whmod_control</span><span class="o">.</span><span class="n">LandType</span><span class="p">,</span>
        <span class="n">whmod_control</span><span class="o">.</span><span class="n">SoilType</span><span class="p">,</span>
        <span class="n">whmod_control</span><span class="o">.</span><span class="n">IrrigationTrigger</span><span class="p">,</span>
        <span class="n">whmod_control</span><span class="o">.</span><span class="n">IrrigationTarget</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_derived</span><span class="o">.</span><span class="n">MOY</span><span class="p">,</span> <span class="n">whmod_derived</span><span class="o">.</span><span class="n">MaxSoilWater</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_factors</span><span class="o">.</span><span class="n">RelativeSoilMoisture</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">RequiredIrrigation</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>

        <span class="n">m</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">moy</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">idx_sim</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="n">l</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">landtype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">sm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">fac</span><span class="o">.</span><span class="n">relativesoilmoisture</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">soiltype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">NONE</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">sm</span> <span class="o">&gt;=</span> <span class="n">con</span><span class="o">.</span><span class="n">irrigationtrigger</span><span class="p">[</span><span class="n">l</span><span class="p">,</span> <span class="n">m</span><span class="p">]):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">requiredirrigation</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">requiredirrigation</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">maxsoilwater</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span>
                    <span class="n">con</span><span class="o">.</span><span class="n">irrigationtarget</span><span class="p">[</span><span class="n">l</span><span class="p">,</span> <span class="n">m</span><span class="p">]</span> <span class="o">-</span> <span class="n">sm</span>
                <span class="p">)</span></div>



<div class="viewcode-block" id="Calc_CisternDemand_V1">
<a class="viewcode-back" href="../../../../whmod.html#hydpy.models.whmod.whmod_model.Calc_CisternDemand_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_CisternDemand_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the total irrigation water demand from the cistern.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      .. math::</span>
<span class="sd">        D = \sum_{k=1}^N \frac{A_k}{1000} \cdot R_k</span>
<span class="sd">        \\ \\</span>
<span class="sd">        D = CisternDemand \\</span>
<span class="sd">        N = NmbZones \\</span>
<span class="sd">        A = ZoneArea \\</span>
<span class="sd">        R = RequiredIrrigation</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.whmod import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(5)</span>
<span class="sd">        &gt;&gt;&gt; landtype(GRASS, GRASS, GRASS, GRASS, SEALED)</span>
<span class="sd">        &gt;&gt;&gt; soiltype(SAND, SAND, SAND, SAND, NONE)</span>
<span class="sd">        &gt;&gt;&gt; area(15.0)</span>
<span class="sd">        &gt;&gt;&gt; zonearea(1.0, 2.0, 3.0, 4.0, 5.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.requiredirrigation = 0.0, 6.0, 0.0, 7.0, nan</span>
<span class="sd">        &gt;&gt;&gt; model.calc_cisterndemand_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.cisterndemand</span>
<span class="sd">        cisterndemand(0.04)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">whmod_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span>
        <span class="n">whmod_control</span><span class="o">.</span><span class="n">ZoneArea</span><span class="p">,</span>
        <span class="n">whmod_control</span><span class="o">.</span><span class="n">SoilType</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">RequiredIrrigation</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">CisternDemand</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>

        <span class="n">flu</span><span class="o">.</span><span class="n">cisterndemand</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">soiltype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">!=</span> <span class="n">NONE</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">cisterndemand</span> <span class="o">+=</span> <span class="n">con</span><span class="o">.</span><span class="n">zonearea</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">requiredirrigation</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">cisterndemand</span> <span class="o">/=</span> <span class="mf">1000.0</span></div>



<div class="viewcode-block" id="Calc_CisternExtraction_CisternWater_V1">
<a class="viewcode-back" href="../../../../whmod.html#hydpy.models.whmod.whmod_model.Calc_CisternExtraction_CisternWater_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_CisternExtraction_CisternWater_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the actual irrigation extraction from the cistern and update the</span>
<span class="sd">    amount of still available water.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      .. math::</span>
<span class="sd">        E(t) = \begin{cases}</span>
<span class="sd">        D(t) &amp;|\ W(t) &gt; 0 \\</span>
<span class="sd">        0 &amp;|\ W(t) = 0</span>
<span class="sd">        \end{cases}</span>
<span class="sd">        \\</span>
<span class="sd">        \frac{d W(t)}{d t} = E(t)</span>
<span class="sd">        \\ \\</span>
<span class="sd">        E = CisternExtraction \\</span>
<span class="sd">        D = CisternDemand \\</span>
<span class="sd">        W = CisternWater</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.whmod import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; states.cisternwater = 5.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.cisterndemand = 3.0</span>

<span class="sd">        &gt;&gt;&gt; model.calc_cisternextraction_cisternwater_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.cisternwater</span>
<span class="sd">        cisternwater(2.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.cisternextraction</span>
<span class="sd">        cisternextraction(3.0)</span>

<span class="sd">        &gt;&gt;&gt; model.calc_cisternextraction_cisternwater_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.cisternwater</span>
<span class="sd">        cisternwater(0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.cisternextraction</span>
<span class="sd">        cisternextraction(2.0)</span>

<span class="sd">        &gt;&gt;&gt; model.calc_cisternextraction_cisternwater_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.cisternwater</span>
<span class="sd">        cisternwater(0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.cisternextraction</span>
<span class="sd">        cisternextraction(0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">CisternDemand</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">CisternExtraction</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_states</span><span class="o">.</span><span class="n">CisternWater</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>

        <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">cisternwater</span> <span class="o">&gt;</span> <span class="n">flu</span><span class="o">.</span><span class="n">cisterndemand</span><span class="p">:</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">cisternextraction</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">cisterndemand</span>
            <span class="n">sta</span><span class="o">.</span><span class="n">cisternwater</span> <span class="o">-=</span> <span class="n">flu</span><span class="o">.</span><span class="n">cisternextraction</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">cisternextraction</span> <span class="o">=</span> <span class="n">sta</span><span class="o">.</span><span class="n">cisternwater</span>
            <span class="n">sta</span><span class="o">.</span><span class="n">cisternwater</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_InternalIrrigation_SoilMoisture_V1">
<a class="viewcode-back" href="../../../../whmod.html#hydpy.models.whmod.whmod_model.Calc_InternalIrrigation_SoilMoisture_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_InternalIrrigation_SoilMoisture_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Internal irrigation with water taken from the cistern.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      .. math::</span>
<span class="sd">        I = R \cdot E / D</span>
<span class="sd">        \\ \\</span>
<span class="sd">        I = InternalIrrigation \\</span>
<span class="sd">        R = RequiredIrrigation \\</span>
<span class="sd">        E = CisternExtraction \\</span>
<span class="sd">        D = CisternDemand</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.whmod import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(5)</span>
<span class="sd">        &gt;&gt;&gt; landtype(GRASS, GRASS, GRASS, GRASS, SEALED)</span>
<span class="sd">        &gt;&gt;&gt; soiltype(SAND, SAND, SAND, SAND, NONE)</span>
<span class="sd">        &gt;&gt;&gt; area(15.0)</span>
<span class="sd">        &gt;&gt;&gt; zonearea(1.0, 2.0, 3.0, 4.0, 5.0)</span>
<span class="sd">        &gt;&gt;&gt; states.soilmoisture = 100.0</span>

<span class="sd">        &gt;&gt;&gt; fluxes.requiredirrigation = 0.0, 6.0, 0.0, 7.0, nan</span>
<span class="sd">        &gt;&gt;&gt; fluxes.cisterndemand = 0.04</span>
<span class="sd">        &gt;&gt;&gt; fluxes.cisternextraction = 0.03</span>
<span class="sd">        &gt;&gt;&gt; model.calc_internalirrigation_soilmoisture_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.internalirrigation</span>
<span class="sd">        internalirrigation(0.0, 4.5, 0.0, 5.25, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.soilmoisture</span>
<span class="sd">        soilmoisture(100.0, 104.5, 100.0, 105.25, 0.0)</span>

<span class="sd">        &gt;&gt;&gt; fluxes.requiredirrigation = 0.0, 0.0, 0.0, 0.0, nan</span>
<span class="sd">        &gt;&gt;&gt; fluxes.cisterndemand = 0.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.cisternextraction = 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_internalirrigation_soilmoisture_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.internalirrigation</span>
<span class="sd">        internalirrigation(0.0, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.soilmoisture</span>
<span class="sd">        soilmoisture(100.0, 104.5, 100.0, 105.25, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span> <span class="n">whmod_control</span><span class="o">.</span><span class="n">SoilType</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">RequiredIrrigation</span><span class="p">,</span>
        <span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">CisternDemand</span><span class="p">,</span>
        <span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">CisternExtraction</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">InternalIrrigation</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_states</span><span class="o">.</span><span class="n">SoilMoisture</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>

        <span class="k">if</span> <span class="n">flu</span><span class="o">.</span><span class="n">cisterndemand</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">cisternextraction</span> <span class="o">/</span> <span class="n">flu</span><span class="o">.</span><span class="n">cisterndemand</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">factor</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">soiltype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">NONE</span><span class="p">:</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">soilmoisture</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">internalirrigation</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">internalirrigation</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">factor</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">requiredirrigation</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">soilmoisture</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">internalirrigation</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>



<div class="viewcode-block" id="Calc_ExternalIrrigation_SoilMoisture_V1">
<a class="viewcode-back" href="../../../../whmod.html#hydpy.models.whmod.whmod_model.Calc_ExternalIrrigation_SoilMoisture_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_ExternalIrrigation_SoilMoisture_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Irrigate from external sources, if required and requested.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      .. math::</span>
<span class="sd">        E = \begin{cases}</span>
<span class="sd">        R &amp;|\ W \\</span>
<span class="sd">        0 &amp;|\ \overline{W}</span>
<span class="sd">        \end{cases}</span>
<span class="sd">        \\</span>
<span class="sd">        S_{new} = S_{old} + E</span>
<span class="sd">        \\ \\</span>
<span class="sd">        E = ExternalIrrigation \\</span>
<span class="sd">        R = RequiredIrrigation \\</span>
<span class="sd">        W = WithExternalIrrigation \\</span>
<span class="sd">        S = SoilMoisture</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.whmod import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(2)</span>
<span class="sd">        &gt;&gt;&gt; landtype(CORN, SEALED)</span>
<span class="sd">        &gt;&gt;&gt; soiltype(SAND, NONE)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.requiredirrigation(2.0, nan)</span>
<span class="sd">        &gt;&gt;&gt; states.soilmoisture = 50.0, nan</span>

<span class="sd">        &gt;&gt;&gt; withexternalirrigation(False)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_externalirrigation_soilmoisture_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.externalirrigation</span>
<span class="sd">        externalirrigation(0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.soilmoisture</span>
<span class="sd">        soilmoisture(50.0, 0.0)</span>

<span class="sd">        &gt;&gt;&gt; withexternalirrigation(True)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_externalirrigation_soilmoisture_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.externalirrigation</span>
<span class="sd">        externalirrigation(2.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.soilmoisture</span>
<span class="sd">        soilmoisture(52.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">whmod_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span>
        <span class="n">whmod_control</span><span class="o">.</span><span class="n">SoilType</span><span class="p">,</span>
        <span class="n">whmod_control</span><span class="o">.</span><span class="n">WithExternalIrrigation</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">RequiredIrrigation</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">ExternalIrrigation</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_states</span><span class="o">.</span><span class="n">SoilMoisture</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">soiltype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">NONE</span><span class="p">:</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">soilmoisture</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">externalirrigation</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">elif</span> <span class="n">con</span><span class="o">.</span><span class="n">withexternalirrigation</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">externalirrigation</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">requiredirrigation</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">soilmoisture</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">externalirrigation</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">externalirrigation</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_ExternalIrrigation_SoilMoisture_V2">
<a class="viewcode-back" href="../../../../whmod.html#hydpy.models.whmod.whmod_model.Calc_ExternalIrrigation_SoilMoisture_V2">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_ExternalIrrigation_SoilMoisture_V2</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Irrigate from external sources, if still required after internal irrigation and</span>
<span class="sd">    requested.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      .. math::</span>
<span class="sd">        E = \begin{cases}</span>
<span class="sd">        R - I &amp;|\ W \\</span>
<span class="sd">        0 &amp;|\ \overline{W}</span>
<span class="sd">        \end{cases}</span>
<span class="sd">        \\</span>
<span class="sd">        S_{new} = S_{old} + E</span>
<span class="sd">        \\ \\</span>
<span class="sd">        E = ExternalIrrigation \\</span>
<span class="sd">        R = RequiredIrrigation \\</span>
<span class="sd">        I = InternalIrrigation \\</span>
<span class="sd">        W = WithExternalIrrigation \\</span>
<span class="sd">        S = SoilMoisture</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.whmod import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(2)</span>
<span class="sd">        &gt;&gt;&gt; landtype(CORN, SEALED)</span>
<span class="sd">        &gt;&gt;&gt; soiltype(SAND, NONE)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.requiredirrigation(5.0, nan)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.internalirrigation(3.0, nan)</span>
<span class="sd">        &gt;&gt;&gt; states.soilmoisture = 50.0, nan</span>

<span class="sd">        &gt;&gt;&gt; withexternalirrigation(False)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_externalirrigation_soilmoisture_v2()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.externalirrigation</span>
<span class="sd">        externalirrigation(0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.soilmoisture</span>
<span class="sd">        soilmoisture(50.0, 0.0)</span>

<span class="sd">        &gt;&gt;&gt; withexternalirrigation(True)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_externalirrigation_soilmoisture_v2()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.externalirrigation</span>
<span class="sd">        externalirrigation(2.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.soilmoisture</span>
<span class="sd">        soilmoisture(52.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">whmod_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span>
        <span class="n">whmod_control</span><span class="o">.</span><span class="n">SoilType</span><span class="p">,</span>
        <span class="n">whmod_control</span><span class="o">.</span><span class="n">WithExternalIrrigation</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">RequiredIrrigation</span><span class="p">,</span>
        <span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">InternalIrrigation</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">ExternalIrrigation</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_states</span><span class="o">.</span><span class="n">SoilMoisture</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">soiltype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">NONE</span><span class="p">:</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">soilmoisture</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">externalirrigation</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">elif</span> <span class="n">con</span><span class="o">.</span><span class="n">withexternalirrigation</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">externalirrigation</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">requiredirrigation</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">internalirrigation</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">soilmoisture</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">externalirrigation</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">externalirrigation</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_PotentialRecharge_V1">
<a class="viewcode-back" href="../../../../whmod.html#hydpy.models.whmod.whmod_model.Calc_PotentialRecharge_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_PotentialRecharge_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the potential recharge.</span>

<span class="sd">    Basic equation for water areas:</span>
<span class="sd">      .. math::</span>
<span class="sd">        PotentialRecharge = P - E</span>
<span class="sd">        \\ \\</span>
<span class="sd">        P = Precipitation \\</span>
<span class="sd">        E = LakeEvaporation</span>

<span class="sd">    Basic equation for non-sealed land areas:</span>
<span class="sd">      .. math::</span>
<span class="sd">        PotentialRecharge = P - C</span>
<span class="sd">        \\ \\</span>
<span class="sd">        P = Percolation \\</span>
<span class="sd">        C = CapillaryRise</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.whmod import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(3)</span>
<span class="sd">        &gt;&gt;&gt; landtype(GRASS, SEALED, WATER)</span>
<span class="sd">        &gt;&gt;&gt; inputs.precipitation = 7.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.lakeevaporation = 4.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.percolation = 3.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.capillaryrise = 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_potentialrecharge_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.potentialrecharge</span>
<span class="sd">        potentialrecharge(2.0, 0.0, 3.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span> <span class="n">whmod_control</span><span class="o">.</span><span class="n">LandType</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">whmod_inputs</span><span class="o">.</span><span class="n">Precipitation</span><span class="p">,</span>
        <span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">LakeEvaporation</span><span class="p">,</span>
        <span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">Percolation</span><span class="p">,</span>
        <span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">CapillaryRise</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">PotentialRecharge</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">landtype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">SEALED</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">potentialrecharge</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">elif</span> <span class="n">con</span><span class="o">.</span><span class="n">landtype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">WATER</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">potentialrecharge</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">inp</span><span class="o">.</span><span class="n">precipitation</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">lakeevaporation</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">potentialrecharge</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">percolation</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">capillaryrise</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>



<div class="viewcode-block" id="Calc_PotentialRecharge_V2">
<a class="viewcode-back" href="../../../../whmod.html#hydpy.models.whmod.whmod_model.Calc_PotentialRecharge_V2">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_PotentialRecharge_V2</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the potential recharge.</span>

<span class="sd">    Method |Calc_PotentialRecharge_V2| works like method |Calc_PotentialRecharge_V1|</span>
<span class="sd">    except that it does not calculate any potential recharge for zones connected to the</span>
<span class="sd">    cistern.</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.whmod import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(5)</span>
<span class="sd">        &gt;&gt;&gt; landtype(GRASS, GRASS, SEALED, SEALED, WATER)</span>
<span class="sd">        &gt;&gt;&gt; cisternsource(False, True, False, True, False)</span>
<span class="sd">        &gt;&gt;&gt; inputs.precipitation = 7.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.lakeevaporation = 4.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.percolation = 3.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.capillaryrise = 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_potentialrecharge_v2()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.potentialrecharge</span>
<span class="sd">        potentialrecharge(2.0, 0.0, 0.0, 0.0, 3.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">whmod_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span>
        <span class="n">whmod_control</span><span class="o">.</span><span class="n">LandType</span><span class="p">,</span>
        <span class="n">whmod_control</span><span class="o">.</span><span class="n">CisternSource</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">whmod_inputs</span><span class="o">.</span><span class="n">Precipitation</span><span class="p">,</span>
        <span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">LakeEvaporation</span><span class="p">,</span>
        <span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">Percolation</span><span class="p">,</span>
        <span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">CapillaryRise</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">PotentialRecharge</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">landtype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">WATER</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">potentialrecharge</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">inp</span><span class="o">.</span><span class="n">precipitation</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">lakeevaporation</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">landtype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">SEALED</span><span class="p">)</span> <span class="ow">or</span> <span class="n">con</span><span class="o">.</span><span class="n">cisternsource</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">potentialrecharge</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">potentialrecharge</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">percolation</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">capillaryrise</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>



<div class="viewcode-block" id="Calc_Baseflow_V1">
<a class="viewcode-back" href="../../../../whmod.html#hydpy.models.whmod.whmod_model.Calc_Baseflow_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_Baseflow_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the base flow.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      .. math::</span>
<span class="sd">        B = (1 - I) \cdot max(P, \, 0)</span>
<span class="sd">        \\ \\</span>
<span class="sd">        B = Baseflow \\</span>
<span class="sd">        I = BaseflowIndex \\</span>
<span class="sd">        P = PotentialRecharge</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.whmod import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(5)</span>
<span class="sd">        &gt;&gt;&gt; landtype(GRASS, GRASS, GRASS, GRASS, SEALED)</span>
<span class="sd">        &gt;&gt;&gt; baseflowindex(1.0, 0.5, 0.0, 0.0, nan)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.potentialrecharge = 2.0, 2.0, 2.0, -2.0, nan</span>
<span class="sd">        &gt;&gt;&gt; model.calc_baseflow_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.baseflow</span>
<span class="sd">        baseflow(0.0, 1.0, 2.0, 0.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">whmod_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span>
        <span class="n">whmod_control</span><span class="o">.</span><span class="n">LandType</span><span class="p">,</span>
        <span class="n">whmod_control</span><span class="o">.</span><span class="n">BaseflowIndex</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">PotentialRecharge</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">Baseflow</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">landtype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">SEALED</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">baseflow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">baseflow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">baseflowindex</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">potentialrecharge</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="mf">0.0</span>
                <span class="p">)</span></div>



<div class="viewcode-block" id="Calc_ActualRecharge_V1">
<a class="viewcode-back" href="../../../../whmod.html#hydpy.models.whmod.whmod_model.Calc_ActualRecharge_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_ActualRecharge_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the actual recharge.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      .. math::</span>
<span class="sd">        A = \sum_{i=1}^N P_i - B_i</span>
<span class="sd">        \\ \\</span>
<span class="sd">        N = NmbZones \\</span>
<span class="sd">        A = ActualRecharge \\</span>
<span class="sd">        P = PotentialRecharge \\</span>
<span class="sd">        B = Baseflow</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.whmod import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(5)</span>
<span class="sd">        &gt;&gt;&gt; landtype(GRASS, GRASS, GRASS, GRASS, SEALED)</span>
<span class="sd">        &gt;&gt;&gt; area(14.0)</span>
<span class="sd">        &gt;&gt;&gt; zonearea(1.0, 1.5, 2.5, 2.0, 7.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.zoneratio.update()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.potentialrecharge = 2.0, 10.0, -2.0, -0.5, nan</span>
<span class="sd">        &gt;&gt;&gt; fluxes.baseflow = 0.0, 5.0, 0.0, 0.0, nan</span>
<span class="sd">        &gt;&gt;&gt; model.calc_actualrecharge_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.actualrecharge</span>
<span class="sd">        actualrecharge(0.25)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_control</span><span class="o">.</span><span class="n">NmbZones</span><span class="p">,</span> <span class="n">whmod_control</span><span class="o">.</span><span class="n">LandType</span><span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_derived</span><span class="o">.</span><span class="n">ZoneRatio</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">PotentialRecharge</span><span class="p">,</span> <span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">Baseflow</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">ActualRecharge</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">actualrecharge</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">nmbzones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">landtype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">!=</span> <span class="n">SEALED</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">actualrecharge</span> <span class="o">+=</span> <span class="n">der</span><span class="o">.</span><span class="n">zoneratio</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">potentialrecharge</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">baseflow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="p">)</span></div>



<div class="viewcode-block" id="Calc_DelayedRecharge_DeepWater_V1">
<a class="viewcode-back" href="../../../../whmod.html#hydpy.models.whmod.whmod_model.Calc_DelayedRecharge_DeepWater_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_DelayedRecharge_DeepWater_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the delayed recharge and update the amount of water that is (still)</span>
<span class="sd">    percolating through the vadose zone.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      .. math::</span>
<span class="sd">        W_{new} = (A + W_{old}) \cdot exp(-1 / R)</span>
<span class="sd">        \\</span>
<span class="sd">        D = A + W_{old} - W_{new}</span>
<span class="sd">        \\ \\</span>
<span class="sd">        D = DelayedRecharge \\</span>
<span class="sd">        A = ActualRecharge \\</span>
<span class="sd">        W = DeepWater \\</span>
<span class="sd">        R = RechargeDelay</span>

<span class="sd">    (The given equations are the analytical solution of the linear storage equation</span>
<span class="sd">    under the assumption of a stepwise constant inflow.)</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.whmod import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.actualrecharge = 1.0</span>

<span class="sd">        &gt;&gt;&gt; rechargedelay(1.0)</span>
<span class="sd">        &gt;&gt;&gt; states.deepwater(2.0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_delayedrecharge_deepwater_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.delayedrecharge</span>
<span class="sd">        delayedrecharge(1.896362)</span>
<span class="sd">        &gt;&gt;&gt; states.deepwater</span>
<span class="sd">        deepwater(1.103638)</span>

<span class="sd">        &gt;&gt;&gt; rechargedelay(0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.deepwater(2.0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_delayedrecharge_deepwater_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.delayedrecharge</span>
<span class="sd">        delayedrecharge(3.0)</span>
<span class="sd">        &gt;&gt;&gt; states.deepwater</span>
<span class="sd">        deepwater(0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_control</span><span class="o">.</span><span class="n">RechargeDelay</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">ActualRecharge</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_states</span><span class="o">.</span><span class="n">DeepWater</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_fluxes</span><span class="o">.</span><span class="n">DelayedRecharge</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess_new</span>
        <span class="n">old</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess_old</span>
        <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">rechargedelay</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">new</span><span class="o">.</span><span class="n">deepwater</span> <span class="o">=</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">actualrecharge</span> <span class="o">+</span> <span class="n">old</span><span class="o">.</span><span class="n">deepwater</span><span class="p">)</span> <span class="o">*</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span>
                <span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">con</span><span class="o">.</span><span class="n">rechargedelay</span>
            <span class="p">)</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">delayedrecharge</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">actualrecharge</span> <span class="o">+</span> <span class="n">old</span><span class="o">.</span><span class="n">deepwater</span> <span class="o">-</span> <span class="n">new</span><span class="o">.</span><span class="n">deepwater</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">delayedrecharge</span> <span class="o">=</span> <span class="n">old</span><span class="o">.</span><span class="n">deepwater</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">actualrecharge</span>
            <span class="n">new</span><span class="o">.</span><span class="n">deepwater</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Get_Temperature_V1">
<a class="viewcode-back" href="../../../../whmod.html#hydpy.models.whmod.whmod_model.Get_Temperature_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Get_Temperature_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the basin&#39;s current air temperature.</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.whmod import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; inputs.temperature = 2.0</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(model.get_temperature_v1(0))</span>
<span class="sd">        2.0</span>
<span class="sd">        &gt;&gt;&gt; round_(model.get_temperature_v1(1))</span>
<span class="sd">        2.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_inputs</span><span class="o">.</span><span class="n">Temperature</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">fastaccess</span>

        <span class="k">return</span> <span class="n">inp</span><span class="o">.</span><span class="n">temperature</span></div>



<div class="viewcode-block" id="Get_MeanTemperature_V1">
<a class="viewcode-back" href="../../../../whmod.html#hydpy.models.whmod.whmod_model.Get_MeanTemperature_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Get_MeanTemperature_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the basin&#39;s current air temperature.</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.whmod import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; inputs.temperature = 2.0</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(model.get_meantemperature_v1())</span>
<span class="sd">        2.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_inputs</span><span class="o">.</span><span class="n">Temperature</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">fastaccess</span>

        <span class="k">return</span> <span class="n">inp</span><span class="o">.</span><span class="n">temperature</span></div>



<div class="viewcode-block" id="Get_Precipitation_V1">
<a class="viewcode-back" href="../../../../whmod.html#hydpy.models.whmod.whmod_model.Get_Precipitation_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Get_Precipitation_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the basin&#39;s current precipitation.</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.whmod import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; inputs.precipitation = 2.0</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(model.get_precipitation_v1(0))</span>
<span class="sd">        2.0</span>
<span class="sd">        &gt;&gt;&gt; round_(model.get_precipitation_v1(1))</span>
<span class="sd">        2.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_inputs</span><span class="o">.</span><span class="n">Precipitation</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">fastaccess</span>

        <span class="k">return</span> <span class="n">inp</span><span class="o">.</span><span class="n">precipitation</span></div>



<div class="viewcode-block" id="Get_InterceptedWater_V1">
<a class="viewcode-back" href="../../../../whmod.html#hydpy.models.whmod.whmod_model.Get_InterceptedWater_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Get_InterceptedWater_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the selected zone&#39;s current amount of intercepted water.</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.whmod import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(2)</span>
<span class="sd">        &gt;&gt;&gt; states.interceptedwater = 2.0, 4.0</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(model.get_interceptedwater_v1(0))</span>
<span class="sd">        2.0</span>
<span class="sd">        &gt;&gt;&gt; round_(model.get_interceptedwater_v1(1))</span>
<span class="sd">        4.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_states</span><span class="o">.</span><span class="n">InterceptedWater</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>

        <span class="k">return</span> <span class="n">sta</span><span class="o">.</span><span class="n">interceptedwater</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>



<div class="viewcode-block" id="Get_SoilWater_V1">
<a class="viewcode-back" href="../../../../whmod.html#hydpy.models.whmod.whmod_model.Get_SoilWater_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Get_SoilWater_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the selected zone&#39;s current soil water content.</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.whmod import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(2)</span>
<span class="sd">        &gt;&gt;&gt; states.soilmoisture = 2.0, 4.0</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(model.get_soilwater_v1(0))</span>
<span class="sd">        2.0</span>
<span class="sd">        &gt;&gt;&gt; round_(model.get_soilwater_v1(1))</span>
<span class="sd">        4.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_states</span><span class="o">.</span><span class="n">SoilMoisture</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>

        <span class="k">return</span> <span class="n">sta</span><span class="o">.</span><span class="n">soilmoisture</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>



<div class="viewcode-block" id="Get_SnowCover_V1">
<a class="viewcode-back" href="../../../../whmod.html#hydpy.models.whmod.whmod_model.Get_SnowCover_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Get_SnowCover_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the selected zones&#39;s current snow cover degree.</span>

<span class="sd">    Examples:</span>

<span class="sd">        Each response unit with a non-zero amount of snow counts as wholly covered:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.whmod import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(2)</span>
<span class="sd">        &gt;&gt;&gt; states.snowpack = 0.0, 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.get_snowcover_v1(0)</span>
<span class="sd">        0.0</span>
<span class="sd">        &gt;&gt;&gt; model.get_snowcover_v1(1)</span>
<span class="sd">        1.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">whmod_states</span><span class="o">.</span><span class="n">Snowpack</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>

        <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">snowpack</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">1.0</span>
        <span class="k">return</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Model">
<a class="viewcode-back" href="../../../../whmod.html#hydpy.models.whmod.whmod_model.Model">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Model</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">AdHocModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;|whmod.DOCNAME.complete|.&quot;&quot;&quot;</span>

    <span class="n">DOCNAME</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">DocName</span><span class="p">(</span><span class="n">short</span><span class="o">=</span><span class="s2">&quot;WHMod&quot;</span><span class="p">)</span>
    <span class="n">__HYDPY_ROOTMODEL__</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">aetmodel</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelProperty</span><span class="p">(</span><span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="p">)</span>
    <span class="n">aetmodel_is_mainmodel</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelIsMainmodelProperty</span><span class="p">()</span>
    <span class="n">aetmodel_typeid</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelTypeIDProperty</span><span class="p">()</span>

    <span class="n">INLET_METHODS</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">OBSERVER_METHODS</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">RECEIVER_METHODS</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">ADD_METHODS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Calc_InterceptionEvaporation_InterceptedWater_AETModel_V1</span><span class="p">,</span>
        <span class="n">Calc_LakeEvaporation_AETModel_V1</span><span class="p">,</span>
        <span class="n">Calc_SoilEvapotranspiration_AETModel_V1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">INTERFACE_METHODS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Get_Temperature_V1</span><span class="p">,</span>
        <span class="n">Get_MeanTemperature_V1</span><span class="p">,</span>
        <span class="n">Get_Precipitation_V1</span><span class="p">,</span>
        <span class="n">Get_InterceptedWater_V1</span><span class="p">,</span>
        <span class="n">Get_SoilWater_V1</span><span class="p">,</span>
        <span class="n">Get_SnowCover_V1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RUN_METHODS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Calc_Throughfall_InterceptedWater_V1</span><span class="p">,</span>
        <span class="n">Calc_InterceptionEvaporation_InterceptedWater_V1</span><span class="p">,</span>
        <span class="n">Calc_LakeEvaporation_V1</span><span class="p">,</span>
        <span class="n">Calc_PotentialSnowmelt_V1</span><span class="p">,</span>
        <span class="n">Calc_Snowmelt_Snowpack_V1</span><span class="p">,</span>
        <span class="n">Calc_Ponding_V1</span><span class="p">,</span>
        <span class="n">Calc_SurfaceRunoff_V1</span><span class="p">,</span>
        <span class="n">Calc_RelativeSoilMoisture_V1</span><span class="p">,</span>
        <span class="n">Calc_Percolation_V1</span><span class="p">,</span>
        <span class="n">Calc_CisternInflow_V1</span><span class="p">,</span>
        <span class="n">Calc_CisternOverflow_CisternWater_V1</span><span class="p">,</span>
        <span class="n">Calc_SoilEvapotranspiration_V1</span><span class="p">,</span>
        <span class="n">Calc_TotalEvapotranspiration_V1</span><span class="p">,</span>
        <span class="n">Calc_CapillaryRise_V1</span><span class="p">,</span>
        <span class="n">Calc_CapillaryRise_V2</span><span class="p">,</span>
        <span class="n">Calc_SoilMoisture_V1</span><span class="p">,</span>
        <span class="n">Calc_RelativeSoilMoisture_V1</span><span class="p">,</span>
        <span class="n">Calc_RequiredIrrigation_V1</span><span class="p">,</span>
        <span class="n">Calc_CisternDemand_V1</span><span class="p">,</span>
        <span class="n">Calc_CisternExtraction_CisternWater_V1</span><span class="p">,</span>
        <span class="n">Calc_InternalIrrigation_SoilMoisture_V1</span><span class="p">,</span>
        <span class="n">Calc_ExternalIrrigation_SoilMoisture_V1</span><span class="p">,</span>
        <span class="n">Calc_ExternalIrrigation_SoilMoisture_V2</span><span class="p">,</span>
        <span class="n">Calc_RelativeSoilMoisture_V1</span><span class="p">,</span>
        <span class="n">Calc_PotentialRecharge_V1</span><span class="p">,</span>
        <span class="n">Calc_PotentialRecharge_V2</span><span class="p">,</span>
        <span class="n">Calc_Baseflow_V1</span><span class="p">,</span>
        <span class="n">Calc_ActualRecharge_V1</span><span class="p">,</span>
        <span class="n">Calc_DelayedRecharge_DeepWater_V1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">OUTLET_METHODS</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">SENDER_METHODS</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">SUBMODELINTERFACES</span> <span class="o">=</span> <span class="p">(</span><span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="p">,)</span>
    <span class="n">SUBMODELS</span> <span class="o">=</span> <span class="p">()</span></div>



<div class="viewcode-block" id="Main_AETModel_V1">
<a class="viewcode-back" href="../../../../whmod.html#hydpy.models.whmod.whmod_model.Main_AETModel_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Main_AETModel_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">AdHocModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for |whmod.DOCNAME.long| models that use submodels that comply with</span>
<span class="sd">    the |AETModel_V1| interface.&quot;&quot;&quot;</span>

    <span class="n">aetmodel</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelProperty</span>
    <span class="n">aetmodel_is_mainmodel</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelIsMainmodelProperty</span><span class="p">()</span>
    <span class="n">aetmodel_typeid</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelTypeIDProperty</span><span class="p">()</span>

    <span class="nd">@importtools</span><span class="o">.</span><span class="n">prepare_submodel</span><span class="p">(</span>
        <span class="s2">&quot;aetmodel&quot;</span><span class="p">,</span>
        <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="p">,</span>
        <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="o">.</span><span class="n">prepare_nmbzones</span><span class="p">,</span>
        <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="o">.</span><span class="n">prepare_subareas</span><span class="p">,</span>
        <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="o">.</span><span class="n">prepare_zonetypes</span><span class="p">,</span>
        <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="o">.</span><span class="n">prepare_water</span><span class="p">,</span>
        <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="o">.</span><span class="n">prepare_interception</span><span class="p">,</span>
        <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="o">.</span><span class="n">prepare_soil</span><span class="p">,</span>
        <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="o">.</span><span class="n">prepare_plant</span><span class="p">,</span>
        <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="o">.</span><span class="n">prepare_tree</span><span class="p">,</span>
        <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="o">.</span><span class="n">prepare_conifer</span><span class="p">,</span>
        <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="o">.</span><span class="n">prepare_maxsoilwater</span><span class="p">,</span>
        <span class="n">landtype_constants</span><span class="o">=</span><span class="n">whmod_constants</span><span class="o">.</span><span class="n">LANDTYPE_CONSTANTS</span><span class="p">,</span>
        <span class="n">landtype_refindices</span><span class="o">=</span><span class="n">whmod_control</span><span class="o">.</span><span class="n">LandType</span><span class="p">,</span>
        <span class="n">soiltype_constants</span><span class="o">=</span><span class="n">whmod_constants</span><span class="o">.</span><span class="n">SOILTYPE_CONSTANTS</span><span class="p">,</span>
        <span class="n">soiltype_refindices</span><span class="o">=</span><span class="n">whmod_control</span><span class="o">.</span><span class="n">SoilType</span><span class="p">,</span>
        <span class="n">refweights</span><span class="o">=</span><span class="n">whmod_control</span><span class="o">.</span><span class="n">ZoneArea</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_aetmodel_v1</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">aetmodel</span><span class="p">:</span> <span class="n">aetinterfaces</span><span class="o">.</span><span class="n">AETModel_V1</span><span class="p">,</span>
        <span class="o">/</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">refresh</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>  <span class="c1"># pylint: disable=unused-argument</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialise the given submodel that follows the |AETModel_V1| interface and</span>
<span class="sd">        is responsible for calculating the different kinds of actual</span>
<span class="sd">        evapotranspiration.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.whmod_rural import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nmbzones(5)</span>
<span class="sd">        &gt;&gt;&gt; area(10.0)</span>
<span class="sd">        &gt;&gt;&gt; landtype(GRASS, DECIDUOUS, CONIFER, WATER, SEALED)</span>
<span class="sd">        &gt;&gt;&gt; zonearea(4.0, 1.0, 1.0, 1.0, 3.0)</span>
<span class="sd">        &gt;&gt;&gt; availablefieldcapacity(200.0)</span>
<span class="sd">        &gt;&gt;&gt; rootingdepth(1.0)</span>
<span class="sd">        &gt;&gt;&gt; groundwaterdepth(1.0)</span>
<span class="sd">        &gt;&gt;&gt; with model.add_aetmodel_v1(&quot;evap_aet_minhas&quot;):</span>
<span class="sd">        ...     nmbhru</span>
<span class="sd">        ...     area</span>
<span class="sd">        ...     water</span>
<span class="sd">        ...     interception</span>
<span class="sd">        ...     soil</span>
<span class="sd">        ...     dissefactor(grass=1.0, deciduous=2.0, default=3.0)</span>
<span class="sd">        ...     for method, arguments in model.preparemethod2arguments.items():</span>
<span class="sd">        ...         print(method, arguments[0][0], sep=&quot;: &quot;)</span>
<span class="sd">        nmbhru(5)</span>
<span class="sd">        area(10.0)</span>
<span class="sd">        water(conifer=False, deciduous=False, grass=False, sealed=False,</span>
<span class="sd">              water=True)</span>
<span class="sd">        interception(conifer=True, deciduous=True, grass=True, sealed=True,</span>
<span class="sd">                     water=False)</span>
<span class="sd">        soil(conifer=True, deciduous=True, grass=True, sealed=False,</span>
<span class="sd">             water=False)</span>
<span class="sd">        prepare_nmbzones: 5</span>
<span class="sd">        prepare_zonetypes: [1 2 4 9 8]</span>
<span class="sd">        prepare_subareas: [4. 1. 1. 1. 3.]</span>
<span class="sd">        prepare_water: [False False False  True False]</span>
<span class="sd">        prepare_interception: [ True  True  True False  True]</span>
<span class="sd">        prepare_soil: [ True  True  True False False]</span>
<span class="sd">        prepare_plant: [ True  True  True False False]</span>
<span class="sd">        prepare_conifer: [False False  True False False]</span>
<span class="sd">        prepare_tree: [False  True  True False False]</span>
<span class="sd">        prepare_maxsoilwater: [200. 200. 200. 200. 200.]</span>

<span class="sd">        &gt;&gt;&gt; df = model.aetmodel.parameters.control.dissefactor</span>
<span class="sd">        &gt;&gt;&gt; df</span>
<span class="sd">        dissefactor(conifer=3.0, deciduous=2.0, grass=1.0)</span>
<span class="sd">        &gt;&gt;&gt; landtype(DECIDUOUS, GRASS, CONIFER, WATER, SEALED)</span>
<span class="sd">        &gt;&gt;&gt; df</span>
<span class="sd">        dissefactor(conifer=3.0, deciduous=1.0, grass=2.0)</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(df.average_values())</span>
<span class="sd">        1.5</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">control</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span>
        <span class="n">derived</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span>

        <span class="n">hydrotopes</span> <span class="o">=</span> <span class="n">control</span><span class="o">.</span><span class="n">nmbzones</span><span class="o">.</span><span class="n">value</span>
        <span class="n">landtype</span> <span class="o">=</span> <span class="n">control</span><span class="o">.</span><span class="n">landtype</span><span class="o">.</span><span class="n">values</span>

        <span class="n">aetmodel</span><span class="o">.</span><span class="n">prepare_nmbzones</span><span class="p">(</span><span class="n">hydrotopes</span><span class="p">)</span>
        <span class="n">aetmodel</span><span class="o">.</span><span class="n">prepare_zonetypes</span><span class="p">(</span><span class="n">landtype</span><span class="p">)</span>
        <span class="n">aetmodel</span><span class="o">.</span><span class="n">prepare_subareas</span><span class="p">(</span><span class="n">control</span><span class="o">.</span><span class="n">zonearea</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="n">sel</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">hydrotopes</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">NP_BOOL</span><span class="p">)</span>
        <span class="n">sel</span><span class="p">[</span><span class="n">landtype</span> <span class="o">==</span> <span class="n">WATER</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">aetmodel</span><span class="o">.</span><span class="n">prepare_water</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span>
        <span class="n">sel</span> <span class="o">=</span> <span class="o">~</span><span class="n">sel</span>
        <span class="n">aetmodel</span><span class="o">.</span><span class="n">prepare_interception</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span>
        <span class="n">sel</span><span class="p">[</span><span class="n">landtype</span> <span class="o">==</span> <span class="n">SEALED</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">aetmodel</span><span class="o">.</span><span class="n">prepare_soil</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span>
        <span class="n">aetmodel</span><span class="o">.</span><span class="n">prepare_plant</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span>
        <span class="n">sel</span><span class="p">[:]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">sel</span><span class="p">[</span><span class="n">landtype</span> <span class="o">==</span> <span class="n">CONIFER</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">aetmodel</span><span class="o">.</span><span class="n">prepare_conifer</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span>
        <span class="n">sel</span><span class="p">[</span><span class="n">landtype</span> <span class="o">==</span> <span class="n">DECIDUOUS</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">aetmodel</span><span class="o">.</span><span class="n">prepare_tree</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span>

        <span class="n">derived</span><span class="o">.</span><span class="n">soildepth</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
        <span class="n">derived</span><span class="o">.</span><span class="n">maxsoilwater</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
        <span class="n">aetmodel</span><span class="o">.</span><span class="n">prepare_maxsoilwater</span><span class="p">(</span><span class="n">derived</span><span class="o">.</span><span class="n">maxsoilwater</span><span class="o">.</span><span class="n">values</span><span class="p">)</span></div>



<div class="viewcode-block" id="Sub_TempModel_V1">
<a class="viewcode-back" href="../../../../whmod.html#hydpy.models.whmod.whmod_model.Sub_TempModel_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Sub_TempModel_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">AdHocModel</span><span class="p">,</span> <span class="n">tempinterfaces</span><span class="o">.</span><span class="n">TempModel_V1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for |whmod.DOCNAME.long| models that comply with the |TempModel_V1|</span>
<span class="sd">    submodel interface.&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="Sub_PrecipModel_V1">
<a class="viewcode-back" href="../../../../whmod.html#hydpy.models.whmod.whmod_model.Sub_PrecipModel_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Sub_PrecipModel_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">AdHocModel</span><span class="p">,</span> <span class="n">precipinterfaces</span><span class="o">.</span><span class="n">PrecipModel_V1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for |whmod.DOCNAME.long| models that comply with the |PrecipModel_V1|</span>
<span class="sd">    submodel interface.&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="Sub_IntercModel_V1">
<a class="viewcode-back" href="../../../../whmod.html#hydpy.models.whmod.whmod_model.Sub_IntercModel_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Sub_IntercModel_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">AdHocModel</span><span class="p">,</span> <span class="n">stateinterfaces</span><span class="o">.</span><span class="n">IntercModel_V1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for |whmod.DOCNAME.long| models that comply with the |IntercModel_V1|</span>
<span class="sd">    submodel interface.&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="Sub_SoilWaterModel_V1">
<a class="viewcode-back" href="../../../../whmod.html#hydpy.models.whmod.whmod_model.Sub_SoilWaterModel_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Sub_SoilWaterModel_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">AdHocModel</span><span class="p">,</span> <span class="n">stateinterfaces</span><span class="o">.</span><span class="n">SoilWaterModel_V1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for |whmod.DOCNAME.long| models that comply with the</span>
<span class="sd">    |SoilWaterModel_V1| submodel interface.&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="Sub_SnowCoverModel_V1">
<a class="viewcode-back" href="../../../../whmod.html#hydpy.models.whmod.whmod_model.Sub_SnowCoverModel_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Sub_SnowCoverModel_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">AdHocModel</span><span class="p">,</span> <span class="n">stateinterfaces</span><span class="o">.</span><span class="n">SnowCoverModel_V1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for |whmod.DOCNAME.long| models that comply with the</span>
<span class="sd">    |SnowCoverModel_V1| submodel interface.&quot;&quot;&quot;</span></div>

</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">HydPy 6.2.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">hydpy.models.whmod.whmod_model</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2013-2025, HydPy Developers.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 9.0.4.
    </div>
  </body>
</html>