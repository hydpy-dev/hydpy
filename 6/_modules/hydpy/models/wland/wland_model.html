<!DOCTYPE html>

<html lang="en" data-content_root="../../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>hydpy.models.wland.wland_model &#8212; HydPy 6.2.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/classic.css?v=127cebf3" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/graphviz.css?v=4ae1632d" />
    
    <script src="../../../../_static/documentation_options.js?v=f13f159b"></script>
    <script src="../../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">HydPy 6.2.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">hydpy.models.wland.wland_model</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../../index.html">
              <img class="logo" src="../../../../_static/HydPy_Logo.png" alt="Logo"/>
            </a></p>
  <div>
    <h3><a href="../../../../index.html">Table of Contents</a></h3>
    <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../example_projects.html">Example Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../user_guide.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer_guide.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference_manual.html">Reference Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../zbibliography.html">Bibliography</a></li>
</ul>

  </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for hydpy.models.wland.wland_model</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">.. _`Pegasus method`: https://link.springer.com/article/10.1007/BF01932959</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># import...</span>
<span class="c1"># ...from site-packages</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span>

<span class="c1"># ...from HydPy</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy</span><span class="w"> </span><span class="kn">import</span> <span class="n">config</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">importtools</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">exceptiontools</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">modeltools</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">objecttools</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.core.typingtools</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.auxs</span><span class="w"> </span><span class="kn">import</span> <span class="n">quadtools</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.auxs</span><span class="w"> </span><span class="kn">import</span> <span class="n">roottools</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.cythons</span><span class="w"> </span><span class="kn">import</span> <span class="n">modelutils</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.cythons</span><span class="w"> </span><span class="kn">import</span> <span class="n">smoothutils</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.interfaces</span><span class="w"> </span><span class="kn">import</span> <span class="n">dischargeinterfaces</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.interfaces</span><span class="w"> </span><span class="kn">import</span> <span class="n">petinterfaces</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.interfaces</span><span class="w"> </span><span class="kn">import</span> <span class="n">precipinterfaces</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.interfaces</span><span class="w"> </span><span class="kn">import</span> <span class="n">stateinterfaces</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.interfaces</span><span class="w"> </span><span class="kn">import</span> <span class="n">tempinterfaces</span>

<span class="c1"># ...from wland</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.wland</span><span class="w"> </span><span class="kn">import</span> <span class="n">wland_control</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.wland</span><span class="w"> </span><span class="kn">import</span> <span class="n">wland_derived</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.wland</span><span class="w"> </span><span class="kn">import</span> <span class="n">wland_fixed</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.wland</span><span class="w"> </span><span class="kn">import</span> <span class="n">wland_solver</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.wland</span><span class="w"> </span><span class="kn">import</span> <span class="n">wland_inputs</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.wland</span><span class="w"> </span><span class="kn">import</span> <span class="n">wland_factors</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.wland</span><span class="w"> </span><span class="kn">import</span> <span class="n">wland_fluxes</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.wland</span><span class="w"> </span><span class="kn">import</span> <span class="n">wland_states</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.wland</span><span class="w"> </span><span class="kn">import</span> <span class="n">wland_aides</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.wland</span><span class="w"> </span><span class="kn">import</span> <span class="n">wland_outlets</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.wland</span><span class="w"> </span><span class="kn">import</span> <span class="n">wland_constants</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.wland.wland_constants</span><span class="w"> </span><span class="kn">import</span> <span class="n">CONIFER</span><span class="p">,</span> <span class="n">DECIDIOUS</span><span class="p">,</span> <span class="n">SEALED</span><span class="p">,</span> <span class="n">SOIL</span><span class="p">,</span> <span class="n">MIXED</span>


<div class="viewcode-block" id="Pick_HS_V1">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Pick_HS_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Pick_HS_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Take the surface water level from a submodel that complies with the</span>
<span class="sd">    |WaterLevelModel_V1| interface, if available.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`HS = 1000 \cdot (WaterLevel - BL)`</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.wland_wag import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>

<span class="sd">        Without an available submodel, |Pick_HS_V1| does not change the current value</span>
<span class="sd">        of sequence |HS| and sets |DHS| (the change of |HS|) accordingly to zero:</span>

<span class="sd">        &gt;&gt;&gt; states.hs(3000.0)</span>
<span class="sd">        &gt;&gt;&gt; model.pick_hs_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.hs</span>
<span class="sd">        hs(3000.0)</span>
<span class="sd">        &gt;&gt;&gt; factors.dhs</span>
<span class="sd">        dhs(0.0)</span>

<span class="sd">        We take |exch_waterlevel| as an example to demonstrate that |Pick_HS_V1|</span>
<span class="sd">        correctly uses submodels that follow the |WaterLevelModel_V1| interface and the</span>
<span class="sd">        defined channel bottom level (|BL|) for updating |HS| and logs such changes via</span>
<span class="sd">        sequence |DHS|:</span>

<span class="sd">        &gt;&gt;&gt; bl(3.0)</span>
<span class="sd">        &gt;&gt;&gt; with model.add_waterlevelmodel_v1(&quot;exch_waterlevel&quot;) as exch:</span>
<span class="sd">        ...     exch.sequences.logs.loggedwaterlevel(5.0)</span>
<span class="sd">        &gt;&gt;&gt; model.pick_hs_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.hs</span>
<span class="sd">        hs(2000.0)</span>
<span class="sd">        &gt;&gt;&gt; factors.dhs</span>
<span class="sd">        dhs(-1000.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_control</span><span class="o">.</span><span class="n">BL</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_states</span><span class="o">.</span><span class="n">HS</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_factors</span><span class="o">.</span><span class="n">DHS</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">old</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess_old</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess_new</span>
        <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">waterlevelmodel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fac</span><span class="o">.</span><span class="n">dhs</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">elif</span> <span class="n">model</span><span class="o">.</span><span class="n">waterlevelmodel_typeid</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">waterlevel</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
                <span class="n">stateinterfaces</span><span class="o">.</span><span class="n">WaterLevelModel_V1</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">waterlevelmodel</span>
            <span class="p">)</span><span class="o">.</span><span class="n">get_waterlevel</span><span class="p">()</span>
            <span class="n">hs</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1000.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">waterlevel</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">bl</span><span class="p">)</span>
            <span class="n">fac</span><span class="o">.</span><span class="n">dhs</span> <span class="o">=</span> <span class="n">hs</span> <span class="o">-</span> <span class="n">new</span><span class="o">.</span><span class="n">hs</span>
            <span class="n">old</span><span class="o">.</span><span class="n">hs</span> <span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">hs</span> <span class="o">=</span> <span class="n">hs</span></div>



<div class="viewcode-block" id="Calc_FXS_V1">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Calc_FXS_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_FXS_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Query the current surface water supply/extraction.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      .. math::</span>
<span class="sd">        FXS_{fluxes} = \begin{cases}</span>
<span class="sd">        0 &amp;|\ FXS_{inputs} = 0</span>
<span class="sd">        \\</span>
<span class="sd">        \frac{FXS_{inputs}}{ASR} &amp;|\ FXS_{inputs} \neq 0 \land NU &gt; 1</span>
<span class="sd">        \\</span>
<span class="sd">        inf &amp;|\ FXS_{inputs} \neq 0 \land NU = 1</span>
<span class="sd">        \end{cases}</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.wland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nu(2)</span>
<span class="sd">        &gt;&gt;&gt; derived.asr(0.5)</span>
<span class="sd">        &gt;&gt;&gt; inputs.fxs = 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_fxs_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.fxs</span>
<span class="sd">        fxs(4.0)</span>
<span class="sd">        &gt;&gt;&gt; nu(1)</span>
<span class="sd">        &gt;&gt;&gt; derived.asr(0.0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_fxs_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.fxs</span>
<span class="sd">        fxs(inf)</span>
<span class="sd">        &gt;&gt;&gt; inputs.fxs = 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_fxs_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.fxs</span>
<span class="sd">        fxs(0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_control</span><span class="o">.</span><span class="n">NU</span><span class="p">,)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_derived</span><span class="o">.</span><span class="n">ASR</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_inputs</span><span class="o">.</span><span class="n">FXS</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_fluxes</span><span class="o">.</span><span class="n">FXS</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">if</span> <span class="n">inp</span><span class="o">.</span><span class="n">fxs</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">fxs</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">elif</span> <span class="n">con</span><span class="o">.</span><span class="n">nu</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">fxs</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">inf</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">fxs</span> <span class="o">=</span> <span class="n">inp</span><span class="o">.</span><span class="n">fxs</span> <span class="o">/</span> <span class="n">der</span><span class="o">.</span><span class="n">asr</span></div>



<div class="viewcode-block" id="Calc_FXG_V1">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Calc_FXG_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_FXG_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Query the current seepage/extraction.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      .. math::</span>
<span class="sd">        FXG_{fluxes} = \begin{cases}</span>
<span class="sd">        0 &amp;|\ FXG_{inputs} = 0</span>
<span class="sd">        \\</span>
<span class="sd">        \frac{FXG_{inputs}}{AGR} &amp;|\ FXG_{inputs} \neq 0 \land AGR &gt; 0</span>
<span class="sd">        \\</span>
<span class="sd">        inf &amp;|\ FXG_{inputs} \neq 0 \land AGR = 0</span>
<span class="sd">        \end{cases}</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.wland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; derived.agr(0.4)</span>
<span class="sd">        &gt;&gt;&gt; inputs.fxg = 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_fxg_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.fxg</span>
<span class="sd">        fxg(5.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.agr(0.0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_fxg_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.fxg</span>
<span class="sd">        fxg(inf)</span>
<span class="sd">        &gt;&gt;&gt; inputs.fxg = 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_fxg_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.fxg</span>
<span class="sd">        fxg(0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_derived</span><span class="o">.</span><span class="n">AGR</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_inputs</span><span class="o">.</span><span class="n">FXG</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_fluxes</span><span class="o">.</span><span class="n">FXG</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">if</span> <span class="n">inp</span><span class="o">.</span><span class="n">fxg</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">fxg</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ra</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">agr</span>
            <span class="k">if</span> <span class="n">ra</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">fxg</span> <span class="o">=</span> <span class="n">inp</span><span class="o">.</span><span class="n">fxg</span> <span class="o">/</span> <span class="n">ra</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">fxg</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">inf</span></div>



<div class="viewcode-block" id="Calc_PC_V1">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Calc_PC_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_PC_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the corrected precipitation.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`PC = CP \cdot P`</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.wland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; cp(1.2)</span>
<span class="sd">        &gt;&gt;&gt; inputs.p = 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_pc_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.pc</span>
<span class="sd">        pc(2.4)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_control</span><span class="o">.</span><span class="n">CP</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_inputs</span><span class="o">.</span><span class="n">P</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_fluxes</span><span class="o">.</span><span class="n">PC</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">pc</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cp</span> <span class="o">*</span> <span class="n">inp</span><span class="o">.</span><span class="n">p</span></div>



<div class="viewcode-block" id="Calc_PE_PET_PETModel_V1">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Calc_PE_PET_PETModel_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_PE_PET_PETModel_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Let a submodel that complies with the |PETModel_V1| interface calculate the</span>
<span class="sd">    potential evapotranspiration of the land areas and the potential evaporation of the</span>
<span class="sd">    surface water storage.</span>

<span class="sd">    Example:</span>

<span class="sd">        We use |evap_ret_tw2002| as an example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.wland_wag import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nu(4)</span>
<span class="sd">        &gt;&gt;&gt; at(1.0)</span>
<span class="sd">        &gt;&gt;&gt; aur(0.25, 0.15, 0.1, 0.5)</span>
<span class="sd">        &gt;&gt;&gt; lt(FIELD, FIELD, FIELD, WATER)</span>
<span class="sd">        &gt;&gt;&gt; derived.nul.update()</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import prepare_model</span>
<span class="sd">        &gt;&gt;&gt; with model.add_petmodel_v1(&quot;evap_ret_tw2002&quot;):</span>
<span class="sd">        ...     hrualtitude(200.0, 600.0, 1000.0, 100.0)</span>
<span class="sd">        ...     coastfactor(0.6)</span>
<span class="sd">        ...     evapotranspirationfactor(1.1)</span>
<span class="sd">        ...     with model.add_radiationmodel_v2(&quot;meteo_glob_io&quot;):</span>
<span class="sd">        ...         inputs.globalradiation = 200.0</span>
<span class="sd">        ...     with model.add_tempmodel_v2(&quot;meteo_temp_io&quot;):</span>
<span class="sd">        ...         temperatureaddend(1.0)</span>
<span class="sd">        ...         inputs.temperature = 14.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_pe_pet_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.pe</span>
<span class="sd">        pe(3.07171, 2.86215, 2.86215, 3.128984)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.pet</span>
<span class="sd">        pet(3.07171, 2.86215, 2.86215, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_derived</span><span class="o">.</span><span class="n">NUL</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_fluxes</span><span class="o">.</span><span class="n">PE</span><span class="p">,</span> <span class="n">wland_fluxes</span><span class="o">.</span><span class="n">PET</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">submodel</span><span class="p">:</span> <span class="n">petinterfaces</span><span class="o">.</span><span class="n">PETModel_V1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">submodel</span><span class="o">.</span><span class="n">determine_potentialevapotranspiration</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">nul</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">pe</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">pet</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">submodel</span><span class="o">.</span><span class="n">get_potentialevapotranspiration</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">pe</span><span class="p">[</span><span class="n">der</span><span class="o">.</span><span class="n">nul</span><span class="p">]</span> <span class="o">=</span> <span class="n">submodel</span><span class="o">.</span><span class="n">get_potentialevapotranspiration</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">nul</span><span class="p">)</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">pet</span><span class="p">[</span><span class="n">der</span><span class="o">.</span><span class="n">nul</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_PE_PET_PETModel_V2">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Calc_PE_PET_PETModel_V2">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_PE_PET_PETModel_V2</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Let a submodel that complies with the |PETModel_V2| interface calculate the</span>
<span class="sd">    potential interception evaporation and potential vadose zone evapotranspiration of</span>
<span class="sd">    the land areas and the potential evaporation of the surface water storage.</span>

<span class="sd">    Examples:</span>

<span class="sd">        We use |evap_pet_ambav1| as an example.  All data stems from the integration</span>
<span class="sd">        tests :ref:`evap_pet_ambav1_vegetation_daily`,</span>
<span class="sd">        :ref:`evap_pet_ambav1_snow_daily`, and :ref:`evap_pet_ambav1_water_area_daily`:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-08-01&quot;, &quot;2000-08-02&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.wland_wag import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nu(3)</span>
<span class="sd">        &gt;&gt;&gt; at(1.0)</span>
<span class="sd">        &gt;&gt;&gt; aur(0.5, 0.3, 0.2)</span>
<span class="sd">        &gt;&gt;&gt; lt(FIELD, DECIDIOUS, WATER)</span>
<span class="sd">        &gt;&gt;&gt; lai(5.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.nul.update()</span>
<span class="sd">        &gt;&gt;&gt; inputs.t = 15.0</span>
<span class="sd">        &gt;&gt;&gt; inputs.p = 0.0</span>
<span class="sd">        &gt;&gt;&gt; states.sp = 0.0, 1.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import prepare_model</span>
<span class="sd">        &gt;&gt;&gt; with model.add_petmodel_v2(&quot;evap_pet_ambav1&quot;) as ambav:</span>
<span class="sd">        ...     measuringheightwindspeed(10.0)</span>
<span class="sd">        ...     leafalbedo(0.2)</span>
<span class="sd">        ...     leafalbedosnow(0.8)</span>
<span class="sd">        ...     groundalbedo(0.2)</span>
<span class="sd">        ...     groundalbedosnow(0.8)</span>
<span class="sd">        ...     cropheight.field = 10.0</span>
<span class="sd">        ...     cropheight.decidious = 10.0</span>
<span class="sd">        ...     cropheight.water = 0.0</span>
<span class="sd">        ...     leafresistance(40.0)</span>
<span class="sd">        ...     wetsoilresistance(100.0)</span>
<span class="sd">        ...     soilresistanceincrease(1.0)</span>
<span class="sd">        ...     wetnessthreshold(0.5)</span>
<span class="sd">        ...     cloudtypefactor(0.2)</span>
<span class="sd">        ...     nightcloudfactor(1.0)</span>
<span class="sd">        ...     inputs.windspeed = 2.0</span>
<span class="sd">        ...     inputs.relativehumidity = 80.0</span>
<span class="sd">        ...     inputs.atmosphericpressure = 1000.0</span>
<span class="sd">        ...     states.soilresistance = 100.0</span>
<span class="sd">        ...     with model.add_radiationmodel_v4(&quot;meteo_psun_sun_glob_io&quot;):</span>
<span class="sd">        ...         inputs.sunshineduration = 6.0</span>
<span class="sd">        ...         inputs.possiblesunshineduration = 16.0</span>
<span class="sd">        ...         inputs.globalradiation = 190.0</span>

<span class="sd">        The first example reproduces the results for the first simulated day of the</span>
<span class="sd">        integration tests :ref:`evap_pet_ambav1_vegetation_daily` (first response</span>
<span class="sd">        unit) and :ref:`evap_pet_ambav1_water_area_daily` (third response unit):</span>

<span class="sd">        &gt;&gt;&gt; ambav.sequences.logs.loggedprecipitation = [0.0]</span>
<span class="sd">        &gt;&gt;&gt; ambav.sequences.logs.loggedpotentialsoilevapotranspiration = [1.0]</span>
<span class="sd">        &gt;&gt;&gt; model.calc_pe_pet_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.pe</span>
<span class="sd">        pe(3.301949, 1.146759, 1.890672)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.pet</span>
<span class="sd">        pet(2.292368, 0.796134, 0.0)</span>

<span class="sd">        The second example reproduces the results for the third simulated day of the</span>
<span class="sd">        :ref:`evap_pet_ambav1_snow_daily` integration test (second response unit):</span>

<span class="sd">        &gt;&gt;&gt; ambav.sequences.logs.loggedprecipitation = [10.0]</span>
<span class="sd">        &gt;&gt;&gt; ambav.sequences.logs.loggedpotentialsoilevapotranspiration = [2.282495]</span>
<span class="sd">        &gt;&gt;&gt; model.calc_pe_pet_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.pe</span>
<span class="sd">        pe(3.301949, 1.146759, 1.890672)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.pet</span>
<span class="sd">        pet(2.324763, 0.807385, 0.0)</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_derived</span><span class="o">.</span><span class="n">NUL</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_fluxes</span><span class="o">.</span><span class="n">PE</span><span class="p">,</span> <span class="n">wland_fluxes</span><span class="o">.</span><span class="n">PET</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">submodel</span><span class="p">:</span> <span class="n">petinterfaces</span><span class="o">.</span><span class="n">PETModel_V2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">submodel</span><span class="o">.</span><span class="n">determine_potentialinterceptionevaporation</span><span class="p">()</span>
        <span class="n">submodel</span><span class="o">.</span><span class="n">determine_potentialsoilevapotranspiration</span><span class="p">()</span>
        <span class="n">submodel</span><span class="o">.</span><span class="n">determine_potentialwaterevaporation</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">nul</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">pe</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">submodel</span><span class="o">.</span><span class="n">get_potentialinterceptionevaporation</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">pet</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">submodel</span><span class="o">.</span><span class="n">get_potentialsoilevapotranspiration</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">pe</span><span class="p">[</span><span class="n">der</span><span class="o">.</span><span class="n">nul</span><span class="p">]</span> <span class="o">=</span> <span class="n">submodel</span><span class="o">.</span><span class="n">get_potentialwaterevaporation</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">nul</span><span class="p">)</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">pet</span><span class="p">[</span><span class="n">der</span><span class="o">.</span><span class="n">nul</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_PE_PET_V1">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Calc_PE_PET_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_PE_PET_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Let a submodel that complies with the |PETModel_V1| or |PETModel_V2| interface</span>
<span class="sd">    calculate the potential evapotranspiration of the land areas and the potential</span>
<span class="sd">    evaporation of the surface water storage.&quot;&quot;&quot;</span>

    <span class="n">SUBMODELINTERFACES</span> <span class="o">=</span> <span class="p">(</span><span class="n">petinterfaces</span><span class="o">.</span><span class="n">PETModel_V1</span><span class="p">,</span> <span class="n">petinterfaces</span><span class="o">.</span><span class="n">PETModel_V2</span><span class="p">)</span>
    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Calc_PE_PET_PETModel_V1</span><span class="p">,</span> <span class="n">Calc_PE_PET_PETModel_V2</span><span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_derived</span><span class="o">.</span><span class="n">NUL</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_fluxes</span><span class="o">.</span><span class="n">PE</span><span class="p">,</span> <span class="n">wland_fluxes</span><span class="o">.</span><span class="n">PET</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">petmodel_typeid</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">calc_pe_pet_petmodel_v1</span><span class="p">(</span>
                <span class="n">cast</span><span class="p">(</span><span class="n">petinterfaces</span><span class="o">.</span><span class="n">PETModel_V1</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">petmodel</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">model</span><span class="o">.</span><span class="n">petmodel_typeid</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">calc_pe_pet_petmodel_v2</span><span class="p">(</span>
                <span class="n">cast</span><span class="p">(</span><span class="n">petinterfaces</span><span class="o">.</span><span class="n">PETModel_V2</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">petmodel</span><span class="p">)</span>
            <span class="p">)</span></div>

        <span class="c1"># ToDo:</span>
        <span class="c1">#     else:</span>
        <span class="c1">#         assert_never(model.petmodel)</span>


<div class="viewcode-block" id="Calc_TF_V1">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Calc_TF_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_TF_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the total amount of throughfall of the land areas.</span>

<span class="sd">    Basic equation (discontinuous):</span>
<span class="sd">      .. math::</span>
<span class="sd">        TF = \begin{cases}</span>
<span class="sd">        P &amp;|\ IC &gt; IT</span>
<span class="sd">        \\</span>
<span class="sd">        0 &amp;|\ IC &lt; IT</span>
<span class="sd">        \end{cases}</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub, UnitTest</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &#39;2000-03-30&#39;, &#39;2000-04-03&#39;, &#39;1d&#39;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.wland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nu(2)</span>
<span class="sd">        &gt;&gt;&gt; lt(FIELD, WATER)</span>
<span class="sd">        &gt;&gt;&gt; ih(0.2)</span>
<span class="sd">        &gt;&gt;&gt; lai.field_mar = 5.0</span>
<span class="sd">        &gt;&gt;&gt; lai.field_apr = 10.0</span>
<span class="sd">        &gt;&gt;&gt; derived.moy.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.nul.update()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.pc = 5.0</span>
<span class="sd">        &gt;&gt;&gt; test = UnitTest(</span>
<span class="sd">        ...     model=model,</span>
<span class="sd">        ...     method=model.calc_tf_v1,</span>
<span class="sd">        ...     last_example=6,</span>
<span class="sd">        ...     parseqs=(states.ic, fluxes.tf),</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; test.nexts.ic = -4.0, 0.0, 1.0, 2.0, 3.0, 7.0</span>

<span class="sd">        Without smoothing:</span>

<span class="sd">        &gt;&gt;&gt; sh(0.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.rh1.update()</span>
<span class="sd">        &gt;&gt;&gt; model.idx_sim = pub.timegrids.init[&#39;2000-03-31&#39;]</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. |         ic |       tf |</span>
<span class="sd">        -------------------------------</span>
<span class="sd">        |   1 | -4.0  -4.0 | 0.0  0.0 |</span>
<span class="sd">        |   2 |  0.0   0.0 | 0.0  0.0 |</span>
<span class="sd">        |   3 |  1.0   1.0 | 2.5  0.0 |</span>
<span class="sd">        |   4 |  2.0   2.0 | 5.0  0.0 |</span>
<span class="sd">        |   5 |  3.0   3.0 | 5.0  0.0 |</span>
<span class="sd">        |   6 |  7.0   7.0 | 5.0  0.0 |</span>

<span class="sd">        With smoothing:</span>

<span class="sd">        &gt;&gt;&gt; sh(1.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.rh1.update()</span>
<span class="sd">        &gt;&gt;&gt; model.idx_sim = pub.timegrids.init[&#39;2000-04-01&#39;]</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. |         ic |           tf |</span>
<span class="sd">        -----------------------------------</span>
<span class="sd">        |   1 | -4.0  -4.0 |     0.0  0.0 |</span>
<span class="sd">        |   2 |  0.0   0.0 | 0.00051  0.0 |</span>
<span class="sd">        |   3 |  1.0   1.0 |    0.05  0.0 |</span>
<span class="sd">        |   4 |  2.0   2.0 |     2.5  0.0 |</span>
<span class="sd">        |   5 |  3.0   3.0 |    4.95  0.0 |</span>
<span class="sd">        |   6 |  7.0   7.0 |     5.0  0.0 |</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_control</span><span class="o">.</span><span class="n">LT</span><span class="p">,</span> <span class="n">wland_control</span><span class="o">.</span><span class="n">LAI</span><span class="p">,</span> <span class="n">wland_control</span><span class="o">.</span><span class="n">IH</span><span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_derived</span><span class="o">.</span><span class="n">MOY</span><span class="p">,</span> <span class="n">wland_derived</span><span class="o">.</span><span class="n">NUL</span><span class="p">,</span> <span class="n">wland_derived</span><span class="o">.</span><span class="n">RH1</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_fluxes</span><span class="o">.</span><span class="n">PC</span><span class="p">,</span> <span class="n">wland_states</span><span class="o">.</span><span class="n">IC</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_fluxes</span><span class="o">.</span><span class="n">TF</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">nul</span><span class="p">):</span>
            <span class="n">lai</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">lai</span><span class="p">[</span><span class="n">con</span><span class="o">.</span><span class="n">lt</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">SEALED</span><span class="p">,</span> <span class="n">der</span><span class="o">.</span><span class="n">moy</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">idx_sim</span><span class="p">]]</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">tf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">pc</span> <span class="o">*</span> <span class="n">smoothutils</span><span class="o">.</span><span class="n">smooth_logistic1</span><span class="p">(</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">ic</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">ih</span> <span class="o">*</span> <span class="n">lai</span><span class="p">,</span> <span class="n">der</span><span class="o">.</span><span class="n">rh1</span>
            <span class="p">)</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">tf</span><span class="p">[</span><span class="n">der</span><span class="o">.</span><span class="n">nul</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_EI_V1">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Calc_EI_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_EI_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the interception evaporation of the land areas.</span>

<span class="sd">    Basic equation (discontinuous):</span>
<span class="sd">      .. math::</span>
<span class="sd">        EI = \begin{cases}</span>
<span class="sd">        PE &amp;|\ IC &gt; 0</span>
<span class="sd">        \\</span>
<span class="sd">        0 &amp;|\ IC &lt; 0</span>
<span class="sd">        \end{cases}</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.wland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nu(2)</span>
<span class="sd">        &gt;&gt;&gt; derived.nul.update()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.pe = 5.0</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import UnitTest</span>
<span class="sd">        &gt;&gt;&gt; test = UnitTest(</span>
<span class="sd">        ...     model=model,</span>
<span class="sd">        ...     method=model.calc_ei_v1,</span>
<span class="sd">        ...     last_example=9,</span>
<span class="sd">        ...     parseqs=(states.ic, fluxes.ei)</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; test.nexts.ic = -4.0, -3.0, -2.0, -1.0, 0.0, 1.0, 2.0, 3.0, 4.0</span>

<span class="sd">        Without smoothing:</span>

<span class="sd">        &gt;&gt;&gt; sh(0.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.rh1.update()</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. |         ic |       ei |</span>
<span class="sd">        -------------------------------</span>
<span class="sd">        |   1 | -4.0  -4.0 | 0.0  0.0 |</span>
<span class="sd">        |   2 | -3.0  -3.0 | 0.0  0.0 |</span>
<span class="sd">        |   3 | -2.0  -2.0 | 0.0  0.0 |</span>
<span class="sd">        |   4 | -1.0  -1.0 | 0.0  0.0 |</span>
<span class="sd">        |   5 |  0.0   0.0 | 2.5  0.0 |</span>
<span class="sd">        |   6 |  1.0   1.0 | 5.0  0.0 |</span>
<span class="sd">        |   7 |  2.0   2.0 | 5.0  0.0 |</span>
<span class="sd">        |   8 |  3.0   3.0 | 5.0  0.0 |</span>
<span class="sd">        |   9 |  4.0   4.0 | 5.0  0.0 |</span>


<span class="sd">        With smoothing:</span>

<span class="sd">        &gt;&gt;&gt; sh(1.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.rh1.update()</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. |         ic |            ei |</span>
<span class="sd">        ------------------------------------</span>
<span class="sd">        |   1 | -4.0  -4.0 |      0.0  0.0 |</span>
<span class="sd">        |   2 | -3.0  -3.0 | 0.000005  0.0 |</span>
<span class="sd">        |   3 | -2.0  -2.0 |  0.00051  0.0 |</span>
<span class="sd">        |   4 | -1.0  -1.0 |     0.05  0.0 |</span>
<span class="sd">        |   5 |  0.0   0.0 |      2.5  0.0 |</span>
<span class="sd">        |   6 |  1.0   1.0 |     4.95  0.0 |</span>
<span class="sd">        |   7 |  2.0   2.0 |  4.99949  0.0 |</span>
<span class="sd">        |   8 |  3.0   3.0 | 4.999995  0.0 |</span>
<span class="sd">        |   9 |  4.0   4.0 |      5.0  0.0 |</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_derived</span><span class="o">.</span><span class="n">NUL</span><span class="p">,</span> <span class="n">wland_derived</span><span class="o">.</span><span class="n">RH1</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_fluxes</span><span class="o">.</span><span class="n">PE</span><span class="p">,</span> <span class="n">wland_states</span><span class="o">.</span><span class="n">IC</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_fluxes</span><span class="o">.</span><span class="n">EI</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">nul</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">ei</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">pe</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">smoothutils</span><span class="o">.</span><span class="n">smooth_logistic1</span><span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">ic</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">der</span><span class="o">.</span><span class="n">rh1</span><span class="p">))</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">ei</span><span class="p">[</span><span class="n">der</span><span class="o">.</span><span class="n">nul</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_FR_V1">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Calc_FR_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_FR_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Determine the fraction between rainfall and total precipitation.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`FR = \frac{T- \left( TT - TI / 2 \right)}{TI}`</span>

<span class="sd">    Restriction:</span>
<span class="sd">      :math:`0 \leq FR \leq 1`</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.wland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; tt(1.0)</span>
<span class="sd">        &gt;&gt;&gt; ti(4.0)</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import UnitTest</span>
<span class="sd">        &gt;&gt;&gt; test = UnitTest(</span>
<span class="sd">        ...     model=model,</span>
<span class="sd">        ...     method=model.calc_fr_v1,</span>
<span class="sd">        ...     last_example=9,</span>
<span class="sd">        ...     parseqs=(inputs.t, aides.fr)</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; test.nexts.t = -3.0, -2.0, -1.0, 0.0, 1.0, 2.0, 3.0, 4.0, 5.0</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. |    t |   fr |</span>
<span class="sd">        ---------------------</span>
<span class="sd">        |   1 | -3.0 |  0.0 |</span>
<span class="sd">        |   2 | -2.0 |  0.0 |</span>
<span class="sd">        |   3 | -1.0 |  0.0 |</span>
<span class="sd">        |   4 |  0.0 | 0.25 |</span>
<span class="sd">        |   5 |  1.0 |  0.5 |</span>
<span class="sd">        |   6 |  2.0 | 0.75 |</span>
<span class="sd">        |   7 |  3.0 |  1.0 |</span>
<span class="sd">        |   8 |  4.0 |  1.0 |</span>
<span class="sd">        |   9 |  5.0 |  1.0 |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_control</span><span class="o">.</span><span class="n">TT</span><span class="p">,</span> <span class="n">wland_control</span><span class="o">.</span><span class="n">TI</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_inputs</span><span class="o">.</span><span class="n">T</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_aides</span><span class="o">.</span><span class="n">FR</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">if</span> <span class="n">inp</span><span class="o">.</span><span class="n">t</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">tt</span> <span class="o">+</span> <span class="n">con</span><span class="o">.</span><span class="n">ti</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">):</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">fr</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">elif</span> <span class="n">inp</span><span class="o">.</span><span class="n">t</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">tt</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">ti</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">):</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">fr</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">fr</span> <span class="o">=</span> <span class="p">(</span><span class="n">inp</span><span class="o">.</span><span class="n">t</span> <span class="o">-</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">tt</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">ti</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">))</span> <span class="o">/</span> <span class="n">con</span><span class="o">.</span><span class="n">ti</span></div>



<div class="viewcode-block" id="Calc_RF_V1">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Calc_RF_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_RF_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the liquid amount of throughfall (rainfall) of the land areas.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`RF = FR \cdot TF`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.wland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nu(2)</span>
<span class="sd">        &gt;&gt;&gt; derived.nul.update()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tf = 2.0</span>
<span class="sd">        &gt;&gt;&gt; aides.fr = 0.8</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rf_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.rf</span>
<span class="sd">        rf(1.6, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_derived</span><span class="o">.</span><span class="n">NUL</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_fluxes</span><span class="o">.</span><span class="n">TF</span><span class="p">,</span> <span class="n">wland_aides</span><span class="o">.</span><span class="n">FR</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_fluxes</span><span class="o">.</span><span class="n">RF</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">nul</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">rf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">aid</span><span class="o">.</span><span class="n">fr</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">tf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">rf</span><span class="p">[</span><span class="n">der</span><span class="o">.</span><span class="n">nul</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_SF_V1">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Calc_SF_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_SF_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the frozen amount of throughfall (snowfall) of the land areas.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`SF = (1-FR) \cdot TF`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.wland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nu(2)</span>
<span class="sd">        &gt;&gt;&gt; derived.nul.update()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tf = 2.0</span>
<span class="sd">        &gt;&gt;&gt; aides.fr = 0.8</span>
<span class="sd">        &gt;&gt;&gt; model.calc_sf_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.sf</span>
<span class="sd">        sf(0.4, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_derived</span><span class="o">.</span><span class="n">NUL</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_fluxes</span><span class="o">.</span><span class="n">TF</span><span class="p">,</span> <span class="n">wland_aides</span><span class="o">.</span><span class="n">FR</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_fluxes</span><span class="o">.</span><span class="n">SF</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">nul</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">sf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">aid</span><span class="o">.</span><span class="n">fr</span><span class="p">)</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">tf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">sf</span><span class="p">[</span><span class="n">der</span><span class="o">.</span><span class="n">nul</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_PM_V1">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Calc_PM_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_PM_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the potential snowmelt of the land areas.</span>

<span class="sd">    Basic equation (discontinous):</span>
<span class="sd">      :math:`PM = max \left( DDF \cdot (T - DDT), 0 \right)`</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.wland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nu(2)</span>
<span class="sd">        &gt;&gt;&gt; derived.nul.update()</span>
<span class="sd">        &gt;&gt;&gt; ddf(4.0)</span>
<span class="sd">        &gt;&gt;&gt; ddt(1.0)</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import UnitTest</span>
<span class="sd">        &gt;&gt;&gt; test = UnitTest(</span>
<span class="sd">        ...     model=model,</span>
<span class="sd">        ...     method=model.calc_pm_v1,</span>
<span class="sd">        ...     last_example=11,</span>
<span class="sd">        ...     parseqs=(inputs.t, fluxes.pm)</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; test.nexts.t = -4.0, -3.0, -2.0, -1.0, 0.0, 1.0, 2.0, 3.0, 4.0, 5.0, 6.0</span>

<span class="sd">        Without smoothing:</span>

<span class="sd">        &gt;&gt;&gt; st(0.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.rt2.update()</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. |    t |        pm |</span>
<span class="sd">        --------------------------</span>
<span class="sd">        |   1 | -4.0 |  0.0  0.0 |</span>
<span class="sd">        |   2 | -3.0 |  0.0  0.0 |</span>
<span class="sd">        |   3 | -2.0 |  0.0  0.0 |</span>
<span class="sd">        |   4 | -1.0 |  0.0  0.0 |</span>
<span class="sd">        |   5 |  0.0 |  0.0  0.0 |</span>
<span class="sd">        |   6 |  1.0 |  0.0  0.0 |</span>
<span class="sd">        |   7 |  2.0 |  2.0  0.0 |</span>
<span class="sd">        |   8 |  3.0 |  4.0  0.0 |</span>
<span class="sd">        |   9 |  4.0 |  6.0  0.0 |</span>
<span class="sd">        |  10 |  5.0 |  8.0  0.0 |</span>
<span class="sd">        |  11 |  6.0 | 10.0  0.0 |</span>

<span class="sd">        With smoothing:</span>

<span class="sd">        &gt;&gt;&gt; st(1.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.rt2.update()</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. |    t |            pm |</span>
<span class="sd">        ------------------------------</span>
<span class="sd">        |   1 | -4.0 |      0.0  0.0 |</span>
<span class="sd">        |   2 | -3.0 | 0.000001  0.0 |</span>
<span class="sd">        |   3 | -2.0 | 0.000024  0.0 |</span>
<span class="sd">        |   4 | -1.0 | 0.000697  0.0 |</span>
<span class="sd">        |   5 |  0.0 |     0.02  0.0 |</span>
<span class="sd">        |   6 |  1.0 | 0.411048  0.0 |</span>
<span class="sd">        |   7 |  2.0 |     2.02  0.0 |</span>
<span class="sd">        |   8 |  3.0 | 4.000697  0.0 |</span>
<span class="sd">        |   9 |  4.0 | 6.000024  0.0 |</span>
<span class="sd">        |  10 |  5.0 | 8.000001  0.0 |</span>
<span class="sd">        |  11 |  6.0 |     10.0  0.0 |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_control</span><span class="o">.</span><span class="n">DDF</span><span class="p">,</span> <span class="n">wland_control</span><span class="o">.</span><span class="n">DDT</span><span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_derived</span><span class="o">.</span><span class="n">NUL</span><span class="p">,</span> <span class="n">wland_derived</span><span class="o">.</span><span class="n">RT2</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_inputs</span><span class="o">.</span><span class="n">T</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_fluxes</span><span class="o">.</span><span class="n">PM</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">nul</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">pm</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">ddf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">smoothutils</span><span class="o">.</span><span class="n">smooth_logistic2</span><span class="p">(</span>
                <span class="n">inp</span><span class="o">.</span><span class="n">t</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">ddt</span><span class="p">,</span> <span class="n">der</span><span class="o">.</span><span class="n">rt2</span>
            <span class="p">)</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">pm</span><span class="p">[</span><span class="n">der</span><span class="o">.</span><span class="n">nul</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_AM_V1">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Calc_AM_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_AM_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the actual snowmelt of the land areas.</span>

<span class="sd">    Basic equation (discontinous):</span>
<span class="sd">      .. math::</span>
<span class="sd">        AM = \begin{cases}</span>
<span class="sd">        PM &amp;|\ SP &gt; 0</span>
<span class="sd">        \\</span>
<span class="sd">        0 &amp;|\ SP &lt; 0</span>
<span class="sd">        \end{cases}</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.wland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nu(2)</span>
<span class="sd">        &gt;&gt;&gt; derived.nul.update()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.pm = 2.0</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import UnitTest</span>
<span class="sd">        &gt;&gt;&gt; test = UnitTest(</span>
<span class="sd">        ...     model=model,</span>
<span class="sd">        ...     method=model.calc_am_v1,</span>
<span class="sd">        ...     last_example=9,</span>
<span class="sd">        ...     parseqs=(states.sp, fluxes.am)</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; test.nexts.sp = -4.0, -3.0, -2.0, -1.0, 0.0, 1.0, 2.0, 3.0, 4.0</span>

<span class="sd">        Without smoothing:</span>

<span class="sd">        &gt;&gt;&gt; sh(0.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.rh1.update()</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. |         sp |       am |</span>
<span class="sd">        -------------------------------</span>
<span class="sd">        |   1 | -4.0  -4.0 | 0.0  0.0 |</span>
<span class="sd">        |   2 | -3.0  -3.0 | 0.0  0.0 |</span>
<span class="sd">        |   3 | -2.0  -2.0 | 0.0  0.0 |</span>
<span class="sd">        |   4 | -1.0  -1.0 | 0.0  0.0 |</span>
<span class="sd">        |   5 |  0.0   0.0 | 1.0  0.0 |</span>
<span class="sd">        |   6 |  1.0   1.0 | 2.0  0.0 |</span>
<span class="sd">        |   7 |  2.0   2.0 | 2.0  0.0 |</span>
<span class="sd">        |   8 |  3.0   3.0 | 2.0  0.0 |</span>
<span class="sd">        |   9 |  4.0   4.0 | 2.0  0.0 |</span>

<span class="sd">        With smoothing:</span>

<span class="sd">        &gt;&gt;&gt; sh(1.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.rh1.update()</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. |         sp |            am |</span>
<span class="sd">        ------------------------------------</span>
<span class="sd">        |   1 | -4.0  -4.0 |      0.0  0.0 |</span>
<span class="sd">        |   2 | -3.0  -3.0 | 0.000002  0.0 |</span>
<span class="sd">        |   3 | -2.0  -2.0 | 0.000204  0.0 |</span>
<span class="sd">        |   4 | -1.0  -1.0 |     0.02  0.0 |</span>
<span class="sd">        |   5 |  0.0   0.0 |      1.0  0.0 |</span>
<span class="sd">        |   6 |  1.0   1.0 |     1.98  0.0 |</span>
<span class="sd">        |   7 |  2.0   2.0 | 1.999796  0.0 |</span>
<span class="sd">        |   8 |  3.0   3.0 | 1.999998  0.0 |</span>
<span class="sd">        |   9 |  4.0   4.0 |      2.0  0.0 |</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_derived</span><span class="o">.</span><span class="n">NUL</span><span class="p">,</span> <span class="n">wland_derived</span><span class="o">.</span><span class="n">RH1</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_fluxes</span><span class="o">.</span><span class="n">PM</span><span class="p">,</span> <span class="n">wland_states</span><span class="o">.</span><span class="n">SP</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_fluxes</span><span class="o">.</span><span class="n">AM</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">nul</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">am</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">pm</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">smoothutils</span><span class="o">.</span><span class="n">smooth_logistic1</span><span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">sp</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">der</span><span class="o">.</span><span class="n">rh1</span><span class="p">)</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">am</span><span class="p">[</span><span class="n">der</span><span class="o">.</span><span class="n">nul</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_PS_V1">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Calc_PS_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_PS_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the precipitation entering the surface water reservoir.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`PS = PC`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.wland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.pc = 3.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_ps_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.ps</span>
<span class="sd">        ps(3.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_fluxes</span><span class="o">.</span><span class="n">PC</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_fluxes</span><span class="o">.</span><span class="n">PS</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">ps</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">pc</span></div>



<div class="viewcode-block" id="Calc_WE_W_V1">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Calc_WE_W_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_WE_W_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the wetness index for the elevated and the lowland regions.</span>

<span class="sd">    Basic equation for the lowland region (the elevated region is handled analogous):</span>
<span class="sd">      :math:`W = cos \left(</span>
<span class="sd">      \frac{min \big( max(DV, \, 0), \, CW \big) \cdot Pi}{CW} \right)</span>
<span class="sd">      \cdot \frac{1}{2} + \frac{1}{2}`</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.wland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; cwe(200.0)</span>
<span class="sd">        &gt;&gt;&gt; cw(400.0)</span>

<span class="sd">        &gt;&gt;&gt; derived.nuge(1)</span>
<span class="sd">        &gt;&gt;&gt; derived.nug(1)</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import UnitTest</span>
<span class="sd">        &gt;&gt;&gt; test = UnitTest(</span>
<span class="sd">        ...     model=model,</span>
<span class="sd">        ...     method=model.calc_we_w_v1,</span>
<span class="sd">        ...     last_example=11,</span>
<span class="sd">        ...     parseqs=(states.dve, states.dv, aides.we, aides.w)</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; test.nexts.dve = (</span>
<span class="sd">        ...     -50.0, -5.0, 0.0, 5.0, 50.0, 100.0, 150.0, 195.0, 200.0, 205.0, 250.0)</span>
<span class="sd">        &gt;&gt;&gt; test.nexts.dv = tuple(dv + 100.0 for dv in test.nexts.dve)</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. |   dve |    dv |       we |        w |</span>
<span class="sd">        ---------------------------------------------</span>
<span class="sd">        |   1 | -50.0 |  50.0 |      1.0 |  0.96194 |</span>
<span class="sd">        |   2 |  -5.0 |  95.0 |      1.0 | 0.867161 |</span>
<span class="sd">        |   3 |   0.0 | 100.0 |      1.0 | 0.853553 |</span>
<span class="sd">        |   4 |   5.0 | 105.0 | 0.998459 |   0.8394 |</span>
<span class="sd">        |   5 |  50.0 | 150.0 | 0.853553 | 0.691342 |</span>
<span class="sd">        |   6 | 100.0 | 200.0 |      0.5 |      0.5 |</span>
<span class="sd">        |   7 | 150.0 | 250.0 | 0.146447 | 0.308658 |</span>
<span class="sd">        |   8 | 195.0 | 295.0 | 0.001541 |   0.1606 |</span>
<span class="sd">        |   9 | 200.0 | 300.0 |      0.0 | 0.146447 |</span>
<span class="sd">        |  10 | 205.0 | 305.0 |      0.0 | 0.132839 |</span>
<span class="sd">        |  11 | 250.0 | 350.0 |      0.0 |  0.03806 |</span>

<span class="sd">        &gt;&gt;&gt; derived.nuge(0)</span>
<span class="sd">        &gt;&gt;&gt; derived.nug(0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_we_w_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.we</span>
<span class="sd">        we(nan)</span>
<span class="sd">        &gt;&gt;&gt; aides.w</span>
<span class="sd">        w(nan)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_control</span><span class="o">.</span><span class="n">CWE</span><span class="p">,</span> <span class="n">wland_control</span><span class="o">.</span><span class="n">CW</span><span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_derived</span><span class="o">.</span><span class="n">NUGE</span><span class="p">,</span> <span class="n">wland_derived</span><span class="o">.</span><span class="n">NUG</span><span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_fixed</span><span class="o">.</span><span class="n">Pi</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_states</span><span class="o">.</span><span class="n">DVE</span><span class="p">,</span> <span class="n">wland_states</span><span class="o">.</span><span class="n">DV</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_aides</span><span class="o">.</span><span class="n">WE</span><span class="p">,</span> <span class="n">wland_aides</span><span class="o">.</span><span class="n">W</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">if</span> <span class="n">der</span><span class="o">.</span><span class="n">nuge</span><span class="p">:</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">we</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span>
                <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">dve</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="n">con</span><span class="o">.</span><span class="n">cwe</span><span class="p">)</span> <span class="o">*</span> <span class="n">fix</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">con</span><span class="o">.</span><span class="n">cwe</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">we</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">if</span> <span class="n">der</span><span class="o">.</span><span class="n">nug</span><span class="p">:</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span>
                <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">dv</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="n">con</span><span class="o">.</span><span class="n">cw</span><span class="p">)</span> <span class="o">*</span> <span class="n">fix</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">con</span><span class="o">.</span><span class="n">cw</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">nan</span></div>



<div class="viewcode-block" id="Calc_PVE_PV_V1">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Calc_PVE_PV_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_PVE_PV_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the rainfall (and snowmelt) entering the vadose zone in the elevated</span>
<span class="sd">    and lowland regions.</span>

<span class="sd">    Basic equation for the lowland region (the elevated region is handled analogous):</span>
<span class="sd">      .. math::</span>
<span class="sd">        PV = \sum_{i=1}^{NUL} \left ( \frac{AUR_i}{AGR} \cdot (RF_i + AM_i) \cdot</span>
<span class="sd">        \begin{cases}</span>
<span class="sd">        0 &amp;|\ LT_i = SEALED</span>
<span class="sd">        \\</span>
<span class="sd">        1-W &amp;|\ LT_i \neq SEALED</span>
<span class="sd">        \end{cases}  \right )</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.wland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nu(4)</span>
<span class="sd">        &gt;&gt;&gt; derived.nul.update()</span>
<span class="sd">        &gt;&gt;&gt; lt(FIELD, SOIL, SEALED, WATER)</span>
<span class="sd">        &gt;&gt;&gt; aur(0.35, 0.1, 0.05, 0.5)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.rf = 3.0, 2.0, 1.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.am = 1.0, 2.0, 3.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; aides.we = 0.75</span>
<span class="sd">        &gt;&gt;&gt; aides.w = 0.25</span>

<span class="sd">        &gt;&gt;&gt; er(True)</span>
<span class="sd">        &gt;&gt;&gt; derived.agre.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.agr.update()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_pve_pv_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.pve</span>
<span class="sd">        pve(1.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.pv</span>
<span class="sd">        pv(0.0)</span>

<span class="sd">        &gt;&gt;&gt; er(False)</span>
<span class="sd">        &gt;&gt;&gt; derived.agre.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.agr.update()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_pve_pv_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.pve</span>
<span class="sd">        pve(0.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.pv</span>
<span class="sd">        pv(3.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_control</span><span class="o">.</span><span class="n">LT</span><span class="p">,</span> <span class="n">wland_control</span><span class="o">.</span><span class="n">ER</span><span class="p">,</span> <span class="n">wland_control</span><span class="o">.</span><span class="n">AUR</span><span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_derived</span><span class="o">.</span><span class="n">NUL</span><span class="p">,</span> <span class="n">wland_derived</span><span class="o">.</span><span class="n">AGRE</span><span class="p">,</span> <span class="n">wland_derived</span><span class="o">.</span><span class="n">AGR</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">wland_fluxes</span><span class="o">.</span><span class="n">RF</span><span class="p">,</span>
        <span class="n">wland_fluxes</span><span class="o">.</span><span class="n">AM</span><span class="p">,</span>
        <span class="n">wland_aides</span><span class="o">.</span><span class="n">WE</span><span class="p">,</span>
        <span class="n">wland_aides</span><span class="o">.</span><span class="n">W</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_fluxes</span><span class="o">.</span><span class="n">PVE</span><span class="p">,</span> <span class="n">wland_fluxes</span><span class="o">.</span><span class="n">PV</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">pve</span><span class="p">,</span> <span class="n">flu</span><span class="o">.</span><span class="n">pv</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">nul</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lt</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">!=</span> <span class="n">SEALED</span><span class="p">:</span>
                <span class="n">p</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">rf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">am</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">er</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">pve</span> <span class="o">+=</span> <span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">aid</span><span class="o">.</span><span class="n">we</span><span class="p">)</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">aur</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">der</span><span class="o">.</span><span class="n">agre</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">pv</span> <span class="o">+=</span> <span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">aid</span><span class="o">.</span><span class="n">w</span><span class="p">)</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">aur</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">der</span><span class="o">.</span><span class="n">agr</span></div>



<div class="viewcode-block" id="Calc_PQ_V1">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Calc_PQ_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_PQ_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the rainfall (and snowmelt) entering the quickflow reservoir.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      .. math::</span>
<span class="sd">        PQ = \sum_{i=1}^{NUL} \frac{AUR_i}{ALR} \cdot (RF_i + AM_i) \cdot</span>
<span class="sd">        \begin{cases}</span>
<span class="sd">        1 &amp;|\ LT_i = SEALED</span>
<span class="sd">        \\</span>
<span class="sd">        WE &amp;|\ LT_i \neq SEALED \ \land \ ER_i</span>
<span class="sd">        \\</span>
<span class="sd">        W &amp;|\ LT_i \neq SEALED \ \land \ \overline{ER_i}</span>
<span class="sd">        \end{cases}</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.wland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nu(4)</span>
<span class="sd">        &gt;&gt;&gt; lt(FIELD, SOIL, SEALED, WATER)</span>
<span class="sd">        &gt;&gt;&gt; aur(0.3, 0.15, 0.05, 0.5)</span>
<span class="sd">        &gt;&gt;&gt; derived.nul.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.alr.update()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.rf = 3.0, 2.0, 1.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.am = 1.0, 2.0, 2.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; aides.w = 0.75</span>
<span class="sd">        &gt;&gt;&gt; model.calc_pq_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.pq</span>
<span class="sd">        pq(3.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_control</span><span class="o">.</span><span class="n">LT</span><span class="p">,</span> <span class="n">wland_control</span><span class="o">.</span><span class="n">ER</span><span class="p">,</span> <span class="n">wland_control</span><span class="o">.</span><span class="n">AUR</span><span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_derived</span><span class="o">.</span><span class="n">NUL</span><span class="p">,</span> <span class="n">wland_derived</span><span class="o">.</span><span class="n">ALR</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">wland_fluxes</span><span class="o">.</span><span class="n">RF</span><span class="p">,</span>
        <span class="n">wland_fluxes</span><span class="o">.</span><span class="n">AM</span><span class="p">,</span>
        <span class="n">wland_aides</span><span class="o">.</span><span class="n">WE</span><span class="p">,</span>
        <span class="n">wland_aides</span><span class="o">.</span><span class="n">W</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_fluxes</span><span class="o">.</span><span class="n">PQ</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">pq</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">nul</span><span class="p">):</span>
            <span class="n">pq</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">aur</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">der</span><span class="o">.</span><span class="n">alr</span> <span class="o">*</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">rf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">am</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">lt</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">!=</span> <span class="n">SEALED</span><span class="p">:</span>
                <span class="n">pq</span> <span class="o">*=</span> <span class="n">aid</span><span class="o">.</span><span class="n">we</span> <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">er</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">else</span> <span class="n">aid</span><span class="o">.</span><span class="n">w</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">pq</span> <span class="o">+=</span> <span class="n">pq</span></div>



<div class="viewcode-block" id="Calc_BetaE_Beta_V1">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Calc_BetaE_Beta_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_BetaE_Beta_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the evapotranspiration reduction factor for the elevated and lowland</span>
<span class="sd">    regions.</span>

<span class="sd">    Basic equation for the lowland region (the elevated region is handled analogous):</span>
<span class="sd">      :math:`Beta = \frac{1 - x}{1 + x} \cdot \frac{1}{2} + \frac{1}{2}`</span>

<span class="sd">      :math:`x = exp \left( Zeta1 \cdot (DV - Zeta2) \right)`</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.wland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; zeta1(0.02)</span>
<span class="sd">        &gt;&gt;&gt; zeta2(400.0)</span>

<span class="sd">        &gt;&gt;&gt; derived.nuge(1)</span>
<span class="sd">        &gt;&gt;&gt; derived.nug(1)</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import UnitTest</span>
<span class="sd">        &gt;&gt;&gt; test = UnitTest(</span>
<span class="sd">        ...     model=model,</span>
<span class="sd">        ...     method=model.calc_betae_beta_v1,</span>
<span class="sd">        ...     last_example=12,</span>
<span class="sd">        ...     parseqs=(states.dve, states.dv, aides.betae, aides.beta)</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; test.nexts.dve = (</span>
<span class="sd">        ...     -100.0, 0.0, 100.0, 200.0, 300.0, 400.0,</span>
<span class="sd">        ...     500.0, 600.0, 700.0, 800.0, 900.0, 100000.0</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; test.nexts.dv = tuple(reversed(test.nexts.dve))</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. |      dve |       dv |    betae |     beta |</span>
<span class="sd">        ---------------------------------------------------</span>
<span class="sd">        |   1 |   -100.0 | 100000.0 | 0.999955 |      0.0 |</span>
<span class="sd">        |   2 |      0.0 |    900.0 | 0.999665 | 0.000045 |</span>
<span class="sd">        |   3 |    100.0 |    800.0 | 0.997527 | 0.000335 |</span>
<span class="sd">        |   4 |    200.0 |    700.0 | 0.982014 | 0.002473 |</span>
<span class="sd">        |   5 |    300.0 |    600.0 | 0.880797 | 0.017986 |</span>
<span class="sd">        |   6 |    400.0 |    500.0 |      0.5 | 0.119203 |</span>
<span class="sd">        |   7 |    500.0 |    400.0 | 0.119203 |      0.5 |</span>
<span class="sd">        |   8 |    600.0 |    300.0 | 0.017986 | 0.880797 |</span>
<span class="sd">        |   9 |    700.0 |    200.0 | 0.002473 | 0.982014 |</span>
<span class="sd">        |  10 |    800.0 |    100.0 | 0.000335 | 0.997527 |</span>
<span class="sd">        |  11 |    900.0 |      0.0 | 0.000045 | 0.999665 |</span>
<span class="sd">        |  12 | 100000.0 |   -100.0 |      0.0 | 0.999955 |</span>

<span class="sd">        &gt;&gt;&gt; derived.nuge(0)</span>
<span class="sd">        &gt;&gt;&gt; derived.nug(0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_betae_beta_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.betae</span>
<span class="sd">        betae(nan)</span>
<span class="sd">        &gt;&gt;&gt; aides.beta</span>
<span class="sd">        beta(nan)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_control</span><span class="o">.</span><span class="n">Zeta1</span><span class="p">,</span> <span class="n">wland_control</span><span class="o">.</span><span class="n">Zeta2</span><span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_derived</span><span class="o">.</span><span class="n">NUGE</span><span class="p">,</span> <span class="n">wland_derived</span><span class="o">.</span><span class="n">NUG</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_states</span><span class="o">.</span><span class="n">DVE</span><span class="p">,</span> <span class="n">wland_states</span><span class="o">.</span><span class="n">DV</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_aides</span><span class="o">.</span><span class="n">BetaE</span><span class="p">,</span> <span class="n">wland_aides</span><span class="o">.</span><span class="n">Beta</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>

        <span class="k">if</span> <span class="n">der</span><span class="o">.</span><span class="n">nuge</span><span class="p">:</span>
            <span class="n">temp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">zeta1</span> <span class="o">*</span> <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">dve</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">zeta2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">temp</span> <span class="o">&gt;</span> <span class="mf">700.0</span><span class="p">:</span>
                <span class="n">aid</span><span class="o">.</span><span class="n">betae</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">temp</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
                <span class="n">aid</span><span class="o">.</span><span class="n">betae</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">temp</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">temp</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">betae</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">nan</span>

        <span class="k">if</span> <span class="n">der</span><span class="o">.</span><span class="n">nug</span><span class="p">:</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">zeta1</span> <span class="o">*</span> <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">dv</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">zeta2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">temp</span> <span class="o">&gt;</span> <span class="mf">700.0</span><span class="p">:</span>
                <span class="n">aid</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">temp</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
                <span class="n">aid</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">temp</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">temp</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">nan</span></div>



<div class="viewcode-block" id="Calc_ETVE_ETV_V1">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Calc_ETVE_ETV_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_ETVE_ETV_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the actual evapotranspiration from the elevated and lowland regions&#39;</span>
<span class="sd">    vadose zone.</span>

<span class="sd">    The following equation uses the :cite:t:`ref-Wigmosta1994` approach to extend the</span>
<span class="sd">    original WALRUS equation to cope with different potential values for |PE| and |PET|.</span>
<span class="sd">    (See the documentation on method |evap_model.Update_SoilEvapotranspiration_V3|,</span>
<span class="sd">    which covers the corner cases of this approach in more detail.)</span>

<span class="sd">    Basic equation for the lowland region (the elevated region is handled analogous):</span>
<span class="sd">      .. math::</span>
<span class="sd">        ETV = \sum_{i=1}^{NUL} \frac{AUR_i}{AGR} \cdot</span>
<span class="sd">        \frac{PE_i - EI_i}{PE_i} \cdot PET_i \cdot</span>
<span class="sd">        \begin{cases}</span>
<span class="sd">        0 &amp;|\ LT_i = SEALED</span>
<span class="sd">        \\</span>
<span class="sd">        Beta  &amp;|\ LT_i \neq SEALED</span>
<span class="sd">        \end{cases}</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.wland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nu(4)</span>
<span class="sd">        &gt;&gt;&gt; lt(FIELD, SOIL, SEALED, WATER)</span>
<span class="sd">        &gt;&gt;&gt; aur(0.2, 0.2, 0.1, 0.5)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.pe = 5.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.pet = 4.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.ei = 1.0, 3.0, 2.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; aides.betae = 0.75</span>
<span class="sd">        &gt;&gt;&gt; aides.beta = 0.25</span>
<span class="sd">        &gt;&gt;&gt; derived.nul.update()</span>

<span class="sd">        &gt;&gt;&gt; er(True)</span>
<span class="sd">        &gt;&gt;&gt; derived.agr.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.agre.update()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_etve_etv_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.etve</span>
<span class="sd">        etve(1.8)</span>

<span class="sd">        &gt;&gt;&gt; er(False)</span>
<span class="sd">        &gt;&gt;&gt; derived.agr.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.agre.update()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_etve_etv_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.etv</span>
<span class="sd">        etv(0.6)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_control</span><span class="o">.</span><span class="n">LT</span><span class="p">,</span> <span class="n">wland_control</span><span class="o">.</span><span class="n">ER</span><span class="p">,</span> <span class="n">wland_control</span><span class="o">.</span><span class="n">AUR</span><span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_derived</span><span class="o">.</span><span class="n">NUL</span><span class="p">,</span> <span class="n">wland_derived</span><span class="o">.</span><span class="n">AGRE</span><span class="p">,</span> <span class="n">wland_derived</span><span class="o">.</span><span class="n">AGR</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">wland_fluxes</span><span class="o">.</span><span class="n">PE</span><span class="p">,</span>
        <span class="n">wland_fluxes</span><span class="o">.</span><span class="n">PET</span><span class="p">,</span>
        <span class="n">wland_fluxes</span><span class="o">.</span><span class="n">EI</span><span class="p">,</span>
        <span class="n">wland_aides</span><span class="o">.</span><span class="n">BetaE</span><span class="p">,</span>
        <span class="n">wland_aides</span><span class="o">.</span><span class="n">Beta</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_fluxes</span><span class="o">.</span><span class="n">ETVE</span><span class="p">,</span> <span class="n">wland_fluxes</span><span class="o">.</span><span class="n">ETV</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">etve</span><span class="p">,</span> <span class="n">flu</span><span class="o">.</span><span class="n">etv</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">nul</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">lt</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">!=</span> <span class="n">SEALED</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">pe</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">):</span>
                <span class="n">pet</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">pe</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">ei</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">/</span> <span class="n">flu</span><span class="o">.</span><span class="n">pe</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">pet</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">er</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">etve</span> <span class="o">+=</span> <span class="n">con</span><span class="o">.</span><span class="n">aur</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">der</span><span class="o">.</span><span class="n">agre</span> <span class="o">*</span> <span class="n">pet</span> <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">betae</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">flu</span><span class="o">.</span><span class="n">etv</span> <span class="o">+=</span> <span class="n">con</span><span class="o">.</span><span class="n">aur</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">der</span><span class="o">.</span><span class="n">agr</span> <span class="o">*</span> <span class="n">pet</span> <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">beta</span></div>



<div class="viewcode-block" id="Calc_ES_V1">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Calc_ES_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_ES_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the actual evaporation from the surface water reservoir.</span>

<span class="sd">    Basic equation (discontinous):</span>
<span class="sd">      .. math::</span>
<span class="sd">        ES = \begin{cases}</span>
<span class="sd">        PE &amp;|\ HS &gt; 0</span>
<span class="sd">        \\</span>
<span class="sd">        0 &amp;|\ HS \leq 0</span>
<span class="sd">        \end{cases}</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.wland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nu(2)</span>
<span class="sd">        &gt;&gt;&gt; derived.nul.update()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.pe = 3.0, 5.0</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import UnitTest</span>
<span class="sd">        &gt;&gt;&gt; test = UnitTest(</span>
<span class="sd">        ...     model=model,</span>
<span class="sd">        ...     method=model.calc_es_v1,</span>
<span class="sd">        ...     last_example=9,</span>
<span class="sd">        ...     parseqs=(states.hs, fluxes.es)</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; test.nexts.hs = -4.0, -3.0, -2.0, -1.0, 0.0, 1.0, 2.0, 3.0, 4.0</span>

<span class="sd">        Without smoothing:</span>

<span class="sd">        &gt;&gt;&gt; sh(0.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.rh1.update()</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. |   hs |  es |</span>
<span class="sd">        --------------------</span>
<span class="sd">        |   1 | -4.0 | 0.0 |</span>
<span class="sd">        |   2 | -3.0 | 0.0 |</span>
<span class="sd">        |   3 | -2.0 | 0.0 |</span>
<span class="sd">        |   4 | -1.0 | 0.0 |</span>
<span class="sd">        |   5 |  0.0 | 2.5 |</span>
<span class="sd">        |   6 |  1.0 | 5.0 |</span>
<span class="sd">        |   7 |  2.0 | 5.0 |</span>
<span class="sd">        |   8 |  3.0 | 5.0 |</span>
<span class="sd">        |   9 |  4.0 | 5.0 |</span>

<span class="sd">        With smoothing:</span>

<span class="sd">        &gt;&gt;&gt; sh(1.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.rh1.update()</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. |   hs |       es |</span>
<span class="sd">        -------------------------</span>
<span class="sd">        |   1 | -4.0 |      0.0 |</span>
<span class="sd">        |   2 | -3.0 | 0.000005 |</span>
<span class="sd">        |   3 | -2.0 |  0.00051 |</span>
<span class="sd">        |   4 | -1.0 |     0.05 |</span>
<span class="sd">        |   5 |  0.0 |      2.5 |</span>
<span class="sd">        |   6 |  1.0 |     4.95 |</span>
<span class="sd">        |   7 |  2.0 |  4.99949 |</span>
<span class="sd">        |   8 |  3.0 | 4.999995 |</span>
<span class="sd">        |   9 |  4.0 |      5.0 |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_derived</span><span class="o">.</span><span class="n">NUL</span><span class="p">,</span> <span class="n">wland_derived</span><span class="o">.</span><span class="n">RH1</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_fluxes</span><span class="o">.</span><span class="n">PE</span><span class="p">,</span> <span class="n">wland_states</span><span class="o">.</span><span class="n">HS</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_fluxes</span><span class="o">.</span><span class="n">ES</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">es</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">pe</span><span class="p">[</span><span class="n">der</span><span class="o">.</span><span class="n">nul</span><span class="p">]</span> <span class="o">*</span> <span class="n">smoothutils</span><span class="o">.</span><span class="n">smooth_logistic1</span><span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">hs</span><span class="p">,</span> <span class="n">der</span><span class="o">.</span><span class="n">rh1</span><span class="p">)</span></div>



<div class="viewcode-block" id="Calc_ET_V1">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Calc_ET_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_ET_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the total actual evapotranspiration.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`ET = ASR \cdot ES + AGRE \cdot ETV\!E + AGR \cdot ETV +</span>
<span class="sd">      \sum_{i=1}^{NUL} AUR_i \cdot EI_i`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.wland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nu(3)</span>
<span class="sd">        &gt;&gt;&gt; lt(FIELD, SEALED, WATER)</span>
<span class="sd">        &gt;&gt;&gt; aur(0.5, 0.3, 0.2)</span>
<span class="sd">        &gt;&gt;&gt; er(False)</span>
<span class="sd">        &gt;&gt;&gt; derived.nul.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.asr.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.agr.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.agre.update()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.ei = 1.0, 2.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.etv = 3.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.etve = 5.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.es = 4.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_et_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.et</span>
<span class="sd">        et(3.4)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_control</span><span class="o">.</span><span class="n">AUR</span><span class="p">,)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">wland_derived</span><span class="o">.</span><span class="n">NUL</span><span class="p">,</span>
        <span class="n">wland_derived</span><span class="o">.</span><span class="n">ASR</span><span class="p">,</span>
        <span class="n">wland_derived</span><span class="o">.</span><span class="n">AGRE</span><span class="p">,</span>
        <span class="n">wland_derived</span><span class="o">.</span><span class="n">AGR</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">wland_fluxes</span><span class="o">.</span><span class="n">EI</span><span class="p">,</span>
        <span class="n">wland_fluxes</span><span class="o">.</span><span class="n">ETVE</span><span class="p">,</span>
        <span class="n">wland_fluxes</span><span class="o">.</span><span class="n">ETV</span><span class="p">,</span>
        <span class="n">wland_fluxes</span><span class="o">.</span><span class="n">ES</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_fluxes</span><span class="o">.</span><span class="n">ET</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">ei</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">nul</span><span class="p">):</span>
            <span class="n">ei</span> <span class="o">+=</span> <span class="n">con</span><span class="o">.</span><span class="n">aur</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">ei</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">et</span> <span class="o">=</span> <span class="n">ei</span> <span class="o">+</span> <span class="n">der</span><span class="o">.</span><span class="n">agre</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">etve</span> <span class="o">+</span> <span class="n">der</span><span class="o">.</span><span class="n">agr</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">etv</span> <span class="o">+</span> <span class="n">der</span><span class="o">.</span><span class="n">asr</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">es</span></div>



<div class="viewcode-block" id="Calc_DVEq_V1">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Calc_DVEq_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_DVEq_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the equilibrium storage deficit of the vadose zone.</span>

<span class="sd">    Basic equation (discontinuous):</span>
<span class="sd">      .. math::</span>
<span class="sd">        DV\!Eq = \begin{cases}</span>
<span class="sd">          0 &amp;|\ DG \leq PsiAE</span>
<span class="sd">          \\</span>
<span class="sd">          ThetaS \cdot \left( DG - \frac{DG^{1-1/b}}{(1-1/b) \cdot PsiAE^{-1/B}} -</span>
<span class="sd">          \frac{PsiAE}{1-B} \right) &amp;|\ PsiAE &lt; DG</span>
<span class="sd">        \end{cases}</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.wland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; thetas(0.4)</span>
<span class="sd">        &gt;&gt;&gt; psiae(300.0)</span>
<span class="sd">        &gt;&gt;&gt; b(5.0)</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import UnitTest</span>
<span class="sd">        &gt;&gt;&gt; test = UnitTest(</span>
<span class="sd">        ...     model=model,</span>
<span class="sd">        ...     method=model.calc_dveq_v1,</span>
<span class="sd">        ...     last_example=6,</span>
<span class="sd">        ...     parseqs=(states.dg, aides.dveq)</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; test.nexts.dg = 200.0, 300.0, 400.0, 800.0, 1600.0, 3200.0</span>

<span class="sd">        Without smoothing:</span>

<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. |     dg |       dveq |</span>
<span class="sd">        -----------------------------</span>
<span class="sd">        |   1 |  200.0 |        0.0 |</span>
<span class="sd">        |   2 |  300.0 |        0.0 |</span>
<span class="sd">        |   3 |  400.0 |   1.182498 |</span>
<span class="sd">        |   4 |  800.0 |  21.249634 |</span>
<span class="sd">        |   5 | 1600.0 |  97.612368 |</span>
<span class="sd">        |   6 | 3200.0 | 313.415248 |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_control</span><span class="o">.</span><span class="n">ThetaS</span><span class="p">,</span> <span class="n">wland_control</span><span class="o">.</span><span class="n">PsiAE</span><span class="p">,</span> <span class="n">wland_control</span><span class="o">.</span><span class="n">B</span><span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_derived</span><span class="o">.</span><span class="n">NUG</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_states</span><span class="o">.</span><span class="n">DG</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_aides</span><span class="o">.</span><span class="n">DVEq</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">if</span> <span class="n">der</span><span class="o">.</span><span class="n">nug</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">dg</span> <span class="o">&lt;</span> <span class="n">con</span><span class="o">.</span><span class="n">psiae</span><span class="p">:</span>
                <span class="n">aid</span><span class="o">.</span><span class="n">dveq</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">aid</span><span class="o">.</span><span class="n">dveq</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">thetas</span> <span class="o">*</span> <span class="p">(</span>
                    <span class="n">sta</span><span class="o">.</span><span class="n">dg</span>
                    <span class="o">-</span> <span class="n">sta</span><span class="o">.</span><span class="n">dg</span> <span class="o">**</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">con</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>
                    <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">con</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>
                    <span class="o">/</span> <span class="n">con</span><span class="o">.</span><span class="n">psiae</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">con</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>
                    <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">psiae</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">dveq</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">nan</span></div>



<div class="viewcode-block" id="Return_DVH_V1">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Return_DVH_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Return_DVH_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Return the storage deficit of the vadose zone at a specific height above</span>
<span class="sd">    the groundwater table.</span>

<span class="sd">    Basic equation (discontinous):</span>
<span class="sd">      .. math::</span>
<span class="sd">        DVH = \begin{cases}</span>
<span class="sd">          0 &amp;|\ DG \leq PsiAE</span>
<span class="sd">          \\</span>
<span class="sd">          ThetaS \cdot \left(1 - \left( \frac{h}{PsiAE} \right)^{-1/b} \right)</span>
<span class="sd">          &amp;|\ PsiAE &lt; DG</span>
<span class="sd">        \end{cases}</span>

<span class="sd">    This power law is the differential of the equation underlying method</span>
<span class="sd">    |Calc_DVEq_V1| with respect to height.  :cite:t:`ref-Brauer2014` also cites it</span>
<span class="sd">    (equation 6) but does not use it directly.</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.wland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; thetas(0.4)</span>
<span class="sd">        &gt;&gt;&gt; psiae(300.0)</span>
<span class="sd">        &gt;&gt;&gt; b(5.0)</span>

<span class="sd">        With smoothing:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import repr_</span>
<span class="sd">        &gt;&gt;&gt; sh(0.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.rh1.update()</span>
<span class="sd">        &gt;&gt;&gt; for h in [200.0, 299.0, 300.0, 301.0, 400.0, 500.0, 600.0]:</span>
<span class="sd">        ...     print(repr_(h), repr_(model.return_dvh_v1(h)))</span>
<span class="sd">        200.0 0.0</span>
<span class="sd">        299.0 0.0</span>
<span class="sd">        300.0 0.0</span>
<span class="sd">        301.0 0.000266</span>
<span class="sd">        400.0 0.022365</span>
<span class="sd">        500.0 0.038848</span>
<span class="sd">        600.0 0.05178</span>

<span class="sd">        Without smoothing:</span>

<span class="sd">        &gt;&gt;&gt; sh(1.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.rh1.update()</span>
<span class="sd">        &gt;&gt;&gt; for h in [200.0, 299.0, 300.0, 301.0, 400.0, 500.0, 600.0]:</span>
<span class="sd">        ...     print(repr_(h), repr_(model.return_dvh_v1(h)))</span>
<span class="sd">        200.0 0.0</span>
<span class="sd">        299.0 0.000001</span>
<span class="sd">        300.0 0.00004</span>
<span class="sd">        301.0 0.000267</span>
<span class="sd">        400.0 0.022365</span>
<span class="sd">        500.0 0.038848</span>
<span class="sd">        600.0 0.05178</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_control</span><span class="o">.</span><span class="n">ThetaS</span><span class="p">,</span> <span class="n">wland_control</span><span class="o">.</span><span class="n">PsiAE</span><span class="p">,</span> <span class="n">wland_control</span><span class="o">.</span><span class="n">B</span><span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_derived</span><span class="o">.</span><span class="n">RH1</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">h</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">smoothutils</span><span class="o">.</span><span class="n">smooth_max1</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">con</span><span class="o">.</span><span class="n">psiae</span><span class="p">,</span> <span class="n">der</span><span class="o">.</span><span class="n">rh1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">con</span><span class="o">.</span><span class="n">thetas</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span><span class="n">h</span> <span class="o">/</span> <span class="n">con</span><span class="o">.</span><span class="n">psiae</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">con</span><span class="o">.</span><span class="n">b</span><span class="p">))</span></div>



<div class="viewcode-block" id="Calc_DVEq_V2">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Calc_DVEq_V2">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_DVEq_V2</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the equilibrium storage deficit of the vadose zone.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`DHEq = \int_{0}^{DG} Return\_DVH\_V1(h) \ \ dh`</span>

<span class="sd">    Method |Calc_DVEq_V2| integrates |Return_DVH_V1| numerically, based on the</span>
<span class="sd">    Lobatto-Gau quadrature.  Hence, it should give nearly identical results as</span>
<span class="sd">    method |Calc_DVEq_V1|, which provides the analytical solution to the underlying</span>
<span class="sd">    power law. The benefit of method |Calc_DVEq_V2| is that it supports the</span>
<span class="sd">    regularisation of |Return_DVH_V1|, which |Calc_DVEq_V1| does not.  In our</span>
<span class="sd">    experience, this benefit does not justify the additional numerical cost.</span>
<span class="sd">    However, we keep it for educational purposes, mainly as a starting point to</span>
<span class="sd">    implement alternative relationships between the soil water deficit and the</span>
<span class="sd">    groundwater table that we cannot solve analytically.</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.wland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; derived.nug(0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_dveq_v2()</span>
<span class="sd">        &gt;&gt;&gt; aides.dveq</span>
<span class="sd">        dveq(nan)</span>

<span class="sd">        &gt;&gt;&gt; derived.nug(1)</span>
<span class="sd">        &gt;&gt;&gt; thetas(0.4)</span>
<span class="sd">        &gt;&gt;&gt; psiae(300.0)</span>
<span class="sd">        &gt;&gt;&gt; b(5.0)</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import UnitTest</span>
<span class="sd">        &gt;&gt;&gt; test = UnitTest(</span>
<span class="sd">        ...     model=model,</span>
<span class="sd">        ...     method=model.calc_dveq_v2,</span>
<span class="sd">        ...     last_example=8,</span>
<span class="sd">        ...     parseqs=(states.dg, aides.dveq)</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; test.nexts.dg = 200.0, 299.0, 300.0, 301.0, 400.0, 800.0, 1600.0, 3200.0</span>

<span class="sd">        Without smoothing:</span>

<span class="sd">        &gt;&gt;&gt; sh(0.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.rh1.update()</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. |     dg |       dveq |</span>
<span class="sd">        -----------------------------</span>
<span class="sd">        |   1 |  200.0 |        0.0 |</span>
<span class="sd">        |   2 |  299.0 |        0.0 |</span>
<span class="sd">        |   3 |  300.0 |        0.0 |</span>
<span class="sd">        |   4 |  301.0 |   0.000133 |</span>
<span class="sd">        |   5 |  400.0 |   1.182498 |</span>
<span class="sd">        |   6 |  800.0 |  21.249634 |</span>
<span class="sd">        |   7 | 1600.0 |  97.612368 |</span>
<span class="sd">        |   8 | 3200.0 | 313.415248 |</span>

<span class="sd">        With smoothing:</span>

<span class="sd">        &gt;&gt;&gt; sh(1.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.rh1.update()</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. |     dg |       dveq |</span>
<span class="sd">        -----------------------------</span>
<span class="sd">        |   1 |  200.0 |        0.0 |</span>
<span class="sd">        |   2 |  299.0 |        0.0 |</span>
<span class="sd">        |   3 |  300.0 |   0.000033 |</span>
<span class="sd">        |   4 |  301.0 |   0.000176 |</span>
<span class="sd">        |   5 |  400.0 |   1.182542 |</span>
<span class="sd">        |   6 |  800.0 |   21.24972 |</span>
<span class="sd">        |   7 | 1600.0 |  97.612538 |</span>
<span class="sd">        |   8 | 3200.0 | 313.415588 |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">wland_control</span><span class="o">.</span><span class="n">ThetaS</span><span class="p">,</span>
        <span class="n">wland_control</span><span class="o">.</span><span class="n">PsiAE</span><span class="p">,</span>
        <span class="n">wland_control</span><span class="o">.</span><span class="n">B</span><span class="p">,</span>
        <span class="n">wland_control</span><span class="o">.</span><span class="n">SH</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_derived</span><span class="o">.</span><span class="n">NUG</span><span class="p">,</span> <span class="n">wland_derived</span><span class="o">.</span><span class="n">RH1</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_states</span><span class="o">.</span><span class="n">DG</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_aides</span><span class="o">.</span><span class="n">DVEq</span><span class="p">,)</span>
    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Return_DVH_V1</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">if</span> <span class="n">der</span><span class="o">.</span><span class="n">nug</span><span class="p">:</span>
            <span class="n">x0</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mf">10.0</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">sh</span>
            <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">dg</span> <span class="o">&gt;</span> <span class="n">con</span><span class="o">.</span><span class="n">psiae</span><span class="p">:</span>
                <span class="n">t1</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">quaddveq_v1</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">con</span><span class="o">.</span><span class="n">psiae</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mf">1e-8</span><span class="p">)</span>
                <span class="n">t2</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">quaddveq_v1</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">psiae</span><span class="p">,</span> <span class="n">sta</span><span class="o">.</span><span class="n">dg</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mf">1e-8</span><span class="p">)</span>
                <span class="n">aid</span><span class="o">.</span><span class="n">dveq</span> <span class="o">=</span> <span class="n">t1</span> <span class="o">+</span> <span class="n">t2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">aid</span><span class="o">.</span><span class="n">dveq</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">quaddveq_v1</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">sta</span><span class="o">.</span><span class="n">dg</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mf">1e-8</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">dveq</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">nan</span></div>



<div class="viewcode-block" id="Calc_DVEq_V3">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Calc_DVEq_V3">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_DVEq_V3</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the equilibrium storage deficit of the vadose zone.</span>

<span class="sd">    Basic equation (discontinuous):</span>
<span class="sd">      .. math::</span>
<span class="sd">        DHEq = ThetaR \cdot DG + \begin{cases}</span>
<span class="sd">          0 &amp;|\ DG \leq PsiAE</span>
<span class="sd">          \\</span>
<span class="sd">          ThetaS \cdot \left( DG - \frac{DG^{1-1/b}}{(1-1/b) \cdot PsiAE^{-1/B}} -</span>
<span class="sd">          \frac{PsiAE}{1-B} \right) &amp;|\ PsiAE &lt; DG</span>
<span class="sd">        \end{cases}</span>

<span class="sd">    Method |Calc_DVEq_V3| extends the original `WALRUS`_ relationship between the</span>
<span class="sd">    groundwater depth and the equilibrium water deficit of the vadose zone defined</span>
<span class="sd">    by equation 5 of :cite:t:`ref-Brauer2014` and implemented into application model</span>
<span class="sd">    |wland| by method |Calc_DVEq_V1|.  Parameter |ThetaR| introduces a (small)</span>
<span class="sd">    amount of water to fill the tension-saturated area directly above the groundwater</span>
<span class="sd">    table.  This &quot;residual saturation&quot; allows the direct injection of water into</span>
<span class="sd">    groundwater without risking infinitely fast groundwater depth changes.</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.wland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; thetas(0.4)</span>
<span class="sd">        &gt;&gt;&gt; thetar(0.01)</span>
<span class="sd">        &gt;&gt;&gt; psiae(300.0)</span>
<span class="sd">        &gt;&gt;&gt; b(5.0)</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import UnitTest</span>
<span class="sd">        &gt;&gt;&gt; test = UnitTest(</span>
<span class="sd">        ...     model=model,</span>
<span class="sd">        ...     method=model.calc_dveq_v3,</span>
<span class="sd">        ...     last_example=8,</span>
<span class="sd">        ...     parseqs=(states.dg, aides.dveq)</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; test.nexts.dg = 200.0, 299.0, 300.0, 301.0, 400.0, 800.0, 1600.0, 3200.0</span>

<span class="sd">        Without smoothing:</span>

<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. |     dg |       dveq |</span>
<span class="sd">        -----------------------------</span>
<span class="sd">        |   1 |  200.0 |        2.0 |</span>
<span class="sd">        |   2 |  299.0 |       2.99 |</span>
<span class="sd">        |   3 |  300.0 |        3.0 |</span>
<span class="sd">        |   4 |  301.0 |    3.01013 |</span>
<span class="sd">        |   5 |  400.0 |   5.152935 |</span>
<span class="sd">        |   6 |  800.0 |  28.718393 |</span>
<span class="sd">        |   7 | 1600.0 | 111.172058 |</span>
<span class="sd">        |   8 | 3200.0 | 337.579867 |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">wland_control</span><span class="o">.</span><span class="n">ThetaS</span><span class="p">,</span>
        <span class="n">wland_control</span><span class="o">.</span><span class="n">ThetaR</span><span class="p">,</span>
        <span class="n">wland_control</span><span class="o">.</span><span class="n">PsiAE</span><span class="p">,</span>
        <span class="n">wland_control</span><span class="o">.</span><span class="n">B</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_derived</span><span class="o">.</span><span class="n">NUG</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_states</span><span class="o">.</span><span class="n">DG</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_aides</span><span class="o">.</span><span class="n">DVEq</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">if</span> <span class="n">der</span><span class="o">.</span><span class="n">nug</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">dg</span> <span class="o">&lt;</span> <span class="n">con</span><span class="o">.</span><span class="n">psiae</span><span class="p">:</span>
                <span class="n">aid</span><span class="o">.</span><span class="n">dveq</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">thetar</span> <span class="o">*</span> <span class="n">sta</span><span class="o">.</span><span class="n">dg</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">aid</span><span class="o">.</span><span class="n">dveq</span> <span class="o">=</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">thetas</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">thetar</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
                    <span class="n">sta</span><span class="o">.</span><span class="n">dg</span>
                    <span class="o">-</span> <span class="n">sta</span><span class="o">.</span><span class="n">dg</span> <span class="o">**</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">con</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>
                    <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">con</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>
                    <span class="o">/</span> <span class="n">con</span><span class="o">.</span><span class="n">psiae</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">con</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>
                    <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">psiae</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>
                <span class="p">)</span> <span class="o">+</span> <span class="n">con</span><span class="o">.</span><span class="n">thetar</span> <span class="o">*</span> <span class="n">sta</span><span class="o">.</span><span class="n">dg</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">dveq</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">nan</span></div>



<div class="viewcode-block" id="Return_DVH_V2">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Return_DVH_V2">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Return_DVH_V2</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Return the storage deficit of the vadose zone at a specific height above</span>
<span class="sd">    the groundwater table.</span>

<span class="sd">    Basic equation (discontinous):</span>
<span class="sd">      .. math::</span>
<span class="sd">        DVH = ThetaR + \begin{cases}</span>
<span class="sd">          0 &amp;|\ DG \leq PsiAE</span>
<span class="sd">          \\</span>
<span class="sd">          (ThetaS-ThetaR) \cdot \left(1 - \left( \frac{h}{PsiAE} \right)^{-1/b} \right)</span>
<span class="sd">          &amp;|\ PsiAE &lt; DG</span>
<span class="sd">        \end{cases}</span>

<span class="sd">    The given equation is the differential of the equation underlying method</span>
<span class="sd">    |Calc_DVEq_V3| with respect to height.</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.wland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; thetas(0.4)</span>
<span class="sd">        &gt;&gt;&gt; thetar(0.01)</span>
<span class="sd">        &gt;&gt;&gt; psiae(300.0)</span>
<span class="sd">        &gt;&gt;&gt; b(5.0)</span>

<span class="sd">        With smoothing:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import repr_</span>
<span class="sd">        &gt;&gt;&gt; sh(0.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.rh1.update()</span>
<span class="sd">        &gt;&gt;&gt; for h in [200.0, 299.0, 300.0, 301.0, 400.0, 500.0, 600.0]:</span>
<span class="sd">        ...     print(repr_(h), repr_(model.return_dvh_v2(h)))</span>
<span class="sd">        200.0 0.01</span>
<span class="sd">        299.0 0.01</span>
<span class="sd">        300.0 0.01</span>
<span class="sd">        301.0 0.010259</span>
<span class="sd">        400.0 0.031806</span>
<span class="sd">        500.0 0.047877</span>
<span class="sd">        600.0 0.060485</span>

<span class="sd">        Without smoothing:</span>

<span class="sd">        &gt;&gt;&gt; sh(1.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.rh1.update()</span>
<span class="sd">        &gt;&gt;&gt; for h in [200.0, 299.0, 300.0, 301.0, 400.0, 500.0, 600.0]:</span>
<span class="sd">        ...     print(repr_(h), repr_(model.return_dvh_v2(h)))</span>
<span class="sd">        200.0 0.01</span>
<span class="sd">        299.0 0.010001</span>
<span class="sd">        300.0 0.010039</span>
<span class="sd">        301.0 0.01026</span>
<span class="sd">        400.0 0.031806</span>
<span class="sd">        500.0 0.047877</span>
<span class="sd">        600.0 0.060485</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">wland_control</span><span class="o">.</span><span class="n">ThetaS</span><span class="p">,</span>
        <span class="n">wland_control</span><span class="o">.</span><span class="n">ThetaR</span><span class="p">,</span>
        <span class="n">wland_control</span><span class="o">.</span><span class="n">PsiAE</span><span class="p">,</span>
        <span class="n">wland_control</span><span class="o">.</span><span class="n">B</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_derived</span><span class="o">.</span><span class="n">RH1</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">h</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">smoothutils</span><span class="o">.</span><span class="n">smooth_max1</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">con</span><span class="o">.</span><span class="n">psiae</span><span class="p">,</span> <span class="n">der</span><span class="o">.</span><span class="n">rh1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">con</span><span class="o">.</span><span class="n">thetar</span> <span class="o">+</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">thetas</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">thetar</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span><span class="n">h</span> <span class="o">/</span> <span class="n">con</span><span class="o">.</span><span class="n">psiae</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">con</span><span class="o">.</span><span class="n">b</span><span class="p">))</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="Calc_DVEq_V4">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Calc_DVEq_V4">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_DVEq_V4</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the equilibrium storage deficit of the vadose zone.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`DHEq = \int_{0}^{DG} Return\_DVH\_V2(h) \ \ dh`</span>

<span class="sd">    Method |Calc_DVEq_V4| integrates |Return_DVH_V2| numerically based on the</span>
<span class="sd">    Lobatto-Gau quadrature.  The short discussion in the documentation on</span>
<span class="sd">    |Calc_DVEq_V2| (which integrates |Return_DVH_V1|) also applies to |Calc_DVEq_V4|.</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.wland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; derived.nug(0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_dveq_v4()</span>
<span class="sd">        &gt;&gt;&gt; aides.dveq</span>
<span class="sd">        dveq(nan)</span>

<span class="sd">        &gt;&gt;&gt; derived.nug(1)</span>
<span class="sd">        &gt;&gt;&gt; thetas(0.4)</span>
<span class="sd">        &gt;&gt;&gt; thetar(0.01)</span>
<span class="sd">        &gt;&gt;&gt; psiae(300.0)</span>
<span class="sd">        &gt;&gt;&gt; b(5.0)</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import UnitTest</span>
<span class="sd">        &gt;&gt;&gt; test = UnitTest(</span>
<span class="sd">        ...     model=model,</span>
<span class="sd">        ...     method=model.calc_dveq_v4,</span>
<span class="sd">        ...     last_example=8,</span>
<span class="sd">        ...     parseqs=(states.dg, aides.dveq)</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; test.nexts.dg = 200.0, 299.0, 300.0, 301.0, 400.0, 800.0, 1600.0, 3200.0</span>

<span class="sd">        Without smoothing:</span>

<span class="sd">        &gt;&gt;&gt; sh(0.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.rh1.update()</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. |     dg |       dveq |</span>
<span class="sd">        -----------------------------</span>
<span class="sd">        |   1 |  200.0 |        2.0 |</span>
<span class="sd">        |   2 |  299.0 |       2.99 |</span>
<span class="sd">        |   3 |  300.0 |        3.0 |</span>
<span class="sd">        |   4 |  301.0 |    3.01013 |</span>
<span class="sd">        |   5 |  400.0 |   5.152935 |</span>
<span class="sd">        |   6 |  800.0 |  28.718393 |</span>
<span class="sd">        |   7 | 1600.0 | 111.172058 |</span>
<span class="sd">        |   8 | 3200.0 | 337.579867 |</span>

<span class="sd">        With smoothing:</span>

<span class="sd">        &gt;&gt;&gt; sh(1.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.rh1.update()</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. |     dg |       dveq |</span>
<span class="sd">        -----------------------------</span>
<span class="sd">        |   1 |  200.0 |        2.1 |</span>
<span class="sd">        |   2 |  299.0 |       3.09 |</span>
<span class="sd">        |   3 |  300.0 |   3.100032 |</span>
<span class="sd">        |   4 |  301.0 |   3.110172 |</span>
<span class="sd">        |   5 |  400.0 |   5.252979 |</span>
<span class="sd">        |   6 |  800.0 |  28.818477 |</span>
<span class="sd">        |   7 | 1600.0 | 111.272224 |</span>
<span class="sd">        |   8 | 3200.0 | 337.680198 |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">wland_control</span><span class="o">.</span><span class="n">ThetaS</span><span class="p">,</span>
        <span class="n">wland_control</span><span class="o">.</span><span class="n">ThetaR</span><span class="p">,</span>
        <span class="n">wland_control</span><span class="o">.</span><span class="n">PsiAE</span><span class="p">,</span>
        <span class="n">wland_control</span><span class="o">.</span><span class="n">B</span><span class="p">,</span>
        <span class="n">wland_control</span><span class="o">.</span><span class="n">SH</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_derived</span><span class="o">.</span><span class="n">NUG</span><span class="p">,</span> <span class="n">wland_derived</span><span class="o">.</span><span class="n">RH1</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_states</span><span class="o">.</span><span class="n">DG</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_aides</span><span class="o">.</span><span class="n">DVEq</span><span class="p">,)</span>
    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Return_DVH_V2</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">if</span> <span class="n">der</span><span class="o">.</span><span class="n">nug</span><span class="p">:</span>
            <span class="n">x0</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mf">10.0</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">sh</span>
            <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">dg</span> <span class="o">&gt;</span> <span class="n">con</span><span class="o">.</span><span class="n">psiae</span><span class="p">:</span>
                <span class="n">t1</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">quaddveq_v2</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">con</span><span class="o">.</span><span class="n">psiae</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mf">1e-8</span><span class="p">)</span>
                <span class="n">t2</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">quaddveq_v2</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">psiae</span><span class="p">,</span> <span class="n">sta</span><span class="o">.</span><span class="n">dg</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mf">1e-8</span><span class="p">)</span>
                <span class="n">aid</span><span class="o">.</span><span class="n">dveq</span> <span class="o">=</span> <span class="n">t1</span> <span class="o">+</span> <span class="n">t2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">aid</span><span class="o">.</span><span class="n">dveq</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">quaddveq_v2</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">sta</span><span class="o">.</span><span class="n">dg</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mf">1e-8</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">dveq</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">nan</span></div>



<div class="viewcode-block" id="Return_ErrorDV_V1">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Return_ErrorDV_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Return_ErrorDV_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the difference between the equilibrium and the actual storage</span>
<span class="sd">    deficit of the vadose zone.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`DV\!Eq_{Calc\_DV\!Eq\_V3} - DV`</span>

<span class="sd">    Method |Return_ErrorDV_V1| uses |Calc_DVEq_V3| to calculate the equilibrium</span>
<span class="sd">    deficit corresponding to the current groundwater depth.  The following example</span>
<span class="sd">    shows that it resets the values |DG| and |DVEq|,  which it needs to change</span>
<span class="sd">    temporarily, to their original states.</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.wland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; thetas(0.4)</span>
<span class="sd">        &gt;&gt;&gt; thetar(0.01)</span>
<span class="sd">        &gt;&gt;&gt; psiae(300.0)</span>
<span class="sd">        &gt;&gt;&gt; b(5.0)</span>
<span class="sd">        &gt;&gt;&gt; states.dg = -9.0</span>
<span class="sd">        &gt;&gt;&gt; aides.dveq = -99.0</span>
<span class="sd">        &gt;&gt;&gt; states.dv = 3.152935</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_errordv_v1(400.0))</span>
<span class="sd">        2.0</span>
<span class="sd">        &gt;&gt;&gt; states.dg</span>
<span class="sd">        dg(-9.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.dveq</span>
<span class="sd">        dveq(-99.0)</span>

<span class="sd">    Technical checks:</span>

<span class="sd">        As mentioned above, method |Return_ErrorDV_V1| changes the values of the</span>
<span class="sd">        sequences |DG| and |DVEq|, but only temporarily.  Hence, we do not include</span>
<span class="sd">        them in the method specifications, even if the following check considers this</span>
<span class="sd">        erroneous:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.core.testtools import check_selectedvariables</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.wland.wland_model import Return_ErrorDV_V1</span>
<span class="sd">        &gt;&gt;&gt; print(check_selectedvariables(Return_ErrorDV_V1))</span>
<span class="sd">        Definitely missing: dg and dveq</span>
<span class="sd">        Possibly missing (REQUIREDSEQUENCES):</span>
<span class="sd">            Calc_DVEq_V3: DG</span>
<span class="sd">        Possibly missing (RESULTSEQUENCES):</span>
<span class="sd">            Calc_DVEq_V3: DVEq</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">wland_control</span><span class="o">.</span><span class="n">ThetaS</span><span class="p">,</span>
        <span class="n">wland_control</span><span class="o">.</span><span class="n">ThetaR</span><span class="p">,</span>
        <span class="n">wland_control</span><span class="o">.</span><span class="n">PsiAE</span><span class="p">,</span>
        <span class="n">wland_control</span><span class="o">.</span><span class="n">B</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_derived</span><span class="o">.</span><span class="n">NUG</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_states</span><span class="o">.</span><span class="n">DV</span><span class="p">,)</span>
    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Calc_DVEq_V3</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">dg</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">dveq_old</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">aid</span><span class="o">.</span><span class="n">dveq</span>
        <span class="n">dg_old</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">sta</span><span class="o">.</span><span class="n">dg</span>
        <span class="n">sta</span><span class="o">.</span><span class="n">dg</span> <span class="o">=</span> <span class="n">dg</span>
        <span class="n">model</span><span class="o">.</span><span class="n">calc_dveq_v3</span><span class="p">()</span>
        <span class="n">d_delta</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">aid</span><span class="o">.</span><span class="n">dveq</span> <span class="o">-</span> <span class="n">sta</span><span class="o">.</span><span class="n">dv</span>
        <span class="n">aid</span><span class="o">.</span><span class="n">dveq</span> <span class="o">=</span> <span class="n">dveq_old</span>
        <span class="n">sta</span><span class="o">.</span><span class="n">dg</span> <span class="o">=</span> <span class="n">dg_old</span>
        <span class="k">return</span> <span class="n">d_delta</span></div>



<div class="viewcode-block" id="Calc_DGEq_V1">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Calc_DGEq_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_DGEq_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the equilibrium groundwater depth.</span>

<span class="sd">    Method |Calc_DGEq_V1| calculates the equilibrium groundwater depth for the</span>
<span class="sd">    current water deficit of the vadose zone, following methods |Return_DVH_V2|</span>
<span class="sd">    and |Calc_DVEq_V3|.  As we are not aware of an analytical solution, we solve</span>
<span class="sd">    it numerically via class |PegasusDGEq|, which performs an iterative root-search</span>
<span class="sd">    based on the `Pegasus method`_.</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.wland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; thetas(0.4)</span>
<span class="sd">        &gt;&gt;&gt; thetar(0.01)</span>
<span class="sd">        &gt;&gt;&gt; psiae(300.0)</span>
<span class="sd">        &gt;&gt;&gt; b(5.0)</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import UnitTest</span>
<span class="sd">        &gt;&gt;&gt; test = UnitTest(</span>
<span class="sd">        ...     model=model,</span>
<span class="sd">        ...     method=model.calc_dgeq_v1,</span>
<span class="sd">        ...     last_example=13,</span>
<span class="sd">        ...     parseqs=(states.dv, aides.dgeq)</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; test.nexts.dv = (</span>
<span class="sd">        ...     -1.0, -0.01, 0.0, 0.01, 1.0, 2.0, 2.99, 3.0,</span>
<span class="sd">        ...     3.01012983, 5.1529353, 28.71839324, 111.1720584, 337.5798671)</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. |         dv |   dgeq |</span>
<span class="sd">        -----------------------------</span>
<span class="sd">        |   1 |       -1.0 |    0.0 |</span>
<span class="sd">        |   2 |      -0.01 |    0.0 |</span>
<span class="sd">        |   3 |        0.0 |    0.0 |</span>
<span class="sd">        |   4 |       0.01 |    1.0 |</span>
<span class="sd">        |   5 |        1.0 |  100.0 |</span>
<span class="sd">        |   6 |        2.0 |  200.0 |</span>
<span class="sd">        |   7 |       2.99 |  299.0 |</span>
<span class="sd">        |   8 |        3.0 |  300.0 |</span>
<span class="sd">        |   9 |    3.01013 |  301.0 |</span>
<span class="sd">        |  10 |   5.152935 |  400.0 |</span>
<span class="sd">        |  11 |  28.718393 |  800.0 |</span>
<span class="sd">        |  12 | 111.172058 | 1600.0 |</span>
<span class="sd">        |  13 | 337.579867 | 3200.0 |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">wland_control</span><span class="o">.</span><span class="n">ThetaS</span><span class="p">,</span>
        <span class="n">wland_control</span><span class="o">.</span><span class="n">ThetaR</span><span class="p">,</span>
        <span class="n">wland_control</span><span class="o">.</span><span class="n">PsiAE</span><span class="p">,</span>
        <span class="n">wland_control</span><span class="o">.</span><span class="n">B</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_derived</span><span class="o">.</span><span class="n">NUG</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_states</span><span class="o">.</span><span class="n">DV</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_aides</span><span class="o">.</span><span class="n">DGEq</span><span class="p">,)</span>
    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Return_ErrorDV_V1</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">psiae</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">dv</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">error</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_errordv_v1</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">psiae</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">error</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">aid</span><span class="o">.</span><span class="n">dgeq</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">pegasusdgeq</span><span class="o">.</span><span class="n">find_x</span><span class="p">(</span>
                    <span class="n">con</span><span class="o">.</span><span class="n">psiae</span><span class="p">,</span> <span class="mf">10000.0</span><span class="p">,</span> <span class="n">con</span><span class="o">.</span><span class="n">psiae</span><span class="p">,</span> <span class="mf">1000000.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1e-8</span><span class="p">,</span> <span class="mi">20</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">aid</span><span class="o">.</span><span class="n">dgeq</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">pegasusdgeq</span><span class="o">.</span><span class="n">find_x</span><span class="p">(</span>
                    <span class="mf">0.0</span><span class="p">,</span> <span class="n">con</span><span class="o">.</span><span class="n">psiae</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">con</span><span class="o">.</span><span class="n">psiae</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1e-8</span><span class="p">,</span> <span class="mi">20</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">dgeq</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_GF_V1">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Calc_GF_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_GF_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the gain factor for changes in groundwater depth.</span>

<span class="sd">    Basic equation (discontinuous):</span>
<span class="sd">     .. math::</span>
<span class="sd">        GF = \begin{cases}</span>
<span class="sd">          0 &amp;|\ DG \leq 0</span>
<span class="sd">          \\</span>
<span class="sd">          Return\_DVH\_V2(DGEq - DG)^{-1} &amp;|\ 0 &lt; DG</span>
<span class="sd">        \end{cases}</span>

<span class="sd">    The original `WALRUS`_ model attributes a passive role to groundwater dynamics.</span>
<span class="sd">    All water entering or leaving the underground is added to or subtracted from the</span>
<span class="sd">    vadose zone, and the groundwater table only reacts to such changes until it is in</span>
<span class="sd">    equilibrium with the updated water deficit in the vadose zone.  Hence, the movement</span>
<span class="sd">    of the groundwater table is generally slow.  However, in catchments with</span>
<span class="sd">    near-surface water tables, we often observe fast responses of groundwater to input</span>
<span class="sd">    forcings, maybe due to rapid infiltration along macropores or the re-infiltration</span>
<span class="sd">    of channel water.  In such situations, where the input water somehow bypasses the</span>
<span class="sd">    vadose zone, the speed of the rise of the groundwater table depends not only on</span>
<span class="sd">    the effective pore size of the soil material but also on the soil&#39;s degree of</span>
<span class="sd">    saturation directly above the groundwater table.  The smaller the remaining pore</span>
<span class="sd">    size, the larger the fraction between the water table&#39;s rise and the actual</span>
<span class="sd">    groundwater recharge.  We call this fraction the &quot;gain factor&quot; (|GF|).</span>

<span class="sd">    The `WALRUS`_ model does not explicitly account for the soil moisture in different</span>
<span class="sd">    depths above the groundwater table.  To keep the vertically lumped approach, we</span>
<span class="sd">    use the difference between the actual (|DG|) and the equilibrium groundwater depth</span>
<span class="sd">    (|DGEq|) as an indicator for the wetness above the groundwater table.  When |DG|</span>
<span class="sd">    is identical to |DGEq|, soil moisture and groundwater are in equilibrium.  Then,</span>
<span class="sd">    the tension-saturated area is fully developed, and the groundwater table moves</span>
<span class="sd">    quickly (depending on |ThetaR|).  The opposite case is when |DG| is much smaller</span>
<span class="sd">    than |DGEq|.  Such a situation occurs after a fast rise of the groundwater table</span>
<span class="sd">    when the soil water still needs much redistribution before it can be in equilibrium</span>
<span class="sd">    with groundwater.  In the most extreme case, the gain factor is just as large as</span>
<span class="sd">    indicated by the effective pore size alone (depending on |ThetaS|).</span>

<span class="sd">    The above discussion only applies as long as the groundwater table is below the</span>
<span class="sd">    soil surface.  For large-scale ponding (see :cite:t:`ref-Brauer2014`, section 5.11),</span>
<span class="sd">    we set |GF| to zero.  See the documentation on the methods |Calc_CDG_V1| and</span>
<span class="sd">    |Calc_FGS_V1| for related discussions.</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.wland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; thetas(0.4)</span>
<span class="sd">        &gt;&gt;&gt; thetar(0.01)</span>
<span class="sd">        &gt;&gt;&gt; psiae(300.0)</span>
<span class="sd">        &gt;&gt;&gt; b(5.0)</span>
<span class="sd">        &gt;&gt;&gt; sh(0.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.dgeq = 5000.0</span>
<span class="sd">        &gt;&gt;&gt; derived.rh1.update()</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import UnitTest</span>
<span class="sd">        &gt;&gt;&gt; test = UnitTest(</span>
<span class="sd">        ...     model=model,</span>
<span class="sd">        ...     method=model.calc_gf_v1,</span>
<span class="sd">        ...     last_example=16,</span>
<span class="sd">        ...     parseqs=(states.dg, aides.gf)</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; test.nexts.dg = (</span>
<span class="sd">        ...     -10.0, -1.0, 0.0, 1.0, 10.0,</span>
<span class="sd">        ...     1000.0, 2000.0, 3000.0, 4000.0, 4500.0, 4600.0,</span>
<span class="sd">        ...     4690.0, 4699.0, 4700.0, 4701.0, 4710.0)</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. |     dg |        gf |</span>
<span class="sd">        ----------------------------</span>
<span class="sd">        |   1 |  -10.0 |       0.0 |</span>
<span class="sd">        |   2 |   -1.0 |       0.0 |</span>
<span class="sd">        |   3 |    0.0 |   2.81175 |</span>
<span class="sd">        |   4 |    1.0 |  5.623782 |</span>
<span class="sd">        |   5 |   10.0 |  5.626316 |</span>
<span class="sd">        |   6 | 1000.0 |  5.963555 |</span>
<span class="sd">        |   7 | 2000.0 |  6.496601 |</span>
<span class="sd">        |   8 | 3000.0 |  7.510869 |</span>
<span class="sd">        |   9 | 4000.0 | 10.699902 |</span>
<span class="sd">        |  10 | 4500.0 |  20.88702 |</span>
<span class="sd">        |  11 | 4600.0 | 31.440737 |</span>
<span class="sd">        |  12 | 4690.0 | 79.686112 |</span>
<span class="sd">        |  13 | 4699.0 | 97.470815 |</span>
<span class="sd">        |  14 | 4700.0 |     100.0 |</span>
<span class="sd">        |  15 | 4701.0 |     100.0 |</span>
<span class="sd">        |  16 | 4710.0 |     100.0 |</span>

<span class="sd">        &gt;&gt;&gt; sh(1.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.rh1.update()</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. |     dg |        gf |</span>
<span class="sd">        ----------------------------</span>
<span class="sd">        |   1 |  -10.0 |       0.0 |</span>
<span class="sd">        |   2 |   -1.0 |  0.056232 |</span>
<span class="sd">        |   3 |    0.0 |   2.81175 |</span>
<span class="sd">        |   4 |    1.0 |  5.567544 |</span>
<span class="sd">        |   5 |   10.0 |  5.626316 |</span>
<span class="sd">        |   6 | 1000.0 |  5.963555 |</span>
<span class="sd">        |   7 | 2000.0 |  6.496601 |</span>
<span class="sd">        |   8 | 3000.0 |  7.510869 |</span>
<span class="sd">        |   9 | 4000.0 | 10.699902 |</span>
<span class="sd">        |  10 | 4500.0 |  20.88702 |</span>
<span class="sd">        |  11 | 4600.0 | 31.440737 |</span>
<span class="sd">        |  12 | 4690.0 | 79.686112 |</span>
<span class="sd">        |  13 | 4699.0 | 97.465434 |</span>
<span class="sd">        |  14 | 4700.0 | 99.609455 |</span>
<span class="sd">        |  15 | 4701.0 | 99.994314 |</span>
<span class="sd">        |  16 | 4710.0 |     100.0 |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">wland_control</span><span class="o">.</span><span class="n">ThetaS</span><span class="p">,</span>
        <span class="n">wland_control</span><span class="o">.</span><span class="n">ThetaR</span><span class="p">,</span>
        <span class="n">wland_control</span><span class="o">.</span><span class="n">PsiAE</span><span class="p">,</span>
        <span class="n">wland_control</span><span class="o">.</span><span class="n">B</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_derived</span><span class="o">.</span><span class="n">RH1</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_states</span><span class="o">.</span><span class="n">DG</span><span class="p">,</span> <span class="n">wland_aides</span><span class="o">.</span><span class="n">DGEq</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_aides</span><span class="o">.</span><span class="n">GF</span><span class="p">,)</span>
    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Return_DVH_V2</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span><span class="o">.</span><span class="n">gf</span> <span class="o">=</span> <span class="n">smoothutils</span><span class="o">.</span><span class="n">smooth_logistic1</span><span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">dg</span><span class="p">,</span> <span class="n">der</span><span class="o">.</span><span class="n">rh1</span><span class="p">)</span> <span class="o">/</span> <span class="n">model</span><span class="o">.</span><span class="n">return_dvh_v2</span><span class="p">(</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">dgeq</span> <span class="o">-</span> <span class="n">sta</span><span class="o">.</span><span class="n">dg</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="Calc_GR_V1">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Calc_GR_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_GR_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the elevated region&#39;s groundwater recharge.</span>

<span class="sd">    Basic equations (discontinous):</span>

<span class="sd">    .. math::</span>
<span class="sd">      GR = \begin{cases}</span>
<span class="sd">      0 &amp;|\ AC \leq DV\!E \\</span>
<span class="sd">      AC - DV\!E &amp;|\ AC &gt; DV\!E</span>
<span class="sd">      \end{cases}</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.wland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; ac(200.0)</span>
<span class="sd">        &gt;&gt;&gt; rg(False)</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import UnitTest</span>
<span class="sd">        &gt;&gt;&gt; test = UnitTest(model=model,</span>
<span class="sd">        ...                 method=model.calc_gr_v1,</span>
<span class="sd">        ...                 last_example=7,</span>
<span class="sd">        ...                 parseqs=(states.dve, fluxes.gr))</span>
<span class="sd">        &gt;&gt;&gt; test.nexts.dve = (100.0, 190.0, 199.0, 200.0, 201.0, 210.0, 300.0)</span>

<span class="sd">        Discontinuous example:</span>

<span class="sd">        &gt;&gt;&gt; sh(0.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.rh2.update()</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. |   dve |    gr |</span>
<span class="sd">        -----------------------</span>
<span class="sd">        |   1 | 100.0 | 100.0 |</span>
<span class="sd">        |   2 | 190.0 |  10.0 |</span>
<span class="sd">        |   3 | 199.0 |   1.0 |</span>
<span class="sd">        |   4 | 200.0 |   0.0 |</span>
<span class="sd">        |   5 | 201.0 |   0.0 |</span>
<span class="sd">        |   6 | 210.0 |   0.0 |</span>
<span class="sd">        |   7 | 300.0 |   0.0 |</span>

<span class="sd">        Continuous example:</span>

<span class="sd">        &gt;&gt;&gt; sh(10.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.rh2.update()</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. |   dve |       gr |</span>
<span class="sd">        --------------------------</span>
<span class="sd">        |   1 | 100.0 |    100.0 |</span>
<span class="sd">        |   2 | 190.0 |    10.01 |</span>
<span class="sd">        |   3 | 199.0 | 1.885788 |</span>
<span class="sd">        |   4 | 200.0 | 1.320935 |</span>
<span class="sd">        |   5 | 201.0 | 0.885788 |</span>
<span class="sd">        |   6 | 210.0 |     0.01 |</span>
<span class="sd">        |   7 | 300.0 |      0.0 |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_control</span><span class="o">.</span><span class="n">AC</span><span class="p">,)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_derived</span><span class="o">.</span><span class="n">NUGE</span><span class="p">,</span> <span class="n">wland_derived</span><span class="o">.</span><span class="n">RH2</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_states</span><span class="o">.</span><span class="n">DVE</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_fluxes</span><span class="o">.</span><span class="n">GR</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">if</span> <span class="n">der</span><span class="o">.</span><span class="n">nuge</span><span class="p">:</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">gr</span> <span class="o">=</span> <span class="n">smoothutils</span><span class="o">.</span><span class="n">smooth_logistic2</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">ac</span> <span class="o">-</span> <span class="n">sta</span><span class="o">.</span><span class="n">dve</span><span class="p">,</span> <span class="n">der</span><span class="o">.</span><span class="n">rh2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">gr</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_CDG_V1">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Calc_CDG_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_CDG_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the change in the groundwater depth due to percolation and</span>
<span class="sd">    capillary rise.</span>

<span class="sd">    Basic equation (discontinuous):</span>
<span class="sd">      .. math::</span>
<span class="sd">        CDG = \frac{DV - min(DV\!Eq, \ DG)}{CV} + \begin{cases}</span>
<span class="sd">        \frac{FGS - FGSE - FXG}{ThetaS} &amp;|\ DGC \\</span>
<span class="sd">        0 &amp;|\  \overline{DGC}</span>
<span class="sd">        \end{cases}</span>

<span class="sd">    Note that this equation differs in two respects from equation 6 of</span>
<span class="sd">    :cite:t:`ref-Brauer2014`.</span>

<span class="sd">    First, in the case of large-scale ponding, |DVEq| always stays at zero, and we let</span>
<span class="sd">    |DG| take control of the speed of the water table movement.  See the documentation</span>
<span class="sd">    on method |Calc_FGS_V1| for additional information on the differences between</span>
<span class="sd">    |wland| and `WALRUS`_ for this rare situation.</span>

<span class="sd">    Second, one can set |DGC| to |True| to enforce a more direct connection between the</span>
<span class="sd">    groundwater and surface water storage level. According to :cite:t:`ref-Brauer2014`,</span>
<span class="sd">    groundwater drainage and extraction increase and surface water infiltration and</span>
<span class="sd">    seepage decrease the water deficit in the vadose zone but do not change groundwater</span>
<span class="sd">    depth directly.  This abstraction is as if, for example, groundwater drainage would</span>
<span class="sd">    take water from the soil&#39;s top.  The groundwater level only reacts with some delay</span>
<span class="sd">    due to its tendency to advance towards the increased equilibrium depth.  With |DGC|</span>
<span class="sd">    enabled, the mentioned fluxes change the vadose zone&#39;s deficit and the groundwater</span>
<span class="sd">    depth simultaneously.</span>

<span class="sd">    Examples:</span>

<span class="sd">        Without large-scale ponding and a direct groundwater connection:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.wland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; dgc(False)</span>
<span class="sd">        &gt;&gt;&gt; cv(10.0)</span>
<span class="sd">        &gt;&gt;&gt; thetas(0.5)</span>
<span class="sd">        &gt;&gt;&gt; sh(0.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.rh1.update()</span>
<span class="sd">        &gt;&gt;&gt; states.dv = 100.0</span>
<span class="sd">        &gt;&gt;&gt; states.dg = 1000.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.fgs = 2.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.fgse = 0.5</span>
<span class="sd">        &gt;&gt;&gt; fluxes.fxg = 2.5</span>
<span class="sd">        &gt;&gt;&gt; aides.dveq = 80.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_cdg_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.cdg</span>
<span class="sd">        cdg(1.0)</span>

<span class="sd">        Without large-scale ponding and with a direct groundwater connection:</span>

<span class="sd">        &gt;&gt;&gt; dgc(True)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_cdg_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.cdg</span>
<span class="sd">        cdg(-1.0)</span>

<span class="sd">        With large-scale ponding and without smoothing:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import UnitTest</span>
<span class="sd">        &gt;&gt;&gt; test = UnitTest(</span>
<span class="sd">        ...     model=model,</span>
<span class="sd">        ...     method=model.calc_cdg_v1,</span>
<span class="sd">        ...     last_example=5,</span>
<span class="sd">        ...     parseqs=(states.dg, fluxes.cdg)</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; dgc(False)</span>
<span class="sd">        &gt;&gt;&gt; states.dv = -10.0</span>
<span class="sd">        &gt;&gt;&gt; aides.dveq = 0.0</span>
<span class="sd">        &gt;&gt;&gt; test.nexts.dg = 10.0, 1.0, 0.0, -1.0, -10.0</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. |    dg |   cdg |</span>
<span class="sd">        -----------------------</span>
<span class="sd">        |   1 |  10.0 |  -0.5 |</span>
<span class="sd">        |   2 |   1.0 |  -0.5 |</span>
<span class="sd">        |   3 |   0.0 |  -0.5 |</span>
<span class="sd">        |   4 |  -1.0 | -0.45 |</span>
<span class="sd">        |   5 | -10.0 |   0.0 |</span>

<span class="sd">        With large-scale ponding and smoothing:</span>

<span class="sd">        &gt;&gt;&gt; sh(1.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.rh1.update()</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. |    dg |       cdg |</span>
<span class="sd">        ---------------------------</span>
<span class="sd">        |   1 |  10.0 |      -0.5 |</span>
<span class="sd">        |   2 |   1.0 | -0.499891 |</span>
<span class="sd">        |   3 |   0.0 | -0.492458 |</span>
<span class="sd">        |   4 |  -1.0 | -0.449891 |</span>
<span class="sd">        |   5 | -10.0 |       0.0 |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_control</span><span class="o">.</span><span class="n">CV</span><span class="p">,</span> <span class="n">wland_control</span><span class="o">.</span><span class="n">ThetaS</span><span class="p">,</span> <span class="n">wland_control</span><span class="o">.</span><span class="n">DGC</span><span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_derived</span><span class="o">.</span><span class="n">NUG</span><span class="p">,</span> <span class="n">wland_derived</span><span class="o">.</span><span class="n">RH1</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">wland_states</span><span class="o">.</span><span class="n">DG</span><span class="p">,</span>
        <span class="n">wland_states</span><span class="o">.</span><span class="n">DV</span><span class="p">,</span>
        <span class="n">wland_fluxes</span><span class="o">.</span><span class="n">FGS</span><span class="p">,</span>
        <span class="n">wland_fluxes</span><span class="o">.</span><span class="n">FGSE</span><span class="p">,</span>
        <span class="n">wland_fluxes</span><span class="o">.</span><span class="n">FXG</span><span class="p">,</span>
        <span class="n">wland_aides</span><span class="o">.</span><span class="n">DVEq</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_fluxes</span><span class="o">.</span><span class="n">CDG</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">if</span> <span class="n">der</span><span class="o">.</span><span class="n">nug</span><span class="p">:</span>
            <span class="n">target</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">smoothutils</span><span class="o">.</span><span class="n">smooth_min1</span><span class="p">(</span><span class="n">aid</span><span class="o">.</span><span class="n">dveq</span><span class="p">,</span> <span class="n">sta</span><span class="o">.</span><span class="n">dg</span><span class="p">,</span> <span class="n">der</span><span class="o">.</span><span class="n">rh1</span><span class="p">)</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">cdg</span> <span class="o">=</span> <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">dv</span> <span class="o">-</span> <span class="n">target</span><span class="p">)</span> <span class="o">/</span> <span class="n">con</span><span class="o">.</span><span class="n">cv</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">dgc</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">cdg</span> <span class="o">+=</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">fgs</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">fgse</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">fxg</span><span class="p">)</span> <span class="o">/</span> <span class="n">con</span><span class="o">.</span><span class="n">thetas</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">cdg</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_CDG_V2">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Calc_CDG_V2">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_CDG_V2</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the vadose zone&#39;s storage deficit change due to percolation,</span>
<span class="sd">    capillary rise, macropore infiltration, seepage, groundwater flow, and channel</span>
<span class="sd">    water infiltration.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`CDG =</span>
<span class="sd">      \frac{DV-min(DV\!Eq, \ DG)}{CV} + GF \cdot \big( FGS - FGSE - PV - FXG \big)`</span>

<span class="sd">    Method |Calc_CDG_V2| extends |Calc_CDG_V1|, which implements the (nearly) original</span>
<span class="sd">    `WALRUS`_ relationship defined by equation 6 of :cite:t:`ref-Brauer2014`).  See the</span>
<span class="sd">    documentation on method |Calc_GF_V1| for a comprehensive explanation of the reason</span>
<span class="sd">    for this extension.</span>

<span class="sd">    Examples:</span>

<span class="sd">        Without large-scale ponding:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.wland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; cv(10.0)</span>
<span class="sd">        &gt;&gt;&gt; sh(0.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.rh1.update()</span>
<span class="sd">        &gt;&gt;&gt; states.dv = 100.0</span>
<span class="sd">        &gt;&gt;&gt; states.dg = 1000.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.pv = 1.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.fxg = 0.5</span>
<span class="sd">        &gt;&gt;&gt; fluxes.fgse = 1.5</span>
<span class="sd">        &gt;&gt;&gt; fluxes.fgs = 4.0</span>
<span class="sd">        &gt;&gt;&gt; aides.dveq = 80.0</span>
<span class="sd">        &gt;&gt;&gt; aides.gf = 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_cdg_v2()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.cdg</span>
<span class="sd">        cdg(3.0)</span>

<span class="sd">        With large-scale ponding and without smoothing:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import UnitTest</span>
<span class="sd">        &gt;&gt;&gt; test = UnitTest(</span>
<span class="sd">        ...     model=model,</span>
<span class="sd">        ...     method=model.calc_cdg_v2,</span>
<span class="sd">        ...     last_example=5,</span>
<span class="sd">        ...     parseqs=(states.dg, fluxes.cdg)</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; aides.gf = 0.0</span>
<span class="sd">        &gt;&gt;&gt; states.dv = -10.0</span>
<span class="sd">        &gt;&gt;&gt; aides.dveq = 0.0</span>
<span class="sd">        &gt;&gt;&gt; test.nexts.dg = 10.0, 1.0, 0.0, -1.0, -10.0</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. |    dg |   cdg |</span>
<span class="sd">        -----------------------</span>
<span class="sd">        |   1 |  10.0 |  -0.5 |</span>
<span class="sd">        |   2 |   1.0 |  -0.5 |</span>
<span class="sd">        |   3 |   0.0 |  -0.5 |</span>
<span class="sd">        |   4 |  -1.0 | -0.45 |</span>
<span class="sd">        |   5 | -10.0 |   0.0 |</span>

<span class="sd">        With large-scale ponding and with smoothing:</span>

<span class="sd">        &gt;&gt;&gt; sh(1.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.rh1.update()</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. |    dg |       cdg |</span>
<span class="sd">        ---------------------------</span>
<span class="sd">        |   1 |  10.0 |      -0.5 |</span>
<span class="sd">        |   2 |   1.0 | -0.499891 |</span>
<span class="sd">        |   3 |   0.0 | -0.492458 |</span>
<span class="sd">        |   4 |  -1.0 | -0.449891 |</span>
<span class="sd">        |   5 | -10.0 |       0.0 |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_control</span><span class="o">.</span><span class="n">CV</span><span class="p">,)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_derived</span><span class="o">.</span><span class="n">NUG</span><span class="p">,</span> <span class="n">wland_derived</span><span class="o">.</span><span class="n">RH1</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">wland_fluxes</span><span class="o">.</span><span class="n">PV</span><span class="p">,</span>
        <span class="n">wland_fluxes</span><span class="o">.</span><span class="n">FGS</span><span class="p">,</span>
        <span class="n">wland_fluxes</span><span class="o">.</span><span class="n">FGSE</span><span class="p">,</span>
        <span class="n">wland_fluxes</span><span class="o">.</span><span class="n">FXG</span><span class="p">,</span>
        <span class="n">wland_states</span><span class="o">.</span><span class="n">DG</span><span class="p">,</span>
        <span class="n">wland_states</span><span class="o">.</span><span class="n">DV</span><span class="p">,</span>
        <span class="n">wland_aides</span><span class="o">.</span><span class="n">DVEq</span><span class="p">,</span>
        <span class="n">wland_aides</span><span class="o">.</span><span class="n">GF</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_fluxes</span><span class="o">.</span><span class="n">CDG</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">if</span> <span class="n">der</span><span class="o">.</span><span class="n">nug</span><span class="p">:</span>
            <span class="n">target</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">smoothutils</span><span class="o">.</span><span class="n">smooth_min1</span><span class="p">(</span><span class="n">aid</span><span class="o">.</span><span class="n">dveq</span><span class="p">,</span> <span class="n">sta</span><span class="o">.</span><span class="n">dg</span><span class="p">,</span> <span class="n">der</span><span class="o">.</span><span class="n">rh1</span><span class="p">)</span>
            <span class="n">cdg_slow</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">dv</span> <span class="o">-</span> <span class="n">target</span><span class="p">)</span> <span class="o">/</span> <span class="n">con</span><span class="o">.</span><span class="n">cv</span>
            <span class="n">cdg_fast</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">aid</span><span class="o">.</span><span class="n">gf</span> <span class="o">*</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">fgs</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">fgse</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">pv</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">fxg</span><span class="p">)</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">cdg</span> <span class="o">=</span> <span class="n">cdg_slow</span> <span class="o">+</span> <span class="n">cdg_fast</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">cdg</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_FGSE_V1">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Calc_FGSE_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_FGSE_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the groundwater flow between the elevated and the lowland regions.</span>

<span class="sd">    The basic equation of method |Calc_FGSE_V1| relies on the one of |Calc_FGS_V1|</span>
<span class="sd">    introduced by :cite:t:`ref-Brauer2014`.  We decided so to calculate |FGSE| in a</span>
<span class="sd">    WALRUS-like manner.</span>

<span class="sd">    Basic equation:</span>

<span class="sd">    .. math::</span>
<span class="sd">      FGSE = \frac{\Delta \cdot |\Delta|}{CGE}</span>
<span class="sd">      \\\\</span>
<span class="sd">      \Delta = HGE - (1000 \cdot GL - DG)</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.wland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; gl(5.0)</span>
<span class="sd">        &gt;&gt;&gt; cge(1000000.0)</span>
<span class="sd">        &gt;&gt;&gt; states.dg = 3000.0</span>

<span class="sd">        Normal flow:</span>

<span class="sd">        &gt;&gt;&gt; states.hge = 4000.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_fgse_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.fgse</span>
<span class="sd">        fgse(2.0)</span>

<span class="sd">        No flow:</span>

<span class="sd">        &gt;&gt;&gt; states.hge = 2000.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_fgse_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.fgse</span>
<span class="sd">        fgse(0.0)</span>

<span class="sd">        Reversed flow:</span>

<span class="sd">        &gt;&gt;&gt; states.hge = 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_fgse_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.fgse</span>
<span class="sd">        fgse(-2.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_control</span><span class="o">.</span><span class="n">GL</span><span class="p">,</span> <span class="n">wland_control</span><span class="o">.</span><span class="n">CGE</span><span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_derived</span><span class="o">.</span><span class="n">NUGE</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_states</span><span class="o">.</span><span class="n">HGE</span><span class="p">,</span> <span class="n">wland_states</span><span class="o">.</span><span class="n">DG</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_fluxes</span><span class="o">.</span><span class="n">FGSE</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">if</span> <span class="n">der</span><span class="o">.</span><span class="n">nuge</span><span class="p">:</span>
            <span class="n">hge</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">sta</span><span class="o">.</span><span class="n">hge</span>
            <span class="n">hg</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1000.0</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">gl</span> <span class="o">-</span> <span class="n">sta</span><span class="o">.</span><span class="n">dg</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">fgse</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">hge</span> <span class="o">-</span> <span class="n">hg</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">hge</span> <span class="o">-</span> <span class="n">hg</span><span class="p">)</span> <span class="o">/</span> <span class="n">con</span><span class="o">.</span><span class="n">cge</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">fgse</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_FGS_V1">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Calc_FGS_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_FGS_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the groundwater drainage or surface water infiltration.</span>

<span class="sd">    For large-scale ponding, |wland| and `WALRUS`_ calculate |FGS| differently</span>
<span class="sd">    (even for discontinuous parameterisations).  In such cases, he `WALRUS`_ model</span>
<span class="sd">    redistributes water instantaneously (see :cite:t:`ref-Brauer2014`, section 5.11),</span>
<span class="sd">    which relates to infinitely high flow velocities and cannot be handled by the</span>
<span class="sd">    numerical integration algorithm underlying |wland|.  Hence, we introduce the</span>
<span class="sd">    parameter |CGF| instead.  Setting it to a value larger than zero increases the flow</span>
<span class="sd">    velocity with increasing large-scale ponding.  The larger the value of |CGF|,</span>
<span class="sd">    the stronger the functional similarity of both approaches.  But note that very</span>
<span class="sd">    high values can result in increased computation times.</span>

<span class="sd">    Basic equations (discontinous):</span>

<span class="sd">    .. math::</span>
<span class="sd">      FGS = Gradient \cdot ContactSurface \cdot Conductivity</span>
<span class="sd">      \\ \\</span>
<span class="sd">      HG^* = max(CD - DG, \ 0) \\</span>
<span class="sd">      HS^* = max(HS, \ 0) \\</span>
<span class="sd">      Gradient = \begin{cases}</span>
<span class="sd">      HG^* - HS^* &amp;|\ RG \\</span>
<span class="sd">      CD - DG - HS^* &amp;|\ \overline{RG} \\</span>
<span class="sd">      \end{cases} \\</span>
<span class="sd">      ContactSurface = \begin{cases}</span>
<span class="sd">      |HG^* - HS^*| &amp;|\ RG \\</span>
<span class="sd">      max(HG^*, \ HS^*) &amp;|\ \overline{RG} \\</span>
<span class="sd">      \end{cases} \\</span>
<span class="sd">      Excess = max(-DG, HS - CD, \ 0) \\</span>
<span class="sd">      Conductivity = (1 + CGF \cdot Excess) / CG</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.wland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; cg(10000.0)</span>
<span class="sd">        &gt;&gt;&gt; rg(False)</span>
<span class="sd">        &gt;&gt;&gt; derived.cd(600.0)</span>
<span class="sd">        &gt;&gt;&gt; states.hs = 300.0</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import UnitTest</span>
<span class="sd">        &gt;&gt;&gt; test = UnitTest(model=model,</span>
<span class="sd">        ...                 method=model.calc_fgs_v1,</span>
<span class="sd">        ...                 last_example=15,</span>
<span class="sd">        ...                 parseqs=(states.dg, states.hs, fluxes.fgs))</span>
<span class="sd">        &gt;&gt;&gt; test.nexts.dg = (</span>
<span class="sd">        ...     -100.0, -1.0, 0.0, 1.0, 100.0, 200.0, 290.0, 299.0,</span>
<span class="sd">        ...     300.0, 301.0, 310.0, 400.0, 500.0, 600.0, 700.0)</span>

<span class="sd">        Without smoothing and without increased conductivity for large-scale ponding:</span>

<span class="sd">        &gt;&gt;&gt; cgf(0.0)</span>
<span class="sd">        &gt;&gt;&gt; sh(0.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.rh2.update()</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. |     dg |    hs |     fgs |</span>
<span class="sd">        ----------------------------------</span>
<span class="sd">        |   1 | -100.0 | 300.0 |    14.0 |</span>
<span class="sd">        |   2 |   -1.0 | 300.0 | 9.04505 |</span>
<span class="sd">        |   3 |    0.0 | 300.0 |     9.0 |</span>
<span class="sd">        |   4 |    1.0 | 300.0 | 8.95505 |</span>
<span class="sd">        |   5 |  100.0 | 300.0 |     5.0 |</span>
<span class="sd">        |   6 |  200.0 | 300.0 |     2.0 |</span>
<span class="sd">        |   7 |  290.0 | 300.0 |   0.155 |</span>
<span class="sd">        |   8 |  299.0 | 300.0 | 0.01505 |</span>
<span class="sd">        |   9 |  300.0 | 300.0 |     0.0 |</span>
<span class="sd">        |  10 |  301.0 | 300.0 |  -0.015 |</span>
<span class="sd">        |  11 |  310.0 | 300.0 |   -0.15 |</span>
<span class="sd">        |  12 |  400.0 | 300.0 |    -1.5 |</span>
<span class="sd">        |  13 |  500.0 | 300.0 |    -3.0 |</span>
<span class="sd">        |  14 |  600.0 | 300.0 |    -4.5 |</span>
<span class="sd">        |  15 |  700.0 | 300.0 |    -6.0 |</span>

<span class="sd">        Without smoothing but with increased conductivity for large-scale ponding:</span>

<span class="sd">        &gt;&gt;&gt; cgf(0.1)</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. |     dg |    hs |      fgs |</span>
<span class="sd">        -----------------------------------</span>
<span class="sd">        |   1 | -100.0 | 300.0 |    294.0 |</span>
<span class="sd">        |   2 |   -1.0 | 300.0 | 10.85406 |</span>
<span class="sd">        |   3 |    0.0 | 300.0 |      9.0 |</span>
<span class="sd">        |   4 |    1.0 | 300.0 |  8.95505 |</span>
<span class="sd">        |   5 |  100.0 | 300.0 |      5.0 |</span>
<span class="sd">        |   6 |  200.0 | 300.0 |      2.0 |</span>
<span class="sd">        |   7 |  290.0 | 300.0 |    0.155 |</span>
<span class="sd">        |   8 |  299.0 | 300.0 |  0.01505 |</span>
<span class="sd">        |   9 |  300.0 | 300.0 |      0.0 |</span>
<span class="sd">        |  10 |  301.0 | 300.0 |   -0.015 |</span>
<span class="sd">        |  11 |  310.0 | 300.0 |    -0.15 |</span>
<span class="sd">        |  12 |  400.0 | 300.0 |     -1.5 |</span>
<span class="sd">        |  13 |  500.0 | 300.0 |     -3.0 |</span>
<span class="sd">        |  14 |  600.0 | 300.0 |     -4.5 |</span>
<span class="sd">        |  15 |  700.0 | 300.0 |     -6.0 |</span>

<span class="sd">        With smoothing and with increased conductivity for large-scale ponding:</span>

<span class="sd">        &gt;&gt;&gt; sh(1.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.rh2.update()</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. |     dg |    hs |      fgs |</span>
<span class="sd">        -----------------------------------</span>
<span class="sd">        |   1 | -100.0 | 300.0 |    294.0 |</span>
<span class="sd">        |   2 |   -1.0 | 300.0 | 10.87215 |</span>
<span class="sd">        |   3 |    0.0 | 300.0 | 9.369944 |</span>
<span class="sd">        |   4 |    1.0 | 300.0 |  8.97296 |</span>
<span class="sd">        |   5 |  100.0 | 300.0 |      5.0 |</span>
<span class="sd">        |   6 |  200.0 | 300.0 |      2.0 |</span>
<span class="sd">        |   7 |  290.0 | 300.0 |    0.155 |</span>
<span class="sd">        |   8 |  299.0 | 300.0 |  0.01505 |</span>
<span class="sd">        |   9 |  300.0 | 300.0 |      0.0 |</span>
<span class="sd">        |  10 |  301.0 | 300.0 |   -0.015 |</span>
<span class="sd">        |  11 |  310.0 | 300.0 |    -0.15 |</span>
<span class="sd">        |  12 |  400.0 | 300.0 |     -1.5 |</span>
<span class="sd">        |  13 |  500.0 | 300.0 |     -3.0 |</span>
<span class="sd">        |  14 |  600.0 | 300.0 |     -4.5 |</span>
<span class="sd">        |  15 |  700.0 | 300.0 |     -6.0 |</span>

<span class="sd">        Another difference to the original WALRUS model is optional. Enabling the |RG|</span>
<span class="sd">        option restricts the |FGS| in two ways.  First, the groundwater depth used for</span>
<span class="sd">        calculating the gradient between the surface and the groundwater level is</span>
<span class="sd">        restricted to the channel depth so that extremely low groundwater levels do not</span>
<span class="sd">        result in extremely high surface water infiltration.  Second, the contact</span>
<span class="sd">        surface is restricted to the difference between the surface and the</span>
<span class="sd">        (restricted) groundwater level so that uncertainties in channel depth estimates</span>
<span class="sd">        have a less severe effect both on groundwater drainage and surface water</span>
<span class="sd">        infiltration:</span>

<span class="sd">        &gt;&gt;&gt; rg(True)</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. |     dg |    hs |       fgs |</span>
<span class="sd">        ------------------------------------</span>
<span class="sd">        |   1 | -100.0 | 300.0 |     168.0 |</span>
<span class="sd">        |   2 |   -1.0 | 300.0 |   5.44512 |</span>
<span class="sd">        |   3 |    0.0 | 300.0 |  4.684972 |</span>
<span class="sd">        |   4 |    1.0 | 300.0 |   4.47899 |</span>
<span class="sd">        |   5 |  100.0 | 300.0 |       2.0 |</span>
<span class="sd">        |   6 |  200.0 | 300.0 |       0.5 |</span>
<span class="sd">        |   7 |  290.0 | 300.0 |     0.005 |</span>
<span class="sd">        |   8 |  299.0 | 300.0 |   0.00005 |</span>
<span class="sd">        |   9 |  300.0 | 300.0 |       0.0 |</span>
<span class="sd">        |  10 |  301.0 | 300.0 |  -0.00005 |</span>
<span class="sd">        |  11 |  310.0 | 300.0 |    -0.005 |</span>
<span class="sd">        |  12 |  400.0 | 300.0 |      -0.5 |</span>
<span class="sd">        |  13 |  500.0 | 300.0 |      -2.0 |</span>
<span class="sd">        |  14 |  600.0 | 300.0 | -4.493836 |</span>
<span class="sd">        |  15 |  700.0 | 300.0 |      -4.5 |</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_control</span><span class="o">.</span><span class="n">CG</span><span class="p">,</span> <span class="n">wland_control</span><span class="o">.</span><span class="n">RG</span><span class="p">,</span> <span class="n">wland_control</span><span class="o">.</span><span class="n">CGF</span><span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_derived</span><span class="o">.</span><span class="n">CD</span><span class="p">,</span> <span class="n">wland_derived</span><span class="o">.</span><span class="n">NUG</span><span class="p">,</span> <span class="n">wland_derived</span><span class="o">.</span><span class="n">RH2</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_states</span><span class="o">.</span><span class="n">DG</span><span class="p">,</span> <span class="n">wland_states</span><span class="o">.</span><span class="n">HS</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_fluxes</span><span class="o">.</span><span class="n">FGS</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">if</span> <span class="n">der</span><span class="o">.</span><span class="n">nug</span><span class="p">:</span>
            <span class="n">hg</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">smoothutils</span><span class="o">.</span><span class="n">smooth_logistic2</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">cd</span> <span class="o">-</span> <span class="n">sta</span><span class="o">.</span><span class="n">dg</span><span class="p">,</span> <span class="n">der</span><span class="o">.</span><span class="n">rh2</span><span class="p">)</span>
            <span class="n">hs</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">smoothutils</span><span class="o">.</span><span class="n">smooth_logistic2</span><span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">hs</span><span class="p">,</span> <span class="n">der</span><span class="o">.</span><span class="n">rh2</span><span class="p">)</span>
            <span class="n">gradient</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="p">(</span><span class="n">hg</span> <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">rg</span> <span class="k">else</span> <span class="n">der</span><span class="o">.</span><span class="n">cd</span> <span class="o">-</span> <span class="n">sta</span><span class="o">.</span><span class="n">dg</span><span class="p">)</span> <span class="o">-</span> <span class="n">hs</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">rg</span><span class="p">:</span>
                <span class="n">contactsurface</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">hg</span> <span class="o">-</span> <span class="n">hs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">contactsurface</span> <span class="o">=</span> <span class="n">smoothutils</span><span class="o">.</span><span class="n">smooth_max1</span><span class="p">(</span><span class="n">hg</span><span class="p">,</span> <span class="n">hs</span><span class="p">,</span> <span class="n">der</span><span class="o">.</span><span class="n">rh2</span><span class="p">)</span>
            <span class="n">excess</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">smoothutils</span><span class="o">.</span><span class="n">smooth_max2</span><span class="p">(</span>
                <span class="o">-</span><span class="n">sta</span><span class="o">.</span><span class="n">dg</span><span class="p">,</span> <span class="n">sta</span><span class="o">.</span><span class="n">hs</span> <span class="o">-</span> <span class="n">der</span><span class="o">.</span><span class="n">cd</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">der</span><span class="o">.</span><span class="n">rh2</span>
            <span class="p">)</span>
            <span class="n">conductivity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">con</span><span class="o">.</span><span class="n">cgf</span> <span class="o">*</span> <span class="n">excess</span><span class="p">)</span> <span class="o">/</span> <span class="n">con</span><span class="o">.</span><span class="n">cg</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">fgs</span> <span class="o">=</span> <span class="n">gradient</span> <span class="o">*</span> <span class="n">contactsurface</span> <span class="o">*</span> <span class="n">conductivity</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">fgs</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_FQS_V1">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Calc_FQS_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_FQS_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the quickflow.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`FQS = \frac{HQ}{CQ}`</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.wland import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nu(2)</span>
<span class="sd">        &gt;&gt;&gt; cq(10.0)</span>
<span class="sd">        &gt;&gt;&gt; states.hq = 100.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_fqs_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.fqs</span>
<span class="sd">        fqs(5.0)</span>

<span class="sd">        Without land areas, quickflow is zero:</span>

<span class="sd">        &gt;&gt;&gt; nu(1)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_fqs_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.fqs</span>
<span class="sd">        fqs(0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_control</span><span class="o">.</span><span class="n">NU</span><span class="p">,</span> <span class="n">wland_control</span><span class="o">.</span><span class="n">CQ</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_states</span><span class="o">.</span><span class="n">HQ</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_fluxes</span><span class="o">.</span><span class="n">FQS</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">nu</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">fqs</span> <span class="o">=</span> <span class="n">sta</span><span class="o">.</span><span class="n">hq</span> <span class="o">/</span> <span class="n">con</span><span class="o">.</span><span class="n">cq</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">fqs</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_RH_V1">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Calc_RH_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_RH_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Let a submodel that complies with the |DischargeModel_V2| interface calculate</span>
<span class="sd">    the runoff height or, if no such submodel is available, equate it with all other</span>
<span class="sd">    flows in and out of the surface water storage.</span>

<span class="sd">    Basic equation (without submodel):</span>
<span class="sd">      :math:`RH = ASR \cdot (PS - ES + FXS) + ALR \cdot FQS + AGR \cdot FGS`</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.wland_wag import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>

<span class="sd">        Without an available submodel, |Calc_RH_V1| applies the given basic equation:</span>

<span class="sd">        &gt;&gt;&gt; derived.asr(0.2)</span>
<span class="sd">        &gt;&gt;&gt; derived.alr(0.8)</span>
<span class="sd">        &gt;&gt;&gt; derived.agr(0.6)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.ps = 3.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.fxs = 1.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.es = 2.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.fqs(0.5)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.fgs(0.2)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rh_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.rh</span>
<span class="sd">        rh(0.92)</span>

<span class="sd">        We use |wq_walrus|, which implements WALRUS&#39; standard approach for calculating</span>
<span class="sd">        |RH|, to demonstrate that |Calc_RH_V1| correctly uses submodels that follow the</span>
<span class="sd">        |DischargeModel_V2| interface:</span>

<span class="sd">        &gt;&gt;&gt; sh(0.1)</span>
<span class="sd">        &gt;&gt;&gt; states.hs(3000.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.cd(5000.0)</span>
<span class="sd">        &gt;&gt;&gt; with model.add_dischargemodel_v2(&quot;wq_walrus&quot;):</span>
<span class="sd">        ...     crestheight(2.0)</span>
<span class="sd">        ...     bankfulldischarge(2.0)</span>
<span class="sd">        ...     dischargeexponent(2.0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rh_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.rh</span>
<span class="sd">        rh(0.111111)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_derived</span><span class="o">.</span><span class="n">ASR</span><span class="p">,</span> <span class="n">wland_derived</span><span class="o">.</span><span class="n">ALR</span><span class="p">,</span> <span class="n">wland_derived</span><span class="o">.</span><span class="n">AGR</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">wland_fluxes</span><span class="o">.</span><span class="n">PS</span><span class="p">,</span>
        <span class="n">wland_fluxes</span><span class="o">.</span><span class="n">ES</span><span class="p">,</span>
        <span class="n">wland_fluxes</span><span class="o">.</span><span class="n">FXS</span><span class="p">,</span>
        <span class="n">wland_fluxes</span><span class="o">.</span><span class="n">FQS</span><span class="p">,</span>
        <span class="n">wland_fluxes</span><span class="o">.</span><span class="n">FGS</span><span class="p">,</span>
        <span class="n">wland_states</span><span class="o">.</span><span class="n">HS</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_fluxes</span><span class="o">.</span><span class="n">RH</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">dischargemodel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">rh</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">der</span><span class="o">.</span><span class="n">asr</span> <span class="o">*</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">fxs</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">ps</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">es</span><span class="p">)</span>
                <span class="o">+</span> <span class="n">der</span><span class="o">.</span><span class="n">alr</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">fqs</span>
                <span class="o">+</span> <span class="n">der</span><span class="o">.</span><span class="n">agr</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">fgs</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">model</span><span class="o">.</span><span class="n">dischargemodel_typeid</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">rh</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
                <span class="n">dischargeinterfaces</span><span class="o">.</span><span class="n">DischargeModel_V2</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">dischargemodel</span>
            <span class="p">)</span><span class="o">.</span><span class="n">calculate_discharge</span><span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">hs</span> <span class="o">/</span> <span class="mf">1000.0</span><span class="p">)</span></div>



<div class="viewcode-block" id="Update_IC_V1">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Update_IC_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Update_IC_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Update the interception storage.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`\frac{dIC}{dt} = PC - TF - EI`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.wland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nu(2)</span>
<span class="sd">        &gt;&gt;&gt; derived.nul.update()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.pc = 2.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.tf = 1.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.ei = 3.0</span>
<span class="sd">        &gt;&gt;&gt; states.ic.old = 4.0</span>
<span class="sd">        &gt;&gt;&gt; model.update_ic_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.ic</span>
<span class="sd">        ic(2.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_derived</span><span class="o">.</span><span class="n">NUL</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_fluxes</span><span class="o">.</span><span class="n">PC</span><span class="p">,</span> <span class="n">wland_fluxes</span><span class="o">.</span><span class="n">TF</span><span class="p">,</span> <span class="n">wland_fluxes</span><span class="o">.</span><span class="n">EI</span><span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_states</span><span class="o">.</span><span class="n">IC</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">old</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess_old</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess_new</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">nul</span><span class="p">):</span>
            <span class="n">new</span><span class="o">.</span><span class="n">ic</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">old</span><span class="o">.</span><span class="n">ic</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">pc</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">tf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">ei</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="n">new</span><span class="o">.</span><span class="n">ic</span><span class="p">[</span><span class="n">der</span><span class="o">.</span><span class="n">nul</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span></div>



<div class="viewcode-block" id="Update_SP_V1">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Update_SP_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Update_SP_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Update the storage deficit.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`\frac{dSP}{dt} = SF - AM`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.wland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nu(2)</span>
<span class="sd">        &gt;&gt;&gt; derived.nul.update()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.sf = 1.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.am = 2.0</span>
<span class="sd">        &gt;&gt;&gt; states.sp.old = 3.0</span>
<span class="sd">        &gt;&gt;&gt; model.update_sp_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.sp</span>
<span class="sd">        sp(2.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_derived</span><span class="o">.</span><span class="n">NUL</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_fluxes</span><span class="o">.</span><span class="n">SF</span><span class="p">,</span> <span class="n">wland_fluxes</span><span class="o">.</span><span class="n">AM</span><span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_states</span><span class="o">.</span><span class="n">SP</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">old</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess_old</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess_new</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">nul</span><span class="p">):</span>
            <span class="n">new</span><span class="o">.</span><span class="n">sp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">old</span><span class="o">.</span><span class="n">sp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">sf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">am</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="n">new</span><span class="o">.</span><span class="n">sp</span><span class="p">[</span><span class="n">der</span><span class="o">.</span><span class="n">nul</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span></div>



<div class="viewcode-block" id="Update_DVE_V1">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Update_DVE_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Update_DVE_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Update the elevated region&#39;s storage deficit of the vadose zone.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`\frac{dDV\!E}{dt} = -(PV\!E - ETV\!E - GR)`</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.wland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; derived.nuge(1)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.pve = 1.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.etve = 2.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.gr = 3.0</span>
<span class="sd">        &gt;&gt;&gt; states.dve.old = 5.0</span>
<span class="sd">        &gt;&gt;&gt; model.update_dve_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.dve</span>
<span class="sd">        dve(9.0)</span>

<span class="sd">        &gt;&gt;&gt; derived.nuge(0)</span>
<span class="sd">        &gt;&gt;&gt; model.update_dve_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.dve</span>
<span class="sd">        dve(nan)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_derived</span><span class="o">.</span><span class="n">NUGE</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_fluxes</span><span class="o">.</span><span class="n">PVE</span><span class="p">,</span> <span class="n">wland_fluxes</span><span class="o">.</span><span class="n">ETVE</span><span class="p">,</span> <span class="n">wland_fluxes</span><span class="o">.</span><span class="n">GR</span><span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_states</span><span class="o">.</span><span class="n">DVE</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">old</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess_old</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess_new</span>
        <span class="k">if</span> <span class="n">der</span><span class="o">.</span><span class="n">nuge</span><span class="p">:</span>
            <span class="n">new</span><span class="o">.</span><span class="n">dve</span> <span class="o">=</span> <span class="n">old</span><span class="o">.</span><span class="n">dve</span> <span class="o">-</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">pve</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">etve</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">gr</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new</span><span class="o">.</span><span class="n">dve</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">nan</span></div>



<div class="viewcode-block" id="Update_DV_V1">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Update_DV_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Update_DV_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Update the lowland region&#39;s storage deficit of the vadose zone.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`\frac{dDV}{dt} =</span>
<span class="sd">      - \left( FXG + PV - ETV - FGS + FGSE \cdot \frac{AGRE}{AGR} \right)`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.wland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; derived.nug(1)</span>
<span class="sd">        &gt;&gt;&gt; derived.agre(0.2)</span>
<span class="sd">        &gt;&gt;&gt; derived.agr(0.4)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.fxg = 1.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.pv = 2.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.etv = 3.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.fgs = 4.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.fgse = 5.0</span>
<span class="sd">        &gt;&gt;&gt; states.dv.old = 6.0</span>
<span class="sd">        &gt;&gt;&gt; model.update_dv_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.dv</span>
<span class="sd">        dv(7.5)</span>

<span class="sd">        &gt;&gt;&gt; derived.nug(0)</span>
<span class="sd">        &gt;&gt;&gt; model.update_dv_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.dv</span>
<span class="sd">        dv(nan)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_derived</span><span class="o">.</span><span class="n">NUG</span><span class="p">,</span> <span class="n">wland_derived</span><span class="o">.</span><span class="n">AGRE</span><span class="p">,</span> <span class="n">wland_derived</span><span class="o">.</span><span class="n">AGR</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">wland_fluxes</span><span class="o">.</span><span class="n">FXG</span><span class="p">,</span>
        <span class="n">wland_fluxes</span><span class="o">.</span><span class="n">PV</span><span class="p">,</span>
        <span class="n">wland_fluxes</span><span class="o">.</span><span class="n">ETV</span><span class="p">,</span>
        <span class="n">wland_fluxes</span><span class="o">.</span><span class="n">FGSE</span><span class="p">,</span>
        <span class="n">wland_fluxes</span><span class="o">.</span><span class="n">FGS</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_states</span><span class="o">.</span><span class="n">DV</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">old</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess_old</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess_new</span>
        <span class="k">if</span> <span class="n">der</span><span class="o">.</span><span class="n">nug</span><span class="p">:</span>
            <span class="n">new</span><span class="o">.</span><span class="n">dv</span> <span class="o">=</span> <span class="n">old</span><span class="o">.</span><span class="n">dv</span> <span class="o">-</span> <span class="p">(</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">fxg</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">pv</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">etv</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">fgs</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">fgse</span> <span class="o">*</span> <span class="n">der</span><span class="o">.</span><span class="n">agre</span> <span class="o">/</span> <span class="n">der</span><span class="o">.</span><span class="n">agr</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new</span><span class="o">.</span><span class="n">dv</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">nan</span></div>



<div class="viewcode-block" id="Update_HGE_V1">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Update_HGE_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Update_HGE_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Update the elevated region&#39;s groundwater level.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`\frac{dDGE}{dt} = CDG`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.wland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; thetas(0.5)</span>
<span class="sd">        &gt;&gt;&gt; derived.nuge(1)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.gr = 1.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.fgse = 2.0</span>
<span class="sd">        &gt;&gt;&gt; states.hge.old = 3.0</span>
<span class="sd">        &gt;&gt;&gt; model.update_hge_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.hge</span>
<span class="sd">        hge(1.0)</span>

<span class="sd">        &gt;&gt;&gt; derived.nuge(0)</span>
<span class="sd">        &gt;&gt;&gt; model.update_hge_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.hge</span>
<span class="sd">        hge(nan)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_control</span><span class="o">.</span><span class="n">ThetaS</span><span class="p">,)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_derived</span><span class="o">.</span><span class="n">NUGE</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_fluxes</span><span class="o">.</span><span class="n">GR</span><span class="p">,</span> <span class="n">wland_fluxes</span><span class="o">.</span><span class="n">FGSE</span><span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_states</span><span class="o">.</span><span class="n">HGE</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">old</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess_old</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess_new</span>
        <span class="k">if</span> <span class="n">der</span><span class="o">.</span><span class="n">nuge</span><span class="p">:</span>
            <span class="n">new</span><span class="o">.</span><span class="n">hge</span> <span class="o">=</span> <span class="n">old</span><span class="o">.</span><span class="n">hge</span> <span class="o">+</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">gr</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">fgse</span><span class="p">)</span> <span class="o">/</span> <span class="n">con</span><span class="o">.</span><span class="n">thetas</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new</span><span class="o">.</span><span class="n">hge</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">nan</span></div>



<div class="viewcode-block" id="Update_DG_V1">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Update_DG_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Update_DG_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Update the lowland region&#39;s groundwater depth.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`\frac{dDG}{dt} = CDG`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.wland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; derived.nug(1)</span>
<span class="sd">        &gt;&gt;&gt; states.dg.old = 2.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.cdg = 3.0</span>
<span class="sd">        &gt;&gt;&gt; model.update_dg_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.dg</span>
<span class="sd">        dg(5.0)</span>

<span class="sd">        &gt;&gt;&gt; derived.nug(0)</span>
<span class="sd">        &gt;&gt;&gt; model.update_dg_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.dg</span>
<span class="sd">        dg(nan)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_derived</span><span class="o">.</span><span class="n">NUG</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_fluxes</span><span class="o">.</span><span class="n">CDG</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_states</span><span class="o">.</span><span class="n">DG</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">old</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess_old</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess_new</span>
        <span class="k">if</span> <span class="n">der</span><span class="o">.</span><span class="n">nug</span><span class="p">:</span>
            <span class="n">new</span><span class="o">.</span><span class="n">dg</span> <span class="o">=</span> <span class="n">old</span><span class="o">.</span><span class="n">dg</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">cdg</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new</span><span class="o">.</span><span class="n">dg</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">nan</span></div>



<div class="viewcode-block" id="Update_HQ_V1">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Update_HQ_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Update_HQ_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Update the level of the quickflow reservoir.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`\frac{dHQ}{dt} = PQ - FQS`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.wland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; states.hq.old = 2.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.pq = 3.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.fqs = 4.0</span>
<span class="sd">        &gt;&gt;&gt; model.update_hq_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.hq</span>
<span class="sd">        hq(1.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_fluxes</span><span class="o">.</span><span class="n">PQ</span><span class="p">,</span> <span class="n">wland_fluxes</span><span class="o">.</span><span class="n">FQS</span><span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_states</span><span class="o">.</span><span class="n">HQ</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">old</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess_old</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess_new</span>
        <span class="n">new</span><span class="o">.</span><span class="n">hq</span> <span class="o">=</span> <span class="n">old</span><span class="o">.</span><span class="n">hq</span> <span class="o">+</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">pq</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">fqs</span><span class="p">)</span></div>



<div class="viewcode-block" id="Update_HS_V1">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Update_HS_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Update_HS_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Update the surface water level.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`\frac{dHS}{dt} =</span>
<span class="sd">      PS - ES + FXS + \frac{ALR \cdot FQS + AGR \cdot FGS - RH}{ASR}`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.wland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; derived.alr(0.8)</span>
<span class="sd">        &gt;&gt;&gt; derived.asr(0.2)</span>
<span class="sd">        &gt;&gt;&gt; derived.agr(0.8)</span>
<span class="sd">        &gt;&gt;&gt; states.hs.old = 2.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.fxs = 3.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.ps = 4.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.es = 5.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.fgs = 6.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.fqs = 7.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.rh = 8.0</span>
<span class="sd">        &gt;&gt;&gt; model.update_hs_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.hs</span>
<span class="sd">        hs(16.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_derived</span><span class="o">.</span><span class="n">ALR</span><span class="p">,</span> <span class="n">wland_derived</span><span class="o">.</span><span class="n">ASR</span><span class="p">,</span> <span class="n">wland_derived</span><span class="o">.</span><span class="n">AGR</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">wland_fluxes</span><span class="o">.</span><span class="n">FXS</span><span class="p">,</span>
        <span class="n">wland_fluxes</span><span class="o">.</span><span class="n">PS</span><span class="p">,</span>
        <span class="n">wland_fluxes</span><span class="o">.</span><span class="n">ES</span><span class="p">,</span>
        <span class="n">wland_fluxes</span><span class="o">.</span><span class="n">FGS</span><span class="p">,</span>
        <span class="n">wland_fluxes</span><span class="o">.</span><span class="n">FQS</span><span class="p">,</span>
        <span class="n">wland_fluxes</span><span class="o">.</span><span class="n">RH</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_states</span><span class="o">.</span><span class="n">HS</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">old</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess_old</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess_new</span>
        <span class="n">new</span><span class="o">.</span><span class="n">hs</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">old</span><span class="o">.</span><span class="n">hs</span>
            <span class="o">+</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">fxs</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">ps</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">es</span><span class="p">)</span>
            <span class="o">+</span> <span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">alr</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">fqs</span> <span class="o">+</span> <span class="n">der</span><span class="o">.</span><span class="n">agr</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">fgs</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">rh</span><span class="p">)</span> <span class="o">/</span> <span class="n">der</span><span class="o">.</span><span class="n">asr</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="Calc_R_V1">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Calc_R_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_R_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the runoff in m/s.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">       :math:`R = QF \cdot RH`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.wland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; derived.qf(2.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.rh = 3.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_r_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.r</span>
<span class="sd">        r(6.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_derived</span><span class="o">.</span><span class="n">QF</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_fluxes</span><span class="o">.</span><span class="n">RH</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_fluxes</span><span class="o">.</span><span class="n">R</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">r</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">qf</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">rh</span></div>



<div class="viewcode-block" id="Pass_R_V1">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Pass_R_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Pass_R_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update the outlet link sequence.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">       :math:`Q = R`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.wland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.r = 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.pass_r_v1()</span>
<span class="sd">        &gt;&gt;&gt; outlets.q</span>
<span class="sd">        q(2.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_fluxes</span><span class="o">.</span><span class="n">R</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_outlets</span><span class="o">.</span><span class="n">Q</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">outlets</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">out</span><span class="o">.</span><span class="n">q</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">r</span></div>



<div class="viewcode-block" id="Get_Temperature_V1">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Get_Temperature_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Get_Temperature_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the current subbasin-wide air temperature value (that applies to all</span>
<span class="sd">    hydrological response units so that the given index does not matter).</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.wland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; inputs.t = 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.get_temperature_v1(0)</span>
<span class="sd">        2.0</span>
<span class="sd">        &gt;&gt;&gt; model.get_temperature_v1(1)</span>
<span class="sd">        2.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_inputs</span><span class="o">.</span><span class="n">T</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">fastaccess</span>

        <span class="k">return</span> <span class="n">inp</span><span class="o">.</span><span class="n">t</span></div>



<div class="viewcode-block" id="Get_MeanTemperature_V1">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Get_MeanTemperature_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Get_MeanTemperature_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the current subbasin-wide air temperature value.</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.wland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; inputs.t = 2.0</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(model.get_meantemperature_v1())</span>
<span class="sd">        2.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_inputs</span><span class="o">.</span><span class="n">T</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">fastaccess</span>

        <span class="k">return</span> <span class="n">inp</span><span class="o">.</span><span class="n">t</span></div>



<div class="viewcode-block" id="Get_Precipitation_V1">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Get_Precipitation_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Get_Precipitation_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the current subbasin-wide precipitation value (that applies to all</span>
<span class="sd">    hydrological response units so that the given index does not matter).</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.wland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nu(2)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.pc = 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.get_precipitation_v1(0)</span>
<span class="sd">        2.0</span>
<span class="sd">        &gt;&gt;&gt; model.get_precipitation_v1(1)</span>
<span class="sd">        2.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_fluxes</span><span class="o">.</span><span class="n">PC</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>

        <span class="k">return</span> <span class="n">flu</span><span class="o">.</span><span class="n">pc</span></div>



<div class="viewcode-block" id="Get_SnowCover_V1">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Get_SnowCover_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Get_SnowCover_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the selected response unit&#39;s current snow cover degree.</span>

<span class="sd">    Example:</span>

<span class="sd">        Each response unit with a non-zero amount of snow counts as completely covered:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.wland import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nu(2)</span>
<span class="sd">        &gt;&gt;&gt; states.sp = 0.0, 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.get_snowcover_v1(0)</span>
<span class="sd">        0.0</span>
<span class="sd">        &gt;&gt;&gt; model.get_snowcover_v1(1)</span>
<span class="sd">        1.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">wland_states</span><span class="o">.</span><span class="n">SP</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>

        <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">sp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">1.0</span>
        <span class="k">return</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="PegasusDGEq">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.PegasusDGEq">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">PegasusDGEq</span><span class="p">(</span><span class="n">roottools</span><span class="o">.</span><span class="n">Pegasus</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pegasus iterator for finding the equilibrium groundwater depth.&quot;&quot;&quot;</span>

    <span class="n">METHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Return_ErrorDV_V1</span><span class="p">,)</span></div>



<div class="viewcode-block" id="QuadDVEq_V1">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.QuadDVEq_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">QuadDVEq_V1</span><span class="p">(</span><span class="n">quadtools</span><span class="o">.</span><span class="n">Quad</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Adaptive quadrature method for integrating the equilibrium storage deficit</span>
<span class="sd">    of the vadose zone.&quot;&quot;&quot;</span>

    <span class="n">METHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Return_DVH_V1</span><span class="p">,)</span></div>



<div class="viewcode-block" id="QuadDVEq_V2">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.QuadDVEq_V2">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">QuadDVEq_V2</span><span class="p">(</span><span class="n">quadtools</span><span class="o">.</span><span class="n">Quad</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Adaptive quadrature method for integrating the equilibrium storage deficit</span>
<span class="sd">    of the vadose zone.&quot;&quot;&quot;</span>

    <span class="n">METHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Return_DVH_V2</span><span class="p">,)</span></div>



<div class="viewcode-block" id="Model">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Model">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Model</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">ELSModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;|wland.DOCNAME.complete|&quot;&quot;&quot;</span>

    <span class="n">DOCNAME</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">DocName</span><span class="p">(</span><span class="n">short</span><span class="o">=</span><span class="s2">&quot;W&quot;</span><span class="p">)</span>
    <span class="n">__HYDPY_ROOTMODEL__</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">SOLVERPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">wland_solver</span><span class="o">.</span><span class="n">AbsErrorMax</span><span class="p">,</span>
        <span class="n">wland_solver</span><span class="o">.</span><span class="n">RelErrorMax</span><span class="p">,</span>
        <span class="n">wland_solver</span><span class="o">.</span><span class="n">RelDTMin</span><span class="p">,</span>
        <span class="n">wland_solver</span><span class="o">.</span><span class="n">RelDTMax</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">SOLVERSEQUENCES</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">INLET_METHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Calc_PE_PET_V1</span><span class="p">,</span> <span class="n">Calc_FR_V1</span><span class="p">,</span> <span class="n">Calc_PM_V1</span><span class="p">)</span>
    <span class="n">OBSERVER_METHODS</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">RECEIVER_METHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Pick_HS_V1</span><span class="p">,)</span>
    <span class="n">INTERFACE_METHODS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Get_Temperature_V1</span><span class="p">,</span>
        <span class="n">Get_MeanTemperature_V1</span><span class="p">,</span>
        <span class="n">Get_Precipitation_V1</span><span class="p">,</span>
        <span class="n">Get_SnowCover_V1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ADD_METHODS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Calc_PE_PET_PETModel_V1</span><span class="p">,</span>
        <span class="n">Calc_PE_PET_PETModel_V2</span><span class="p">,</span>
        <span class="n">Return_ErrorDV_V1</span><span class="p">,</span>
        <span class="n">Return_DVH_V1</span><span class="p">,</span>
        <span class="n">Return_DVH_V2</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">PART_ODE_METHODS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Calc_FXS_V1</span><span class="p">,</span>
        <span class="n">Calc_FXG_V1</span><span class="p">,</span>
        <span class="n">Calc_PC_V1</span><span class="p">,</span>
        <span class="n">Calc_TF_V1</span><span class="p">,</span>
        <span class="n">Calc_EI_V1</span><span class="p">,</span>
        <span class="n">Calc_SF_V1</span><span class="p">,</span>
        <span class="n">Calc_RF_V1</span><span class="p">,</span>
        <span class="n">Calc_AM_V1</span><span class="p">,</span>
        <span class="n">Calc_PS_V1</span><span class="p">,</span>
        <span class="n">Calc_WE_W_V1</span><span class="p">,</span>
        <span class="n">Calc_PVE_PV_V1</span><span class="p">,</span>
        <span class="n">Calc_PQ_V1</span><span class="p">,</span>
        <span class="n">Calc_BetaE_Beta_V1</span><span class="p">,</span>
        <span class="n">Calc_ETVE_ETV_V1</span><span class="p">,</span>
        <span class="n">Calc_ES_V1</span><span class="p">,</span>
        <span class="n">Calc_FQS_V1</span><span class="p">,</span>
        <span class="n">Calc_FGSE_V1</span><span class="p">,</span>
        <span class="n">Calc_FGS_V1</span><span class="p">,</span>
        <span class="n">Calc_RH_V1</span><span class="p">,</span>
        <span class="n">Calc_DVEq_V1</span><span class="p">,</span>
        <span class="n">Calc_DVEq_V2</span><span class="p">,</span>
        <span class="n">Calc_DVEq_V3</span><span class="p">,</span>
        <span class="n">Calc_DVEq_V4</span><span class="p">,</span>
        <span class="n">Calc_DGEq_V1</span><span class="p">,</span>
        <span class="n">Calc_GF_V1</span><span class="p">,</span>
        <span class="n">Calc_GR_V1</span><span class="p">,</span>
        <span class="n">Calc_CDG_V1</span><span class="p">,</span>
        <span class="n">Calc_CDG_V2</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">FULL_ODE_METHODS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Update_IC_V1</span><span class="p">,</span>
        <span class="n">Update_SP_V1</span><span class="p">,</span>
        <span class="n">Update_DVE_V1</span><span class="p">,</span>
        <span class="n">Update_DV_V1</span><span class="p">,</span>
        <span class="n">Update_HGE_V1</span><span class="p">,</span>
        <span class="n">Update_DG_V1</span><span class="p">,</span>
        <span class="n">Update_HQ_V1</span><span class="p">,</span>
        <span class="n">Update_HS_V1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">OUTLET_METHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Calc_ET_V1</span><span class="p">,</span> <span class="n">Calc_R_V1</span><span class="p">,</span> <span class="n">Pass_R_V1</span><span class="p">)</span>
    <span class="n">SENDER_METHODS</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">SUBMODELINTERFACES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">petinterfaces</span><span class="o">.</span><span class="n">PETModel_V1</span><span class="p">,</span>
        <span class="n">petinterfaces</span><span class="o">.</span><span class="n">PETModel_V2</span><span class="p">,</span>
        <span class="n">dischargeinterfaces</span><span class="o">.</span><span class="n">DischargeModel_V2</span><span class="p">,</span>
        <span class="n">stateinterfaces</span><span class="o">.</span><span class="n">WaterLevelModel_V1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">SUBMODELS</span> <span class="o">=</span> <span class="p">(</span><span class="n">PegasusDGEq</span><span class="p">,</span> <span class="n">QuadDVEq_V1</span><span class="p">,</span> <span class="n">QuadDVEq_V2</span><span class="p">)</span>

    <span class="n">petmodel</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelProperty</span><span class="p">(</span>
        <span class="n">petinterfaces</span><span class="o">.</span><span class="n">PETModel_V1</span><span class="p">,</span> <span class="n">petinterfaces</span><span class="o">.</span><span class="n">PETModel_V2</span>
    <span class="p">)</span>
    <span class="n">petmodel_is_mainmodel</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelIsMainmodelProperty</span><span class="p">()</span>
    <span class="n">petmodel_typeid</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelTypeIDProperty</span><span class="p">()</span>

    <span class="n">dischargemodel</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelProperty</span><span class="p">(</span><span class="n">dischargeinterfaces</span><span class="o">.</span><span class="n">DischargeModel_V2</span><span class="p">)</span>
    <span class="n">dischargemodel_is_mainmodel</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelIsMainmodelProperty</span><span class="p">()</span>
    <span class="n">dischargemodel_typeid</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelTypeIDProperty</span><span class="p">()</span>

    <span class="n">waterlevelmodel</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelProperty</span><span class="p">(</span><span class="n">stateinterfaces</span><span class="o">.</span><span class="n">WaterLevelModel_V1</span><span class="p">)</span>
    <span class="n">waterlevelmodel_is_mainmodel</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelIsMainmodelProperty</span><span class="p">()</span>
    <span class="n">waterlevelmodel_typeid</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelTypeIDProperty</span><span class="p">()</span></div>



<div class="viewcode-block" id="BaseModel">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.BaseModel">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">BaseModel</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">ELSModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base model for |wland_wag| and |wland_gd|.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="BaseModel.check_waterbalance">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.BaseModel.check_waterbalance">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_waterbalance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initial_conditions</span><span class="p">:</span> <span class="n">ConditionsModel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Determine the water balance error of the previous simulation run in mm.</span>

<span class="sd">        Method |BaseModel.check_waterbalance| calculates the balance error as follows:</span>

<span class="sd">          .. math::</span>
<span class="sd">            Error = \Sigma In - \Sigma Out + \Sigma \Delta H -</span>
<span class="sd">            \Delta Vol_{basin} - \Delta Vol_{hru}</span>
<span class="sd">            \\ \\</span>
<span class="sd">            \Sigma In = \sum_{t=t_0}^{t_1} PC_t + FXG_t + FXS_t</span>
<span class="sd">            \\</span>
<span class="sd">            \Sigma Out = \sum_{t=t_0}^{t_1} ET_t + RH_t</span>
<span class="sd">            \\</span>
<span class="sd">            \Sigma \Delta H= ASR \cdot \sum_{t=t_0}^{t_1} DHS_t</span>
<span class="sd">            \\</span>
<span class="sd">            \Delta Vol_{basin} =</span>
<span class="sd">            ALR \cdot f_{\Delta}(HQ)</span>
<span class="sd">            + AGRE \cdot \big( ThetaS \cdot f_{\Delta}(HGE) - f_{\Delta}(DV\!E) \big)</span>
<span class="sd">            - AGR \cdot f_{\Delta}(DV)</span>
<span class="sd">            + ASR \cdot f_{\Delta}(HS)</span>
<span class="sd">            \\</span>
<span class="sd">            \Delta Vol_{hru} = \sum_{k=1}^{NUL} AUR^k \cdot \big(</span>
<span class="sd">            f_{\Delta}(IC^k) + f_{\Delta}(SP)</span>
<span class="sd">            \big)</span>
<span class="sd">            \\ \\</span>
<span class="sd">            f_{\Delta}(x) = x_{t1} - x_{t0}</span>

<span class="sd">        The returned error should always be in scale with numerical precision so that</span>
<span class="sd">        it does not affect the simulation results in any relevant manner.</span>

<span class="sd">        Pick the required initial conditions before starting the simulation via</span>
<span class="sd">        property |Sequences.conditions|.  See the integration tests of the application</span>
<span class="sd">        model |wland_wag| for some examples.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">control</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span>
        <span class="n">derived</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">inputs</span>
        <span class="n">factors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span>
        <span class="n">fluxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span>
        <span class="n">last</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span>
        <span class="n">first</span> <span class="o">=</span> <span class="n">initial_conditions</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">][</span><span class="s2">&quot;states&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">derived</span><span class="o">.</span><span class="n">nug</span><span class="p">:</span>
            <span class="n">delta_dv</span> <span class="o">=</span> <span class="p">(</span><span class="n">last</span><span class="o">.</span><span class="n">dv</span> <span class="o">-</span> <span class="n">first</span><span class="p">[</span><span class="s2">&quot;dv&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="n">derived</span><span class="o">.</span><span class="n">agr</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">delta_dv</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">if</span> <span class="n">derived</span><span class="o">.</span><span class="n">nuge</span><span class="p">:</span>
            <span class="n">delta_dve</span> <span class="o">=</span> <span class="p">(</span><span class="n">last</span><span class="o">.</span><span class="n">dve</span> <span class="o">-</span> <span class="n">first</span><span class="p">[</span><span class="s2">&quot;dve&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="n">derived</span><span class="o">.</span><span class="n">agre</span>
            <span class="n">delta_hge</span> <span class="o">=</span> <span class="p">(</span><span class="n">last</span><span class="o">.</span><span class="n">hge</span> <span class="o">-</span> <span class="n">first</span><span class="p">[</span><span class="s2">&quot;hge&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="n">derived</span><span class="o">.</span><span class="n">agre</span> <span class="o">*</span> <span class="n">control</span><span class="o">.</span><span class="n">thetas</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">delta_dve</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">delta_hge</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="nb">sum</span><span class="p">(</span><span class="n">fluxes</span><span class="o">.</span><span class="n">pc</span><span class="o">.</span><span class="n">series</span><span class="p">)</span>
            <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="n">inputs</span><span class="o">.</span><span class="n">fxg</span><span class="o">.</span><span class="n">series</span><span class="p">)</span>
            <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="n">inputs</span><span class="o">.</span><span class="n">fxs</span><span class="o">.</span><span class="n">series</span><span class="p">)</span>
            <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">fluxes</span><span class="o">.</span><span class="n">et</span><span class="o">.</span><span class="n">series</span><span class="p">)</span>
            <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">fluxes</span><span class="o">.</span><span class="n">rh</span><span class="o">.</span><span class="n">series</span><span class="p">)</span>
            <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="n">factors</span><span class="o">.</span><span class="n">dhs</span><span class="o">.</span><span class="n">series</span><span class="p">)</span> <span class="o">*</span> <span class="n">derived</span><span class="o">.</span><span class="n">asr</span>
            <span class="o">-</span> <span class="nb">sum</span><span class="p">((</span><span class="n">last</span><span class="o">.</span><span class="n">ic</span> <span class="o">-</span> <span class="n">first</span><span class="p">[</span><span class="s2">&quot;ic&quot;</span><span class="p">])[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">control</span><span class="o">.</span><span class="n">aur</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="o">-</span> <span class="nb">sum</span><span class="p">((</span><span class="n">last</span><span class="o">.</span><span class="n">sp</span> <span class="o">-</span> <span class="n">first</span><span class="p">[</span><span class="s2">&quot;sp&quot;</span><span class="p">])[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">control</span><span class="o">.</span><span class="n">aur</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="o">+</span> <span class="n">delta_dve</span>
            <span class="o">+</span> <span class="n">delta_dv</span>
            <span class="o">-</span> <span class="p">(</span><span class="n">last</span><span class="o">.</span><span class="n">hq</span> <span class="o">-</span> <span class="n">first</span><span class="p">[</span><span class="s2">&quot;hq&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="n">derived</span><span class="o">.</span><span class="n">alr</span>
            <span class="o">-</span> <span class="n">delta_hge</span>
            <span class="o">-</span> <span class="p">(</span><span class="n">last</span><span class="o">.</span><span class="n">hs</span> <span class="o">-</span> <span class="n">first</span><span class="p">[</span><span class="s2">&quot;hs&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="n">derived</span><span class="o">.</span><span class="n">asr</span>
        <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="Main_PETModel_V1">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Main_PETModel_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Main_PETModel_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">ELSModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for |wland.DOCNAME.long| models that use submodels that comply with</span>
<span class="sd">    the |PETModel_V1| interface.&quot;&quot;&quot;</span>

    <span class="n">petmodel</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelProperty</span>
    <span class="n">petmodel_is_mainmodel</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelIsMainmodelProperty</span><span class="p">()</span>
    <span class="n">petmodel_typeid</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelTypeIDProperty</span><span class="p">()</span>

    <span class="nd">@importtools</span><span class="o">.</span><span class="n">prepare_submodel</span><span class="p">(</span>
        <span class="s2">&quot;petmodel&quot;</span><span class="p">,</span>
        <span class="n">petinterfaces</span><span class="o">.</span><span class="n">PETModel_V1</span><span class="p">,</span>
        <span class="n">petinterfaces</span><span class="o">.</span><span class="n">PETModel_V1</span><span class="o">.</span><span class="n">prepare_nmbzones</span><span class="p">,</span>
        <span class="n">petinterfaces</span><span class="o">.</span><span class="n">PETModel_V1</span><span class="o">.</span><span class="n">prepare_subareas</span><span class="p">,</span>
        <span class="n">petinterfaces</span><span class="o">.</span><span class="n">PETModel_V1</span><span class="o">.</span><span class="n">prepare_zonetypes</span><span class="p">,</span>
        <span class="n">landtype_constants</span><span class="o">=</span><span class="n">wland_constants</span><span class="o">.</span><span class="n">LANDUSE_CONSTANTS</span><span class="p">,</span>
        <span class="n">landtype_refindices</span><span class="o">=</span><span class="n">wland_control</span><span class="o">.</span><span class="n">LT</span><span class="p">,</span>
        <span class="n">refweights</span><span class="o">=</span><span class="n">wland_control</span><span class="o">.</span><span class="n">AUR</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_petmodel_v1</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">petmodel</span><span class="p">:</span> <span class="n">petinterfaces</span><span class="o">.</span><span class="n">PETModel_V1</span><span class="p">,</span>
        <span class="o">/</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">refresh</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>  <span class="c1"># pylint: disable=unused-argument</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialise the given `petmodel` that follows the |PETModel_V1| interface.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.wland_wag import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nu(3)</span>
<span class="sd">        &gt;&gt;&gt; at(10.0)</span>
<span class="sd">        &gt;&gt;&gt; aur(0.5, 0.3, 0.2)</span>
<span class="sd">        &gt;&gt;&gt; lt(FIELD, TREES, WATER)</span>
<span class="sd">        &gt;&gt;&gt; with model.add_petmodel_v1(&quot;evap_ret_tw2002&quot;):</span>
<span class="sd">        ...     nmbhru</span>
<span class="sd">        ...     hruarea</span>
<span class="sd">        ...     evapotranspirationfactor(field=1.0, trees=2.0, water=1.5)</span>
<span class="sd">        ...     for method, arguments in model.preparemethod2arguments.items():</span>
<span class="sd">        ...         print(method, arguments[0][0], sep=&quot;: &quot;)</span>
<span class="sd">        nmbhru(3)</span>
<span class="sd">        hruarea(5.0, 3.0, 2.0)</span>
<span class="sd">        prepare_nmbzones: 3</span>
<span class="sd">        prepare_zonetypes: [13 19 23]</span>
<span class="sd">        prepare_subareas: [5. 3. 2.]</span>

<span class="sd">        &gt;&gt;&gt; etf = model.petmodel.parameters.control.evapotranspirationfactor</span>
<span class="sd">        &gt;&gt;&gt; etf</span>
<span class="sd">        evapotranspirationfactor(field=1.0, trees=2.0, water=1.5)</span>
<span class="sd">        &gt;&gt;&gt; lt(TREES, FIELD, WATER)</span>
<span class="sd">        &gt;&gt;&gt; etf</span>
<span class="sd">        evapotranspirationfactor(field=2.0, trees=1.0, water=1.5)</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(etf.average_values())</span>
<span class="sd">        1.4</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">control</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span>
        <span class="n">petmodel</span><span class="o">.</span><span class="n">prepare_nmbzones</span><span class="p">(</span><span class="n">control</span><span class="o">.</span><span class="n">nu</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="n">petmodel</span><span class="o">.</span><span class="n">prepare_zonetypes</span><span class="p">(</span><span class="n">control</span><span class="o">.</span><span class="n">lt</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">petmodel</span><span class="o">.</span><span class="n">prepare_subareas</span><span class="p">(</span><span class="n">control</span><span class="o">.</span><span class="n">at</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">control</span><span class="o">.</span><span class="n">aur</span><span class="o">.</span><span class="n">values</span><span class="p">)</span></div>



<div class="viewcode-block" id="Main_PETModel_V2">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Main_PETModel_V2">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Main_PETModel_V2</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">ELSModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for |wland.DOCNAME.long| models that use submodels that comply with</span>
<span class="sd">    the |PETModel_V2| interface.&quot;&quot;&quot;</span>

    <span class="n">petmodel</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelProperty</span>
    <span class="n">petmodel_is_mainmodel</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelIsMainmodelProperty</span><span class="p">()</span>
    <span class="n">petmodel_typeid</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelTypeIDProperty</span><span class="p">()</span>

    <span class="nd">@importtools</span><span class="o">.</span><span class="n">prepare_submodel</span><span class="p">(</span>
        <span class="s2">&quot;petmodel&quot;</span><span class="p">,</span>
        <span class="n">petinterfaces</span><span class="o">.</span><span class="n">PETModel_V2</span><span class="p">,</span>
        <span class="n">petinterfaces</span><span class="o">.</span><span class="n">PETModel_V2</span><span class="o">.</span><span class="n">prepare_nmbzones</span><span class="p">,</span>
        <span class="n">petinterfaces</span><span class="o">.</span><span class="n">PETModel_V2</span><span class="o">.</span><span class="n">prepare_subareas</span><span class="p">,</span>
        <span class="n">petinterfaces</span><span class="o">.</span><span class="n">PETModel_V2</span><span class="o">.</span><span class="n">prepare_zonetypes</span><span class="p">,</span>
        <span class="n">petinterfaces</span><span class="o">.</span><span class="n">PETModel_V2</span><span class="o">.</span><span class="n">prepare_water</span><span class="p">,</span>
        <span class="n">petinterfaces</span><span class="o">.</span><span class="n">PETModel_V2</span><span class="o">.</span><span class="n">prepare_interception</span><span class="p">,</span>
        <span class="n">petinterfaces</span><span class="o">.</span><span class="n">PETModel_V2</span><span class="o">.</span><span class="n">prepare_soil</span><span class="p">,</span>
        <span class="n">petinterfaces</span><span class="o">.</span><span class="n">PETModel_V2</span><span class="o">.</span><span class="n">prepare_plant</span><span class="p">,</span>
        <span class="n">petinterfaces</span><span class="o">.</span><span class="n">PETModel_V2</span><span class="o">.</span><span class="n">prepare_tree</span><span class="p">,</span>
        <span class="n">petinterfaces</span><span class="o">.</span><span class="n">PETModel_V2</span><span class="o">.</span><span class="n">prepare_leafareaindex</span><span class="p">,</span>
        <span class="n">landtype_constants</span><span class="o">=</span><span class="n">wland_constants</span><span class="o">.</span><span class="n">LANDUSE_CONSTANTS</span><span class="p">,</span>
        <span class="n">landtype_refindices</span><span class="o">=</span><span class="n">wland_control</span><span class="o">.</span><span class="n">LT</span><span class="p">,</span>
        <span class="n">refweights</span><span class="o">=</span><span class="n">wland_control</span><span class="o">.</span><span class="n">AUR</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_petmodel_v2</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">petmodel</span><span class="p">:</span> <span class="n">petinterfaces</span><span class="o">.</span><span class="n">PETModel_V2</span><span class="p">,</span>
        <span class="o">/</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">refresh</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>  <span class="c1"># pylint: disable=unused-argument</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialise the given `petmodel` that follows the |PETModel_V2| interface.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-01&quot;, &quot;2001-01-01&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.wland_wag import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nu(12)</span>
<span class="sd">        &gt;&gt;&gt; at(10.0)</span>
<span class="sd">        &gt;&gt;&gt; aur(0.006, 0.02, 0.034, 0.048, 0.062, 0.076,</span>
<span class="sd">        ...     0.09, 0.104, 0.118, 0.132, 0.146, 0.164)</span>
<span class="sd">        &gt;&gt;&gt; lt(SEALED, FIELD, WINE, ORCHARD, SOIL, PASTURE,</span>
<span class="sd">        ...    WETLAND, TREES, CONIFER, DECIDIOUS, MIXED, WATER)</span>
<span class="sd">        &gt;&gt;&gt; lai(1.0)</span>
<span class="sd">        &gt;&gt;&gt; lai.conifer_jan = 2.0</span>
<span class="sd">        &gt;&gt;&gt; lai.pasture_dec = 3.0</span>
<span class="sd">        &gt;&gt;&gt; with model.add_petmodel_v2(&quot;evap_pet_ambav1&quot;) as petmodel:</span>
<span class="sd">        ...     nmbhru</span>
<span class="sd">        ...     hrutype</span>
<span class="sd">        ...     water</span>
<span class="sd">        ...     interception</span>
<span class="sd">        ...     soil</span>
<span class="sd">        ...     plant</span>
<span class="sd">        ...     my_lai = leafareaindex</span>
<span class="sd">        ...     &quot;my_lai&quot;, my_lai.field_jun, my_lai.conifer_jan, my_lai.pasture_dec</span>
<span class="sd">        ...     petmodel.preparemethod2arguments[&quot;prepare_nmbzones&quot;]</span>
<span class="sd">        ...     petmodel.preparemethod2arguments[&quot;prepare_subareas&quot;]</span>
<span class="sd">        ...     groundalbedo(conifer=0.05, decidious=0.1, field=0.15, mixed=0.2,</span>
<span class="sd">        ...                  orchard=0.25, pasture=0.3, sealed=0.35, soil=0.4,</span>
<span class="sd">        ...                  trees=0.45, water=0.5, wetland=0.55, wine=0.6)</span>
<span class="sd">        ...     for method, arguments in model.preparemethod2arguments.items():</span>
<span class="sd">        ...         print(method, arguments[0][0], sep=&quot;: &quot;)  # doctest: +ELLIPSIS</span>
<span class="sd">        nmbhru(12)</span>
<span class="sd">        hrutype(SEALED, FIELD, WINE, ORCHARD, SOIL, PASTURE, WETLAND, TREES,</span>
<span class="sd">                CONIFER, DECIDIOUS, MIXED, WATER)</span>
<span class="sd">        water(conifer=False, decidious=False, field=False, mixed=False,</span>
<span class="sd">              orchard=False, pasture=False, sealed=False, soil=False,</span>
<span class="sd">              trees=False, water=True, wetland=False, wine=False)</span>
<span class="sd">        interception(conifer=True, decidious=True, field=True, mixed=True,</span>
<span class="sd">                     orchard=True, pasture=True, sealed=True, soil=True,</span>
<span class="sd">                     trees=True, water=False, wetland=True, wine=True)</span>
<span class="sd">        soil(conifer=True, decidious=True, field=True, mixed=True,</span>
<span class="sd">             orchard=True, pasture=True, sealed=False, soil=True, trees=True,</span>
<span class="sd">             water=False, wetland=True, wine=True)</span>
<span class="sd">        plant(conifer=True, decidious=True, field=True, mixed=True,</span>
<span class="sd">              orchard=True, pasture=True, sealed=False, soil=False,</span>
<span class="sd">              trees=True, water=False, wetland=True, wine=True)</span>
<span class="sd">        (&#39;my_lai&#39;, 1.0, 2.0, 3.0)</span>
<span class="sd">        ((12,), {})</span>
<span class="sd">        ((array([0.06, 0.2 , 0.34, 0.48, 0.62, 0.76, 0.9 , 1.04, 1.18, 1.32, 1.46,</span>
<span class="sd">               1.64]),), {})</span>
<span class="sd">        prepare_nmbzones: 12</span>
<span class="sd">        prepare_zonetypes: [12 13 14 15 16 17 18 19 20 21 22 23]</span>
<span class="sd">        prepare_subareas: [0.06 0.2  0.34 0.48 0.62 0.76 0.9  1.04 1.18 1.32 1.46 1.64]</span>
<span class="sd">        prepare_leafareaindex: [[1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.]</span>
<span class="sd">        ...</span>
<span class="sd">        prepare_water: [False False False False False False False False False False \</span>
<span class="sd">False  True]</span>
<span class="sd">        prepare_interception: [ True  True  True  True  True  True  True  True  True  \</span>
<span class="sd">True  True False]</span>
<span class="sd">        prepare_soil: [False  True  True  True  True  True  True  True  True  True  \</span>
<span class="sd">True False]</span>
<span class="sd">        prepare_plant: [False  True  True  True False  True  True  True  True  True  \</span>
<span class="sd">True False]</span>
<span class="sd">        prepare_tree: [False False False False False False False False  True  True  \</span>
<span class="sd">True False]</span>

<span class="sd">        &gt;&gt;&gt; assert model is model.petmodel.tempmodel</span>
<span class="sd">        &gt;&gt;&gt; assert model is model.petmodel.precipmodel</span>
<span class="sd">        &gt;&gt;&gt; assert model is model.petmodel.snowcovermodel</span>

<span class="sd">        &gt;&gt;&gt; ga = model.petmodel.parameters.control.groundalbedo</span>
<span class="sd">        &gt;&gt;&gt; ga</span>
<span class="sd">        groundalbedo(conifer=0.05, decidious=0.1, field=0.15, mixed=0.2,</span>
<span class="sd">                     orchard=0.25, pasture=0.3, sealed=0.35, soil=0.4,</span>
<span class="sd">                     trees=0.45, water=0.5, wetland=0.55, wine=0.6)</span>
<span class="sd">        &gt;&gt;&gt; lt(FIELD, SEALED, WINE, ORCHARD, SOIL, PASTURE,</span>
<span class="sd">        ...    WETLAND, TREES, CONIFER, DECIDIOUS, MIXED, WATER)</span>
<span class="sd">        &gt;&gt;&gt; ga</span>
<span class="sd">        groundalbedo(conifer=0.05, decidious=0.1, field=0.35, mixed=0.2,</span>
<span class="sd">                     orchard=0.25, pasture=0.3, sealed=0.15, soil=0.4,</span>
<span class="sd">                     trees=0.45, water=0.5, wetland=0.55, wine=0.6)</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(ga.average_values())</span>
<span class="sd">        0.3117</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">control</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span>
        <span class="n">nu</span> <span class="o">=</span> <span class="n">control</span><span class="o">.</span><span class="n">nu</span><span class="o">.</span><span class="n">value</span>
        <span class="n">lt</span> <span class="o">=</span> <span class="n">control</span><span class="o">.</span><span class="n">lt</span><span class="o">.</span><span class="n">values</span>

        <span class="n">petmodel</span><span class="o">.</span><span class="n">prepare_nmbzones</span><span class="p">(</span><span class="n">nu</span><span class="p">)</span>
        <span class="n">petmodel</span><span class="o">.</span><span class="n">prepare_zonetypes</span><span class="p">(</span><span class="n">lt</span><span class="p">)</span>
        <span class="n">petmodel</span><span class="o">.</span><span class="n">prepare_subareas</span><span class="p">(</span><span class="n">control</span><span class="o">.</span><span class="n">at</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">control</span><span class="o">.</span><span class="n">aur</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">petmodel</span><span class="o">.</span><span class="n">prepare_leafareaindex</span><span class="p">(</span><span class="n">control</span><span class="o">.</span><span class="n">lai</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">sel</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">NP_BOOL</span><span class="p">)</span>
        <span class="n">sel</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">petmodel</span><span class="o">.</span><span class="n">prepare_water</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span>
        <span class="n">sel</span> <span class="o">=</span> <span class="o">~</span><span class="n">sel</span>
        <span class="n">petmodel</span><span class="o">.</span><span class="n">prepare_interception</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span>
        <span class="n">sel</span><span class="p">[</span><span class="n">lt</span> <span class="o">==</span> <span class="n">SEALED</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">petmodel</span><span class="o">.</span><span class="n">prepare_soil</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span>
        <span class="n">sel</span><span class="p">[</span><span class="n">lt</span> <span class="o">==</span> <span class="n">SOIL</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">petmodel</span><span class="o">.</span><span class="n">prepare_plant</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span>
        <span class="n">sel</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">NP_BOOL</span><span class="p">)</span>
        <span class="n">sel</span><span class="p">[</span><span class="n">lt</span> <span class="o">==</span> <span class="n">CONIFER</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">sel</span><span class="p">[</span><span class="n">lt</span> <span class="o">==</span> <span class="n">DECIDIOUS</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">sel</span><span class="p">[</span><span class="n">lt</span> <span class="o">==</span> <span class="n">MIXED</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">petmodel</span><span class="o">.</span><span class="n">prepare_tree</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span></div>



<div class="viewcode-block" id="Main_DischargeModel_V2">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Main_DischargeModel_V2">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Main_DischargeModel_V2</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">ELSModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for |wland.DOCNAME.long| models that use submodels that comply with</span>
<span class="sd">    the |DischargeModel_V2| interface.&quot;&quot;&quot;</span>

    <span class="n">dischargemodel</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelProperty</span>
    <span class="n">dischargemodel_is_mainmodel</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelIsMainmodelProperty</span><span class="p">()</span>
    <span class="n">dischargemodel_typeid</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelTypeIDProperty</span><span class="p">()</span>

    <span class="nd">@importtools</span><span class="o">.</span><span class="n">prepare_submodel</span><span class="p">(</span>
        <span class="s2">&quot;dischargemodel&quot;</span><span class="p">,</span>
        <span class="n">dischargeinterfaces</span><span class="o">.</span><span class="n">DischargeModel_V2</span><span class="p">,</span>
        <span class="n">dischargeinterfaces</span><span class="o">.</span><span class="n">DischargeModel_V2</span><span class="o">.</span><span class="n">prepare_channeldepth</span><span class="p">,</span>
        <span class="n">dischargeinterfaces</span><span class="o">.</span><span class="n">DischargeModel_V2</span><span class="o">.</span><span class="n">prepare_tolerance</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_dischargemodel_v2</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dischargemodel</span><span class="p">:</span> <span class="n">dischargeinterfaces</span><span class="o">.</span><span class="n">DischargeModel_V2</span><span class="p">,</span>
        <span class="o">/</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">refresh</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>  <span class="c1"># pylint: disable=unused-argument</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialise the given `dischargemodel` that follows the |DischargeModel_V2|</span>
<span class="sd">        interface.</span>

<span class="sd">        Note the dependency on the derived parameter |CD|:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.wland_wag import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; sh(10.0)</span>
<span class="sd">        &gt;&gt;&gt; with model.add_dischargemodel_v2(&quot;wq_walrus&quot;, update=False):</span>
<span class="sd">        ...     pass</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        hydpy.core.exceptiontools.AttributeNotReady: While trying to add a submodel \</span>
<span class="sd">to the main model `wland_wag`, the following error occurred: While trying to \</span>
<span class="sd">determine the missing value of the derived parameter `cd` of element `?`, the \</span>
<span class="sd">following error occurred: While trying to subtract variable `gl` and `BL` instance \</span>
<span class="sd">`bl(?)`, the following error occurred: For variable `bl`, no value has been defined \</span>
<span class="sd">so far.</span>

<span class="sd">        You can define its value manually for testing:</span>

<span class="sd">        &gt;&gt;&gt; derived.cd(2000.0)</span>
<span class="sd">        &gt;&gt;&gt; with model.add_dischargemodel_v2(&quot;wq_walrus&quot;, update=False):</span>
<span class="sd">        ...     channeldepth</span>
<span class="sd">        ...     crestheighttolerance</span>
<span class="sd">        channeldepth(2.0)</span>
<span class="sd">        crestheighttolerance(0.01)</span>

<span class="sd">        &gt;&gt;&gt; model.dischargemodel.parameters.control.channeldepth</span>
<span class="sd">        channeldepth(2.0)</span>
<span class="sd">        &gt;&gt;&gt; model.dischargemodel.parameters.control.crestheighttolerance</span>
<span class="sd">        crestheighttolerance(0.01)</span>

<span class="sd">        However, |Main_DischargeModel_V2.add_dischargemodel_v2| updates the channel</span>
<span class="sd">        depth whenever possible to make the added submodel consistent with the main</span>
<span class="sd">        model&#39;s current control parameter values:</span>

<span class="sd">        &gt;&gt;&gt; gl(4.0)</span>
<span class="sd">        &gt;&gt;&gt; bl(3.0)</span>
<span class="sd">        &gt;&gt;&gt; with model.add_dischargemodel_v2(&quot;wq_walrus&quot;, update=False):</span>
<span class="sd">        ...     channeldepth</span>
<span class="sd">        ...     crestheighttolerance</span>
<span class="sd">        channeldepth(1.0)</span>
<span class="sd">        crestheighttolerance(0.01)</span>

<span class="sd">        &gt;&gt;&gt; derived.cd</span>
<span class="sd">        cd(1000.0)</span>
<span class="sd">        &gt;&gt;&gt; model.dischargemodel.parameters.control.channeldepth</span>
<span class="sd">        channeldepth(1.0)</span>
<span class="sd">        &gt;&gt;&gt; model.dischargemodel.parameters.control.crestheighttolerance</span>
<span class="sd">        crestheighttolerance(0.01)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">cd</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cd</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">exceptiontools</span><span class="o">.</span><span class="n">AttributeNotReady</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">exceptiontools</span><span class="o">.</span><span class="n">attrready</span><span class="p">(</span><span class="n">cd</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">):</span>
                <span class="n">objecttools</span><span class="o">.</span><span class="n">augment_excmessage</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;While trying to determine the missing value of the derived &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;parameter </span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">elementphrase</span><span class="p">(</span><span class="n">cd</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
        <span class="n">dischargemodel</span><span class="o">.</span><span class="n">prepare_channeldepth</span><span class="p">(</span><span class="n">cd</span><span class="o">.</span><span class="n">value</span> <span class="o">/</span> <span class="mf">1000.0</span><span class="p">)</span>
        <span class="n">dischargemodel</span><span class="o">.</span><span class="n">prepare_tolerance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">sh</span><span class="o">.</span><span class="n">value</span> <span class="o">/</span> <span class="mf">1000.0</span><span class="p">)</span></div>



<div class="viewcode-block" id="Main_WaterLevelModel_V1">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Main_WaterLevelModel_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Main_WaterLevelModel_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">ELSModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for |wland.DOCNAME.long| models that use submodels that comply with</span>
<span class="sd">    the |WaterLevelModel_V1| interface.&quot;&quot;&quot;</span>

    <span class="n">waterlevelmodel</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelProperty</span>
    <span class="n">waterlevelmodel_is_mainmodel</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelIsMainmodelProperty</span><span class="p">()</span>
    <span class="n">waterlevelmodel_typeid</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelTypeIDProperty</span><span class="p">()</span>

    <span class="nd">@importtools</span><span class="o">.</span><span class="n">prepare_submodel</span><span class="p">(</span><span class="s2">&quot;waterlevelmodel&quot;</span><span class="p">,</span> <span class="n">stateinterfaces</span><span class="o">.</span><span class="n">WaterLevelModel_V1</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_waterlevelmodel_v1</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">waterlevelmodel</span><span class="p">:</span> <span class="n">stateinterfaces</span><span class="o">.</span><span class="n">WaterLevelModel_V1</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">refresh</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialise the given `waterlevelmodel` that follows the |WaterLevelModel_V1|</span>
<span class="sd">        interface.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.wland_wag import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models import exch_waterlevel</span>
<span class="sd">        &gt;&gt;&gt; with model.add_waterlevelmodel_v1(exch_waterlevel):</span>
<span class="sd">        ...     pass</span>
<span class="sd">        &gt;&gt;&gt; assert isinstance(model.waterlevelmodel, exch_waterlevel.Model)</span>
<span class="sd">        &quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="Sub_TempModel_V1">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Sub_TempModel_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Sub_TempModel_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">ELSModel</span><span class="p">,</span> <span class="n">tempinterfaces</span><span class="o">.</span><span class="n">TempModel_V1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for |wland.DOCNAME.long| models that comply with the |TempModel_V1|</span>
<span class="sd">    submodel interface.&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="Sub_PrecipModel_V1">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Sub_PrecipModel_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Sub_PrecipModel_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">ELSModel</span><span class="p">,</span> <span class="n">precipinterfaces</span><span class="o">.</span><span class="n">PrecipModel_V1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for |wland.DOCNAME.long| models that comply with the |PrecipModel_V1|</span>
<span class="sd">    submodel interface.&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="Sub_SnowCoverModel_V1">
<a class="viewcode-back" href="../../../../wland.html#hydpy.models.wland.wland_model.Sub_SnowCoverModel_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Sub_SnowCoverModel_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">ELSModel</span><span class="p">,</span> <span class="n">stateinterfaces</span><span class="o">.</span><span class="n">SnowCoverModel_V1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for |wland.DOCNAME.long| models that comply with the</span>
<span class="sd">    |SnowCoverModel_V1| submodel interface.&quot;&quot;&quot;</span></div>

</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">HydPy 6.2.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">hydpy.models.wland.wland_model</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2013-2025, HydPy Developers.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 9.0.4.
    </div>
  </body>
</html>