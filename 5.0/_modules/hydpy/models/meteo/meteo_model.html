<!DOCTYPE html>

<html lang="en" data-content_root="../../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>hydpy.models.meteo.meteo_model &#8212; HydPy 5.0.3 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/classic.css?v=127cebf3" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/graphviz.css?v=eafc0fe6" />
    
    <script src="../../../../_static/documentation_options.js?v=f98c4cc8"></script>
    <script src="../../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">HydPy 5.0.3 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">hydpy.models.meteo.meteo_model</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../../index.html">
              <img class="logo" src="../../../../_static/HydPy_Logo.png" alt="Logo"/>
            </a></p>
  <div>
    <h3><a href="../../../../index.html">Table of Contents</a></h3>
    <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../install.html">Installation Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../how_to.html">How to…</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../framework.html">Framework Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../modelcollection.html">Model Collection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../development.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../examples.html">Example Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../zbibliography.html">Bibliography</a></li>
</ul>

  </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for hydpy.models.meteo.meteo_model</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">.. _`solar time`: https://en.wikipedia.org/wiki/Solar_time</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1"># imports...</span>
<span class="c1"># ...from HydPy</span>
<span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="kn">import</span> <span class="n">modeltools</span>
<span class="kn">from</span> <span class="nn">hydpy.cythons</span> <span class="kn">import</span> <span class="n">modelutils</span>
<span class="kn">from</span> <span class="nn">hydpy.models.meteo</span> <span class="kn">import</span> <span class="n">meteo_fixed</span>
<span class="kn">from</span> <span class="nn">hydpy.models.meteo</span> <span class="kn">import</span> <span class="n">meteo_control</span>
<span class="kn">from</span> <span class="nn">hydpy.models.meteo</span> <span class="kn">import</span> <span class="n">meteo_derived</span>
<span class="kn">from</span> <span class="nn">hydpy.models.meteo</span> <span class="kn">import</span> <span class="n">meteo_inputs</span>
<span class="kn">from</span> <span class="nn">hydpy.models.meteo</span> <span class="kn">import</span> <span class="n">meteo_factors</span>
<span class="kn">from</span> <span class="nn">hydpy.models.meteo</span> <span class="kn">import</span> <span class="n">meteo_fluxes</span>
<span class="kn">from</span> <span class="nn">hydpy.models.meteo</span> <span class="kn">import</span> <span class="n">meteo_logs</span>


<div class="viewcode-block" id="Calc_EarthSunDistance_V1">
<a class="viewcode-back" href="../../../../meteo.html#hydpy.models.meteo.meteo_model.Calc_EarthSunDistance_V1">[docs]</a>
<span class="k">class</span> <span class="nc">Calc_EarthSunDistance_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the relative inverse distance between the earth and the sun</span>
<span class="sd">    according to :cite:t:`ref-Allen1998`.</span>

<span class="sd">    Basic equation (:cite:t:`ref-Allen1998`, equation 23):</span>
<span class="sd">      :math:`EarthSunDistance = 1 + 0.033 \cdot cos(2 \cdot Pi / 366 \cdot (DOY + 1)`</span>

<span class="sd">    Note that this equation differs slightly from the one given by</span>
<span class="sd">    :cite:t:`ref-Allen1998`.  The following examples show that</span>
<span class="sd">    |Calc_EarthSunDistance_V1| calculates the same distance value for a specific</span>
<span class="sd">    &quot;day&quot; (e.g. the 1st March) both for leap years and non-leap years.  Hence,</span>
<span class="sd">    there is a tiny &quot;jump&quot; between 28th February and 1st March for non-leap years.</span>

<span class="sd">    Examples:</span>

<span class="sd">        We define an initialisation period covering both a leap year (2000) and a</span>
<span class="sd">        non-leap year (2001):</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.meteo import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import pub, round_</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-01&quot;, &quot;2002-01-01&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; derived.doy.update()</span>

<span class="sd">        The following convenience function applies method |Calc_EarthSunDistance_V1|</span>
<span class="sd">        for the given dates and prints the results:</span>

<span class="sd">        &gt;&gt;&gt; def test(*dates):</span>
<span class="sd">        ...     for date in dates:</span>
<span class="sd">        ...         model.idx_sim = pub.timegrids.init[date]</span>
<span class="sd">        ...         model.calc_earthsundistance_v1()</span>
<span class="sd">        ...         print(date, end=&quot;: &quot;)</span>
<span class="sd">        ...         round_(factors.earthsundistance.value)</span>

<span class="sd">        The results are identical for both years:</span>

<span class="sd">        &gt;&gt;&gt; test(&quot;2000-01-01&quot;, &quot;2000-02-28&quot;, &quot;2000-02-29&quot;,</span>
<span class="sd">        ...      &quot;2000-03-01&quot;, &quot;2000-07-01&quot;, &quot;2000-12-31&quot;)</span>
<span class="sd">        2000-01-01: 1.032995</span>
<span class="sd">        2000-02-28: 1.017471</span>
<span class="sd">        2000-02-29: 1.016988</span>
<span class="sd">        2000-03-01: 1.0165</span>
<span class="sd">        2000-07-01: 0.967</span>
<span class="sd">        2000-12-31: 1.033</span>

<span class="sd">        &gt;&gt;&gt; test(&quot;2001-01-01&quot;, &quot;2001-02-28&quot;,</span>
<span class="sd">        ...      &quot;2001-03-01&quot;, &quot;2001-07-01&quot;, &quot;2001-12-31&quot;)</span>
<span class="sd">        2001-01-01: 1.032995</span>
<span class="sd">        2001-02-28: 1.017471</span>
<span class="sd">        2001-03-01: 1.0165</span>
<span class="sd">        2001-07-01: 0.967</span>
<span class="sd">        2001-12-31: 1.033</span>

<span class="sd">        The following calculation agrees with example 8 of :cite:t:`ref-Allen1998`:</span>

<span class="sd">        &gt;&gt;&gt; derived.doy(246)</span>
<span class="sd">        &gt;&gt;&gt; model.idx_sim = 0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_earthsundistance_v1()</span>
<span class="sd">        &gt;&gt;&gt; factors.earthsundistance</span>
<span class="sd">        earthsundistance(0.984993)</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_fixed</span><span class="o">.</span><span class="n">Pi</span><span class="p">,)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_derived</span><span class="o">.</span><span class="n">DOY</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_factors</span><span class="o">.</span><span class="n">EarthSunDistance</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span><span class="o">.</span><span class="n">earthsundistance</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="mf">0.033</span> <span class="o">*</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span>
            <span class="mi">2</span> <span class="o">*</span> <span class="n">fix</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">366.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">doy</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">idx_sim</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="Calc_SolarDeclination_V1">
<a class="viewcode-back" href="../../../../meteo.html#hydpy.models.meteo.meteo_model.Calc_SolarDeclination_V1">[docs]</a>
<span class="k">class</span> <span class="nc">Calc_SolarDeclination_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the solar declination according to :cite:t:`ref-Allen1998`.</span>

<span class="sd">    Basic equation (:cite:t:`ref-Allen1998`, equation 24):</span>
<span class="sd">      :math:`SolarDeclination =</span>
<span class="sd">      0.409 \cdot sin(2 \cdot Pi / 366 \cdot (DOY + 1) - 1.39)`</span>

<span class="sd">    Note that this equation differs slightly from the one given by</span>
<span class="sd">    :cite:t:`ref-Allen1998` due to reasons explained in the documentation on method</span>
<span class="sd">    |Calc_EarthSunDistance_V1|.</span>

<span class="sd">    Examples:</span>

<span class="sd">        We define an initialisation period covering both a leap year (2000) and a</span>
<span class="sd">        non-leap year (2001):</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.meteo import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import pub, round_</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-01&quot;, &quot;2002-01-01&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; derived.doy.update()</span>

<span class="sd">        The following convenience function applies method |Calc_SolarDeclination_V1|</span>
<span class="sd">        for the given dates and prints the results:</span>

<span class="sd">        &gt;&gt;&gt; def test(*dates):</span>
<span class="sd">        ...     for date in dates:</span>
<span class="sd">        ...         model.idx_sim = pub.timegrids.init[date]</span>
<span class="sd">        ...         model.calc_solardeclination_v1()</span>
<span class="sd">        ...         print(date, end=&quot;: &quot;)</span>
<span class="sd">        ...         round_(factors.solardeclination.value)</span>

<span class="sd">        The results are identical for both years:</span>

<span class="sd">        &gt;&gt;&gt; test(&quot;2000-01-01&quot;, &quot;2000-02-28&quot;, &quot;2000-02-29&quot;,</span>
<span class="sd">        ...      &quot;2000-03-01&quot;, &quot;2000-12-31&quot;)</span>
<span class="sd">        2000-01-01: -0.401012</span>
<span class="sd">        2000-02-28: -0.150618</span>
<span class="sd">        2000-02-29: -0.144069</span>
<span class="sd">        2000-03-01: -0.137476</span>
<span class="sd">        2000-12-31: -0.402334</span>

<span class="sd">        &gt;&gt;&gt; test(&quot;2001-01-01&quot;, &quot;2001-02-28&quot;,</span>
<span class="sd">        ...      &quot;2001-03-01&quot;, &quot;2001-12-31&quot;)</span>
<span class="sd">        2001-01-01: -0.401012</span>
<span class="sd">        2001-02-28: -0.150618</span>
<span class="sd">        2001-03-01: -0.137476</span>
<span class="sd">        2001-12-31: -0.402334</span>

<span class="sd">        The following calculation agrees with example 8 of :cite:t:`ref-Allen1998`:</span>

<span class="sd">        &gt;&gt;&gt; derived.doy(246)</span>
<span class="sd">        &gt;&gt;&gt; model.idx_sim = 0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_solardeclination_v1()</span>
<span class="sd">        &gt;&gt;&gt; factors.solardeclination</span>
<span class="sd">        solardeclination(0.117464)</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_fixed</span><span class="o">.</span><span class="n">Pi</span><span class="p">,)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_derived</span><span class="o">.</span><span class="n">DOY</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_factors</span><span class="o">.</span><span class="n">SolarDeclination</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span><span class="o">.</span><span class="n">solardeclination</span> <span class="o">=</span> <span class="mf">0.409</span> <span class="o">*</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span>
            <span class="mi">2</span> <span class="o">*</span> <span class="n">fix</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">366</span> <span class="o">*</span> <span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">doy</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">idx_sim</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.39</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="Calc_SolarDeclination_V2">
<a class="viewcode-back" href="../../../../meteo.html#hydpy.models.meteo.meteo_model.Calc_SolarDeclination_V2">[docs]</a>
<span class="k">class</span> <span class="nc">Calc_SolarDeclination_V2</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the solar declination according to :cite:t:`ref-LARSIM`.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`SolarDeclination = 0.41 \cdot cos \left(</span>
<span class="sd">      \frac{2 \cdot Pi \cdot (DOY - 171)}{365} \right)`</span>

<span class="sd">    Examples:</span>

<span class="sd">        We define an initialisation period covering both a leap year (2000) and a</span>
<span class="sd">        non-leap year (2001):</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.meteo import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import pub, round_</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-01&quot;, &quot;2002-01-01&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; derived.doy.update()</span>

<span class="sd">        The following convenience function applies method |Calc_SolarDeclination_V2|</span>
<span class="sd">        for the given dates and prints the results:</span>

<span class="sd">        &gt;&gt;&gt; def test(*dates):</span>
<span class="sd">        ...     for date in dates:</span>
<span class="sd">        ...         model.idx_sim = pub.timegrids.init[date]</span>
<span class="sd">        ...         model.calc_solardeclination_v2()</span>
<span class="sd">        ...         print(date, end=&quot;: &quot;)</span>
<span class="sd">        ...         round_(factors.solardeclination.value)</span>

<span class="sd">        The results are identical for both years:</span>

<span class="sd">        &gt;&gt;&gt; test(&quot;2000-01-01&quot;, &quot;2000-02-28&quot;, &quot;2000-02-29&quot;,</span>
<span class="sd">        ...      &quot;2000-03-01&quot;, &quot;2000-12-31&quot;)</span>
<span class="sd">        2000-01-01: -0.401992</span>
<span class="sd">        2000-02-28: -0.149946</span>
<span class="sd">        2000-02-29: -0.143355</span>
<span class="sd">        2000-03-01: -0.136722</span>
<span class="sd">        2000-12-31: -0.401992</span>

<span class="sd">        &gt;&gt;&gt; test(&quot;2001-01-01&quot;, &quot;2001-02-28&quot;,</span>
<span class="sd">        ...      &quot;2001-03-01&quot;, &quot;2001-12-31&quot;)</span>
<span class="sd">        2001-01-01: -0.401992</span>
<span class="sd">        2001-02-28: -0.149946</span>
<span class="sd">        2001-03-01: -0.136722</span>
<span class="sd">        2001-12-31: -0.401992</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_derived</span><span class="o">.</span><span class="n">DOY</span><span class="p">,)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_fixed</span><span class="o">.</span><span class="n">Pi</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_factors</span><span class="o">.</span><span class="n">SolarDeclination</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span><span class="o">.</span><span class="n">solardeclination</span> <span class="o">=</span> <span class="mf">0.41</span> <span class="o">*</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span>
            <span class="mf">2.0</span> <span class="o">*</span> <span class="n">fix</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">doy</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">idx_sim</span><span class="p">]</span> <span class="o">-</span> <span class="mf">171.0</span><span class="p">)</span> <span class="o">/</span> <span class="mf">365.0</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="Calc_SunsetHourAngle_V1">
<a class="viewcode-back" href="../../../../meteo.html#hydpy.models.meteo.meteo_model.Calc_SunsetHourAngle_V1">[docs]</a>
<span class="k">class</span> <span class="nc">Calc_SunsetHourAngle_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the sunset hour angle according to :cite:t:`ref-Allen1998`.</span>

<span class="sd">    Basic equation (:cite:t:`ref-Allen1998`, equation 25):</span>
<span class="sd">      :math:`SunsetHourAngle = arccos(-tan(LatitudeRad) \cdot tan(SolarDeclination))`</span>

<span class="sd">    Example:</span>

<span class="sd">        The following calculation agrees with example 8 of :cite:t:`ref-Allen1998`:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.meteo import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; derived.doy.shape = 1</span>
<span class="sd">        &gt;&gt;&gt; derived.doy(246)</span>
<span class="sd">        &gt;&gt;&gt; derived.latituderad(-.35)</span>
<span class="sd">        &gt;&gt;&gt; factors.solardeclination = 0.12</span>
<span class="sd">        &gt;&gt;&gt; model.calc_sunsethourangle_v1()</span>
<span class="sd">        &gt;&gt;&gt; factors.sunsethourangle</span>
<span class="sd">        sunsethourangle(1.526767)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_derived</span><span class="o">.</span><span class="n">LatitudeRad</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_factors</span><span class="o">.</span><span class="n">SolarDeclination</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_factors</span><span class="o">.</span><span class="n">SunsetHourAngle</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span><span class="o">.</span><span class="n">sunsethourangle</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span>
            <span class="o">-</span><span class="n">modelutils</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">latituderad</span><span class="p">)</span> <span class="o">*</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">fac</span><span class="o">.</span><span class="n">solardeclination</span><span class="p">)</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="Calc_SolarTimeAngle_V1">
<a class="viewcode-back" href="../../../../meteo.html#hydpy.models.meteo.meteo_model.Calc_SolarTimeAngle_V1">[docs]</a>
<span class="k">class</span> <span class="nc">Calc_SolarTimeAngle_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the solar time angle at the midpoint of the current period according</span>
<span class="sd">    to :cite:t:`ref-Allen1998`.</span>

<span class="sd">    Basic equations (:cite:t:`ref-Allen1998`, equations 31 to 33):</span>
<span class="sd">      :math:`SolarTimeAngle =</span>
<span class="sd">      Pi / 12 \cdot ((SCT + (Longitude - UTCLongitude) / 15 + S_c) - 12)`</span>

<span class="sd">      :math:`S_c = 0.1645 \cdot sin(2 \cdot b) -</span>
<span class="sd">      0.1255 \cdot cos(b) - 0.025 \cdot sin(b)`</span>

<span class="sd">      :math:`b = (2 \cdot Pi \cdot (DOY - 80)) / 365`</span>

<span class="sd">    Note there are two slight deviations from the equations given by</span>
<span class="sd">    :cite:t:`ref-Allen1998`.  The first one is that positive numbers correspond to</span>
<span class="sd">    longitudes east of Greenwich and negative numbers to longitudes west of Greenwich.</span>
<span class="sd">    The second one is due to the definition of parameter |DOY|, as explained in the</span>
<span class="sd">    documentation on method |Calc_EarthSunDistance_V1|.</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub, round_</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-09-03&quot;, &quot;2000-09-04&quot;, &quot;1h&quot;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.meteo import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; longitude(15)</span>
<span class="sd">        &gt;&gt;&gt; derived.doy.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.sct.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.utclongitude.update()</span>
<span class="sd">        &gt;&gt;&gt; for hour in range(24):</span>
<span class="sd">        ...     model.idx_sim = hour</span>
<span class="sd">        ...     model.calc_solartimeangle_v1()</span>
<span class="sd">        ...     print(hour, end=&quot;: &quot;)</span>
<span class="sd">        ...     round_(factors.solartimeangle.value)  # doctest: +ELLIPSIS</span>
<span class="sd">        0: -3.004157</span>
<span class="sd">        1: -2.742358</span>
<span class="sd">        ...</span>
<span class="sd">        11: -0.124364</span>
<span class="sd">        12: 0.137435</span>
<span class="sd">        ...</span>
<span class="sd">        22: 2.755429</span>
<span class="sd">        23: 3.017229</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_fixed</span><span class="o">.</span><span class="n">Pi</span><span class="p">,)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_control</span><span class="o">.</span><span class="n">Longitude</span><span class="p">,)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">meteo_derived</span><span class="o">.</span><span class="n">DOY</span><span class="p">,</span>
        <span class="n">meteo_derived</span><span class="o">.</span><span class="n">SCT</span><span class="p">,</span>
        <span class="n">meteo_derived</span><span class="o">.</span><span class="n">UTCLongitude</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_factors</span><span class="o">.</span><span class="n">SolarTimeAngle</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">d_b</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">fix</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">doy</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">idx_sim</span><span class="p">]</span> <span class="o">-</span> <span class="mf">80.0</span><span class="p">)</span> <span class="o">/</span> <span class="mf">365.0</span>
        <span class="n">d_sc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="mf">0.1645</span> <span class="o">*</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">d_b</span><span class="p">)</span>
            <span class="o">-</span> <span class="mf">0.1255</span> <span class="o">*</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">d_b</span><span class="p">)</span>
            <span class="o">-</span> <span class="mf">0.025</span> <span class="o">*</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">d_b</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">d_time</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">der</span><span class="o">.</span><span class="n">sct</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">idx_sim</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">longitude</span> <span class="o">-</span> <span class="n">der</span><span class="o">.</span><span class="n">utclongitude</span><span class="p">)</span> <span class="o">/</span> <span class="mf">15.0</span> <span class="o">+</span> <span class="n">d_sc</span>
        <span class="p">)</span>
        <span class="n">fac</span><span class="o">.</span><span class="n">solartimeangle</span> <span class="o">=</span> <span class="n">fix</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">12.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">d_time</span> <span class="o">-</span> <span class="mf">12.0</span><span class="p">)</span></div>



<div class="viewcode-block" id="Calc_TimeOfSunrise_TimeOfSunset_V1">
<a class="viewcode-back" href="../../../../meteo.html#hydpy.models.meteo.meteo_model.Calc_TimeOfSunrise_TimeOfSunset_V1">[docs]</a>
<span class="k">class</span> <span class="nc">Calc_TimeOfSunrise_TimeOfSunset_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the time of sunrise and sunset of the current day according to</span>
<span class="sd">    :cite:t:`ref-LARSIM`, based on :cite:t:`ref-Thompson1981`.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      :math:`TimeOfSunset^* = \frac{12}{Pi} \cdot acos \left(</span>
<span class="sd">      tan(SolarDeclination) \cdot tan(LatitudeRad) +</span>
<span class="sd">      \frac{0.0145}{cos(SolarDeclination) \cdot cos(LatitudeRad)} \right)`</span>

<span class="sd">      :math:`\delta = \frac{4 \cdot (UTCLongitude - Longitude)}{60}`</span>

<span class="sd">      :math:`TimeOfSunset = TimeOfSunset^* + \delta`</span>

<span class="sd">      :math:`TimeOfSunset = 24 - TimeOfSunset^* + \delta`</span>

<span class="sd">    Examples:</span>

<span class="sd">        We calculate the local time of sunrise and sunset for a latitude of</span>
<span class="sd">        approximately 52°N and a longitude of 10°E, which is 5° west of the longitude</span>
<span class="sd">        that defines the local time zone:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.meteo import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; longitude(10.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.utclongitude(15.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.latituderad(0.9)</span>


<span class="sd">        The sunshine duration varies between seven hours at the winter solstice and 16</span>
<span class="sd">        hours at the summer solstice:</span>

<span class="sd">        &gt;&gt;&gt; factors.solardeclination = -0.41</span>
<span class="sd">        &gt;&gt;&gt; model.calc_timeofsunrise_timeofsunset_v1()</span>
<span class="sd">        &gt;&gt;&gt; factors.timeofsunrise</span>
<span class="sd">        timeofsunrise(8.432308)</span>
<span class="sd">        &gt;&gt;&gt; factors.timeofsunset</span>
<span class="sd">        timeofsunset(16.234359)</span>
<span class="sd">        &gt;&gt;&gt; factors.solardeclination = 0.41</span>
<span class="sd">        &gt;&gt;&gt; model.calc_timeofsunrise_timeofsunset_v1()</span>
<span class="sd">        &gt;&gt;&gt; factors.timeofsunrise</span>
<span class="sd">        timeofsunrise(4.002041)</span>
<span class="sd">        &gt;&gt;&gt; factors.timeofsunset</span>
<span class="sd">        timeofsunset(20.664625)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_control</span><span class="o">.</span><span class="n">Longitude</span><span class="p">,)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">meteo_derived</span><span class="o">.</span><span class="n">LatitudeRad</span><span class="p">,</span>
        <span class="n">meteo_derived</span><span class="o">.</span><span class="n">UTCLongitude</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_fixed</span><span class="o">.</span><span class="n">Pi</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_factors</span><span class="o">.</span><span class="n">SolarDeclination</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">meteo_factors</span><span class="o">.</span><span class="n">TimeOfSunrise</span><span class="p">,</span>
        <span class="n">meteo_factors</span><span class="o">.</span><span class="n">TimeOfSunset</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span><span class="o">.</span><span class="n">timeofsunrise</span> <span class="o">=</span> <span class="p">(</span><span class="mf">12.0</span> <span class="o">/</span> <span class="n">fix</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span>
            <span class="n">modelutils</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">fac</span><span class="o">.</span><span class="n">solardeclination</span><span class="p">)</span> <span class="o">*</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">latituderad</span><span class="p">)</span>
            <span class="o">+</span> <span class="mf">0.0145</span>
            <span class="o">/</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">fac</span><span class="o">.</span><span class="n">solardeclination</span><span class="p">)</span>
            <span class="o">/</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">latituderad</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">fac</span><span class="o">.</span><span class="n">timeofsunset</span> <span class="o">=</span> <span class="mf">24.0</span> <span class="o">-</span> <span class="n">fac</span><span class="o">.</span><span class="n">timeofsunrise</span>
        <span class="n">d_dt</span> <span class="o">=</span> <span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">utclongitude</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">longitude</span><span class="p">)</span> <span class="o">*</span> <span class="mf">4.0</span> <span class="o">/</span> <span class="mf">60.0</span>
        <span class="n">fac</span><span class="o">.</span><span class="n">timeofsunrise</span> <span class="o">+=</span> <span class="n">d_dt</span>
        <span class="n">fac</span><span class="o">.</span><span class="n">timeofsunset</span> <span class="o">+=</span> <span class="n">d_dt</span></div>



<div class="viewcode-block" id="Calc_ExtraterrestrialRadiation_V1">
<a class="viewcode-back" href="../../../../meteo.html#hydpy.models.meteo.meteo_model.Calc_ExtraterrestrialRadiation_V1">[docs]</a>
<span class="k">class</span> <span class="nc">Calc_ExtraterrestrialRadiation_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the extraterrestrial radiation according to :cite:t:`ref-Allen1998`.</span>

<span class="sd">    Basic equation for daily simulation steps (:cite:t:`ref-Allen1998`, equation 21):</span>
<span class="sd">      :math:`ExternalTerrestrialRadiation =</span>
<span class="sd">      \frac{SolarConstant}{Pi} \cdot EarthSunDistance \cdot (</span>
<span class="sd">      SunsetHourAngle \cdot sin(LatitudeRad) \cdot sin(SolarDeclination) +</span>
<span class="sd">      cos(LatitudeRad) \cdot cos(SolarDeclination) \cdot sin(SunsetHourAngle))`</span>

<span class="sd">    Basic equation for (sub)hourly steps (:cite:t:`ref-Allen1998`, eq. 28 to 30):</span>
<span class="sd">      :math:`ExternalTerrestrialRadiation =</span>
<span class="sd">      \frac{12 \cdot SolarConstant}{Pi} \cdot EarthSunDistance \cdot \Big(</span>
<span class="sd">      (\omega_2 - \omega_1) \cdot sin(LatitudeRad) \cdot sin(SolarDeclination) +</span>
<span class="sd">      cos(LatitudeRad) \cdot cos(SolarDeclination) \cdot (sin(\omega_2) -</span>
<span class="sd">      sin(\omega_1)) \Big)`</span>

<span class="sd">      :math:`\omega_1 = SolarTimeAngle - Pi \cdot Days`</span>

<span class="sd">      :math:`\omega_2 = SolarTimeAngle + Pi \cdot Days`</span>

<span class="sd">    Examples:</span>

<span class="sd">        The following calculation agrees with example 8 of :cite:t:`ref-Allen1998` for</span>
<span class="sd">        daily time steps:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.meteo import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; derived.days(1)</span>
<span class="sd">        &gt;&gt;&gt; derived.latituderad(-0.35)</span>
<span class="sd">        &gt;&gt;&gt; factors.earthsundistance = 0.985</span>
<span class="sd">        &gt;&gt;&gt; factors.solardeclination = 0.12</span>
<span class="sd">        &gt;&gt;&gt; factors.sunsethourangle = 1.527</span>
<span class="sd">        &gt;&gt;&gt; model.calc_extraterrestrialradiation_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.extraterrestrialradiation</span>
<span class="sd">        extraterrestrialradiation(372.473355)</span>

<span class="sd">        The following calculation repeats the above example for an hourly simulation</span>
<span class="sd">        time step, still covering the whole day:</span>

<span class="sd">        &gt;&gt;&gt; import numpy</span>
<span class="sd">        &gt;&gt;&gt; longitude(-20)</span>
<span class="sd">        &gt;&gt;&gt; derived.utclongitude(-20)</span>
<span class="sd">        &gt;&gt;&gt; derived.days(1/24)</span>
<span class="sd">        &gt;&gt;&gt; derived.doy.shape = 24</span>
<span class="sd">        &gt;&gt;&gt; derived.doy(246)</span>
<span class="sd">        &gt;&gt;&gt; derived.sct.shape = 24</span>
<span class="sd">        &gt;&gt;&gt; derived.sct = numpy.linspace(0.5, 23.5, 24)</span>
<span class="sd">        &gt;&gt;&gt; sum_ = 0.0</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; for hour in range(24):</span>
<span class="sd">        ...     model.idx_sim = hour</span>
<span class="sd">        ...     model.calc_solartimeangle_v1()</span>
<span class="sd">        ...     model.calc_extraterrestrialradiation_v1()</span>
<span class="sd">        ...     print(hour, end=&quot;: &quot;)</span>
<span class="sd">        ...     round_(fluxes.extraterrestrialradiation.value)</span>
<span class="sd">        ...     sum_ += fluxes.extraterrestrialradiation</span>
<span class="sd">        0: 0.0</span>
<span class="sd">        1: 0.0</span>
<span class="sd">        2: 0.0</span>
<span class="sd">        3: 0.0</span>
<span class="sd">        4: 0.0</span>
<span class="sd">        5: 0.0</span>
<span class="sd">        6: 116.280258</span>
<span class="sd">        7: 431.467206</span>
<span class="sd">        8: 713.483659</span>
<span class="sd">        9: 943.11066</span>
<span class="sd">        10: 1104.699509</span>
<span class="sd">        11: 1187.238194</span>
<span class="sd">        12: 1185.101838</span>
<span class="sd">        13: 1098.436032</span>
<span class="sd">        14: 933.146907</span>
<span class="sd">        15: 700.498642</span>
<span class="sd">        16: 416.345834</span>
<span class="sd">        17: 100.053027</span>
<span class="sd">        18: 0.0</span>
<span class="sd">        19: 0.0</span>
<span class="sd">        20: 0.0</span>
<span class="sd">        21: 0.0</span>
<span class="sd">        22: 0.0</span>
<span class="sd">        23: 0.0</span>

<span class="sd">        Note that, even with identical values of the local longitude (|Longitude|) and</span>
<span class="sd">        the one of the time zone (|UTCLongitude|), the calculated radiation values are</span>
<span class="sd">        not symmetrical due to the eccentricity of the Earth&quot;s orbit (see `solar</span>
<span class="sd">        time`_).</span>

<span class="sd">        There is a slight deviation between the directly calculated daily value and the</span>
<span class="sd">        mean of the hourly values:</span>

<span class="sd">        &gt;&gt;&gt; round_(sum_/24)</span>
<span class="sd">        372.077574</span>

<span class="sd">        For sub-daily simulation time steps, results are most accurate for the shortest</span>
<span class="sd">        step size.  On the other hand, they can be (extremely) inaccurate for timesteps</span>
<span class="sd">        between one hour and one day.  We demonstrate this by comparing the mean</span>
<span class="sd">        sub-daily values of different step sizes with the directly calculated daily</span>
<span class="sd">        value (note the apparent total fail of method</span>
<span class="sd">        |Calc_ExtraterrestrialRadiation_V1| for a step size of 720 minutes):</span>

<span class="sd">        &gt;&gt;&gt; for minutes in [1, 5, 15, 30, 60, 90, 120, 144, 160,</span>
<span class="sd">        ...                 180, 240, 288, 360, 480, 720, 1440]:</span>
<span class="sd">        ...     derived.days(minutes/60/24)</span>
<span class="sd">        ...     nmb = int(1440/minutes)</span>
<span class="sd">        ...     derived.doy.shape = nmb</span>
<span class="sd">        ...     derived.doy(246)</span>
<span class="sd">        ...     derived.sct.shape = nmb</span>
<span class="sd">        ...     derived.sct = numpy.linspace(minutes/60/2, 24-minutes/60/2, nmb)</span>
<span class="sd">        ...     sum_ = 0.0</span>
<span class="sd">        ...     for idx in range(nmb):</span>
<span class="sd">        ...         model.idx_sim = idx</span>
<span class="sd">        ...         model.calc_solartimeangle_v1()</span>
<span class="sd">        ...         model.calc_extraterrestrialradiation_v1()</span>
<span class="sd">        ...         sum_ += fluxes.extraterrestrialradiation</span>
<span class="sd">        ...     print(minutes, end=&quot;: &quot;)</span>
<span class="sd">        ...     round_(sum_/24 - 372.473355)</span>
<span class="sd">        1: -0.000626</span>
<span class="sd">        5: -0.008549</span>
<span class="sd">        15: -0.100092</span>
<span class="sd">        30: -0.395781</span>
<span class="sd">        60: -0.395781</span>
<span class="sd">        90: -0.395781</span>
<span class="sd">        120: -0.395781</span>
<span class="sd">        144: -14.43193</span>
<span class="sd">        160: -9.539017</span>
<span class="sd">        180: -0.395781</span>
<span class="sd">        240: -44.735212</span>
<span class="sd">        288: -25.486399</span>
<span class="sd">        360: -0.395781</span>
<span class="sd">        480: -44.735212</span>
<span class="sd">        720: -372.473355</span>
<span class="sd">        1440: -356.953632</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">meteo_fixed</span><span class="o">.</span><span class="n">Pi</span><span class="p">,</span>
        <span class="n">meteo_fixed</span><span class="o">.</span><span class="n">SolarConstant</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">meteo_derived</span><span class="o">.</span><span class="n">Days</span><span class="p">,</span>
        <span class="n">meteo_derived</span><span class="o">.</span><span class="n">LatitudeRad</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">meteo_factors</span><span class="o">.</span><span class="n">SolarTimeAngle</span><span class="p">,</span>
        <span class="n">meteo_factors</span><span class="o">.</span><span class="n">EarthSunDistance</span><span class="p">,</span>
        <span class="n">meteo_factors</span><span class="o">.</span><span class="n">SolarDeclination</span><span class="p">,</span>
        <span class="n">meteo_factors</span><span class="o">.</span><span class="n">SunsetHourAngle</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_fluxes</span><span class="o">.</span><span class="n">ExtraterrestrialRadiation</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">if</span> <span class="n">der</span><span class="o">.</span><span class="n">days</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="n">d_delta</span> <span class="o">=</span> <span class="n">fix</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">der</span><span class="o">.</span><span class="n">days</span>
            <span class="n">d_omega1</span> <span class="o">=</span> <span class="n">fac</span><span class="o">.</span><span class="n">solartimeangle</span> <span class="o">-</span> <span class="n">d_delta</span>
            <span class="n">d_omega2</span> <span class="o">=</span> <span class="n">fac</span><span class="o">.</span><span class="n">solartimeangle</span> <span class="o">+</span> <span class="n">d_delta</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">extraterrestrialradiation</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                <span class="p">(</span><span class="mf">12.0</span> <span class="o">*</span> <span class="n">fix</span><span class="o">.</span><span class="n">solarconstant</span> <span class="o">/</span> <span class="n">fix</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">fac</span><span class="o">.</span><span class="n">earthsundistance</span><span class="p">)</span>
                <span class="o">*</span> <span class="p">(</span>
                    <span class="p">(</span>
                        <span class="p">(</span><span class="n">d_omega2</span> <span class="o">-</span> <span class="n">d_omega1</span><span class="p">)</span>
                        <span class="o">*</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">latituderad</span><span class="p">)</span>
                        <span class="o">*</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">fac</span><span class="o">.</span><span class="n">solardeclination</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="o">+</span> <span class="p">(</span>
                        <span class="n">modelutils</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">latituderad</span><span class="p">)</span>
                        <span class="o">*</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">fac</span><span class="o">.</span><span class="n">solardeclination</span><span class="p">)</span>
                        <span class="o">*</span> <span class="p">(</span><span class="n">modelutils</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">d_omega2</span><span class="p">)</span> <span class="o">-</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">d_omega1</span><span class="p">))</span>
                    <span class="p">)</span>
                <span class="p">),</span>
                <span class="mf">0.0</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">extraterrestrialradiation</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">fix</span><span class="o">.</span><span class="n">solarconstant</span> <span class="o">/</span> <span class="n">fix</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">fac</span><span class="o">.</span><span class="n">earthsundistance</span>
            <span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
                <span class="p">(</span>
                    <span class="n">fac</span><span class="o">.</span><span class="n">sunsethourangle</span>
                    <span class="o">*</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">latituderad</span><span class="p">)</span>
                    <span class="o">*</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">fac</span><span class="o">.</span><span class="n">solardeclination</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="o">+</span> <span class="p">(</span>
                    <span class="n">modelutils</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">latituderad</span><span class="p">)</span>
                    <span class="o">*</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">fac</span><span class="o">.</span><span class="n">solardeclination</span><span class="p">)</span>
                    <span class="o">*</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">fac</span><span class="o">.</span><span class="n">sunsethourangle</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span></div>



<div class="viewcode-block" id="Calc_ExtraterrestrialRadiation_V2">
<a class="viewcode-back" href="../../../../meteo.html#hydpy.models.meteo.meteo_model.Calc_ExtraterrestrialRadiation_V2">[docs]</a>
<span class="k">class</span> <span class="nc">Calc_ExtraterrestrialRadiation_V2</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the amount of extraterrestrial radiation according to</span>
<span class="sd">    :cite:t:`ref-LARSIM`, based on :cite:t:`ref-Thompson1981`.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`ExternalTerrestrialRadiation =</span>
<span class="sd">      \frac{SolarConstant \cdot EarthSunDistance \cdot (</span>
<span class="sd">      SunsetHourAngle \cdot sin(LatitudeRad) \cdot sin(SolarDeclination) +</span>
<span class="sd">      cos(LatitudeRad) \cdot cos(SolarDeclination) \cdot sin(SunsetHourAngle)</span>
<span class="sd">      )}{PI}`</span>

<span class="sd">      :math:`SunsetHourAngle = (TimeOfSunset - TimeOfSunset) \cdot Pi / 24`</span>

<span class="sd">    Examples:</span>

<span class="sd">        First, we calculate the extraterrestrial radiation for a latitude of</span>
<span class="sd">        approximately 52°N:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.meteo import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; derived.latituderad(0.9)</span>

<span class="sd">        The sunshine duration varies between seven hours at the winter solstice and 16</span>
<span class="sd">        hours at summer solstice, corresponding to mean daily radiations of 70 and</span>
<span class="sd">        514 W/m².</span>

<span class="sd">        &gt;&gt;&gt; factors.solardeclination = -0.41</span>
<span class="sd">        &gt;&gt;&gt; factors.earthsundistance = 0.97</span>
<span class="sd">        &gt;&gt;&gt; factors.timeofsunrise = 8.4</span>
<span class="sd">        &gt;&gt;&gt; factors.timeofsunset = 15.6</span>
<span class="sd">        &gt;&gt;&gt; model.calc_extraterrestrialradiation_v2()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.extraterrestrialradiation</span>
<span class="sd">        extraterrestrialradiation(70.458396)</span>

<span class="sd">        &gt;&gt;&gt; factors.solardeclination = 0.41</span>
<span class="sd">        &gt;&gt;&gt; factors.earthsundistance = 1.03</span>
<span class="sd">        &gt;&gt;&gt; factors.timeofsunrise = 4.0</span>
<span class="sd">        &gt;&gt;&gt; factors.timeofsunset = 20.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_extraterrestrialradiation_v2()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.extraterrestrialradiation</span>
<span class="sd">        extraterrestrialradiation(514.367012)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_derived</span><span class="o">.</span><span class="n">LatitudeRad</span><span class="p">,)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">meteo_fixed</span><span class="o">.</span><span class="n">Pi</span><span class="p">,</span>
        <span class="n">meteo_fixed</span><span class="o">.</span><span class="n">SolarConstant</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">meteo_factors</span><span class="o">.</span><span class="n">SolarDeclination</span><span class="p">,</span>
        <span class="n">meteo_factors</span><span class="o">.</span><span class="n">EarthSunDistance</span><span class="p">,</span>
        <span class="n">meteo_factors</span><span class="o">.</span><span class="n">TimeOfSunrise</span><span class="p">,</span>
        <span class="n">meteo_factors</span><span class="o">.</span><span class="n">TimeOfSunset</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_fluxes</span><span class="o">.</span><span class="n">ExtraterrestrialRadiation</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">d_sunsethourangle</span> <span class="o">=</span> <span class="p">(</span><span class="n">fac</span><span class="o">.</span><span class="n">timeofsunset</span> <span class="o">-</span> <span class="n">fac</span><span class="o">.</span><span class="n">timeofsunrise</span><span class="p">)</span> <span class="o">*</span> <span class="n">fix</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">24.0</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">extraterrestrialradiation</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">fix</span><span class="o">.</span><span class="n">solarconstant</span> <span class="o">*</span> <span class="n">fac</span><span class="o">.</span><span class="n">earthsundistance</span> <span class="o">/</span> <span class="n">fix</span><span class="o">.</span><span class="n">pi</span>
        <span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
            <span class="n">d_sunsethourangle</span>
            <span class="o">*</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">fac</span><span class="o">.</span><span class="n">solardeclination</span><span class="p">)</span>
            <span class="o">*</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">latituderad</span><span class="p">)</span>
            <span class="o">+</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">fac</span><span class="o">.</span><span class="n">solardeclination</span><span class="p">)</span>
            <span class="o">*</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">latituderad</span><span class="p">)</span>
            <span class="o">*</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">d_sunsethourangle</span><span class="p">)</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="Calc_PossibleSunshineDuration_V1">
<a class="viewcode-back" href="../../../../meteo.html#hydpy.models.meteo.meteo_model.Calc_PossibleSunshineDuration_V1">[docs]</a>
<span class="k">class</span> <span class="nc">Calc_PossibleSunshineDuration_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the astronomically possible sunshine duration according to</span>
<span class="sd">    :cite:t:`ref-Allen1998`.</span>

<span class="sd">    Basic equation for daily timesteps :cite:t:`ref-Allen1998` (equation 34):</span>
<span class="sd">      :math:`PossibleSunshineDuration = 24 / Pi \cdot SunsetHourAngle`</span>

<span class="sd">    Basic equation for (sub)hourly timesteps:</span>
<span class="sd">      :math:`PossibleSunshineDuration =</span>
<span class="sd">      min(max(12 / Pi \cdot (SunsetHourAngle - \tau), 0), Hours)`</span>

<span class="sd">      .. math::</span>
<span class="sd">        \tau =</span>
<span class="sd">        \begin{cases}</span>
<span class="sd">        -SolarTimeAngle - Pi \cdot Days &amp;|\ SolarTimeAngle \leq 0</span>
<span class="sd">        \\</span>
<span class="sd">        SolarTimeAngle - Pi \cdot Days &amp;|\  SolarTimeAngle &gt; 0</span>
<span class="sd">        \end{cases}</span>

<span class="sd">    Examples:</span>

<span class="sd">        The following calculation agrees with example 9 of :cite:t:`ref-Allen1998`:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.meteo import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; derived.days(1)</span>
<span class="sd">        &gt;&gt;&gt; derived.hours(24)</span>
<span class="sd">        &gt;&gt;&gt; factors.sunsethourangle(1.527)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_possiblesunshineduration_v1()</span>
<span class="sd">        &gt;&gt;&gt; factors.possiblesunshineduration</span>
<span class="sd">        possiblesunshineduration(11.665421)</span>

<span class="sd">        The following calculation repeats the above example for an hourly simulation</span>
<span class="sd">        time step, still covering the whole day. Therefore the ratio is only calculated</span>
<span class="sd">        during sunrise and sunset and set to 1 at daytime and 0 at nighttime:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; import numpy</span>
<span class="sd">        &gt;&gt;&gt; derived.days(1/24)</span>
<span class="sd">        &gt;&gt;&gt; derived.hours(1)</span>
<span class="sd">        &gt;&gt;&gt; solartimeangles = numpy.linspace(-3.004157, 3.017229, 24)</span>
<span class="sd">        &gt;&gt;&gt; sum_ = 0.</span>
<span class="sd">        &gt;&gt;&gt; for hour, solartimeangle in enumerate(solartimeangles):</span>
<span class="sd">        ...     factors.solartimeangle = solartimeangle</span>
<span class="sd">        ...     model.calc_possiblesunshineduration_v1()</span>
<span class="sd">        ...     print(hour, end=&quot;: &quot;)  # doctest: +ELLIPSIS</span>
<span class="sd">        ...     round_(factors.possiblesunshineduration.value)</span>
<span class="sd">        ...     sum_ += factors.possiblesunshineduration.value</span>
<span class="sd">        0: 0.0</span>
<span class="sd">        ...</span>
<span class="sd">        5: 0.0</span>
<span class="sd">        6: 0.857676</span>
<span class="sd">        7: 1.0</span>
<span class="sd">        ...</span>
<span class="sd">        16: 1.0</span>
<span class="sd">        17: 0.807745</span>
<span class="sd">        18: 0.0</span>
<span class="sd">        ...</span>
<span class="sd">        23: 0.0</span>

<span class="sd">        The sum of the hourly sunshine durations equals the one-step calculation result:</span>

<span class="sd">        &gt;&gt;&gt; round_(sum_)</span>
<span class="sd">        11.665421</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_fixed</span><span class="o">.</span><span class="n">Pi</span><span class="p">,)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">meteo_derived</span><span class="o">.</span><span class="n">Days</span><span class="p">,</span>
        <span class="n">meteo_derived</span><span class="o">.</span><span class="n">Hours</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">meteo_factors</span><span class="o">.</span><span class="n">SolarTimeAngle</span><span class="p">,</span>
        <span class="n">meteo_factors</span><span class="o">.</span><span class="n">SunsetHourAngle</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_factors</span><span class="o">.</span><span class="n">PossibleSunshineDuration</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">if</span> <span class="n">der</span><span class="o">.</span><span class="n">hours</span> <span class="o">&lt;</span> <span class="mf">24.0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">fac</span><span class="o">.</span><span class="n">solartimeangle</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">d_thresh</span> <span class="o">=</span> <span class="o">-</span><span class="n">fac</span><span class="o">.</span><span class="n">solartimeangle</span> <span class="o">-</span> <span class="n">fix</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">der</span><span class="o">.</span><span class="n">days</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">d_thresh</span> <span class="o">=</span> <span class="n">fac</span><span class="o">.</span><span class="n">solartimeangle</span> <span class="o">-</span> <span class="n">fix</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">der</span><span class="o">.</span><span class="n">days</span>
            <span class="n">fac</span><span class="o">.</span><span class="n">possiblesunshineduration</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
                <span class="nb">max</span><span class="p">(</span><span class="mf">12.0</span> <span class="o">/</span> <span class="n">fix</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">fac</span><span class="o">.</span><span class="n">sunsethourangle</span> <span class="o">-</span> <span class="n">d_thresh</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">),</span> <span class="n">der</span><span class="o">.</span><span class="n">hours</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fac</span><span class="o">.</span><span class="n">possiblesunshineduration</span> <span class="o">=</span> <span class="mf">24.0</span> <span class="o">/</span> <span class="n">fix</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">fac</span><span class="o">.</span><span class="n">sunsethourangle</span></div>



<div class="viewcode-block" id="Calc_PossibleSunshineDuration_V2">
<a class="viewcode-back" href="../../../../meteo.html#hydpy.models.meteo.meteo_model.Calc_PossibleSunshineDuration_V2">[docs]</a>
<span class="k">class</span> <span class="nc">Calc_PossibleSunshineDuration_V2</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the astronomically possible sunshine duration according to</span>
<span class="sd">    :cite:t:`ref-LARSIM`.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`PossibleSunshineDuration = max \bigl(</span>
<span class="sd">      max(SCT-Hours/2, TimeOfSunrise) - min(SCT + Hours / 2, TimeOfSunset), 0 \bigr)`</span>

<span class="sd">    Examples:</span>

<span class="sd">        We focus on winter conditions with a relatively short possible sunshine</span>
<span class="sd">        duration:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.meteo import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; factors.timeofsunrise(8.4)</span>
<span class="sd">        &gt;&gt;&gt; factors.timeofsunset(15.6)</span>

<span class="sd">        We start with a daily simulation time step.  The possible sunshine duration is,</span>
<span class="sd">        as expected, the span between sunrise and sunset:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub, round_</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-01&quot;, &quot;2000-01-02&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; derived.sct.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.hours.update()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_possiblesunshineduration_v2()</span>
<span class="sd">        &gt;&gt;&gt; factors.possiblesunshineduration</span>
<span class="sd">        possiblesunshineduration(7.2)</span>

<span class="sd">        The following example calculates the possible hourly sunshine durations of the</span>
<span class="sd">        same day:</span>

<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-01&quot;, &quot;2000-01-02&quot;, &quot;1h&quot;</span>
<span class="sd">        &gt;&gt;&gt; derived.sct.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.hours.update()</span>
<span class="sd">        &gt;&gt;&gt; sum_ = 0.0</span>
<span class="sd">        &gt;&gt;&gt; for idx in range(24):</span>
<span class="sd">        ...     model.idx_sim = idx</span>
<span class="sd">        ...     model.calc_possiblesunshineduration_v2()</span>
<span class="sd">        ...     print(idx+1, end=&quot;: &quot;)   # doctest: +ELLIPSIS</span>
<span class="sd">        ...     round_(factors.possiblesunshineduration.value)</span>
<span class="sd">        ...     sum_ += factors.possiblesunshineduration.value</span>
<span class="sd">        1: 0.0</span>
<span class="sd">        ...</span>
<span class="sd">        9: 0.6</span>
<span class="sd">        10: 1.0</span>
<span class="sd">        ...</span>
<span class="sd">        15: 1.0</span>
<span class="sd">        16: 0.6</span>
<span class="sd">        17: 0.0</span>
<span class="sd">        ...</span>
<span class="sd">        24: 0.0</span>

<span class="sd">        The sum of the possible hourly sunshine durations equals the daily possible</span>
<span class="sd">        sunshine, of course:</span>

<span class="sd">        &gt;&gt;&gt; round_(sum_)</span>
<span class="sd">        7.2</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">meteo_derived</span><span class="o">.</span><span class="n">SCT</span><span class="p">,</span>
        <span class="n">meteo_derived</span><span class="o">.</span><span class="n">Hours</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">meteo_factors</span><span class="o">.</span><span class="n">TimeOfSunrise</span><span class="p">,</span>
        <span class="n">meteo_factors</span><span class="o">.</span><span class="n">TimeOfSunset</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_factors</span><span class="o">.</span><span class="n">PossibleSunshineDuration</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">d_stc</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">sct</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">idx_sim</span><span class="p">]</span>
        <span class="n">d_t0</span> <span class="o">=</span> <span class="nb">max</span><span class="p">((</span><span class="n">d_stc</span> <span class="o">-</span> <span class="n">der</span><span class="o">.</span><span class="n">hours</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">),</span> <span class="n">fac</span><span class="o">.</span><span class="n">timeofsunrise</span><span class="p">)</span>
        <span class="n">d_t1</span> <span class="o">=</span> <span class="nb">min</span><span class="p">((</span><span class="n">d_stc</span> <span class="o">+</span> <span class="n">der</span><span class="o">.</span><span class="n">hours</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">),</span> <span class="n">fac</span><span class="o">.</span><span class="n">timeofsunset</span><span class="p">)</span>
        <span class="n">fac</span><span class="o">.</span><span class="n">possiblesunshineduration</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">d_t1</span> <span class="o">-</span> <span class="n">d_t0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span></div>



<div class="viewcode-block" id="Calc_DailyPossibleSunshineDuration_V1">
<a class="viewcode-back" href="../../../../meteo.html#hydpy.models.meteo.meteo_model.Calc_DailyPossibleSunshineDuration_V1">[docs]</a>
<span class="k">class</span> <span class="nc">Calc_DailyPossibleSunshineDuration_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the astronomically possible daily sunshine duration.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`DailyPossibleSunshineDuration =  TimeOfSunset - TimeOfSunrise`</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.meteo import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; factors.timeofsunrise(8.4)</span>
<span class="sd">        &gt;&gt;&gt; factors.timeofsunset(15.6)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_dailypossiblesunshineduration()</span>
<span class="sd">        &gt;&gt;&gt; factors.dailypossiblesunshineduration</span>
<span class="sd">        dailypossiblesunshineduration(7.2)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">meteo_factors</span><span class="o">.</span><span class="n">TimeOfSunrise</span><span class="p">,</span>
        <span class="n">meteo_factors</span><span class="o">.</span><span class="n">TimeOfSunset</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_factors</span><span class="o">.</span><span class="n">DailyPossibleSunshineDuration</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span><span class="o">.</span><span class="n">dailypossiblesunshineduration</span> <span class="o">=</span> <span class="n">fac</span><span class="o">.</span><span class="n">timeofsunset</span> <span class="o">-</span> <span class="n">fac</span><span class="o">.</span><span class="n">timeofsunrise</span></div>



<div class="viewcode-block" id="Update_LoggedSunshineDuration_V1">
<a class="viewcode-back" href="../../../../meteo.html#hydpy.models.meteo.meteo_model.Update_LoggedSunshineDuration_V1">[docs]</a>
<span class="k">class</span> <span class="nc">Update_LoggedSunshineDuration_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Log the sunshine duration values of the last 24 hours.</span>

<span class="sd">    Example:</span>

<span class="sd">        The following example shows that each new method call successively moves the</span>
<span class="sd">        three memorised values to the right and stores the respective new value on the</span>
<span class="sd">        most left position:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.meteo import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; derived.nmblogentries(3)</span>
<span class="sd">        &gt;&gt;&gt; logs.loggedsunshineduration.shape = 3</span>
<span class="sd">        &gt;&gt;&gt; logs.loggedsunshineduration = 0.0</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import UnitTest</span>
<span class="sd">        &gt;&gt;&gt; test = UnitTest(model,</span>
<span class="sd">        ...                 model.update_loggedsunshineduration_v1,</span>
<span class="sd">        ...                 last_example=4,</span>
<span class="sd">        ...                 parseqs=(inputs.sunshineduration,</span>
<span class="sd">        ...                          logs.loggedsunshineduration))</span>
<span class="sd">        &gt;&gt;&gt; test.nexts.sunshineduration = 1.0, 3.0, 2.0, 4.0</span>
<span class="sd">        &gt;&gt;&gt; del test.inits.loggedsunshineduration</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. | sunshineduration |           loggedsunshineduration |</span>
<span class="sd">        -------------------------------------------------------------</span>
<span class="sd">        |   1 |              1.0 | 1.0  0.0                     0.0 |</span>
<span class="sd">        |   2 |              3.0 | 3.0  1.0                     0.0 |</span>
<span class="sd">        |   3 |              2.0 | 2.0  3.0                     1.0 |</span>
<span class="sd">        |   4 |              4.0 | 4.0  2.0                     3.0 |</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_derived</span><span class="o">.</span><span class="n">NmbLogEntries</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_inputs</span><span class="o">.</span><span class="n">SunshineDuration</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_logs</span><span class="o">.</span><span class="n">LoggedSunshineDuration</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">logs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">nmblogentries</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">loggedsunshineduration</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">log</span><span class="o">.</span><span class="n">loggedsunshineduration</span><span class="p">[</span><span class="n">idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">log</span><span class="o">.</span><span class="n">loggedsunshineduration</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">inp</span><span class="o">.</span><span class="n">sunshineduration</span></div>



<div class="viewcode-block" id="Update_LoggedGlobalRadiation_V1">
<a class="viewcode-back" href="../../../../meteo.html#hydpy.models.meteo.meteo_model.Update_LoggedGlobalRadiation_V1">[docs]</a>
<span class="k">class</span> <span class="nc">Update_LoggedGlobalRadiation_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Log the global radiation values of the last 24 hours.</span>

<span class="sd">    Example:</span>

<span class="sd">        The following example shows that each new method call successively moves the</span>
<span class="sd">        three memorised values to the right and stores the respective new value on the</span>
<span class="sd">        most left position:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.meteo import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; derived.nmblogentries(3)</span>
<span class="sd">        &gt;&gt;&gt; logs.loggedglobalradiation.shape = 3</span>
<span class="sd">        &gt;&gt;&gt; logs.loggedglobalradiation = 0.0</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import UnitTest</span>
<span class="sd">        &gt;&gt;&gt; test = UnitTest(model,</span>
<span class="sd">        ...                 model.update_loggedglobalradiation_v1,</span>
<span class="sd">        ...                 last_example=4,</span>
<span class="sd">        ...                 parseqs=(inputs.globalradiation,</span>
<span class="sd">        ...                          logs.loggedglobalradiation))</span>
<span class="sd">        &gt;&gt;&gt; test.nexts.globalradiation = 1.0, 3.0, 2.0, 4.0</span>
<span class="sd">        &gt;&gt;&gt; del test.inits.loggedglobalradiation</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. | globalradiation |           loggedglobalradiation |</span>
<span class="sd">        -----------------------------------------------------------</span>
<span class="sd">        |   1 |             1.0 | 1.0  0.0                    0.0 |</span>
<span class="sd">        |   2 |             3.0 | 3.0  1.0                    0.0 |</span>
<span class="sd">        |   3 |             2.0 | 2.0  3.0                    1.0 |</span>
<span class="sd">        |   4 |             4.0 | 4.0  2.0                    3.0 |</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_derived</span><span class="o">.</span><span class="n">NmbLogEntries</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_inputs</span><span class="o">.</span><span class="n">GlobalRadiation</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_logs</span><span class="o">.</span><span class="n">LoggedGlobalRadiation</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">logs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">nmblogentries</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">loggedglobalradiation</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">log</span><span class="o">.</span><span class="n">loggedglobalradiation</span><span class="p">[</span><span class="n">idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">log</span><span class="o">.</span><span class="n">loggedglobalradiation</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">inp</span><span class="o">.</span><span class="n">globalradiation</span></div>



<div class="viewcode-block" id="Calc_DailySunshineDuration_V1">
<a class="viewcode-back" href="../../../../meteo.html#hydpy.models.meteo.meteo_model.Calc_DailySunshineDuration_V1">[docs]</a>
<span class="k">class</span> <span class="nc">Calc_DailySunshineDuration_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the sunshine duration sum of the last 24 hours.</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.meteo import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; derived.nmblogentries(3)</span>
<span class="sd">        &gt;&gt;&gt; logs.loggedsunshineduration.shape = 3</span>
<span class="sd">        &gt;&gt;&gt; logs.loggedsunshineduration = 1.0, 5.0, 3.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_dailysunshineduration_v1()</span>
<span class="sd">        &gt;&gt;&gt; factors.dailysunshineduration</span>
<span class="sd">        dailysunshineduration(9.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_derived</span><span class="o">.</span><span class="n">NmbLogEntries</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_logs</span><span class="o">.</span><span class="n">LoggedSunshineDuration</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_factors</span><span class="o">.</span><span class="n">DailySunshineDuration</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">logs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span><span class="o">.</span><span class="n">dailysunshineduration</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">nmblogentries</span><span class="p">):</span>
            <span class="n">fac</span><span class="o">.</span><span class="n">dailysunshineduration</span> <span class="o">+=</span> <span class="n">log</span><span class="o">.</span><span class="n">loggedsunshineduration</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span></div>



<div class="viewcode-block" id="Calc_DailyGlobalRadiation_V2">
<a class="viewcode-back" href="../../../../meteo.html#hydpy.models.meteo.meteo_model.Calc_DailyGlobalRadiation_V2">[docs]</a>
<span class="k">class</span> <span class="nc">Calc_DailyGlobalRadiation_V2</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the global radiation sum of the last 24 hours.</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.meteo import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; derived.nmblogentries(3)</span>
<span class="sd">        &gt;&gt;&gt; logs.loggedglobalradiation.shape = 3</span>
<span class="sd">        &gt;&gt;&gt; logs.loggedglobalradiation = 100.0, 800.0, 600.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_dailyglobalradiation_v2()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailyglobalradiation</span>
<span class="sd">        dailyglobalradiation(500.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_derived</span><span class="o">.</span><span class="n">NmbLogEntries</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_logs</span><span class="o">.</span><span class="n">LoggedGlobalRadiation</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_fluxes</span><span class="o">.</span><span class="n">DailyGlobalRadiation</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">logs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">dailyglobalradiation</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">nmblogentries</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">dailyglobalradiation</span> <span class="o">+=</span> <span class="n">log</span><span class="o">.</span><span class="n">loggedglobalradiation</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">dailyglobalradiation</span> <span class="o">/=</span> <span class="n">der</span><span class="o">.</span><span class="n">nmblogentries</span></div>



<div class="viewcode-block" id="Calc_PortionDailyRadiation_V1">
<a class="viewcode-back" href="../../../../meteo.html#hydpy.models.meteo.meteo_model.Calc_PortionDailyRadiation_V1">[docs]</a>
<span class="k">class</span> <span class="nc">Calc_PortionDailyRadiation_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the relative sum of radiation according to :cite:t:`ref-LARSIM-Hilfe`.</span>

<span class="sd">    Basic equations:</span>

<span class="sd">      .. math::</span>
<span class="sd">        SP = S_P^*(SCT + Hours/2) - S_P^*(SCT - Hours/2)</span>

<span class="sd">      .. math::</span>
<span class="sd">        S_P^*(t) = \begin{cases}</span>
<span class="sd">        0</span>
<span class="sd">        &amp;|\</span>
<span class="sd">        TL_P(t) \leq 0</span>
<span class="sd">        \\</span>
<span class="sd">        50 - 50 \cdot cos\bigl(1.8 \cdot TL_P(t)\bigr) -</span>
<span class="sd">        3.4 \cdot sin\bigl(3.6 \cdot TL_P(t)\bigr)^2</span>
<span class="sd">        &amp;|\</span>
<span class="sd">        0 &lt; TL_P(t) \leq 50 \cdot \frac{2 \cdot Pi}{360}</span>
<span class="sd">        \\</span>
<span class="sd">        50 - 50 \cdot cos\bigl(1.8 \cdot TL_P(t)\bigr) +</span>
<span class="sd">        3.4 \cdot sin\bigl(3.6 \cdot TL_P(t)\bigr)^2</span>
<span class="sd">        &amp;|\</span>
<span class="sd">        50 \cdot \frac{2 \cdot Pi}{360} &lt; TL_P(t) &lt;</span>
<span class="sd">        100 \cdot \frac{2 \cdot Pi}{360}</span>
<span class="sd">        \\</span>
<span class="sd">        100</span>
<span class="sd">        &amp;|\</span>
<span class="sd">        100 \cdot \frac{2 \cdot Pi}{360} \leq TL_P(t)</span>
<span class="sd">        \end{cases}</span>

<span class="sd">      .. math::</span>
<span class="sd">        TL_P(t) = 100 \cdot \frac{2 \cdot Pi}{360} \cdot</span>
<span class="sd">        \frac{t - TimeOfSunrise}{TimeOfSunset - TimeOfSunrise}</span>

<span class="sd">    Examples:</span>

<span class="sd">        We focus on winter conditions with a relatively short possible</span>
<span class="sd">        sunshine duration:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.meteo import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; factors.timeofsunrise(8.4)</span>
<span class="sd">        &gt;&gt;&gt; factors.timeofsunset(15.6)</span>

<span class="sd">        We start with an hourly simulation time step.  The relative radiation sum is,</span>
<span class="sd">        as expected, zero before sunrise and after sunset.  In between, it reaches its</span>
<span class="sd">        maximum around noon:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub, round_</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-01&quot;, &quot;2000-01-02&quot;, &quot;1h&quot;</span>
<span class="sd">        &gt;&gt;&gt; derived.sct.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.hours.update()</span>
<span class="sd">        &gt;&gt;&gt; for idx in range(7, 17):</span>
<span class="sd">        ...     model.idx_sim = idx</span>
<span class="sd">        ...     model.calc_portiondailyradiation_v1()</span>
<span class="sd">        ...     print(idx+1, end=&quot;: &quot;)</span>
<span class="sd">        ...     round_(factors.portiondailyradiation.value)</span>
<span class="sd">        8: 0.0</span>
<span class="sd">        9: 0.853709</span>
<span class="sd">        10: 7.546592</span>
<span class="sd">        11: 18.473585</span>
<span class="sd">        12: 23.126115</span>
<span class="sd">        13: 23.126115</span>
<span class="sd">        14: 18.473585</span>
<span class="sd">        15: 7.546592</span>
<span class="sd">        16: 0.853709</span>
<span class="sd">        17: 0.0</span>

<span class="sd">        The following examples show how method |Calc_PortionDailyRadiation_V1| works</span>
<span class="sd">        for time step sizes longer than one hour:</span>

<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-01&quot;, &quot;2000-01-02&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; derived.sct.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.hours.update()</span>
<span class="sd">        &gt;&gt;&gt; model.idx_sim = 0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_portiondailyradiation_v1()</span>
<span class="sd">        &gt;&gt;&gt; factors.portiondailyradiation</span>
<span class="sd">        portiondailyradiation(100.0)</span>

<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-01&quot;, &quot;2000-01-02&quot;, &quot;6h&quot;</span>
<span class="sd">        &gt;&gt;&gt; derived.sct.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.hours.update()</span>
<span class="sd">        &gt;&gt;&gt; for idx in range(4):</span>
<span class="sd">        ...     model.idx_sim = idx</span>
<span class="sd">        ...     model.calc_portiondailyradiation_v1()</span>
<span class="sd">        ...     print((idx+1)*6, end=&quot;: &quot;)</span>
<span class="sd">        ...     round_(factors.portiondailyradiation.value)</span>
<span class="sd">        6: 0.0</span>
<span class="sd">        12: 50.0</span>
<span class="sd">        18: 50.0</span>
<span class="sd">        24: 0.0</span>

<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-01&quot;, &quot;2000-01-02&quot;, &quot;3h&quot;</span>
<span class="sd">        &gt;&gt;&gt; derived.sct.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.hours.update()</span>
<span class="sd">        &gt;&gt;&gt; for idx in range(8):</span>
<span class="sd">        ...     model.idx_sim = idx</span>
<span class="sd">        ...     model.calc_portiondailyradiation_v1()</span>
<span class="sd">        ...     print((idx+1)*3, end=&quot;: &quot;)</span>
<span class="sd">        ...     round_(factors.portiondailyradiation.value)</span>
<span class="sd">        3: 0.0</span>
<span class="sd">        6: 0.0</span>
<span class="sd">        9: 0.853709</span>
<span class="sd">        12: 49.146291</span>
<span class="sd">        15: 49.146291</span>
<span class="sd">        18: 0.853709</span>
<span class="sd">        21: 0.0</span>
<span class="sd">        24: 0.0</span>

<span class="sd">        Often, method |Calc_PortionDailyRadiation_V1| calculates a small but</span>
<span class="sd">        unrealistic &quot;bump&quot; around noon (for example, the relative radiation is slightly</span>
<span class="sd">        smaller between 11:30 and 12:00 than it is between 11:00 and 11:30):</span>

<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-01&quot;, &quot;2000-01-02&quot;, &quot;30m&quot;</span>
<span class="sd">        &gt;&gt;&gt; derived.sct.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.hours.update()</span>
<span class="sd">        &gt;&gt;&gt; for idx in range(15, 33):</span>
<span class="sd">        ...     model.idx_sim = idx</span>
<span class="sd">        ...     model.calc_portiondailyradiation_v1()</span>
<span class="sd">        ...     print((idx+1)/2, end=&quot;: &quot;)</span>
<span class="sd">        ...     round_(factors.portiondailyradiation.value)</span>
<span class="sd">        8.0: 0.0</span>
<span class="sd">        8.5: 0.021762</span>
<span class="sd">        9.0: 0.831947</span>
<span class="sd">        9.5: 2.514315</span>
<span class="sd">        10.0: 5.032276</span>
<span class="sd">        10.5: 7.989385</span>
<span class="sd">        11.0: 10.4842</span>
<span class="sd">        11.5: 11.696873</span>
<span class="sd">        12.0: 11.429242</span>
<span class="sd">        12.5: 11.429242</span>
<span class="sd">        13.0: 11.696873</span>
<span class="sd">        13.5: 10.4842</span>
<span class="sd">        14.0: 7.989385</span>
<span class="sd">        14.5: 5.032276</span>
<span class="sd">        15.0: 2.514315</span>
<span class="sd">        15.5: 0.831947</span>
<span class="sd">        16.0: 0.021762</span>
<span class="sd">        16.5: 0.0</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">meteo_derived</span><span class="o">.</span><span class="n">SCT</span><span class="p">,</span>
        <span class="n">meteo_derived</span><span class="o">.</span><span class="n">Hours</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_fixed</span><span class="o">.</span><span class="n">Pi</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">meteo_factors</span><span class="o">.</span><span class="n">TimeOfSunrise</span><span class="p">,</span>
        <span class="n">meteo_factors</span><span class="o">.</span><span class="n">TimeOfSunset</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_factors</span><span class="o">.</span><span class="n">PortionDailyRadiation</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">d_fac</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">fix</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">360.0</span>
        <span class="n">fac</span><span class="o">.</span><span class="n">portiondailyradiation</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span><span class="p">:</span>
                <span class="n">d_dt</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">hours</span> <span class="o">/</span> <span class="mf">2.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">d_dt</span> <span class="o">=</span> <span class="o">-</span><span class="n">der</span><span class="o">.</span><span class="n">hours</span> <span class="o">/</span> <span class="mf">2.0</span>
            <span class="n">d_tlp</span> <span class="o">=</span> <span class="p">(</span><span class="mf">100.0</span> <span class="o">*</span> <span class="n">d_fac</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
                <span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">sct</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">idx_sim</span><span class="p">]</span> <span class="o">+</span> <span class="n">d_dt</span> <span class="o">-</span> <span class="n">fac</span><span class="o">.</span><span class="n">timeofsunrise</span><span class="p">)</span>
                <span class="o">/</span> <span class="p">(</span><span class="n">fac</span><span class="o">.</span><span class="n">timeofsunset</span> <span class="o">-</span> <span class="n">fac</span><span class="o">.</span><span class="n">timeofsunrise</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">d_tlp</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">d_p</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">elif</span> <span class="n">d_tlp</span> <span class="o">&lt;</span> <span class="mf">100.0</span> <span class="o">*</span> <span class="n">d_fac</span><span class="p">:</span>
                <span class="n">d_p</span> <span class="o">=</span> <span class="mf">50.0</span> <span class="o">-</span> <span class="mf">50.0</span> <span class="o">*</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mf">1.8</span> <span class="o">*</span> <span class="n">d_tlp</span><span class="p">)</span>
                <span class="n">d_temp</span> <span class="o">=</span> <span class="mf">3.4</span> <span class="o">*</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mf">3.6</span> <span class="o">*</span> <span class="n">d_tlp</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
                <span class="k">if</span> <span class="n">d_tlp</span> <span class="o">&lt;=</span> <span class="mf">50.0</span> <span class="o">*</span> <span class="n">d_fac</span><span class="p">:</span>
                    <span class="n">d_p</span> <span class="o">-=</span> <span class="n">d_temp</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">d_p</span> <span class="o">+=</span> <span class="n">d_temp</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">d_p</span> <span class="o">=</span> <span class="mf">100.0</span>
            <span class="k">if</span> <span class="n">i</span><span class="p">:</span>
                <span class="n">fac</span><span class="o">.</span><span class="n">portiondailyradiation</span> <span class="o">+=</span> <span class="n">d_p</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fac</span><span class="o">.</span><span class="n">portiondailyradiation</span> <span class="o">-=</span> <span class="n">d_p</span></div>



<div class="viewcode-block" id="Return_DailyGlobalRadiation_V1">
<a class="viewcode-back" href="../../../../meteo.html#hydpy.models.meteo.meteo_model.Return_DailyGlobalRadiation_V1">[docs]</a>
<span class="k">class</span> <span class="nc">Return_DailyGlobalRadiation_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate and return the daily global radiation according to</span>
<span class="sd">    :cite:t:`ref-LARSIM`.</span>

<span class="sd">    Additional requirements:</span>
<span class="sd">      |Model.idx_sim|</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      .. math::</span>
<span class="sd">        ExtraterrestrialRadiation \cdot \begin{cases}</span>
<span class="sd">        AngstromConstant + AngstromFactor \cdot</span>
<span class="sd">        \frac{sunshineduration}{possiblesunshineduration}</span>
<span class="sd">        &amp;|\</span>
<span class="sd">        sunshineduration &gt; 0 \;\; \lor \;\; Days &lt; 1</span>
<span class="sd">        \\</span>
<span class="sd">        AngstromAlternative</span>
<span class="sd">        &amp;|\</span>
<span class="sd">        sunshineduration = 0 \;\; \land \;\; Days \geq 1</span>
<span class="sd">        \end{cases}</span>

<span class="sd">    Example:</span>

<span class="sd">        You can define month-specific Angstrom coefficients to reflect the annual</span>
<span class="sd">        variability in the relationship between sunshine duration and global radiation.</span>
<span class="sd">        First, we demonstrate this on a daily timestep basis:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub, round_</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-30&quot;, &quot;2000-02-03&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.meteo import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; derived.moy.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.days.update()</span>
<span class="sd">        &gt;&gt;&gt; angstromconstant.jan = 0.1</span>
<span class="sd">        &gt;&gt;&gt; angstromfactor.jan = 0.5</span>
<span class="sd">        &gt;&gt;&gt; angstromalternative.jan = 0.2</span>
<span class="sd">        &gt;&gt;&gt; angstromconstant.feb = 0.2</span>
<span class="sd">        &gt;&gt;&gt; angstromfactor.feb = 0.6</span>
<span class="sd">        &gt;&gt;&gt; angstromalternative.feb = 0.3</span>
<span class="sd">        &gt;&gt;&gt; fluxes.extraterrestrialradiation = 340.0</span>
<span class="sd">        &gt;&gt;&gt; model.idx_sim = 1</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_dailyglobalradiation_v1(0.6, 1.0))</span>
<span class="sd">        136.0</span>
<span class="sd">        &gt;&gt;&gt; model.idx_sim = 2</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_dailyglobalradiation_v1(0.6, 1.0))</span>
<span class="sd">        190.4</span>

<span class="sd">        If the possible sunshine duration is zero, we generally set global radiation to</span>
<span class="sd">        zero (even if the actual sunshine duration is larger than zero, which might</span>
<span class="sd">        occur as a result of inconsistencies between measured and calculated input</span>
<span class="sd">        data):</span>

<span class="sd">        &gt;&gt;&gt; round_(model.return_dailyglobalradiation_v1(0.6, 0.0))</span>
<span class="sd">        0.0</span>

<span class="sd">        When actual sunshine is zero, the alternative Ångström coefficient applies:</span>

<span class="sd">        &gt;&gt;&gt; model.idx_sim = 1</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_dailyglobalradiation_v1(0.0, 1.0))</span>
<span class="sd">        68.0</span>
<span class="sd">        &gt;&gt;&gt; model.idx_sim = 2</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_dailyglobalradiation_v1(0.0, 1.0))</span>
<span class="sd">        102.0</span>

<span class="sd">        All of the examples and explanations above hold for short simulation timesteps,</span>
<span class="sd">        except that |AngstromAlternative| never replaces |AngstromConstant|:</span>

<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-30&quot;, &quot;2000-02-03&quot;, &quot;1h&quot;</span>
<span class="sd">        &gt;&gt;&gt; derived.moy.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.days.update()</span>
<span class="sd">        &gt;&gt;&gt; model.idx_sim = 1</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_dailyglobalradiation_v1(0.0, 1.0))</span>
<span class="sd">        34.0</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">meteo_control</span><span class="o">.</span><span class="n">AngstromConstant</span><span class="p">,</span>
        <span class="n">meteo_control</span><span class="o">.</span><span class="n">AngstromFactor</span><span class="p">,</span>
        <span class="n">meteo_control</span><span class="o">.</span><span class="n">AngstromAlternative</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">meteo_derived</span><span class="o">.</span><span class="n">MOY</span><span class="p">,</span>
        <span class="n">meteo_derived</span><span class="o">.</span><span class="n">Days</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_fluxes</span><span class="o">.</span><span class="n">ExtraterrestrialRadiation</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span>
        <span class="n">sunshineduration</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">possiblesunshineduration</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">if</span> <span class="n">possiblesunshineduration</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">moy</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">idx_sim</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">sunshineduration</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">days</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">flu</span><span class="o">.</span><span class="n">extraterrestrialradiation</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">angstromalternative</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">flu</span><span class="o">.</span><span class="n">extraterrestrialradiation</span> <span class="o">*</span> <span class="p">(</span>
                <span class="n">con</span><span class="o">.</span><span class="n">angstromconstant</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
                <span class="o">+</span> <span class="n">con</span><span class="o">.</span><span class="n">angstromfactor</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">*</span> <span class="n">sunshineduration</span> <span class="o">/</span> <span class="n">possiblesunshineduration</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_ClearSkySolarRadiation_V1">
<a class="viewcode-back" href="../../../../meteo.html#hydpy.models.meteo.meteo_model.Calc_ClearSkySolarRadiation_V1">[docs]</a>
<span class="k">class</span> <span class="nc">Calc_ClearSkySolarRadiation_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the clear sky solar radiation according to :cite:t:`ref-Allen1998`.</span>

<span class="sd">    Basic equation (:cite:t`ref-Allen1998`, eq. 35):</span>
<span class="sd">      :math:`ClearSkySolarRadiation =</span>
<span class="sd">      ExtraterrestrialRadiation \cdot (AngstromConstant + AngstromFactor)`</span>

<span class="sd">    Example:</span>

<span class="sd">        We use the Ångström coefficients (a=0.19, b=0.55) recommended for Germany by</span>
<span class="sd">        DVWK-M 504 :cite:t:`ref-DVWK` for January and the default values (a=0.25, b=0.5)</span>
<span class="sd">        for February:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-30&quot;, &quot;2000-02-03&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.meteo import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; angstromconstant.jan = 0.19</span>
<span class="sd">        &gt;&gt;&gt; angstromfactor.jan = 0.55</span>
<span class="sd">        &gt;&gt;&gt; angstromconstant.feb = 0.25</span>
<span class="sd">        &gt;&gt;&gt; angstromfactor.feb = 0.5</span>
<span class="sd">        &gt;&gt;&gt; derived.moy.update()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.extraterrestrialradiation = 200.0</span>
<span class="sd">        &gt;&gt;&gt; model.idx_sim = 1</span>
<span class="sd">        &gt;&gt;&gt; model.calc_clearskysolarradiation_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.clearskysolarradiation</span>
<span class="sd">        clearskysolarradiation(148.0)</span>
<span class="sd">        &gt;&gt;&gt; model.idx_sim = 2</span>
<span class="sd">        &gt;&gt;&gt; model.calc_clearskysolarradiation_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.clearskysolarradiation</span>
<span class="sd">        clearskysolarradiation(150.0)</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">meteo_control</span><span class="o">.</span><span class="n">AngstromConstant</span><span class="p">,</span>
        <span class="n">meteo_control</span><span class="o">.</span><span class="n">AngstromFactor</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_derived</span><span class="o">.</span><span class="n">MOY</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_fluxes</span><span class="o">.</span><span class="n">ExtraterrestrialRadiation</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_fluxes</span><span class="o">.</span><span class="n">ClearSkySolarRadiation</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">moy</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">idx_sim</span><span class="p">]</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">clearskysolarradiation</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">extraterrestrialradiation</span> <span class="o">*</span> <span class="p">(</span>
            <span class="n">con</span><span class="o">.</span><span class="n">angstromconstant</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">+</span> <span class="n">con</span><span class="o">.</span><span class="n">angstromfactor</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="Calc_GlobalRadiation_V1">
<a class="viewcode-back" href="../../../../meteo.html#hydpy.models.meteo.meteo_model.Calc_GlobalRadiation_V1">[docs]</a>
<span class="k">class</span> <span class="nc">Calc_GlobalRadiation_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the global radiation according to :cite:t:`ref-Allen1998`.</span>

<span class="sd">    Basic equation (:cite:t:`ref-Allen1998`, equation 35):</span>
<span class="sd">      :math:`GlobalRadiation = ExtraterrestrialRadiation \cdot (AngstromConstant +</span>
<span class="sd">      AngstromFactor \cdot SunshineDuration / PossibleSunshineDuration)`</span>

<span class="sd">    Example:</span>

<span class="sd">        We use the Ångström coefficients (a=0.19, b=0.55) recommended for Germany by</span>
<span class="sd">        DVWK-M 504 :cite:t:`ref-DVWK` for January and the default values (a=0.25, b=0.5)</span>
<span class="sd">        for February:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub, round_</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-30&quot;, &quot;2000-02-03&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.meteo import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; angstromconstant.jan = 0.19</span>
<span class="sd">        &gt;&gt;&gt; angstromfactor.jan = 0.55</span>
<span class="sd">        &gt;&gt;&gt; angstromconstant.feb = 0.25</span>
<span class="sd">        &gt;&gt;&gt; angstromfactor.feb = 0.5</span>
<span class="sd">        &gt;&gt;&gt; derived.moy.update()</span>
<span class="sd">        &gt;&gt;&gt; inputs.sunshineduration = 12.0</span>
<span class="sd">        &gt;&gt;&gt; factors.possiblesunshineduration = 14.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.extraterrestrialradiation = 200.0</span>
<span class="sd">        &gt;&gt;&gt; model.idx_sim = 1</span>
<span class="sd">        &gt;&gt;&gt; model.calc_globalradiation_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.globalradiation</span>
<span class="sd">        globalradiation(132.285714)</span>
<span class="sd">        &gt;&gt;&gt; model.idx_sim = 2</span>
<span class="sd">        &gt;&gt;&gt; model.calc_globalradiation_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.globalradiation</span>
<span class="sd">        globalradiation(135.714286)</span>

<span class="sd">        For zero possible sunshine durations, |Calc_GlobalRadiation_V1| sets</span>
<span class="sd">        |meteo_fluxes.GlobalRadiation| to zero:</span>

<span class="sd">        &gt;&gt;&gt; factors.possiblesunshineduration = 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_globalradiation_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.globalradiation</span>
<span class="sd">        globalradiation(0.0)</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">meteo_control</span><span class="o">.</span><span class="n">AngstromConstant</span><span class="p">,</span>
        <span class="n">meteo_control</span><span class="o">.</span><span class="n">AngstromFactor</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_derived</span><span class="o">.</span><span class="n">MOY</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">meteo_inputs</span><span class="o">.</span><span class="n">SunshineDuration</span><span class="p">,</span>
        <span class="n">meteo_factors</span><span class="o">.</span><span class="n">PossibleSunshineDuration</span><span class="p">,</span>
        <span class="n">meteo_fluxes</span><span class="o">.</span><span class="n">ExtraterrestrialRadiation</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_fluxes</span><span class="o">.</span><span class="n">GlobalRadiation</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">if</span> <span class="n">fac</span><span class="o">.</span><span class="n">possiblesunshineduration</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">moy</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">idx_sim</span><span class="p">]</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">globalradiation</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">extraterrestrialradiation</span> <span class="o">*</span> <span class="p">(</span>
                <span class="n">con</span><span class="o">.</span><span class="n">angstromconstant</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
                <span class="o">+</span> <span class="n">con</span><span class="o">.</span><span class="n">angstromfactor</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
                <span class="o">*</span> <span class="n">inp</span><span class="o">.</span><span class="n">sunshineduration</span>
                <span class="o">/</span> <span class="n">fac</span><span class="o">.</span><span class="n">possiblesunshineduration</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">globalradiation</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_UnadjustedGlobalRadiation_V1">
<a class="viewcode-back" href="../../../../meteo.html#hydpy.models.meteo.meteo_model.Calc_UnadjustedGlobalRadiation_V1">[docs]</a>
<span class="k">class</span> <span class="nc">Calc_UnadjustedGlobalRadiation_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the unadjusted global radiation according to :cite:t:`ref-LARSIM`.</span>

<span class="sd">    Additional requirements:</span>
<span class="sd">      |Model.idx_sim|</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      .. math::</span>
<span class="sd">        UnadjustedGlobalRadiation =</span>
<span class="sd">        NmbLogEntries \cdot \frac{SP}{100} \cdot \begin{cases}</span>
<span class="sd">        Return\_DailyGlobalRadiation\_V1(</span>
<span class="sd">        SunshineDuration, PossibleSunshineDuration)</span>
<span class="sd">        &amp;|\</span>
<span class="sd">        PossibleSunshineDuration &gt; 0</span>
<span class="sd">        \\</span>
<span class="sd">        Return\_DailyGlobalRadiation\_V1(</span>
<span class="sd">        DailySunshineDuration, DailyPossibleSunshineDuration)</span>
<span class="sd">        &amp;|\</span>
<span class="sd">        PossibleSunshineDuration = 0</span>
<span class="sd">        \end{cases}</span>

<span class="sd">    Examples:</span>

<span class="sd">        Method |Calc_UnadjustedGlobalRadiation_V1| uses the actual value of</span>
<span class="sd">        |PortionDailyRadiation| and method |Return_DailyGlobalRadiation_V1| to</span>
<span class="sd">        calculate global radiation according to the current values of</span>
<span class="sd">        |meteo_inputs.SunshineDuration| and |PossibleSunshineDuration|:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-31&quot;, &quot;2000-02-02&quot;, &quot;6h&quot;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.meteo import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; derived.nmblogentries.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.moy.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.days.update()</span>
<span class="sd">        &gt;&gt;&gt; angstromconstant.jan = 0.1</span>
<span class="sd">        &gt;&gt;&gt; angstromfactor.jan = 0.5</span>
<span class="sd">        &gt;&gt;&gt; angstromalternative.jan = 0.2</span>
<span class="sd">        &gt;&gt;&gt; inputs.sunshineduration = 0.6</span>
<span class="sd">        &gt;&gt;&gt; factors.possiblesunshineduration = 1.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.extraterrestrialradiation = 340.0</span>
<span class="sd">        &gt;&gt;&gt; factors.portiondailyradiation = 50.0</span>
<span class="sd">        &gt;&gt;&gt; model.idx_sim = 3</span>
<span class="sd">        &gt;&gt;&gt; model.calc_unadjustedglobalradiation_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.unadjustedglobalradiation</span>
<span class="sd">        unadjustedglobalradiation(272.0)</span>

<span class="sd">        During nighttime periods, the value of |PossibleSunshineDuration| is zero.</span>
<span class="sd">        Then, |Calc_GlobalRadiation_V1| uses the values of |DailySunshineDuration| and</span>
<span class="sd">        |DailyPossibleSunshineDuration| as surrogates:</span>

<span class="sd">        &gt;&gt;&gt; factors.possiblesunshineduration = 0.0</span>
<span class="sd">        &gt;&gt;&gt; factors.dailysunshineduration = 4.0</span>
<span class="sd">        &gt;&gt;&gt; factors.dailypossiblesunshineduration = 10.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_unadjustedglobalradiation_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.unadjustedglobalradiation</span>
<span class="sd">        unadjustedglobalradiation(204.0)</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Return_DailyGlobalRadiation_V1</span><span class="p">,)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">meteo_control</span><span class="o">.</span><span class="n">AngstromConstant</span><span class="p">,</span>
        <span class="n">meteo_control</span><span class="o">.</span><span class="n">AngstromFactor</span><span class="p">,</span>
        <span class="n">meteo_control</span><span class="o">.</span><span class="n">AngstromAlternative</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">meteo_derived</span><span class="o">.</span><span class="n">NmbLogEntries</span><span class="p">,</span>
        <span class="n">meteo_derived</span><span class="o">.</span><span class="n">MOY</span><span class="p">,</span>
        <span class="n">meteo_derived</span><span class="o">.</span><span class="n">Days</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">meteo_inputs</span><span class="o">.</span><span class="n">SunshineDuration</span><span class="p">,</span>
        <span class="n">meteo_factors</span><span class="o">.</span><span class="n">PossibleSunshineDuration</span><span class="p">,</span>
        <span class="n">meteo_factors</span><span class="o">.</span><span class="n">DailySunshineDuration</span><span class="p">,</span>
        <span class="n">meteo_factors</span><span class="o">.</span><span class="n">DailyPossibleSunshineDuration</span><span class="p">,</span>
        <span class="n">meteo_factors</span><span class="o">.</span><span class="n">PortionDailyRadiation</span><span class="p">,</span>
        <span class="n">meteo_fluxes</span><span class="o">.</span><span class="n">ExtraterrestrialRadiation</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_fluxes</span><span class="o">.</span><span class="n">UnadjustedGlobalRadiation</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">if</span> <span class="n">fac</span><span class="o">.</span><span class="n">possiblesunshineduration</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">d_act</span> <span class="o">=</span> <span class="n">inp</span><span class="o">.</span><span class="n">sunshineduration</span>
            <span class="n">d_pos</span> <span class="o">=</span> <span class="n">fac</span><span class="o">.</span><span class="n">possiblesunshineduration</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d_act</span> <span class="o">=</span> <span class="n">fac</span><span class="o">.</span><span class="n">dailysunshineduration</span>
            <span class="n">d_pos</span> <span class="o">=</span> <span class="n">fac</span><span class="o">.</span><span class="n">dailypossiblesunshineduration</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">unadjustedglobalradiation</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">der</span><span class="o">.</span><span class="n">nmblogentries</span> <span class="o">*</span> <span class="n">fac</span><span class="o">.</span><span class="n">portiondailyradiation</span> <span class="o">/</span> <span class="mf">100.0</span>
        <span class="p">)</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">return_dailyglobalradiation_v1</span><span class="p">(</span><span class="n">d_act</span><span class="p">,</span> <span class="n">d_pos</span><span class="p">)</span></div>



<div class="viewcode-block" id="Update_LoggedUnadjustedGlobalRadiation_V1">
<a class="viewcode-back" href="../../../../meteo.html#hydpy.models.meteo.meteo_model.Update_LoggedUnadjustedGlobalRadiation_V1">[docs]</a>
<span class="k">class</span> <span class="nc">Update_LoggedUnadjustedGlobalRadiation_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Log the unadjusted global radiation values of the last 24 hours.</span>

<span class="sd">    Example:</span>

<span class="sd">        The following example shows that each new method call successively moves the</span>
<span class="sd">        three memorised values to the right and stores the respective new value on the</span>
<span class="sd">        most left position:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.meteo import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;8h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; derived.nmblogentries.update()</span>
<span class="sd">        &gt;&gt;&gt; logs.loggedunadjustedglobalradiation = 0.0</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import UnitTest</span>
<span class="sd">        &gt;&gt;&gt; test = UnitTest(model,</span>
<span class="sd">        ...                 model.update_loggedunadjustedglobalradiation_v1,</span>
<span class="sd">        ...                 last_example=4,</span>
<span class="sd">        ...                 parseqs=(fluxes.unadjustedglobalradiation,</span>
<span class="sd">        ...                          logs.loggedunadjustedglobalradiation))</span>
<span class="sd">        &gt;&gt;&gt; test.nexts.unadjustedglobalradiation = 1.0, 3.0, 2.0, 4.0</span>
<span class="sd">        &gt;&gt;&gt; del test.inits.loggedunadjustedglobalradiation</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. | unadjustedglobalradiation |           loggedunadjustedglobalradiation |</span>
<span class="sd">        -------------------------------------------------------------------------------</span>
<span class="sd">        |   1 |                       1.0 | 1.0  0.0                              0.0 |</span>
<span class="sd">        |   2 |                       3.0 | 3.0  1.0                              0.0 |</span>
<span class="sd">        |   3 |                       2.0 | 2.0  3.0                              1.0 |</span>
<span class="sd">        |   4 |                       4.0 | 4.0  2.0                              3.0 |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_derived</span><span class="o">.</span><span class="n">NmbLogEntries</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_fluxes</span><span class="o">.</span><span class="n">UnadjustedGlobalRadiation</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_logs</span><span class="o">.</span><span class="n">LoggedUnadjustedGlobalRadiation</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">logs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">nmblogentries</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">loggedunadjustedglobalradiation</span><span class="p">[</span>
                <span class="n">idx</span>
            <span class="p">]</span> <span class="o">=</span> <span class="n">log</span><span class="o">.</span><span class="n">loggedunadjustedglobalradiation</span><span class="p">[</span><span class="n">idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">log</span><span class="o">.</span><span class="n">loggedunadjustedglobalradiation</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">unadjustedglobalradiation</span></div>



<div class="viewcode-block" id="Calc_DailyGlobalRadiation_V1">
<a class="viewcode-back" href="../../../../meteo.html#hydpy.models.meteo.meteo_model.Calc_DailyGlobalRadiation_V1">[docs]</a>
<span class="k">class</span> <span class="nc">Calc_DailyGlobalRadiation_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the daily global radiation.</span>

<span class="sd">    Additional requirements:</span>
<span class="sd">      |Model.idx_sim|</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`DailyGlobalRadiation = Return\_DailyGlobalRadiation\_V1(</span>
<span class="sd">      DailySunshineDuration, DailyPossibleSunshineDuration)`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.meteo import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; angstromconstant.jan = 0.1</span>
<span class="sd">        &gt;&gt;&gt; angstromfactor.jan = 0.5</span>
<span class="sd">        &gt;&gt;&gt; angstromconstant.feb = 0.2</span>
<span class="sd">        &gt;&gt;&gt; angstromfactor.feb = 0.6</span>

<span class="sd">        We set the extraterrestrial radiation to 200 W/m² and the possible sunshine</span>
<span class="sd">        duration to 12 hours:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.extraterrestrialradiation = 200.0</span>
<span class="sd">        &gt;&gt;&gt; factors.dailypossiblesunshineduration = 12.0</span>

<span class="sd">        We define a daily simulation step size and update the relevant derived</span>
<span class="sd">        parameters:</span>

<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-30&quot;, &quot;2000-02-03&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; derived.moy.update()</span>

<span class="sd">        Applying the Ångström coefficients for January and February on the defined</span>
<span class="sd">        extraterrestrial radiation and a sunshine duration of 7.2 hours results in a</span>
<span class="sd">        daily global radiation average of 80 and 112 W/m², respectively:</span>

<span class="sd">        &gt;&gt;&gt; model.idx_sim = 1</span>
<span class="sd">        &gt;&gt;&gt; factors.dailysunshineduration = 7.2</span>
<span class="sd">        &gt;&gt;&gt; model.calc_dailyglobalradiation_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailyglobalradiation</span>
<span class="sd">        dailyglobalradiation(80.0)</span>

<span class="sd">        &gt;&gt;&gt; model.idx_sim = 2</span>
<span class="sd">        &gt;&gt;&gt; model.calc_dailyglobalradiation_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailyglobalradiation</span>
<span class="sd">        dailyglobalradiation(112.0)</span>

<span class="sd">        Finally, we demonstrate for January that method |Calc_DailyGlobalRadiation_V1|</span>
<span class="sd">        calculates the same values for an hourly simulation time step, as long as the</span>
<span class="sd">        daily sum of sunshine duration remains identical:</span>

<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-30&quot;, &quot;2000-02-03&quot;, &quot;1h&quot;</span>
<span class="sd">        &gt;&gt;&gt; derived.moy.update()</span>

<span class="sd">        The actual simulation step starts at 11 o&#39;clock and ends at 12 o&#39;clock:</span>

<span class="sd">        &gt;&gt;&gt; model.idx_sim = pub.timegrids.init[&quot;2000-01-31 11:00&quot;]</span>
<span class="sd">        &gt;&gt;&gt; factors.dailysunshineduration = 7.2</span>
<span class="sd">        &gt;&gt;&gt; model.calc_dailyglobalradiation_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailyglobalradiation</span>
<span class="sd">        dailyglobalradiation(80.0)</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Return_DailyGlobalRadiation_V1</span><span class="p">,)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">meteo_control</span><span class="o">.</span><span class="n">AngstromConstant</span><span class="p">,</span>
        <span class="n">meteo_control</span><span class="o">.</span><span class="n">AngstromFactor</span><span class="p">,</span>
        <span class="n">meteo_control</span><span class="o">.</span><span class="n">AngstromAlternative</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">meteo_derived</span><span class="o">.</span><span class="n">MOY</span><span class="p">,</span>
        <span class="n">meteo_derived</span><span class="o">.</span><span class="n">Days</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">meteo_factors</span><span class="o">.</span><span class="n">DailySunshineDuration</span><span class="p">,</span>
        <span class="n">meteo_factors</span><span class="o">.</span><span class="n">DailyPossibleSunshineDuration</span><span class="p">,</span>
        <span class="n">meteo_fluxes</span><span class="o">.</span><span class="n">ExtraterrestrialRadiation</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_fluxes</span><span class="o">.</span><span class="n">DailyGlobalRadiation</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">dailyglobalradiation</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_dailyglobalradiation_v1</span><span class="p">(</span>
            <span class="n">fac</span><span class="o">.</span><span class="n">dailysunshineduration</span><span class="p">,</span> <span class="n">fac</span><span class="o">.</span><span class="n">dailypossiblesunshineduration</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="Return_SunshineDuration_V1">
<a class="viewcode-back" href="../../../../meteo.html#hydpy.models.meteo.meteo_model.Return_SunshineDuration_V1">[docs]</a>
<span class="k">class</span> <span class="nc">Return_SunshineDuration_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the sunshine duration reversely to |Return_DailyGlobalRadiation_V1|</span>
<span class="sd">    and return it.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`\frac{possiblesunshineduration}{AngstromFactor} \cdot \left(</span>
<span class="sd">      \frac{globalradiation}{extraterrestrialradiation} - AngstromConstant \right)`</span>

<span class="sd">    Example:</span>

<span class="sd">        Essentially, |Return_SunshineDuration_V1| tries to invert</span>
<span class="sd">        |Return_DailyGlobalRadiation_V1| and thus also relies on the Ångström formula.</span>
<span class="sd">        Instead of estimating global radiation from sunshine duration, it estimates</span>
<span class="sd">        sunshine duration from global radiation.  We demonstrate this by repeating the</span>
<span class="sd">        first examples of |Calc_GlobalRadiation_V1| &quot;backwards&quot;:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub, round_</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-30&quot;, &quot;2000-02-03&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.meteo import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; derived.moy.update()</span>
<span class="sd">        &gt;&gt;&gt; angstromconstant.jan = 0.1</span>
<span class="sd">        &gt;&gt;&gt; angstromfactor.jan = 0.5</span>
<span class="sd">        &gt;&gt;&gt; angstromalternative.jan = 0.2</span>
<span class="sd">        &gt;&gt;&gt; angstromconstant.feb = 0.2</span>
<span class="sd">        &gt;&gt;&gt; angstromfactor.feb = 0.6</span>
<span class="sd">        &gt;&gt;&gt; angstromalternative.feb = 0.3</span>
<span class="sd">        &gt;&gt;&gt; model.idx_sim = 1</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_sunshineduration_v1(136.0, 340.0, 1.0))</span>
<span class="sd">        0.6</span>
<span class="sd">        &gt;&gt;&gt; model.idx_sim = 2</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_sunshineduration_v1(190.4, 340.0, 1.0))</span>
<span class="sd">        0.6</span>

<span class="sd">        In contrast to |Return_DailyGlobalRadiation_V1|, |Return_SunshineDuration_V1|</span>
<span class="sd">        never applies |AngstromAlternative| instead of |AngstromConstant|.  Hence, as</span>
<span class="sd">        in the following repeated examples, |Return_SunshineDuration_V1| might invert</span>
<span class="sd">        |Return_DailyGlobalRadiation_V1| only roughly during periods with little</span>
<span class="sd">        sunshine:</span>

<span class="sd">        &gt;&gt;&gt; model.idx_sim = 1</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_sunshineduration_v1(68.0, 340.0, 1.0))</span>
<span class="sd">        0.2</span>
<span class="sd">        &gt;&gt;&gt; model.idx_sim = 2</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_sunshineduration_v1(102.0, 340.0, 1.0))</span>
<span class="sd">        0.166667</span>

<span class="sd">        We must consider additional corner cases.  The first one deals with a potential</span>
<span class="sd">        zero division during nighttime.  If extraterrestrial radiation is zero,</span>
<span class="sd">        |Return_SunshineDuration_V1| takes the astronomically possible sunshine</span>
<span class="sd">        duration (which should ideally also be zero) as the actual sunshine duration:</span>

<span class="sd">        &gt;&gt;&gt; model.idx_sim = 1</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_sunshineduration_v1(136.0, 0.0, 0.00001))</span>
<span class="sd">        0.00001</span>

<span class="sd">        Measured global radiation smaller than estimated diffusive radiation would</span>
<span class="sd">        result in negative sunshine durations when following the Ångström formula</span>
<span class="sd">        strictly.  Additionally, measured global radiation larger than estimated</span>
<span class="sd">        clear-sky radiation would result in sunshine durations larger than the</span>
<span class="sd">        astronomically possible sunshine duration.  The following example shows that</span>
<span class="sd">        method |Return_SunshineDuration_V1| prevents such inconsistencies by trimming</span>
<span class="sd">        the estimated sunshine duration when necessary:</span>

<span class="sd">        &gt;&gt;&gt; for globrad in (0.0, 34.0, 35.0, 136.0, 203.0, 204.0, 340.0):</span>
<span class="sd">        ...     sundur = model.return_sunshineduration_v1(globrad, 340.0, 1.0)</span>
<span class="sd">        ...     round_((globrad, sundur))</span>
<span class="sd">        0.0, 0.0</span>
<span class="sd">        34.0, 0.0</span>
<span class="sd">        35.0, 0.005882</span>
<span class="sd">        136.0, 0.6</span>
<span class="sd">        203.0, 0.994118</span>
<span class="sd">        204.0, 1.0</span>
<span class="sd">        340.0, 1.0</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">meteo_control</span><span class="o">.</span><span class="n">AngstromConstant</span><span class="p">,</span>
        <span class="n">meteo_control</span><span class="o">.</span><span class="n">AngstromFactor</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_derived</span><span class="o">.</span><span class="n">MOY</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span>
        <span class="n">globalradiation</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">extraterrestrialradiation</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">possiblesunshineduration</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">if</span> <span class="n">extraterrestrialradiation</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">possiblesunshineduration</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">moy</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">idx_sim</span><span class="p">]</span>
        <span class="n">d_sd</span> <span class="o">=</span> <span class="p">(</span><span class="n">possiblesunshineduration</span> <span class="o">/</span> <span class="n">con</span><span class="o">.</span><span class="n">angstromfactor</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span>
            <span class="n">globalradiation</span> <span class="o">/</span> <span class="n">extraterrestrialradiation</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">angstromconstant</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">d_sd</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="n">possiblesunshineduration</span><span class="p">)</span></div>



<div class="viewcode-block" id="Calc_UnadjustedSunshineDuration_V1">
<a class="viewcode-back" href="../../../../meteo.html#hydpy.models.meteo.meteo_model.Calc_UnadjustedSunshineDuration_V1">[docs]</a>
<span class="k">class</span> <span class="nc">Calc_UnadjustedSunshineDuration_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the unadjusted sunshine duration reversely to</span>
<span class="sd">    |Calc_UnadjustedGlobalRadiation_V1|.</span>

<span class="sd">    Additional requirements:</span>
<span class="sd">      |Model.idx_sim|</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`UnadjustedSunshineDuration = Return\_SunshineDuration</span>
<span class="sd">      \left( GlobalRadiation, NmbLogEntries \cdot \frac{PortionDailyRadiation}{100}</span>
<span class="sd">      \cdot ExtraterrestrialRadiation, PossibleSunshineDuration \right)`</span>

<span class="sd">    Example:</span>

<span class="sd">        Method |Calc_UnadjustedSunshineDuration_V1| relies on</span>
<span class="sd">        |Return_SunshineDuration_V1| and thus comes with the same limitation regarding</span>
<span class="sd">        periods with little sunshine.  See its documentation for further information.</span>
<span class="sd">        Here, we only demonstrate the proper passing of |meteo_inputs.GlobalRadiation|,</span>
<span class="sd">        |ExtraterrestrialRadiation| (eventually reduced by |PortionDailyRadiation|) and</span>
<span class="sd">        |PossibleSunshineDuration|:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-31&quot;, &quot;2000-02-02&quot;, &quot;6h&quot;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.meteo import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; derived.nmblogentries.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.moy.update()</span>
<span class="sd">        &gt;&gt;&gt; angstromconstant.jan = 0.1</span>
<span class="sd">        &gt;&gt;&gt; angstromfactor.jan = 0.5</span>
<span class="sd">        &gt;&gt;&gt; inputs.globalradiation = 272.0</span>
<span class="sd">        &gt;&gt;&gt; factors.possiblesunshineduration = 1.0</span>
<span class="sd">        &gt;&gt;&gt; factors.portiondailyradiation = 50.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.extraterrestrialradiation = 340.0</span>
<span class="sd">        &gt;&gt;&gt; model.idx_sim = 3</span>
<span class="sd">        &gt;&gt;&gt; model.calc_unadjustedsunshineduration_v1()</span>
<span class="sd">        &gt;&gt;&gt; factors.unadjustedsunshineduration</span>
<span class="sd">        unadjustedsunshineduration(0.6)</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Return_SunshineDuration_V1</span><span class="p">,)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">meteo_control</span><span class="o">.</span><span class="n">AngstromConstant</span><span class="p">,</span>
        <span class="n">meteo_control</span><span class="o">.</span><span class="n">AngstromFactor</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">meteo_derived</span><span class="o">.</span><span class="n">MOY</span><span class="p">,</span>
        <span class="n">meteo_derived</span><span class="o">.</span><span class="n">NmbLogEntries</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">meteo_inputs</span><span class="o">.</span><span class="n">GlobalRadiation</span><span class="p">,</span>
        <span class="n">meteo_factors</span><span class="o">.</span><span class="n">PossibleSunshineDuration</span><span class="p">,</span>
        <span class="n">meteo_factors</span><span class="o">.</span><span class="n">PortionDailyRadiation</span><span class="p">,</span>
        <span class="n">meteo_fluxes</span><span class="o">.</span><span class="n">ExtraterrestrialRadiation</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_factors</span><span class="o">.</span><span class="n">UnadjustedSunshineDuration</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span><span class="o">.</span><span class="n">unadjustedsunshineduration</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_sunshineduration_v1</span><span class="p">(</span>
            <span class="n">inp</span><span class="o">.</span><span class="n">globalradiation</span><span class="p">,</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">extraterrestrialradiation</span>
            <span class="o">*</span> <span class="n">der</span><span class="o">.</span><span class="n">nmblogentries</span>
            <span class="o">*</span> <span class="n">fac</span><span class="o">.</span><span class="n">portiondailyradiation</span>
            <span class="o">/</span> <span class="mf">100.0</span><span class="p">,</span>
            <span class="n">fac</span><span class="o">.</span><span class="n">possiblesunshineduration</span><span class="p">,</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="Calc_GlobalRadiation_V2">
<a class="viewcode-back" href="../../../../meteo.html#hydpy.models.meteo.meteo_model.Calc_GlobalRadiation_V2">[docs]</a>
<span class="k">class</span> <span class="nc">Calc_GlobalRadiation_V2</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Adjust the current global radiation to the daily global radiation according to</span>
<span class="sd">     :cite:t:`ref-LARSIM`.</span>

<span class="sd">    Additional requirements:</span>
<span class="sd">      |Model.idx_sim|</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`GlobalRadiation = UnadjustedGlobalRadiation \cdot</span>
<span class="sd">      \frac{DailyGlobalRadiation}{\sum LoggedUnadjustedGlobalRadiation / NmbLogEntries}`</span>

<span class="sd">    Examples:</span>

<span class="sd">        The purpose of method |Calc_GlobalRadiation_V2| is to adjust hourly global</span>
<span class="sd">        radiation values (or those of other short simulation time steps) so that their</span>
<span class="sd">        mean over the last 24 hours equals the global radiation value directly</span>
<span class="sd">        calculated with the relative sunshine duration over the last 24 hours.  We try</span>
<span class="sd">        to explain this somewhat counterintuitive approach by extending the</span>
<span class="sd">        documentation examples on method |Calc_DailyGlobalRadiation_V1|.</span>

<span class="sd">        Again, we start with a daily simulation time step:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.meteo import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; derived.nmblogentries.update()</span>

<span class="sd">        For such a daily simulation time step, the values of the sequences</span>
<span class="sd">        |UnadjustedGlobalRadiation|, |DailyGlobalRadiation|, and</span>
<span class="sd">        |LoggedUnadjustedGlobalRadiation| must be identical:</span>

<span class="sd">        &gt;&gt;&gt; model.idx_sim = 1</span>
<span class="sd">        &gt;&gt;&gt; fluxes.unadjustedglobalradiation = 200.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailyglobalradiation = 200.0</span>
<span class="sd">        &gt;&gt;&gt; logs.loggedunadjustedglobalradiation = 200.0</span>

<span class="sd">        After calling |Calc_GlobalRadiation_V2|, the same holds for the adjusted global</span>
<span class="sd">        radiation sum:</span>

<span class="sd">        &gt;&gt;&gt; model.calc_globalradiation_v2()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.globalradiation</span>
<span class="sd">        globalradiation(200.0)</span>

<span class="sd">        Intuitively, one would not expect method |Calc_GlobalRadiation_V2| to have any</span>
<span class="sd">        effect when applied on daily simulation time steps at all.  However, it</span>
<span class="sd">        corrects &quot;wrong&quot; predefined global radiation values:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.dailyglobalradiation = 280.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_globalradiation_v2()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.globalradiation</span>
<span class="sd">        globalradiation(280.0)</span>

<span class="sd">        We now demonstrate how method |Calc_GlobalRadiation_V2| works for hourly</span>
<span class="sd">        simulation time steps:</span>

<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; derived.nmblogentries.update()</span>

<span class="sd">        The daily global radiation value does not depend on the simulation timestep.</span>
<span class="sd">        We reset it to 200 W/m²:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.dailyglobalradiation = 200.0</span>

<span class="sd">        The other global radiation values must be smaller and vary throughout the day.</span>
<span class="sd">        We set them in agreement with the logged sunshine duration specified in the</span>
<span class="sd">        documentation on method |Calc_DailyGlobalRadiation_V1|:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.unadjustedglobalradiation = 960.0</span>
<span class="sd">        &gt;&gt;&gt; logs.loggedunadjustedglobalradiation = (</span>
<span class="sd">        ...     960.0, 960.0, 240.0, 120.0, 120.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,</span>
<span class="sd">        ...     0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 120.0, 480.0, 720.0, 840.0, 960.0)</span>

<span class="sd">        Compared with the total 24 hours, the simulation time steps around noon are</span>
<span class="sd">        relatively sunny, both for the current and the last day (see the first and the</span>
<span class="sd">        last entry of the log sequence for the sunshine duration).  Accordingly, the</span>
<span class="sd">        hourly global radiation values&#39; mean (230 W/m²) is larger than the directly</span>
<span class="sd">        calculated daily mean (200 W/m²).  Method |Calc_GlobalRadiation_V2| uses the</span>
<span class="sd">        fraction of both sums to calculate the adjusted global radiation</span>
<span class="sd">        (:math:`960 \cdot 200 / 230`):</span>

<span class="sd">        &gt;&gt;&gt; model.calc_globalradiation_v2()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.globalradiation</span>
<span class="sd">        globalradiation(834.782609)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_derived</span><span class="o">.</span><span class="n">NmbLogEntries</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">meteo_fluxes</span><span class="o">.</span><span class="n">UnadjustedGlobalRadiation</span><span class="p">,</span>
        <span class="n">meteo_fluxes</span><span class="o">.</span><span class="n">DailyGlobalRadiation</span><span class="p">,</span>
        <span class="n">meteo_logs</span><span class="o">.</span><span class="n">LoggedUnadjustedGlobalRadiation</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_fluxes</span><span class="o">.</span><span class="n">GlobalRadiation</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">logs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">d_glob_sum</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">nmblogentries</span><span class="p">):</span>
            <span class="n">d_glob_sum</span> <span class="o">+=</span> <span class="n">log</span><span class="o">.</span><span class="n">loggedunadjustedglobalradiation</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">d_glob_mean</span> <span class="o">=</span> <span class="n">d_glob_sum</span> <span class="o">/</span> <span class="n">der</span><span class="o">.</span><span class="n">nmblogentries</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">globalradiation</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">unadjustedglobalradiation</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">dailyglobalradiation</span> <span class="o">/</span> <span class="n">d_glob_mean</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="Calc_SunshineDuration_V1">
<a class="viewcode-back" href="../../../../meteo.html#hydpy.models.meteo.meteo_model.Calc_SunshineDuration_V1">[docs]</a>
<span class="k">class</span> <span class="nc">Calc_SunshineDuration_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the sunshine duration according to :cite:t:`ref-Allen1998`.</span>

<span class="sd">    Basic equation (:cite:t:`ref-Allen1998`, equation 35, rearranged):</span>
<span class="sd">      :math:`SunshineDuration =</span>
<span class="sd">      \left(\frac{GlobalRadiation}{ExtraterrestrialRadiation}-AngstromConstant \right)</span>
<span class="sd">      \cdot \frac{PossibleSunshineDuration}{AngstromFactor}`</span>

<span class="sd">    Example:</span>

<span class="sd">        Essentially, |Calc_SunshineDuration_V1| inverts |Calc_GlobalRadiation_V1| and</span>
<span class="sd">        thus also relies on the Ångström formula.  Instead of estimating global</span>
<span class="sd">        radiation from sunshine duration, it estimates global radiation from sunshine</span>
<span class="sd">        duration.  We demonstrate this by repeating the examples of</span>
<span class="sd">        |Calc_GlobalRadiation_V1| &quot;backwards&quot;:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub, round_</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-30&quot;, &quot;2000-02-03&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.meteo import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; angstromconstant.jan = 0.19</span>
<span class="sd">        &gt;&gt;&gt; angstromfactor.jan = 0.55</span>
<span class="sd">        &gt;&gt;&gt; angstromconstant.feb = 0.25</span>
<span class="sd">        &gt;&gt;&gt; angstromfactor.feb = 0.5</span>
<span class="sd">        &gt;&gt;&gt; derived.moy.update()</span>
<span class="sd">        &gt;&gt;&gt; factors.possiblesunshineduration = 14.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.extraterrestrialradiation = 200.0</span>
<span class="sd">        &gt;&gt;&gt; model.idx_sim = 1</span>
<span class="sd">        &gt;&gt;&gt; inputs.globalradiation = 132.285714</span>
<span class="sd">        &gt;&gt;&gt; model.calc_sunshineduration_v1()</span>
<span class="sd">        &gt;&gt;&gt; factors.sunshineduration</span>
<span class="sd">        sunshineduration(12.0)</span>
<span class="sd">        &gt;&gt;&gt; model.idx_sim = 2</span>
<span class="sd">        &gt;&gt;&gt; inputs.globalradiation = 135.714286</span>
<span class="sd">        &gt;&gt;&gt; model.calc_sunshineduration_v1()</span>
<span class="sd">        &gt;&gt;&gt; factors.sunshineduration</span>
<span class="sd">        sunshineduration(12.0)</span>

<span class="sd">        |Calc_SunshineDuration_V1| sets |meteo_factors.SunshineDuration| to zero for</span>
<span class="sd">        zero extraterrestrial radiation:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.extraterrestrialradiation = 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_sunshineduration_v1()</span>
<span class="sd">        &gt;&gt;&gt; factors.sunshineduration</span>
<span class="sd">        sunshineduration(0.0)</span>

<span class="sd">        Inconsistencies between global radiation measurements and the Ångström formula</span>
<span class="sd">        (and the selected coefficients) can result in unrealistic sunshine duration</span>
<span class="sd">        estimates.  Method |Calc_SunshineDuration_V1| reduces this problem by lowering</span>
<span class="sd">        too high values to the possible sunshine duration and increasing too low values</span>
<span class="sd">        to zero:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.extraterrestrialradiation = 200.0</span>
<span class="sd">        &gt;&gt;&gt; inputs.globalradiation = 210.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_sunshineduration_v1()</span>
<span class="sd">        &gt;&gt;&gt; factors.sunshineduration</span>
<span class="sd">        sunshineduration(14.0)</span>

<span class="sd">        &gt;&gt;&gt; inputs.globalradiation = 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_sunshineduration_v1()</span>
<span class="sd">        &gt;&gt;&gt; factors.sunshineduration</span>
<span class="sd">        sunshineduration(0.0)</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">meteo_control</span><span class="o">.</span><span class="n">AngstromConstant</span><span class="p">,</span>
        <span class="n">meteo_control</span><span class="o">.</span><span class="n">AngstromFactor</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_derived</span><span class="o">.</span><span class="n">MOY</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">meteo_inputs</span><span class="o">.</span><span class="n">GlobalRadiation</span><span class="p">,</span>
        <span class="n">meteo_factors</span><span class="o">.</span><span class="n">PossibleSunshineDuration</span><span class="p">,</span>
        <span class="n">meteo_fluxes</span><span class="o">.</span><span class="n">ExtraterrestrialRadiation</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_factors</span><span class="o">.</span><span class="n">SunshineDuration</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">if</span> <span class="n">flu</span><span class="o">.</span><span class="n">extraterrestrialradiation</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">moy</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">idx_sim</span><span class="p">]</span>
            <span class="n">d_sd</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">(</span><span class="n">inp</span><span class="o">.</span><span class="n">globalradiation</span> <span class="o">/</span> <span class="n">flu</span><span class="o">.</span><span class="n">extraterrestrialradiation</span><span class="p">)</span>
                <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">angstromconstant</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">fac</span><span class="o">.</span><span class="n">possiblesunshineduration</span> <span class="o">/</span> <span class="n">con</span><span class="o">.</span><span class="n">angstromfactor</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
            <span class="n">fac</span><span class="o">.</span><span class="n">sunshineduration</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">d_sd</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="n">fac</span><span class="o">.</span><span class="n">possiblesunshineduration</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fac</span><span class="o">.</span><span class="n">sunshineduration</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Update_LoggedUnadjustedSunshineDuration_V1">
<a class="viewcode-back" href="../../../../meteo.html#hydpy.models.meteo.meteo_model.Update_LoggedUnadjustedSunshineDuration_V1">[docs]</a>
<span class="k">class</span> <span class="nc">Update_LoggedUnadjustedSunshineDuration_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Log the unadjusted sunshine duration values of the last 24 hours.</span>

<span class="sd">    Example:</span>

<span class="sd">        The following example shows that each new method call successively moves the</span>
<span class="sd">        three memorised values to the right and stores the respective new value on the</span>
<span class="sd">        most left position:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.meteo import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;8h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; derived.nmblogentries.update()</span>
<span class="sd">        &gt;&gt;&gt; logs.loggedunadjustedsunshineduration = 0.0</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import UnitTest</span>
<span class="sd">        &gt;&gt;&gt; test = UnitTest(model,</span>
<span class="sd">        ...                 model.update_loggedunadjustedsunshineduration_v1,</span>
<span class="sd">        ...                 last_example=4,</span>
<span class="sd">        ...                 parseqs=(factors.unadjustedsunshineduration,</span>
<span class="sd">        ...                          logs.loggedunadjustedsunshineduration))</span>
<span class="sd">        &gt;&gt;&gt; test.nexts.unadjustedsunshineduration = 1.0, 3.0, 2.0, 4.0</span>
<span class="sd">        &gt;&gt;&gt; del test.inits.loggedunadjustedsunshineduration</span>
<span class="sd">        &gt;&gt;&gt; test()  # doctest: +ELLIPSIS</span>
<span class="sd">        | ex. | unadjustedsunshineduration | ... loggedunadjustedsunshineduration |</span>
<span class="sd">        -------------------------------------...-----------------------------------</span>
<span class="sd">        |   1 |                        1.0 | 1.0  0.0           ...           0.0 |</span>
<span class="sd">        |   2 |                        3.0 | 3.0  1.0           ...           0.0 |</span>
<span class="sd">        |   3 |                        2.0 | 2.0  3.0           ...           1.0 |</span>
<span class="sd">        |   4 |                        4.0 | 4.0  2.0           ...           3.0 |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_derived</span><span class="o">.</span><span class="n">NmbLogEntries</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_factors</span><span class="o">.</span><span class="n">UnadjustedSunshineDuration</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_logs</span><span class="o">.</span><span class="n">LoggedUnadjustedSunshineDuration</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">logs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">nmblogentries</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">loggedunadjustedsunshineduration</span><span class="p">[</span>
                <span class="n">idx</span>
            <span class="p">]</span> <span class="o">=</span> <span class="n">log</span><span class="o">.</span><span class="n">loggedunadjustedsunshineduration</span><span class="p">[</span><span class="n">idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">log</span><span class="o">.</span><span class="n">loggedunadjustedsunshineduration</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">fac</span><span class="o">.</span><span class="n">unadjustedsunshineduration</span></div>



<div class="viewcode-block" id="Calc_DailySunshineDuration_V2">
<a class="viewcode-back" href="../../../../meteo.html#hydpy.models.meteo.meteo_model.Calc_DailySunshineDuration_V2">[docs]</a>
<span class="k">class</span> <span class="nc">Calc_DailySunshineDuration_V2</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the daily sunshine duration reversely to</span>
<span class="sd">    |Calc_DailyGlobalRadiation_V1|.</span>

<span class="sd">    Additional requirements:</span>
<span class="sd">      |Model.idx_sim|</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`DailySunshineDuration = Return\_SunshineDuration \left(</span>
<span class="sd">      DailyGlobalRadiation, ExtraterrestrialRadiation, DailyPossibleSunshineDuration</span>
<span class="sd">      \right)`</span>

<span class="sd">    Example:</span>

<span class="sd">        Method |Calc_UnadjustedSunshineDuration_V1| relies on</span>
<span class="sd">        |Return_SunshineDuration_V1| and thus comes with the same limitation regarding</span>
<span class="sd">        periods with little sunshine.  See its documentation for further information.</span>
<span class="sd">        Here, we only demonstrate the proper passing of |DailyGlobalRadiation|,</span>
<span class="sd">        |ExtraterrestrialRadiation|, and |DailyPossibleSunshineDuration|:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-30&quot;, &quot;2000-02-03&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.meteo import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; derived.moy.update()</span>
<span class="sd">        &gt;&gt;&gt; angstromconstant.jan = 0.1</span>
<span class="sd">        &gt;&gt;&gt; angstromfactor.jan = 0.5</span>
<span class="sd">        &gt;&gt;&gt; factors.dailypossiblesunshineduration = 12.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dailyglobalradiation = 80.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.extraterrestrialradiation = 200.0</span>
<span class="sd">        &gt;&gt;&gt; model.idx_sim = 1</span>
<span class="sd">        &gt;&gt;&gt; model.calc_dailysunshineduration_v2()</span>
<span class="sd">        &gt;&gt;&gt; factors.dailysunshineduration</span>
<span class="sd">        dailysunshineduration(7.2)</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Return_SunshineDuration_V1</span><span class="p">,)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">meteo_control</span><span class="o">.</span><span class="n">AngstromConstant</span><span class="p">,</span>
        <span class="n">meteo_control</span><span class="o">.</span><span class="n">AngstromFactor</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_derived</span><span class="o">.</span><span class="n">MOY</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">meteo_factors</span><span class="o">.</span><span class="n">DailyPossibleSunshineDuration</span><span class="p">,</span>
        <span class="n">meteo_fluxes</span><span class="o">.</span><span class="n">DailyGlobalRadiation</span><span class="p">,</span>
        <span class="n">meteo_fluxes</span><span class="o">.</span><span class="n">ExtraterrestrialRadiation</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_factors</span><span class="o">.</span><span class="n">DailySunshineDuration</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span><span class="o">.</span><span class="n">dailysunshineduration</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">return_sunshineduration_v1</span><span class="p">(</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">dailyglobalradiation</span><span class="p">,</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">extraterrestrialradiation</span><span class="p">,</span>
            <span class="n">fac</span><span class="o">.</span><span class="n">dailypossiblesunshineduration</span><span class="p">,</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="Calc_SunshineDuration_V2">
<a class="viewcode-back" href="../../../../meteo.html#hydpy.models.meteo.meteo_model.Calc_SunshineDuration_V2">[docs]</a>
<span class="k">class</span> <span class="nc">Calc_SunshineDuration_V2</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Adjust the current sunshine duration to the daily sunshine duration like</span>
<span class="sd">    |Calc_GlobalRadiation_V2| adjusts the current global radiation to the daily global</span>
<span class="sd">    radiation.</span>

<span class="sd">    Additional requirements:</span>
<span class="sd">      |Model.idx_sim|</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`SunshineDuration = UnadjustedSunshineDuration \cdot</span>
<span class="sd">      \frac{DailySunshineDuration}{\sum LoggedUnadjustedSunshineDuration}`</span>

<span class="sd">    Examples:</span>

<span class="sd">        |Calc_SunshineDuration_V2| implements a standardisation approach following the</span>
<span class="sd">        reasons and strategy explained in the documentation on method</span>
<span class="sd">        |Calc_GlobalRadiation_V2|.  Hence, we first adopt its examples without repeated</span>
<span class="sd">        explanations:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.meteo import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; derived.nmblogentries.update()</span>
<span class="sd">        &gt;&gt;&gt; model.idx_sim = 1</span>
<span class="sd">        &gt;&gt;&gt; factors.unadjustedsunshineduration = 4.0</span>
<span class="sd">        &gt;&gt;&gt; factors.dailysunshineduration = 4.0</span>
<span class="sd">        &gt;&gt;&gt; logs.loggedunadjustedsunshineduration = 4.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_sunshineduration_v2()</span>
<span class="sd">        &gt;&gt;&gt; factors.sunshineduration</span>
<span class="sd">        sunshineduration(4.0)</span>
<span class="sd">        &gt;&gt;&gt; factors.dailysunshineduration = 5.6</span>
<span class="sd">        &gt;&gt;&gt; model.calc_sunshineduration_v2()</span>
<span class="sd">        &gt;&gt;&gt; factors.sunshineduration</span>
<span class="sd">        sunshineduration(5.6)</span>

<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; derived.nmblogentries.update()</span>
<span class="sd">        &gt;&gt;&gt; factors.dailysunshineduration = 4.0</span>
<span class="sd">        &gt;&gt;&gt; factors.unadjustedsunshineduration = 0.8</span>
<span class="sd">        &gt;&gt;&gt; logs.loggedunadjustedsunshineduration = (</span>
<span class="sd">        ...     0.8, 0.8, 0.2, 0.1, 0.1, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,</span>
<span class="sd">        ...     0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.1, 0.4, 0.6, 0.7, 0.8)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_sunshineduration_v2()</span>
<span class="sd">        &gt;&gt;&gt; factors.sunshineduration</span>
<span class="sd">        sunshineduration(0.695652)</span>

<span class="sd">        The global radiation of a day cannot be zero due to diffusive radiations, but</span>
<span class="sd">        the sunshine duration can.  Hence, |Calc_SunshineDuration_V2| requires a</span>
<span class="sd">        safeguard against zero-divisions not relevant for |Calc_GlobalRadiation_V2|.</span>
<span class="sd">        We decided to generally set the adjusted sunshine duration to zero if the</span>
<span class="sd">        directly calculated daily sunshine duration or the current unadjusted sunshine</span>
<span class="sd">        duration is zero. (Note the sum of the logged unadjusted sunshine duration can</span>
<span class="sd">        only be zero if the present unadjusted sunshine duration is zero):</span>

<span class="sd">        &gt;&gt;&gt; factors.unadjustedsunshineduration = 0.0</span>
<span class="sd">        &gt;&gt;&gt; logs.loggedunadjustedsunshineduration = 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_sunshineduration_v2()</span>
<span class="sd">        &gt;&gt;&gt; factors.sunshineduration</span>
<span class="sd">        sunshineduration(0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_derived</span><span class="o">.</span><span class="n">NmbLogEntries</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">meteo_factors</span><span class="o">.</span><span class="n">UnadjustedSunshineDuration</span><span class="p">,</span>
        <span class="n">meteo_factors</span><span class="o">.</span><span class="n">DailySunshineDuration</span><span class="p">,</span>
        <span class="n">meteo_factors</span><span class="o">.</span><span class="n">PossibleSunshineDuration</span><span class="p">,</span>
        <span class="n">meteo_logs</span><span class="o">.</span><span class="n">LoggedUnadjustedSunshineDuration</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">meteo_factors</span><span class="o">.</span><span class="n">SunshineDuration</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">logs</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">d_nom</span> <span class="o">=</span> <span class="n">fac</span><span class="o">.</span><span class="n">unadjustedsunshineduration</span> <span class="o">*</span> <span class="n">fac</span><span class="o">.</span><span class="n">dailysunshineduration</span>
        <span class="k">if</span> <span class="n">d_nom</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">fac</span><span class="o">.</span><span class="n">sunshineduration</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d_denom</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">nmblogentries</span><span class="p">):</span>
                <span class="n">d_denom</span> <span class="o">+=</span> <span class="n">log</span><span class="o">.</span><span class="n">loggedunadjustedsunshineduration</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="n">fac</span><span class="o">.</span><span class="n">sunshineduration</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">d_nom</span> <span class="o">/</span> <span class="n">d_denom</span><span class="p">,</span> <span class="n">fac</span><span class="o">.</span><span class="n">possiblesunshineduration</span><span class="p">)</span></div>



<div class="viewcode-block" id="Model">
<a class="viewcode-back" href="../../../../meteo.html#hydpy.models.meteo.meteo_model.Model">[docs]</a>
<span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">AdHocModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The Meteo base model.&quot;&quot;&quot;</span>

    <span class="n">INLET_METHODS</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">RECEIVER_METHODS</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">RUN_METHODS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Calc_EarthSunDistance_V1</span><span class="p">,</span>
        <span class="n">Calc_SolarDeclination_V1</span><span class="p">,</span>
        <span class="n">Calc_SolarDeclination_V2</span><span class="p">,</span>
        <span class="n">Calc_SunsetHourAngle_V1</span><span class="p">,</span>
        <span class="n">Calc_SolarTimeAngle_V1</span><span class="p">,</span>
        <span class="n">Calc_TimeOfSunrise_TimeOfSunset_V1</span><span class="p">,</span>
        <span class="n">Calc_DailyPossibleSunshineDuration_V1</span><span class="p">,</span>
        <span class="n">Calc_PossibleSunshineDuration_V1</span><span class="p">,</span>
        <span class="n">Calc_PossibleSunshineDuration_V2</span><span class="p">,</span>
        <span class="n">Update_LoggedSunshineDuration_V1</span><span class="p">,</span>
        <span class="n">Calc_DailySunshineDuration_V1</span><span class="p">,</span>
        <span class="n">Update_LoggedGlobalRadiation_V1</span><span class="p">,</span>
        <span class="n">Calc_DailyGlobalRadiation_V2</span><span class="p">,</span>
        <span class="n">Calc_ExtraterrestrialRadiation_V1</span><span class="p">,</span>
        <span class="n">Calc_ExtraterrestrialRadiation_V2</span><span class="p">,</span>
        <span class="n">Calc_DailySunshineDuration_V2</span><span class="p">,</span>
        <span class="n">Calc_SunshineDuration_V1</span><span class="p">,</span>
        <span class="n">Calc_PortionDailyRadiation_V1</span><span class="p">,</span>
        <span class="n">Calc_ClearSkySolarRadiation_V1</span><span class="p">,</span>
        <span class="n">Calc_GlobalRadiation_V1</span><span class="p">,</span>
        <span class="n">Calc_UnadjustedGlobalRadiation_V1</span><span class="p">,</span>
        <span class="n">Calc_UnadjustedSunshineDuration_V1</span><span class="p">,</span>
        <span class="n">Update_LoggedUnadjustedGlobalRadiation_V1</span><span class="p">,</span>
        <span class="n">Update_LoggedUnadjustedSunshineDuration_V1</span><span class="p">,</span>
        <span class="n">Calc_DailyGlobalRadiation_V1</span><span class="p">,</span>
        <span class="n">Calc_GlobalRadiation_V2</span><span class="p">,</span>
        <span class="n">Calc_SunshineDuration_V2</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ADD_METHODS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Return_DailyGlobalRadiation_V1</span><span class="p">,</span>
        <span class="n">Return_SunshineDuration_V1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">OUTLET_METHODS</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">SENDER_METHODS</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">SUBMODELS</span> <span class="o">=</span> <span class="p">()</span></div>

</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">HydPy 5.0.3 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">hydpy.models.meteo.meteo_model</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2023, HydPy Developers.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    </div>
  </body>
</html>