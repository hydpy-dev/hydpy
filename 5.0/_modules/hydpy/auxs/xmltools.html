<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>hydpy.auxs.xmltools &#8212; HydPy 5.0.3 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../../_static/classic.css?v=127cebf3" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=eafc0fe6" />
    
    <script src="../../../_static/documentation_options.js?v=f98c4cc8"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">HydPy 5.0.3 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">hydpy.auxs.xmltools</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/HydPy_Logo.png" alt="Logo"/>
            </a></p>
  <div>
    <h3><a href="../../../index.html">Table of Contents</a></h3>
    <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installation Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../how_to.html">How toâ€¦</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../framework.html">Framework Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modelcollection.html">Model Collection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../development.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples.html">Example Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../zbibliography.html">Bibliography</a></li>
</ul>

  </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for hydpy.auxs.xmltools</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;This module provides features for executing *HydPy* workflows based on XML</span>
<span class="sd">configuration files.</span>

<span class="sd">.. _HydPy release: https://github.com/hydpy-dev/hydpy/releases</span>
<span class="sd">.. _`OpenDA`: https://www.openda.org/</span>

<span class="sd">At the heart of module |xmltools| lies function |run_simulation|, thought to be applied</span>
<span class="sd">via a command line (see the documentation on script |hyd| for further information).</span>
<span class="sd">|run_simulation| expects that the *HydPy* project you want to work with is available in</span>
<span class="sd">your current working directory and contains an XML configuration file (as</span>
<span class="sd">`single_run.xml` in the example project folder `LahnH`).  This configuration file must</span>
<span class="sd">agree with the XML schema `HydPyConfigSingleRun.xsd`, which is available in the</span>
<span class="sd">:ref:`configuration` subpackage and separately downloadable for each `HydPy release`_.</span>
<span class="sd">If you did implement new or changed existing models, you have to update this schema</span>
<span class="sd">file.  *HydPy* does this automatically through its setup mechanism (see the</span>
<span class="sd">documentation on class |XSDWriter|).</span>

<span class="sd">To show how to apply |run_simulation| via a command line, we first copy the `LahnH`</span>
<span class="sd">project into the `iotesting` folder by calling the function |prepare_full_example_1|:</span>

<span class="sd">&gt;&gt;&gt; from hydpy.examples import prepare_full_example_1</span>
<span class="sd">&gt;&gt;&gt; prepare_full_example_1()</span>

<span class="sd">Running the simulation requires defining the main script (`hyd.py`), the function</span>
<span class="sd">specifying the actual workflow (`run_simulation`), the name of the project of interest</span>
<span class="sd">(`LahnH`), and the name of the relevant XML configuration file (`single_run.xml`).  We</span>
<span class="sd">pass the required text to function |run_subprocess| of module subprocess to simulate</span>
<span class="sd">using the command line:</span>

<span class="sd">&gt;&gt;&gt; from hydpy import run_subprocess, TestIO</span>
<span class="sd">&gt;&gt;&gt; import subprocess</span>
<span class="sd">&gt;&gt;&gt; with TestIO():  # doctest: +ELLIPSIS</span>
<span class="sd">...     result = run_subprocess(&quot;hyd.py run_simulation LahnH single_run.xml&quot;)</span>
<span class="sd">Start HydPy project `LahnH` (...).</span>
<span class="sd">Read configuration file `single_run.xml` (...).</span>
<span class="sd">Interpret the defined options (...).</span>
<span class="sd">Interpret the defined period (...).</span>
<span class="sd">Read all network files (...).</span>
<span class="sd">Activate the selected network (...).</span>
<span class="sd">Read the required control files (...).</span>
<span class="sd">Read the required condition files (...).</span>
<span class="sd">Read the required time series files (...).</span>
<span class="sd">Perform the simulation run (...).</span>
<span class="sd">Write the desired condition files (...).</span>
<span class="sd">Write the desired time series files (...).</span>

<span class="sd">As defined by the XML configuration file, the simulation started on the first and</span>
<span class="sd">ended on the sixth of January 1996.  The following example shows the read initial</span>
<span class="sd">conditions and the written final conditions of sequence |hland_states.SM| for the</span>
<span class="sd">12 hydrological response units of the subcatchment `land_dill`:</span>

<span class="sd">&gt;&gt;&gt; with TestIO():</span>
<span class="sd">...     filepath = &quot;LahnH/conditions/init_1996_01_01_00_00_00/land_dill.py&quot;</span>
<span class="sd">...     with open(filepath) as file_:</span>
<span class="sd">...         print(&quot;&quot;.join(file_.readlines()[10:12]))</span>
<span class="sd">...     filepath = &quot;LahnH/conditions/init_1996_01_06/land_dill.py&quot;</span>
<span class="sd">...     with open(filepath) as file_:</span>
<span class="sd">...         print(&quot;&quot;.join(file_.readlines()[9:12]))</span>
<span class="sd">sm(185.13164, 181.18755, 199.80432, 196.55888, 212.04018, 209.48859,</span>
<span class="sd">   222.12115, 220.12671, 230.30756, 228.70779, 236.91943, 235.64427)</span>
<span class="sd">&lt;BLANKLINE&gt;</span>
<span class="sd">sm(183.873078, 179.955801, 198.446011, 195.222634, 210.598689,</span>
<span class="sd">   208.064445, 220.611126, 218.630245, 228.741883, 227.152989,</span>
<span class="sd">   235.308805, 234.042313)</span>
<span class="sd">&lt;BLANKLINE&gt;</span>

<span class="sd">The intermediate soil moisture values have been stored in a NetCDF file called</span>
<span class="sd">`hland_v1_state_sm.nc`:</span>

<span class="sd">&gt;&gt;&gt; import numpy</span>
<span class="sd">&gt;&gt;&gt; from hydpy import print_values</span>
<span class="sd">&gt;&gt;&gt; from hydpy.core.netcdftools import netcdf4, chars2str, query_variable</span>
<span class="sd">&gt;&gt;&gt; with TestIO():</span>
<span class="sd">...     ncfile = netcdf4.Dataset(&quot;LahnH/series/soildata/hland_v1_state_sm.nc&quot;)</span>
<span class="sd">...     chars2str(query_variable(ncfile, &quot;station_id&quot;)[:].data)[:3]</span>
<span class="sd">...     print_values(query_variable(ncfile, &quot;state_sm&quot;)[:, 0])</span>
<span class="sd">[&#39;land_dill_0&#39;, &#39;land_dill_1&#39;, &#39;land_dill_2&#39;]</span>
<span class="sd">184.926173, 184.603966, 184.386666, 184.098541, 183.873078</span>
<span class="sd">&gt;&gt;&gt; ncfile.close()</span>

<span class="sd">Spatially averaged time series values have been stored in files ending with the suffix</span>
<span class="sd">`_mean`:</span>

<span class="sd">&gt;&gt;&gt; import time</span>
<span class="sd">&gt;&gt;&gt; time.sleep(10)</span>

<span class="sd">&gt;&gt;&gt; with TestIO(clear_all=True):</span>
<span class="sd">...     print_values((numpy.load(&quot;LahnH/series/averages/lahn_1_sim_q_mean.npy&quot;)[13:]))</span>
<span class="sd">9.647824, 8.517795, 7.781311, 7.344944, 7.153142</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1"># import...</span>
<span class="c1"># ...from standard library</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">import</span> <span class="nn">contextlib</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">xml.etree</span> <span class="kn">import</span> <span class="n">ElementTree</span>

<span class="c1"># ...from HydPy</span>
<span class="kn">import</span> <span class="nn">hydpy</span>
<span class="kn">from</span> <span class="nn">hydpy</span> <span class="kn">import</span> <span class="n">conf</span>
<span class="kn">from</span> <span class="nn">hydpy</span> <span class="kn">import</span> <span class="n">config</span>
<span class="kn">from</span> <span class="nn">hydpy</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="kn">import</span> <span class="n">devicetools</span>
<span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="kn">import</span> <span class="n">exceptiontools</span>
<span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="kn">import</span> <span class="n">hydpytools</span>
<span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="kn">import</span> <span class="n">importtools</span>
<span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="kn">import</span> <span class="n">itemtools</span>
<span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="kn">import</span> <span class="n">objecttools</span>
<span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="kn">import</span> <span class="n">selectiontools</span>
<span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="kn">import</span> <span class="n">parametertools</span>
<span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="kn">import</span> <span class="n">sequencetools</span>
<span class="kn">from</span> <span class="nn">hydpy.exe</span> <span class="kn">import</span> <span class="n">commandtools</span>
<span class="kn">from</span> <span class="nn">hydpy.core.typingtools</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">netCDF4</span> <span class="k">as</span> <span class="nn">netcdf4</span>
    <span class="kn">import</span> <span class="nn">xmlschema</span>
    <span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="kn">import</span> <span class="n">modeltools</span>
    <span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="kn">import</span> <span class="n">variabletools</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">netcdf4</span> <span class="o">=</span> <span class="n">exceptiontools</span><span class="o">.</span><span class="n">OptionalImport</span><span class="p">(</span>
        <span class="s2">&quot;netcdf4&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;netCDF4&quot;</span><span class="p">,</span> <span class="s2">&quot;h5netcdf.legacyapi&quot;</span><span class="p">],</span> <span class="nb">locals</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="n">xmlschema</span> <span class="o">=</span> <span class="n">exceptiontools</span><span class="o">.</span><span class="n">OptionalImport</span><span class="p">(</span><span class="s2">&quot;xmlschema&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;xmlschema&quot;</span><span class="p">],</span> <span class="nb">locals</span><span class="p">())</span>

<span class="n">_TypeSetOrAddOrMultiplyItem</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span>
    <span class="s2">&quot;_TypeSetOrAddOrMultiplyItem&quot;</span><span class="p">,</span>
    <span class="n">itemtools</span><span class="o">.</span><span class="n">SetItem</span><span class="p">,</span>
    <span class="n">itemtools</span><span class="o">.</span><span class="n">AddItem</span><span class="p">,</span>
    <span class="n">itemtools</span><span class="o">.</span><span class="n">MultiplyItem</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">_TypeGetOrChangeItem</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span>
    <span class="s2">&quot;_TypeGetOrChangeItem&quot;</span><span class="p">,</span>
    <span class="n">itemtools</span><span class="o">.</span><span class="n">GetItem</span><span class="p">,</span>
    <span class="n">itemtools</span><span class="o">.</span><span class="n">ChangeItem</span><span class="p">,</span>
    <span class="n">itemtools</span><span class="o">.</span><span class="n">SetItem</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">namespace</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;{https://github.com/hydpy-dev/hydpy/releases/download/your-hydpy-version/&quot;</span>
    <span class="s2">&quot;HydPyConfigBase.xsd}&quot;</span>
<span class="p">)</span>
<span class="n">_ITEMGROUP2ITEMCLASS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;setitems&quot;</span><span class="p">:</span> <span class="n">itemtools</span><span class="o">.</span><span class="n">SetItem</span><span class="p">,</span>
    <span class="s2">&quot;additems&quot;</span><span class="p">:</span> <span class="n">itemtools</span><span class="o">.</span><span class="n">AddItem</span><span class="p">,</span>
    <span class="s2">&quot;multiplyitems&quot;</span><span class="p">:</span> <span class="n">itemtools</span><span class="o">.</span><span class="n">MultiplyItem</span><span class="p">,</span>
    <span class="s2">&quot;getitems&quot;</span><span class="p">:</span> <span class="n">itemtools</span><span class="o">.</span><span class="n">GetItem</span><span class="p">,</span>
<span class="p">}</span>


<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">find</span><span class="p">(</span>
    <span class="n">root</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">optional</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Optional version of function |find|.&quot;&quot;&quot;</span>


<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">find</span><span class="p">(</span>
    <span class="n">root</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">optional</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="kc">False</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Non-optional version of function |find|.&quot;&quot;&quot;</span>


<div class="viewcode-block" id="find">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.find">[docs]</a>
<span class="k">def</span> <span class="nf">find</span><span class="p">(</span>
    <span class="n">root</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">optional</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the first XML element with the given name found in the given XML root.</span>

<span class="sd">    &gt;&gt;&gt; from hydpy.auxs.xmltools import find, XMLInterface</span>
<span class="sd">    &gt;&gt;&gt; from hydpy.data import make_filepath</span>
<span class="sd">    &gt;&gt;&gt; interface = XMLInterface(&quot;single_run.xml&quot;, make_filepath(&quot;LahnH&quot;))</span>
<span class="sd">    &gt;&gt;&gt; find(interface.root, &quot;timegrid&quot;).tag.endswith(&quot;timegrid&quot;)</span>
<span class="sd">    True</span>

<span class="sd">    By default, function |find| returns |None| in case the required element is missing:</span>

<span class="sd">    &gt;&gt;&gt; find(interface.root, &quot;wrong&quot;)</span>

<span class="sd">    Set the argument `optional` to |False| to let function |find| raise errors instead:</span>

<span class="sd">    &gt;&gt;&gt; find(interface.root, &quot;wrong&quot;, optional=False)</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    AttributeError: The actual XML element `config` does not define a XML subelement \</span>
<span class="sd">named `wrong`.  Please make sure your XML file follows the relevant XML schema.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">element</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">namespace</span><span class="si">}{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">element</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">optional</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;The actual XML element `</span><span class="si">{</span><span class="n">root</span><span class="o">.</span><span class="n">tag</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;}&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">` does not define a &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;XML subelement named `</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">`.  Please make sure your XML file follows &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;the relevant XML schema.&quot;</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">element</span></div>



<span class="k">def</span> <span class="nf">_query_selections</span><span class="p">(</span><span class="n">xmlelement</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">selectiontools</span><span class="o">.</span><span class="n">Selections</span><span class="p">:</span>
    <span class="n">selections</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">xmlelement</span><span class="o">.</span><span class="n">text</span>
    <span class="k">assert</span> <span class="n">text</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">selections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">selections</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The XML configuration file tries to define a selection using the &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;text `</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">`, but the actual project does not handle such a &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;`Selection` object.&quot;</span>
            <span class="p">)</span> <span class="kn">from</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">selectiontools</span><span class="o">.</span><span class="n">Selections</span><span class="p">(</span><span class="o">*</span><span class="n">selections</span><span class="p">)</span>


<div class="viewcode-block" id="strip">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.strip">[docs]</a>
<span class="k">def</span> <span class="nf">strip</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove the XML namespace from the given string and return it.</span>

<span class="sd">    &gt;&gt;&gt; from hydpy.auxs.xmltools import strip</span>
<span class="sd">    &gt;&gt;&gt; strip(&quot;{https://github.com/something.xsd}something&quot;)</span>
<span class="sd">    &#39;something&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;}&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></div>



<div class="viewcode-block" id="PrepareSeriesArguments">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.PrepareSeriesArguments">[docs]</a>
<span class="k">class</span> <span class="nc">PrepareSeriesArguments</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper class that determines and provides the arguments for function</span>
<span class="sd">    |IOSequence.prepare_series|.&quot;&quot;&quot;</span>

    <span class="n">allocate_ram</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">read_jit</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">write_jit</span><span class="p">:</span> <span class="nb">bool</span>

<div class="viewcode-block" id="PrepareSeriesArguments.from_xmldata">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.PrepareSeriesArguments.from_xmldata">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_xmldata</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">is_reader</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">is_input</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">prefer_ram</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PrepareSeriesArguments</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a |PrepareSeriesArguments| object based on the (already prepared)</span>
<span class="sd">        information of an XML file.</span>

<span class="sd">        Meaning of the arguments:</span>
<span class="sd">         * is_reader: is the current XML-Element responsible for reading (or writing)?</span>
<span class="sd">         * is_input: serve the addressed sequences as inputs (or outputs)?</span>
<span class="sd">         * prefer_ram: prefer to handle time-series data in RAM (or read and write it</span>
<span class="sd">           just in time)?</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import PrepareSeriesArguments</span>
<span class="sd">        &gt;&gt;&gt; from_xmldata = PrepareSeriesArguments.from_xmldata</span>

<span class="sd">        Test cases for reading input data:</span>

<span class="sd">        &gt;&gt;&gt; from_xmldata(is_reader=True, is_input=True, prefer_ram=True)</span>
<span class="sd">        PrepareSeriesArguments(allocate_ram=True, read_jit=False, write_jit=False)</span>

<span class="sd">        &gt;&gt;&gt; from_xmldata(is_reader=True, is_input=True, prefer_ram=False)</span>
<span class="sd">        PrepareSeriesArguments(allocate_ram=False, read_jit=True, write_jit=False)</span>

<span class="sd">        Attempting to read output data results in an |AssertionError| (disallowed by</span>
<span class="sd">        all available XML schema files):</span>

<span class="sd">        &gt;&gt;&gt; from_xmldata(is_reader=True, is_input=False, prefer_ram=True)</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        AssertionError: reading output values is disallowed</span>

<span class="sd">        &gt;&gt;&gt; from_xmldata(is_reader=True, is_input=False, prefer_ram=False)</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        AssertionError: reading output values is disallowed</span>

<span class="sd">        Test cases for writing input data (this is for the rare case where an</span>
<span class="sd">        external tool like `OpenDA`_ provides or modifies the input data in RAM, and we</span>
<span class="sd">        want to write it to a file for documentation purposes):</span>

<span class="sd">        &gt;&gt;&gt; from_xmldata(is_reader=False, is_input=True, prefer_ram=True)</span>
<span class="sd">        PrepareSeriesArguments(allocate_ram=True, read_jit=False, write_jit=False)</span>

<span class="sd">        &gt;&gt;&gt; from_xmldata(is_reader=False, is_input=True, prefer_ram=False)</span>
<span class="sd">        PrepareSeriesArguments(allocate_ram=True, read_jit=False, write_jit=True)</span>

<span class="sd">        Test cases for writing output data:</span>

<span class="sd">        &gt;&gt;&gt; from_xmldata(is_reader=False, is_input=False, prefer_ram=True)</span>
<span class="sd">        PrepareSeriesArguments(allocate_ram=True, read_jit=False, write_jit=False)</span>

<span class="sd">        &gt;&gt;&gt; from_xmldata(is_reader=False, is_input=False, prefer_ram=False)</span>
<span class="sd">        PrepareSeriesArguments(allocate_ram=False, read_jit=False, write_jit=True)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">is_writer</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">is_reader</span>
        <span class="n">is_output</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">is_input</span>
        <span class="n">prefer_jit</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">prefer_ram</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="p">(</span><span class="n">is_reader</span> <span class="ow">and</span> <span class="n">is_output</span><span class="p">),</span> <span class="s2">&quot;reading output values is disallowed&quot;</span>
        <span class="k">return</span> <span class="n">PrepareSeriesArguments</span><span class="p">(</span>
            <span class="n">allocate_ram</span><span class="o">=</span><span class="n">prefer_ram</span> <span class="ow">or</span> <span class="p">(</span><span class="n">is_input</span> <span class="ow">and</span> <span class="n">is_writer</span><span class="p">),</span>
            <span class="n">read_jit</span><span class="o">=</span><span class="n">is_reader</span> <span class="ow">and</span> <span class="n">prefer_jit</span><span class="p">,</span>
            <span class="n">write_jit</span><span class="o">=</span><span class="n">is_writer</span> <span class="ow">and</span> <span class="n">prefer_jit</span><span class="p">,</span>
        <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="run_simulation">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.run_simulation">[docs]</a>
<span class="k">def</span> <span class="nf">run_simulation</span><span class="p">(</span><span class="n">projectname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">xmlfile</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Perform a *HydPy* workflow according to the given XML configuration file</span>
<span class="sd">    available in the given project&#39;s directory.</span>

<span class="sd">    Function |run_simulation| is a &quot;script function&quot;.  We explain its normal usage</span>
<span class="sd">    in the main documentation on module |xmltools|.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">write</span> <span class="o">=</span> <span class="n">commandtools</span><span class="o">.</span><span class="n">print_textandtime</span>
    <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">printprogress</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Start HydPy project `</span><span class="si">{</span><span class="n">projectname</span><span class="si">}</span><span class="s2">`&quot;</span><span class="p">)</span>
    <span class="n">hp</span> <span class="o">=</span> <span class="n">hydpytools</span><span class="o">.</span><span class="n">HydPy</span><span class="p">(</span><span class="n">projectname</span><span class="p">)</span>
    <span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Read configuration file `</span><span class="si">{</span><span class="n">xmlfile</span><span class="si">}</span><span class="s2">`&quot;</span><span class="p">)</span>
    <span class="n">interface</span> <span class="o">=</span> <span class="n">XMLInterface</span><span class="p">(</span><span class="n">xmlfile</span><span class="p">)</span>
    <span class="n">write</span><span class="p">(</span><span class="s2">&quot;Interpret the defined options&quot;</span><span class="p">)</span>
    <span class="n">interface</span><span class="o">.</span><span class="n">update_options</span><span class="p">()</span>
    <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">printprogress</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">write</span><span class="p">(</span><span class="s2">&quot;Interpret the defined period&quot;</span><span class="p">)</span>
    <span class="n">interface</span><span class="o">.</span><span class="n">update_timegrids</span><span class="p">()</span>
    <span class="n">write</span><span class="p">(</span><span class="s2">&quot;Read all network files&quot;</span><span class="p">)</span>
    <span class="n">interface</span><span class="o">.</span><span class="n">network_io</span><span class="o">.</span><span class="n">prepare_network</span><span class="p">()</span>
    <span class="n">write</span><span class="p">(</span><span class="s2">&quot;Create the custom selections (if defined)&quot;</span><span class="p">)</span>
    <span class="n">interface</span><span class="o">.</span><span class="n">update_selections</span><span class="p">()</span>
    <span class="n">write</span><span class="p">(</span><span class="s2">&quot;Activate the selected network&quot;</span><span class="p">)</span>
    <span class="n">hp</span><span class="o">.</span><span class="n">update_devices</span><span class="p">(</span><span class="n">selection</span><span class="o">=</span><span class="n">interface</span><span class="o">.</span><span class="n">fullselection</span><span class="p">)</span>
    <span class="n">write</span><span class="p">(</span><span class="s2">&quot;Read the required control files&quot;</span><span class="p">)</span>
    <span class="n">interface</span><span class="o">.</span><span class="n">control_io</span><span class="o">.</span><span class="n">prepare_models</span><span class="p">()</span>
    <span class="n">write</span><span class="p">(</span><span class="s2">&quot;Read the required condition files&quot;</span><span class="p">)</span>
    <span class="n">interface</span><span class="o">.</span><span class="n">conditions_io</span><span class="o">.</span><span class="n">load_conditions</span><span class="p">()</span>
    <span class="n">write</span><span class="p">(</span><span class="s2">&quot;Read the required time series files&quot;</span><span class="p">)</span>
    <span class="n">series_io</span> <span class="o">=</span> <span class="n">interface</span><span class="o">.</span><span class="n">series_io</span>
    <span class="n">series_io</span><span class="o">.</span><span class="n">prepare_series</span><span class="p">()</span>
    <span class="n">series_io</span><span class="o">.</span><span class="n">load_series</span><span class="p">()</span>
    <span class="n">write</span><span class="p">(</span><span class="s2">&quot;Perform the simulation run&quot;</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">series_io</span><span class="o">.</span><span class="n">modify_inputdir</span><span class="p">(),</span> <span class="n">series_io</span><span class="o">.</span><span class="n">modify_outputdir</span><span class="p">():</span>
        <span class="n">hp</span><span class="o">.</span><span class="n">simulate</span><span class="p">()</span>
    <span class="n">write</span><span class="p">(</span><span class="s2">&quot;Write the desired condition files&quot;</span><span class="p">)</span>
    <span class="n">interface</span><span class="o">.</span><span class="n">conditions_io</span><span class="o">.</span><span class="n">save_conditions</span><span class="p">()</span>
    <span class="n">write</span><span class="p">(</span><span class="s2">&quot;Write the desired time series files&quot;</span><span class="p">)</span>
    <span class="n">series_io</span><span class="o">.</span><span class="n">save_series</span><span class="p">()</span></div>



<div class="viewcode-block" id="XMLBase">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLBase">[docs]</a>
<span class="k">class</span> <span class="nc">XMLBase</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for the concrete classes |XMLInterface|, |XMLConditions|,</span>
<span class="sd">    |XMLSeries|, and |XMLSubseries|.</span>

<span class="sd">    Subclasses of |XMLBase| support iterating XML subelements while skipping those</span>
<span class="sd">    named `selections`:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy.auxs.xmltools import XMLInterface</span>
<span class="sd">    &gt;&gt;&gt; from hydpy.data import make_filepath</span>
<span class="sd">    &gt;&gt;&gt; interface = XMLInterface(&quot;multiple_runs.xml&quot;, make_filepath(&quot;LahnH&quot;))</span>
<span class="sd">    &gt;&gt;&gt; itemgroup = interface.exchange.itemgroups[1]</span>
<span class="sd">    &gt;&gt;&gt; for element in itemgroup:</span>
<span class="sd">    ...     print(strip(element.tag))</span>
<span class="sd">    hland_v1</span>
<span class="sd">    &gt;&gt;&gt; for element in itemgroup.models[0].subvars[0].vars[0]:</span>
<span class="sd">    ...     print(strip(element.tag))</span>
<span class="sd">    name</span>
<span class="sd">    level</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">root</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply function |strip| to the root of the object of the |XMLBase| subclass.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XMLInterface</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.data import make_filepath</span>
<span class="sd">        &gt;&gt;&gt; interface = XMLInterface(&quot;single_run.xml&quot;, make_filepath(&quot;LahnH&quot;))</span>
<span class="sd">        &gt;&gt;&gt; interface.name</span>
<span class="sd">        &#39;config&#39;</span>
<span class="sd">        &gt;&gt;&gt; interface.series_io.readers[0].name</span>
<span class="sd">        &#39;reader&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">strip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>

    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="nf">find</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">optional</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Optional version of method |XMLBase.find|.&quot;&quot;&quot;</span>

    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">optional</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="kc">False</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Non-optional version of function |XMLBase.find|.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="XMLBase.find">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLBase.find">[docs]</a>
    <span class="k">def</span> <span class="nf">find</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">optional</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply function |find| to the root of the object of the |XMLBase| subclass.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XMLInterface</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.data import make_filepath</span>
<span class="sd">        &gt;&gt;&gt; interface = XMLInterface(&quot;single_run.xml&quot;, make_filepath(&quot;LahnH&quot;))</span>
<span class="sd">        &gt;&gt;&gt; interface.find(&quot;timegrid&quot;).tag.endswith(&quot;timegrid&quot;)</span>
<span class="sd">        True</span>

<span class="sd">        &gt;&gt;&gt; interface.find(&quot;wrong&quot;)</span>

<span class="sd">        &gt;&gt;&gt; interface.find(&quot;wrong&quot;, optional=False)</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        AttributeError: The actual XML element `config` does not define a XML \</span>
<span class="sd">subelement named `wrong`.  Please make sure your XML file follows the relevant XML \</span>
<span class="sd">schema.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">find</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">optional</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">strip</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;selections&quot;</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">element</span></div>



<div class="viewcode-block" id="XMLInterface">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLInterface">[docs]</a>
<span class="k">class</span> <span class="nc">XMLInterface</span><span class="p">(</span><span class="n">XMLBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;An interface to XML configuration files that are valid concerning schema file</span>
<span class="sd">    `HydPyConfigSingleRun.xsd` or `HydPyConfigMultipleRuns.xsd`.</span>

<span class="sd">    &gt;&gt;&gt; from hydpy.auxs.xmltools import XMLInterface</span>
<span class="sd">    &gt;&gt;&gt; from hydpy.data import make_filepath</span>
<span class="sd">    &gt;&gt;&gt; interface = XMLInterface(&quot;single_run.xml&quot;, make_filepath(&quot;LahnH&quot;))</span>
<span class="sd">    &gt;&gt;&gt; interface.root.tag</span>
<span class="sd">    &#39;{https://github.com/hydpy-dev/hydpy/releases/download/your-hydpy-version/\</span>
<span class="sd">HydPyConfigSingleRun.xsd}config&#39;</span>
<span class="sd">    &gt;&gt;&gt; interface = XMLInterface(&#39;multiple_runs.xml&#39;, make_filepath(&#39;LahnH&#39;))</span>
<span class="sd">    &gt;&gt;&gt; interface.root.tag</span>
<span class="sd">    &#39;{https://github.com/hydpy-dev/hydpy/releases/download/your-hydpy-version/\</span>
<span class="sd">HydPyConfigMultipleRuns.xsd}config&#39;</span>
<span class="sd">    &gt;&gt;&gt; XMLInterface(&#39;wrongfilepath.xml&#39;, &#39;wrongdir&#39;)  # doctest: +ELLIPSIS</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    FileNotFoundError: While trying to parse the XML configuration file \</span>
<span class="sd">...wrongfilepath.xml, the following error occurred: \</span>
<span class="sd">[Errno 2] No such file or directory: &#39;...wrongfilepath.xml&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">directory</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">directory</span> <span class="o">=</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">projectname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">filename</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">)</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
            <span class="n">objecttools</span><span class="o">.</span><span class="n">augment_excmessage</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;While trying to parse the XML configuration file &quot;</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

<div class="viewcode-block" id="XMLInterface.validate_xml">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLInterface.validate_xml">[docs]</a>
    <span class="k">def</span> <span class="nf">validate_xml</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Raise an error if the actual XML does not agree with one of the available</span>
<span class="sd">        schema files.</span>

<span class="sd">        # ToDo: should it be accompanied by a script function?</span>

<span class="sd">        The first example relies on a distorted version of the configuration file</span>
<span class="sd">        `single_run.xml`:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.examples import prepare_full_example_1</span>
<span class="sd">        &gt;&gt;&gt; prepare_full_example_1()</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import TestIO, xml_replace</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XMLInterface</span>
<span class="sd">        &gt;&gt;&gt; import os</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():  # doctest: +ELLIPSIS</span>
<span class="sd">        ...     xml_replace(&quot;LahnH/single_run&quot;,</span>
<span class="sd">        ...                 firstdate=&quot;1996-01-32T00:00:00&quot;)</span>
<span class="sd">        template file: LahnH/single_run.xmlt</span>
<span class="sd">        target file: LahnH/single_run.xml</span>
<span class="sd">        replacements:</span>
<span class="sd">          config_start --&gt; &lt;...HydPyConfigBase.xsd&quot;</span>
<span class="sd">                      ...HydPyConfigSingleRun.xsd&quot;&gt; (default argument)</span>
<span class="sd">          firstdate --&gt; 1996-01-32T00:00:00 (given argument)</span>
<span class="sd">          zip_ --&gt; false (default argument)</span>
<span class="sd">          config_end --&gt; &lt;/hpcsr:config&gt; (default argument)</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     interface = XMLInterface(&quot;single_run.xml&quot;, &quot;LahnH&quot;)</span>
<span class="sd">        &gt;&gt;&gt; interface.validate_xml()  # doctest: +ELLIPSIS</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        xmlschema.validators.exceptions.XMLSchemaDecodeError: While trying to \</span>
<span class="sd">validate XML file `...single_run.xml`, the following error occurred: failed \</span>
<span class="sd">validating &#39;1996-01-32T00:00:00&#39; with XsdAtomicBuiltin(name=&#39;xs:dateTime&#39;)...</span>
<span class="sd">        ...</span>
<span class="sd">        Reason: day is out of range for month</span>
<span class="sd">        ...</span>
<span class="sd">        Schema:</span>
<span class="sd">        ...</span>
<span class="sd">        Instance:</span>
<span class="sd">        ...</span>
<span class="sd">          &lt;firstdate xmlns=&quot;https://github.com/hydpy-dev/hydpy/releases/\</span>
<span class="sd">download/your-hydpy-version/HydPyConfigBase.xsd&quot;&gt;1996-01-32T00:00:00&lt;/firstdate&gt;</span>
<span class="sd">        ...</span>
<span class="sd">        Path: /hpcsr:config/timegrid/firstdate</span>
<span class="sd">        ...</span>

<span class="sd">        In the second example, we examine a correct configuration file:</span>

<span class="sd">        &gt;&gt;&gt; with TestIO():  # doctest: +ELLIPSIS</span>
<span class="sd">        ...     xml_replace(&quot;LahnH/single_run&quot;)</span>
<span class="sd">        ...     interface = XMLInterface(&quot;single_run.xml&quot;, &quot;LahnH&quot;)</span>
<span class="sd">        template file: LahnH/single_run.xmlt</span>
<span class="sd">        target file: LahnH/single_run.xml</span>
<span class="sd">        replacements:</span>
<span class="sd">          config_start --&gt; &lt;...HydPyConfigBase.xsd&quot;</span>
<span class="sd">                      ...HydPyConfigSingleRun.xsd&quot;&gt; (default argument)</span>
<span class="sd">          firstdate --&gt; 1996-01-01T00:00:00 (default argument)</span>
<span class="sd">          zip_ --&gt; false (default argument)</span>
<span class="sd">          config_end --&gt; &lt;/hpcsr:config&gt; (default argument)</span>
<span class="sd">        &gt;&gt;&gt; interface.validate_xml()</span>

<span class="sd">        The XML configuration file must correctly refer to the corresponding schema</span>
<span class="sd">        file:</span>

<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     xml_replace(&quot;LahnH/single_run&quot;,</span>
<span class="sd">        ...                 config_start=&quot;&lt;config&gt;&quot;,</span>
<span class="sd">        ...                 config_end=&quot;&lt;/config&gt;&quot;)</span>
<span class="sd">        ...     interface = XMLInterface(&quot;single_run.xml&quot;, &quot;LahnH&quot;)</span>
<span class="sd">        template file: LahnH/single_run.xmlt</span>
<span class="sd">        target file: LahnH/single_run.xml</span>
<span class="sd">        replacements:</span>
<span class="sd">          config_start --&gt; &lt;config&gt; (given argument)</span>
<span class="sd">          firstdate --&gt; 1996-01-01T00:00:00 (default argument)</span>
<span class="sd">          zip_ --&gt; false (default argument)</span>
<span class="sd">          config_end --&gt; &lt;/config&gt; (given argument)</span>
<span class="sd">        &gt;&gt;&gt; interface.validate_xml()  # doctest: +ELLIPSIS</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        RuntimeError: While trying to validate XML file `...single_run.xml`, \</span>
<span class="sd">the following error occurred: Configuration file `single_run.xml` does not \</span>
<span class="sd">correctly refer to one of the available XML schema files \</span>
<span class="sd">(HydPyConfigSingleRun.xsd and HydPyConfigMultipleRuns.xsd).</span>

<span class="sd">        XML files based on `HydPyConfigMultipleRuns.xsd` can be validated as well:</span>

<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     interface = XMLInterface(&quot;multiple_runs.xml&quot;, &quot;LahnH&quot;)</span>
<span class="sd">        &gt;&gt;&gt; interface.validate_xml()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">filenames</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;HydPyConfigSingleRun.xsd&quot;</span><span class="p">,</span> <span class="s2">&quot;HydPyConfigMultipleRuns.xsd&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">tag</span><span class="p">:</span>
                    <span class="n">schemafile</span> <span class="o">=</span> <span class="n">name</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Configuration file `</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">` does &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;not correctly refer to one of the available XML schema files &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">enumeration</span><span class="p">(</span><span class="n">filenames</span><span class="p">)</span><span class="si">}</span><span class="s2">).&quot;</span>
                <span class="p">)</span>
            <span class="n">confpath</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">__path__</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">schemapath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">confpath</span><span class="p">,</span> <span class="n">schemafile</span><span class="p">)</span>
            <span class="n">schema</span> <span class="o">=</span> <span class="n">xmlschema</span><span class="o">.</span><span class="n">XMLSchema</span><span class="p">(</span><span class="n">schemapath</span><span class="p">)</span>
            <span class="n">schema</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
            <span class="n">objecttools</span><span class="o">.</span><span class="n">augment_excmessage</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;While trying to validate XML file `</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="si">}</span><span class="s2">`&quot;</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="XMLInterface.update_options">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLInterface.update_options">[docs]</a>
    <span class="k">def</span> <span class="nf">update_options</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the |Options| object available in the |pub| module with the values</span>
<span class="sd">        defined in the `options` XML element.</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">            &gt;&gt;&gt; del pub.options.simulationstep</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XMLInterface</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.data import make_filepath</span>
<span class="sd">        &gt;&gt;&gt; interface = XMLInterface(&quot;single_run.xml&quot;, make_filepath(&quot;LahnH&quot;))</span>
<span class="sd">        &gt;&gt;&gt; pub.options.ellipsis = 0</span>
<span class="sd">        &gt;&gt;&gt; pub.options.parameterstep = &quot;1h&quot;</span>
<span class="sd">        &gt;&gt;&gt; pub.options.printprogress = True</span>
<span class="sd">        &gt;&gt;&gt; pub.options.reprdigits = -1</span>
<span class="sd">        &gt;&gt;&gt; pub.options.utcoffset = -60</span>
<span class="sd">        &gt;&gt;&gt; pub.options.timestampleft = False</span>
<span class="sd">        &gt;&gt;&gt; pub.options.warnsimulationstep = 0</span>
<span class="sd">        &gt;&gt;&gt; interface.update_options()</span>
<span class="sd">        &gt;&gt;&gt; pub.options</span>
<span class="sd">        Options(</span>
<span class="sd">            checkseries -&gt; 1</span>
<span class="sd">            ellipsis -&gt; 0</span>
<span class="sd">            parameterstep -&gt; Period(&quot;1d&quot;)</span>
<span class="sd">            printprogress -&gt; 0</span>
<span class="sd">            reprcomments -&gt; 0</span>
<span class="sd">            reprdigits -&gt; 6</span>
<span class="sd">            simulationstep -&gt; Period()</span>
<span class="sd">            trimvariables -&gt; 1</span>
<span class="sd">            usecython -&gt; 1</span>
<span class="sd">            usedefaultvalues -&gt; 0</span>
<span class="sd">            utclongitude -&gt; 15</span>
<span class="sd">            utcoffset -&gt; 60</span>
<span class="sd">            timestampleft -&gt; 1</span>
<span class="sd">            warnmissingcontrolfile -&gt; 0</span>
<span class="sd">            warnmissingobsfile -&gt; 1</span>
<span class="sd">            warnmissingsimfile -&gt; 1</span>
<span class="sd">            warnsimulationstep -&gt; 0</span>
<span class="sd">            warntrim -&gt; 1</span>
<span class="sd">        )</span>
<span class="sd">        &gt;&gt;&gt; pub.options.printprogress = False</span>
<span class="sd">        &gt;&gt;&gt; pub.options.reprdigits = 6</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">options</span> <span class="o">=</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">options</span>
        <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;options&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">option</span><span class="o">.</span><span class="n">text</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="s2">&quot;false&quot;</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">strip</span><span class="p">(</span><span class="n">option</span><span class="o">.</span><span class="n">tag</span><span class="p">),</span> <span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">strip</span><span class="p">(</span><span class="n">option</span><span class="o">.</span><span class="n">tag</span><span class="p">),</span> <span class="n">value</span><span class="p">)</span>
        <span class="n">options</span><span class="o">.</span><span class="n">printprogress</span> <span class="o">=</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="XMLInterface.update_timegrids">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLInterface.update_timegrids">[docs]</a>
    <span class="k">def</span> <span class="nf">update_timegrids</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the |Timegrids| object available in the |pub| module with the values</span>
<span class="sd">        defined in the `timegrid` XML element.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.examples import prepare_full_example_1</span>
<span class="sd">        &gt;&gt;&gt; prepare_full_example_1()</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import HydPy, pub, TestIO</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XMLInterface</span>
<span class="sd">        &gt;&gt;&gt; hp = HydPy(&quot;LahnH&quot;)</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     XMLInterface(&quot;single_run.xml&quot;).update_timegrids()</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids</span>
<span class="sd">        Timegrids(&quot;1996-01-01T00:00:00&quot;,</span>
<span class="sd">                  &quot;1996-01-06T00:00:00&quot;,</span>
<span class="sd">                  &quot;1d&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">timegrid_xml</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;timegrid&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">firstdate</span> <span class="o">=</span> <span class="n">timegrid_xml</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span>
        <span class="k">assert</span> <span class="n">firstdate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">lastdate</span> <span class="o">=</span> <span class="n">timegrid_xml</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span>
        <span class="k">assert</span> <span class="n">lastdate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">stepsize</span> <span class="o">=</span> <span class="n">timegrid_xml</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">text</span>
        <span class="k">assert</span> <span class="n">stepsize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">timegrids</span> <span class="o">=</span> <span class="p">(</span><span class="n">firstdate</span><span class="p">,</span> <span class="n">lastdate</span><span class="p">,</span> <span class="n">stepsize</span><span class="p">)</span></div>


<div class="viewcode-block" id="XMLInterface.update_selections">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLInterface.update_selections">[docs]</a>
    <span class="k">def</span> <span class="nf">update_selections</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create |Selection| objects based on the `add_selections` XML element and</span>
<span class="sd">        add them to the |Selections| object available in module |pub|.</span>

<span class="sd">        The `Lahn` example project comes with four selections:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.examples import prepare_full_example_1</span>
<span class="sd">        &gt;&gt;&gt; prepare_full_example_1()</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import HydPy, pub, TestIO</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import find, XMLInterface</span>
<span class="sd">        &gt;&gt;&gt; hp = HydPy(&quot;LahnH&quot;)</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     hp.prepare_network()</span>
<span class="sd">        ...     interface = XMLInterface(&quot;single_run.xml&quot;)</span>
<span class="sd">        &gt;&gt;&gt; pub.selections</span>
<span class="sd">        Selections(&quot;complete&quot;, &quot;headwaters&quot;, &quot;nonheadwaters&quot;, &quot;streams&quot;)</span>

<span class="sd">        Following the definitions of the `add_selections` element of the configuration</span>
<span class="sd">        file `single_run.xml`, method |XMLInterface.update_selections| creates three</span>
<span class="sd">        additional selections based on given device names, keywords, or selection</span>
<span class="sd">        names (you could also combine these subelements):</span>

<span class="sd">        &gt;&gt;&gt; interface.update_selections()</span>
<span class="sd">        &gt;&gt;&gt; pub.selections</span>
<span class="sd">        Selections(&quot;complete&quot;, &quot;from_devices&quot;, &quot;from_keywords&quot;,</span>
<span class="sd">                   &quot;from_selections&quot;, &quot;headwaters&quot;, &quot;nonheadwaters&quot;, &quot;streams&quot;)</span>
<span class="sd">        &gt;&gt;&gt; pub.selections.from_devices</span>
<span class="sd">        Selection(&quot;from_devices&quot;,</span>
<span class="sd">                  nodes=(),</span>
<span class="sd">                  elements=(&quot;land_lahn_1&quot;, &quot;land_lahn_2&quot;))</span>
<span class="sd">        &gt;&gt;&gt; pub.selections.from_keywords</span>
<span class="sd">        Selection(&quot;from_keywords&quot;,</span>
<span class="sd">                  nodes=(),</span>
<span class="sd">                  elements=(&quot;land_dill&quot;, &quot;land_lahn_1&quot;, &quot;land_lahn_2&quot;,</span>
<span class="sd">                            &quot;land_lahn_3&quot;))</span>
<span class="sd">        &gt;&gt;&gt; pub.selections.from_selections</span>
<span class="sd">        Selection(&quot;from_selections&quot;,</span>
<span class="sd">                  nodes=(&quot;dill&quot;, &quot;lahn_1&quot;, &quot;lahn_2&quot;, &quot;lahn_3&quot;),</span>
<span class="sd">                  elements=(&quot;land_dill&quot;, &quot;land_lahn_1&quot;, &quot;land_lahn_2&quot;,</span>
<span class="sd">                            &quot;land_lahn_3&quot;, &quot;stream_dill_lahn_2&quot;,</span>
<span class="sd">                            &quot;stream_lahn_1_lahn_2&quot;, &quot;stream_lahn_2_lahn_3&quot;))</span>

<span class="sd">        Defining wrong device names, keywords, or selection names results in error</span>
<span class="sd">        messages:</span>

<span class="sd">        &gt;&gt;&gt; add_selections = find(interface.root, &quot;add_selections&quot;)</span>
<span class="sd">        &gt;&gt;&gt; add_selections[2][1].text = &quot;streams no_selection&quot;</span>
<span class="sd">        &gt;&gt;&gt; interface.update_selections()</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        RuntimeError: The XML configuration file tried to add the devices of a \</span>
<span class="sd">selection named `no_selection` to the custom selection `from_selections` but none \</span>
<span class="sd">of the available selections has this name.</span>

<span class="sd">        &gt;&gt;&gt; add_selections[1][1].text = &quot;catchment no_keyword&quot;</span>
<span class="sd">        &gt;&gt;&gt; interface.update_selections()</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        RuntimeError: The XML configuration file tried to add at least one device \</span>
<span class="sd">based on the keyword `no_keyword` to the custom selection `from_keywords` but none \</span>
<span class="sd">of the available devices has this keyword.</span>

<span class="sd">        &gt;&gt;&gt; add_selections[0][1].text = &quot;dill no_device&quot;</span>
<span class="sd">        &gt;&gt;&gt; interface.update_selections()</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        RuntimeError: The XML configuration file tried to add a device named \</span>
<span class="sd">`no_device` to the custom selection `from_devices` but none of the available \</span>
<span class="sd">devices has this name.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">_get_texts</span><span class="p">(</span><span class="n">root</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
            <span class="n">xmlelement</span> <span class="o">=</span> <span class="n">find</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="n">root</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">xmlelement</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">xmlelement</span><span class="o">.</span><span class="n">text</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[]</span>
            <span class="k">return</span> <span class="n">xmlelement</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

        <span class="n">elements</span> <span class="o">=</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">selections</span><span class="o">.</span><span class="n">complete</span><span class="o">.</span><span class="n">elements</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">selections</span><span class="o">.</span><span class="n">complete</span><span class="o">.</span><span class="n">nodes</span>
        <span class="n">add_selections</span> <span class="o">=</span> <span class="n">find</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s2">&quot;add_selections&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">add_selections</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">add_selection</span> <span class="ow">in</span> <span class="n">add_selections</span><span class="p">:</span>
                <span class="n">name_new_selection</span> <span class="o">=</span> <span class="n">find</span><span class="p">(</span><span class="n">add_selection</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                <span class="k">assert</span> <span class="n">name_new_selection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="n">new_selection</span> <span class="o">=</span> <span class="n">selectiontools</span><span class="o">.</span><span class="n">Selection</span><span class="p">(</span><span class="n">name_new_selection</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">name_device</span> <span class="ow">in</span> <span class="n">_get_texts</span><span class="p">(</span><span class="n">add_selection</span><span class="p">,</span> <span class="s2">&quot;devices&quot;</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">element</span> <span class="o">=</span> <span class="n">elements</span><span class="p">[</span><span class="n">name_device</span><span class="p">]</span>
                        <span class="n">new_selection</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="n">element</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">element</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">node</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="n">name_device</span><span class="p">]</span>
                            <span class="n">new_selection</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span>
                        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                                <span class="sa">f</span><span class="s2">&quot;The XML configuration file tried to add a device &quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;named `</span><span class="si">{</span><span class="n">name_device</span><span class="si">}</span><span class="s2">` to the custom selection &quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">name_new_selection</span><span class="si">}</span><span class="s2">` but none of the available &quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;devices has this name.&quot;</span>
                            <span class="p">)</span> <span class="kn">from</span> <span class="kc">None</span>
                <span class="k">for</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="n">_get_texts</span><span class="p">(</span><span class="n">add_selection</span><span class="p">,</span> <span class="s2">&quot;keywords&quot;</span><span class="p">):</span>
                    <span class="n">nmb_devices</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_selection</span><span class="p">)</span>
                    <span class="n">new_selection</span><span class="o">.</span><span class="n">elements</span> <span class="o">+=</span> <span class="n">elements</span><span class="o">.</span><span class="n">search_keywords</span><span class="p">(</span><span class="n">keyword</span><span class="p">)</span>
                    <span class="n">new_selection</span><span class="o">.</span><span class="n">nodes</span> <span class="o">+=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">search_keywords</span><span class="p">(</span><span class="n">keyword</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_selection</span><span class="p">)</span> <span class="o">==</span> <span class="n">nmb_devices</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;The XML configuration file tried to add at least one &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;device based on the keyword `</span><span class="si">{</span><span class="n">keyword</span><span class="si">}</span><span class="s2">` to the custom &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;selection `</span><span class="si">{</span><span class="n">name_new_selection</span><span class="si">}</span><span class="s2">` but none of the &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;available devices has this keyword.&quot;</span>
                        <span class="p">)</span> <span class="kn">from</span> <span class="kc">None</span>
                <span class="k">for</span> <span class="n">name_old_selection</span> <span class="ow">in</span> <span class="n">_get_texts</span><span class="p">(</span><span class="n">add_selection</span><span class="p">,</span> <span class="s2">&quot;selections&quot;</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">new_selection</span> <span class="o">+=</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">selections</span><span class="p">[</span><span class="n">name_old_selection</span><span class="p">]</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;The XML configuration file tried to add the devices of &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;a selection named `</span><span class="si">{</span><span class="n">name_old_selection</span><span class="si">}</span><span class="s2">` to the custom &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;selection `</span><span class="si">{</span><span class="n">name_new_selection</span><span class="si">}</span><span class="s2">` but none of the &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;available selections has this name.&quot;</span>
                        <span class="p">)</span> <span class="kn">from</span> <span class="kc">None</span>
                <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">selections</span> <span class="o">+=</span> <span class="n">new_selection</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">selections</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">selectiontools</span><span class="o">.</span><span class="n">Selections</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The |Selections| object defined on the main level of the actual XML file.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.examples import prepare_full_example_1</span>
<span class="sd">        &gt;&gt;&gt; prepare_full_example_1()</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import HydPy, TestIO, XMLInterface</span>
<span class="sd">        &gt;&gt;&gt; hp = HydPy(&quot;LahnH&quot;)</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     hp.prepare_network()</span>
<span class="sd">        ...     interface = XMLInterface(&quot;single_run.xml&quot;)</span>
<span class="sd">        &gt;&gt;&gt; interface.update_selections()</span>
<span class="sd">        &gt;&gt;&gt; interface.find(&quot;selections&quot;).text = &quot;headwaters streams&quot;</span>
<span class="sd">        &gt;&gt;&gt; selections = interface.selections</span>
<span class="sd">        &gt;&gt;&gt; for selection in selections:</span>
<span class="sd">        ...     print(selection.name)</span>
<span class="sd">        headwaters</span>
<span class="sd">        streams</span>
<span class="sd">        &gt;&gt;&gt; selections.headwaters</span>
<span class="sd">        Selection(&quot;headwaters&quot;,</span>
<span class="sd">                  nodes=(&quot;dill&quot;, &quot;lahn_1&quot;),</span>
<span class="sd">                  elements=(&quot;land_dill&quot;, &quot;land_lahn_1&quot;))</span>
<span class="sd">        &gt;&gt;&gt; interface.find(&quot;selections&quot;).text = &quot;head_waters&quot;</span>
<span class="sd">        &gt;&gt;&gt; interface.selections</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        NameError: The XML configuration file tries to define a selection using the \</span>
<span class="sd">text `head_waters`, but the actual project does not handle such a `Selection` object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_query_selections</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;selections&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">elements</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">devicetools</span><span class="o">.</span><span class="n">Element</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Yield all |Element| objects returned by |XMLInterface.selections| without</span>
<span class="sd">        duplicates.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.examples import prepare_full_example_1</span>
<span class="sd">        &gt;&gt;&gt; prepare_full_example_1()</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import HydPy, TestIO, XMLInterface</span>
<span class="sd">        &gt;&gt;&gt; hp = HydPy(&quot;LahnH&quot;)</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     hp.prepare_network()</span>
<span class="sd">        ...     interface = XMLInterface(&quot;single_run.xml&quot;)</span>
<span class="sd">        &gt;&gt;&gt; interface.update_timegrids()</span>
<span class="sd">        &gt;&gt;&gt; interface.update_selections()</span>
<span class="sd">        &gt;&gt;&gt; interface.find(&quot;selections&quot;).text = &quot;headwaters streams&quot;</span>
<span class="sd">        &gt;&gt;&gt; for element in interface.elements:</span>
<span class="sd">        ...      print(element.name)</span>
<span class="sd">        land_dill</span>
<span class="sd">        land_lahn_1</span>
<span class="sd">        stream_dill_lahn_2</span>
<span class="sd">        stream_lahn_1_lahn_2</span>
<span class="sd">        stream_lahn_2_lahn_3</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">selections</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">)</span>
        <span class="n">elements</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">devicetools</span><span class="o">.</span><span class="n">Element</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">selection</span> <span class="ow">in</span> <span class="n">selections</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">selection</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">element</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
                    <span class="n">elements</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
                    <span class="k">yield</span> <span class="n">element</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fullselection</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">selectiontools</span><span class="o">.</span><span class="n">Selection</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A |Selection| object that contains all |Element| and |Node| objects defined</span>
<span class="sd">        by |XMLInterface.selections|.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.examples import prepare_full_example_1</span>
<span class="sd">        &gt;&gt;&gt; prepare_full_example_1()</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import HydPy, TestIO, XMLInterface</span>
<span class="sd">        &gt;&gt;&gt; hp = HydPy(&quot;LahnH&quot;)</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     hp.prepare_network()</span>
<span class="sd">        ...     interface = XMLInterface(&quot;single_run.xml&quot;)</span>
<span class="sd">        &gt;&gt;&gt; interface.update_selections()</span>
<span class="sd">        &gt;&gt;&gt; interface.find(&quot;selections&quot;).text = &quot;nonheadwaters&quot;</span>
<span class="sd">        &gt;&gt;&gt; interface.fullselection</span>
<span class="sd">        Selection(&quot;fullselection&quot;,</span>
<span class="sd">                  nodes=(&quot;lahn_2&quot;, &quot;lahn_3&quot;),</span>
<span class="sd">                  elements=(&quot;land_lahn_2&quot;, &quot;land_lahn_3&quot;))</span>
<span class="sd">        &gt;&gt;&gt; interface.find(&quot;selections&quot;).text = &quot;from_keywords&quot;</span>
<span class="sd">        &gt;&gt;&gt; interface.fullselection</span>
<span class="sd">        Selection(&quot;fullselection&quot;,</span>
<span class="sd">                  nodes=(),</span>
<span class="sd">                  elements=(&quot;land_dill&quot;, &quot;land_lahn_1&quot;, &quot;land_lahn_2&quot;,</span>
<span class="sd">                            &quot;land_lahn_3&quot;))</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fullselection</span> <span class="o">=</span> <span class="n">selectiontools</span><span class="o">.</span><span class="n">Selection</span><span class="p">(</span><span class="s2">&quot;fullselection&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">selection</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">:</span>
            <span class="n">fullselection</span> <span class="o">+=</span> <span class="n">selection</span>
        <span class="k">return</span> <span class="n">fullselection</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">network_io</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">XMLNetworkDefault</span><span class="p">,</span> <span class="n">XMLNetworkUserDefined</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The `network_io` element defined in the actual XML file.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XMLInterface, strip</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.data import make_filepath</span>
<span class="sd">        &gt;&gt;&gt; interface = XMLInterface(&quot;single_run.xml&quot;, make_filepath(&quot;LahnH&quot;))</span>
<span class="sd">        &gt;&gt;&gt; interface.network_io.text</span>
<span class="sd">        &#39;default&#39;</span>
<span class="sd">        &gt;&gt;&gt; interface = XMLInterface(&quot;multiple_runs.xml&quot;, make_filepath(&quot;LahnH&quot;))</span>
<span class="sd">        &gt;&gt;&gt; interface.network_io.text</span>
<span class="sd">        &#39;default&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">network_io</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;network_io&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">network_io</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">XMLNetworkDefault</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">XMLNetworkUserDefined</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">network_io</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">network_io</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">control_io</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">XMLControlDefault</span><span class="p">,</span> <span class="n">XMLControlUserDefined</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The `control_io` element defined in the actual XML file.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XMLInterface, strip</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.data import make_filepath</span>
<span class="sd">        &gt;&gt;&gt; interface = XMLInterface(&quot;single_run.xml&quot;, make_filepath(&quot;LahnH&quot;))</span>
<span class="sd">        &gt;&gt;&gt; interface.control_io.text</span>
<span class="sd">        &#39;default&#39;</span>
<span class="sd">        &gt;&gt;&gt; interface = XMLInterface(&quot;multiple_runs.xml&quot;, make_filepath(&quot;LahnH&quot;))</span>
<span class="sd">        &gt;&gt;&gt; interface.control_io.text</span>
<span class="sd">        &#39;default&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">control_io</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;control_io&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">control_io</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">XMLControlDefault</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">XMLControlUserDefined</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">control_io</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">control_io</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">conditions_io</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">XMLConditions</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The `condition_io` element defined in the actual XML file.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XMLInterface, strip</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.data import make_filepath</span>
<span class="sd">        &gt;&gt;&gt; interface = XMLInterface(&quot;single_run.xml&quot;, make_filepath(&quot;LahnH&quot;))</span>
<span class="sd">        &gt;&gt;&gt; strip(interface.series_io.root.tag)</span>
<span class="sd">        &#39;series_io&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">XMLConditions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;conditions_io&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">series_io</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">XMLSeries</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The `series_io` element defined in the actual XML file.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XMLInterface, strip</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.data import make_filepath</span>
<span class="sd">        &gt;&gt;&gt; interface = XMLInterface(&quot;single_run.xml&quot;, make_filepath(&quot;LahnH&quot;))</span>
<span class="sd">        &gt;&gt;&gt; strip(interface.series_io.root.tag)</span>
<span class="sd">        &#39;series_io&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">XMLSeries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;series_io&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">exchange</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">XMLExchange</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The `exchange` element defined in the actual XML file.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XMLInterface, strip</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.data import make_filepath</span>
<span class="sd">        &gt;&gt;&gt; interface = XMLInterface(</span>
<span class="sd">        ...     &quot;multiple_runs.xml&quot;, make_filepath(&quot;LahnH&quot;))</span>
<span class="sd">        &gt;&gt;&gt; strip(interface.exchange.root.tag)</span>
<span class="sd">        &#39;exchange&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">XMLExchange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;exchange&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span></div>



<div class="viewcode-block" id="XMLNetworkBase">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLNetworkBase">[docs]</a>
<span class="k">class</span> <span class="nc">XMLNetworkBase</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for |XMLNetworkDefault| and |XMLNetworkUserDefined|.&quot;&quot;&quot;</span>

    <span class="n">master</span><span class="p">:</span> <span class="n">XMLInterface</span>
    <span class="n">text</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>

<div class="viewcode-block" id="XMLNetworkBase.prepare_network">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLNetworkBase.prepare_network">[docs]</a>
    <span class="k">def</span> <span class="nf">prepare_network</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Prepare the |Selections| object available in the global |pub| module:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.examples import prepare_full_example_1</span>
<span class="sd">        &gt;&gt;&gt; prepare_full_example_1()</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import attrready, HydPy, pub, TestIO, XMLInterface</span>
<span class="sd">        &gt;&gt;&gt; hp = HydPy(&quot;LahnH&quot;)</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;1996-01-01&quot;, &quot;1996-01-06&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     interface = XMLInterface(&quot;single_run.xml&quot;)</span>
<span class="sd">        ...     interface.find(&quot;network_io&quot;).text = &quot;wrong&quot;</span>
<span class="sd">        ...     interface.network_io.prepare_network()  # doctest: +ELLIPSIS</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        RuntimeError: The directory `...wrong` does not contain any network files.</span>

<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     interface = XMLInterface(&quot;single_run.xml&quot;)</span>
<span class="sd">        ...     interface.find(&quot;network_io&quot;).text = &quot;default&quot;</span>
<span class="sd">        ...     interface.network_io.prepare_network()  # doctest: +ELLIPSIS</span>
<span class="sd">        &gt;&gt;&gt; pub.selections</span>
<span class="sd">        Selections(&quot;complete&quot;, &quot;headwaters&quot;, &quot;nonheadwaters&quot;, &quot;streams&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
            <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">networkmanager</span><span class="o">.</span><span class="n">currentdir</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">selections</span> <span class="o">=</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">networkmanager</span><span class="o">.</span><span class="n">load_files</span><span class="p">()</span></div>
</div>



<div class="viewcode-block" id="XMLNetworkDefault">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLNetworkDefault">[docs]</a>
<span class="k">class</span> <span class="nc">XMLNetworkDefault</span><span class="p">(</span><span class="n">XMLNetworkBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper class for |XMLInterface| responsible for loading devices from network</span>
<span class="sd">    files when the XML file does not specify a network directory.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">master</span><span class="p">:</span> <span class="n">XMLInterface</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="p">:</span> <span class="n">XMLInterface</span> <span class="o">=</span> <span class="n">master</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">text</span></div>



<div class="viewcode-block" id="XMLNetworkUserDefined">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLNetworkUserDefined">[docs]</a>
<span class="k">class</span> <span class="nc">XMLNetworkUserDefined</span><span class="p">(</span><span class="n">XMLBase</span><span class="p">,</span> <span class="n">XMLNetworkBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper class for |XMLInterface| responsible for loading devices from network</span>
<span class="sd">    files when the XML file specifies a network directory.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">master</span><span class="p">:</span> <span class="n">XMLInterface</span><span class="p">,</span> <span class="n">root</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="p">:</span> <span class="n">XMLInterface</span> <span class="o">=</span> <span class="n">master</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span> <span class="o">=</span> <span class="n">root</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">text</span></div>



<div class="viewcode-block" id="XMLControlBase">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLControlBase">[docs]</a>
<span class="k">class</span> <span class="nc">XMLControlBase</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for |XMLControlDefault| and |XMLControlUserDefined|.&quot;&quot;&quot;</span>

    <span class="n">master</span><span class="p">:</span> <span class="n">XMLInterface</span>
    <span class="n">text</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>

<div class="viewcode-block" id="XMLControlBase.prepare_models">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLControlBase.prepare_models">[docs]</a>
    <span class="k">def</span> <span class="nf">prepare_models</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Prepare the |Model| objects of all |Element| objects returned by</span>
<span class="sd">        |XMLInterface.elements|:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.examples import prepare_full_example_1</span>
<span class="sd">        &gt;&gt;&gt; prepare_full_example_1()</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import attrready, HydPy, pub, TestIO, XMLInterface</span>
<span class="sd">        &gt;&gt;&gt; hp = HydPy(&quot;LahnH&quot;)</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;1996-01-01&quot;, &quot;1996-01-06&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     hp.prepare_network()</span>
<span class="sd">        ...     interface = XMLInterface(&quot;single_run.xml&quot;)</span>
<span class="sd">        ...     interface.update_selections()</span>
<span class="sd">        ...     interface.find(&quot;selections&quot;).text = &quot;headwaters&quot;</span>
<span class="sd">        ...     interface.control_io.prepare_models()</span>
<span class="sd">        &gt;&gt;&gt; interface.update_timegrids()</span>
<span class="sd">        &gt;&gt;&gt; hp.elements.land_lahn_1.model.parameters.control.alpha</span>
<span class="sd">        alpha(1.0)</span>
<span class="sd">        &gt;&gt;&gt; attrready(hp.elements.land_lahn_2, &quot;model&quot;)</span>
<span class="sd">        False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
            <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">controlmanager</span><span class="o">.</span><span class="n">currentdir</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
            <span class="n">element</span><span class="o">.</span><span class="n">prepare_model</span><span class="p">()</span></div>
</div>



<div class="viewcode-block" id="XMLControlDefault">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLControlDefault">[docs]</a>
<span class="k">class</span> <span class="nc">XMLControlDefault</span><span class="p">(</span><span class="n">XMLControlBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper class for |XMLInterface| responsible for loading models from control</span>
<span class="sd">    files when the XML file does not specify a control directory.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">master</span><span class="p">:</span> <span class="n">XMLInterface</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="p">:</span> <span class="n">XMLInterface</span> <span class="o">=</span> <span class="n">master</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">text</span></div>



<div class="viewcode-block" id="XMLControlUserDefined">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLControlUserDefined">[docs]</a>
<span class="k">class</span> <span class="nc">XMLControlUserDefined</span><span class="p">(</span><span class="n">XMLBase</span><span class="p">,</span> <span class="n">XMLControlBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper class for |XMLInterface| responsible for loading models from control</span>
<span class="sd">    files when the XML file specifies a control directory.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">master</span><span class="p">:</span> <span class="n">XMLInterface</span><span class="p">,</span> <span class="n">root</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="p">:</span> <span class="n">XMLInterface</span> <span class="o">=</span> <span class="n">master</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span> <span class="o">=</span> <span class="n">root</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">text</span></div>



<div class="viewcode-block" id="XMLConditions">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLConditions">[docs]</a>
<span class="k">class</span> <span class="nc">XMLConditions</span><span class="p">(</span><span class="n">XMLBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper class for |XMLInterface| responsible for loading and saving initial</span>
<span class="sd">    conditions.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">master</span><span class="p">:</span> <span class="n">XMLInterface</span><span class="p">,</span> <span class="n">root</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="p">:</span> <span class="n">XMLInterface</span> <span class="o">=</span> <span class="n">master</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span> <span class="o">=</span> <span class="n">root</span>

<div class="viewcode-block" id="XMLConditions.load_conditions">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLConditions.load_conditions">[docs]</a>
    <span class="k">def</span> <span class="nf">load_conditions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">currentdir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load the condition files of the |Model| objects of all |Element| objects</span>
<span class="sd">        returned by |XMLInterface.elements|:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.examples import prepare_full_example_1</span>
<span class="sd">        &gt;&gt;&gt; prepare_full_example_1()</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import HydPy, pub, TestIO, XMLInterface</span>
<span class="sd">        &gt;&gt;&gt; hp = HydPy(&quot;LahnH&quot;)</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;1996-01-01&quot;, &quot;1996-01-06&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     hp.prepare_network()</span>
<span class="sd">        ...     hp.prepare_models()</span>
<span class="sd">        ...     interface = XMLInterface(&quot;single_run.xml&quot;)</span>
<span class="sd">        ...     interface.update_selections()</span>
<span class="sd">        ...     interface.find(&quot;selections&quot;).text = &quot;headwaters&quot;</span>
<span class="sd">        ...     interface.conditions_io.load_conditions()</span>
<span class="sd">        &gt;&gt;&gt; interface.update_timegrids()</span>
<span class="sd">        &gt;&gt;&gt; hp.elements.land_lahn_1.model.sequences.states.lz</span>
<span class="sd">        lz(8.18711)</span>
<span class="sd">        &gt;&gt;&gt; hp.elements.land_lahn_2.model.sequences.states.lz</span>
<span class="sd">        lz(nan)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">currentdir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">currentdir</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;inputdir&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">conditionmanager</span><span class="o">.</span><span class="n">currentdir</span> <span class="o">=</span> <span class="n">currentdir</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
            <span class="n">element</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">load_conditions</span><span class="p">()</span></div>


<div class="viewcode-block" id="XMLConditions.save_conditions">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLConditions.save_conditions">[docs]</a>
    <span class="k">def</span> <span class="nf">save_conditions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">currentdir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save the condition files of the |Model| objects of all |Element| objects</span>
<span class="sd">        returned by |XMLInterface.elements|:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.examples import prepare_full_example_1</span>
<span class="sd">        &gt;&gt;&gt; prepare_full_example_1()</span>

<span class="sd">        &gt;&gt;&gt; import os</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import HydPy, pub, TestIO, XMLInterface</span>
<span class="sd">        &gt;&gt;&gt; hp = HydPy(&quot;LahnH&quot;)</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;1996-01-01&quot;, &quot;1996-01-06&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     hp.prepare_network()</span>
<span class="sd">        ...     hp.prepare_models()</span>
<span class="sd">        ...     hp.elements.land_dill.model.sequences.states.lz = 999.0</span>
<span class="sd">        ...     interface = XMLInterface(&quot;single_run.xml&quot;)</span>
<span class="sd">        ...     interface.update_timegrids()</span>
<span class="sd">        ...     interface.update_selections()</span>
<span class="sd">        ...     interface.find(&quot;selections&quot;).text = &quot;headwaters&quot;</span>
<span class="sd">        ...     interface.conditions_io.save_conditions()</span>
<span class="sd">        ...     dirpath = &quot;LahnH/conditions/init_1996_01_06&quot;</span>
<span class="sd">        ...     with open(os.path.join(dirpath, &quot;land_dill.py&quot;)) as file_:</span>
<span class="sd">        ...         print(file_.readlines()[11].strip())</span>
<span class="sd">        ...     os.path.exists(os.path.join(dirpath, &quot;land_lahn_2.py&quot;))</span>
<span class="sd">        lz(999.0)</span>
<span class="sd">        False</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import xml_replace</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     xml_replace(&quot;LahnH/single_run&quot;, printflag=False, zip_=&quot;true&quot;)</span>
<span class="sd">        ...     interface = XMLInterface(&quot;single_run.xml&quot;)</span>
<span class="sd">        ...     interface.find(&quot;selections&quot;).text = &quot;headwaters&quot;</span>
<span class="sd">        ...     os.path.exists(&quot;LahnH/conditions/init_1996_01_06.zip&quot;)</span>
<span class="sd">        ...     interface.conditions_io.save_conditions()</span>
<span class="sd">        ...     os.path.exists(&quot;LahnH/conditions/init_1996_01_06.zip&quot;)</span>
<span class="sd">        False</span>
<span class="sd">        True</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">currentdir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">currentdir</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;outputdir&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">conditionmanager</span><span class="o">.</span><span class="n">currentdir</span> <span class="o">=</span> <span class="n">currentdir</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
            <span class="n">element</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">save_conditions</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;zip&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
            <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">conditionmanager</span><span class="o">.</span><span class="n">zip_currentdir</span><span class="p">()</span></div>
</div>



<div class="viewcode-block" id="XMLSeries">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLSeries">[docs]</a>
<span class="k">class</span> <span class="nc">XMLSeries</span><span class="p">(</span><span class="n">XMLBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper class for |XMLInterface| responsible for loading and saving time series</span>
<span class="sd">    data, which is further delegated to suitable instances of class |XMLSubseries|.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">master</span><span class="p">:</span> <span class="n">XMLInterface</span><span class="p">,</span> <span class="n">root</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="p">:</span> <span class="n">XMLInterface</span> <span class="o">=</span> <span class="n">master</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span> <span class="o">=</span> <span class="n">root</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">readers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">XMLSubseries</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The reader XML elements defined in the actual XML file.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XMLInterface</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.data import make_filepath</span>
<span class="sd">        &gt;&gt;&gt; interface = XMLInterface(&quot;single_run.xml&quot;, make_filepath(&quot;LahnH&quot;))</span>
<span class="sd">        &gt;&gt;&gt; for reader in interface.series_io.readers:</span>
<span class="sd">        ...     print(reader.info)</span>
<span class="sd">        all input data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">XMLSubseries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;readers&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">)]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">writers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">XMLSubseries</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The writer XML elements defined in the actual XML file.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XMLInterface</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.data import make_filepath</span>
<span class="sd">        &gt;&gt;&gt; interface = XMLInterface(&quot;single_run.xml&quot;, make_filepath(&quot;LahnH&quot;))</span>
<span class="sd">        &gt;&gt;&gt; for writer in interface.series_io.writers:</span>
<span class="sd">        ...     print(writer.info)</span>
<span class="sd">        precipitation</span>
<span class="sd">        soilmoisture</span>
<span class="sd">        averaged</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">XMLSubseries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;writers&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">)]</span>

<div class="viewcode-block" id="XMLSeries.prepare_series">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLSeries.prepare_series">[docs]</a>
    <span class="k">def</span> <span class="nf">prepare_series</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call |XMLSubseries.prepare_series| of all |XMLSubseries| objects.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">ioseries</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">readers</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">writers</span><span class="p">):</span>
            <span class="n">ioseries</span><span class="o">.</span><span class="n">prepare_series</span><span class="p">()</span></div>


<div class="viewcode-block" id="XMLSeries.load_series">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLSeries.load_series">[docs]</a>
    <span class="k">def</span> <span class="nf">load_series</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">currentdir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call |XMLSubseries.load_series| of all |XMLSubseries| objects handled as</span>
<span class="sd">        &quot;readers&quot;.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">reader</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">readers</span><span class="p">:</span>
            <span class="n">reader</span><span class="o">.</span><span class="n">load_series</span><span class="p">(</span><span class="n">currentdir</span><span class="p">)</span></div>


<div class="viewcode-block" id="XMLSeries.save_series">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLSeries.save_series">[docs]</a>
    <span class="k">def</span> <span class="nf">save_series</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">currentdir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call |XMLSubseries.load_series| of all |XMLSubseries| objects handled as</span>
<span class="sd">        &quot;writers&quot;.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">writer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">writers</span><span class="p">:</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">save_series</span><span class="p">(</span><span class="n">currentdir</span><span class="p">)</span></div>


<div class="viewcode-block" id="XMLSeries.modify_inputdir">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLSeries.modify_inputdir">[docs]</a>
    <span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
    <span class="k">def</span> <span class="nf">modify_inputdir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">currentdir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Temporarily modify the |IOSequence.dirpath| of all |IOSequence| objects</span>
<span class="sd">        registered for reading time-series data &quot;just in time&quot; during a simulation</span>
<span class="sd">        run.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">reader</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">readers</span><span class="p">:</span>
                <span class="n">reader</span><span class="o">.</span><span class="n">change_dirpath</span><span class="p">(</span><span class="n">currentdir</span><span class="p">)</span>
            <span class="k">yield</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">reader</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">readers</span><span class="p">:</span>
                <span class="n">reader</span><span class="o">.</span><span class="n">reset_dirpath</span><span class="p">()</span></div>


<div class="viewcode-block" id="XMLSeries.modify_outputdir">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLSeries.modify_outputdir">[docs]</a>
    <span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
    <span class="k">def</span> <span class="nf">modify_outputdir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">currentdir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Temporarily modify the |IOSequence.dirpath| of all |IOSequence| objects</span>
<span class="sd">        registered for writing time-series data &quot;just in time&quot; during a simulation</span>
<span class="sd">        run.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">writer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">writers</span><span class="p">:</span>
                <span class="n">writer</span><span class="o">.</span><span class="n">change_dirpath</span><span class="p">(</span><span class="n">currentdir</span><span class="p">)</span>
            <span class="k">yield</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">writer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">writers</span><span class="p">:</span>
                <span class="n">writer</span><span class="o">.</span><span class="n">reset_dirpath</span><span class="p">()</span></div>
</div>



<div class="viewcode-block" id="XMLSelector">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLSelector">[docs]</a>
<span class="k">class</span> <span class="nc">XMLSelector</span><span class="p">(</span><span class="n">XMLBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for |XMLSubseries| and |XMLVar| responsible for querying the relevant</span>
<span class="sd">    |Node| and |Element| objects.&quot;&quot;&quot;</span>

    <span class="n">master</span><span class="p">:</span> <span class="n">XMLBase</span>
    <span class="n">root</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">selections</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">selectiontools</span><span class="o">.</span><span class="n">Selections</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The |Selections| object defined for the respective respective IO series or</span>
<span class="sd">        exchange item elements of the actual XML file.</span>

<span class="sd">        Property |XMLSelector.selections| of class |XMLSelector| falls back to the</span>
<span class="sd">        general property |XMLInterface.selections| of |XMLInterface| if the relevant IO</span>
<span class="sd">        series or exchange item element does not define a unique selection:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.examples import prepare_full_example_1</span>
<span class="sd">        &gt;&gt;&gt; prepare_full_example_1()</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import HydPy, pub, TestIO, XMLInterface</span>
<span class="sd">        &gt;&gt;&gt; hp = HydPy(&quot;LahnH&quot;)</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;1996-01-01&quot;, &quot;1996-01-06&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     hp.prepare_network()</span>
<span class="sd">        ...     hp.prepare_models()</span>
<span class="sd">        ...     interface = XMLInterface(&quot;single_run.xml&quot;)</span>
<span class="sd">        &gt;&gt;&gt; interface.update_selections()</span>
<span class="sd">        &gt;&gt;&gt; series_io = interface.series_io</span>
<span class="sd">        &gt;&gt;&gt; for seq in (series_io.readers + series_io.writers):</span>
<span class="sd">        ...     print(seq.info, seq.selections.names)</span>
<span class="sd">        all input data (&#39;from_keywords&#39;,)</span>
<span class="sd">        precipitation (&#39;headwaters&#39;, &#39;from_devices&#39;)</span>
<span class="sd">        soilmoisture (&#39;complete&#39;,)</span>
<span class="sd">        averaged (&#39;from_selections&#39;,)</span>

<span class="sd">        If property |XMLSelector.selections| does not find any definitions, it raises</span>
<span class="sd">        the following error:</span>

<span class="sd">        &gt;&gt;&gt; interface.root.remove(interface.find(&quot;selections&quot;))</span>
<span class="sd">        &gt;&gt;&gt; series_io = interface.series_io</span>
<span class="sd">        &gt;&gt;&gt; for seq in (series_io.readers + series_io.writers):</span>
<span class="sd">        ...     print(seq.info, seq.selections.names)</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        AttributeError: Unable to find a XML element named &quot;selections&quot;.  Please make \</span>
<span class="sd">sure your XML file follows the relevant XML schema.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">selections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;selections&quot;</span><span class="p">)</span>
        <span class="n">master</span><span class="p">:</span> <span class="n">XMLBase</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">while</span> <span class="n">selections</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">master</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">master</span><span class="p">,</span> <span class="s2">&quot;master&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">master</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                    <span class="s1">&#39;Unable to find a XML element named &quot;selections&quot;.  Please make &#39;</span>
                    <span class="s2">&quot;sure your XML file follows the relevant XML schema.&quot;</span>
                <span class="p">)</span>
            <span class="n">selections</span> <span class="o">=</span> <span class="n">master</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;selections&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_query_selections</span><span class="p">(</span><span class="n">selections</span><span class="p">)</span>

    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="nf">_get_devices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">devicetools</span><span class="o">.</span><span class="n">Node</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract all nodes.&quot;&quot;&quot;</span>

    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="nf">_get_devices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;elements&quot;</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">devicetools</span><span class="o">.</span><span class="n">Element</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract all elements.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_get_devices</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">,</span> <span class="s2">&quot;elements&quot;</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Iterator</span><span class="p">[</span><span class="n">devicetools</span><span class="o">.</span><span class="n">Node</span><span class="p">],</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">devicetools</span><span class="o">.</span><span class="n">Element</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract all nodes or elements.&quot;&quot;&quot;</span>
        <span class="n">selections</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">)</span>
        <span class="n">devices</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">selection</span> <span class="ow">in</span> <span class="n">selections</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">selection</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">device</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">:</span>
                    <span class="n">devices</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
                    <span class="k">yield</span> <span class="n">device</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">elements</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">devicetools</span><span class="o">.</span><span class="n">Element</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the |Element| objects selected by the actual IO series or exchange</span>
<span class="sd">        item element.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.examples import prepare_full_example_1</span>
<span class="sd">        &gt;&gt;&gt; prepare_full_example_1()</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import HydPy, TestIO, XMLInterface</span>
<span class="sd">        &gt;&gt;&gt; hp = HydPy(&quot;LahnH&quot;)</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     hp.prepare_network()</span>
<span class="sd">        ...     interface = XMLInterface(&quot;single_run.xml&quot;)</span>
<span class="sd">        &gt;&gt;&gt; interface.update_selections()</span>
<span class="sd">        &gt;&gt;&gt; for element in interface.series_io.writers[0].elements:</span>
<span class="sd">        ...     print(element.name)</span>
<span class="sd">        land_dill</span>
<span class="sd">        land_lahn_1</span>
<span class="sd">        land_lahn_2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_devices</span><span class="p">(</span><span class="s2">&quot;elements&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">devicetools</span><span class="o">.</span><span class="n">Node</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the |Node| objects selected by the actual IO series or exchange item</span>
<span class="sd">        element.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.examples import prepare_full_example_1</span>
<span class="sd">        &gt;&gt;&gt; prepare_full_example_1()</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import HydPy, TestIO, XMLInterface</span>
<span class="sd">        &gt;&gt;&gt; hp = HydPy(&quot;LahnH&quot;)</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     hp.prepare_network()</span>
<span class="sd">        ...     interface = XMLInterface(&quot;single_run.xml&quot;)</span>
<span class="sd">        &gt;&gt;&gt; interface.update_selections()</span>
<span class="sd">        &gt;&gt;&gt; for node in interface.series_io.writers[0].nodes:</span>
<span class="sd">        ...     print(node.name)</span>
<span class="sd">        dill</span>
<span class="sd">        lahn_1</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_devices</span><span class="p">(</span><span class="s2">&quot;nodes&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="XMLSubseries">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLSubseries">[docs]</a>
<span class="k">class</span> <span class="nc">XMLSubseries</span><span class="p">(</span><span class="n">XMLSelector</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper class for |XMLSeries| responsible for loading and saving time series</span>
<span class="sd">    data.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">master</span><span class="p">:</span> <span class="n">XMLSeries</span><span class="p">,</span> <span class="n">root</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="p">:</span> <span class="n">XMLSeries</span> <span class="o">=</span> <span class="n">master</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span> <span class="o">=</span> <span class="n">root</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Info attribute of the actual XML `reader` or `writer` element.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;info&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_is_reader</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;reader&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;writer&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">assert</span> <span class="kc">False</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_is_writer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_reader</span>

<div class="viewcode-block" id="XMLSubseries.prepare_sequencemanager">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLSubseries.prepare_sequencemanager">[docs]</a>
    <span class="k">def</span> <span class="nf">prepare_sequencemanager</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">currentdir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Configure the |SequenceManager| object available in module |pub| following</span>
<span class="sd">        the definitions of the actual XML `reader` or `writer` element when available;</span>
<span class="sd">        if not, use those of the XML `series_io` element or fall back to the default.</span>

<span class="sd">        Compare the following results with `single_run.xml` to see that the first</span>
<span class="sd">        `writer` element re-defines the default file type (`asc`), that the second</span>
<span class="sd">        `writer` element defines an alternative file type (`npy`), and that the third</span>
<span class="sd">        `writer` relies on the general file type.  The base mechanism is the same</span>
<span class="sd">        for other options, e.g. the aggregation mode.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.examples import prepare_full_example_1</span>
<span class="sd">        &gt;&gt;&gt; prepare_full_example_1()</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import HydPy, TestIO, XMLInterface, pub</span>
<span class="sd">        &gt;&gt;&gt; hp = HydPy(&quot;LahnH&quot;)</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     hp.prepare_network()</span>
<span class="sd">        ...     interface = XMLInterface(&quot;single_run.xml&quot;)</span>
<span class="sd">        &gt;&gt;&gt; series_io = interface.series_io</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     series_io.writers[0].prepare_sequencemanager()</span>
<span class="sd">        ...     pub.sequencemanager.currentdir</span>
<span class="sd">        &#39;default&#39;</span>
<span class="sd">        &gt;&gt;&gt; pub.sequencemanager.filetype</span>
<span class="sd">        &#39;asc&#39;</span>
<span class="sd">        &gt;&gt;&gt; pub.sequencemanager.overwrite</span>
<span class="sd">        1</span>
<span class="sd">        &gt;&gt;&gt; pub.sequencemanager.aggregation</span>
<span class="sd">        &#39;none&#39;</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     series_io.writers[1].prepare_sequencemanager()</span>
<span class="sd">        ...     pub.sequencemanager.currentdir</span>
<span class="sd">        &#39;soildata&#39;</span>
<span class="sd">        &gt;&gt;&gt; pub.sequencemanager.filetype</span>
<span class="sd">        &#39;nc&#39;</span>
<span class="sd">        &gt;&gt;&gt; pub.sequencemanager.overwrite</span>
<span class="sd">        0</span>
<span class="sd">        &gt;&gt;&gt; pub.sequencemanager.aggregation</span>
<span class="sd">        &#39;none&#39;</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     series_io.writers[2].prepare_sequencemanager()</span>
<span class="sd">        ...     pub.sequencemanager.currentdir</span>
<span class="sd">        &#39;averages&#39;</span>
<span class="sd">        &gt;&gt;&gt; pub.sequencemanager.filetype</span>
<span class="sd">        &#39;npy&#39;</span>
<span class="sd">        &gt;&gt;&gt; pub.sequencemanager.aggregation</span>
<span class="sd">        &#39;mean&#39;</span>
<span class="sd">        &gt;&gt;&gt; pub.sequencemanager.overwrite</span>
<span class="sd">        1</span>
<span class="sd">        &gt;&gt;&gt; pub.sequencemanager.aggregation</span>
<span class="sd">        &#39;mean&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sm</span> <span class="o">=</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">sequencemanager</span>
        <span class="k">if</span> <span class="n">currentdir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;directory&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">element</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;directory&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">element</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">sm</span><span class="o">.</span><span class="n">currentdir</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">element</span><span class="o">.</span><span class="n">text</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="n">sm</span><span class="o">.</span><span class="n">currentdir</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">text</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sm</span><span class="o">.</span><span class="n">currentdir</span> <span class="o">=</span> <span class="n">currentdir</span>

        <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;filetype&quot;</span><span class="p">,</span> <span class="s2">&quot;aggregation&quot;</span><span class="p">,</span> <span class="s2">&quot;overwrite&quot;</span><span class="p">):</span>
            <span class="nb">delattr</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">option</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">option</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">option</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">element</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="n">element</span><span class="o">.</span><span class="n">text</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="n">option</span> <span class="o">==</span> <span class="s2">&quot;overwrite&quot;</span><span class="p">:</span>
                        <span class="n">sm</span><span class="o">.</span><span class="n">overwrite</span> <span class="o">=</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">value2bool</span><span class="p">(</span><span class="n">option</span><span class="p">,</span> <span class="n">element</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">setattr</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">option</span><span class="p">,</span> <span class="n">element</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
                    <span class="k">break</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_ramflag</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A flag analoge to the |IOSequence.ramflag| of class |IOSequence|.&quot;&quot;&quot;</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;mode&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;mode&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">assert</span> <span class="n">mode</span><span class="o">.</span><span class="n">text</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">mode</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s2">&quot;ram&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">model2subs2seqs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DefaultDict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DefaultDict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A nested |collections.defaultdict| containing the model-specific information</span>
<span class="sd">        provided by the XML `sequences` element.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XMLInterface</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.data import make_filepath</span>
<span class="sd">        &gt;&gt;&gt; interface = XMLInterface(&quot;single_run.xml&quot;, make_filepath(&quot;LahnH&quot;))</span>
<span class="sd">        &gt;&gt;&gt; series_io = interface.series_io</span>
<span class="sd">        &gt;&gt;&gt; model2subs2seqs = series_io.writers[2].model2subs2seqs</span>
<span class="sd">        &gt;&gt;&gt; for model, subs2seqs in sorted(model2subs2seqs.items()):</span>
<span class="sd">        ...     for subs, seq in sorted(subs2seqs.items()):</span>
<span class="sd">        ...         print(model, subs, seq)</span>
<span class="sd">        hland_v1 factors [&#39;tc&#39;]</span>
<span class="sd">        hland_v1 fluxes [&#39;tf&#39;]</span>
<span class="sd">        hland_v1 states [&#39;sm&#39;]</span>
<span class="sd">        musk_classic states [&#39;discharge&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">model2subs2seqs</span><span class="p">:</span> <span class="n">DefaultDict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DefaultDict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span>
        <span class="n">model2subs2seqs</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;sequences&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="n">model_name</span> <span class="o">=</span> <span class="n">strip</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s2">&quot;node&quot;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">model</span><span class="p">:</span>
                <span class="n">group_name</span> <span class="o">=</span> <span class="n">strip</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">sequence</span> <span class="ow">in</span> <span class="n">group</span><span class="p">:</span>
                    <span class="n">seq_name</span> <span class="o">=</span> <span class="n">strip</span><span class="p">(</span><span class="n">sequence</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
                    <span class="n">model2subs2seqs</span><span class="p">[</span><span class="n">model_name</span><span class="p">][</span><span class="n">group_name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seq_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">model2subs2seqs</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">subs2seqs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A |collections.defaultdict| containing the node-specific information</span>
<span class="sd">        provided by XML `sequences` element.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XMLInterface</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.data import make_filepath</span>
<span class="sd">        &gt;&gt;&gt; interface = XMLInterface(&quot;single_run.xml&quot;, make_filepath(&quot;LahnH&quot;))</span>
<span class="sd">        &gt;&gt;&gt; series_io = interface.series_io</span>
<span class="sd">        &gt;&gt;&gt; subs2seqs = series_io.writers[2].subs2seqs</span>
<span class="sd">        &gt;&gt;&gt; for subs, seq in sorted(subs2seqs.items()):</span>
<span class="sd">        ...     print(subs, seq)</span>
<span class="sd">        node [&#39;sim&#39;, &#39;obs&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">subs2seqs</span><span class="p">:</span> <span class="n">DefaultDict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="n">find</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;sequences&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span> <span class="s2">&quot;node&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nodes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
                <span class="n">subs2seqs</span><span class="p">[</span><span class="s2">&quot;node&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">strip</span><span class="p">(</span><span class="n">seq</span><span class="o">.</span><span class="n">tag</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">subs2seqs</span>

    <span class="k">def</span> <span class="nf">_iterate_sequences</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">sequencetools</span><span class="o">.</span><span class="n">IOSequence</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_iterate_model_sequences</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iterate_node_sequences</span><span class="p">()</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_iterate_model_sequences</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">sequencetools</span><span class="o">.</span><span class="n">IOSequence</span><span class="p">]:</span>
        <span class="n">m2s2s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model2subs2seqs</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">model</span>
            <span class="k">for</span> <span class="n">subseqs_name</span><span class="p">,</span> <span class="n">seq_names</span> <span class="ow">in</span> <span class="n">m2s2s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">subseqs</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="p">,</span> <span class="n">subseqs_name</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">seq_name</span> <span class="ow">in</span> <span class="n">seq_names</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">subseqs</span><span class="p">,</span> <span class="n">seq_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_iterate_node_sequences</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">sequencetools</span><span class="o">.</span><span class="n">IOSequence</span><span class="p">]:</span>
        <span class="n">s2s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subs2seqs</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">seq_names</span> <span class="ow">in</span> <span class="n">s2s</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">seq_name</span> <span class="ow">in</span> <span class="n">seq_names</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">sequences</span><span class="p">,</span> <span class="n">seq_name</span><span class="p">)</span>

<div class="viewcode-block" id="XMLSubseries.prepare_series">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLSubseries.prepare_series">[docs]</a>
    <span class="k">def</span> <span class="nf">prepare_series</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call method |IOSequence.prepare_series| of class |IOSequence| for all</span>
<span class="sd">        sequences selected by the given element of the actual XML file.</span>

<span class="sd">        Method |IOSequence.prepare_series| solves a complex task, as it needs to</span>
<span class="sd">        determine the correct arguments for method |IOSequence.prepare_series| of class</span>
<span class="sd">        |IOSequence|.  Those arguments depend on whether the respective |XMLSubseries|</span>
<span class="sd">        element is for reading or writing data, addresses input or output sequences,</span>
<span class="sd">        and if one prefers to handle time-series data in RAM or read or write it &quot;just</span>
<span class="sd">        in time&quot; during model simulations.  Method |XMLSubseries.prepare_series|</span>
<span class="sd">        delegates some of the related logic to the |PrepareSeriesArguments.from_xmldata|</span>
<span class="sd">        method of class |PrepareSeriesArguments|.  The following examples demonstrate</span>
<span class="sd">        that method |XMLSubseries.prepare_series| implements the remaining logic</span>
<span class="sd">        correctly.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.examples import prepare_full_example_1</span>
<span class="sd">        &gt;&gt;&gt; prepare_full_example_1()</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import HydPy, pub, TestIO, XMLInterface</span>
<span class="sd">        &gt;&gt;&gt; hp = HydPy(&quot;LahnH&quot;)</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;1996-01-01&quot;, &quot;1996-01-06&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     hp.prepare_network()</span>
<span class="sd">        ...     hp.prepare_models()</span>
<span class="sd">        ...     interface = XMLInterface(&quot;single_run.xml&quot;)</span>
<span class="sd">        &gt;&gt;&gt; interface.update_timegrids()</span>
<span class="sd">        &gt;&gt;&gt; interface.update_selections()</span>

<span class="sd">        First, we check and discuss the proper setting of the properties</span>
<span class="sd">        |IOSequence.ramflag|, |IOSequence.diskflag_reading|, and</span>
<span class="sd">        |IOSequence.diskflag_writing| for the sequences defined in `single_run.xml`.</span>
<span class="sd">        First, we call |XMLSubseries.prepare_series| for available |XMLSubseries|</span>
<span class="sd">        objects:</span>

<span class="sd">        &gt;&gt;&gt; series_io = interface.series_io</span>
<span class="sd">        &gt;&gt;&gt; for reader in series_io.readers:</span>
<span class="sd">        ...     reader.prepare_series()</span>
<span class="sd">        &gt;&gt;&gt; for writer in series_io.writers:</span>
<span class="sd">        ...     writer.prepare_series()</span>

<span class="sd">        The following test function prints the options of the specified sequence of</span>
<span class="sd">        element &quot;Dill&quot;:</span>

<span class="sd">        &gt;&gt;&gt; def print_io_options(groupname, sequencename):</span>
<span class="sd">        ...     sequences = hp.elements.land_dill.model.sequences</span>
<span class="sd">        ...     sequence = sequences[groupname][sequencename]</span>
<span class="sd">        ...     print(f&quot;ramflag={sequence.ramflag}&quot;)</span>
<span class="sd">        ...     print(f&quot;diskflag_reading={sequence.diskflag_reading}&quot;)</span>
<span class="sd">        ...     print(f&quot;diskflag_writing={sequence.diskflag_writing}&quot;)</span>

<span class="sd">        The XML file uses the `jit` mode for all non-aggregated time series.  Reader</span>
<span class="sd">        elements handle input sequences and writer elements handle output sequences.</span>
<span class="sd">        Hence, |IOSequence.ramflag| is generally |False| while</span>
<span class="sd">        |IOSequence.diskflag_reading| is |True| for the input sequences and</span>
<span class="sd">        |IOSequence.diskflag_writing| is |True| for the output sequences:</span>

<span class="sd">        &gt;&gt;&gt; print_io_options(&quot;inputs&quot;, &quot;p&quot;)</span>
<span class="sd">        ramflag=False</span>
<span class="sd">        diskflag_reading=True</span>
<span class="sd">        diskflag_writing=False</span>

<span class="sd">        &gt;&gt;&gt; print_io_options(&quot;fluxes&quot;, &quot;pc&quot;)</span>
<span class="sd">        ramflag=False</span>
<span class="sd">        diskflag_reading=False</span>
<span class="sd">        diskflag_writing=True</span>

<span class="sd">        Currently, aggregation only works in combination with mode `ram`:</span>

<span class="sd">        &gt;&gt;&gt; print_io_options(&quot;factors&quot;, &quot;tc&quot;)</span>
<span class="sd">        ramflag=True</span>
<span class="sd">        diskflag_reading=False</span>
<span class="sd">        diskflag_writing=False</span>

<span class="sd">        For sequence |hland_states.SM|, two writers apply.  The writer &quot;soil moisture&quot;</span>
<span class="sd">        triggers writing the complete time-series &quot;just in time&quot; during the simulation</span>
<span class="sd">        run.  In contrast, the writer &quot;averaged&quot; initiates writing averaged time-series</span>
<span class="sd">        after the simulation run.  The configuration of sequence |hland_states.SM|</span>
<span class="sd">        reflects this, with both &quot;ram flag&quot; and &quot;disk flag writing&quot; being &quot;True&quot;:</span>

<span class="sd">        &gt;&gt;&gt; print_io_options(&quot;states&quot;, &quot;sm&quot;)</span>
<span class="sd">        ramflag=True</span>
<span class="sd">        diskflag_reading=False</span>
<span class="sd">        diskflag_writing=True</span>

<span class="sd">        We temporarily convert the single reader element to a writer element and apply</span>
<span class="sd">        method |XMLSubseries.prepare_series| again.  At first, this does not work, as</span>
<span class="sd">        the affected input sequences have previously been configured for &quot;just in time&quot;</span>
<span class="sd">        reading, which does not work in combination with &quot;just in time&quot; writing:</span>

<span class="sd">        &gt;&gt;&gt; reader = series_io.readers[0]</span>
<span class="sd">        &gt;&gt;&gt; reader.root.tag = reader.root.tag.replace(&quot;reader&quot;, &quot;writer&quot;)</span>
<span class="sd">        &gt;&gt;&gt; reader.prepare_series()</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        ValueError: Reading from and writing into the same NetCDF file &quot;just in time&quot; \</span>
<span class="sd">during a simulation run is not supported but tried for sequence `p` of element \</span>
<span class="sd">`land_dill`.</span>

<span class="sd">        After resetting all |InputSequence| objects and re-applying</span>
<span class="sd">        |XMLSubseries.prepare_series|, both |IOSequence.ramflag| and</span>
<span class="sd">        |IOSequence.diskflag_writing| are |True|.  This case is the only one where a</span>
<span class="sd">        single reader or writer enables two flags  (see the documentation on method</span>
<span class="sd">        |PrepareSeriesArguments.from_xmldata| for further information):</span>

<span class="sd">        &gt;&gt;&gt; hp.prepare_allseries(allocate_ram=False, jit=False)</span>
<span class="sd">        &gt;&gt;&gt; reader.prepare_series()</span>
<span class="sd">        &gt;&gt;&gt; reader.root.tag = reader.root.tag.replace(&quot;writer&quot;, &quot;reader&quot;)</span>
<span class="sd">        &gt;&gt;&gt; print_io_options(&quot;inputs&quot;, &quot;p&quot;)</span>
<span class="sd">        ramflag=True</span>
<span class="sd">        diskflag_reading=False</span>
<span class="sd">        diskflag_writing=True</span>

<span class="sd">        If we prefer the `ram` mode, things are more straightforward.  Then, option</span>
<span class="sd">        |IOSequence.ramflag| is |True|, and options |IOSequence.diskflag_reading| and</span>
<span class="sd">        |IOSequence.diskflag_writing| are |False| regardless of all other options:</span>

<span class="sd">        &gt;&gt;&gt; hp.prepare_allseries(allocate_ram=False, jit=False)</span>
<span class="sd">        &gt;&gt;&gt; series_io.find(&quot;mode&quot;).text = &quot;ram&quot;</span>
<span class="sd">        &gt;&gt;&gt; for reader in series_io.readers:</span>
<span class="sd">        ...     reader.find(&quot;mode&quot;).text = &quot;ram&quot;</span>
<span class="sd">        ...     reader.prepare_series()</span>
<span class="sd">        &gt;&gt;&gt; for writer in series_io.writers:</span>
<span class="sd">        ...     mode = writer.find(&quot;mode&quot;)</span>
<span class="sd">        ...     if mode is not None:</span>
<span class="sd">        ...         mode.text = &quot;ram&quot;</span>
<span class="sd">        ...     writer.prepare_series()</span>

<span class="sd">        &gt;&gt;&gt; print_io_options(&quot;inputs&quot;, &quot;p&quot;)</span>
<span class="sd">        ramflag=True</span>
<span class="sd">        diskflag_reading=False</span>
<span class="sd">        diskflag_writing=False</span>

<span class="sd">        &gt;&gt;&gt; print_io_options(&quot;fluxes&quot;, &quot;pc&quot;)</span>
<span class="sd">        ramflag=True</span>
<span class="sd">        diskflag_reading=False</span>
<span class="sd">        diskflag_writing=False</span>

<span class="sd">        &gt;&gt;&gt; print_io_options(&quot;states&quot;, &quot;sm&quot;)</span>
<span class="sd">        ramflag=True</span>
<span class="sd">        diskflag_reading=False</span>
<span class="sd">        diskflag_writing=False</span>

<span class="sd">        &gt;&gt;&gt; reader = series_io.readers[0]</span>
<span class="sd">        &gt;&gt;&gt; reader.root.tag = reader.root.tag.replace(&quot;reader&quot;, &quot;writer&quot;)</span>
<span class="sd">        &gt;&gt;&gt; reader.prepare_series()</span>
<span class="sd">        &gt;&gt;&gt; reader.root.tag = reader.root.tag.replace(&quot;writer&quot;, &quot;reader&quot;)</span>
<span class="sd">        &gt;&gt;&gt; print_io_options(&quot;inputs&quot;, &quot;p&quot;)</span>
<span class="sd">        ramflag=True</span>
<span class="sd">        diskflag_reading=False</span>
<span class="sd">        diskflag_writing=False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">input_args</span> <span class="o">=</span> <span class="n">PrepareSeriesArguments</span><span class="o">.</span><span class="n">from_xmldata</span><span class="p">(</span>
            <span class="n">is_reader</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_is_reader</span><span class="p">,</span> <span class="n">is_input</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">prefer_ram</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ramflag</span>
        <span class="p">)</span>
        <span class="n">output_args</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_writer</span><span class="p">:</span>
            <span class="n">output_args</span> <span class="o">=</span> <span class="n">PrepareSeriesArguments</span><span class="o">.</span><span class="n">from_xmldata</span><span class="p">(</span>
                <span class="n">is_reader</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">is_input</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">prefer_ram</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ramflag</span>
            <span class="p">)</span>
        <span class="n">input_types</span> <span class="o">=</span> <span class="p">(</span><span class="n">sequencetools</span><span class="o">.</span><span class="n">InputSequence</span><span class="p">,</span> <span class="n">sequencetools</span><span class="o">.</span><span class="n">NodeSequence</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">sequence</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iterate_sequences</span><span class="p">():</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">input_args</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">output_args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sequence</span><span class="p">,</span> <span class="n">input_types</span><span class="p">)</span>
                <span class="k">else</span> <span class="n">output_args</span>
            <span class="p">)</span>
            <span class="n">sequence</span><span class="o">.</span><span class="n">prepare_series</span><span class="p">(</span>
                <span class="n">allocate_ram</span><span class="o">=</span><span class="n">sequence</span><span class="o">.</span><span class="n">ramflag</span> <span class="ow">or</span> <span class="n">args</span><span class="o">.</span><span class="n">allocate_ram</span><span class="p">,</span>
                <span class="n">read_jit</span><span class="o">=</span><span class="n">sequence</span><span class="o">.</span><span class="n">diskflag_reading</span> <span class="ow">or</span> <span class="n">args</span><span class="o">.</span><span class="n">read_jit</span><span class="p">,</span>
                <span class="n">write_jit</span><span class="o">=</span><span class="n">sequence</span><span class="o">.</span><span class="n">diskflag_writing</span> <span class="ow">or</span> <span class="n">args</span><span class="o">.</span><span class="n">write_jit</span><span class="p">,</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="XMLSubseries.load_series">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLSubseries.load_series">[docs]</a>
    <span class="k">def</span> <span class="nf">load_series</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">currentdir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load time series data as defined by the actual XML `reader` element.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.examples import prepare_full_example_1</span>
<span class="sd">        &gt;&gt;&gt; prepare_full_example_1()</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import HydPy, pub, TestIO, xml_replace, XMLInterface</span>
<span class="sd">        &gt;&gt;&gt; hp = HydPy(&quot;LahnH&quot;)</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;1996-01-01&quot;, &quot;1996-01-06&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     hp.prepare_network()</span>
<span class="sd">        ...     hp.prepare_models()</span>
<span class="sd">        ...     xml_replace(&quot;LahnH/single_run&quot;, printflag=False)</span>
<span class="sd">        ...     interface = XMLInterface(&quot;single_run.xml&quot;)</span>
<span class="sd">        ...     interface.update_options()</span>
<span class="sd">        ...     interface.update_timegrids()</span>
<span class="sd">        ...     interface.update_selections()</span>
<span class="sd">        ...     series_io = interface.series_io</span>
<span class="sd">        ...     series_io.prepare_series()</span>
<span class="sd">        ...     series_io.load_series()</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import print_values</span>
<span class="sd">        &gt;&gt;&gt; print_values(hp.elements.land_dill.model.sequences.inputs.t.series[:3])</span>
<span class="sd">        -0.298846, -0.811539, -2.493848</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_reader</span><span class="p">:</span>
            <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">sequencemanager</span><span class="o">.</span><span class="n">open_netcdfreader</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prepare_sequencemanager</span><span class="p">(</span><span class="n">currentdir</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">sequence</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iterate_sequences</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">sequence</span><span class="o">.</span><span class="n">ramflag</span><span class="p">:</span>
                    <span class="n">sequence</span><span class="o">.</span><span class="n">load_series</span><span class="p">()</span>
            <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">sequencemanager</span><span class="o">.</span><span class="n">close_netcdfreader</span><span class="p">()</span></div>


<div class="viewcode-block" id="XMLSubseries.save_series">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLSubseries.save_series">[docs]</a>
    <span class="k">def</span> <span class="nf">save_series</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">currentdir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save time series data as defined by the actual XML `writer` element.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.examples import prepare_full_example_1</span>
<span class="sd">        &gt;&gt;&gt; prepare_full_example_1()</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import HydPy, pub, TestIO, xml_replace, XMLInterface</span>
<span class="sd">        &gt;&gt;&gt; hp = HydPy(&quot;LahnH&quot;)</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;1996-01-01&quot;, &quot;1996-01-06&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     hp.prepare_network()</span>
<span class="sd">        ...     hp.prepare_models()</span>
<span class="sd">        ...     xml_replace(&quot;LahnH/single_run&quot;, printflag=False)</span>
<span class="sd">        ...     interface = XMLInterface(&quot;single_run.xml&quot;)</span>
<span class="sd">        &gt;&gt;&gt; interface.update_options()</span>
<span class="sd">        &gt;&gt;&gt; interface.update_timegrids()</span>
<span class="sd">        &gt;&gt;&gt; interface.update_selections()</span>
<span class="sd">        &gt;&gt;&gt; series_io = interface.series_io</span>
<span class="sd">        &gt;&gt;&gt; series_io.prepare_series()</span>
<span class="sd">        &gt;&gt;&gt; hp.elements.land_dill.model.sequences.fluxes.pc.series[2, 3] = 9.0</span>
<span class="sd">        &gt;&gt;&gt; hp.nodes.lahn_2.sequences.sim.series[4] = 7.0</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     series_io.save_series()</span>
<span class="sd">        &gt;&gt;&gt; import numpy</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     os.path.exists(&quot;LahnH/series/default/land_lahn_2_flux_pc.npy&quot;)</span>
<span class="sd">        ...     os.path.exists(&quot;LahnH/series/default/land_lahn_3_flux_pc.npy&quot;)</span>
<span class="sd">        ...     numpy.load(&quot;LahnH/series/default/land_dill_flux_pc.npy&quot;)[13+2, 3]</span>
<span class="sd">        ...     numpy.load(&quot;LahnH/series/default/lahn_2_sim_q_mean.npy&quot;)[13+4]</span>
<span class="sd">        True</span>
<span class="sd">        False</span>
<span class="sd">        9.0</span>
<span class="sd">        7.0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;writer&quot;</span><span class="p">:</span>
            <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">sequencemanager</span><span class="o">.</span><span class="n">open_netcdfwriter</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prepare_sequencemanager</span><span class="p">(</span><span class="n">currentdir</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">sequence</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iterate_sequences</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">sequence</span><span class="o">.</span><span class="n">diskflag_writing</span><span class="p">:</span>
                    <span class="n">sequence</span><span class="o">.</span><span class="n">save_series</span><span class="p">()</span>
            <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">sequencemanager</span><span class="o">.</span><span class="n">close_netcdfwriter</span><span class="p">()</span></div>


<div class="viewcode-block" id="XMLSubseries.change_dirpath">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLSubseries.change_dirpath">[docs]</a>
    <span class="k">def</span> <span class="nf">change_dirpath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">currentdir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the |IOSequence.dirpath| of all relevant |IOSequence| objects to the</span>
<span class="sd">        |FileManager.currentpath| of the |SequenceManager| object available in the</span>
<span class="sd">        |pub| module.</span>

<span class="sd">        This &quot;information freezing&quot; is required for those sequences selected for</span>
<span class="sd">        reading data  from or writing data to different directories &quot;just in time&quot;</span>
<span class="sd">        during a simulation run.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ramflag</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prepare_sequencemanager</span><span class="p">(</span><span class="n">currentdir</span><span class="p">)</span>
            <span class="n">currentpath</span> <span class="o">=</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">sequencemanager</span><span class="o">.</span><span class="n">currentpath</span>
            <span class="k">for</span> <span class="n">sequence</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iterate_sequences</span><span class="p">():</span>
                <span class="n">sequence</span><span class="o">.</span><span class="n">dirpath</span> <span class="o">=</span> <span class="n">currentpath</span></div>


<div class="viewcode-block" id="XMLSubseries.reset_dirpath">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLSubseries.reset_dirpath">[docs]</a>
    <span class="k">def</span> <span class="nf">reset_dirpath</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Revert |XMLSubseries.change_dirpath|.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ramflag</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">sequence</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iterate_sequences</span><span class="p">():</span>
                <span class="k">del</span> <span class="n">sequence</span><span class="o">.</span><span class="n">dirpath</span></div>
</div>



<div class="viewcode-block" id="XMLExchange">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLExchange">[docs]</a>
<span class="k">class</span> <span class="nc">XMLExchange</span><span class="p">(</span><span class="n">XMLBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper class for |XMLInterface| responsible for interpreting exchange items,</span>
<span class="sd">    accessible via different |XMLItemgroup| instances.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">master</span><span class="p">:</span> <span class="n">XMLInterface</span><span class="p">,</span> <span class="n">root</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="p">:</span> <span class="n">XMLInterface</span> <span class="o">=</span> <span class="n">master</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span> <span class="o">=</span> <span class="n">root</span>

    <span class="k">def</span> <span class="nf">_get_items_of_certain_item_types</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">itemgroups</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">itemtype</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">_TypeGetOrChangeItem</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">_TypeGetOrChangeItem</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return either all |GetItem| or all |ChangeItem| objects.&quot;&quot;&quot;</span>
        <span class="n">items</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">_TypeGetOrChangeItem</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">itemgroup</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">itemgroups</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="nb">issubclass</span><span class="p">(</span><span class="n">itemtype</span><span class="p">,</span> <span class="n">itemtools</span><span class="o">.</span><span class="n">GetItem</span><span class="p">)</span>
                <span class="ow">and</span> <span class="p">(</span><span class="n">itemgroup</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;getitems&quot;</span><span class="p">)</span>
            <span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
                <span class="nb">issubclass</span><span class="p">(</span><span class="n">itemtype</span><span class="p">,</span> <span class="n">itemtools</span><span class="o">.</span><span class="n">ChangeItem</span><span class="p">)</span>
                <span class="ow">and</span> <span class="p">(</span><span class="n">itemgroup</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;getitems&quot;</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="p">(</span>
                    <span class="n">var</span>
                    <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">itemgroup</span><span class="o">.</span><span class="n">models</span>
                    <span class="k">for</span> <span class="n">subvars</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">subvars</span>
                    <span class="k">if</span> <span class="n">subvars</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">itemgroups</span>
                    <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">subvars</span><span class="o">.</span><span class="n">vars</span>
                <span class="p">):</span>
                    <span class="n">item</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">item</span>
                    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">itemtype</span><span class="p">)</span>
                    <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;nodes&quot;</span> <span class="ow">in</span> <span class="n">itemgroups</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="p">(</span><span class="n">var</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">itemgroup</span><span class="o">.</span><span class="n">nodes</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">vars</span><span class="p">):</span>
                        <span class="n">item</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">item</span>
                        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">itemtype</span><span class="p">)</span>
                        <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">items</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">parameteritems</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">itemtools</span><span class="o">.</span><span class="n">ChangeItem</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create and return all items for changing control parameter values.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.examples import prepare_full_example_1</span>
<span class="sd">        &gt;&gt;&gt; prepare_full_example_1()</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import HydPy, pub, TestIO, XMLInterface</span>
<span class="sd">        &gt;&gt;&gt; hp = HydPy(&quot;LahnH&quot;)</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;1996-01-01&quot;, &quot;1996-01-06&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     hp.prepare_everything()</span>
<span class="sd">        ...     interface = XMLInterface(&quot;multiple_runs.xml&quot;)</span>
<span class="sd">        &gt;&gt;&gt; interface.update_selections()</span>
<span class="sd">        &gt;&gt;&gt; for item in interface.exchange.parameteritems:</span>
<span class="sd">        ...     print(item.name)</span>
<span class="sd">        alpha</span>
<span class="sd">        beta</span>
<span class="sd">        lag</span>
<span class="sd">        damp</span>
<span class="sd">        sfcf_1</span>
<span class="sd">        sfcf_2</span>
<span class="sd">        sfcf_3</span>
<span class="sd">        k4</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_items_of_certain_item_types</span><span class="p">(</span>
            <span class="n">itemgroups</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;control&quot;</span><span class="p">,),</span> <span class="n">itemtype</span><span class="o">=</span><span class="n">itemtools</span><span class="o">.</span><span class="n">ChangeItem</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">inputitems</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">itemtools</span><span class="o">.</span><span class="n">SetItem</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return all items for changing input sequence values.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.examples import prepare_full_example_1</span>
<span class="sd">        &gt;&gt;&gt; prepare_full_example_1()</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import HydPy, pub, TestIO, XMLInterface</span>
<span class="sd">        &gt;&gt;&gt; hp = HydPy(&quot;LahnH&quot;)</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;1996-01-01&quot;, &quot;1996-01-06&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     hp.prepare_everything()</span>
<span class="sd">        ...     interface = XMLInterface(&quot;multiple_runs.xml&quot;)</span>
<span class="sd">        &gt;&gt;&gt; interface.update_selections()</span>
<span class="sd">        &gt;&gt;&gt; for item in interface.exchange.inputitems:</span>
<span class="sd">        ...     print(item.name)</span>
<span class="sd">        t_headwaters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_items_of_certain_item_types</span><span class="p">(</span>
            <span class="n">itemgroups</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;inputs&quot;</span><span class="p">,),</span> <span class="n">itemtype</span><span class="o">=</span><span class="n">itemtools</span><span class="o">.</span><span class="n">SetItem</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">conditionitems</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">itemtools</span><span class="o">.</span><span class="n">SetItem</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return all items for changing condition sequence values.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.examples import prepare_full_example_1</span>
<span class="sd">        &gt;&gt;&gt; prepare_full_example_1()</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import HydPy, pub, TestIO, XMLInterface</span>
<span class="sd">        &gt;&gt;&gt; hp = HydPy(&quot;LahnH&quot;)</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;1996-01-01&quot;, &quot;1996-01-06&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     hp.prepare_everything()</span>
<span class="sd">        ...     interface = XMLInterface(&quot;multiple_runs.xml&quot;)</span>
<span class="sd">        &gt;&gt;&gt; interface.update_selections()</span>
<span class="sd">        &gt;&gt;&gt; for item in interface.exchange.conditionitems:</span>
<span class="sd">        ...     print(item.name)</span>
<span class="sd">        ic_lahn_2</span>
<span class="sd">        ic_lahn_1</span>
<span class="sd">        sm_lahn_2</span>
<span class="sd">        sm_lahn_1</span>
<span class="sd">        quh</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_items_of_certain_item_types</span><span class="p">(</span>
            <span class="n">itemgroups</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;states&quot;</span><span class="p">,</span> <span class="s2">&quot;logs&quot;</span><span class="p">),</span> <span class="n">itemtype</span><span class="o">=</span><span class="n">itemtools</span><span class="o">.</span><span class="n">SetItem</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">outputitems</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">itemtools</span><span class="o">.</span><span class="n">SetItem</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return all items for querying the current values or the complete time</span>
<span class="sd">        series of sequences in the &quot;setitem&quot; style.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.examples import prepare_full_example_1</span>
<span class="sd">        &gt;&gt;&gt; prepare_full_example_1()</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import HydPy, pub, TestIO, XMLInterface</span>
<span class="sd">        &gt;&gt;&gt; hp = HydPy(&quot;LahnH&quot;)</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;1996-01-01&quot;, &quot;1996-01-06&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     hp.prepare_everything()</span>
<span class="sd">        ...     interface = XMLInterface(&quot;multiple_runs.xml&quot;)</span>
<span class="sd">        &gt;&gt;&gt; interface.update_selections()</span>
<span class="sd">        &gt;&gt;&gt; for item in interface.exchange.outputitems:</span>
<span class="sd">        ...     print(item.name)</span>
<span class="sd">        swe_headwaters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_items_of_certain_item_types</span><span class="p">(</span>
            <span class="n">itemgroups</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;factors&quot;</span><span class="p">,</span> <span class="s2">&quot;fluxes&quot;</span><span class="p">),</span> <span class="n">itemtype</span><span class="o">=</span><span class="n">itemtools</span><span class="o">.</span><span class="n">SetItem</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">getitems</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">itemtools</span><span class="o">.</span><span class="n">GetItem</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return all items for querying the current values or the complete time</span>
<span class="sd">        series of sequences in the &quot;getitem style&quot;.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.examples import prepare_full_example_1</span>
<span class="sd">        &gt;&gt;&gt; prepare_full_example_1()</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import HydPy, pub, TestIO, XMLInterface</span>
<span class="sd">        &gt;&gt;&gt; hp = HydPy(&quot;LahnH&quot;)</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;1996-01-01&quot;, &quot;1996-01-06&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     hp.prepare_everything()</span>
<span class="sd">        ...     interface = XMLInterface(&quot;multiple_runs.xml&quot;)</span>
<span class="sd">        &gt;&gt;&gt; interface.update_selections()</span>
<span class="sd">        &gt;&gt;&gt; for item in interface.exchange.getitems:</span>
<span class="sd">        ...     print(item.target)</span>
<span class="sd">        factors_tmean</span>
<span class="sd">        fluxes_qt</span>
<span class="sd">        fluxes_qt_series</span>
<span class="sd">        states_sm</span>
<span class="sd">        states_sm_series</span>
<span class="sd">        nodes_sim_series</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_items_of_certain_item_types</span><span class="p">(</span>
            <span class="n">itemgroups</span><span class="o">=</span><span class="p">(</span>
                <span class="s2">&quot;control&quot;</span><span class="p">,</span>
                <span class="s2">&quot;inputs&quot;</span><span class="p">,</span>
                <span class="s2">&quot;factors&quot;</span><span class="p">,</span>
                <span class="s2">&quot;fluxes&quot;</span><span class="p">,</span>
                <span class="s2">&quot;states&quot;</span><span class="p">,</span>
                <span class="s2">&quot;logs&quot;</span><span class="p">,</span>
                <span class="s2">&quot;nodes&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">itemtype</span><span class="o">=</span><span class="n">itemtools</span><span class="o">.</span><span class="n">GetItem</span><span class="p">,</span>
        <span class="p">)</span>

<div class="viewcode-block" id="XMLExchange.prepare_series">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLExchange.prepare_series">[docs]</a>
    <span class="k">def</span> <span class="nf">prepare_series</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Prepare all required |IOSequence.series| arrays via the</span>
<span class="sd">        |IOSequence.prepare_series| method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span>
                <span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">exceptiontools</span><span class="o">.</span><span class="n">AttributeNotReadyWarning</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">inputitems</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conditionitems</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputitems</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getitems</span>
            <span class="p">):</span>
                <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">device2target</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">targetspecs</span><span class="o">.</span><span class="n">series</span><span class="p">:</span>
                        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">sequencetools</span><span class="o">.</span><span class="n">IOSequence</span><span class="p">)</span>
                        <span class="n">target</span><span class="o">.</span><span class="n">prepare_series</span><span class="p">(</span>
                            <span class="n">allocate_ram</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">read_jit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">write_jit</span><span class="o">=</span><span class="kc">None</span>
                        <span class="p">)</span></div>

                    <span class="c1"># for base in getattr(item, &quot;device2base&quot;, {}).values():</span>
                    <span class="c1">#     if item.basespecs.series and not base.ramflag:</span>
                    <span class="c1">#         base.prepare_series()   ToDo</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">itemgroups</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">XMLItemgroup</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The relevant |XMLItemgroup| objects.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">XMLItemgroup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">)</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span></div>



<div class="viewcode-block" id="XMLItemgroup">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLItemgroup">[docs]</a>
<span class="k">class</span> <span class="nc">XMLItemgroup</span><span class="p">(</span><span class="n">XMLBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper class for |XMLExchange| responsible for handling the exchange items</span>
<span class="sd">    related to model parameters and sequences separately from the exchange items of</span>
<span class="sd">    node sequences.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">master</span><span class="p">:</span> <span class="n">XMLExchange</span><span class="p">,</span> <span class="n">root</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="p">:</span> <span class="n">XMLExchange</span> <span class="o">=</span> <span class="n">master</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span> <span class="o">=</span> <span class="n">root</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">models</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">XMLModel</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The required |XMLModel| objects.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">XMLModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">)</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">strip</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;nodes&quot;</span>
        <span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">XMLNode</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The required |XMLNode| objects.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">XMLNode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">)</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">strip</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;nodes&quot;</span>
        <span class="p">]</span></div>



<div class="viewcode-block" id="XMLModel">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLModel">[docs]</a>
<span class="k">class</span> <span class="nc">XMLModel</span><span class="p">(</span><span class="n">XMLBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper class for |XMLItemgroup| responsible for handling the exchange items</span>
<span class="sd">    related to different parameter or sequence groups of |Model| objects.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">master</span><span class="p">:</span> <span class="n">XMLItemgroup</span><span class="p">,</span> <span class="n">root</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="p">:</span> <span class="n">XMLItemgroup</span> <span class="o">=</span> <span class="n">master</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span> <span class="o">=</span> <span class="n">root</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">subvars</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">XMLSubvars</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The required |XMLSubVars| objects.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">XMLSubvars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">)</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span></div>



<div class="viewcode-block" id="XMLSubvars">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLSubvars">[docs]</a>
<span class="k">class</span> <span class="nc">XMLSubvars</span><span class="p">(</span><span class="n">XMLBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper class for |XMLModel| responsible for handling the exchange items</span>
<span class="sd">    related to individual parameters or sequences of |Model| objects.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">master</span><span class="p">:</span> <span class="n">XMLModel</span><span class="p">,</span> <span class="n">root</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="p">:</span> <span class="n">XMLModel</span> <span class="o">=</span> <span class="n">master</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span> <span class="o">=</span> <span class="n">root</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">XMLVar</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The required |XMLVar| objects.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">XMLVar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">)</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span></div>



<div class="viewcode-block" id="XMLNode">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLNode">[docs]</a>
<span class="k">class</span> <span class="nc">XMLNode</span><span class="p">(</span><span class="n">XMLBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper class for |XMLItemgroup| responsible for handling the exchange items</span>
<span class="sd">    related to individual parameters or sequences of |Node| objects.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">master</span><span class="p">:</span> <span class="n">XMLItemgroup</span><span class="p">,</span> <span class="n">root</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="p">:</span> <span class="n">XMLItemgroup</span> <span class="o">=</span> <span class="n">master</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span> <span class="o">=</span> <span class="n">root</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">XMLVar</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The required |XMLVar| objects.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">XMLVar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">)</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span></div>



<div class="viewcode-block" id="XMLVar">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XMLVar">[docs]</a>
<span class="k">class</span> <span class="nc">XMLVar</span><span class="p">(</span><span class="n">XMLSelector</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper class for |XMLSubvars| and |XMLNode| responsible for creating a defined</span>
<span class="sd">    exchange item.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">master</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">XMLSubvars</span><span class="p">,</span> <span class="n">XMLNode</span><span class="p">],</span> <span class="n">root</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">XMLSubvars</span><span class="p">,</span> <span class="n">XMLNode</span><span class="p">]</span> <span class="o">=</span> <span class="n">master</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span> <span class="o">=</span> <span class="n">root</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">item</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">itemtools</span><span class="o">.</span><span class="n">ExchangeItem</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The defined |ExchangeItem| object.</span>

<span class="sd">        We first prepare the `LahnH` example project and then create the related</span>
<span class="sd">        |XMLInterface| object defined by the XML configuration file `multiple_runs`:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.examples import prepare_full_example_1</span>
<span class="sd">        &gt;&gt;&gt; prepare_full_example_1()</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import HydPy, round_, pub, TestIO, XMLInterface</span>
<span class="sd">        &gt;&gt;&gt; hp = HydPy(&quot;LahnH&quot;)</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;1996-01-01&quot;, &quot;1996-01-06&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     hp.prepare_everything()</span>
<span class="sd">        ...     interface = XMLInterface(&quot;multiple_runs.xml&quot;)</span>
<span class="sd">        &gt;&gt;&gt; interface.update_selections()</span>

<span class="sd">        One of the defined |SetItem| objects modifies the values of all</span>
<span class="sd">        |hland_control.Alpha| objects of application model |hland_v1|.  We demonstrate</span>
<span class="sd">        this for the control parameter object handled by the `land_dill` element:</span>

<span class="sd">        &gt;&gt;&gt; var = interface.exchange.itemgroups[0].models[0].subvars[0].vars[0]</span>
<span class="sd">        &gt;&gt;&gt; item = var.item</span>
<span class="sd">        &gt;&gt;&gt; item.value</span>
<span class="sd">        array(2.)</span>
<span class="sd">        &gt;&gt;&gt; hp.elements.land_dill.model.parameters.control.alpha</span>
<span class="sd">        alpha(1.0)</span>
<span class="sd">        &gt;&gt;&gt; item.update_variables()</span>
<span class="sd">        &gt;&gt;&gt; hp.elements.land_dill.model.parameters.control.alpha</span>
<span class="sd">        alpha(2.0)</span>

<span class="sd">        The second example is comparable but focuses on a |SetItem| modifying control</span>
<span class="sd">        parameter |musk_control.NmbSegments| of application model |musk_classic| via</span>
<span class="sd">        its keyword argument `lag`:</span>

<span class="sd">        &gt;&gt;&gt; var = interface.exchange.itemgroups[0].models[2].subvars[0].vars[0]</span>
<span class="sd">        &gt;&gt;&gt; item = var.item</span>
<span class="sd">        &gt;&gt;&gt; item.value</span>
<span class="sd">        array(5.)</span>
<span class="sd">        &gt;&gt;&gt; hp.elements.stream_dill_lahn_2.model.parameters.control.nmbsegments</span>
<span class="sd">        nmbsegments(lag=0.0)</span>
<span class="sd">        &gt;&gt;&gt; item.update_variables()</span>
<span class="sd">        &gt;&gt;&gt; hp.elements.stream_dill_lahn_2.model.parameters.control.nmbsegments</span>
<span class="sd">        nmbsegments(lag=5.0)</span>

<span class="sd">        The third discussed |SetItem| assigns the same value to all entries of state</span>
<span class="sd">        sequence |hland_states.SM|, resulting in the same soil moisture for all</span>
<span class="sd">        individual hydrological response units of element `land_lahn_2`:</span>

<span class="sd">        &gt;&gt;&gt; var = interface.exchange.itemgroups[1].models[0].subvars[0].vars[2]</span>
<span class="sd">        &gt;&gt;&gt; item = var.item</span>
<span class="sd">        &gt;&gt;&gt; item.name</span>
<span class="sd">        &#39;sm_lahn_2&#39;</span>
<span class="sd">        &gt;&gt;&gt; item.value</span>
<span class="sd">        array([123.])</span>
<span class="sd">        &gt;&gt;&gt; hp.elements.land_lahn_2.model.sequences.states.sm</span>
<span class="sd">        sm(138.31396, 135.71124, 147.54968, 145.47142, 154.96405, 153.32805,</span>
<span class="sd">           160.91917, 159.62434, 165.65575, 164.63255)</span>
<span class="sd">        &gt;&gt;&gt; item.update_variables()</span>
<span class="sd">        &gt;&gt;&gt; hp.elements.land_lahn_2.model.sequences.states.sm</span>
<span class="sd">        sm(123.0, 123.0, 123.0, 123.0, 123.0, 123.0, 123.0, 123.0, 123.0, 123.0)</span>

<span class="sd">        In contrast to the last example, the fourth |SetItem| is 1-dimensional and thus</span>
<span class="sd">        allows to assign different values to the individual hydrological response units</span>
<span class="sd">        of element `land_lahn_1`:</span>

<span class="sd">        &gt;&gt;&gt; var = interface.exchange.itemgroups[1].models[0].subvars[0].vars[3]</span>
<span class="sd">        &gt;&gt;&gt; item = var.item</span>
<span class="sd">        &gt;&gt;&gt; item.name</span>
<span class="sd">        &#39;sm_lahn_1&#39;</span>
<span class="sd">        &gt;&gt;&gt; item.value</span>
<span class="sd">        array([110., 120., 130., 140., 150., 160., 170., 180., 190., 200., 210.,</span>
<span class="sd">               220., 230.])</span>
<span class="sd">        &gt;&gt;&gt; hp.elements.land_lahn_1.model.sequences.states.sm</span>
<span class="sd">        sm(99.27505, 96.17726, 109.16576, 106.39745, 117.97304, 115.56252,</span>
<span class="sd">           125.81523, 123.73198, 132.80035, 130.91684, 138.95523, 137.25983,</span>
<span class="sd">           142.84148)</span>
<span class="sd">        &gt;&gt;&gt; with pub.options.warntrim(False):</span>
<span class="sd">        ...     item.update_variables()</span>
<span class="sd">        &gt;&gt;&gt; hp.elements.land_lahn_1.model.sequences.states.sm</span>
<span class="sd">        sm(110.0, 120.0, 130.0, 140.0, 150.0, 160.0, 170.0, 180.0, 190.0, 200.0,</span>
<span class="sd">           206.0, 206.0, 206.0)</span>

<span class="sd">        Without defining initial values in the XML file, the |ChangeItem.value|</span>
<span class="sd">        property of each |SetItem| starts with the averaged (see item `ic_lahn_2`) or</span>
<span class="sd">        original (see item `ic_lahn_1`) values of the corresponding sequences:</span>

<span class="sd">        &gt;&gt;&gt; var = interface.exchange.itemgroups[1].models[0].subvars[0].vars[0]</span>
<span class="sd">        &gt;&gt;&gt; item = var.item</span>
<span class="sd">        &gt;&gt;&gt; item.name</span>
<span class="sd">        &#39;ic_lahn_2&#39;</span>
<span class="sd">        &gt;&gt;&gt; round_(item.value)</span>
<span class="sd">        1.184948</span>
<span class="sd">        &gt;&gt;&gt; round_(hp.elements.land_lahn_2.model.sequences.states.ic.average_values())</span>
<span class="sd">        1.184948</span>
<span class="sd">        &gt;&gt;&gt; var = interface.exchange.itemgroups[1].models[0].subvars[0].vars[1]</span>
<span class="sd">        &gt;&gt;&gt; item = var.item</span>
<span class="sd">        &gt;&gt;&gt; item.name</span>
<span class="sd">        &#39;ic_lahn_1&#39;</span>
<span class="sd">        &gt;&gt;&gt; item.value</span>
<span class="sd">        array([0.96404, 1.36332, 0.96458, 1.46458, 0.96512, 1.46512, 0.96565,</span>
<span class="sd">               1.46569, 0.96617, 1.46617, 0.96668, 1.46668, 1.46719])</span>
<span class="sd">        &gt;&gt;&gt; hp.elements.land_lahn_1.model.sequences.states.ic</span>
<span class="sd">        ic(0.96404, 1.36332, 0.96458, 1.46458, 0.96512, 1.46512, 0.96565,</span>
<span class="sd">           1.46569, 0.96617, 1.46617, 0.96668, 1.46668, 1.46719)</span>

<span class="sd">        Finally, one |SetItem| addresses the time series if the input sequence</span>
<span class="sd">        |hland_inputs.T| of both headwater catchments.  Similar to the example above,</span>
<span class="sd">        its initial values stem from its target sequences&#39; initial (time series)</span>
<span class="sd">        values:</span>

<span class="sd">        &gt;&gt;&gt; var = interface.exchange.itemgroups[2].models[0].subvars[0].vars[0]</span>
<span class="sd">        &gt;&gt;&gt; item = var.item</span>
<span class="sd">        &gt;&gt;&gt; item.value</span>
<span class="sd">        array([[-0.29884643, -0.81153886, -2.49384849, -5.96884868, -6.9996175 ],</span>
<span class="sd">               [-0.70539496, -1.50555283, -4.22126769, -7.44634946, -8.11936591]])</span>
<span class="sd">        &gt;&gt;&gt; hp.elements.land_dill.model.sequences.inputs.t.series</span>
<span class="sd">        InfoArray([-0.29884643, -0.81153886, -2.49384849, -5.96884868,</span>
<span class="sd">                   -6.9996175 ])</span>
<span class="sd">        &gt;&gt;&gt; hp.elements.land_lahn_1.model.sequences.inputs.t.series</span>
<span class="sd">        InfoArray([-0.70539496, -1.50555283, -4.22126769, -7.44634946,</span>
<span class="sd">                   -8.11936591])</span>
<span class="sd">        &gt;&gt;&gt; item.value = [0.0, 1.0, 2.0, 3.0, 4.0], [5.0, 6.0, 7.0, 8.0, 9.0]</span>
<span class="sd">        &gt;&gt;&gt; item.update_variables()</span>
<span class="sd">        &gt;&gt;&gt; hp.elements.land_dill.model.sequences.inputs.t.series</span>
<span class="sd">        InfoArray([0., 1., 2., 3., 4.])</span>
<span class="sd">        &gt;&gt;&gt; hp.elements.land_lahn_1.model.sequences.inputs.t.series</span>
<span class="sd">        InfoArray([5., 6., 7., 8., 9.])</span>

<span class="sd">        |AddItem| `sfcf_1`, `sfcf_2`, and `sfcf_3` serve to demonstrate how a scalar</span>
<span class="sd">        value (`sfcf_1` and `sfcf_2`) or a vector of values can be used to change the</span>
<span class="sd">        value of a &quot;target&quot; parameter (|hland_control.SfCF|) in relation to a &quot;base&quot;</span>
<span class="sd">        parameter (|hland_control.RfCF|):</span>

<span class="sd">        &gt;&gt;&gt; for element in pub.selections.headwaters.elements:</span>
<span class="sd">        ...     element.model.parameters.control.rfcf(1.1)</span>
<span class="sd">        &gt;&gt;&gt; for element in pub.selections.nonheadwaters.elements:</span>
<span class="sd">        ...     element.model.parameters.control.rfcf(1.0)</span>

<span class="sd">        &gt;&gt;&gt; for subvars in interface.exchange.itemgroups[3].models[0].subvars:</span>
<span class="sd">        ...     for var in subvars.vars:</span>
<span class="sd">        ...         var.item.update_variables()</span>
<span class="sd">        &gt;&gt;&gt; for element in hp.elements.catchment:</span>
<span class="sd">        ...     print(element, repr(element.model.parameters.control.sfcf))</span>
<span class="sd">        land_dill sfcf(1.4)</span>
<span class="sd">        land_lahn_1 sfcf(1.4)</span>
<span class="sd">        land_lahn_2 sfcf(1.2)</span>
<span class="sd">        land_lahn_3 sfcf(field=1.1, forest=1.2)</span>

<span class="sd">        |MultiplyItem| `k4` works similar to the described add items but multiplies</span>
<span class="sd">        the current values of the base parameter objects of type |hland_control.K|</span>
<span class="sd">        with 10 to gain new values for the target parameter objects of type</span>
<span class="sd">        |hland_control.K4|:</span>

<span class="sd">        &gt;&gt;&gt; for subvars in interface.exchange.itemgroups[4].models[0].subvars:</span>
<span class="sd">        ...     for var in subvars.vars:</span>
<span class="sd">        ...         var.item.update_variables()</span>
<span class="sd">        &gt;&gt;&gt; for element in hp.elements.catchment:</span>
<span class="sd">        ...     control = element.model.parameters.control</span>
<span class="sd">        ...     print(element, repr(control.k), repr(control.k4))</span>
<span class="sd">        land_dill k(0.005618) k4(0.056177)</span>
<span class="sd">        land_lahn_1 k(0.005325) k4(0.053247)</span>
<span class="sd">        land_lahn_2 k(0.005948) k4(0.059481)</span>
<span class="sd">        land_lahn_3 k(0.002571) k4(0.025712)</span>

<span class="sd">        The final three examples focus on |GetItem| objects.  One |GetItem| object</span>
<span class="sd">        queries the actual values of the |hland_states.SM| states of all relevant</span>
<span class="sd">        elements:</span>

<span class="sd">        &gt;&gt;&gt; var = interface.exchange.itemgroups[5].models[0].subvars[2].vars[0]</span>
<span class="sd">        &gt;&gt;&gt; hp.elements.land_dill.model.sequences.states.sm = 1.0</span>
<span class="sd">        &gt;&gt;&gt; for name, target in var.item.yield_name2value():</span>
<span class="sd">        ...     print(name, target)  # doctest: +ELLIPSIS</span>
<span class="sd">        land_dill_states_sm [1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0]</span>
<span class="sd">        land_lahn_1_states_sm [110.0, 120.0, 130.0, 140.0, 150.0, 160.0, 170.0, 180.0, \</span>
<span class="sd">190.0, 200.0, 206.0, 206.0, 206.0]</span>
<span class="sd">        land_lahn_2_states_sm [123.0, 123.0, 123.0, 123.0, 123.0, 123.0, 123.0, 123.0, \</span>
<span class="sd">123.0, 123.0]</span>
<span class="sd">        land_lahn_3_states_sm [101.3124...]</span>

<span class="sd">        Another |GetItem| object queries the actual value of the |hland_factors.TMean|</span>
<span class="sd">        factor sequence of element `land_dill`:</span>

<span class="sd">        &gt;&gt;&gt; hp.elements.land_dill.model.sequences.factors.tmean(1.0)</span>
<span class="sd">        &gt;&gt;&gt; for var in interface.exchange.itemgroups[5].models[0].subvars[0].vars:</span>
<span class="sd">        ...     for name, target in var.item.yield_name2value():</span>
<span class="sd">        ...         print(name, target)</span>
<span class="sd">        land_dill_factors_tmean 1.0</span>

<span class="sd">        Another |GetItem| object queries both the actual and the time series values of</span>
<span class="sd">        the |hland_fluxes.QT| flux sequence of element `land_dill`:</span>

<span class="sd">        &gt;&gt;&gt; qt = hp.elements.land_dill.model.sequences.fluxes.qt</span>
<span class="sd">        &gt;&gt;&gt; qt(1.0)</span>
<span class="sd">        &gt;&gt;&gt; qt.series = 2.0</span>
<span class="sd">        &gt;&gt;&gt; for var in interface.exchange.itemgroups[5].models[0].subvars[1].vars:</span>
<span class="sd">        ...     for name, target in var.item.yield_name2value():</span>
<span class="sd">        ...         print(name, target)</span>
<span class="sd">        land_dill_fluxes_qt 1.0</span>
<span class="sd">        land_dill_fluxes_qt_series [2.0, 2.0, 2.0, 2.0, 2.0]</span>

<span class="sd">        Last but not least, one |GetItem| queries the simulated time series values</span>
<span class="sd">        available through node `dill`:</span>

<span class="sd">        &gt;&gt;&gt; var = interface.exchange.itemgroups[5].nodes[0].vars[0]</span>
<span class="sd">        &gt;&gt;&gt; hp.nodes.dill.sequences.sim.series = range(5)</span>
<span class="sd">        &gt;&gt;&gt; for name, target in var.item.yield_name2value():</span>
<span class="sd">        ...     print(name, target)</span>
<span class="sd">        dill_nodes_sim_series [0.0, 1.0, 2.0, 3.0, 4.0]</span>
<span class="sd">        &gt;&gt;&gt; for name, target in var.item.yield_name2value(2, 4):</span>
<span class="sd">        ...     print(name, target)</span>
<span class="sd">        dill_nodes_sim_series [2.0, 3.0]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">target</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;nodes&quot;</span><span class="p">:</span>
            <span class="n">master</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">name</span>
            <span class="n">itemgroup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">master</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">name</span>
            <span class="n">itemgroup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">name</span>
        <span class="n">itemtype</span> <span class="o">=</span> <span class="n">_ITEMGROUP2ITEMCLASS</span><span class="p">[</span><span class="n">itemgroup</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">itemgroup</span> <span class="o">==</span> <span class="s2">&quot;getitems&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_getitem</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">master</span><span class="p">,</span> <span class="n">itemtype</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_changeitem</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">master</span><span class="p">,</span> <span class="n">itemtype</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_getitem</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">master</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">itemtype</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">itemtools</span><span class="o">.</span><span class="n">GetItem</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">itemtools</span><span class="o">.</span><span class="n">GetItem</span><span class="p">:</span>
        <span class="n">xmlelement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">xmlelement</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">xmlelement</span><span class="o">.</span><span class="n">text</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">Name</span><span class="p">,</span> <span class="s2">&quot;?&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">Name</span><span class="p">,</span> <span class="n">xmlelement</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">itemtype</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">master</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_collect_variables</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">item</span>

    <span class="k">def</span> <span class="nf">_get_changeitem</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">master</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">itemtype</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">_TypeSetOrAddOrMultiplyItem</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_TypeSetOrAddOrMultiplyItem</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">Name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;level&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
        <span class="k">assert</span> <span class="n">level</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">item</span><span class="p">:</span> <span class="n">_TypeSetOrAddOrMultiplyItem</span>
        <span class="c1"># Simplify the following if-clauses after Mypy issue 10989 is fixed?</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">itemtype</span><span class="p">,</span> <span class="n">itemtools</span><span class="o">.</span><span class="n">SetItem</span><span class="p">):</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">itemtype</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                <span class="n">master</span><span class="o">=</span><span class="n">master</span><span class="p">,</span>
                <span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span>
                <span class="n">base</span><span class="o">=</span><span class="n">strip</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tag</span><span class="p">),</span>
                <span class="n">level</span><span class="o">=</span><span class="n">cast</span><span class="p">(</span><span class="n">itemtools</span><span class="o">.</span><span class="n">LevelType</span><span class="p">,</span> <span class="n">level</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">itemtype</span><span class="p">,</span> <span class="p">(</span><span class="n">itemtools</span><span class="o">.</span><span class="n">AddItem</span><span class="p">,</span> <span class="n">itemtools</span><span class="o">.</span><span class="n">MultiplyItem</span><span class="p">)):</span>
            <span class="n">keyword</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;keyword&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">itemtype</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                <span class="n">master</span><span class="o">=</span><span class="n">master</span><span class="p">,</span>
                <span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span>
                <span class="n">keyword</span><span class="o">=</span><span class="kc">None</span> <span class="k">if</span> <span class="n">keyword</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">keyword</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
                <span class="n">level</span><span class="o">=</span><span class="n">cast</span><span class="p">(</span><span class="n">itemtools</span><span class="o">.</span><span class="n">LevelType</span><span class="p">,</span> <span class="n">level</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_collect_variables</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="n">element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;init&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">element</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">init</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">text</span>
            <span class="k">assert</span> <span class="n">init</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="n">item</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">init</span><span class="o">.</span><span class="n">split</span><span class="p">()))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">itemtools</span><span class="o">.</span><span class="n">SetItem</span><span class="p">)</span>
            <span class="n">item</span><span class="o">.</span><span class="n">extract_values</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">item</span>

    <span class="k">def</span> <span class="nf">_collect_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="n">itemtools</span><span class="o">.</span><span class="n">ExchangeItem</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">selections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selections</span>
        <span class="n">item</span><span class="o">.</span><span class="n">collect_variables</span><span class="p">(</span><span class="n">selections</span><span class="p">)</span></div>



<div class="viewcode-block" id="XSDWriter">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XSDWriter">[docs]</a>
<span class="k">class</span> <span class="nc">XSDWriter</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A pure |classmethod| class for writing the actual XML schema file</span>
<span class="sd">    `HydPyConfigBase.xsd`, which makes sure that an XML configuration file is</span>
<span class="sd">    readable by class |XMLInterface|.</span>

<span class="sd">    Unless you are interested in enhancing HydPy&#39;s XML functionalities, you should,</span>
<span class="sd">    if any, be interested in method |XSDWriter.write_xsd| only.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">confpath</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">__path__</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">filepath_source</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">confpath</span><span class="p">,</span> <span class="s2">&quot;HydPyConfigBase&quot;</span> <span class="o">+</span> <span class="s2">&quot;.xsdt&quot;</span><span class="p">)</span>
    <span class="n">filepath_target</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">filepath_source</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<div class="viewcode-block" id="XSDWriter.write_xsd">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XSDWriter.write_xsd">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">write_xsd</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write the complete base schema file `HydPyConfigBase.xsd` based on the</span>
<span class="sd">        template file `HydPyConfigBase.xsdt`.</span>

<span class="sd">        Method |XSDWriter.write_xsd| adds model-specific information to the general</span>
<span class="sd">        information of template file `HydPyConfigBase.xsdt` regarding reading and</span>
<span class="sd">        writing of time series data and exchanging parameter and sequence values, for</span>
<span class="sd">        example, during calibration.</span>

<span class="sd">        The following example shows that after writing a new schema file, method</span>
<span class="sd">        |XMLInterface.validate_xml| does not raise an error when either applied to the</span>
<span class="sd">        XML configuration files `single_run.xml` or `multiple_runs.xml` of the `LahnH`</span>
<span class="sd">        example project:</span>

<span class="sd">        &gt;&gt;&gt; import os</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XSDWriter, XMLInterface</span>
<span class="sd">        &gt;&gt;&gt; if os.path.exists(XSDWriter.filepath_target):</span>
<span class="sd">        ...     os.remove(XSDWriter.filepath_target)</span>
<span class="sd">        &gt;&gt;&gt; os.path.exists(XSDWriter.filepath_target)</span>
<span class="sd">        False</span>
<span class="sd">        &gt;&gt;&gt; XSDWriter.write_xsd()</span>
<span class="sd">        &gt;&gt;&gt; os.path.exists(XSDWriter.filepath_target)</span>
<span class="sd">        True</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.data import make_filepath</span>
<span class="sd">        &gt;&gt;&gt; for configfile in (&quot;single_run.xml&quot;, &quot;multiple_runs.xml&quot;):</span>
<span class="sd">        ...     XMLInterface(configfile, make_filepath(&quot;LahnH&quot;)).validate_xml()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">filepath_source</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">ENCODING</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_</span><span class="p">:</span>
            <span class="n">template</span> <span class="o">=</span> <span class="n">file_</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
            <span class="s2">&quot;&lt;!--include model sequence groups--&gt;&quot;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_insertion</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
            <span class="s2">&quot;&lt;!--include exchange items--&gt;&quot;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_exchangeinsertion</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">filepath_target</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">ENCODING</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_</span><span class="p">:</span>
            <span class="n">file_</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">template</span><span class="p">)</span></div>


<div class="viewcode-block" id="XSDWriter.get_basemodelnames">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XSDWriter.get_basemodelnames">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_basemodelnames</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a sorted |list| containing all base model names.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XSDWriter</span>
<span class="sd">        &gt;&gt;&gt; print(XSDWriter.get_basemodelnames())  # doctest: +ELLIPSIS</span>
<span class="sd">        [&#39;arma&#39;, &#39;conv&#39;, ..., &#39;wland&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">modelspath</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">__path__</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">def</span> <span class="nf">_is_basemodel</span><span class="p">(</span><span class="n">dirname</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
            <span class="n">pathname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">modelspath</span><span class="p">,</span> <span class="n">dirname</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">pathname</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;__init__.py&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">pathname</span><span class="p">))</span>

        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">dn</span> <span class="k">for</span> <span class="n">dn</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">modelspath</span><span class="p">)</span> <span class="k">if</span> <span class="n">_is_basemodel</span><span class="p">(</span><span class="n">dn</span><span class="p">))</span></div>


<div class="viewcode-block" id="XSDWriter.get_applicationmodelnames">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XSDWriter.get_applicationmodelnames">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_applicationmodelnames</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a sorted |list| containing all application model names.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XSDWriter</span>
<span class="sd">        &gt;&gt;&gt; print(XSDWriter.get_applicationmodelnames())  # doctest: +ELLIPSIS</span>
<span class="sd">        [...&#39;dam_v001&#39;, &#39;dam_v002&#39;, &#39;dam_v003&#39;, &#39;dam_v004&#39;, &#39;dam_v005&#39;,...]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">modelspath</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">__path__</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">fn</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">modelspath</span><span class="p">))</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">fn</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.py&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">fn</span> <span class="o">!=</span> <span class="s2">&quot;__init__.py&quot;</span><span class="p">))</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="XSDWriter.get_insertion">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XSDWriter.get_insertion">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_insertion</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the complete string to be inserted into the string of the template</span>
<span class="sd">        file.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XSDWriter</span>
<span class="sd">        &gt;&gt;&gt; print(XSDWriter.get_insertion())  # doctest: +ELLIPSIS</span>
<span class="sd">            &lt;complexType name=&quot;dam_v001_readerType&quot;&gt;</span>
<span class="sd">                &lt;sequence&gt;</span>
<span class="sd">                    &lt;element name=&quot;inputs&quot;</span>
<span class="sd">                             minOccurs=&quot;0&quot;&gt;</span>
<span class="sd">                        &lt;complexType&gt;</span>
<span class="sd">                            &lt;sequence&gt;</span>
<span class="sd">                                &lt;element</span>
<span class="sd">                                    name=&quot;precipitation&quot;</span>
<span class="sd">                                    minOccurs=&quot;0&quot;/&gt;</span>
<span class="sd">                                &lt;element</span>
<span class="sd">                                    name=&quot;evaporation&quot;</span>
<span class="sd">                                    minOccurs=&quot;0&quot;/&gt;</span>
<span class="sd">                            &lt;/sequence&gt;</span>
<span class="sd">                        &lt;/complexType&gt;</span>
<span class="sd">                    &lt;/element&gt;</span>
<span class="sd">                &lt;/sequence&gt;</span>
<span class="sd">            &lt;/complexType&gt;</span>
<span class="sd">        ...</span>
<span class="sd">            &lt;complexType name=&quot;readerType&quot;&gt;</span>
<span class="sd">                &lt;sequence&gt;</span>
<span class="sd">                    &lt;element name=&quot;node&quot;</span>
<span class="sd">                             type=&quot;hpcb:node_readerType&quot;</span>
<span class="sd">                             minOccurs=&quot;0&quot;/&gt;</span>
<span class="sd">                    &lt;element name=&quot;dam_v001&quot;</span>
<span class="sd">                             type=&quot;hpcb:dam_v001_readerType&quot;</span>
<span class="sd">                             minOccurs=&quot;0&quot;/&gt;</span>
<span class="sd">        ...</span>
<span class="sd">                    &lt;element name=&quot;wland_v002&quot;</span>
<span class="sd">                             type=&quot;hpcb:wland_v002_readerType&quot;</span>
<span class="sd">                             minOccurs=&quot;0&quot;/&gt;</span>
<span class="sd">                &lt;/sequence&gt;</span>
<span class="sd">            &lt;/complexType&gt;</span>
<span class="sd">        ...</span>
<span class="sd">            &lt;complexType name=&quot;arma_v1_writerType&quot;&gt;</span>
<span class="sd">                &lt;sequence&gt;</span>
<span class="sd">                    &lt;element name=&quot;fluxes&quot;</span>
<span class="sd">                             minOccurs=&quot;0&quot;&gt;</span>
<span class="sd">                        &lt;complexType&gt;</span>
<span class="sd">                            &lt;sequence&gt;</span>
<span class="sd">                                &lt;element</span>
<span class="sd">                                    name=&quot;qin&quot;</span>
<span class="sd">        ...</span>
<span class="sd">                                &lt;element</span>
<span class="sd">                                    name=&quot;qout&quot;</span>
<span class="sd">                                    minOccurs=&quot;0&quot;/&gt;</span>
<span class="sd">                            &lt;/sequence&gt;</span>
<span class="sd">                        &lt;/complexType&gt;</span>
<span class="sd">                    &lt;/element&gt;</span>
<span class="sd">                &lt;/sequence&gt;</span>
<span class="sd">            &lt;/complexType&gt;</span>
<span class="sd">        ...</span>
<span class="sd">            &lt;complexType name=&quot;writerType&quot;&gt;</span>
<span class="sd">                &lt;sequence&gt;</span>
<span class="sd">                    &lt;element name=&quot;node&quot;</span>
<span class="sd">                             type=&quot;hpcb:node_writerType&quot;</span>
<span class="sd">                             minOccurs=&quot;0&quot;/&gt;</span>
<span class="sd">                    &lt;element name=&quot;arma_v1&quot;</span>
<span class="sd">                             type=&quot;hpcb:arma_v1_writerType&quot;</span>
<span class="sd">                             minOccurs=&quot;0&quot;/&gt;</span>
<span class="sd">        ...</span>
<span class="sd">                    &lt;element name=&quot;wland_v002&quot;</span>
<span class="sd">                             type=&quot;hpcb:wland_v002_writerType&quot;</span>
<span class="sd">                             minOccurs=&quot;0&quot;/&gt;</span>
<span class="sd">                &lt;/sequence&gt;</span>
<span class="sd">            &lt;/complexType&gt;</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">indent</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">blanks</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">indent</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">subs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">types_</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;reader&quot;</span><span class="p">,</span> <span class="s2">&quot;writer&quot;</span><span class="p">],</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;reader&quot;</span><span class="p">,</span> <span class="s2">&quot;writer&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">type_</span> <span class="ow">in</span> <span class="n">types_</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_applicationmodelnames</span><span class="p">():</span>
                <span class="n">model</span> <span class="o">=</span> <span class="n">importtools</span><span class="o">.</span><span class="n">prepare_model</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="n">modelinsertion</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_modelinsertion</span><span class="p">(</span>
                    <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">type_</span><span class="o">=</span><span class="n">type_</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent</span> <span class="o">+</span> <span class="mi">2</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">modelinsertion</span><span class="p">:</span>
                    <span class="n">subs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                        <span class="p">[</span>
                            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">&lt;complexType name=&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">type_</span><span class="si">}</span><span class="s1">Type&quot;&gt;&#39;</span><span class="p">,</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">    &lt;sequence&gt;&quot;</span><span class="p">,</span>
                            <span class="n">modelinsertion</span><span class="p">,</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">    &lt;/sequence&gt;&quot;</span><span class="p">,</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">&lt;/complexType&gt;&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;&quot;</span><span class="p">,</span>
                        <span class="p">]</span>
                    <span class="p">)</span>
            <span class="n">subs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">get_readerwriterinsertion</span><span class="p">(</span><span class="n">type_</span><span class="o">=</span><span class="n">type_</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent</span><span class="p">))</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subs</span><span class="p">)</span></div>


<div class="viewcode-block" id="XSDWriter.get_modelinsertion">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XSDWriter.get_modelinsertion">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_modelinsertion</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">type_</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the insertion string required for the given application model.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XSDWriter</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import prepare_model</span>
<span class="sd">        &gt;&gt;&gt; model = prepare_model(&quot;hland_v1&quot;)</span>
<span class="sd">        &gt;&gt;&gt; print(XSDWriter.get_modelinsertion(</span>
<span class="sd">        ...     model=model, type_=&quot;reader&quot;, indent=1))  # doctest: +ELLIPSIS</span>
<span class="sd">            &lt;element name=&quot;inputs&quot;</span>
<span class="sd">                     minOccurs=&quot;0&quot;&gt;</span>
<span class="sd">                &lt;complexType&gt;</span>
<span class="sd">                    &lt;sequence&gt;</span>
<span class="sd">                        &lt;element</span>
<span class="sd">                            name=&quot;p&quot;</span>
<span class="sd">                            minOccurs=&quot;0&quot;/&gt;</span>
<span class="sd">        ...</span>
<span class="sd">                        &lt;element</span>
<span class="sd">                            name=&quot;epn&quot;</span>
<span class="sd">                            minOccurs=&quot;0&quot;/&gt;</span>
<span class="sd">                    &lt;/sequence&gt;</span>
<span class="sd">                &lt;/complexType&gt;</span>
<span class="sd">            &lt;/element&gt;</span>
<span class="sd">        &gt;&gt;&gt; print(XSDWriter.get_modelinsertion(</span>
<span class="sd">        ...     model=model, type_=&quot;writer&quot;, indent=1))  # doctest: +ELLIPSIS</span>
<span class="sd">            &lt;element name=&quot;inputs&quot;</span>
<span class="sd">                     minOccurs=&quot;0&quot;&gt;</span>
<span class="sd">                &lt;complexType&gt;</span>
<span class="sd">                    &lt;sequence&gt;</span>
<span class="sd">                        &lt;element</span>
<span class="sd">                            name=&quot;p&quot;</span>
<span class="sd">                            minOccurs=&quot;0&quot;/&gt;</span>
<span class="sd">        ...</span>
<span class="sd">            &lt;/element&gt;</span>
<span class="sd">            &lt;element name=&quot;fluxes&quot;</span>
<span class="sd">                     minOccurs=&quot;0&quot;&gt;</span>
<span class="sd">        ...</span>
<span class="sd">            &lt;/element&gt;</span>
<span class="sd">            &lt;element name=&quot;states&quot;</span>
<span class="sd">                     minOccurs=&quot;0&quot;&gt;</span>
<span class="sd">        ...</span>
<span class="sd">            &lt;/element&gt;</span>

<span class="sd">        &gt;&gt;&gt; model = prepare_model(&quot;arma_v1&quot;)</span>
<span class="sd">        &gt;&gt;&gt; XSDWriter.get_modelinsertion(</span>
<span class="sd">        ...     model=model, type_=&quot;reader&quot;, indent=1)  # doctest: +ELLIPSIS</span>
<span class="sd">        &gt;&gt;&gt; print(XSDWriter.get_modelinsertion(</span>
<span class="sd">        ...     model=model, type_=&quot;writer&quot;, indent=1))  # doctest: +ELLIPSIS</span>
<span class="sd">            &lt;element name=&quot;fluxes&quot;</span>
<span class="sd">                     minOccurs=&quot;0&quot;&gt;</span>
<span class="sd">                &lt;complexType&gt;</span>
<span class="sd">                    &lt;sequence&gt;</span>
<span class="sd">                        &lt;element</span>
<span class="sd">                            name=&quot;qin&quot;</span>
<span class="sd">                            minOccurs=&quot;0&quot;/&gt;</span>
<span class="sd">            ...</span>
<span class="sd">                        &lt;element</span>
<span class="sd">                            name=&quot;qout&quot;</span>
<span class="sd">                            minOccurs=&quot;0&quot;/&gt;</span>
<span class="sd">                    &lt;/sequence&gt;</span>
<span class="sd">                &lt;/complexType&gt;</span>
<span class="sd">            &lt;/element&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">names</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;inputs&quot;</span><span class="p">,)</span>
        <span class="k">if</span> <span class="n">type_</span> <span class="o">==</span> <span class="s2">&quot;writer&quot;</span><span class="p">:</span>
            <span class="n">names</span> <span class="o">+=</span> <span class="s2">&quot;factors&quot;</span><span class="p">,</span> <span class="s2">&quot;fluxes&quot;</span><span class="p">,</span> <span class="s2">&quot;states&quot;</span>
        <span class="n">texts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">return_none</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="n">subsequences</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">subsequences</span><span class="p">:</span>
                <span class="n">return_none</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">texts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">get_subsequencesinsertion</span><span class="p">(</span><span class="n">subsequences</span><span class="p">,</span> <span class="n">indent</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">return_none</span> <span class="k">else</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">texts</span><span class="p">)</span></div>


<div class="viewcode-block" id="XSDWriter.get_subsequencesinsertion">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XSDWriter.get_subsequencesinsertion">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_subsequencesinsertion</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">subsequences</span><span class="p">:</span> <span class="n">sequencetools</span><span class="o">.</span><span class="n">SubSequences</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the insertion string required for the given group of sequences.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XSDWriter</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import prepare_model</span>
<span class="sd">        &gt;&gt;&gt; model = prepare_model(&quot;hland_v1&quot;)</span>
<span class="sd">        &gt;&gt;&gt; print(XSDWriter.get_subsequencesinsertion(</span>
<span class="sd">        ...     model.sequences.factors, 1))  # doctest: +ELLIPSIS</span>
<span class="sd">            &lt;element name=&quot;factors&quot;</span>
<span class="sd">                     minOccurs=&quot;0&quot;&gt;</span>
<span class="sd">                &lt;complexType&gt;</span>
<span class="sd">                    &lt;sequence&gt;</span>
<span class="sd">                        &lt;element</span>
<span class="sd">                            name=&quot;tmean&quot;</span>
<span class="sd">                            minOccurs=&quot;0&quot;/&gt;</span>
<span class="sd">                        &lt;element</span>
<span class="sd">                            name=&quot;tc&quot;</span>
<span class="sd">                            minOccurs=&quot;0&quot;/&gt;</span>
<span class="sd">        ...</span>
<span class="sd">                        &lt;element</span>
<span class="sd">                            name=&quot;contriarea&quot;</span>
<span class="sd">                            minOccurs=&quot;0&quot;/&gt;</span>
<span class="sd">                    &lt;/sequence&gt;</span>
<span class="sd">                &lt;/complexType&gt;</span>
<span class="sd">            &lt;/element&gt;</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">blanks</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">indent</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">&lt;element name=&quot;</span><span class="si">{</span><span class="n">subsequences</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">         minOccurs=&quot;0&quot;&gt;&#39;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">    &lt;complexType&gt;&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">        &lt;sequence&gt;&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">sequence</span> <span class="ow">in</span> <span class="n">subsequences</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">get_sequenceinsertion</span><span class="p">(</span><span class="n">sequence</span><span class="p">,</span> <span class="n">indent</span> <span class="o">+</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">        &lt;/sequence&gt;&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">    &lt;/complexType&gt;&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">&lt;/element&gt;&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span></div>


<div class="viewcode-block" id="XSDWriter.get_sequenceinsertion">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XSDWriter.get_sequenceinsertion">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_sequenceinsertion</span><span class="p">(</span>
        <span class="n">sequence</span><span class="p">:</span> <span class="n">sequencetools</span><span class="o">.</span><span class="n">Sequence_</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the insertion string required for the given sequence.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XSDWriter</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import prepare_model</span>
<span class="sd">        &gt;&gt;&gt; model = prepare_model(&quot;hland_v1&quot;)</span>
<span class="sd">        &gt;&gt;&gt; print(XSDWriter.get_sequenceinsertion(model.sequences.fluxes.pc, 1))</span>
<span class="sd">            &lt;element</span>
<span class="sd">                name=&quot;pc&quot;</span>
<span class="sd">                minOccurs=&quot;0&quot;/&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">blanks</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">indent</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">&lt;element</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">    name=&quot;</span><span class="si">{</span><span class="n">sequence</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&quot;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">    minOccurs=&quot;0&quot;/&gt;&#39;</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="XSDWriter.get_readerwriterinsertion">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XSDWriter.get_readerwriterinsertion">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_readerwriterinsertion</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">type_</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;reader&quot;</span><span class="p">,</span> <span class="s2">&quot;writer&quot;</span><span class="p">],</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the insertion all sequences relevant for reading or writing</span>
<span class="sd">        time-series data.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XSDWriter</span>
<span class="sd">        &gt;&gt;&gt; print(XSDWriter.get_readerwriterinsertion(&quot;reader&quot;, 1)) # doctest: +ELLIPSIS</span>
<span class="sd">            &lt;complexType name=&quot;readerType&quot;&gt;</span>
<span class="sd">                &lt;sequence&gt;</span>
<span class="sd">                    &lt;element name=&quot;node&quot;</span>
<span class="sd">                             type=&quot;hpcb:node_readerType&quot;</span>
<span class="sd">                             minOccurs=&quot;0&quot;/&gt;</span>
<span class="sd">                    &lt;element name=&quot;dam_v001&quot;</span>
<span class="sd">                             type=&quot;hpcb:dam_v001_readerType&quot;</span>
<span class="sd">                             minOccurs=&quot;0&quot;/&gt;</span>
<span class="sd">        ...</span>
<span class="sd">                    &lt;element name=&quot;wland_v002&quot;</span>
<span class="sd">                             type=&quot;hpcb:wland_v002_readerType&quot;</span>
<span class="sd">                             minOccurs=&quot;0&quot;/&gt;</span>
<span class="sd">                &lt;/sequence&gt;</span>
<span class="sd">            &lt;/complexType&gt;</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">        &gt;&gt;&gt; print(XSDWriter.get_readerwriterinsertion(&quot;writer&quot;, 1)) # doctest: +ELLIPSIS</span>
<span class="sd">            &lt;complexType name=&quot;writerType&quot;&gt;</span>
<span class="sd">                &lt;sequence&gt;</span>
<span class="sd">                    &lt;element name=&quot;node&quot;</span>
<span class="sd">                             type=&quot;hpcb:node_writerType&quot;</span>
<span class="sd">                             minOccurs=&quot;0&quot;/&gt;</span>
<span class="sd">                    &lt;element name=&quot;arma_v1&quot;</span>
<span class="sd">                             type=&quot;hpcb:arma_v1_writerType&quot;</span>
<span class="sd">                             minOccurs=&quot;0&quot;/&gt;</span>
<span class="sd">        ...</span>
<span class="sd">                    &lt;element name=&quot;wland_v002&quot;</span>
<span class="sd">                             type=&quot;hpcb:wland_v002_writerType&quot;</span>
<span class="sd">                             minOccurs=&quot;0&quot;/&gt;</span>
<span class="sd">                &lt;/sequence&gt;</span>
<span class="sd">            &lt;/complexType&gt;</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">blanks</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">indent</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">subs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">&lt;complexType name=&quot;</span><span class="si">{</span><span class="n">type_</span><span class="si">}</span><span class="s1">Type&quot;&gt;&#39;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">    &lt;sequence&gt;&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">        &lt;element name=&quot;node&quot;&#39;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">                 type=&quot;hpcb:node_</span><span class="si">{</span><span class="n">type_</span><span class="si">}</span><span class="s1">Type&quot;&#39;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">                 minOccurs=&quot;0&quot;/&gt;&#39;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_applicationmodelnames</span><span class="p">():</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">type_</span> <span class="o">==</span> <span class="s2">&quot;writer&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">importtools</span><span class="o">.</span><span class="n">prepare_model</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
                <span class="n">subs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">        &lt;element name=&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">                 type=&quot;hpcb:</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">type_</span><span class="si">}</span><span class="s1">Type&quot;&#39;</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">                 minOccurs=&quot;0&quot;/&gt;&#39;</span><span class="p">,</span>
                    <span class="p">]</span>
                <span class="p">)</span>
        <span class="n">subs</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">    &lt;/sequence&gt;&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">&lt;/complexType&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subs</span><span class="p">)</span></div>


<div class="viewcode-block" id="XSDWriter.get_exchangeinsertion">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XSDWriter.get_exchangeinsertion">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_exchangeinsertion</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the complete string related to the definition of exchange items to</span>
<span class="sd">        be inserted into the string of the template file.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XSDWriter</span>
<span class="sd">        &gt;&gt;&gt; print(XSDWriter.get_exchangeinsertion())  # doctest: +ELLIPSIS</span>
<span class="sd">            &lt;complexType name=&quot;arma_v1_mathitemType&quot;&gt;</span>
<span class="sd">        ...</span>
<span class="sd">            &lt;element name=&quot;setitems&quot;&gt;</span>
<span class="sd">        ...</span>
<span class="sd">            &lt;complexType name=&quot;arma_v1_setitemsType&quot;&gt;</span>
<span class="sd">        ...</span>
<span class="sd">            &lt;element name=&quot;additems&quot;&gt;</span>
<span class="sd">        ...</span>
<span class="sd">            &lt;element name=&quot;multiplyitems&quot;&gt;</span>
<span class="sd">        ...</span>
<span class="sd">            &lt;element name=&quot;getitems&quot;&gt;</span>
<span class="sd">        ...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">indent</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">subs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">get_mathitemsinsertion</span><span class="p">(</span><span class="n">indent</span><span class="p">),</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">get_keyworditemsinsertion</span><span class="p">(</span><span class="n">indent</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">groupname</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;setitems&quot;</span><span class="p">,</span> <span class="s2">&quot;additems&quot;</span><span class="p">,</span> <span class="s2">&quot;multiplyitems&quot;</span><span class="p">,</span> <span class="s2">&quot;getitems&quot;</span><span class="p">):</span>
            <span class="n">subs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">get_itemsinsertion</span><span class="p">(</span><span class="n">groupname</span><span class="p">,</span> <span class="n">indent</span><span class="p">))</span>
            <span class="n">subs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">get_itemtypesinsertion</span><span class="p">(</span><span class="n">groupname</span><span class="p">,</span> <span class="n">indent</span><span class="p">))</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subs</span><span class="p">)</span></div>


<div class="viewcode-block" id="XSDWriter.get_mathitemsinsertion">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XSDWriter.get_mathitemsinsertion">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_mathitemsinsertion</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a string defining a model-specific XML type extending `ItemType`.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XSDWriter</span>
<span class="sd">        &gt;&gt;&gt; print(XSDWriter.get_mathitemsinsertion(1))  # doctest: +ELLIPSIS</span>
<span class="sd">            &lt;complexType name=&quot;arma_v1_mathitemType&quot;&gt;</span>
<span class="sd">                &lt;complexContent&gt;</span>
<span class="sd">                    &lt;extension base=&quot;hpcb:mathitemType&quot;&gt;</span>
<span class="sd">                        &lt;choice&gt;</span>
<span class="sd">                            &lt;element name=&quot;control.responses&quot;/&gt;</span>
<span class="sd">        ...</span>
<span class="sd">                            &lt;element name=&quot;fluxes.qout&quot;/&gt;</span>
<span class="sd">                        &lt;/choice&gt;</span>
<span class="sd">                    &lt;/extension&gt;</span>
<span class="sd">                &lt;/complexContent&gt;</span>
<span class="sd">            &lt;/complexType&gt;</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">            &lt;complexType name=&quot;conv_v001_mathitemType&quot;&gt;</span>
<span class="sd">        ...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">blanks</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">indent</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">subs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">modelname</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_applicationmodelnames</span><span class="p">():</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">importtools</span><span class="o">.</span><span class="n">prepare_model</span><span class="p">(</span><span class="n">modelname</span><span class="p">)</span>
            <span class="n">subs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">&lt;complexType name=&quot;</span><span class="si">{</span><span class="n">modelname</span><span class="si">}</span><span class="s1">_mathitemType&quot;&gt;&#39;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">    &lt;complexContent&gt;&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">        &lt;extension base=&quot;hpcb:mathitemType&quot;&gt;&#39;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">            &lt;choice&gt;&quot;</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">subvars</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_subvars</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">conditions</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">subvars</span><span class="p">:</span>
                    <span class="n">subs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">                &quot;</span>
                        <span class="sa">f</span><span class="s1">&#39;&lt;element name=&quot;</span><span class="si">{</span><span class="n">subvars</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&quot;/&gt;&#39;</span>
                    <span class="p">)</span>
            <span class="n">subs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">            &lt;/choice&gt;&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">        &lt;/extension&gt;&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">    &lt;/complexContent&gt;&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">&lt;/complexType&gt;&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subs</span><span class="p">)</span></div>


<div class="viewcode-block" id="XSDWriter.get_keyworditemsinsertion">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XSDWriter.get_keyworditemsinsertion">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_keyworditemsinsertion</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a string defining additional types that support modifying parameter</span>
<span class="sd">        values by specific keyword arguments.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XSDWriter</span>
<span class="sd">        &gt;&gt;&gt; print(XSDWriter.get_keyworditemsinsertion(1))  # doctest: +ELLIPSIS</span>
<span class="sd">            &lt;simpleType name=&quot;musk_control_nmbsegments_keywordType&quot;&gt;</span>
<span class="sd">                &lt;restriction base=&quot;string&quot;&gt;</span>
<span class="sd">                    &lt;enumeration value=&quot;lag&quot;/&gt;</span>
<span class="sd">                &lt;/restriction&gt;</span>
<span class="sd">            &lt;/simpleType&gt;</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">            &lt;complexType name=&quot;musk_control_nmbsegments_setitemType&quot;&gt;</span>
<span class="sd">                &lt;complexContent&gt;</span>
<span class="sd">                    &lt;extension base=&quot;hpcb:setitemType&quot;&gt;</span>
<span class="sd">                        &lt;sequence&gt;</span>
<span class="sd">                            &lt;element name=&quot;keyword&quot;</span>
<span class="sd">                                     type=&quot;hpcb:musk_control_nmbsegments_keywordType&quot;</span>
<span class="sd">                                     minOccurs = &quot;0&quot;/&gt;</span>
<span class="sd">                        &lt;/sequence&gt;</span>
<span class="sd">                    &lt;/extension&gt;</span>
<span class="sd">                &lt;/complexContent&gt;</span>
<span class="sd">            &lt;/complexType&gt;</span>
<span class="sd">        ...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">blanks</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">indent</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">subs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">modelname</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_basemodelnames</span><span class="p">():</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">importtools</span><span class="o">.</span><span class="n">prepare_model</span><span class="p">(</span><span class="n">modelname</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">subvars</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_subvars</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">conditions</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">subvars</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">parametertools</span><span class="o">.</span><span class="n">Parameter</span><span class="p">)</span> <span class="ow">and</span> <span class="n">var</span><span class="o">.</span><span class="n">KEYWORDS</span><span class="p">:</span>
                        <span class="n">prefix</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">modelname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">subvars</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_&quot;</span>
                        <span class="n">subs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                            <span class="p">[</span>
                                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">&lt;simpleType name=&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s1">keywordType&quot;&gt;&#39;</span><span class="p">,</span>
                                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">    &lt;restriction base=&quot;string&quot;&gt;&#39;</span><span class="p">,</span>
                            <span class="p">]</span>
                        <span class="p">)</span>
                        <span class="k">for</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="n">var</span><span class="o">.</span><span class="n">KEYWORDS</span><span class="p">:</span>
                            <span class="n">subs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">        &lt;enumeration value=&quot;</span><span class="si">{</span><span class="n">keyword</span><span class="si">}</span><span class="s1">&quot;/&gt;&#39;</span>
                            <span class="p">)</span>
                        <span class="n">subs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                            <span class="p">[</span>
                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">    &lt;/restriction&gt;&quot;</span><span class="p">,</span>
                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">&lt;/simpleType&gt;&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;&quot;</span><span class="p">,</span>
                                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">&lt;complexType name=&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s1">setitemType&quot;&gt;&#39;</span><span class="p">,</span>
                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">    &lt;complexContent&gt;&quot;</span><span class="p">,</span>
                                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">        &lt;extension base=&quot;hpcb:setitemType&quot;&gt;&#39;</span><span class="p">,</span>
                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">            &lt;sequence&gt;&quot;</span><span class="p">,</span>
                                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">                &lt;element name=&quot;keyword&quot;&#39;</span><span class="p">,</span>
                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">                         &quot;</span>
                                <span class="sa">f</span><span class="s1">&#39;type=&quot;hpcb:</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s1">keywordType&quot;&#39;</span><span class="p">,</span>
                                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">                         minOccurs = &quot;0&quot;/&gt;&#39;</span><span class="p">,</span>
                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">            &lt;/sequence&gt;&quot;</span><span class="p">,</span>
                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">        &lt;/extension&gt;&quot;</span><span class="p">,</span>
                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">    &lt;/complexContent&gt;&quot;</span><span class="p">,</span>
                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">&lt;/complexType&gt;&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;&quot;</span><span class="p">,</span>
                            <span class="p">]</span>
                        <span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subs</span><span class="p">)</span></div>


    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_itemstype</span><span class="p">(</span><span class="n">modelname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">itemgroup</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">modelname</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">itemgroup</span><span class="si">}</span><span class="s2">Type&quot;</span>

<div class="viewcode-block" id="XSDWriter.get_itemsinsertion">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XSDWriter.get_itemsinsertion">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_itemsinsertion</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">itemgroup</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a string defining the XML element for the given exchange item group.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XSDWriter</span>
<span class="sd">        &gt;&gt;&gt; print(XSDWriter.get_itemsinsertion(&quot;setitems&quot;, 1))  # doctest: +ELLIPSIS</span>
<span class="sd">            &lt;element name=&quot;setitems&quot;&gt;</span>
<span class="sd">                &lt;complexType&gt;</span>
<span class="sd">                    &lt;sequence&gt;</span>
<span class="sd">                        &lt;element ref=&quot;hpcb:selections&quot;</span>
<span class="sd">                                 minOccurs=&quot;0&quot;/&gt;</span>
<span class="sd">        ...</span>
<span class="sd">                        &lt;element name=&quot;hland_v1&quot;</span>
<span class="sd">                                 type=&quot;hpcb:hland_v1_setitemsType&quot;</span>
<span class="sd">                                 minOccurs=&quot;0&quot;</span>
<span class="sd">                                 maxOccurs=&quot;unbounded&quot;/&gt;</span>
<span class="sd">        ...</span>
<span class="sd">                        &lt;element name=&quot;nodes&quot;</span>
<span class="sd">                                 type=&quot;hpcb:nodes_setitemsType&quot;</span>
<span class="sd">                                 minOccurs=&quot;0&quot;</span>
<span class="sd">                                 maxOccurs=&quot;unbounded&quot;/&gt;</span>
<span class="sd">                    &lt;/sequence&gt;</span>
<span class="sd">                    &lt;attribute name=&quot;info&quot; type=&quot;string&quot;/&gt;</span>
<span class="sd">                &lt;/complexType&gt;</span>
<span class="sd">            &lt;/element&gt;</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">blanks</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">indent</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">subs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">subs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">&lt;element name=&quot;</span><span class="si">{</span><span class="n">itemgroup</span><span class="si">}</span><span class="s1">&quot;&gt;&#39;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">    &lt;complexType&gt;&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">        &lt;sequence&gt;&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">            &lt;element ref=&quot;hpcb:selections&quot;&#39;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">                     minOccurs=&quot;0&quot;/&gt;&#39;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">modelname</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_applicationmodelnames</span><span class="p">():</span>
            <span class="n">type_</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_itemstype</span><span class="p">(</span><span class="n">modelname</span><span class="p">,</span> <span class="n">itemgroup</span><span class="p">)</span>
            <span class="n">subs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">            &lt;element name=&quot;</span><span class="si">{</span><span class="n">modelname</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
            <span class="n">subs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">                     type=&quot;hpcb:</span><span class="si">{</span><span class="n">type_</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
            <span class="n">subs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">                     minOccurs=&quot;0&quot;&#39;</span><span class="p">)</span>
            <span class="n">subs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">                     maxOccurs=&quot;unbounded&quot;/&gt;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">itemgroup</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;setitems&quot;</span><span class="p">,</span> <span class="s2">&quot;getitems&quot;</span><span class="p">):</span>
            <span class="n">type_</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;nodes_</span><span class="si">{</span><span class="n">itemgroup</span><span class="si">}</span><span class="s2">Type&quot;</span>
            <span class="n">subs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">            &lt;element name=&quot;nodes&quot;&#39;</span><span class="p">)</span>
            <span class="n">subs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">                     type=&quot;hpcb:</span><span class="si">{</span><span class="n">type_</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
            <span class="n">subs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">                     minOccurs=&quot;0&quot;&#39;</span><span class="p">)</span>
            <span class="n">subs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">                     maxOccurs=&quot;unbounded&quot;/&gt;&#39;</span><span class="p">)</span>
        <span class="n">subs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">        &lt;/sequence&gt;&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">        &lt;attribute name=&quot;info&quot; type=&quot;string&quot;/&gt;&#39;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">    &lt;/complexType&gt;&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">&lt;/element&gt;&quot;</span><span class="p">,</span>
                <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subs</span><span class="p">)</span></div>


<div class="viewcode-block" id="XSDWriter.get_itemtypesinsertion">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XSDWriter.get_itemtypesinsertion">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_itemtypesinsertion</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">itemgroup</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a string defining the required types for the given exchange item</span>
<span class="sd">        group.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XSDWriter</span>
<span class="sd">        &gt;&gt;&gt; print(XSDWriter.get_itemtypesinsertion(</span>
<span class="sd">        ...     &quot;setitems&quot;, 1))  # doctest: +ELLIPSIS</span>
<span class="sd">            &lt;complexType name=&quot;arma_v1_setitemsType&quot;&gt;</span>
<span class="sd">        ...</span>
<span class="sd">            &lt;/complexType&gt;</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">            &lt;complexType name=&quot;dam_v001_setitemsType&quot;&gt;</span>
<span class="sd">        ...</span>
<span class="sd">            &lt;complexType name=&quot;nodes_setitemsType&quot;&gt;</span>
<span class="sd">        ...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">subs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">modelname</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_applicationmodelnames</span><span class="p">():</span>
            <span class="n">subs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">get_itemtypeinsertion</span><span class="p">(</span><span class="n">itemgroup</span><span class="p">,</span> <span class="n">modelname</span><span class="p">,</span> <span class="n">indent</span><span class="p">))</span>
        <span class="n">subs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">get_nodesitemtypeinsertion</span><span class="p">(</span><span class="n">itemgroup</span><span class="p">,</span> <span class="n">indent</span><span class="p">))</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subs</span><span class="p">)</span></div>


<div class="viewcode-block" id="XSDWriter.get_itemtypeinsertion">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XSDWriter.get_itemtypeinsertion">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_itemtypeinsertion</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">itemgroup</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">modelname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a string defining the required types for the given combination of</span>
<span class="sd">        an exchange item group and an application model.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XSDWriter</span>
<span class="sd">        &gt;&gt;&gt; print(XSDWriter.get_itemtypeinsertion(</span>
<span class="sd">        ...     &quot;setitems&quot;, &quot;hland_v1&quot;, 1))  # doctest: +ELLIPSIS</span>
<span class="sd">            &lt;complexType name=&quot;hland_v1_setitemsType&quot;&gt;</span>
<span class="sd">                &lt;sequence&gt;</span>
<span class="sd">                    &lt;element ref=&quot;hpcb:selections&quot;</span>
<span class="sd">                             minOccurs=&quot;0&quot;/&gt;</span>
<span class="sd">                    &lt;element name=&quot;control&quot;</span>
<span class="sd">                             minOccurs=&quot;0&quot;</span>
<span class="sd">                             maxOccurs=&quot;unbounded&quot;&gt;</span>
<span class="sd">        ...</span>
<span class="sd">                &lt;/sequence&gt;</span>
<span class="sd">            &lt;/complexType&gt;</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">blanks</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">indent</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">type_</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_itemstype</span><span class="p">(</span><span class="n">modelname</span><span class="p">,</span> <span class="n">itemgroup</span><span class="p">)</span>
        <span class="n">subs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">&lt;complexType name=&quot;</span><span class="si">{</span><span class="n">type_</span><span class="si">}</span><span class="s1">&quot;&gt;&#39;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">    &lt;sequence&gt;&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">        &lt;element ref=&quot;hpcb:selections&quot;&#39;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">                 minOccurs=&quot;0&quot;/&gt;&#39;</span><span class="p">,</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">get_subgroupsiteminsertion</span><span class="p">(</span><span class="n">itemgroup</span><span class="p">,</span> <span class="n">modelname</span><span class="p">,</span> <span class="n">indent</span> <span class="o">+</span> <span class="mi">2</span><span class="p">),</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">    &lt;/sequence&gt;&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">&lt;/complexType&gt;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subs</span><span class="p">)</span></div>


<div class="viewcode-block" id="XSDWriter.get_nodesitemtypeinsertion">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XSDWriter.get_nodesitemtypeinsertion">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_nodesitemtypeinsertion</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">itemgroup</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a string defining the required types for the given combination of</span>
<span class="sd">        an exchange item group and |Node| objects.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XSDWriter</span>
<span class="sd">        &gt;&gt;&gt; print(XSDWriter.get_nodesitemtypeinsertion(</span>
<span class="sd">        ...     &quot;setitems&quot;, 1))  # doctest: +ELLIPSIS</span>
<span class="sd">            &lt;complexType name=&quot;nodes_setitemsType&quot;&gt;</span>
<span class="sd">                &lt;sequence&gt;</span>
<span class="sd">                    &lt;element ref=&quot;hpcb:selections&quot;</span>
<span class="sd">                             minOccurs=&quot;0&quot;/&gt;</span>
<span class="sd">                    &lt;element name=&quot;sim&quot;</span>
<span class="sd">                             type=&quot;hpcb:setitemType&quot;</span>
<span class="sd">                             minOccurs=&quot;0&quot;</span>
<span class="sd">                             maxOccurs=&quot;unbounded&quot;/&gt;</span>
<span class="sd">                    &lt;element name=&quot;obs&quot;</span>
<span class="sd">                             type=&quot;hpcb:setitemType&quot;</span>
<span class="sd">                             minOccurs=&quot;0&quot;</span>
<span class="sd">                             maxOccurs=&quot;unbounded&quot;/&gt;</span>
<span class="sd">                    &lt;element name=&quot;sim.series&quot;</span>
<span class="sd">                             type=&quot;hpcb:setitemType&quot;</span>
<span class="sd">                             minOccurs=&quot;0&quot;</span>
<span class="sd">                             maxOccurs=&quot;unbounded&quot;/&gt;</span>
<span class="sd">                    &lt;element name=&quot;obs.series&quot;</span>
<span class="sd">                             type=&quot;hpcb:setitemType&quot;</span>
<span class="sd">                             minOccurs=&quot;0&quot;</span>
<span class="sd">                             maxOccurs=&quot;unbounded&quot;/&gt;</span>
<span class="sd">                &lt;/sequence&gt;</span>
<span class="sd">            &lt;/complexType&gt;</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">blanks</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">indent</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">subs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">&lt;complexType name=&quot;nodes_</span><span class="si">{</span><span class="n">itemgroup</span><span class="si">}</span><span class="s1">Type&quot;&gt;&#39;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">    &lt;sequence&gt;&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">        &lt;element ref=&quot;hpcb:selections&quot;&#39;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">                 minOccurs=&quot;0&quot;/&gt;&#39;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">type_</span> <span class="o">=</span> <span class="s2">&quot;getitemType&quot;</span> <span class="k">if</span> <span class="n">itemgroup</span> <span class="o">==</span> <span class="s2">&quot;getitems&quot;</span> <span class="k">else</span> <span class="s2">&quot;setitemType&quot;</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;sim&quot;</span><span class="p">,</span> <span class="s2">&quot;obs&quot;</span><span class="p">,</span> <span class="s2">&quot;sim.series&quot;</span><span class="p">,</span> <span class="s2">&quot;obs.series&quot;</span><span class="p">):</span>
            <span class="n">subs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">        &lt;element name=&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">                 type=&quot;hpcb:</span><span class="si">{</span><span class="n">type_</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">                 minOccurs=&quot;0&quot;&#39;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s1">                 maxOccurs=&quot;unbounded&quot;/&gt;&#39;</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="n">subs</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">    &lt;/sequence&gt;&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">&lt;/complexType&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subs</span><span class="p">)</span></div>


<div class="viewcode-block" id="XSDWriter.get_subgroupsiteminsertion">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XSDWriter.get_subgroupsiteminsertion">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_subgroupsiteminsertion</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">itemgroup</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">modelname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a string defining the required types for the given combination of an</span>
<span class="sd">        exchange item group and an application model.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XSDWriter</span>
<span class="sd">        &gt;&gt;&gt; print(XSDWriter.get_subgroupsiteminsertion(</span>
<span class="sd">        ...     &quot;setitems&quot;, &quot;hland_v1&quot;, 1))  # doctest: +ELLIPSIS</span>
<span class="sd">            &lt;element name=&quot;control&quot;</span>
<span class="sd">                     minOccurs=&quot;0&quot;</span>
<span class="sd">                     maxOccurs=&quot;unbounded&quot;&gt;</span>
<span class="sd">        ...</span>
<span class="sd">            &lt;/element&gt;</span>
<span class="sd">            &lt;element name=&quot;inputs&quot;</span>
<span class="sd">        ...</span>
<span class="sd">            &lt;element name=&quot;factors&quot;</span>
<span class="sd">        ...</span>
<span class="sd">            &lt;element name=&quot;fluxes&quot;</span>
<span class="sd">        ...</span>
<span class="sd">            &lt;element name=&quot;states&quot;</span>
<span class="sd">        ...</span>
<span class="sd">            &lt;element name=&quot;logs&quot;</span>
<span class="sd">        ...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">subs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">importtools</span><span class="o">.</span><span class="n">prepare_model</span><span class="p">(</span><span class="n">modelname</span><span class="p">)</span>
        <span class="n">conditions</span> <span class="o">=</span> <span class="n">itemgroup</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;getitems&quot;</span><span class="p">,</span> <span class="s2">&quot;setitems&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">subvars</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_subvars</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">conditions</span><span class="o">=</span><span class="n">conditions</span><span class="p">):</span>
            <span class="n">subs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">get_subgroupiteminsertion</span><span class="p">(</span><span class="n">itemgroup</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">subvars</span><span class="p">,</span> <span class="n">indent</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subs</span><span class="p">)</span></div>


    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_get_subvars</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">conditions</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">variabletools</span><span class="o">.</span><span class="n">SubVariables</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
        <span class="k">yield</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;inputs&quot;</span><span class="p">,</span> <span class="s2">&quot;factors&quot;</span><span class="p">,</span> <span class="s2">&quot;fluxes&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">conditions</span><span class="p">:</span>
            <span class="n">names</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="s2">&quot;states&quot;</span><span class="p">,</span> <span class="s2">&quot;logs&quot;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="n">subseqs</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">subseqs</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">subseqs</span>

<div class="viewcode-block" id="XSDWriter.get_subgroupiteminsertion">
<a class="viewcode-back" href="../../../xmltools.html#hydpy.auxs.xmltools.XSDWriter.get_subgroupiteminsertion">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_subgroupiteminsertion</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">itemgroup</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span>
        <span class="n">subgroup</span><span class="p">:</span> <span class="n">variabletools</span><span class="o">.</span><span class="n">SubVariables</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
        <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a string defining the required types for the given combination of an</span>
<span class="sd">        exchange item group and a specific variable subgroup of an application model or</span>
<span class="sd">        class |Node|.</span>

<span class="sd">        Note that for `setitems` and `getitems` `setitemType` and `getitemType` are</span>
<span class="sd">        referenced, respectively, and for all others, the model-specific `mathitemType`:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import prepare_model</span>
<span class="sd">        &gt;&gt;&gt; model = prepare_model(&quot;hland_v1&quot;)</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.auxs.xmltools import XSDWriter</span>
<span class="sd">        &gt;&gt;&gt; print(XSDWriter.get_subgroupiteminsertion(  # doctest: +ELLIPSIS</span>
<span class="sd">        ...     &quot;setitems&quot;, model, model.parameters.control, 1))</span>
<span class="sd">            &lt;element name=&quot;control&quot;</span>
<span class="sd">                     minOccurs=&quot;0&quot;</span>
<span class="sd">                     maxOccurs=&quot;unbounded&quot;&gt;</span>
<span class="sd">                &lt;complexType&gt;</span>
<span class="sd">                    &lt;sequence&gt;</span>
<span class="sd">                        &lt;element ref=&quot;hpcb:selections&quot;</span>
<span class="sd">                                 minOccurs=&quot;0&quot;/&gt;</span>
<span class="sd">                        &lt;element name=&quot;area&quot;</span>
<span class="sd">                                 type=&quot;hpcb:setitemType&quot;</span>
<span class="sd">                                 minOccurs=&quot;0&quot;</span>
<span class="sd">                                 maxOccurs=&quot;unbounded&quot;/&gt;</span>
<span class="sd">                        &lt;element name=&quot;nmbzones&quot;</span>
<span class="sd">        ...</span>
<span class="sd">                    &lt;/sequence&gt;</span>
<span class="sd">                &lt;/complexType&gt;</span>
<span class="sd">            &lt;/element&gt;</span>

<span class="sd">        &gt;&gt;&gt; print(XSDWriter.get_subgroupiteminsertion(  # doctest: +ELLIPSIS</span>
<span class="sd">        ...     &quot;getitems&quot;, model, model.parameters.control, 1))</span>
<span class="sd">            &lt;element name=&quot;control&quot;</span>
<span class="sd">        ...</span>
<span class="sd">                        &lt;element name=&quot;area&quot;</span>
<span class="sd">                                 type=&quot;hpcb:getitemType&quot;</span>
<span class="sd">                                 minOccurs=&quot;0&quot;</span>
<span class="sd">                                 maxOccurs=&quot;unbounded&quot;/&gt;</span>
<span class="sd">        ...</span>

<span class="sd">        &gt;&gt;&gt; print(XSDWriter.get_subgroupiteminsertion(  # doctest: +ELLIPSIS</span>
<span class="sd">        ...     &quot;additems&quot;, model, model.parameters.control, 1))</span>
<span class="sd">            &lt;element name=&quot;control&quot;</span>
<span class="sd">        ...</span>
<span class="sd">                        &lt;element name=&quot;area&quot;</span>
<span class="sd">                                 type=&quot;hpcb:hland_v1_mathitemType&quot;</span>
<span class="sd">                                 minOccurs=&quot;0&quot;</span>
<span class="sd">                                 maxOccurs=&quot;unbounded&quot;/&gt;</span>
<span class="sd">        ...</span>

<span class="sd">        &gt;&gt;&gt; print(XSDWriter.get_subgroupiteminsertion(  # doctest: +ELLIPSIS</span>
<span class="sd">        ...     &quot;multiplyitems&quot;, model, model.parameters.control, 1))</span>
<span class="sd">            &lt;element name=&quot;control&quot;</span>
<span class="sd">        ...</span>
<span class="sd">                        &lt;element name=&quot;area&quot;</span>
<span class="sd">                                 type=&quot;hpcb:hland_v1_mathitemType&quot;</span>
<span class="sd">                                 minOccurs=&quot;0&quot;</span>
<span class="sd">                                 maxOccurs=&quot;unbounded&quot;/&gt;</span>
<span class="sd">        ...</span>

<span class="sd">        For sequence classes, additional &quot;series&quot; elements are added:</span>

<span class="sd">        &gt;&gt;&gt; print(XSDWriter.get_subgroupiteminsertion(  # doctest: +ELLIPSIS</span>
<span class="sd">        ...     &quot;setitems&quot;, model, model.sequences.factors, 1))</span>
<span class="sd">            &lt;element name=&quot;factors&quot;</span>
<span class="sd">        ...</span>
<span class="sd">                        &lt;element name=&quot;tmean&quot;</span>
<span class="sd">                                 type=&quot;hpcb:setitemType&quot;</span>
<span class="sd">                                 minOccurs=&quot;0&quot;</span>
<span class="sd">                                 maxOccurs=&quot;unbounded&quot;/&gt;</span>
<span class="sd">                        &lt;element name=&quot;tmean.series&quot;</span>
<span class="sd">                                 type=&quot;hpcb:setitemType&quot;</span>
<span class="sd">                                 minOccurs=&quot;0&quot;</span>
<span class="sd">                                 maxOccurs=&quot;unbounded&quot;/&gt;</span>
<span class="sd">                        &lt;element name=&quot;tc&quot;</span>
<span class="sd">        ...</span>
<span class="sd">                    &lt;/sequence&gt;</span>
<span class="sd">                &lt;/complexType&gt;</span>
<span class="sd">            &lt;/element&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">blanks1</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">indent</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">blanks2</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="p">((</span><span class="n">indent</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">subs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks1</span><span class="si">}</span><span class="s1">&lt;element name=&quot;</span><span class="si">{</span><span class="n">subgroup</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks1</span><span class="si">}</span><span class="s1">         minOccurs=&quot;0&quot;&#39;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks1</span><span class="si">}</span><span class="s1">         maxOccurs=&quot;unbounded&quot;&gt;&#39;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks1</span><span class="si">}</span><span class="s2">    &lt;complexType&gt;&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks1</span><span class="si">}</span><span class="s2">        &lt;sequence&gt;&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks1</span><span class="si">}</span><span class="s1">            &lt;element ref=&quot;hpcb:selections&quot;&#39;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks1</span><span class="si">}</span><span class="s1">                     minOccurs=&quot;0&quot;/&gt;&#39;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">seriesflags</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="k">if</span> <span class="n">subgroup</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;control&quot;</span> <span class="k">else</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">subgroup</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">series</span> <span class="ow">in</span> <span class="n">seriesflags</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.series&quot;</span> <span class="k">if</span> <span class="n">series</span> <span class="k">else</span> <span class="n">var</span><span class="o">.</span><span class="n">name</span>
                <span class="n">subs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks1</span><span class="si">}</span><span class="s1">            &lt;element name=&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">itemgroup</span> <span class="o">==</span> <span class="s2">&quot;setitems&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">parametertools</span><span class="o">.</span><span class="n">Parameter</span><span class="p">)</span> <span class="ow">and</span> <span class="n">var</span><span class="o">.</span><span class="n">KEYWORDS</span><span class="p">:</span>
                        <span class="n">type_</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">subgroup</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_&quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_setitemType&quot;</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">type_</span> <span class="o">=</span> <span class="s2">&quot;setitemType&quot;</span>
                <span class="k">elif</span> <span class="n">itemgroup</span> <span class="o">==</span> <span class="s2">&quot;getitems&quot;</span><span class="p">:</span>
                    <span class="n">type_</span> <span class="o">=</span> <span class="s2">&quot;getitemType&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">type_</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_mathitemType&quot;</span>
                <span class="n">subs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks2</span><span class="si">}</span><span class="s1">type=&quot;hpcb:</span><span class="si">{</span><span class="n">type_</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
                <span class="n">subs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks2</span><span class="si">}</span><span class="s1">minOccurs=&quot;0&quot;&#39;</span><span class="p">)</span>
                <span class="n">subs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">blanks2</span><span class="si">}</span><span class="s1">maxOccurs=&quot;unbounded&quot;/&gt;&#39;</span><span class="p">)</span>
        <span class="n">subs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks1</span><span class="si">}</span><span class="s2">        &lt;/sequence&gt;&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks1</span><span class="si">}</span><span class="s2">    &lt;/complexType&gt;&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks1</span><span class="si">}</span><span class="s2">&lt;/element&gt;&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subs</span><span class="p">)</span></div>
</div>

</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">HydPy 5.0.3 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">hydpy.auxs.xmltools</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2023, HydPy Developers.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    </div>
  </body>
</html>