<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>hydpy.models.dam_sluice &#8212; HydPy 6.1.5 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../_static/classic.css?v=127cebf3" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=4ae1632d" />
    
    <script src="../../../_static/documentation_options.js?v=3b4955ce"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">HydPy 6.1.5 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">hydpy.models.dam_sluice</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/HydPy_Logo.png" alt="Logo"/>
            </a></p>
  <div>
    <h3><a href="../../../index.html">Table of Contents</a></h3>
    <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../example_projects.html">Example Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user_guide.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer_guide.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference_manual.html">Reference Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../zbibliography.html">Bibliography</a></li>
</ul>

  </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for hydpy.models.dam_sluice</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># pylint: disable=line-too-long, unused-wildcard-import</span>
<span class="sd">&quot;&quot;&quot;|dam_sluice| is similar to |dam_pump| but is thought for modelling free flow through</span>
<span class="sd">sluices driven by differences between inner and outer water levels.  Principally, users</span>
<span class="sd">can define arbitrary relationships via |WaterLevelDifference2MaxFreeDischarge|,</span>
<span class="sd">including ones that allow for &quot;negative outflow&quot; so that |dam_sluice| takes water from</span>
<span class="sd">the downstream model.  However, be careful with that because, depending on the</span>
<span class="sd">downstream model&#39;s type and the current conditions, negative inflows can cause</span>
<span class="sd">problems.</span>

<span class="sd">By default, |dam_sluice| neither takes precipitation nor evaporation into account, but</span>
<span class="sd">you can add submodels that comply with the |PrecipModel_V2| or |PETModel_V1| interface</span>
<span class="sd">that supply this information.</span>

<span class="sd">Integration tests</span>
<span class="sd">=================</span>

<span class="sd">.. how_to_understand_integration_tests::</span>

<span class="sd">We take all of the following settings from the documentation on the application model</span>
<span class="sd">|dam_pump|:</span>

<span class="sd">&gt;&gt;&gt; from hydpy import IntegrationTest, Element, Node, pub, round_</span>
<span class="sd">&gt;&gt;&gt; pub.timegrids = &quot;2000-01-01&quot;, &quot;2000-01-21&quot;, &quot;1d&quot;</span>

<span class="sd">&gt;&gt;&gt; from hydpy.aliases import dam_receivers_OWL, dam_receivers_RWL</span>
<span class="sd">&gt;&gt;&gt; inflow = Node(&quot;inflow&quot;)</span>
<span class="sd">&gt;&gt;&gt; outflow = Node(&quot;outflow&quot;)</span>
<span class="sd">&gt;&gt;&gt; outer = Node(&quot;outer&quot;, variable=dam_receivers_OWL)</span>
<span class="sd">&gt;&gt;&gt; remote = Node(&quot;remote&quot;, variable=dam_receivers_RWL)</span>
<span class="sd">&gt;&gt;&gt; dam = Element(&quot;dam&quot;, inlets=inflow, outlets=outflow, receivers=(outer, remote))</span>

<span class="sd">&gt;&gt;&gt; from hydpy.models.dam_sluice import *</span>
<span class="sd">&gt;&gt;&gt; parameterstep()</span>
<span class="sd">&gt;&gt;&gt; dam.model = model</span>

<span class="sd">&gt;&gt;&gt; surfacearea(1.44)</span>
<span class="sd">&gt;&gt;&gt; catchmentarea(86.4)</span>
<span class="sd">&gt;&gt;&gt; watervolume2waterlevel(PPoly.from_data(xs=[0.0, 1.0], ys=[0.0, 1.0]))</span>
<span class="sd">&gt;&gt;&gt; remotewaterlevelmaximumthreshold(2.0)</span>
<span class="sd">&gt;&gt;&gt; remotewaterlevelmaximumtolerance(0.1)</span>
<span class="sd">&gt;&gt;&gt; correctionprecipitation(1.0)</span>
<span class="sd">&gt;&gt;&gt; correctionevaporation(1.0)</span>
<span class="sd">&gt;&gt;&gt; weightevaporation(0.8)</span>
<span class="sd">&gt;&gt;&gt; thresholdevaporation(0.0)</span>
<span class="sd">&gt;&gt;&gt; toleranceevaporation(0.001)</span>

<span class="sd">&gt;&gt;&gt; with model.add_precipmodel_v2(&quot;meteo_precip_io&quot;):</span>
<span class="sd">...     precipitationfactor(1.0)</span>
<span class="sd">&gt;&gt;&gt; with model.add_pemodel_v1(&quot;evap_ret_io&quot;):</span>
<span class="sd">...     evapotranspirationfactor(1.0)</span>

<span class="sd">&gt;&gt;&gt; test = IntegrationTest(dam)</span>
<span class="sd">&gt;&gt;&gt; test.dateformat = &quot;%d.%m.&quot;</span>
<span class="sd">&gt;&gt;&gt; test.plotting_options.axis1 = fluxes.inflow, fluxes.outflow</span>
<span class="sd">&gt;&gt;&gt; test.plotting_options.axis2 = factors.waterlevel, factors.outerwaterlevel, factors.remotewaterlevel</span>
<span class="sd">&gt;&gt;&gt; test.inits = [(states.watervolume, 0.0),</span>
<span class="sd">...               (logs.loggedadjustedevaporation, 0.0),</span>
<span class="sd">...               (logs.loggedouterwaterlevel, 0.0),</span>
<span class="sd">...               (logs.loggedremotewaterlevel, 0.0)]</span>
<span class="sd">&gt;&gt;&gt; test.reset_inits()</span>
<span class="sd">&gt;&gt;&gt; conditions = model.conditions</span>

<span class="sd">&gt;&gt;&gt; model.precipmodel.sequences.inputs.precipitation.series = 2.0</span>
<span class="sd">&gt;&gt;&gt; model.pemodel.sequences.inputs.referenceevapotranspiration.series = 1.0</span>
<span class="sd">&gt;&gt;&gt; inflow.sequences.sim.series = 2.0</span>
<span class="sd">&gt;&gt;&gt; outer.sequences.sim.series = 0.0</span>
<span class="sd">&gt;&gt;&gt; remote.sequences.sim.series = numpy.linspace(0.0, 3.0, 20)</span>

<span class="sd">The remaining parameters are specific to |dam_sluice|.</span>

<span class="sd">We define a one-to-one relationship between the effective water level difference and</span>
<span class="sd">the highest possible free discharge values:</span>

<span class="sd">&gt;&gt;&gt; waterleveldifference2maxfreedischarge(PPoly.from_data(xs=[0.0, 1.0], ys=[0.0, 1.0]))</span>

<span class="sd">By setting the crest level to 1 m, only inner and outer water levels higher than one</span>
<span class="sd">meter are &quot;effective&quot; (can cause inflow or outflow through the hydraulic structure):</span>

<span class="sd">&gt;&gt;&gt; crestlevel(1.0)</span>
<span class="sd">&gt;&gt;&gt; crestleveltolerance(0.1)</span>

<span class="sd">The smoothing parameter |DischargeTolerance| is only relevant when the outflow must be</span>
<span class="sd">suppressed to not further increase to high water levels at a remote location (see</span>
<span class="sd">|Calc_FreeDischarge_V1|):</span>

<span class="sd">&gt;&gt;&gt; dischargetolerance(0.1)</span>

<span class="sd">.. _dam_sluice_drainage:</span>

<span class="sd">drainage</span>
<span class="sd">________</span>

<span class="sd">The results of the following test run are pretty similar to those of the</span>
<span class="sd">:ref:`dam_pump_drainage` example.  Outflow starts again when the inner water level</span>
<span class="sd">reaches 1 m, which is the crest level in this example.  Afterwards, however, the</span>
<span class="sd">outflow increases approximately linearly with the further rising water level, but this</span>
<span class="sd">is more a (useful) difference in parameterisation than of the underlying equations.</span>
<span class="sd">The implemented flood protection mechanism suppresses the outflow quite similarly in</span>
<span class="sd">both examples:</span>

<span class="sd">.. integration-test::</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;dam_sluice_drainage&quot;)</span>
<span class="sd">    |   date | waterlevel | outerwaterlevel | remotewaterlevel | effectivewaterleveldifference | precipitation | adjustedprecipitation | potentialevaporation | adjustedevaporation | actualevaporation | inflow | freedischarge | maxfreedischarge |  outflow | watervolume | inflow | outer |  outflow |   remote |</span>
<span class="sd">    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span>
<span class="sd">    | 01.01. |   0.174533 |             0.0 |              0.0 |                           0.0 |           2.0 |              0.033333 |                  1.0 |            0.013333 |          0.013278 |    2.0 |           0.0 |              0.0 |      0.0 |    0.174533 |    2.0 |   0.0 |      0.0 |      0.0 |</span>
<span class="sd">    | 02.01. |    0.34883 |             0.0 |              0.0 |                      0.000001 |           2.0 |              0.033333 |                  1.0 |               0.016 |             0.016 |    2.0 |      0.000001 |         0.000001 | 0.000001 |     0.34883 |    2.0 |   0.0 | 0.000001 | 0.157895 |</span>
<span class="sd">    | 03.01. |   0.523081 |             0.0 |         0.157895 |                      0.000019 |           2.0 |              0.033333 |                  1.0 |            0.016533 |          0.016533 |    2.0 |       0.00001 |          0.00001 |  0.00001 |    0.523081 |    2.0 |   0.0 |  0.00001 | 0.315789 |</span>
<span class="sd">    | 04.01. |   0.697313 |             0.0 |         0.315789 |                      0.000352 |           2.0 |              0.033333 |                  1.0 |             0.01664 |           0.01664 |    2.0 |      0.000116 |         0.000116 | 0.000116 |    0.697313 |    2.0 |   0.0 | 0.000116 | 0.473684 |</span>
<span class="sd">    | 05.01. |   0.871372 |             0.0 |         0.473684 |                      0.006359 |           2.0 |              0.033333 |                  1.0 |            0.016661 |          0.016661 |    2.0 |      0.002101 |         0.002101 | 0.002101 |    0.871372 |    2.0 |   0.0 | 0.002101 | 0.631579 |</span>
<span class="sd">    | 06.01. |   1.043195 |             0.0 |         0.631579 |                      0.066439 |           2.0 |              0.033333 |                  1.0 |            0.016666 |          0.016666 |    2.0 |      0.027981 |         0.027981 | 0.027981 |    1.043195 |    2.0 |   0.0 | 0.027981 | 0.789474 |</span>
<span class="sd">    | 07.01. |    1.20585 |             0.0 |         0.789474 |                      0.207642 |           2.0 |              0.033333 |                  1.0 |            0.016666 |          0.016666 |    2.0 |      0.134088 |         0.134088 | 0.134088 |     1.20585 |    2.0 |   0.0 | 0.134088 | 0.947368 |</span>
<span class="sd">    | 08.01. |   1.355683 |             0.0 |         0.947368 |                      0.355832 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    2.0 |      0.282479 |         0.282479 | 0.282479 |    1.355683 |    2.0 |   0.0 | 0.282479 | 1.105263 |</span>
<span class="sd">    | 09.01. |   1.493163 |             0.0 |         1.105263 |                      0.493181 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    2.0 |      0.425468 |         0.425468 | 0.425468 |    1.493163 |    2.0 |   0.0 | 0.425468 | 1.263158 |</span>
<span class="sd">    | 10.01. |   1.619267 |             0.0 |         1.263158 |                      0.619272 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    2.0 |      0.557129 |         0.557129 | 0.557129 |    1.619267 |    2.0 |   0.0 | 0.557129 | 1.421053 |</span>
<span class="sd">    | 11.01. |   1.734934 |             0.0 |         1.421053 |                      0.734937 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    2.0 |      0.677934 |         0.677934 | 0.677934 |    1.734934 |    2.0 |   0.0 | 0.677934 | 1.578947 |</span>
<span class="sd">    | 12.01. |   1.841026 |             0.0 |         1.578947 |                      0.841029 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    2.0 |      0.788744 |         0.788744 | 0.788744 |    1.841026 |    2.0 |   0.0 | 0.788744 | 1.736842 |</span>
<span class="sd">    | 13.01. |   1.938337 |             0.0 |         1.736842 |                       0.93834 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    2.0 |      0.890378 |         0.890383 | 0.890378 |    1.938337 |    2.0 |   0.0 | 0.890378 | 1.894737 |</span>
<span class="sd">    | 14.01. |   2.028235 |             0.0 |         1.894737 |                      1.028237 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    2.0 |      0.976187 |         0.983929 | 0.976187 |    2.028235 |    2.0 |   0.0 | 0.976187 | 2.052632 |</span>
<span class="sd">    | 15.01. |   2.194622 |             0.0 |         2.052632 |                      1.194622 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    2.0 |      0.090894 |         1.111526 | 0.090894 |    2.194622 |    2.0 |   0.0 | 0.090894 | 2.210526 |</span>
<span class="sd">    | 16.01. |   2.368855 |             0.0 |         2.210526 |                      1.368855 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    2.0 |      0.000081 |         1.281738 | 0.000081 |    2.368855 |    2.0 |   0.0 | 0.000081 | 2.368421 |</span>
<span class="sd">    | 17.01. |   2.543095 |             0.0 |         2.368421 |                      1.543095 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    2.0 |           0.0 |         1.455975 |      0.0 |    2.543095 |    2.0 |   0.0 |      0.0 | 2.526316 |</span>
<span class="sd">    | 18.01. |   2.717335 |             0.0 |         2.526316 |                      1.717335 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    2.0 |           0.0 |         1.630215 |      0.0 |    2.717335 |    2.0 |   0.0 |      0.0 | 2.684211 |</span>
<span class="sd">    | 19.01. |   2.891575 |             0.0 |         2.684211 |                      1.891575 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    2.0 |           0.0 |         1.804455 |      0.0 |    2.891575 |    2.0 |   0.0 |      0.0 | 2.842105 |</span>
<span class="sd">    | 20.01. |   3.065815 |             0.0 |         2.842105 |                      2.065815 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    2.0 |           0.0 |         1.978695 |      0.0 |    3.065815 |    2.0 |   0.0 |      0.0 |      3.0 |</span>

<span class="sd">There is no indication of an error in the water balance:</span>

<span class="sd">&gt;&gt;&gt; round_(model.check_waterbalance(conditions))</span>
<span class="sd">0.0</span>

<span class="sd">.. _dam_sluice_irrigation:</span>

<span class="sd">irrigation</span>
<span class="sd">__________</span>

<span class="sd">The flow through the hydraulic structure can be negative, corresponding to irrigation</span>
<span class="sd">instead of land drainage.  We set the dam&#39;s &quot;normal&quot; inflow (from upstream areas) to</span>
<span class="sd">0 m³/s and increase the outer water level to 2 m, which reverses the water level</span>
<span class="sd">gradient:</span>

<span class="sd">&gt;&gt;&gt; inflow.sequences.sim.series = 0.0</span>
<span class="sd">&gt;&gt;&gt; outer.sequences.sim.series = 2.0</span>

<span class="sd">Now, the inner water level rises because of inflow from the area downstream.  The</span>
<span class="sd">remote water level still overshoots the threshold of 2 m, but this does not suppress</span>
<span class="sd">the inflow, as water losses should never increase flood risks:</span>

<span class="sd">.. integration-test::</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;dam_sluice_irrigation&quot;)</span>
<span class="sd">    |   date | waterlevel | outerwaterlevel | remotewaterlevel | effectivewaterleveldifference | precipitation | adjustedprecipitation | potentialevaporation | adjustedevaporation | actualevaporation | inflow | freedischarge | maxfreedischarge |   outflow | watervolume | inflow | outer |   outflow |   remote |</span>
<span class="sd">    -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span>
<span class="sd">    | 01.01. |   0.001813 |             0.0 |              0.0 |                           0.0 |           2.0 |              0.033333 |                  1.0 |            0.013333 |          0.012345 |    0.0 |           0.0 |              0.0 |       0.0 |    0.001813 |    0.0 |   2.0 |       0.0 |      0.0 |</span>
<span class="sd">    | 02.01. |   0.089711 |             2.0 |              0.0 |                          -1.0 |           2.0 |              0.033333 |                  1.0 |               0.016 |          0.015998 |    0.0 |          -1.0 |             -1.0 |      -1.0 |    0.089711 |    0.0 |   2.0 |      -1.0 | 0.157895 |</span>
<span class="sd">    | 03.01. |   0.177563 |             2.0 |         0.157895 |                          -1.0 |           2.0 |              0.033333 |                  1.0 |            0.016533 |          0.016533 |    0.0 |          -1.0 |             -1.0 |      -1.0 |    0.177563 |    0.0 |   2.0 |      -1.0 | 0.315789 |</span>
<span class="sd">    | 04.01. |   0.265405 |             2.0 |         0.315789 |                          -1.0 |           2.0 |              0.033333 |                  1.0 |             0.01664 |           0.01664 |    0.0 |          -1.0 |             -1.0 |      -1.0 |    0.265405 |    0.0 |   2.0 |      -1.0 | 0.473684 |</span>
<span class="sd">    | 05.01. |   0.353245 |             2.0 |         0.473684 |                     -0.999999 |           2.0 |              0.033333 |                  1.0 |            0.016661 |          0.016661 |    0.0 |     -0.999999 |        -0.999999 | -0.999999 |    0.353245 |    0.0 |   2.0 | -0.999999 | 0.631579 |</span>
<span class="sd">    | 06.01. |   0.441085 |             2.0 |         0.631579 |                     -0.999995 |           2.0 |              0.033333 |                  1.0 |            0.016666 |          0.016666 |    0.0 |     -0.999997 |        -0.999997 | -0.999997 |    0.441085 |    0.0 |   2.0 | -0.999997 | 0.789474 |</span>
<span class="sd">    | 07.01. |   0.528924 |             2.0 |         0.789474 |                      -0.99998 |           2.0 |              0.033333 |                  1.0 |            0.016666 |          0.016666 |    0.0 |     -0.999987 |        -0.999987 | -0.999987 |    0.528924 |    0.0 |   2.0 | -0.999987 | 0.947368 |</span>
<span class="sd">    | 08.01. |   0.616759 |             2.0 |         0.947368 |                      -0.99991 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    0.0 |     -0.999945 |        -0.999945 | -0.999945 |    0.616759 |    0.0 |   2.0 | -0.999945 | 1.105263 |</span>
<span class="sd">    | 09.01. |   0.704581 |             2.0 |         1.105263 |                     -0.999602 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    0.0 |     -0.999792 |        -0.999792 | -0.999792 |    0.704581 |    0.0 |   2.0 | -0.999792 | 1.263158 |</span>
<span class="sd">    | 10.01. |   0.792343 |             2.0 |         1.263158 |                     -0.998262 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    0.0 |     -0.999089 |        -0.999089 | -0.999089 |    0.792343 |    0.0 |   2.0 | -0.999089 | 1.421053 |</span>
<span class="sd">    | 11.01. |   0.879846 |             2.0 |         1.421053 |                     -0.992719 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    0.0 |     -0.996107 |        -0.996107 | -0.996107 |    0.879846 |    0.0 |   2.0 | -0.996107 | 1.578947 |</span>
<span class="sd">    | 12.01. |   0.966376 |             2.0 |         1.578947 |                      -0.97347 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    0.0 |     -0.984837 |        -0.984837 | -0.984837 |    0.966376 |    0.0 |   2.0 | -0.984837 | 1.736842 |</span>
<span class="sd">    | 13.01. |   1.050185 |             2.0 |         1.736842 |                     -0.928748 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    0.0 |     -0.953341 |        -0.953341 | -0.953341 |    1.050185 |    0.0 |   2.0 | -0.953341 | 1.894737 |</span>
<span class="sd">    | 14.01. |   1.129174 |             2.0 |         1.894737 |                     -0.864517 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    0.0 |     -0.897562 |        -0.897562 | -0.897562 |    1.129174 |    0.0 |   2.0 | -0.897562 | 2.052632 |</span>
<span class="sd">    | 15.01. |   1.202334 |             2.0 |         2.052632 |                     -0.795763 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    0.0 |     -0.830094 |        -0.830094 | -0.830094 |    1.202334 |    0.0 |   2.0 | -0.830094 | 2.210526 |</span>
<span class="sd">    | 16.01. |   1.269646 |             2.0 |         2.210526 |                     -0.729737 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    0.0 |     -0.762403 |        -0.762403 | -0.762403 |    1.269646 |    0.0 |   2.0 | -0.762403 | 2.368421 |</span>
<span class="sd">    | 17.01. |   1.331448 |             2.0 |         2.368421 |                     -0.668333 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    0.0 |     -0.698632 |        -0.698631 | -0.698632 |    1.331448 |    0.0 |   2.0 | -0.698632 | 2.526316 |</span>
<span class="sd">    | 18.01. |   1.388154 |             2.0 |         2.526316 |                     -0.611761 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    0.0 |     -0.639654 |        -0.639653 | -0.639654 |    1.388154 |    0.0 |   2.0 | -0.639654 | 2.684211 |</span>
<span class="sd">    | 19.01. |   1.440173 |             2.0 |         2.684211 |                     -0.559791 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    0.0 |      -0.58541 |        -0.585407 |  -0.58541 |    1.440173 |    0.0 |   2.0 |  -0.58541 | 2.842105 |</span>
<span class="sd">    | 20.01. |    1.48789 |             2.0 |         2.842105 |                     -0.512093 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    0.0 |     -0.535608 |        -0.535601 | -0.535608 |     1.48789 |    0.0 |   2.0 | -0.535608 |      3.0 |</span>

<span class="sd">There is no indication of an error in the water balance:</span>

<span class="sd">&gt;&gt;&gt; round_(model.check_waterbalance(conditions))</span>
<span class="sd">0.0</span>

<span class="sd">.. _dam_sluice_mixed:</span>

<span class="sd">mixed</span>
<span class="sd">_____</span>

<span class="sd">Finally, we reset the &quot;normal&quot; inflow to 2 m³/s but leave the outer water level at 2 m:</span>

<span class="sd">&gt;&gt;&gt; inflow.sequences.sim.series = 2.0</span>

<span class="sd">This setting results in a &quot;mixed&quot; situation where initial inflow from downstream turns</span>
<span class="sd">into outflow as soon as the inner water level exceeds the outer one:</span>

<span class="sd">.. integration-test::</span>

<span class="sd">    &gt;&gt;&gt; test(&quot;dam_sluice_mixed&quot;)</span>
<span class="sd">    |   date | waterlevel | outerwaterlevel | remotewaterlevel | effectivewaterleveldifference | precipitation | adjustedprecipitation | potentialevaporation | adjustedevaporation | actualevaporation | inflow | freedischarge | maxfreedischarge |   outflow | watervolume | inflow | outer |   outflow |   remote |</span>
<span class="sd">    -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span>
<span class="sd">    | 01.01. |   0.174533 |             0.0 |              0.0 |                           0.0 |           2.0 |              0.033333 |                  1.0 |            0.013333 |          0.013278 |    2.0 |           0.0 |              0.0 |       0.0 |    0.174533 |    2.0 |   2.0 |       0.0 |      0.0 |</span>
<span class="sd">    | 02.01. |    0.43523 |             2.0 |              0.0 |                     -0.999996 |           2.0 |              0.033333 |                  1.0 |               0.016 |             0.016 |    2.0 |     -0.999998 |        -0.999998 | -0.999998 |     0.43523 |    2.0 |   2.0 | -0.999998 | 0.157895 |</span>
<span class="sd">    | 03.01. |   0.695875 |             2.0 |         0.157895 |                     -0.999656 |           2.0 |              0.033333 |                  1.0 |            0.016533 |          0.016533 |    2.0 |     -0.999917 |        -0.999917 | -0.999917 |    0.695875 |    2.0 |   2.0 | -0.999917 | 0.315789 |</span>
<span class="sd">    | 04.01. |   0.956025 |             2.0 |         0.315789 |                     -0.977007 |           2.0 |              0.033333 |                  1.0 |             0.01664 |           0.01664 |    2.0 |     -0.994311 |        -0.994311 | -0.994311 |    0.956025 |    2.0 |   2.0 | -0.994311 | 0.473684 |</span>
<span class="sd">    | 05.01. |   1.207742 |             2.0 |         0.473684 |                     -0.790519 |           2.0 |              0.033333 |                  1.0 |            0.016661 |          0.016661 |    2.0 |     -0.896712 |        -0.896712 | -0.896712 |    1.207742 |    2.0 |   2.0 | -0.896712 | 0.631579 |</span>
<span class="sd">    | 06.01. |    1.44021 |             2.0 |         0.631579 |                      -0.55975 |           2.0 |              0.033333 |                  1.0 |            0.016666 |          0.016666 |    2.0 |     -0.673935 |        -0.673935 | -0.673935 |     1.44021 |    2.0 |   2.0 | -0.673935 | 0.789474 |</span>
<span class="sd">    | 07.01. |   1.653469 |             2.0 |         0.789474 |                     -0.346524 |           2.0 |              0.033333 |                  1.0 |            0.016666 |          0.016666 |    2.0 |     -0.451615 |        -0.451615 | -0.451615 |    1.653469 |    2.0 |   2.0 | -0.451615 | 0.947368 |</span>
<span class="sd">    | 08.01. |   1.849078 |             2.0 |         0.947368 |                     -0.150917 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    2.0 |     -0.247317 |        -0.247317 | -0.247317 |    1.849078 |    2.0 |   2.0 | -0.247317 | 1.105263 |</span>
<span class="sd">    | 09.01. |   2.028495 |             2.0 |         1.105263 |                        0.0285 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    2.0 |     -0.059921 |        -0.059921 | -0.059921 |    2.028495 |    2.0 |   2.0 | -0.059921 | 1.263158 |</span>
<span class="sd">    | 10.01. |   2.193061 |             2.0 |         1.263158 |                      0.193066 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    2.0 |      0.111964 |         0.111964 |  0.111964 |    2.193061 |    2.0 |   2.0 |  0.111964 | 1.421053 |</span>
<span class="sd">    | 11.01. |   2.344006 |             2.0 |         1.421053 |                       0.34401 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    2.0 |      0.269621 |         0.269621 |  0.269621 |    2.344006 |    2.0 |   2.0 |  0.269621 | 1.578947 |</span>
<span class="sd">    | 12.01. |   2.482456 |             2.0 |         1.578947 |                       0.48246 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    2.0 |      0.414229 |         0.414229 |  0.414229 |    2.482456 |    2.0 |   2.0 |  0.414229 | 1.736842 |</span>
<span class="sd">    | 13.01. |   2.609447 |             2.0 |         1.736842 |                      0.609451 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    2.0 |      0.546864 |         0.546867 |  0.546864 |    2.609447 |    2.0 |   2.0 |  0.546864 | 1.894737 |</span>
<span class="sd">    | 14.01. |   2.726363 |             2.0 |         1.894737 |                      0.726366 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    2.0 |      0.663479 |         0.668741 |  0.663479 |    2.726363 |    2.0 |   2.0 |  0.663479 | 2.052632 |</span>
<span class="sd">    | 15.01. |   2.894875 |             2.0 |         2.052632 |                      0.894875 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    2.0 |      0.066296 |         0.810718 |  0.066296 |    2.894875 |    2.0 |   2.0 |  0.066296 | 2.210526 |</span>
<span class="sd">    | 16.01. |    3.06911 |             2.0 |         2.210526 |                       1.06911 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    2.0 |      0.000062 |         0.981992 |  0.000062 |     3.06911 |    2.0 |   2.0 |  0.000062 | 2.368421 |</span>
<span class="sd">    | 17.01. |    3.24335 |             2.0 |         2.368421 |                       1.24335 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    2.0 |           0.0 |          1.15623 |       0.0 |     3.24335 |    2.0 |   2.0 |       0.0 | 2.526316 |</span>
<span class="sd">    | 18.01. |    3.41759 |             2.0 |         2.526316 |                       1.41759 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    2.0 |           0.0 |          1.33047 |       0.0 |     3.41759 |    2.0 |   2.0 |       0.0 | 2.684211 |</span>
<span class="sd">    | 19.01. |    3.59183 |             2.0 |         2.684211 |                       1.59183 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    2.0 |           0.0 |          1.50471 |       0.0 |     3.59183 |    2.0 |   2.0 |       0.0 | 2.842105 |</span>
<span class="sd">    | 20.01. |    3.76607 |             2.0 |         2.842105 |                       1.76607 |           2.0 |              0.033333 |                  1.0 |            0.016667 |          0.016667 |    2.0 |           0.0 |          1.67895 |       0.0 |     3.76607 |    2.0 |   2.0 |       0.0 |      3.0 |</span>

<span class="sd">There is no indication of an error in the water balance:</span>

<span class="sd">&gt;&gt;&gt; round_(model.check_waterbalance(conditions))</span>
<span class="sd">0.0</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1"># import...</span>
<span class="c1"># ...from HydPy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">hydpy</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.auxs.anntools</span><span class="w"> </span><span class="kn">import</span> <span class="n">ANN</span>  <span class="c1"># pylint: disable=unused-import</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.auxs.ppolytools</span><span class="w"> </span><span class="kn">import</span> <span class="n">Poly</span><span class="p">,</span> <span class="n">PPoly</span>  <span class="c1"># pylint: disable=unused-import</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">modeltools</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.core.typingtools</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.interfaces</span><span class="w"> </span><span class="kn">import</span> <span class="n">petinterfaces</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.interfaces</span><span class="w"> </span><span class="kn">import</span> <span class="n">precipinterfaces</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.exe.modelimports</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>

<span class="c1"># ...from dam</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.dam</span><span class="w"> </span><span class="kn">import</span> <span class="n">dam_model</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.dam</span><span class="w"> </span><span class="kn">import</span> <span class="n">dam_solver</span>


<div class="viewcode-block" id="Model">
<a class="viewcode-back" href="../../../dam_sluice.html#hydpy.models.dam_sluice.Model">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Model</span><span class="p">(</span><span class="n">dam_model</span><span class="o">.</span><span class="n">Main_PrecipModel_V2</span><span class="p">,</span> <span class="n">dam_model</span><span class="o">.</span><span class="n">Main_PEModel_V1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;|dam_sluice.DOCNAME.complete|.&quot;&quot;&quot;</span>

    <span class="n">DOCNAME</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">DocName</span><span class="p">(</span><span class="n">short</span><span class="o">=</span><span class="s2">&quot;Dam-Sluice&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;sluice model&quot;</span><span class="p">)</span>
    <span class="n">__HYDPY_ROOTMODEL__</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">SOLVERPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">dam_solver</span><span class="o">.</span><span class="n">AbsErrorMax</span><span class="p">,</span>
        <span class="n">dam_solver</span><span class="o">.</span><span class="n">RelErrorMax</span><span class="p">,</span>
        <span class="n">dam_solver</span><span class="o">.</span><span class="n">RelDTMin</span><span class="p">,</span>
        <span class="n">dam_solver</span><span class="o">.</span><span class="n">RelDTMax</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">SOLVERSEQUENCES</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">INLET_METHODS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">dam_model</span><span class="o">.</span><span class="n">Calc_Precipitation_V1</span><span class="p">,</span>
        <span class="n">dam_model</span><span class="o">.</span><span class="n">Calc_PotentialEvaporation_V1</span><span class="p">,</span>
        <span class="n">dam_model</span><span class="o">.</span><span class="n">Calc_AdjustedEvaporation_V1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RECEIVER_METHODS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">dam_model</span><span class="o">.</span><span class="n">Pick_LoggedOuterWaterLevel_V1</span><span class="p">,</span>
        <span class="n">dam_model</span><span class="o">.</span><span class="n">Pick_LoggedRemoteWaterLevel_V1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ADD_METHODS</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">PART_ODE_METHODS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">dam_model</span><span class="o">.</span><span class="n">Calc_AdjustedPrecipitation_V1</span><span class="p">,</span>
        <span class="n">dam_model</span><span class="o">.</span><span class="n">Pic_Inflow_V1</span><span class="p">,</span>
        <span class="n">dam_model</span><span class="o">.</span><span class="n">Calc_WaterLevel_V1</span><span class="p">,</span>
        <span class="n">dam_model</span><span class="o">.</span><span class="n">Calc_OuterWaterLevel_V1</span><span class="p">,</span>
        <span class="n">dam_model</span><span class="o">.</span><span class="n">Calc_RemoteWaterLevel_V1</span><span class="p">,</span>
        <span class="n">dam_model</span><span class="o">.</span><span class="n">Calc_EffectiveWaterLevelDifference_V1</span><span class="p">,</span>
        <span class="n">dam_model</span><span class="o">.</span><span class="n">Calc_MaxFreeDischarge_V1</span><span class="p">,</span>
        <span class="n">dam_model</span><span class="o">.</span><span class="n">Calc_FreeDischarge_V1</span><span class="p">,</span>
        <span class="n">dam_model</span><span class="o">.</span><span class="n">Calc_ActualEvaporation_V1</span><span class="p">,</span>
        <span class="n">dam_model</span><span class="o">.</span><span class="n">Calc_Outflow_V4</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">FULL_ODE_METHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">dam_model</span><span class="o">.</span><span class="n">Update_WaterVolume_V1</span><span class="p">,)</span>
    <span class="n">OUTLET_METHODS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">dam_model</span><span class="o">.</span><span class="n">Calc_WaterLevel_V1</span><span class="p">,</span>
        <span class="n">dam_model</span><span class="o">.</span><span class="n">Calc_OuterWaterLevel_V1</span><span class="p">,</span>
        <span class="n">dam_model</span><span class="o">.</span><span class="n">Calc_RemoteWaterLevel_V1</span><span class="p">,</span>
        <span class="n">dam_model</span><span class="o">.</span><span class="n">Pass_Outflow_V1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">SENDER_METHODS</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">SUBMODELINTERFACES</span> <span class="o">=</span> <span class="p">(</span><span class="n">precipinterfaces</span><span class="o">.</span><span class="n">PrecipModel_V2</span><span class="p">,</span> <span class="n">petinterfaces</span><span class="o">.</span><span class="n">PETModel_V1</span><span class="p">)</span>
    <span class="n">SUBMODELS</span> <span class="o">=</span> <span class="p">()</span>

    <span class="n">precipmodel</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelProperty</span><span class="p">(</span>
        <span class="n">precipinterfaces</span><span class="o">.</span><span class="n">PrecipModel_V2</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="n">pemodel</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelProperty</span><span class="p">(</span><span class="n">petinterfaces</span><span class="o">.</span><span class="n">PETModel_V1</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<div class="viewcode-block" id="Model.check_waterbalance">
<a class="viewcode-back" href="../../../dam_sluice.html#hydpy.models.dam_sluice.Model.check_waterbalance">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_waterbalance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initial_conditions</span><span class="p">:</span> <span class="n">ConditionsModel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Determine the water balance error of the previous simulation run in million</span>
<span class="sd">        m³.</span>

<span class="sd">        Method |Model.check_waterbalance| calculates the balance error as follows:</span>

<span class="sd">        :math:`Seconds \cdot 10^{-6} \cdot \sum_{t=t0}^{t1}</span>
<span class="sd">        \big( AdjustedPrecipitation_t - ActualEvaporation_t + Inflow_t - Outflow_t \big)</span>
<span class="sd">        + \big( WaterVolume_{t0}^k - WaterVolume_{t1}^k \big)`</span>

<span class="sd">        The returned error should always be in scale with numerical precision so</span>
<span class="sd">        that it does not affect the simulation results in any relevant manner.</span>

<span class="sd">        Pick the required initial conditions before starting the simulation run via</span>
<span class="sd">        property |Sequences.conditions|.  See the integration tests of the application</span>
<span class="sd">        model |dam_lreservoir| for some examples.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fluxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span>
        <span class="n">first</span> <span class="o">=</span> <span class="n">initial_conditions</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">][</span><span class="s2">&quot;states&quot;</span><span class="p">]</span>
        <span class="n">last</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">timegrids</span><span class="o">.</span><span class="n">stepsize</span><span class="o">.</span><span class="n">seconds</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
            <span class="nb">sum</span><span class="p">(</span><span class="n">fluxes</span><span class="o">.</span><span class="n">adjustedprecipitation</span><span class="o">.</span><span class="n">series</span><span class="p">)</span>
            <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">fluxes</span><span class="o">.</span><span class="n">actualevaporation</span><span class="o">.</span><span class="n">series</span><span class="p">)</span>
            <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="n">fluxes</span><span class="o">.</span><span class="n">inflow</span><span class="o">.</span><span class="n">series</span><span class="p">)</span>
            <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">fluxes</span><span class="o">.</span><span class="n">outflow</span><span class="o">.</span><span class="n">series</span><span class="p">)</span>
        <span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">last</span><span class="o">.</span><span class="n">watervolume</span> <span class="o">-</span> <span class="n">first</span><span class="p">[</span><span class="s2">&quot;watervolume&quot;</span><span class="p">])</span></div>
</div>



<span class="n">tester</span> <span class="o">=</span> <span class="n">Tester</span><span class="p">()</span>
<span class="n">cythonizer</span> <span class="o">=</span> <span class="n">Cythonizer</span><span class="p">()</span>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">HydPy 6.1.5 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">hydpy.models.dam_sluice</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2013-2025, HydPy Developers.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.2.3.
    </div>
  </body>
</html>