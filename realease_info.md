***HydPy 4.0.0***

Its been a while since we released *HydPy 3.1*, and much has happened since then.  The following listing points out only the highlights of the improvements *HydPy 4.0* comes with.

Regarding the model collection:
 * Our "old" LARSIM-like application models [lland_v1 (Turc-Wendling, Degree day)](https://hydpy-dev.github.io/hydpy/4.0/lland_v1.html) and [lland_v2 (External PET, Degree day)](https://hydpy-dev.github.io/hydpy/4.0/lland_v2.html) now include a wider range of the original LARSIM options (e.g. capillary rise). 
 * The new model [lland_v3 (Penman-Monteith, Knauf)](https://hydpy-dev.github.io/hydpy/4.0/lland_v3.html) includes LARSIM options frequently applied in the context of runoff forecasting in Germany (e.g. snow energy balance calculations after Knauf, 2006).
 * [lland_v4 (Penman-Monteith, Knauf, snow interception)](https://hydpy-dev.github.io/hydpy/4.0/lland_v4.html) extends  [lland_v3](https://hydpy-dev.github.io/hydpy/4.0/lland_v3.html) by the process of snow interception.
 * [lstream_v001 (Kinematic Wave, Manning-Strickler)](https://hydpy-dev.github.io/hydpy/4.0/lstream_v001.html) now keeps the water-balance perfectly.  We achieved this by implementing LARSIM's "kinematic wave approach" instead of its original (problematic) Williams-like approach.
 * [lstream_v002 (Kinematic wave, External rating curve)](https://hydpy-dev.github.io/hydpy/4.0/lstream_v002.html) works like [lstream_v001](https://hydpy-dev.github.io/hydpy/4.0/lstream_v001.html)  but expects the relationship between water-stage and discharge to be calculated externally (e.g. by a hydrodynamical model).
 * [dam_v006 (controlled lake)](https://hydpy-dev.github.io/hydpy/4.0/dam_v006.html), [dam_v007 (retention basin)](https://hydpy-dev.github.io/hydpy/4.0/dam_v007.html), and [dam_v008 (reservoir)](https://hydpy-dev.github.io/hydpy/4.0/dam_v008.html) are close emulations of the LARSIM models for representing lakes (SEEG), retention basins (RUEC) and reservoirs (TALS).
 * [evap_v001 (FAO 56 PM)](https://hydpy-dev.github.io/hydpy/4.0/evap_v001.html) is our first pure "evaporation model" and implements the commonly applied [FAO guideline](http://www.fao.org/3/x0490e/x0490e00.htm) for calculating potential  evapotranspiration. 
 * The "Converter" models [conv_v001 (Nearest Neighbour)](https://hydpy-dev.github.io/hydpy/4.0/conv_v001.html), [conv_v002 (Inverse Distance Weighting)](https://hydpy-dev.github.io/hydpy/4.0/conv_v002.html), and [conv_v003 (Inverse Distance Weighting with External Drift)](https://hydpy-dev.github.io/hydpy/4.0/conv_v003.html) work technically like all other models but are no hydrological models.  You can apply them for interpolating input data (e.g. temperature) or the output data of arbitrary models (e.g. the potential evaporation calculated by [evap_v001](https://hydpy-dev.github.io/hydpy/4.0/evap_v001.html)).
 * [wland_v001 (semi-distributed WALRUS model)](https://hydpy-dev.github.io/hydpy/4.0/wland_v001.html) is a (slightly extended) implementation of the [WALRUS](https://www.wur.nl/en/Research-Results/Chair-groups/Environmental-Sciences/Hydrology-and-Quantitative-Water-Management-Group/Research/WALRUS.htm) model, designed to simulate surface water fluxes in lowland catchments influenced by near-surface groundwater. 
 * [wland_v002 (experimental)](https://hydpy-dev.github.io/hydpy/4.0/wland_v002.html) is, as the name suggests, work in practice.  So far, it simulates faster responses of the groundwater table than the original model due to more explicit considerations of the capillary-fringe.  We currently discuss other modifications to improve the WALRUS performance for "moderate-flat" catchments.

Note that, due to their extension, [lland_v1](https://hydpy-dev.github.io/hydpy/4.0/lland_v1.html) and [lland_v2](https://hydpy-dev.github.io/hydpy/4.0/lland_v2.html) now require some additional parameters. 

Be aware that we might change some aspects of [lland_v3](https://hydpy-dev.github.io/hydpy/4.0/lland_v3.html) later.  We will probably unify some parameter names and possibly even modify some equations.

General features:
 * We now test *HydPy* from Python 3.6 to 3.9 (we think about dropping 3.6, but postpone this for the sake of keeping compatibility with the arcpy library of ArcGIS).
 * The command "pip install hydpy" now installs *HydPy* and all its requirements in one step.
 * Our AppVeyor workflow now creates an "HydPy-Installer" based on Python 3.9 for Windows.  This is for users who want to experiment with *HydPy* without installing a complete Python environment or want to have a robust executable for just executing certain tasks (e.g. flood forecasting).
 * We improved many features of the online documentation.  Many new automatically generated links help to browse through the different pages (for example, to directly jump from a parameter to the methods/equation requiring this parameter). Additionally, we start providing the documentation of several  *HydPy* versions in parallel (for now, version 4.0 and our current development status, the "master branch"; others will follow).
 * *HydPy* now provides some [server functionalities](https://hydpy-dev.github.io/hydpy/4.0/servertools.html).  The reason is to simplify the online coupling to non-Python software like [OpenDA](https://www.openda.org/) (for more information, see the separate documentation of our [OpenDA-Adapter](https://github.com/hydpy-dev/OpenDA)).
 * We added and extended lots of "user-comfort" functionalities concerning [calibration](https://hydpy-dev.github.io/hydpy/4.0/calibtools.html), [evaluation](https://hydpy-dev.github.io/hydpy/4.0/statstools.html), [plotting](https://hydpy-dev.github.io/hydpy/4.0/devicetools.html#hydpy.core.devicetools.Element.plot_inputseries), and much more.

Scientifical and technical aspects:
 * We finally achieved a test coverage of 100 %.  Our Travis-CI workflow does not accept any changes with incomplete coverage. And everything is tested "publically" in the HTML documentation (using doctests). This is a really significant milestone, as it makes introducing bugs much harder and allows the hydrological community to check all implemented equations easily "by hand". We are not aware of any other hydrological modelling system with such an eager and transparent test system.
 * We improved the tables and figures showing the results of the model integration tests. We hope they now better guide into the depth of such huge models as  [lland_v3](https://hydpy-dev.github.io/hydpy/4.0/lland_v3.html) and help to understand their details and possible implementation deficits. Our Travis-CI workflow automatically recreates all figures for each new release, so you can always be sure they are up-to-date.
 * The source code is now consistently formatted with [black](https://github.com/psf/black).
 * We started to add type hints to the source code following [PEP 484](https://www.python.org/dev/peps/pep-0484/). These improve the readability for code-analysis tools (and often also for humans) and improve IDE-functions like autocompletion and bug-analysis. So far, these cover most of the features directly accessible to the user. We continue working on this.
 * We increased the performance of *HydPy*, mainly regarding initialisation. Two examples are the "lazy importing" of optional site-packages which are seldom required (finished) and the caching of pre-compiled byte-code (still room for improvements).

Most of the listed (and unlisted) improvements were implemented on behalf of the [German Federal Institute of Hydrology](https://www.bafg.de/EN/Home/homepage_en_node.html) and the [Forecasting Centre of the German federal state of Saxony (Landeshochwasserzentrum)](https://www.umwelt.sachsen.de/umwelt/infosysteme/lhwz/index.html).
