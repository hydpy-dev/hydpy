
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>pointerutils &#8212; HydPy 4.0.1 documentation</title>
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="quadutils" href="quadutils.html" />
    <link rel="prev" title="modelutils" href="modelutils.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="quadutils.html" title="quadutils"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="modelutils.html" title="modelutils"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">HydPy 4.0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="framework.html" >Framework Tools</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="cythons.html" accesskey="U">Cython Tools</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">pointerutils</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="pointerutils">
<span id="id1"></span><h1>pointerutils<a class="headerlink" href="#pointerutils" title="Permalink to this headline">¶</a></h1>
<span class="target" id="module-hydpy.cythons.pointerutils"></span><p>This module gives Python objects pointer access to C variables of type
<cite>double</cite> via Cython.</p>
<dl class="simple">
<dt>Module <code class="xref py py-mod docutils literal notranslate"><span class="pre">pointerutils</span></code> implements the following Cython extension types:</dt><dd><ul class="simple">
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">DoubleBase</span></code>: Base class, only for inheritance.</p></li>
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">Double</span></code>: For C variables of type double.</p></li>
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">PDouble</span></code>: For C pointers referencing a single C variable of type double.</p></li>
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">PPDouble</span></code>: For C pointers referencing multiple C variables of type double.</p></li>
</ul>
</dd>
</dl>
<p>Classes <code class="xref py py-class docutils literal notranslate"><span class="pre">Double</span></code> and <code class="xref py py-class docutils literal notranslate"><span class="pre">PDouble</span></code> support arithmetic operations in a similar
manner as the immutable standard data type for floating-point operations
(<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></a>). <code class="xref py py-class docutils literal notranslate"><span class="pre">Double</span></code> and <code class="xref py py-class docutils literal notranslate"><span class="pre">PDouble</span></code> should be preferred over <a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></a> only
when their pointer functionality is required.  At the moment, the only usage
of <code class="xref py py-class docutils literal notranslate"><span class="pre">Double</span></code> and <code class="xref py py-class docutils literal notranslate"><span class="pre">PDouble</span></code> within <em>HydPy</em> is to directly share information
between <a class="reference internal" href="sequencetools.html#hydpy.core.sequencetools.NodeSequence" title="hydpy.core.sequencetools.NodeSequence"><code class="xref py py-class docutils literal notranslate"><span class="pre">NodeSequence</span></code></a> objects of <a class="reference internal" href="devicetools.html#hydpy.core.devicetools.Node" title="hydpy.core.devicetools.Node"><code class="xref py py-class docutils literal notranslate"><span class="pre">Node</span></code></a> instances and <a class="reference internal" href="sequencetools.html#hydpy.core.sequencetools.LinkSequence" title="hydpy.core.sequencetools.LinkSequence"><code class="xref py py-class docutils literal notranslate"><span class="pre">LinkSequence</span></code></a>
objects of <a class="reference internal" href="modeltools.html#hydpy.core.modeltools.Model" title="hydpy.core.modeltools.Model"><code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code></a> instances handled by <a class="reference internal" href="devicetools.html#hydpy.core.devicetools.Element" title="hydpy.core.devicetools.Element"><code class="xref py py-class docutils literal notranslate"><span class="pre">Element</span></code></a> instances.</p>
<p>The following examples try to give an idea of the purpose of using pointers
in <em>HydPy</em>.</p>
<p>To use the <a class="reference external" href="https://numpy.org/doc/stable/reference/index.html#module-numpy" title="(in NumPy v1.20)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">numpy</span></code></a> <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.20)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></a> offers the advantage to be able to address
the same data with different Python and Cython objects:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">hydpy.cythons.pointerutils</span> <span class="kn">import</span> <span class="n">Double</span><span class="p">,</span> <span class="n">PDouble</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">xs</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ys</span> <span class="o">=</span> <span class="n">xs</span><span class="p">[:]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">xs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ys</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mf">3.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="nb">all</span><span class="p">(</span><span class="n">xs</span> <span class="o">==</span> <span class="n">ys</span><span class="p">),</span> <span class="n">xs</span> <span class="ow">is</span> <span class="n">ys</span><span class="p">)</span>
<span class="go">True False</span>
</pre></div>
</div>
<p>Both “names” <cite>x</cite> and <cite>y</cite> refer to the same data.  Hence data can
easily be shared between different objects, no matter if they are Python
or Cython types.  Unfortunately, <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.20)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></a> is primarily
designed to handle at least 1-dimensional data.  Using it for scalar values
stored within a “0-dimensional array” is possible, but has some drawbacks.
Hence, one would usually use the Python build in <a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></a> for scalar values:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">x</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="ow">is</span> <span class="n">y</span><span class="p">)</span>
<span class="go">False False</span>
</pre></div>
</div>
<p>Now <cite>x</cite> and <cite>y</cite> refer to different data. As an alternative, C implements
the concept of pointers.  Wrapped in Cython objects of the types <code class="xref py py-class docutils literal notranslate"><span class="pre">Double</span></code>
and <code class="xref py py-class docutils literal notranslate"><span class="pre">PDouble</span></code>, this concept provides the following benefit:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dx</span> <span class="o">=</span> <span class="n">Double</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dx</span>
<span class="go">Double(0.0)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">px</span> <span class="o">=</span> <span class="n">PDouble</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">px</span>
<span class="go">PDouble(Double(0.0))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dx</span><span class="o">.</span><span class="n">setvalue</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dx</span>
<span class="go">Double(1.0)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">px</span>
<span class="go">PDouble(Double(1.0))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">px</span><span class="o">.</span><span class="n">setvalue</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dx</span>
<span class="go">Double(2.0)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">px</span>
<span class="go">PDouble(Double(2.0))</span>
</pre></div>
</div>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">Double</span></code> and <code class="xref py py-class docutils literal notranslate"><span class="pre">PDouble</span></code> implement many convenience functions, allowing,
for example, to use them in numerical calculations as if they were <a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></a>
objects.  For demonstration purposes, we prepare two objects with different v
alues of each type, respectively:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fx</span><span class="p">,</span> <span class="n">fy</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="n">Double</span><span class="p">(</span><span class="n">fx</span><span class="p">),</span> <span class="n">Double</span><span class="p">(</span><span class="n">fy</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">px</span><span class="p">,</span> <span class="n">py</span> <span class="o">=</span> <span class="n">PDouble</span><span class="p">(</span><span class="n">dx</span><span class="p">),</span> <span class="n">PDouble</span><span class="p">(</span><span class="n">dy</span><span class="p">)</span>
</pre></div>
</div>
<p>You can combine <code class="xref py py-class docutils literal notranslate"><span class="pre">Double</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">PDouble</span></code> and <a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></a> in any calculation.
The following example demonstrates all possible combinations using the
<cite>add</cite> operator:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">hydpy</span> <span class="kn">import</span> <span class="n">round_</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">round_</span><span class="p">(</span><span class="n">dx</span> <span class="o">+</span> <span class="n">dy</span><span class="p">)</span>
<span class="go">-1.3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">round_</span><span class="p">(</span><span class="n">px</span> <span class="o">+</span> <span class="n">py</span><span class="p">)</span>
<span class="go">-1.3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">round_</span><span class="p">(</span><span class="n">dx</span> <span class="o">+</span> <span class="n">py</span><span class="p">)</span>
<span class="go">-1.3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">round_</span><span class="p">(</span><span class="n">py</span> <span class="o">+</span> <span class="n">dx</span><span class="p">)</span>
<span class="go">-1.3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">round_</span><span class="p">(</span><span class="n">dx</span> <span class="o">+</span> <span class="n">fy</span><span class="p">)</span>
<span class="go">-1.3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">round_</span><span class="p">(</span><span class="n">fy</span> <span class="o">+</span> <span class="n">dx</span><span class="p">)</span>
<span class="go">-1.3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">round_</span><span class="p">(</span><span class="n">py</span> <span class="o">+</span> <span class="n">fx</span><span class="p">)</span>
<span class="go">-1.3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">round_</span><span class="p">(</span><span class="n">fx</span> <span class="o">+</span> <span class="n">py</span><span class="p">)</span>
<span class="go">-1.3</span>
</pre></div>
</div>
<p>The following other binary and unary operators are supported as well:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">round_</span><span class="p">((</span><span class="n">fx</span> <span class="o">-</span> <span class="n">fy</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">dx</span> <span class="o">-</span> <span class="n">dy</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">px</span> <span class="o">-</span> <span class="n">py</span><span class="p">))</span>
<span class="go">9.9</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">round_</span><span class="p">((</span><span class="n">fx</span> <span class="o">*</span> <span class="n">fy</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">dx</span> <span class="o">*</span> <span class="n">dy</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">px</span> <span class="o">*</span> <span class="n">py</span><span class="p">))</span>
<span class="go">-6.9</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">round_</span><span class="p">((</span><span class="n">fx</span> <span class="o">/</span> <span class="n">fy</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">dx</span> <span class="o">/</span> <span class="n">dy</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">px</span> <span class="o">/</span> <span class="n">py</span><span class="p">))</span>
<span class="go">-1.304348</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">round_</span><span class="p">((</span><span class="n">fx</span> <span class="o">//</span> <span class="n">fy</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">dx</span> <span class="o">//</span> <span class="n">dy</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">px</span> <span class="o">//</span> <span class="n">py</span><span class="p">))</span>
<span class="go">-3.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">round_</span><span class="p">((</span><span class="n">fx</span> <span class="o">%</span> <span class="n">fy</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">dx</span> <span class="o">%</span> <span class="n">dy</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">px</span> <span class="o">%</span> <span class="n">py</span><span class="p">))</span>
<span class="go">-3.9</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">round_</span><span class="p">((</span><span class="mf">2.0</span><span class="o">**</span><span class="n">fy</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">Double</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span><span class="o">**</span><span class="n">dy</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">PDouble</span><span class="p">(</span><span class="n">Double</span><span class="p">(</span><span class="mf">2.0</span><span class="p">))</span><span class="o">**</span><span class="n">py</span><span class="p">))</span>
<span class="go">0.609189</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">round_</span><span class="p">(</span><span class="o">+</span><span class="n">fy</span> <span class="o">+</span> <span class="o">+</span><span class="n">dy</span> <span class="o">+</span> <span class="o">+</span><span class="n">py</span><span class="p">)</span>
<span class="go">-6.9</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">round_</span><span class="p">(</span><span class="o">-</span><span class="n">fy</span> <span class="o">+</span> <span class="o">-</span><span class="n">dy</span> <span class="o">+</span> <span class="o">-</span><span class="n">py</span><span class="p">)</span>
<span class="go">6.9</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">round_</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">fy</span> <span class="o">+</span> <span class="o">~</span><span class="n">dy</span> <span class="o">+</span> <span class="o">~</span><span class="n">py</span><span class="p">)</span>
<span class="go">-1.304348</span>
</pre></div>
</div>
<p>We support the following type conversions:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">str</span><span class="p">(</span><span class="n">dx</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">px</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">py</span><span class="p">),</span> <span class="nb">bool</span><span class="p">(</span><span class="n">py</span><span class="p">)</span>
<span class="go">(&#39;1.0&#39;, 1, -2.3, True)</span>
</pre></div>
</div>
<p>All comparison operators are supported:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">dx</span> <span class="o">&lt;</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dx</span> <span class="o">&lt;=</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dx</span><span class="o">==</span><span class="n">dx</span><span class="p">,</span> <span class="n">dx</span><span class="o">!=</span><span class="n">dx</span><span class="p">,</span> <span class="n">dx</span><span class="o">&gt;=</span><span class="n">dx</span><span class="p">,</span> <span class="n">dx</span><span class="o">&gt;</span><span class="n">dx</span><span class="p">)</span>
<span class="go">(False, True, True, False, True, False)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">px</span> <span class="o">&lt;</span> <span class="n">py</span><span class="p">,</span> <span class="n">px</span> <span class="o">&lt;=</span> <span class="n">py</span><span class="p">,</span> <span class="n">px</span><span class="o">==</span><span class="n">py</span><span class="p">,</span> <span class="n">px</span><span class="o">!=</span><span class="n">py</span><span class="p">,</span> <span class="n">px</span><span class="o">&gt;=</span><span class="n">py</span><span class="p">,</span> <span class="n">px</span><span class="o">&gt;</span><span class="n">py</span><span class="p">)</span>
<span class="go">(False, False, False, True, True, True)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">dy</span> <span class="o">&lt;</span> <span class="n">px</span><span class="p">,</span> <span class="n">dy</span> <span class="o">&lt;=</span> <span class="n">px</span><span class="p">,</span> <span class="n">dy</span><span class="o">==</span><span class="n">px</span><span class="p">,</span> <span class="n">dy</span><span class="o">!=</span><span class="n">px</span><span class="p">,</span> <span class="n">dy</span><span class="o">&gt;=</span><span class="n">px</span><span class="p">,</span> <span class="n">dy</span><span class="o">&gt;</span><span class="n">px</span><span class="p">)</span>
<span class="go">(True, True, False, True, False, False)</span>
</pre></div>
</div>
<p>You can apply the familiar in-place operators:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dx</span> <span class="o">+=</span> <span class="mf">1.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">round_</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span>
<span class="go">2.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">px</span> <span class="o">-=</span> <span class="mf">1.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">round_</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span>
<span class="go">1.0</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dx</span> <span class="o">-=</span> <span class="mf">1.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">round_</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span>
<span class="go">0.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">px</span> <span class="o">+=</span> <span class="mf">1.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">round_</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span>
<span class="go">1.0</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dx</span> <span class="o">*=</span> <span class="mf">2.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">round_</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span>
<span class="go">2.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">px</span> <span class="o">/=</span> <span class="mf">2.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">round_</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span>
<span class="go">1.0</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dx</span> <span class="o">/=</span> <span class="mf">2.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">round_</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span>
<span class="go">0.5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">px</span> <span class="o">*=</span> <span class="mf">2.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">round_</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span>
<span class="go">1.0</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dx</span> <span class="o">=</span> <span class="n">Double</span><span class="p">(</span><span class="mf">2.5</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">px</span> <span class="o">=</span> <span class="n">PDouble</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dx</span> <span class="o">//=</span> <span class="mf">2.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">round_</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span>
<span class="go">1.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">px</span> <span class="o">//=</span> <span class="mf">0.3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">round_</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span>
<span class="go">3.0</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dx</span> <span class="o">%=</span> <span class="mf">2.5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">round_</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span>
<span class="go">0.5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">px</span> <span class="o">%=</span> <span class="mf">0.2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">round_</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span>
<span class="go">0.1</span>
</pre></div>
</div>
<p>To increase consistency between Python code and Cython code (Cython
uses <cite>[0]</cite> as dereferencing syntax) as well as between <code class="xref py py-class docutils literal notranslate"><span class="pre">PDouble</span></code> and
<a class="reference external" href="https://numpy.org/doc/stable/reference/index.html#module-numpy" title="(in NumPy v1.20)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">numpy</span></code></a> arrays (supporting <cite>[:]</cite> slicing), you are allowed to use
arbitrary objects as indices (actually, <code class="xref py py-class docutils literal notranslate"><span class="pre">Double</span></code> and <code class="xref py py-class docutils literal notranslate"><span class="pre">PDouble</span></code> simply
ignore them).</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">py</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">999.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">py</span><span class="p">[:]</span>
<span class="go">-999.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dx</span><span class="p">[:]</span> <span class="o">=</span> <span class="mf">123.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">123.0</span>
</pre></div>
</div>
<p>To resemble 0-dimensional <a class="reference external" href="https://numpy.org/doc/stable/reference/index.html#module-numpy" title="(in NumPy v1.20)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">numpy</span></code></a> arrays, <code class="xref py py-class docutils literal notranslate"><span class="pre">Double</span></code> and <code class="xref py py-class docutils literal notranslate"><span class="pre">PDouble</span></code> return
empty tuples as shape information.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">dx</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">px</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="go">() ()</span>
</pre></div>
</div>
<p>Always remember that, even if not immediately evident, you are working with
pointers.</p>
<p>You are allowed to initialise a <code class="xref py py-class docutils literal notranslate"><span class="pre">PDouble</span></code> object without giving a <code class="xref py py-class docutils literal notranslate"><span class="pre">Double</span></code>
instance to the constructor, but do not do this unless you have an idea
how to specify the proper memory address later:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">px</span> <span class="o">=</span> <span class="n">PDouble</span><span class="p">()</span>
</pre></div>
</div>
<p>You can construct multiple pointers referencing the same double value:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dx</span> <span class="o">=</span> <span class="n">Double</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">px1</span><span class="p">,</span> <span class="n">px2</span> <span class="o">=</span> <span class="n">PDouble</span><span class="p">(</span><span class="n">dx</span><span class="p">),</span> <span class="n">PDouble</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">px1</span><span class="p">,</span> <span class="n">px2</span><span class="p">)</span>
<span class="go">1.0 1.0 1.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dx</span> <span class="o">+=</span> <span class="mf">1.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">px1</span><span class="p">,</span> <span class="n">px2</span><span class="p">)</span>
<span class="go">2.0 2.0 2.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">px1</span> <span class="o">-=</span> <span class="mf">1.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">px1</span><span class="p">,</span> <span class="n">px2</span><span class="p">)</span>
<span class="go">1.0 1.0 1.0</span>
</pre></div>
</div>
<p>After deleting the original <code class="xref py py-class docutils literal notranslate"><span class="pre">Double</span></code> object, continuing to
use the associated <code class="xref py py-class docutils literal notranslate"><span class="pre">PDouble</span></code> object(s) corrupts your program, as the
pointed position in memory is freed for other purposes:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">dx</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">px1</span> <span class="o">+=</span> <span class="mf">1.0</span> <span class="c1"># Possibly corrupts your program.</span>
</pre></div>
</div>
<dl class="simple">
<dt>Note:</dt><dd><p><code class="xref py py-class docutils literal notranslate"><span class="pre">Double</span></code> is used in Python mode only; in Cython mode, the usual
C type <cite>double</cite> is applied.  <code class="xref py py-class docutils literal notranslate"><span class="pre">PDouble</span></code> is also used in Cython mode,
where it primarily serves the purpose to  pass C pointers of type
<cite>double</cite> from one Cython module to another one.</p>
</dd>
</dl>
<p>A <code class="xref py py-class docutils literal notranslate"><span class="pre">PDouble</span></code> object can point to the value of a single <code class="xref py py-class docutils literal notranslate"><span class="pre">Double</span></code> object.
Instead, <code class="xref py py-class docutils literal notranslate"><span class="pre">PPDouble</span></code> allows pointing to an arbitrary number of <code class="xref py py-class docutils literal notranslate"><span class="pre">Double</span></code>
objects.  After initialisation, one needs to specify their <cite>shape</cite>
first, defining the number of <code class="xref py py-class docutils literal notranslate"><span class="pre">Double</span></code> objects to be taken into account:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">hydpy.cythons.pointerutils</span> <span class="kn">import</span> <span class="n">PPDouble</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ppdouble</span> <span class="o">=</span> <span class="n">PPDouble</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ppdouble</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(0,)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ppdouble</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">RuntimeError</span>: <span class="n">The shape of the actual `PPDouble` instance has not been set yet, which is a necessary preparation before using it.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ppdouble</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">RuntimeError</span>: <span class="n">The shape of the actual `PPDouble` instance has not been set yet, which is a necessary preparation before using it.</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ppdouble</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="mi">4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ppdouble</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(4,)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ppdouble</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="mi">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ppdouble</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(3,)</span>
</pre></div>
</div>
<p>Trying to access values via invalid indices does result in errors
like the following:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ppdouble</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">IndexError</span>: <span class="n">The actual `PPDouble` instance is of length `3`.  Only index values between 0 and 2 are allowed, but the given index is `-1`.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ppdouble</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">IndexError</span>: <span class="n">The actual `PPDouble` instance is of length `3`.  Only index values between 0 and 2 are allowed, but the given index is `3`.</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ppdouble</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">RuntimeError</span>: <span class="n">The pointer of the actual `PPDouble` instance at index `0` requested, but not prepared yet via `set_pointer`.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ppdouble</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">RuntimeError</span>: <span class="n">The pointer of the actual `PPDouble` instance at index `0` requested, but not prepared yet via `set_pointer`.</span>
</pre></div>
</div>
<p>To finally prepare our <code class="xref py py-class docutils literal notranslate"><span class="pre">PPDouble</span></code> object, we need to assign <code class="xref py py-class docutils literal notranslate"><span class="pre">Double</span></code> objects
to it via method <cite>set_pointer</cite>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">,</span> <span class="n">d3</span> <span class="o">=</span> <span class="n">Double</span><span class="p">(</span><span class="mf">1.0</span><span class="p">),</span> <span class="n">Double</span><span class="p">(</span><span class="mf">2.0</span><span class="p">),</span> <span class="n">Double</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ppdouble</span><span class="o">.</span><span class="n">set_pointer</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ppdouble</span><span class="o">.</span><span class="n">set_pointer</span><span class="p">(</span><span class="n">d2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ppdouble</span><span class="o">.</span><span class="n">set_pointer</span><span class="p">(</span><span class="n">d3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we can query and modify the current values of the <code class="xref py py-class docutils literal notranslate"><span class="pre">Double</span></code> objects
via our <code class="xref py py-class docutils literal notranslate"><span class="pre">PPDouble</span></code> object:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">ppdouble</span><span class="p">[:])</span>
<span class="go">[PDouble(Double(1.0)) PDouble(Double(2.0)) PDouble(Double(3.0))]</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ppdouble</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">8.0</span><span class="p">,</span> <span class="mf">9.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d3</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">ppdouble</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">d1</span><span class="p">)</span>
<span class="go">8.0 8.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">ppdouble</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">d2</span><span class="p">)</span>
<span class="go">9.0 9.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">ppdouble</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">d3</span><span class="p">)</span>
<span class="go">-1.0 -1.0</span>
</pre></div>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/HydPy_Logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="how_to.html">How to…</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="framework.html">Framework Tools</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="core.html">Core Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="execution.html">Execution Tools</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="cythons.html">Cython Tools</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="annutils.html">annutils</a></li>
<li class="toctree-l3"><a class="reference internal" href="configutils.html">configutils</a></li>
<li class="toctree-l3"><a class="reference internal" href="modelutils.html">modelutils</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">pointerutils</a></li>
<li class="toctree-l3"><a class="reference internal" href="quadutils.html">quadutils</a></li>
<li class="toctree-l3"><a class="reference internal" href="rootutils.html">rootutils</a></li>
<li class="toctree-l3"><a class="reference internal" href="sequenceutils.html">sequenceutils</a></li>
<li class="toctree-l3"><a class="reference internal" href="smoothutils.html">smoothutils</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="auxiliaries.html">Auxiliary Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuration.html">Configuration Tools</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="modelcollection.html">Model Collection</a></li>
<li class="toctree-l1"><a class="reference internal" href="development.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Example Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="zbibliography.html">Bibliography</a></li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="modelutils.html"
                        title="previous chapter">modelutils</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="quadutils.html"
                        title="next chapter">quadutils</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/pointerutils.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="quadutils.html" title="quadutils"
             >next</a> |</li>
        <li class="right" >
          <a href="modelutils.html" title="modelutils"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">HydPy 4.0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="framework.html" >Framework Tools</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="cythons.html" >Cython Tools</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">pointerutils</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2021, HydPy Developers.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.5.2.
    </div>
  </body>
</html>