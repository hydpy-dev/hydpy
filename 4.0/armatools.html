
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>armatools &#8212; HydPy 4.0.1 documentation</title>
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="calibtools" href="calibtools.html" />
    <link rel="prev" title="anntools" href="anntools.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="calibtools.html" title="calibtools"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="anntools.html" title="anntools"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">HydPy 4.0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="framework.html" >Framework Tools</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="auxiliaries.html" accesskey="U">Auxiliary Tools</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">armatools</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="armatools">
<span id="id1"></span><h1>armatools<a class="headerlink" href="#armatools" title="Permalink to this headline">¶</a></h1>
<span class="target" id="module-hydpy.auxs.armatools"></span><p>This module provides additional features for module <a class="reference internal" href="iuhtools.html#module-hydpy.auxs.iuhtools" title="hydpy.auxs.iuhtools"><code class="xref py py-mod docutils literal notranslate"><span class="pre">iuhtools</span></code></a>,
related to Autoregressive-Moving Average (ARMA) models.</p>
<p>Module <a class="reference internal" href="#module-hydpy.auxs.armatools" title="hydpy.auxs.armatools"><code class="xref py py-mod docutils literal notranslate"><span class="pre">armatools</span></code></a> implements the following members:</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference internal" href="#hydpy.auxs.armatools.MA" title="hydpy.auxs.armatools.MA"><code class="xref py py-class docutils literal notranslate"><span class="pre">MA</span></code></a> Moving Average Model.</p></li>
<li><p><a class="reference internal" href="#hydpy.auxs.armatools.ARMA" title="hydpy.auxs.armatools.ARMA"><code class="xref py py-class docutils literal notranslate"><span class="pre">ARMA</span></code></a> Autoregressive-Moving Average model.</p></li>
</ul>
</div></blockquote>
<hr class="docutils" />
<dl class="py class">
<dt id="hydpy.auxs.armatools.MA">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">hydpy.auxs.armatools.</span></code><code class="sig-name descname"><span class="pre">MA</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">iuh</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">coefs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/hydpy/auxs/armatools.html#MA"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#hydpy.auxs.armatools.MA" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Moving Average Model.</p>
<p>The MA coefficients can be set manually:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">hydpy</span> <span class="kn">import</span> <span class="n">MA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ma</span> <span class="o">=</span> <span class="n">MA</span><span class="p">(</span><span class="n">coefs</span><span class="o">=</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ma</span>
<span class="go">MA(coefs=(0.8, 0.2))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ma</span><span class="o">.</span><span class="n">coefs</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.8</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ma</span>
<span class="go">MA(coefs=(0.2, 0.8))</span>
</pre></div>
</div>
<p>Otherwise they are determined by method <a class="reference internal" href="#hydpy.auxs.armatools.MA.update_coefs" title="hydpy.auxs.armatools.MA.update_coefs"><code class="xref py py-func docutils literal notranslate"><span class="pre">update_coefs()</span></code></a>.
But this requires that a integrable function object is given.
Usually, this function object is a <a class="reference internal" href="iuhtools.html#hydpy.auxs.iuhtools.IUH" title="hydpy.auxs.iuhtools.IUH"><code class="xref py py-class docutils literal notranslate"><span class="pre">IUH</span></code></a> subclass object, but
(as in the following example) other function objects defining
instantaneuous unit hydrographs are accepted.  However, they
should be well-behaved (e.g. be relatively smooth, unimodal,
strictly positive, unity integral surface in the positive range).</p>
<p>For educational purposes, some discontinuous functions are applied in
the following. One can suppress the associated warning messages with
the following commands:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">integrate</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">integrate</span><span class="o">.</span><span class="n">IntegrationWarning</span><span class="p">)</span>
</pre></div>
</div>
<p>The first example is a simple rectangle impuls:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ma</span> <span class="o">=</span> <span class="n">MA</span><span class="p">(</span><span class="n">iuh</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">0.05</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mf">20.0</span> <span class="k">else</span> <span class="mf">0.0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ma</span><span class="o">.</span><span class="n">iuh</span><span class="o">.</span><span class="n">moment1</span> <span class="o">=</span> <span class="mf">10.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ma</span>
<span class="go">MA(coefs=(0.025, 0.05, 0.05, 0.05, 0.05, 0.05, 0.05, 0.05, 0.05, 0.05,</span>
<span class="go">          0.05, 0.05, 0.05, 0.05, 0.05, 0.05, 0.05, 0.05, 0.05, 0.05,</span>
<span class="go">          0.025))</span>
</pre></div>
</div>
<p>The number of the coefficients can be modified by changing the
class attribute <a class="reference internal" href="#hydpy.auxs.armatools.MA.smallest_coeff" title="hydpy.auxs.armatools.MA.smallest_coeff"><code class="xref py py-const docutils literal notranslate"><span class="pre">smallest_coeff</span></code></a>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ma</span><span class="o">.</span><span class="n">smallest_coeff</span> <span class="o">=</span> <span class="mf">0.03</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ma</span><span class="o">.</span><span class="n">update_coefs</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ma</span>
<span class="go">MA(coefs=(0.025641, 0.051282, 0.051282, 0.051282, 0.051282, 0.051282,</span>
<span class="go">          0.051282, 0.051282, 0.051282, 0.051282, 0.051282, 0.051282,</span>
<span class="go">          0.051282, 0.051282, 0.051282, 0.051282, 0.051282, 0.051282,</span>
<span class="go">          0.051282, 0.051282))</span>
</pre></div>
</div>
<p>The first two central moments of the time delay are a usefull measure for
describing the operation of a MA model:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ma</span> <span class="o">=</span> <span class="n">MA</span><span class="p">(</span><span class="n">iuh</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">1.0</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mf">1.0</span> <span class="k">else</span> <span class="mf">0.0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ma</span><span class="o">.</span><span class="n">iuh</span><span class="o">.</span><span class="n">moment1</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ma</span>
<span class="go">MA(coefs=(0.5, 0.5))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">hydpy</span> <span class="kn">import</span> <span class="n">round_</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">round_</span><span class="p">(</span><span class="n">ma</span><span class="o">.</span><span class="n">moments</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="go">0.5, 0.5</span>
</pre></div>
</div>
<p>The first central moment is the weigthed time delay (mean lag time).
The second central moment is the weighted mean deviation from the
mean lag time (diffusion).</p>
<p>MA objects can return the turning point in the recession part of their
MA coefficients.  This can be demonstrated for the right side of the
probability density function of the normal distribution with zero
mean and a standard deviation (turning point) of 10:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ma</span> <span class="o">=</span> <span class="n">MA</span><span class="p">(</span><span class="n">iuh</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ma</span><span class="o">.</span><span class="n">iuh</span><span class="o">.</span><span class="n">moment1</span> <span class="o">=</span> <span class="mf">1.35</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ma</span>
<span class="go">MA(coefs=(0.195417, 0.346659, 0.24189, 0.13277, 0.057318, 0.019458,</span>
<span class="go">          0.005193, 0.001089, 0.00018, 0.000023, 0.000002, 0.0, 0.0))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">round_</span><span class="p">(</span><span class="n">ma</span><span class="o">.</span><span class="n">turningpoint</span><span class="p">)</span>
<span class="go">2, 0.24189</span>
</pre></div>
</div>
<p>Note that the first returned value is the index of the the MA coefficient
closest to the turning point, and not a high precision estimate of
the real turning point of the instantaneous unit hydrograph.</p>
<p>You can also use the following ploting command to verify the position of
the turning point, which is printed as a red dot.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ma</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
</pre></div>
</div>
<p>The turning point detection also works for functions which include
both a rising and a falling limb.  This can be shown shifting the
normal distribution to the right:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ma</span><span class="o">.</span><span class="n">iuh</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">1.02328</span><span class="o">*</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ma</span><span class="o">.</span><span class="n">iuh</span><span class="o">.</span><span class="n">moment1</span> <span class="o">=</span> <span class="mf">3.94</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ma</span><span class="o">.</span><span class="n">update_coefs</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ma</span>
<span class="go">MA(coefs=(0.019322, 0.067931, 0.12376, 0.177364, 0.199966, 0.177364,</span>
<span class="go">          0.12376, 0.067931, 0.029326, 0.009956, 0.002657, 0.000557,</span>
<span class="go">          0.000092, 0.000012, 0.000001, 0.0, 0.0))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">round_</span><span class="p">(</span><span class="n">ma</span><span class="o">.</span><span class="n">turningpoint</span><span class="p">)</span>
<span class="go">6, 0.12376</span>
</pre></div>
</div>
<p>When no turning point can be detected, an error is raised:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ma</span><span class="o">.</span><span class="n">coefs</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ma</span><span class="o">.</span><span class="n">turningpoint</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">RuntimeError</span>: <span class="n">Not able to detect a turning point in the impulse response defined by the MA coefficients 1.0, 1.0, 1.0.</span>
</pre></div>
</div>
<p>The next example requires reactivating the warning suppressed above:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">integrate</span><span class="o">.</span><span class="n">IntegrationWarning</span><span class="p">)</span>
</pre></div>
</div>
<p>The MA coefficients need to be approximated numerically.  For very
spiky response function, the underlying integration algorithm might
fail.  Then it is assumed that the complete mass of the response
function is placed at a single delay time, defined by the property
<cite>moment1</cite> of the instantaneous unit hydrograph.  Hopefully, this
leads to plausible results.  However, we raise an additional warning
message to allow users to determine the coefficients by a different
approach :</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ma</span><span class="o">.</span><span class="n">iuh</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">10.0</span> <span class="k">if</span> <span class="mf">4.2</span> <span class="o">&lt;</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="mf">4.3</span> <span class="k">else</span> <span class="mf">0.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ma</span><span class="o">.</span><span class="n">iuh</span><span class="o">.</span><span class="n">moment1</span> <span class="o">=</span> <span class="mf">4.25</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ma</span><span class="o">.</span><span class="n">update_coefs</span><span class="p">()</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">UserWarning</span>: <span class="n">During the determination of the MA coefficients corresponding to the instantaneous unit hydrograph ... a numerical integration problem occurred.  Please check the calculated coefficients: 0.0, 0.0, 0.0, 0.0, 0.75, 0.25.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ma</span>
<span class="go">MA(coefs=(0.0, 0.0, 0.0, 0.0, 0.75, 0.25))</span>
</pre></div>
</div>
<p>For very steep response functions, numerical integration might fail:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ma</span> <span class="o">=</span> <span class="n">MA</span><span class="p">(</span><span class="n">iuh</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">1e-6</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ma</span><span class="o">.</span><span class="n">iuh</span><span class="o">.</span><span class="n">moment1</span> <span class="o">=</span> <span class="mf">4.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ma</span><span class="o">.</span><span class="n">update_coefs</span><span class="p">()</span>   
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">RuntimeError</span>: <span class="n">Cannot determine the MA coefficients corresponding to the instantaneous unit hydrograph `...`.</span>
</pre></div>
</div>
<p>For very fast responses, there should be only one MA coefficient that
has the value 1.  Method <a class="reference internal" href="#hydpy.auxs.armatools.MA.update_coefs" title="hydpy.auxs.armatools.MA.update_coefs"><code class="xref py py-func docutils literal notranslate"><span class="pre">update_coefs()</span></code></a> provides a heuristic for
such cases where numerical integration fails.  As we are not sure
that this heuristic works in all possible cases, <a class="reference internal" href="#hydpy.auxs.armatools.MA.update_coefs" title="hydpy.auxs.armatools.MA.update_coefs"><code class="xref py py-func docutils literal notranslate"><span class="pre">update_coefs()</span></code></a>
raises the following warning in such cases:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ma</span> <span class="o">=</span> <span class="n">MA</span><span class="p">(</span><span class="n">iuh</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">1e6</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1e6</span><span class="o">*</span><span class="n">x</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ma</span><span class="o">.</span><span class="n">iuh</span><span class="o">.</span><span class="n">moment1</span> <span class="o">=</span> <span class="mf">6.931e-7</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ma</span> 
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">UserWarning</span>: <span class="n">During the determination of the MA coefficients corresponding to the instantaneous unit hydrograph `...` a numerical integration problem occurred.  Please check the calculated coefficients: 1.0.</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ma</span>
<span class="go">MA(coefs=(1.0,))</span>
</pre></div>
</div>
<dl class="py attribute">
<dt id="hydpy.auxs.armatools.MA.smallest_coeff">
<code class="sig-name descname"><span class="pre">smallest_coeff</span></code><em class="property"> <span class="pre">=</span> <span class="pre">1e-09</span></em><a class="headerlink" href="#hydpy.auxs.armatools.MA.smallest_coeff" title="Permalink to this definition">¶</a></dt>
<dd><p>Smalles MA coefficient to be determined at the end of the response.</p>
</dd></dl>

<dl class="py method">
<dt id="hydpy.auxs.armatools.MA.coefs">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">coefs</span></code><a class="headerlink" href="#hydpy.auxs.armatools.MA.coefs" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.20)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></a> containing all MA coefficents.</p>
</dd></dl>

<dl class="py method">
<dt id="hydpy.auxs.armatools.MA.order">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">order</span></code><a class="headerlink" href="#hydpy.auxs.armatools.MA.order" title="Permalink to this definition">¶</a></dt>
<dd><p>MA order.</p>
</dd></dl>

<dl class="py method">
<dt id="hydpy.auxs.armatools.MA.update_coefs">
<code class="sig-name descname"><span class="pre">update_coefs</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/hydpy/auxs/armatools.html#MA.update_coefs"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#hydpy.auxs.armatools.MA.update_coefs" title="Permalink to this definition">¶</a></dt>
<dd><p>(Re)calculate the MA coefficients based on the instantaneous
unit hydrograph.</p>
</dd></dl>

<dl class="py method">
<dt id="hydpy.auxs.armatools.MA.turningpoint">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">turningpoint</span></code><a class="headerlink" href="#hydpy.auxs.armatools.MA.turningpoint" title="Permalink to this definition">¶</a></dt>
<dd><p>Turning point (index and value tuple) in the recession part of the
MA approximation of the instantaneous unit hydrograph.</p>
</dd></dl>

<dl class="py method">
<dt id="hydpy.auxs.armatools.MA.delays">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">delays</span></code><a class="headerlink" href="#hydpy.auxs.armatools.MA.delays" title="Permalink to this definition">¶</a></dt>
<dd><p>Time delays related to the individual MA coefficients.</p>
</dd></dl>

<dl class="py method">
<dt id="hydpy.auxs.armatools.MA.moments">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">moments</span></code><a class="headerlink" href="#hydpy.auxs.armatools.MA.moments" title="Permalink to this definition">¶</a></dt>
<dd><p>The first two time delay weighted statistical moments of the
MA coefficients.</p>
</dd></dl>

<dl class="py method">
<dt id="hydpy.auxs.armatools.MA.plot">
<code class="sig-name descname"><span class="pre">plot</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/hydpy/auxs/armatools.html#MA.plot"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#hydpy.auxs.armatools.MA.plot" title="Permalink to this definition">¶</a></dt>
<dd><p>Barplot of the MA coefficients.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="hydpy.auxs.armatools.ARMA">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">hydpy.auxs.armatools.</span></code><code class="sig-name descname"><span class="pre">ARMA</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ma_model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ar_coefs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ma_coefs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/hydpy/auxs/armatools.html#ARMA"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#hydpy.auxs.armatools.ARMA" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Autoregressive-Moving Average model.</p>
<p>All ARMA coefficients can be set manually:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">hydpy</span> <span class="kn">import</span> <span class="n">MA</span><span class="p">,</span> <span class="n">ARMA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">arma</span> <span class="o">=</span> <span class="n">ARMA</span><span class="p">(</span><span class="n">ar_coefs</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,),</span> <span class="n">ma_coefs</span><span class="o">=</span><span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">arma</span><span class="o">.</span><span class="n">coefs</span>
<span class="go">(array([ 0.5]), array([ 0.3,  0.2]))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">arma</span>
<span class="go">ARMA(ar_coefs=(0.5,),</span>
<span class="go">     ma_coefs=(0.3, 0.2))</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">arma</span><span class="o">.</span><span class="n">ar_coefs</span> <span class="o">=</span> <span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">arma</span><span class="o">.</span><span class="n">ma_coefs</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">arma</span>
<span class="go">ARMA(ar_coefs=(),</span>
<span class="go">     ma_coefs=(0.0, 1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0, 10.0,</span>
<span class="go">               11.0, 12.0, 13.0, 14.0, 15.0, 16.0, 17.0, 18.0, 19.0))</span>
</pre></div>
</div>
<p>Otherwise they are determined by method <a class="reference internal" href="#hydpy.auxs.armatools.ARMA.update_coefs" title="hydpy.auxs.armatools.ARMA.update_coefs"><code class="xref py py-func docutils literal notranslate"><span class="pre">update_coefs()</span></code></a>.
But this requires that a <a class="reference internal" href="#hydpy.auxs.armatools.MA" title="hydpy.auxs.armatools.MA"><code class="xref py py-class docutils literal notranslate"><span class="pre">MA</span></code></a> object is given.  Let us use
the MA model based on the shifted normal distribution of the
documentation on class <a class="reference internal" href="#hydpy.auxs.armatools.MA" title="hydpy.auxs.armatools.MA"><code class="xref py py-class docutils literal notranslate"><span class="pre">MA</span></code></a> as an example:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ma</span> <span class="o">=</span> <span class="n">MA</span><span class="p">(</span><span class="n">iuh</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">1.02328</span><span class="o">*</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ma</span><span class="o">.</span><span class="n">iuh</span><span class="o">.</span><span class="n">moment1</span> <span class="o">=</span> <span class="mf">3.94</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">arma</span> <span class="o">=</span> <span class="n">ARMA</span><span class="p">(</span><span class="n">ma_model</span><span class="o">=</span><span class="n">ma</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">arma</span>
<span class="go">ARMA(ar_coefs=(0.680483, -0.228511, 0.047283, -0.006022, 0.000377),</span>
<span class="go">     ma_coefs=(0.019322, 0.054783, 0.08195, 0.107757, 0.104458,</span>
<span class="go">               0.07637, 0.041095, 0.01581, 0.004132, 0.000663,</span>
<span class="go">               0.00005))</span>
</pre></div>
</div>
<p>To verify that the ARMA model approximates the MA model with
sufficient accuracy, one can query the achieved relative rmse
value (<a class="reference internal" href="#hydpy.auxs.armatools.ARMA.rel_rmse" title="hydpy.auxs.armatools.ARMA.rel_rmse"><code class="xref py py-const docutils literal notranslate"><span class="pre">rel_rmse</span></code></a>) or check the central moments of their
responses to the standard delta time impulse:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">hydpy</span> <span class="kn">import</span> <span class="n">round_</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">round_</span><span class="p">(</span><span class="n">arma</span><span class="o">.</span><span class="n">rel_rmse</span><span class="p">)</span>
<span class="go">0.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">round_</span><span class="p">(</span><span class="n">ma</span><span class="o">.</span><span class="n">moments</span><span class="p">)</span>
<span class="go">4.110496, 1.926798</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">round_</span><span class="p">(</span><span class="n">arma</span><span class="o">.</span><span class="n">moments</span><span class="p">)</span>
<span class="go">4.110496, 1.926798</span>
</pre></div>
</div>
<p>On can check the accuray of the approximation directly via the
property <a class="reference internal" href="#hydpy.auxs.armatools.ARMA.dev_moments" title="hydpy.auxs.armatools.ARMA.dev_moments"><code class="xref py py-const docutils literal notranslate"><span class="pre">dev_moments</span></code></a>, which is the sum of the absolute values
of the deviations of both methods:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">round_</span><span class="p">(</span><span class="n">arma</span><span class="o">.</span><span class="n">dev_moments</span><span class="p">)</span>
<span class="go">0.0</span>
</pre></div>
</div>
<p>For the first six digits, there is no difference.  However, the total
number of coefficients is only reduced by one:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ma</span><span class="o">.</span><span class="n">order</span>
<span class="go">17</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">arma</span><span class="o">.</span><span class="n">order</span>
<span class="go">(5, 11)</span>
</pre></div>
</div>
<p>To reduce the determined number or AR coefficients, one can set a higher
AR-related tolerance value:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">arma</span><span class="o">.</span><span class="n">max_rel_rmse</span> <span class="o">=</span> <span class="mf">1e-3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">arma</span><span class="o">.</span><span class="n">update_coefs</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">arma</span>
<span class="go">ARMA(ar_coefs=(0.788899, -0.256436, 0.034256),</span>
<span class="go">     ma_coefs=(0.019322, 0.052688, 0.075125, 0.096488, 0.089453,</span>
<span class="go">               0.060854, 0.029041, 0.008929, 0.001397, 0.000001,</span>
<span class="go">               -0.000004, 0.00001, -0.000008, -0.000009, -0.000004,</span>
<span class="go">               -0.000001))</span>
</pre></div>
</div>
<p>The number of AR coeffcients is actually reduced.  However, there are
now even more MA coefficients, possibly trying to compensate the lower
accuracy of the AR coefficients, and there is a slight decrease in
the precision of the moments:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">arma</span><span class="o">.</span><span class="n">order</span>
<span class="go">(3, 16)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">round_</span><span class="p">(</span><span class="n">arma</span><span class="o">.</span><span class="n">moments</span><span class="p">)</span>
<span class="go">4.110497, 1.926804</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">round_</span><span class="p">(</span><span class="n">arma</span><span class="o">.</span><span class="n">dev_moments</span><span class="p">)</span>
<span class="go">0.000007</span>
</pre></div>
</div>
<p>To also reduce the number of MA coefficients, one can set a higher
MA-related tolerance value:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">arma</span><span class="o">.</span><span class="n">max_dev_coefs</span> <span class="o">=</span> <span class="mf">1e-3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">arma</span><span class="o">.</span><span class="n">update_coefs</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">arma</span>
<span class="go">ARMA(ar_coefs=(0.788888, -0.256432, 0.034255),</span>
<span class="go">     ma_coefs=(0.019321, 0.052687, 0.075124, 0.096486, 0.089452,</span>
<span class="go">               0.060853, 0.02904, 0.008929, 0.001397))</span>
</pre></div>
</div>
<p>Now the total number of coefficients is in fact decreased, and the loss
in accuracy is still small:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">arma</span><span class="o">.</span><span class="n">order</span>
<span class="go">(3, 9)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">round_</span><span class="p">(</span><span class="n">arma</span><span class="o">.</span><span class="n">moments</span><span class="p">)</span>
<span class="go">4.110794, 1.927625</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">round_</span><span class="p">(</span><span class="n">arma</span><span class="o">.</span><span class="n">dev_moments</span><span class="p">)</span>
<span class="go">0.001125</span>
</pre></div>
</div>
<p>Further relaxing the tolerance values results in even less coefficients,
but also in some slightly negative responses to a standard impulse:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">arma</span><span class="o">.</span><span class="n">max_rel_rmse</span> <span class="o">=</span> <span class="mf">1e-2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">arma</span><span class="o">.</span><span class="n">max_dev_coefs</span> <span class="o">=</span> <span class="mf">1e-2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">arma</span><span class="o">.</span><span class="n">update_coefs</span><span class="p">()</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">UserWarning</span>: <span class="n">Note that the smallest response to a standard impulse of the determined ARMA model is negative (`-0.000316`).</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">arma</span>
<span class="go">ARMA(ar_coefs=(0.736954, -0.166457),</span>
<span class="go">     ma_coefs=(0.01946, 0.05418, 0.077804, 0.098741, 0.091295,</span>
<span class="go">               0.060797, 0.027226))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">arma</span><span class="o">.</span><span class="n">order</span>
<span class="go">(2, 7)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">hydpy</span> <span class="kn">import</span> <span class="n">print_values</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print_values</span><span class="p">(</span><span class="n">arma</span><span class="o">.</span><span class="n">response</span><span class="p">)</span>
<span class="go">0.01946, 0.068521, 0.125062, 0.1795, 0.202761, 0.180343, 0.12638,</span>
<span class="go">0.063117, 0.025477, 0.008269, 0.001853, -0.000011, -0.000316,</span>
<span class="go">-0.000231, -0.000118, -0.000048, -0.000016</span>
</pre></div>
</div>
<p>It seems to be hard to find a parameter efficient approximation to the
MA model in the given example. Generally, approximating ARMA models to MA
models is more beneficial when functions with long tails are involved.
The most extreme example would be a simple exponential decline:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ma</span> <span class="o">=</span> <span class="n">MA</span><span class="p">(</span><span class="n">iuh</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">0.1</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="o">*</span><span class="n">x</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ma</span><span class="o">.</span><span class="n">iuh</span><span class="o">.</span><span class="n">moment1</span> <span class="o">=</span> <span class="mf">6.932</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">arma</span> <span class="o">=</span> <span class="n">ARMA</span><span class="p">(</span><span class="n">ma_model</span><span class="o">=</span><span class="n">ma</span><span class="p">)</span>
</pre></div>
</div>
<p>In the given example a number of 185 MA coefficients can be reduced to a
total number of three ARMA coefficients with no relevant loss of accuracy:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ma</span><span class="o">.</span><span class="n">order</span>
<span class="go">185</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">arma</span><span class="o">.</span><span class="n">order</span>
<span class="go">(1, 2)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">round_</span><span class="p">(</span><span class="n">arma</span><span class="o">.</span><span class="n">dev_moments</span><span class="p">)</span>
<span class="go">0.0</span>
</pre></div>
</div>
<p>Use the following plotting command to see why 2 MA coeffcients instead of
one are required in the above example:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">arma</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
</pre></div>
</div>
<p>Decreasing the tolerance values too much results in the following errors:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">arma</span><span class="o">.</span><span class="n">max_dev_coefs</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">arma</span><span class="o">.</span><span class="n">update_coefs</span><span class="p">()</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">RuntimeError</span>: <span class="n">Method `update_ma_coefs` is not able to determine the MA coefficients of the ARMA model with the desired accuracy.  You can set the tolerance value ´max_dev_coefs` to a higher value.  An accuracy of `0.000000000925` has been reached using `185` MA coefficients.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">arma</span><span class="o">.</span><span class="n">max_rel_rmse</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">arma</span><span class="o">.</span><span class="n">update_coefs</span><span class="p">()</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">RuntimeError</span>: <span class="n">Method `update_ar_coefs` is not able to determine the AR coefficients of the ARMA model with the desired accuracy.  You can either set the tolerance value `max_rel_rmse` to a higher value or increase the allowed `max_ar_order`.  An accuracy of `0.0` has been reached using `10` coefficients.</span>
</pre></div>
</div>
<dl class="py attribute">
<dt id="hydpy.auxs.armatools.ARMA.max_ar_order">
<code class="sig-name descname"><span class="pre">max_ar_order</span></code><em class="property"> <span class="pre">=</span> <span class="pre">10</span></em><a class="headerlink" href="#hydpy.auxs.armatools.ARMA.max_ar_order" title="Permalink to this definition">¶</a></dt>
<dd><p>Maximum number of AR coefficients that are to be determined by method
<a class="reference internal" href="#hydpy.auxs.armatools.ARMA.update_coefs" title="hydpy.auxs.armatools.ARMA.update_coefs"><code class="xref py py-func docutils literal notranslate"><span class="pre">update_coefs()</span></code></a>.</p>
</dd></dl>

<dl class="py attribute">
<dt id="hydpy.auxs.armatools.ARMA.max_rel_rmse">
<code class="sig-name descname"><span class="pre">max_rel_rmse</span></code><em class="property"> <span class="pre">=</span> <span class="pre">1e-06</span></em><a class="headerlink" href="#hydpy.auxs.armatools.ARMA.max_rel_rmse" title="Permalink to this definition">¶</a></dt>
<dd><p>Maximum relative root mean squared error to be accepted by method
<a class="reference internal" href="#hydpy.auxs.armatools.ARMA.update_coefs" title="hydpy.auxs.armatools.ARMA.update_coefs"><code class="xref py py-func docutils literal notranslate"><span class="pre">update_coefs()</span></code></a>.</p>
</dd></dl>

<dl class="py attribute">
<dt id="hydpy.auxs.armatools.ARMA.max_dev_coefs">
<code class="sig-name descname"><span class="pre">max_dev_coefs</span></code><em class="property"> <span class="pre">=</span> <span class="pre">1e-06</span></em><a class="headerlink" href="#hydpy.auxs.armatools.ARMA.max_dev_coefs" title="Permalink to this definition">¶</a></dt>
<dd><p>Maximum deviation of the sum of all coefficents from one to be accepted
by method <a class="reference internal" href="#hydpy.auxs.armatools.ARMA.update_coefs" title="hydpy.auxs.armatools.ARMA.update_coefs"><code class="xref py py-func docutils literal notranslate"><span class="pre">update_coefs()</span></code></a>.</p>
</dd></dl>

<dl class="py method">
<dt id="hydpy.auxs.armatools.ARMA.rel_rmse">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">rel_rmse</span></code><a class="headerlink" href="#hydpy.auxs.armatools.ARMA.rel_rmse" title="Permalink to this definition">¶</a></dt>
<dd><p>Relative root mean squared error the last time achieved by method
<a class="reference internal" href="#hydpy.auxs.armatools.ARMA.update_coefs" title="hydpy.auxs.armatools.ARMA.update_coefs"><code class="xref py py-func docutils literal notranslate"><span class="pre">update_coefs()</span></code></a>.</p>
</dd></dl>

<dl class="py method">
<dt id="hydpy.auxs.armatools.ARMA.ar_coefs">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">ar_coefs</span></code><a class="headerlink" href="#hydpy.auxs.armatools.ARMA.ar_coefs" title="Permalink to this definition">¶</a></dt>
<dd><p>The AR coefficients of the AR model.</p>
</dd></dl>

<dl class="py method">
<dt id="hydpy.auxs.armatools.ARMA.ma_coefs">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">ma_coefs</span></code><a class="headerlink" href="#hydpy.auxs.armatools.ARMA.ma_coefs" title="Permalink to this definition">¶</a></dt>
<dd><p>The MA coefficients of the ARMA model.</p>
</dd></dl>

<dl class="py method">
<dt id="hydpy.auxs.armatools.ARMA.coefs">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">coefs</span></code><a class="headerlink" href="#hydpy.auxs.armatools.ARMA.coefs" title="Permalink to this definition">¶</a></dt>
<dd><p>Tuple containing both the AR and the MA coefficients.</p>
</dd></dl>

<dl class="py method">
<dt id="hydpy.auxs.armatools.ARMA.ar_order">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">ar_order</span></code><a class="headerlink" href="#hydpy.auxs.armatools.ARMA.ar_order" title="Permalink to this definition">¶</a></dt>
<dd><p>Number of AR coefficients.</p>
</dd></dl>

<dl class="py method">
<dt id="hydpy.auxs.armatools.ARMA.ma_order">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">ma_order</span></code><a class="headerlink" href="#hydpy.auxs.armatools.ARMA.ma_order" title="Permalink to this definition">¶</a></dt>
<dd><p>Number of MA coefficients</p>
</dd></dl>

<dl class="py method">
<dt id="hydpy.auxs.armatools.ARMA.order">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">order</span></code><a class="headerlink" href="#hydpy.auxs.armatools.ARMA.order" title="Permalink to this definition">¶</a></dt>
<dd><p>Number of both the AR and the MA coefficients.</p>
</dd></dl>

<dl class="py method">
<dt id="hydpy.auxs.armatools.ARMA.update_coefs">
<code class="sig-name descname"><span class="pre">update_coefs</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/hydpy/auxs/armatools.html#ARMA.update_coefs"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#hydpy.auxs.armatools.ARMA.update_coefs" title="Permalink to this definition">¶</a></dt>
<dd><p>Determine both the AR and the MA coefficients.</p>
</dd></dl>

<dl class="py method">
<dt id="hydpy.auxs.armatools.ARMA.effective_max_ar_order">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">effective_max_ar_order</span></code><a class="headerlink" href="#hydpy.auxs.armatools.ARMA.effective_max_ar_order" title="Permalink to this definition">¶</a></dt>
<dd><p>The maximum number of AR coefficients that shall or can be
determined.</p>
<p>It is the minimum of <a class="reference internal" href="#hydpy.auxs.armatools.ARMA.max_ar_order" title="hydpy.auxs.armatools.ARMA.max_ar_order"><code class="xref py py-const docutils literal notranslate"><span class="pre">max_ar_order</span></code></a> and the number of
coefficients of the pure <a class="reference internal" href="#hydpy.auxs.armatools.MA" title="hydpy.auxs.armatools.MA"><code class="xref py py-class docutils literal notranslate"><span class="pre">MA</span></code></a> after their turning point.</p>
</dd></dl>

<dl class="py method">
<dt id="hydpy.auxs.armatools.ARMA.update_ar_coefs">
<code class="sig-name descname"><span class="pre">update_ar_coefs</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/hydpy/auxs/armatools.html#ARMA.update_ar_coefs"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#hydpy.auxs.armatools.ARMA.update_ar_coefs" title="Permalink to this definition">¶</a></dt>
<dd><p>Determine the AR coefficients.</p>
<p>The number of AR coefficients is subsequently increased until the
required precision <a class="reference internal" href="#hydpy.auxs.armatools.ARMA.max_rel_rmse" title="hydpy.auxs.armatools.ARMA.max_rel_rmse"><code class="xref py py-const docutils literal notranslate"><span class="pre">max_rel_rmse</span></code></a> is reached.  Otherwise,
a <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#RuntimeError" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">RuntimeError</span></code></a> is raised.</p>
</dd></dl>

<dl class="py method">
<dt id="hydpy.auxs.armatools.ARMA.dev_moments">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">dev_moments</span></code><a class="headerlink" href="#hydpy.auxs.armatools.ARMA.dev_moments" title="Permalink to this definition">¶</a></dt>
<dd><p>Sum of the absolute deviations between the central moments of the
instantaneous unit hydrograph and the ARMA approximation.</p>
</dd></dl>

<dl class="py method">
<dt id="hydpy.auxs.armatools.ARMA.norm_coefs">
<code class="sig-name descname"><span class="pre">norm_coefs</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/hydpy/auxs/armatools.html#ARMA.norm_coefs"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#hydpy.auxs.armatools.ARMA.norm_coefs" title="Permalink to this definition">¶</a></dt>
<dd><p>Multiply all coefficients by the same factor, so that their sum
becomes one.</p>
</dd></dl>

<dl class="py method">
<dt id="hydpy.auxs.armatools.ARMA.sum_coefs">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">sum_coefs</span></code><a class="headerlink" href="#hydpy.auxs.armatools.ARMA.sum_coefs" title="Permalink to this definition">¶</a></dt>
<dd><p>The sum of all AR and MA coefficients</p>
</dd></dl>

<dl class="py method">
<dt id="hydpy.auxs.armatools.ARMA.dev_coefs">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">dev_coefs</span></code><a class="headerlink" href="#hydpy.auxs.armatools.ARMA.dev_coefs" title="Permalink to this definition">¶</a></dt>
<dd><p>Absolute deviation of <a class="reference internal" href="#hydpy.auxs.armatools.ARMA.sum_coefs" title="hydpy.auxs.armatools.ARMA.sum_coefs"><code class="xref py py-const docutils literal notranslate"><span class="pre">sum_coefs</span></code></a> from one.</p>
</dd></dl>

<dl class="py method">
<dt id="hydpy.auxs.armatools.ARMA.calc_all_ar_coefs">
<code class="sig-name descname"><span class="pre">calc_all_ar_coefs</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ar_order</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ma_model</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/hydpy/auxs/armatools.html#ARMA.calc_all_ar_coefs"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#hydpy.auxs.armatools.ARMA.calc_all_ar_coefs" title="Permalink to this definition">¶</a></dt>
<dd><p>Determine the AR coeffcients based on a least squares approach.</p>
<p>The argument <cite>ar_order</cite> defines the number of AR coefficients to be
determined.  The argument <cite>ma_order</cite> defines a pure <a class="reference internal" href="#hydpy.auxs.armatools.MA" title="hydpy.auxs.armatools.MA"><code class="xref py py-class docutils literal notranslate"><span class="pre">MA</span></code></a> model.
The least squares approach is applied on all those coefficents of the
pure MA model, which are associated with the part of the recession
curve behind its turning point.</p>
<p>The attribute <a class="reference internal" href="#hydpy.auxs.armatools.ARMA.rel_rmse" title="hydpy.auxs.armatools.ARMA.rel_rmse"><code class="xref py py-const docutils literal notranslate"><span class="pre">rel_rmse</span></code></a> is updated with the resulting
relative root mean square error.</p>
</dd></dl>

<dl class="py method">
<dt id="hydpy.auxs.armatools.ARMA.get_a">
<em class="property"><span class="pre">static</span> </em><code class="sig-name descname"><span class="pre">get_a</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">values</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/hydpy/auxs/armatools.html#ARMA.get_a"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#hydpy.auxs.armatools.ARMA.get_a" title="Permalink to this definition">¶</a></dt>
<dd><p>Extract the independent variables of the given values and return
them as a matrix with n columns in a form suitable for the least
squares approach applied in method <a class="reference internal" href="#hydpy.auxs.armatools.ARMA.update_ar_coefs" title="hydpy.auxs.armatools.ARMA.update_ar_coefs"><code class="xref py py-func docutils literal notranslate"><span class="pre">update_ar_coefs()</span></code></a>.</p>
</dd></dl>

<dl class="py method">
<dt id="hydpy.auxs.armatools.ARMA.get_b">
<em class="property"><span class="pre">static</span> </em><code class="sig-name descname"><span class="pre">get_b</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">values</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/hydpy/auxs/armatools.html#ARMA.get_b"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#hydpy.auxs.armatools.ARMA.get_b" title="Permalink to this definition">¶</a></dt>
<dd><p>Extract the dependent variables of the values in a vector with n
entries in a form suitable for the least squares approach applied in
method <a class="reference internal" href="#hydpy.auxs.armatools.ARMA.update_ar_coefs" title="hydpy.auxs.armatools.ARMA.update_ar_coefs"><code class="xref py py-func docutils literal notranslate"><span class="pre">update_ar_coefs()</span></code></a>.</p>
</dd></dl>

<dl class="py method">
<dt id="hydpy.auxs.armatools.ARMA.update_ma_coefs">
<code class="sig-name descname"><span class="pre">update_ma_coefs</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/hydpy/auxs/armatools.html#ARMA.update_ma_coefs"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#hydpy.auxs.armatools.ARMA.update_ma_coefs" title="Permalink to this definition">¶</a></dt>
<dd><p>Determine the MA coefficients.</p>
<p>The number of MA coefficients is subsequently increased until the
required precision <a class="reference internal" href="#hydpy.auxs.armatools.ARMA.max_dev_coefs" title="hydpy.auxs.armatools.ARMA.max_dev_coefs"><code class="xref py py-const docutils literal notranslate"><span class="pre">max_dev_coefs</span></code></a> is reached.  Otherwise,
a <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#RuntimeError" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">RuntimeError</span></code></a> is raised.</p>
</dd></dl>

<dl class="py method">
<dt id="hydpy.auxs.armatools.ARMA.calc_next_ma_coef">
<code class="sig-name descname"><span class="pre">calc_next_ma_coef</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ma_order</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ma_model</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/hydpy/auxs/armatools.html#ARMA.calc_next_ma_coef"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#hydpy.auxs.armatools.ARMA.calc_next_ma_coef" title="Permalink to this definition">¶</a></dt>
<dd><p>Determine the MA coefficients of the ARMA model based on its
predetermined AR coefficients and the MA ordinates of the given
<a class="reference internal" href="#hydpy.auxs.armatools.MA" title="hydpy.auxs.armatools.MA"><code class="xref py py-class docutils literal notranslate"><span class="pre">MA</span></code></a> model.</p>
<p>The MA coefficients are determined one at a time, beginning with the
first one.  Each ARMA MA coefficient in set in a manner that allows
for the exact reproduction of the equivalent pure MA coefficient with
all relevant ARMA coefficients.</p>
</dd></dl>

<dl class="py method">
<dt id="hydpy.auxs.armatools.ARMA.response">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">response</span></code><a class="headerlink" href="#hydpy.auxs.armatools.ARMA.response" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the response to a standard dt impulse.</p>
</dd></dl>

<dl class="py method">
<dt id="hydpy.auxs.armatools.ARMA.moments">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">moments</span></code><a class="headerlink" href="#hydpy.auxs.armatools.ARMA.moments" title="Permalink to this definition">¶</a></dt>
<dd><p>The first two time delay weighted statistical moments of the
ARMA response.</p>
</dd></dl>

<dl class="py method">
<dt id="hydpy.auxs.armatools.ARMA.plot">
<code class="sig-name descname"><span class="pre">plot</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/hydpy/auxs/armatools.html#ARMA.plot"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#hydpy.auxs.armatools.ARMA.plot" title="Permalink to this definition">¶</a></dt>
<dd><p>Barplot of the ARMA response.</p>
</dd></dl>

</dd></dl>

</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/HydPy_Logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="how_to.html">How to…</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="framework.html">Framework Tools</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="core.html">Core Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="execution.html">Execution Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="cythons.html">Cython Tools</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="auxiliaries.html">Auxiliary Tools</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="anntools.html">anntools</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">armatools</a></li>
<li class="toctree-l3"><a class="reference internal" href="calibtools.html">calibtools</a></li>
<li class="toctree-l3"><a class="reference internal" href="iuhtools.html">iuhtools</a></li>
<li class="toctree-l3"><a class="reference internal" href="networktools.html">networktools</a></li>
<li class="toctree-l3"><a class="reference internal" href="quadtools.html">quadtools</a></li>
<li class="toctree-l3"><a class="reference internal" href="roottools.html">roottools</a></li>
<li class="toctree-l3"><a class="reference internal" href="smoothtools.html">smoothtools</a></li>
<li class="toctree-l3"><a class="reference internal" href="statstools.html">statstools</a></li>
<li class="toctree-l3"><a class="reference internal" href="validtools.html">validtools</a></li>
<li class="toctree-l3"><a class="reference internal" href="xmltools.html">xmltools</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="configuration.html">Configuration Tools</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="modelcollection.html">Model Collection</a></li>
<li class="toctree-l1"><a class="reference internal" href="development.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Example Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="zbibliography.html">Bibliography</a></li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="anntools.html"
                        title="previous chapter">anntools</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="calibtools.html"
                        title="next chapter">calibtools</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/armatools.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="calibtools.html" title="calibtools"
             >next</a> |</li>
        <li class="right" >
          <a href="anntools.html" title="anntools"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">HydPy 4.0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="framework.html" >Framework Tools</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="auxiliaries.html" >Auxiliary Tools</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">armatools</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2021, HydPy Developers.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.5.2.
    </div>
  </body>
</html>