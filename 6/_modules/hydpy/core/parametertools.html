<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>hydpy.core.parametertools &#8212; HydPy 6.1.5 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../_static/classic.css?v=127cebf3" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=4ae1632d" />
    
    <script src="../../../_static/documentation_options.js?v=3b4955ce"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">HydPy 6.1.5 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">hydpy.core.parametertools</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/HydPy_Logo.png" alt="Logo"/>
            </a></p>
  <div>
    <h3><a href="../../../index.html">Table of Contents</a></h3>
    <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../example_projects.html">Example Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user_guide.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer_guide.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference_manual.html">Reference Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../zbibliography.html">Bibliography</a></li>
</ul>

  </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for hydpy.core.parametertools</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;This module provides tools for defining and handling different kinds of parameters</span>
<span class="sd">of hydrological models.&quot;&quot;&quot;</span>
<span class="c1"># import...</span>
<span class="c1"># ...from standard library</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">builtins</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">contextlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">copy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">inspect</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">itertools</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">textwrap</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">types</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>

<span class="c1"># ...from site-packages</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span>

<span class="c1"># ...from HydPy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">hydpy</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy</span><span class="w"> </span><span class="kn">import</span> <span class="n">config</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">exceptiontools</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">filetools</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">masktools</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">objecttools</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">propertytools</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">timetools</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">variabletools</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.core.typingtools</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>

<span class="c1"># from hydpy.cythons import modelutils  # actual download below</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">auxfiletools</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">devicetools</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">modeltools</span>


<div class="viewcode-block" id="trim_kwarg">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.trim_kwarg">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">trim_kwarg</span><span class="p">(</span>
    <span class="n">parameter</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">lower</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span>
    <span class="n">upper</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper function for model developers for trimming scalar keyword arguments of</span>
<span class="sd">    type |float|.</span>

<span class="sd">    Function |trim_kwarg| works similarly to function |trim| but targets defining</span>
<span class="sd">    parameter values via parameter-specific keyword arguments.  Due to the individual</span>
<span class="sd">    nature of calculating parameter values from keyword arguments, using |trim_kwarg|</span>
<span class="sd">    is less standardisable than using |trim|.  Hence, model developers must include it</span>
<span class="sd">    manually into the `__call__` methods of their |Parameter| subclasses when trimming</span>
<span class="sd">    keyword arguments is required.</span>

<span class="sd">    The following tests show that |trim_kwarg| returns the eventually trimmed value,</span>
<span class="sd">    and, like |trim|, emits warnings only in case of boundary violations beyond the</span>
<span class="sd">    size of pure precision-related artefacts:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy.core.parametertools import Parameter, trim_kwarg</span>
<span class="sd">    &gt;&gt;&gt; parameter = Parameter(None)</span>

<span class="sd">    &gt;&gt;&gt; trim_kwarg(parameter, &quot;x&quot;, 1.0) == 1.0</span>
<span class="sd">    True</span>

<span class="sd">    &gt;&gt;&gt; from hydpy.core.testtools import warn_later</span>
<span class="sd">    &gt;&gt;&gt; with warn_later():</span>
<span class="sd">    ...     trim_kwarg(parameter, &quot;x&quot;, 0.0, lower=1.0) == 1.0</span>
<span class="sd">    True</span>
<span class="sd">    UserWarning: For parameter `parameter` of element `?` the keyword argument `x` \</span>
<span class="sd">with value `0.0` needed to be trimmed to `1.0`.</span>

<span class="sd">    &gt;&gt;&gt; with warn_later():</span>
<span class="sd">    ...     trim_kwarg(parameter, &quot;x&quot;, 2.0, upper=1.0) == 1.0</span>
<span class="sd">    True</span>
<span class="sd">    UserWarning: For parameter `parameter` of element `?` the keyword argument `x` \</span>
<span class="sd">with value `2.0` needed to be trimmed to `1.0`.</span>

<span class="sd">    &gt;&gt;&gt; x = 1.0 - 1e-15</span>
<span class="sd">    &gt;&gt;&gt; x == 1.0</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; with warn_later():</span>
<span class="sd">    ...     trim_kwarg(parameter, &quot;x&quot;, x, lower=1.0) == 1.0</span>
<span class="sd">    True</span>

<span class="sd">    &gt;&gt;&gt; x = 1.0 + 1e-15</span>
<span class="sd">    &gt;&gt;&gt; x == 1.0</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; with warn_later():</span>
<span class="sd">    ...     trim_kwarg(parameter, &quot;x&quot;, x, upper=1.0) == 1.0</span>
<span class="sd">    True</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">gt</span> <span class="o">=</span> <span class="n">variabletools</span><span class="o">.</span><span class="n">get_tolerance</span>
    <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="n">lower</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">value</span> <span class="o">+</span> <span class="n">gt</span><span class="p">(</span><span class="n">value</span><span class="p">))</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">lower</span> <span class="o">-</span> <span class="n">gt</span><span class="p">(</span><span class="n">lower</span><span class="p">)):</span>
            <span class="n">_warn_trim_kwarg</span><span class="p">(</span><span class="n">parameter</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">lower</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lower</span>
    <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="n">upper</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">value</span> <span class="o">-</span> <span class="n">gt</span><span class="p">(</span><span class="n">value</span><span class="p">))</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">upper</span> <span class="o">+</span> <span class="n">gt</span><span class="p">(</span><span class="n">upper</span><span class="p">)):</span>
            <span class="n">_warn_trim_kwarg</span><span class="p">(</span><span class="n">parameter</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">upper</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">upper</span>
    <span class="k">return</span> <span class="n">value</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">_warn_trim_kwarg</span><span class="p">(</span>
    <span class="n">parameter</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">oldvalue</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">newvalue</span><span class="p">:</span> <span class="nb">float</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;For parameter </span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">elementphrase</span><span class="p">(</span><span class="n">parameter</span><span class="p">)</span><span class="si">}</span><span class="s2"> the keyword argument &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">` with value `</span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">repr_</span><span class="p">(</span><span class="n">oldvalue</span><span class="p">)</span><span class="si">}</span><span class="s2">` needed to be trimmed to &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">repr_</span><span class="p">(</span><span class="n">newvalue</span><span class="p">)</span><span class="si">}</span><span class="s2">`.&quot;</span>
    <span class="p">)</span>


<div class="viewcode-block" id="IntConstant">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.IntConstant">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">IntConstant</span><span class="p">(</span><span class="nb">int</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class for |int| objects with individual docstrings.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">const</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="n">const</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">frame</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_back</span>
        <span class="n">const</span><span class="o">.</span><span class="vm">__module__</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">f_locals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;__name__&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">const</span></div>



<div class="viewcode-block" id="Constants">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.Constants">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Constants</span><span class="p">(</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for defining integer constants for a specific model.&quot;&quot;&quot;</span>

    <span class="n">value2name</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Mapping from the the values of the constants to their names.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">args</span> <span class="ow">or</span> <span class="n">kwargs</span><span class="p">):</span>
            <span class="k">assert</span> <span class="p">((</span><span class="n">frame1</span> <span class="o">:=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">())</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
                <span class="p">(</span><span class="n">frame</span> <span class="o">:=</span> <span class="n">frame1</span><span class="o">.</span><span class="n">f_back</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="p">)</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">modulename</span> <span class="o">:=</span> <span class="n">frame</span><span class="o">.</span><span class="n">f_locals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;__name__&quot;</span><span class="p">),</span> <span class="nb">str</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__module__</span> <span class="o">=</span> <span class="n">modulename</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">frame</span><span class="o">.</span><span class="n">f_locals</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">isupper</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">IntConstant</span><span class="p">):</span>
                    <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_docstrings</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value2name</span> <span class="o">=</span> <span class="p">{</span><span class="n">value</span><span class="p">:</span> <span class="n">key</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_prepare_docstrings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">:</span> <span class="n">types</span><span class="o">.</span><span class="n">FrameType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Assign docstrings to the constants handled by |Constants| to make them</span>
<span class="sd">        available in the interactive mode of Python.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">USEAUTODOC</span><span class="p">:</span>
            <span class="k">assert</span> <span class="p">(</span><span class="n">filename</span> <span class="o">:=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getsourcefile</span><span class="p">(</span><span class="n">frame</span><span class="p">))</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">ENCODING</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_</span><span class="p">:</span>
                <span class="n">sources</span> <span class="o">=</span> <span class="n">file_</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&quot;&quot;&quot;&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">code</span><span class="p">,</span> <span class="n">doc</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">sources</span><span class="p">[::</span><span class="mi">2</span><span class="p">],</span> <span class="n">sources</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]):</span>
                <span class="n">code</span> <span class="o">=</span> <span class="n">code</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">code</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
                    <span class="n">value</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">doc</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">sortednames</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The lowercase constants&#39; names, sorted by the constants&#39; values.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.core.parametertools import Constants</span>
<span class="sd">        &gt;&gt;&gt; Constants(GRASS=2, TREES=0, WATER=1).sortednames</span>
<span class="sd">        (&#39;trees&#39;, &#39;water&#39;, &#39;grass&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value2name</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span></div>



<div class="viewcode-block" id="Parameters">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.Parameters">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Parameters</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for handling all parameters of a specific model.</span>

<span class="sd">    |Parameters| objects handle four subgroups as attributes: the `control`</span>
<span class="sd">    subparameters, the `derived` subparameters, the `fixed` subparameters and the</span>
<span class="sd">    `solver` subparameters:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy.models.meteo_glob_fao56 import *</span>
<span class="sd">    &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">    &gt;&gt;&gt; assert model.parameters</span>
<span class="sd">    &gt;&gt;&gt; assert model.parameters.control</span>
<span class="sd">    &gt;&gt;&gt; assert not model.parameters.solver</span>

<span class="sd">    Iterations makes only the non-empty subgroups available, which are actually</span>
<span class="sd">    handling |Parameter| objects:</span>

<span class="sd">    &gt;&gt;&gt; for subpars in model.parameters:</span>
<span class="sd">    ...     print(subpars.name)</span>
<span class="sd">    control</span>
<span class="sd">    derived</span>
<span class="sd">    fixed</span>
<span class="sd">    &gt;&gt;&gt; len(model.parameters)</span>
<span class="sd">    3</span>

<span class="sd">    Keyword access provides a type-safe way to query a subgroup via a string:</span>

<span class="sd">    &gt;&gt;&gt; type(model.parameters[&quot;control&quot;]).__name__</span>
<span class="sd">    &#39;ControlParameters&#39;</span>
<span class="sd">    &gt;&gt;&gt; type(model.parameters[&quot;wrong&quot;])</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    TypeError: There is no parameter subgroup named `wrong`.</span>
<span class="sd">    &gt;&gt;&gt; model.parameters[&quot;model&quot;]</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    TypeError: Attribute `model` is of type `Model`, which is not a subtype of class \</span>
<span class="sd">`SubParameters`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span>
    <span class="n">control</span><span class="p">:</span> <span class="n">SubParameters</span>
    <span class="n">derived</span><span class="p">:</span> <span class="n">SubParameters</span>
    <span class="n">fixed</span><span class="p">:</span> <span class="n">SubParameters</span>
    <span class="n">solver</span><span class="p">:</span> <span class="n">SubParameters</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_subpars</span><span class="p">(</span><span class="s2">&quot;control&quot;</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">derived</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_subpars</span><span class="p">(</span><span class="s2">&quot;derived&quot;</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fixed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_subpars</span><span class="p">(</span><span class="s2">&quot;fixed&quot;</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">solver</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_subpars</span><span class="p">(</span><span class="s2">&quot;solver&quot;</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_prepare_subpars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shortname</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="n">fullname</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">shortname</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s2">Parameters&quot;</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">fullname</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">fullname</span><span class="p">,</span> <span class="p">(</span><span class="n">SubParameters</span><span class="p">,),</span> <span class="p">{</span><span class="s2">&quot;CLASSES&quot;</span><span class="p">:</span> <span class="p">()}))</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cythonmodule&quot;</span><span class="p">),</span> <span class="n">fullname</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cymodel&quot;</span><span class="p">),</span>
        <span class="p">)</span>

<div class="viewcode-block" id="Parameters.update">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.Parameters.update">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call method |Parameter.update| of all &quot;secondary&quot; parameters.</span>

<span class="sd">        Directly after initialisation, neither the primary (`control`) parameters nor</span>
<span class="sd">        the secondary (`derived`)  parameters of application model |meteo_glob_fao56|</span>
<span class="sd">        are ready for usage:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.meteo_glob_fao56 import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; derived</span>
<span class="sd">        doy(?)</span>
<span class="sd">        moy(?)</span>
<span class="sd">        hours(?)</span>
<span class="sd">        days(?)</span>
<span class="sd">        sct(?)</span>
<span class="sd">        utclongitude(?)</span>
<span class="sd">        latituderad(?)</span>

<span class="sd">        Trying to update the values of the secondary parameters while the primary ones</span>
<span class="sd">        are still not defined raises errors like the following:</span>

<span class="sd">        &gt;&gt;&gt; model.parameters.update()</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        hydpy.core.exceptiontools.AttributeNotReady: While trying to update parameter \</span>
<span class="sd">`doy` of element `?`, the following error occurred: An Indexer object has been asked \</span>
<span class="sd">for an `dayofyear` array.  Such an array has neither been determined yet nor can it \</span>
<span class="sd">be determined automatically at the moment.   Either define an `dayofyear` array \</span>
<span class="sd">manually and pass it to the Indexer object, or make a proper Timegrids object \</span>
<span class="sd">available within the pub module.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-30&quot;, &quot;2000-02-04&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; model.parameters.update()</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        hydpy.core.exceptiontools.AttributeNotReady: While trying to update parameter \</span>
<span class="sd">`latituderad` of element `?`, the following error occurred: While trying to multiply \</span>
<span class="sd">variable `latitude` and `float` instance `0.017453`, the following error occurred: \</span>
<span class="sd">For variable `latitude`, no value has been defined so far.</span>

<span class="sd">        With a defined |Timegrids| object and proper values both for parameters</span>
<span class="sd">        |meteo_control.Latitude| and |meteo_control.Longitude|, updating the derived</span>
<span class="sd">        parameters succeeds:</span>

<span class="sd">        &gt;&gt;&gt; latitude(50.0)</span>
<span class="sd">        &gt;&gt;&gt; longitude(10.0)</span>
<span class="sd">        &gt;&gt;&gt; model.parameters.update()</span>
<span class="sd">        &gt;&gt;&gt; derived</span>
<span class="sd">        doy(29, 30, 31, 32, 33)</span>
<span class="sd">        moy(0, 0, 1, 1, 1)</span>
<span class="sd">        hours(24.0)</span>
<span class="sd">        days(1.0)</span>
<span class="sd">        sct(12.0)</span>
<span class="sd">        utclongitude(15)</span>
<span class="sd">        latituderad(0.872665)</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">subpars</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">secondary_subpars</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="n">subpars</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">par</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">ignore_errors</span><span class="p">:</span>
                        <span class="n">objecttools</span><span class="o">.</span><span class="n">augment_excmessage</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;While trying to update parameter &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">elementphrase</span><span class="p">(</span><span class="n">par</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span></div>


<div class="viewcode-block" id="Parameters.verify">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.Parameters.verify">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">verify</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call method |Variable.verify| of all |Parameter| objects handled by the</span>
<span class="sd">        actual model.</span>

<span class="sd">        When calling method |Parameters.verify| directly after initialising model</span>
<span class="sd">        |meteo_glob_fao56| (without using default values), it raises a |RuntimeError|</span>
<span class="sd">        due to the undefined value of control parameter |meteo_control.Latitude|:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.meteo_glob_fao56 import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; model.parameters.verify()</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        RuntimeError: For variable `latitude`, 1 required value has not been set yet: \</span>
<span class="sd">latitude(?).</span>

<span class="sd">        Assigning a value to |meteo_control.Latitude| is not sufficient:</span>

<span class="sd">        &gt;&gt;&gt; model.parameters.control.latitude(50.0)</span>
<span class="sd">        &gt;&gt;&gt; model.parameters.verify()</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        RuntimeError: For variable `longitude`, 1 required value has not been set \</span>
<span class="sd">yet: longitude(?).</span>

<span class="sd">        After also defining suitable values for all remaining control parameters, the</span>
<span class="sd">        derived parameters are still not ready:</span>

<span class="sd">        &gt;&gt;&gt; model.parameters.control.longitude(10.0)</span>
<span class="sd">        &gt;&gt;&gt; model.parameters.control.angstromconstant(0.25)</span>
<span class="sd">        &gt;&gt;&gt; model.parameters.control.angstromfactor(0.5)</span>
<span class="sd">        &gt;&gt;&gt; model.parameters.verify()</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        hydpy.core.exceptiontools.AttributeNotReady: Shape information for variable \</span>
<span class="sd">`doy` can only be retrieved after it has been defined.</span>

<span class="sd">        After updating the derived parameters (which requires preparing a |Timegrids|</span>
<span class="sd">        object first), method |Parameters.verify| has no reason to complain anymore:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-30&quot;, &quot;2000-02-04&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; model.parameters.update()</span>
<span class="sd">        &gt;&gt;&gt; model.parameters.verify()</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">subpars</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="n">subpars</span><span class="p">:</span>
                <span class="n">par</span><span class="o">.</span><span class="n">verify</span><span class="p">()</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">secondary_subpars</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">SubParameters</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Iterate through all subgroups of &quot;secondary&quot; parameters.</span>

<span class="sd">        These secondary parameter subgroups are the `derived` parameters and the</span>
<span class="sd">        `solver` parameters at the moment:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.meteo_glob_fao56 import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; for subpars in model.parameters.secondary_subpars:</span>
<span class="sd">        ...     print(subpars.name)</span>
<span class="sd">        derived</span>
<span class="sd">        solver</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">derived</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">solver</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SubParameters</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">subpars</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;There is no parameter subgroup named `</span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">`.&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">subpars</span><span class="p">,</span> <span class="n">SubParameters</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">subpars</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Attribute `</span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">` is of type `</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">subpars</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">`, which is not &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;a subtype of class `SubParameters`.&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">SubParameters</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">subpars</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">derived</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">solver</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">subpars</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">subpars</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__bool__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">pars</span> <span class="k">for</span> <span class="n">pars</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)</span></div>



<div class="viewcode-block" id="FastAccessParameter">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.FastAccessParameter">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">FastAccessParameter</span><span class="p">(</span><span class="n">variabletools</span><span class="o">.</span><span class="n">FastAccess</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Used as a surrogate for typed Cython classes handling parameters</span>
<span class="sd">    when working in pure Python mode.&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="SubParameters">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.SubParameters">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">SubParameters</span><span class="p">(</span>
    <span class="n">variabletools</span><span class="o">.</span><span class="n">SubVariables</span><span class="p">[</span><span class="n">Parameters</span><span class="p">,</span> <span class="s2">&quot;Parameter&quot;</span><span class="p">,</span> <span class="n">FastAccessParameter</span><span class="p">]</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Base class for handling subgroups of model parameters.</span>

<span class="sd">    When trying to implement a new model, one has to define its</span>
<span class="sd">    specific |Parameter| subclasses. Currently, the HydPy framework</span>
<span class="sd">    distinguishes between control parameters, derived parameters,</span>
<span class="sd">    fixed parameters, and solver parameters. Each |Parameter| subclass is</span>
<span class="sd">    a member of a collection class derived from |SubParameters|, called</span>
<span class="sd">    &quot;ControlParameters&quot;, &quot;DerivedParameters&quot;, &quot;FixedParameters&quot;, or</span>
<span class="sd">    &quot;SolverParameters&quot;, respectively.  Indicate membership by putting the</span>
<span class="sd">    parameter subclasses into the |tuple| &quot;CLASSES&quot;:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy.core.parametertools import Parameter, SubParameters</span>
<span class="sd">    &gt;&gt;&gt; class Par2(Parameter):</span>
<span class="sd">    ...     &quot;&quot;&quot;Parameter 2 [-].&quot;&quot;&quot;</span>
<span class="sd">    ...     NDIM = 1</span>
<span class="sd">    ...     TYPE = float</span>
<span class="sd">    ...     TIME = None</span>
<span class="sd">    &gt;&gt;&gt; class Par1(Parameter):</span>
<span class="sd">    ...     &quot;&quot;&quot;Parameter 1 [-].&quot;&quot;&quot;</span>
<span class="sd">    ...     NDIM = 1</span>
<span class="sd">    ...     TYPE = float</span>
<span class="sd">    ...     TIME = None</span>
<span class="sd">    &gt;&gt;&gt; class ControlParameters(SubParameters):</span>
<span class="sd">    ...     &quot;&quot;&quot;Control Parameters.&quot;&quot;&quot;</span>
<span class="sd">    ...     CLASSES = (Par2,</span>
<span class="sd">    ...                Par1)</span>

<span class="sd">    The order within the tuple determines the order of iteration:</span>

<span class="sd">    &gt;&gt;&gt; control = ControlParameters(None)</span>
<span class="sd">    &gt;&gt;&gt; control</span>
<span class="sd">    par2(?)</span>
<span class="sd">    par1(?)</span>

<span class="sd">    Each |SubParameters| object has a `fastaccess` attribute.  When</span>
<span class="sd">    working in pure Python mode, this is an instance of class</span>
<span class="sd">    |FastAccessParameter|:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy import classname, prepare_model, pub</span>
<span class="sd">    &gt;&gt;&gt; with pub.options.usecython(False):</span>
<span class="sd">    ...     model = prepare_model(&quot;lland_dd&quot;)</span>
<span class="sd">    &gt;&gt;&gt; classname(model.parameters.control.fastaccess)</span>
<span class="sd">    &#39;FastAccessParameter&#39;</span>

<span class="sd">    When working in Cython mode (which is the default mode and much</span>
<span class="sd">    faster), `fastaccess` is an object of a Cython extension class</span>
<span class="sd">    specialised for the respective model and sequence group:</span>

<span class="sd">    &gt;&gt;&gt; with pub.options.usecython(True):</span>
<span class="sd">    ...     model = prepare_model(&quot;lland_dd&quot;)</span>
<span class="sd">    &gt;&gt;&gt; classname(model.parameters.control.fastaccess)</span>
<span class="sd">    &#39;ControlParameters&#39;</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">pars</span><span class="p">:</span> <span class="n">Parameters</span>
    <span class="n">_cymodel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">CyModelProtocol</span><span class="p">]</span>
    <span class="n">_CLS_FASTACCESS_PYTHON</span> <span class="o">=</span> <span class="n">FastAccessParameter</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">master</span><span class="p">:</span> <span class="n">Parameters</span><span class="p">,</span>
        <span class="n">cls_fastaccess</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">type</span><span class="p">[</span><span class="n">FastAccessParameter</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cymodel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">CyModelProtocol</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pars</span> <span class="o">=</span> <span class="n">master</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cymodel</span> <span class="o">=</span> <span class="n">cymodel</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">master</span><span class="o">=</span><span class="n">master</span><span class="p">,</span> <span class="n">cls_fastaccess</span><span class="o">=</span><span class="n">cls_fastaccess</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_init_fastaccess</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_init_fastaccess</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cls_fastaccess</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cymodel</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cymodel</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The class name in lowercase letters omitting the last ten characters</span>
<span class="sd">        (&quot;parameters&quot;).</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.core.parametertools import SubParameters</span>
<span class="sd">        &gt;&gt;&gt; class ControlParameters(SubParameters):</span>
<span class="sd">        ...     CLASSES = ()</span>
<span class="sd">        &gt;&gt;&gt; ControlParameters(None).name</span>
<span class="sd">        &#39;control&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">[:</span><span class="o">-</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span></div>



<div class="viewcode-block" id="Keyword">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.Keyword">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Keyword</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper class to describe parameter-specific keyword arguments for defining</span>
<span class="sd">    values by &quot;calling&quot; a parameter object.&quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The keyword argument&#39;s name.&quot;&quot;&quot;</span>
    <span class="n">type_</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">float</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The keyword argument&#39;s type (equivalent to the |Variable.TYPE| attribute of </span>
<span class="sd">    class |Variable|).&quot;&quot;&quot;</span>
    <span class="n">time</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Type of the keyword argument&#39;s time dependency (equivalent to the </span>
<span class="sd">    |Parameter.TIME| attribute of class |Parameter|).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">span</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The keyword argument&#39;s lower and upper boundary (equivalent to the </span>
<span class="sd">    |Variable.SPAN| attribute of class |Variable|).</span>
<span class="sd">    &quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="KeywordArgumentsError">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.KeywordArgumentsError">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">KeywordArgumentsError</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A specialised |RuntimeError| raised by class |KeywordArguments|.&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="KeywordArguments">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.KeywordArguments">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">KeywordArguments</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A handler for the keyword arguments of the instances of specific |Parameter|</span>
<span class="sd">    subclasses.</span>

<span class="sd">    Class |KeywordArguments| is a rather elaborate feature of *HydPy* primarily</span>
<span class="sd">    thought for framework developers.  One possible use-case for (advanced)</span>
<span class="sd">    *HydPy* users is writing polished auxiliary control files.  When dealing with</span>
<span class="sd">    such a problem, have a look on method |KeywordArguments.extend|.</span>

<span class="sd">    The purpose of class |KeywordArguments| is to simplify handling instances of</span>
<span class="sd">    |Parameter| subclasses which allow setting values by calling them with keyword</span>
<span class="sd">    arguments.  When useful, instances of |Parameter| subclasses should return a</span>
<span class="sd">    valid |KeywordArguments| object via property |Parameter.keywordarguments|.</span>
<span class="sd">    This object should contain the keyword arguments that, when passed to the same</span>
<span class="sd">    parameter instance or another parameter instance of the same type, sets it into</span>
<span class="sd">    an equal state.  This is best explained by the following example based on</span>
<span class="sd">    parameter |lland_control.TRefT| of application model |lland_dd| (see the</span>
<span class="sd">    documentation on property |ZipParameter.keywordarguments| of class |ZipParameter|</span>
<span class="sd">    for additional information):</span>

<span class="sd">    &gt;&gt;&gt; from hydpy.models.lland_dd import *</span>
<span class="sd">    &gt;&gt;&gt; parameterstep()</span>
<span class="sd">    &gt;&gt;&gt; nhru(4)</span>
<span class="sd">    &gt;&gt;&gt; lnk(ACKER, LAUBW, WASSER, ACKER)</span>
<span class="sd">    &gt;&gt;&gt; treft(acker=2.0, laubw=1.0)</span>
<span class="sd">    &gt;&gt;&gt; treft.keywordarguments</span>
<span class="sd">    KeywordArguments(acker=2.0, laubw=1.0)</span>

<span class="sd">    You can initialise a |KeywordArguments| object on your own:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy import KeywordArguments</span>
<span class="sd">    &gt;&gt;&gt; kwargs1 = KeywordArguments(acker=3.0, laubw=2.0, nadelw=1.0)</span>
<span class="sd">    &gt;&gt;&gt; kwargs1</span>
<span class="sd">    KeywordArguments(acker=3.0, laubw=2.0, nadelw=1.0)</span>

<span class="sd">    After preparing a |KeywordArguments| object, it is &quot;valid&quot; by default:</span>

<span class="sd">    &gt;&gt;&gt; kwargs1.valid</span>
<span class="sd">    True</span>

<span class="sd">    Pass |False| as a positional argument to the constructor if you want your</span>
<span class="sd">    |KeywordArguments| object to be invalid at first:</span>

<span class="sd">    &gt;&gt;&gt; kwargs2 = KeywordArguments(False)</span>
<span class="sd">    &gt;&gt;&gt; kwargs2</span>
<span class="sd">    KeywordArguments()</span>
<span class="sd">    &gt;&gt;&gt; kwargs2.valid</span>
<span class="sd">    False</span>

<span class="sd">    Flag |KeywordArguments.valid|, for example, helps to distinguish between empty</span>
<span class="sd">    objects that are okay to be empty and those that are not.  When we, for example,</span>
<span class="sd">    set all hydrological response units to land-use type |lland_constants.WASSER|</span>
<span class="sd">    (water), parameter |lland_control.TRefT| returns the following valid</span>
<span class="sd">    |KeywordArguments| object, as its values do not need to be defined for water areas:</span>

<span class="sd">    &gt;&gt;&gt; lnk(WASSER)</span>
<span class="sd">    &gt;&gt;&gt; treft</span>
<span class="sd">    treft(nan)</span>
<span class="sd">    &gt;&gt;&gt; treft.keywordarguments</span>
<span class="sd">    KeywordArguments()</span>
<span class="sd">    &gt;&gt;&gt; treft.keywordarguments.valid</span>
<span class="sd">    True</span>

<span class="sd">    Class |KeywordArguments| supports features like iteration but raises the</span>
<span class="sd">    exception |KeywordArgumentsError| when trying to iterate an invalid object:</span>

<span class="sd">    &gt;&gt;&gt; for keyword, argument in kwargs1:</span>
<span class="sd">    ...     print(keyword, argument)</span>
<span class="sd">    acker 3.0</span>
<span class="sd">    laubw 2.0</span>
<span class="sd">    nadelw 1.0</span>

<span class="sd">    &gt;&gt;&gt; for keyword, argument in kwargs2:</span>
<span class="sd">    ...     print(keyword, argument)</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    hydpy.core.parametertools.KeywordArgumentsError: Cannot iterate an invalid \</span>
<span class="sd">`KeywordArguments` object.</span>

<span class="sd">    The same holds when trying to check if a specific keyword-value item is available:</span>

<span class="sd">    &gt;&gt;&gt; (&quot;acker&quot;, 3.0) in kwargs1</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; (&quot;laubw&quot;, 3.0) in kwargs1</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; (&quot;?&quot;, &quot;???&quot;) in kwargs1</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; (&quot;laubw&quot;, 3.0) in kwargs2</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    hydpy.core.parametertools.KeywordArgumentsError: Cannot check if an item is \</span>
<span class="sd">defined by an invalid `KeywordArguments` object.</span>

<span class="sd">    However, keyword access is always possible:</span>

<span class="sd">    &gt;&gt;&gt; kwargs2[&quot;laubw&quot;] = 3.0</span>

<span class="sd">    &gt;&gt;&gt; kwargs2[&quot;laubw&quot;]</span>
<span class="sd">    3.0</span>

<span class="sd">    &gt;&gt;&gt; del kwargs2[&quot;laubw&quot;]</span>

<span class="sd">    &gt;&gt;&gt; kwargs2[&quot;laubw&quot;]</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    KeyError: &#39;The current `KeywordArguments` object does not handle an argument \</span>
<span class="sd">under the keyword `laubw`.&#39;</span>

<span class="sd">    &gt;&gt;&gt; del kwargs2[&quot;laubw&quot;]</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    KeyError: &#39;The current `KeywordArguments` object does not handle an argument \</span>
<span class="sd">under the keyword `laubw`.&#39;</span>

<span class="sd">    Two |KeywordArguments| objects are considered equal if they have the same</span>
<span class="sd">    validity state, the same length, and if all items are equal:</span>

<span class="sd">    &gt;&gt;&gt; KeywordArguments(True) == KeywordArguments(False)</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; KeywordArguments(x=1) == KeywordArguments(x=1, y=2)</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; KeywordArguments(x=1, y=2) == KeywordArguments(x=1, y=3)</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; KeywordArguments(x=1, y=2) == KeywordArguments(x=1, y=2)</span>
<span class="sd">    True</span>

<span class="sd">    You can also compare with other objects (always |False|) and use the</span>
<span class="sd">    &quot;!=&quot; operator:</span>

<span class="sd">    &gt;&gt;&gt; KeywordArguments() == &quot;test&quot;</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; KeywordArguments(x=1, y=2) != KeywordArguments(x=1, y=2)</span>
<span class="sd">    False</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">valid</span><span class="p">:</span> <span class="nb">bool</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Flag indicating whether the actual |KeywordArguments| object is valid or not.&quot;&quot;&quot;</span>
    <span class="n">_name2value</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">T</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__valid</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">keywordarguments</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valid</span> <span class="o">=</span> <span class="n">__valid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name2value</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">keywordarguments</span><span class="p">)</span>

<div class="viewcode-block" id="KeywordArguments.add">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.KeywordArguments.add">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a keyword argument.</span>

<span class="sd">        Method |KeywordArguments.add| works both for valid and invalid</span>
<span class="sd">        |KeywordArguments| objects without changing their validity status:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import KeywordArguments</span>
<span class="sd">        &gt;&gt;&gt; kwargs = KeywordArguments()</span>
<span class="sd">        &gt;&gt;&gt; kwargs.add(&quot;one&quot;, 1)</span>
<span class="sd">        &gt;&gt;&gt; kwargs.valid = False</span>
<span class="sd">        &gt;&gt;&gt; kwargs.add(&quot;two&quot;, 2)</span>
<span class="sd">        &gt;&gt;&gt; kwargs</span>
<span class="sd">        KeywordArguments(one=1, two=2)</span>

<span class="sd">        It raises the following error when (possibly accidentally) trying to</span>
<span class="sd">        overwrite an existing keyword argument:</span>

<span class="sd">        &gt;&gt;&gt; kwargs.add(&quot;one&quot;, 3)</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        hydpy.core.parametertools.KeywordArgumentsError: Cannot add argument value \</span>
<span class="sd">`3` of type `int` to the current `KeywordArguments` object as it already handles \</span>
<span class="sd">the unequal argument `1` under the keyword `one`.</span>

<span class="sd">        On the other hand, redefining the save value causes no harm and thus</span>
<span class="sd">        does not trigger an exception:</span>

<span class="sd">        &gt;&gt;&gt; kwargs.add(&quot;one&quot;, 1)</span>
<span class="sd">        &gt;&gt;&gt; kwargs</span>
<span class="sd">        KeywordArguments(one=1, two=2)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name2value</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name2value</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">!=</span> <span class="n">value</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">KeywordArgumentsError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Cannot add argument </span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">value_of_type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2"> to the &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;current `</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">` object as it already handles &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;the unequal argument `</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_name2value</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="si">}</span><span class="s2">` under the &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;keyword `</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">`.&quot;</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_name2value</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>


<div class="viewcode-block" id="KeywordArguments.subset_of">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.KeywordArguments.subset_of">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">subset_of</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">KeywordArguments</span><span class="p">[</span><span class="n">T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if the actual |KeywordArguments| object is a subset of the given one.</span>

<span class="sd">        First, we define the following (valid) |KeywordArguments| objects:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import KeywordArguments</span>
<span class="sd">        &gt;&gt;&gt; kwargs1 = KeywordArguments(a=1, b=2)</span>
<span class="sd">        &gt;&gt;&gt; kwargs2 = KeywordArguments(a= 1, b=2, c=3)</span>
<span class="sd">        &gt;&gt;&gt; kwargs3 = KeywordArguments(a= 1, b=3)</span>

<span class="sd">        Method |KeywordArguments.subset_of| requires that the keywords handled by</span>
<span class="sd">        the left |KeywordArguments| object form a subset of the keywords of the</span>
<span class="sd">        right |KeywordArguments| object:</span>

<span class="sd">        &gt;&gt;&gt; kwargs1.subset_of(kwargs2)</span>
<span class="sd">        True</span>
<span class="sd">        &gt;&gt;&gt; kwargs2.subset_of(kwargs1)</span>
<span class="sd">        False</span>

<span class="sd">        Additionally, all values corresponding to the union of the relevant keywords</span>
<span class="sd">        must be equal:</span>

<span class="sd">        &gt;&gt;&gt; kwargs1.subset_of(kwargs3)</span>
<span class="sd">        False</span>

<span class="sd">        If at least one of both |KeywordArguments| is invalid,  method</span>
<span class="sd">        |KeywordArguments.subset_of| generally returns |False|:</span>

<span class="sd">        &gt;&gt;&gt; kwargs2.valid = False</span>
<span class="sd">        &gt;&gt;&gt; kwargs1.subset_of(kwargs2)</span>
<span class="sd">        False</span>
<span class="sd">        &gt;&gt;&gt; kwargs2.subset_of(kwargs1)</span>
<span class="sd">        False</span>
<span class="sd">        &gt;&gt;&gt; kwargs2.subset_of(kwargs2)</span>
<span class="sd">        False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name2value</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">other</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="KeywordArguments.extend">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.KeywordArguments.extend">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">extend</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">parametertype</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">Parameter</span><span class="p">],</span>
        <span class="n">elements</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">devicetools</span><span class="o">.</span><span class="n">Element</span><span class="p">],</span>
        <span class="n">raise_exception</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extend the currently available keyword arguments based on the parameters</span>
<span class="sd">        of the given type handled by the given elements.</span>
<span class="sd">        </span>
<span class="sd">        Sometimes (for example, when writing auxiliary control files) one is </span>
<span class="sd">        interested in a superset of all keyword arguments related to a specific</span>
<span class="sd">        |Parameter| type relevant for certain |Element| objects.  To show how</span>
<span class="sd">        method |KeywordArguments.extend| can help in such cases, we make use of</span>
<span class="sd">        the `HydPy-H-Lahn` example project:</span>
<span class="sd">        </span>
<span class="sd">        &gt;&gt;&gt; from hydpy.core.testtools import prepare_full_example_2</span>
<span class="sd">        &gt;&gt;&gt; hp, pub, TestIO = prepare_full_example_2()</span>

<span class="sd">        First, we prepare an empty |KeywordArguments| object:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import KeywordArguments</span>
<span class="sd">        &gt;&gt;&gt; kwargs = KeywordArguments()</span>
<span class="sd">        &gt;&gt;&gt; kwargs</span>
<span class="sd">        KeywordArguments()</span>

<span class="sd">        When passing a |Parameter| subclass (in our example</span>
<span class="sd">        |hland_control.IcMax|) and some |Element| objects (at first the headwater</span>
<span class="sd">        elements, which handle instances of application model |hland_96|), method</span>
<span class="sd">        |KeywordArguments.extend| collects their relevant keyword arguments:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland.hland_control import IcMax</span>
<span class="sd">        &gt;&gt;&gt; kwargs.extend(IcMax, pub.selections.headwaters.elements)</span>
<span class="sd">        &gt;&gt;&gt; kwargs</span>
<span class="sd">        KeywordArguments(field=1.0, forest=1.5)</span>

<span class="sd">        Applying method |KeywordArguments.extend| also on the non-headwaters does</span>
<span class="sd">        not change anything, as the values of parameter |hland_control.IcMax| are</span>
<span class="sd">        consistent for the whole Lahn river basin:</span>

<span class="sd">        &gt;&gt;&gt; kwargs.extend(IcMax, pub.selections.nonheadwaters.elements)</span>
<span class="sd">        &gt;&gt;&gt; kwargs</span>
<span class="sd">        KeywordArguments(field=1.0, forest=1.5)</span>

<span class="sd">        Next, we change the interception capacity of forests in one subcatchment:</span>

<span class="sd">        &gt;&gt;&gt; icmax = hp.elements.land_lahn_leun.model.parameters.control.icmax</span>
<span class="sd">        &gt;&gt;&gt; icmax(field=1.0, forest=2.0)</span>

<span class="sd">        Re-applying method |KeywordArguments.extend| now raises the following error:</span>

<span class="sd">        &gt;&gt;&gt; kwargs.extend(IcMax, pub.selections.nonheadwaters.elements)</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        hydpy.core.parametertools.KeywordArgumentsError: While trying to extend the \</span>
<span class="sd">keyword arguments based on the available `IcMax` parameter objects, the following \</span>
<span class="sd">error occurred: While trying to add the keyword arguments for element \</span>
<span class="sd">`land_lahn_leun`, the following error occurred: Cannot add argument value `2.0` of \</span>
<span class="sd">type `float64` to the current `KeywordArguments` object as it already handles the \</span>
<span class="sd">unequal argument `1.5` under the keyword `forest`.</span>

<span class="sd">        The old keywords arguments and the validity status remain unchanged:</span>

<span class="sd">        &gt;&gt;&gt; kwargs</span>
<span class="sd">        KeywordArguments(field=1.0, forest=1.5)</span>
<span class="sd">        &gt;&gt;&gt; kwargs.valid</span>
<span class="sd">        True</span>

<span class="sd">        When we modify the same |hland_control.IcMax| parameter object in a way</span>
<span class="sd">        that it cannot return a valid |KeywordArguments| object anymore, we get</span>
<span class="sd">        the following error message:</span>

<span class="sd">        &gt;&gt;&gt; icmax(0.0, 1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0)</span>
<span class="sd">        &gt;&gt;&gt; kwargs.extend(IcMax, pub.selections.nonheadwaters.elements)</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        hydpy.core.parametertools.KeywordArgumentsError: While trying to extend the \</span>
<span class="sd">keyword arguments based on the available `IcMax` parameter objects, the following \</span>
<span class="sd">error occurred: While trying to add the keyword arguments for element \</span>
<span class="sd">`land_lahn_leun`, the following error occurred: Cannot iterate an invalid \</span>
<span class="sd">`KeywordArguments` object.</span>

<span class="sd">        When setting the `raise_exception` argument to |False|, method</span>
<span class="sd">        |KeywordArguments.extend| handles such errors internally and, instead of</span>
<span class="sd">        raising an error invalidates the actual |KeywordArguments| object:</span>

<span class="sd">        &gt;&gt;&gt; kwargs.extend(</span>
<span class="sd">        ...     IcMax, pub.selections.nonheadwaters.elements, raise_exception=False)</span>
<span class="sd">        &gt;&gt;&gt; kwargs</span>
<span class="sd">        KeywordArguments()</span>
<span class="sd">        &gt;&gt;&gt; kwargs.valid</span>
<span class="sd">        False</span>

<span class="sd">        Trying to extend an invalid |KeywordArguments| object by default also</span>
<span class="sd">        raises an exception of type |KeywordArgumentsError|:</span>

<span class="sd">        &gt;&gt;&gt; kwargs.extend(IcMax, pub.selections.headwaters.elements)</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        hydpy.core.parametertools.KeywordArgumentsError: While trying to extend the \</span>
<span class="sd">keyword arguments based on the available `IcMax` parameter objects, the following \</span>
<span class="sd">error occurred: The `KeywordArguments` object is invalid.</span>

<span class="sd">        When setting `raise_exception` to |False| instead, nothing happens:</span>

<span class="sd">        &gt;&gt;&gt; kwargs.extend(IcMax, pub.selections.headwaters.elements, \</span>
<span class="sd">raise_exception=False)</span>
<span class="sd">        &gt;&gt;&gt; kwargs</span>
<span class="sd">        KeywordArguments()</span>
<span class="sd">        &gt;&gt;&gt; kwargs.valid</span>
<span class="sd">        False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name_parameter</span> <span class="o">=</span> <span class="n">parametertype</span><span class="o">.</span><span class="n">name</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">raise_exception</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">KeywordArgumentsError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;The `</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">` object is invalid.&quot;</span>
                    <span class="p">)</span>
                <span class="k">return</span>
            <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">control</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span>
                    <span class="n">other</span> <span class="o">=</span> <span class="n">control</span><span class="p">[</span><span class="n">name_parameter</span><span class="p">]</span><span class="o">.</span><span class="n">keywordarguments</span>
                    <span class="k">for</span> <span class="n">name_keyword</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">other</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name_keyword</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">KeywordArgumentsError</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">raise_exception</span><span class="p">:</span>
                        <span class="n">objecttools</span><span class="o">.</span><span class="n">augment_excmessage</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;While trying to add the keyword arguments for &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;element `</span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">devicename</span><span class="p">(</span><span class="n">element</span><span class="p">)</span><span class="si">}</span><span class="s2">`&quot;</span>
                        <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_name2value</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
                    <span class="k">return</span>
        <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
            <span class="n">objecttools</span><span class="o">.</span><span class="n">augment_excmessage</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;While trying to extend the keyword arguments based on the &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;available `</span><span class="si">{</span><span class="n">parametertype</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">` parameter objects&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="KeywordArguments.clear">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.KeywordArguments.clear">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Clear the current object contents and set attribute |KeywordArguments.valid|</span>
<span class="sd">        to |False|.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import KeywordArguments</span>
<span class="sd">        &gt;&gt;&gt; kwa =KeywordArguments(x=1, y=2)</span>
<span class="sd">        &gt;&gt;&gt; kwa</span>
<span class="sd">        KeywordArguments(x=1, y=2)</span>
<span class="sd">        &gt;&gt;&gt; kwa.valid</span>
<span class="sd">        True</span>
<span class="sd">        &gt;&gt;&gt; kwa.clear()</span>
<span class="sd">        &gt;&gt;&gt; kwa</span>
<span class="sd">        KeywordArguments()</span>
<span class="sd">        &gt;&gt;&gt; kwa.valid</span>
<span class="sd">        True</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name2value</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name2value</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The current `</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">` object does not handle an &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;argument under the keyword `</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">`.&quot;</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name2value</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name2value</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The current `</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">` object does not handle an &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;argument under the keyword `</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">`.&quot;</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">KeywordArgumentsError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Cannot check if an item is defined by an invalid &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">` object.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name2value</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name2value</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">==</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_name2value</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">T</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">KeywordArgumentsError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Cannot iterate an invalid `</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">` object.&quot;</span>
            <span class="p">)</span>
        <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name2value</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">KeywordArguments</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">other</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">apply_black</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_name2value</span><span class="p">)</span></div>



<div class="viewcode-block" id="Parameter">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.Parameter">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Parameter</span><span class="p">(</span><span class="n">variabletools</span><span class="o">.</span><span class="n">Variable</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for model parameters.</span>

<span class="sd">    In *HydPy*, each kind of model parameter is represented by a unique</span>
<span class="sd">    class.  In almost all cases, you should derive such a class,</span>
<span class="sd">    directly or indirectly, from class |Parameter|, which provides</span>
<span class="sd">    all necessary features that assure the new parameter class works</span>
<span class="sd">    well when applied in different contexts.</span>

<span class="sd">    In most cases, the functionalities of class |Parameter| are sufficient</span>
<span class="sd">    for deriving new classes without doing any real coding (writing</span>
<span class="sd">    new or extending existing methods).  However, one sometimes prefers</span>
<span class="sd">    to do some extensions to simplify the usage of the parameter class.</span>
<span class="sd">    Before doing so on your own, have a look at the specialised</span>
<span class="sd">    subclasses already available in module |parametertools|.  One</span>
<span class="sd">    example is class |SeasonalParameter|, which allows defining</span>
<span class="sd">    parameter values that vary seasonally (e.g. the leaf area index).</span>

<span class="sd">    Class |Parameter| itself extends class |Variable|.  Hence, all</span>
<span class="sd">    model-specific |Parameter| subclasses must define both a value</span>
<span class="sd">    dimensionality and a type via class constants `NDIM` and `TYPE`,</span>
<span class="sd">    respectively.  Additionally, one has to define the class constant</span>
<span class="sd">    `TIME`, telling how parameter values depend on the simulation</span>
<span class="sd">    step size (see methods |Parameter.get_timefactor| and</span>
<span class="sd">    |Parameter.apply_timefactor|). Also, model developers might find</span>
<span class="sd">    it useful to define initial default values via `INIT` or minimum</span>
<span class="sd">    and maximum values via `SPAN`:</span>

<span class="sd">    .. testsetup::</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; del pub.options.simulationstep</span>

<span class="sd">    Let us first prepare a new parameter class without time-dependency</span>
<span class="sd">    (indicated by assigning |None|) and initialise it:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy.core.parametertools import Parameter</span>
<span class="sd">    &gt;&gt;&gt; class Par(Parameter):</span>
<span class="sd">    ...     NDIM = 0</span>
<span class="sd">    ...     TYPE = float</span>
<span class="sd">    ...     TIME = None</span>
<span class="sd">    ...     SPAN = 0.0, 5.0</span>
<span class="sd">    &gt;&gt;&gt; par = Par(None)</span>

<span class="sd">    As described in the documentation on base class |Variable|, one</span>
<span class="sd">    can directly assign values via property |Variable.value|:</span>

<span class="sd">    &gt;&gt;&gt; par.value = 6.0</span>
<span class="sd">    &gt;&gt;&gt; par</span>
<span class="sd">    par(6.0)</span>

<span class="sd">    For |Parameter| objects, there is an alternative way to define</span>
<span class="sd">    new values, which should be preferred in most cases (especially</span>
<span class="sd">    when writing control files), by &quot;calling&quot; the parameter with</span>
<span class="sd">    suitable arguments.  For example, this offers the advantage of</span>
<span class="sd">    automatical trimming.  In the example above, the assigned value</span>
<span class="sd">    (6.0) violates the upper bound (5.0) of our test parameter.  When</span>
<span class="sd">    using the &quot;call&quot; syntax, the wrong value is corrected immediately:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">    &gt;&gt;&gt; from hydpy.core.testtools import warn_later</span>
<span class="sd">    &gt;&gt;&gt; with pub.options.warntrim(True), warn_later():</span>
<span class="sd">    ...     par(7.0)</span>
<span class="sd">    UserWarning: For variable `par` at least one value needed to be trimmed.  \</span>
<span class="sd">The old and the new value(s) are `7.0` and `5.0`, respectively.</span>
<span class="sd">    &gt;&gt;&gt; par</span>
<span class="sd">    par(5.0)</span>

<span class="sd">    .. testsetup::</span>

<span class="sd">        &gt;&gt;&gt; try:</span>
<span class="sd">        ...     del model</span>
<span class="sd">        ... except NameError:</span>
<span class="sd">        ...     pass</span>

<span class="sd">    The &quot;call&quot; syntax provides some additional features and related</span>
<span class="sd">    error messages.  Use the `auxfile` keyword argument to tell that</span>
<span class="sd">    another control file defines the actual parameter value.  Note</span>
<span class="sd">    that you cannot use this feature in the interactive mode:</span>

<span class="sd">    &gt;&gt;&gt; par(auxfile=&quot;test&quot;)</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    RuntimeError: While trying to extract information for parameter `par` \</span>
<span class="sd">from file `test`, the following error occurred: Cannot determine the \</span>
<span class="sd">corresponding model.  Use the `auxfile` keyword in usual parameter \</span>
<span class="sd">control files only.</span>

<span class="sd">    Also, note that you cannot combine the `auxfile` keyword with any other keyword:</span>

<span class="sd">    &gt;&gt;&gt; par(auxfile=&quot;test&quot;, x1=1, x2=2, x3=3)</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ValueError: It is not allowed to combine keyword `auxfile` with other \</span>
<span class="sd">keywords, but for parameter `par` of element `?` also the following keywords \</span>
<span class="sd">are used: x1, x2, and x3.</span>

<span class="sd">    Some |Parameter| subclasses support other keyword arguments.</span>
<span class="sd">    The standard error message for unsupported arguments is the following:</span>

<span class="sd">    &gt;&gt;&gt; par(wrong=1.0)</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    NotImplementedError: The value(s) of parameter `par` of element `?` \</span>
<span class="sd">could not be set based on the given keyword arguments.</span>

<span class="sd">    Passing a wrong number of positional arguments results in the</span>
<span class="sd">    following error:</span>

<span class="sd">    &gt;&gt;&gt; par(1.0, 2.0)</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    TypeError: While trying to set the value(s) of variable `par`, the \</span>
<span class="sd">following error occurred: The given value `[1. 2.]` cannot be converted \</span>
<span class="sd">to type `float`.</span>

<span class="sd">    Passing no argument or both positional and keyword arguments are also</span>
<span class="sd">    disallowed:</span>

<span class="sd">    &gt;&gt;&gt; par()</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ValueError: For parameter `par` of element `?` neither a positional \</span>
<span class="sd">nor a keyword argument is given.</span>

<span class="sd">    &gt;&gt;&gt; par(1.0, auxfile=&quot;test&quot;)</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ValueError: For parameter `par` of element `?` both positional and \</span>
<span class="sd">keyword arguments are given, which is ambiguous.</span>

<span class="sd">    Our next |Parameter| test class is a little more complicated, as it</span>
<span class="sd">    handles a (1-dimensional) vector of time-dependent values (indicated</span>
<span class="sd">    by setting the class attribute `TIME` to |True|):</span>

<span class="sd">    &gt;&gt;&gt; from hydpy import print_vector</span>
<span class="sd">    &gt;&gt;&gt; class Par(Parameter):</span>
<span class="sd">    ...     NDIM = 1</span>
<span class="sd">    ...     TYPE = float</span>
<span class="sd">    ...     TIME = True</span>
<span class="sd">    ...     SPAN = 0.0, None</span>

<span class="sd">    We prepare a shape of length 2 and set different simulation and</span>
<span class="sd">    parameter step sizes, to see that the required time-related</span>
<span class="sd">    adjustments work correctly:</span>

<span class="sd">    &gt;&gt;&gt; par = Par(None)</span>
<span class="sd">    &gt;&gt;&gt; par.shape = (2,)</span>
<span class="sd">    &gt;&gt;&gt; pub.options.parameterstep = &quot;1d&quot;</span>
<span class="sd">    &gt;&gt;&gt; pub.options.simulationstep = &quot;2d&quot;</span>

<span class="sd">    Now you can pass one single value, an iterable containing two</span>
<span class="sd">    values, or two separate values as positional arguments, to set</span>
<span class="sd">    both required values.  Note that the given values are assumed to</span>
<span class="sd">    agree with the actual parameter step size, and are converted</span>
<span class="sd">    internally to agree with the actual simulation step size.  The</span>
<span class="sd">    string representation shows values that agree with the parameter</span>
<span class="sd">    step size; the |Variable.values| property shows the values that</span>
<span class="sd">    agree with the simulation step size, relevant during simulation</span>
<span class="sd">    runs.  Also, the string representation shows only one value, in</span>
<span class="sd">    case all (relevant) values are identical:</span>

<span class="sd">    &gt;&gt;&gt; par(3.0)</span>
<span class="sd">    &gt;&gt;&gt; par</span>
<span class="sd">    par(3.0)</span>
<span class="sd">    &gt;&gt;&gt; print_vector(par.values)</span>
<span class="sd">    6.0, 6.0</span>

<span class="sd">    &gt;&gt;&gt; par([0.0, 4.0])</span>
<span class="sd">    &gt;&gt;&gt; par</span>
<span class="sd">    par(0.0, 4.0)</span>
<span class="sd">    &gt;&gt;&gt; print_vector(par.values)</span>
<span class="sd">    0.0, 8.0</span>

<span class="sd">    &gt;&gt;&gt; par(1.0, 2.0)</span>
<span class="sd">    &gt;&gt;&gt; par</span>
<span class="sd">    par(1.0, 2.0)</span>
<span class="sd">    &gt;&gt;&gt; print_vector(par.values)</span>
<span class="sd">    2.0, 4.0</span>

<span class="sd">    Using the `call` syntax to set parameter values triggers method</span>
<span class="sd">    |trim| automatically:</span>

<span class="sd">    &gt;&gt;&gt; with pub.options.warntrim(True), warn_later():</span>
<span class="sd">    ...     par(-1.0, 3.0)</span>
<span class="sd">    UserWarning: For variable `par` at least one value needed to be trimmed.  \</span>
<span class="sd">The old and the new value(s) are `-2.0, 6.0` and `0.0, 6.0`, respectively.</span>
<span class="sd">    &gt;&gt;&gt; par</span>
<span class="sd">    par(0.0, 3.0)</span>
<span class="sd">    &gt;&gt;&gt; print_vector(par.values)</span>
<span class="sd">    0.0, 6.0</span>

<span class="sd">    You are free to change the parameter step size (temporarily) to change</span>
<span class="sd">    the string representation of |Parameter| handling time-dependent values</span>
<span class="sd">    without a risk to change the actual values relevant for simulation:</span>

<span class="sd">    &gt;&gt;&gt; with pub.options.parameterstep(&quot;2d&quot;):</span>
<span class="sd">    ...     print(par)</span>
<span class="sd">    ...     print_vector(par.values)</span>
<span class="sd">    par(0.0, 6.0)</span>
<span class="sd">    0.0, 6.0</span>
<span class="sd">    &gt;&gt;&gt; par</span>
<span class="sd">    par(0.0, 3.0)</span>
<span class="sd">    &gt;&gt;&gt; print_vector(par.values)</span>
<span class="sd">    0.0, 6.0</span>

<span class="sd">    The highest number of dimensions of |Parameter| subclasses supported</span>
<span class="sd">    is currently two.  The following examples repeat some examples from</span>
<span class="sd">    above for a 2-dimensional parameter that handles that values inversely</span>
<span class="sd">    related to the simulation step size (indicated by setting the class</span>
<span class="sd">    attribute `TIME` to |False|):</span>

<span class="sd">    &gt;&gt;&gt; from hydpy import print_matrix</span>
<span class="sd">    &gt;&gt;&gt; class Par(Parameter):</span>
<span class="sd">    ...     NDIM = 2</span>
<span class="sd">    ...     TYPE = float</span>
<span class="sd">    ...     TIME = False</span>
<span class="sd">    ...     SPAN = 0.0, 5.0</span>

<span class="sd">    &gt;&gt;&gt; par = Par(None)</span>
<span class="sd">    &gt;&gt;&gt; par.shape = (2, 3)</span>

<span class="sd">    &gt;&gt;&gt; par(9.0)</span>
<span class="sd">    &gt;&gt;&gt; par</span>
<span class="sd">    par(9.0)</span>
<span class="sd">    &gt;&gt;&gt; print_matrix(par.values)</span>
<span class="sd">    | 4.5, 4.5, 4.5 |</span>
<span class="sd">    | 4.5, 4.5, 4.5 |</span>

<span class="sd">    &gt;&gt;&gt; par([[1.0, 2.0, 3.0],</span>
<span class="sd">    ...      [4.0, 5.0, 6.0]])</span>
<span class="sd">    &gt;&gt;&gt; print_matrix(par)</span>
<span class="sd">    | 0.5, 1.0, 1.5 |</span>
<span class="sd">    | 2.0, 2.5, 3.0 |</span>
<span class="sd">    &gt;&gt;&gt; print_matrix(par.values)</span>
<span class="sd">    | 0.5, 1.0, 1.5 |</span>
<span class="sd">    | 2.0, 2.5, 3.0 |</span>

<span class="sd">    &gt;&gt;&gt; par(1.0, 2.0)</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ValueError: While trying to set the value(s) of variable `par`, the following \</span>
<span class="sd">error occurred: While trying to convert the value(s) `[0.5 1. ]` to a numpy ndarray \</span>
<span class="sd">with shape `(2, 3)` and type `float`, the following error occurred: could not \</span>
<span class="sd">broadcast input array from shape (2,) into shape (2,3)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">TIME</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span>
    <span class="n">KEYWORDS</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Keyword</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">subvars</span><span class="p">:</span> <span class="n">SubParameters</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The subgroup to which the parameter belongs.&quot;&quot;&quot;</span>
    <span class="n">subpars</span><span class="p">:</span> <span class="n">SubParameters</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Alias for |Parameter.subvars|.&quot;&quot;&quot;</span>

    <span class="n">_CLS_FASTACCESS_PYTHON</span> <span class="o">=</span> <span class="n">FastAccessParameter</span>

    <span class="n">_keywordarguments</span><span class="p">:</span> <span class="n">KeywordArguments</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subvars</span><span class="p">:</span> <span class="n">SubParameters</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">subvars</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subpars</span> <span class="o">=</span> <span class="n">subvars</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_keywordarguments</span> <span class="o">=</span> <span class="n">KeywordArguments</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_raise_args_and_kwargs_error</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NoReturn</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;For parameter </span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">elementphrase</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2"> both positional and &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;keyword arguments are given, which is ambiguous.&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_raise_no_args_and_no_kwargs_error</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NoReturn</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;For parameter </span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">elementphrase</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2"> neither a positional &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;nor a keyword argument is given.&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_raise_kwargs_and_auxfile_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">NoReturn</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;It is not allowed to combine keyword `auxfile` with other keywords, but &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;for parameter </span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">elementphrase</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2"> also the following &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;keywords are used: </span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">enumeration</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_raise_wrong_kwargs_error</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NoReturn</span><span class="p">:</span>
        <span class="c1"># ToDo: we should stop using `NotImplementedError` this way</span>
        <span class="c1"># To trick pylint:</span>
        <span class="k">raise</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">builtins</span><span class="p">,</span> <span class="s2">&quot;NotImplementedError&quot;</span><span class="p">)(</span>
            <span class="sa">f</span><span class="s2">&quot;The value(s) of parameter </span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">elementphrase</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2"> could not &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;be set based on the given keyword arguments.&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">args</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_raise_args_and_kwargs_error</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_raise_no_args_and_no_kwargs_error</span><span class="p">()</span>
        <span class="n">auxfile</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;auxfile&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">auxfile</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_raise_kwargs_and_auxfile_error</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_from_auxiliaryfile</span><span class="p">(</span><span class="n">auxfile</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">args</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_timefactor</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_raise_wrong_kwargs_error</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trim</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_values_from_auxiliaryfile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auxfile</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Try to return the parameter values from the auxiliary control file with the</span>
<span class="sd">        given name.</span>

<span class="sd">        Things are a little complicated here.  To understand this method, you should</span>
<span class="sd">        first take a look at the |parameterstep| function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="p">((</span><span class="n">frame1</span> <span class="o">:=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">())</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
                <span class="ow">and</span> <span class="p">((</span><span class="n">frame2</span> <span class="o">:=</span> <span class="n">frame1</span><span class="o">.</span><span class="n">f_back</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
                <span class="ow">and</span> <span class="p">((</span><span class="n">frame</span> <span class="o">:=</span> <span class="n">frame2</span><span class="o">.</span><span class="n">f_back</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">while</span> <span class="n">frame</span><span class="p">:</span>
                <span class="n">namespace</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">f_locals</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">subnamespace</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="n">namespace</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">],</span> <span class="s2">&quot;focus&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="p">}</span>
                    <span class="k">break</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">f_back</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="s2">&quot;Cannot determine the corresponding model.  Use the `auxfile` &quot;</span>
                    <span class="s2">&quot;keyword in usual parameter control files only.&quot;</span>
                <span class="p">)</span>
            <span class="n">filetools</span><span class="o">.</span><span class="n">ControlManager</span><span class="o">.</span><span class="n">read2dict</span><span class="p">(</span><span class="n">auxfile</span><span class="p">,</span> <span class="n">subnamespace</span><span class="p">)</span>
            <span class="n">subself</span> <span class="o">=</span> <span class="n">subnamespace</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">subself</span><span class="o">.</span><span class="n">value</span>
            <span class="k">except</span> <span class="n">exceptiontools</span><span class="o">.</span><span class="n">AttributeNotReady</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;The selected auxiliary file does not define &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;value(s) for parameter `</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">`.&quot;</span>
                <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="kc">None</span>
        <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
            <span class="n">objecttools</span><span class="o">.</span><span class="n">augment_excmessage</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;While trying to extract information for parameter &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">` from file `</span><span class="si">{</span><span class="n">auxfile</span><span class="si">}</span><span class="s2">`&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_find_kwargscombination</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">given_args</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
        <span class="n">given_kwargs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
        <span class="n">allowed_combinations</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="o">...</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">given_kwargs</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;auxfile&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">given_kwargs</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">given_args</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_raise_args_and_kwargs_error</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">allowed_combinations</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">given_kwargs</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__hydpy__connect_variable2subgroup__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__hydpy__connect_variable2subgroup__</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDIM</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">exceptiontools</span><span class="o">.</span><span class="n">attrready</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;shape&quot;</span><span class="p">):</span>
                <span class="k">return</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">initvalue</span><span class="p">,</span> <span class="n">initflag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initinfo</span>
        <span class="k">if</span> <span class="n">initflag</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="n">initvalue</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">initvalue</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">initinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">bool</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A |tuple| containing the initial value and |True| or a missing</span>
<span class="sd">        value and |False|, depending on the actual |Parameter| subclass and</span>
<span class="sd">        the actual value of option |Options.usedefaultvalues|.</span>

<span class="sd">        In the following we show how method the effects of property</span>
<span class="sd">        |Parameter.initinfo| when initiasing new |Parameter| objects.</span>
<span class="sd">        Let&#39;s define a parameter test class and prepare a function for</span>
<span class="sd">        initialising it and connecting the resulting instance to a</span>
<span class="sd">        |SubParameters| object:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.core.parametertools import Parameter, SubParameters</span>
<span class="sd">        &gt;&gt;&gt; class Test(Parameter):</span>
<span class="sd">        ...     NDIM = 0</span>
<span class="sd">        ...     TYPE = float</span>
<span class="sd">        ...     TIME = None</span>
<span class="sd">        ...     INIT = 2.0</span>
<span class="sd">        &gt;&gt;&gt; class SubGroup(SubParameters):</span>
<span class="sd">        ...     CLASSES = (Test,)</span>
<span class="sd">        &gt;&gt;&gt; def prepare():</span>
<span class="sd">        ...     subpars = SubGroup(None)</span>
<span class="sd">        ...     test = Test(subpars)</span>
<span class="sd">        ...     test.__hydpy__connect_variable2subgroup__()</span>
<span class="sd">        ...     return test</span>

<span class="sd">        By default, making use of the `INIT` attribute is disabled:</span>

<span class="sd">        &gt;&gt;&gt; test = prepare()</span>
<span class="sd">        &gt;&gt;&gt; test</span>
<span class="sd">        test(?)</span>

<span class="sd">        Enable it through setting |Options.usedefaultvalues| to |True|:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.options.usedefaultvalues = True</span>
<span class="sd">        &gt;&gt;&gt; test = prepare()</span>
<span class="sd">        &gt;&gt;&gt; test</span>
<span class="sd">        test(2.0)</span>

<span class="sd">        When no `INIT` attribute is defined (indicated by |None|), enabling</span>
<span class="sd">        |Options.usedefaultvalues| has no effect, of course:</span>

<span class="sd">        &gt;&gt;&gt; Test.INIT = None</span>
<span class="sd">        &gt;&gt;&gt; test = prepare()</span>
<span class="sd">        &gt;&gt;&gt; test</span>
<span class="sd">        test(?)</span>

<span class="sd">        For time-dependent parameter values, the `INIT` attribute is assumed</span>
<span class="sd">        to be related to a |Parameterstep| of one day:</span>

<span class="sd">        &gt;&gt;&gt; pub.options.parameterstep = &quot;2d&quot;</span>
<span class="sd">        &gt;&gt;&gt; pub.options.simulationstep = &quot;12h&quot;</span>
<span class="sd">        &gt;&gt;&gt; Test.INIT = 2.0</span>
<span class="sd">        &gt;&gt;&gt; Test.TIME = True</span>
<span class="sd">        &gt;&gt;&gt; test = prepare()</span>
<span class="sd">        &gt;&gt;&gt; test</span>
<span class="sd">        test(4.0)</span>
<span class="sd">        &gt;&gt;&gt; test.value</span>
<span class="sd">        1.0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">init</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">INIT</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">init</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">usedefaultvalues</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">parameterstep</span><span class="p">(</span><span class="s2">&quot;1d&quot;</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_timefactor</span><span class="p">(</span><span class="n">init</span><span class="p">),</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">variabletools</span><span class="o">.</span><span class="n">TYPE2MISSINGVALUE</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">TYPE</span><span class="p">],</span> <span class="kc">False</span>

<div class="viewcode-block" id="Parameter.get_timefactor">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.Parameter.get_timefactor">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_timefactor</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Factor to adjust a new value of a time-dependent parameter.</span>

<span class="sd">        For a time-dependent parameter, its effective value depends on the</span>
<span class="sd">        simulation step size.  Method |Parameter.get_timefactor| returns</span>
<span class="sd">        the fraction between the current simulation step size and the</span>
<span class="sd">        current parameter step size.</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">            &gt;&gt;&gt; del pub.options.simulationstep</span>
<span class="sd">            &gt;&gt;&gt; del pub.options.parameterstep</span>

<span class="sd">        Method |Parameter.get_timefactor| raises the following error</span>
<span class="sd">        when time information is not available:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.core.parametertools import Parameter</span>
<span class="sd">        &gt;&gt;&gt; Parameter.get_timefactor()</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        RuntimeError: To calculate the conversion factor for adapting the \</span>
<span class="sd">values of the time-dependent parameters, you need to define both a \</span>
<span class="sd">parameter and a simulation time step size first.</span>

<span class="sd">        One can define both time step sizes directly:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.options.parameterstep = &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; pub.options.simulationstep = &quot;6h&quot;</span>
<span class="sd">        &gt;&gt;&gt; Parameter.get_timefactor()</span>
<span class="sd">        0.25</span>

<span class="sd">        As usual, the &quot;global&quot; simulation step size of the |Timegrids|</span>
<span class="sd">        object of module |pub| is prefered:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-01&quot;, &quot;2001-01-01&quot;, &quot;12h&quot;</span>
<span class="sd">        &gt;&gt;&gt; Parameter.get_timefactor()</span>
<span class="sd">        0.5</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">parameterstep</span> <span class="o">=</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">parameterstep</span>
            <span class="n">parameterstep</span><span class="o">.</span><span class="n">check</span><span class="p">()</span>
            <span class="n">parfactor</span> <span class="o">=</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">timegrids</span><span class="o">.</span><span class="n">parfactor</span>
        <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
            <span class="n">options</span> <span class="o">=</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">options</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">parameterstep</span> <span class="ow">and</span> <span class="n">options</span><span class="o">.</span><span class="n">simulationstep</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="s2">&quot;To calculate the conversion factor for adapting &quot;</span>
                    <span class="s2">&quot;the values of the time-dependent parameters, &quot;</span>
                    <span class="s2">&quot;you need to define both a parameter and a simulation &quot;</span>
                    <span class="s2">&quot;time step size first.&quot;</span>
                <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="kc">None</span>
            <span class="n">date1</span> <span class="o">=</span> <span class="n">timetools</span><span class="o">.</span><span class="n">Date</span><span class="p">(</span><span class="s2">&quot;2000.01.01&quot;</span><span class="p">)</span>
            <span class="n">date2</span> <span class="o">=</span> <span class="n">date1</span> <span class="o">+</span> <span class="n">options</span><span class="o">.</span><span class="n">simulationstep</span>
            <span class="n">parfactor</span> <span class="o">=</span> <span class="n">timetools</span><span class="o">.</span><span class="n">Timegrids</span><span class="p">(</span>
                <span class="n">timetools</span><span class="o">.</span><span class="n">Timegrid</span><span class="p">(</span>
                    <span class="n">firstdate</span><span class="o">=</span><span class="n">date1</span><span class="p">,</span> <span class="n">lastdate</span><span class="o">=</span><span class="n">date2</span><span class="p">,</span> <span class="n">stepsize</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">simulationstep</span>
                <span class="p">)</span>
            <span class="p">)</span><span class="o">.</span><span class="n">parfactor</span>
        <span class="k">return</span> <span class="n">parfactor</span><span class="p">(</span><span class="n">parameterstep</span><span class="p">)</span></div>


<div class="viewcode-block" id="Parameter.trim">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.Parameter.trim">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">trim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply function |trim| of module |variabletools|.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">variabletools</span><span class="o">.</span><span class="n">trim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">)</span></div>


<div class="viewcode-block" id="Parameter.apply_timefactor">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.Parameter.apply_timefactor">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">apply_timefactor</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">ArrayFloat</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ArrayFloat</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Change and return the given value(s) in accordance with</span>
<span class="sd">        |Parameter.get_timefactor| and the type of time-dependence</span>
<span class="sd">        of the actual parameter subclass.</span>

<span class="sd">        For the same conversion factor returned by method</span>
<span class="sd">        |Parameter.get_timefactor|, method |Parameter.apply_timefactor|</span>
<span class="sd">        behaves differently depending on the `TIME` attribute of the</span>
<span class="sd">        respective |Parameter| subclass.  We first prepare a parameter</span>
<span class="sd">        test class and define both the parameter and simulation step size:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.core.parametertools import Parameter</span>
<span class="sd">        &gt;&gt;&gt; class Par(Parameter):</span>
<span class="sd">        ...     TIME = None</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.options.parameterstep = &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; pub.options.simulationstep = &quot;6h&quot;</span>

<span class="sd">        |None| means the value(s) of the parameter are not time-dependent</span>
<span class="sd">        (e.g. maximum storage capacity).  Hence, |Parameter.apply_timefactor|</span>
<span class="sd">        returns the original value(s):</span>

<span class="sd">        &gt;&gt;&gt; Par.apply_timefactor(4.0)</span>
<span class="sd">        4.0</span>

<span class="sd">        |True| means the effective parameter value is proportional to</span>
<span class="sd">        the simulation step size (e.g. travel time). Hence,</span>
<span class="sd">        |Parameter.apply_timefactor| returns a reduced value in the</span>
<span class="sd">        next example (where the simulation step size is smaller than</span>
<span class="sd">        the parameter step size):</span>

<span class="sd">        &gt;&gt;&gt; Par.TIME = True</span>
<span class="sd">        &gt;&gt;&gt; Par.apply_timefactor(4.0)</span>
<span class="sd">        1.0</span>

<span class="sd">        |False| means the effective parameter value is inversely</span>
<span class="sd">        proportional to the simulation step size (e.g. storage</span>
<span class="sd">        coefficient). Hence, |Parameter.apply_timefactor| returns</span>
<span class="sd">        an increased value in the next example:</span>

<span class="sd">        &gt;&gt;&gt; Par.TIME = False</span>
<span class="sd">        &gt;&gt;&gt; Par.apply_timefactor(4.0)</span>
<span class="sd">        16.0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">TIME</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">values</span> <span class="o">*</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_timefactor</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">TIME</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">values</span> <span class="o">/</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_timefactor</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">values</span></div>


<div class="viewcode-block" id="Parameter.revert_timefactor">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.Parameter.revert_timefactor">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">revert_timefactor</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">ArrayFloat</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ArrayFloat</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The inverse version of method |Parameter.apply_timefactor|.</span>

<span class="sd">        See the explanations on method Parameter.apply_timefactor| to</span>
<span class="sd">        understand the following examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.core.parametertools import Parameter</span>
<span class="sd">        &gt;&gt;&gt; class Par(Parameter):</span>
<span class="sd">        ...     TIME = None</span>
<span class="sd">        &gt;&gt;&gt; Par.parameterstep = &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; Par.simulationstep = &quot;6h&quot;</span>
<span class="sd">        &gt;&gt;&gt; Par.revert_timefactor(4.0)</span>
<span class="sd">        4.0</span>

<span class="sd">        &gt;&gt;&gt; Par.TIME = True</span>
<span class="sd">        &gt;&gt;&gt; Par.revert_timefactor(4.0)</span>
<span class="sd">        16.0</span>

<span class="sd">        &gt;&gt;&gt; Par.TIME = False</span>
<span class="sd">        &gt;&gt;&gt; Par.revert_timefactor(4.0)</span>
<span class="sd">        1.0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">TIME</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">values</span> <span class="o">/</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_timefactor</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">TIME</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">values</span> <span class="o">*</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_timefactor</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">values</span></div>


<div class="viewcode-block" id="Parameter.update">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.Parameter.update">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;To be overridden by all &quot;secondary&quot; parameters.</span>

<span class="sd">        |Parameter| subclasses to be used as &quot;primary&quot; parameters (control</span>
<span class="sd">        parameters) do not need to implement method |Parameter.update|.</span>
<span class="sd">        For such classes, invoking the method results in the following</span>
<span class="sd">        error message:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.core.parametertools import Parameter</span>
<span class="sd">        &gt;&gt;&gt; class Par(Parameter):</span>
<span class="sd">        ...     pass</span>
<span class="sd">        &gt;&gt;&gt; Par(None).update()</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        RuntimeError: Parameter `par` of element `?` does not \</span>
<span class="sd">implement method `update`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Parameter </span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">elementphrase</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2"> does not &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;implement method `update`.&quot;</span>
        <span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">keywordarguments</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KeywordArguments</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A |KeywordArguments| object.</span>

<span class="sd">        By default, instances of |Parameter| subclasses return empty, invalid</span>
<span class="sd">        |KeywordArguments| objects:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.core.parametertools import Keyword, KeywordArguments, Parameter</span>
<span class="sd">        &gt;&gt;&gt; par = Parameter(None)</span>
<span class="sd">        &gt;&gt;&gt; kwa = par.keywordarguments</span>
<span class="sd">        &gt;&gt;&gt; kwa</span>
<span class="sd">        KeywordArguments()</span>
<span class="sd">        &gt;&gt;&gt; kwa.valid</span>
<span class="sd">        False</span>

<span class="sd">        See class |ZipParameter| for an implementation example of a |Parameter|</span>
<span class="sd">        subclass overriding this behaviour.  Another example is class</span>
<span class="sd">        |musk_control.NmbSegments|, which relies on the following mechanism.</span>

<span class="sd">        Model developers can use the private `_keywordarguments` attribute.  Property</span>
<span class="sd">        |Parameter.keywordarguments| returns a deep copy of the |KeywordArguments|</span>
<span class="sd">        object stored here:</span>

<span class="sd">        &gt;&gt;&gt; par._keywordarguments = KeywordArguments(x=1.0, y=2.0, z=3.0)</span>
<span class="sd">        &gt;&gt;&gt; par.keywordarguments</span>
<span class="sd">        KeywordArguments(x=1.0, y=2.0, z=3.0)</span>
<span class="sd">        &gt;&gt;&gt; par.keywordarguments is par._keywordarguments</span>
<span class="sd">        False</span>

<span class="sd">        We assume that the values of time-dependent keyword arguments stored under the</span>
<span class="sd">        private attribute refer to the simulation step size.  However, the values of</span>
<span class="sd">        the |KeywordArguments| object returned by |Parameter.keywordarguments| must</span>
<span class="sd">        refer to the current parameter step size.  If the relevant |Parameter| class</span>
<span class="sd">        provides |Keyword| instances that describe the individual keyword arguments,</span>
<span class="sd">        |Parameter.keywordarguments| can perform the necessary adjustments</span>
<span class="sd">        automatically:</span>

<span class="sd">        &gt;&gt;&gt; par.KEYWORDS = {&quot;x&quot;: Keyword(name=&quot;x&quot;, time=None),</span>
<span class="sd">        ...                 &quot;y&quot;: Keyword(name=&quot;y&quot;, time=True),</span>
<span class="sd">        ...                 &quot;z&quot;: Keyword(name=&quot;z&quot;, time=False)}</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; with pub.options.simulationstep(&quot;1d&quot;), pub.options.parameterstep(&quot;2d&quot;):</span>
<span class="sd">        ...     par.keywordarguments</span>
<span class="sd">        KeywordArguments(x=1.0, y=4.0, z=1.5)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">keywordarguments</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_keywordarguments</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">KEYWORDS</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">keyword</span><span class="o">.</span><span class="n">time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">keywordarguments</span><span class="p">[</span><span class="n">keyword</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">keyword</span><span class="o">.</span><span class="n">time</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">keywordarguments</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_timefactor</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">keywordarguments</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_timefactor</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">keywordarguments</span>

<div class="viewcode-block" id="Parameter.compress_repr">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.Parameter.compress_repr">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">compress_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Try to find a compressed parameter value representation and return it.</span>

<span class="sd">        |Parameter.compress_repr| raises a |NotImplementedError| when failing to find a</span>
<span class="sd">        compressed representation.</span>

<span class="sd">        For the following examples, we define a 1-dimensional sequence handling</span>
<span class="sd">        time-dependent floating-point values:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.core.parametertools import Parameter</span>
<span class="sd">        &gt;&gt;&gt; class Test(Parameter):</span>
<span class="sd">        ...     NDIM = 1</span>
<span class="sd">        ...     TYPE = float</span>
<span class="sd">        ...     TIME = True</span>
<span class="sd">        &gt;&gt;&gt; test = Test(None)</span>

<span class="sd">        Before and directly after defining the parameter shape, `nan` is returned:</span>

<span class="sd">        &gt;&gt;&gt; test.compress_repr()</span>
<span class="sd">        &#39;?&#39;</span>
<span class="sd">        &gt;&gt;&gt; test</span>
<span class="sd">        test(?)</span>
<span class="sd">        &gt;&gt;&gt; test.shape = 4</span>
<span class="sd">        &gt;&gt;&gt; test</span>
<span class="sd">        test(?)</span>

<span class="sd">        Due to the time-dependence of the values of our test class, we need to specify</span>
<span class="sd">        a parameter and a simulation time step:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import print_vector, pub</span>
<span class="sd">        &gt;&gt;&gt; pub.options.parameterstep = &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; pub.options.simulationstep = &quot;8h&quot;</span>

<span class="sd">        Compression succeeds when all required values are identical:</span>

<span class="sd">        &gt;&gt;&gt; test(3.0, 3.0, 3.0, 3.0)</span>
<span class="sd">        &gt;&gt;&gt; print_vector(test.values)</span>
<span class="sd">        1.0, 1.0, 1.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; test.compress_repr()</span>
<span class="sd">        &#39;3.0&#39;</span>
<span class="sd">        &gt;&gt;&gt; test</span>
<span class="sd">        test(3.0)</span>

<span class="sd">        Method |Parameter.compress_repr| returns |None| in case the required values are</span>
<span class="sd">        not identical:</span>

<span class="sd">        &gt;&gt;&gt; test(1.0, 2.0, 3.0, 3.0)</span>
<span class="sd">        &gt;&gt;&gt; test.compress_repr()</span>
<span class="sd">        &gt;&gt;&gt; test</span>
<span class="sd">        test(1.0, 2.0, 3.0, 3.0)</span>

<span class="sd">        If some values are not required, indicate this by the `mask` descriptor:</span>

<span class="sd">        &gt;&gt;&gt; import numpy</span>
<span class="sd">        &gt;&gt;&gt; test(3.0, 3.0, 3.0, numpy.nan)</span>
<span class="sd">        &gt;&gt;&gt; test</span>
<span class="sd">        test(3.0, 3.0, 3.0, nan)</span>
<span class="sd">        &gt;&gt;&gt; Test.mask = numpy.array([True, True, True, False])</span>
<span class="sd">        &gt;&gt;&gt; test</span>
<span class="sd">        test(3.0)</span>

<span class="sd">        If trying to access the mask results in an error, |Parameter.compress_repr|</span>
<span class="sd">        behaves as if no mask were available:</span>

<span class="sd">        &gt;&gt;&gt; def getattribute(obj, name):</span>
<span class="sd">        ...     if name == &#39;mask&#39;:</span>
<span class="sd">        ...         raise BaseException</span>
<span class="sd">        ...     return object.__getattribute__(obj, name)</span>
<span class="sd">        &gt;&gt;&gt; Test.__getattribute__ = getattribute</span>
<span class="sd">        &gt;&gt;&gt; test</span>
<span class="sd">        test(3.0, 3.0, 3.0, nan)</span>

<span class="sd">        For a shape of zero, the string representing includes an empty list:</span>

<span class="sd">        &gt;&gt;&gt; test.shape = 0</span>
<span class="sd">        &gt;&gt;&gt; test.compress_repr()</span>
<span class="sd">        &#39;[]&#39;</span>
<span class="sd">        &gt;&gt;&gt; test</span>
<span class="sd">        test([])</span>

<span class="sd">        Method |Parameter.compress_repr| works similarly for different |Parameter|</span>
<span class="sd">        subclasses.  The following examples focus on a 2-dimensional parameter handling</span>
<span class="sd">        integer values:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.core.parametertools import Parameter</span>
<span class="sd">        &gt;&gt;&gt; class Test(Parameter):</span>
<span class="sd">        ...     NDIM = 2</span>
<span class="sd">        ...     TYPE = int</span>
<span class="sd">        ...     TIME = None</span>
<span class="sd">        &gt;&gt;&gt; test = Test(None)</span>

<span class="sd">        &gt;&gt;&gt; test.compress_repr()</span>
<span class="sd">        &#39;?&#39;</span>
<span class="sd">        &gt;&gt;&gt; test</span>
<span class="sd">        test(?)</span>
<span class="sd">        &gt;&gt;&gt; test.shape = (2, 3)</span>
<span class="sd">        &gt;&gt;&gt; test</span>
<span class="sd">        test(?)</span>

<span class="sd">        &gt;&gt;&gt; test([[3, 3, 3],</span>
<span class="sd">        ...       [3, 3, 3]])</span>
<span class="sd">        &gt;&gt;&gt; test</span>
<span class="sd">        test(3)</span>

<span class="sd">        &gt;&gt;&gt; test([[3, 3, -999999],</span>
<span class="sd">        ...       [3, 3, 3]])</span>
<span class="sd">        &gt;&gt;&gt; test</span>
<span class="sd">        test([[3, 3, -999999],</span>
<span class="sd">              [3, 3, 3]])</span>

<span class="sd">        &gt;&gt;&gt; Test.mask = numpy.array([[True, True, False],</span>
<span class="sd">        ...                          [True, True, True]])</span>
<span class="sd">        &gt;&gt;&gt; test</span>
<span class="sd">        test(3)</span>

<span class="sd">        &gt;&gt;&gt; test.shape = (0, 0)</span>
<span class="sd">        &gt;&gt;&gt; test</span>
<span class="sd">        test([[]])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">exceptiontools</span><span class="o">.</span><span class="n">attrready</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;?&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">NDIM</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="s1">&#39;[&#39;</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">NDIM</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="s1">&#39;]&#39;</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">unique</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
            <span class="n">unique</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">unique</span><span class="p">))</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique</span><span class="o">.</span><span class="n">flatten</span><span class="p">()):</span>
            <span class="n">unique</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">numpy</span><span class="o">.</span><span class="n">nan</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">unique</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">revert_timefactor</span><span class="p">(</span><span class="n">unique</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">repr_</span><span class="p">(</span><span class="n">unique</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="kc">None</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDIM</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compress_repr</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">values</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">revert_timefactor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
            <span class="n">brackets</span> <span class="o">=</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">values</span> <span class="o">==</span> <span class="s2">&quot;?&quot;</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NDIM</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">variabletools</span><span class="o">.</span><span class="n">to_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">brackets</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">exceptiontools</span><span class="o">.</span><span class="n">attrready</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">revert_timefactor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;?&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">repr_</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span></div>



<span class="k">class</span><span class="w"> </span><span class="nc">_MixinModifiableParameter</span><span class="p">(</span><span class="n">Parameter</span><span class="p">):</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_reset_after_modification</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">object</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">delattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>


<div class="viewcode-block" id="NameParameter">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.NameParameter">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">NameParameter</span><span class="p">(</span><span class="n">_MixinModifiableParameter</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parameter displaying the names of constants instead of their values.</span>

<span class="sd">    For demonstration, we define the test class `LandType`, covering three different</span>
<span class="sd">    types of land covering.  For this purpose, we need to prepare a dictionary of type</span>
<span class="sd">    |Constants| (class attribute `constants`), mapping the land type names to identity</span>
<span class="sd">    values.  The class attributes `NDIM`, `TYPE`, and `TIME` are already set to `1`,</span>
<span class="sd">    `int`, and `None` via base class |NameParameter|.  Furthermore, both `SPAN` tuple</span>
<span class="sd">    entries are `None` because |NameParameter| can perform checks against the available</span>
<span class="sd">    constants, which is more precise than only checking against the lowest and highest</span>
<span class="sd">    constant value:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy.core.parametertools import Constants, NameParameter</span>
<span class="sd">    &gt;&gt;&gt; class LandType(NameParameter):</span>
<span class="sd">    ...     __name__ = &quot;temp.py&quot;</span>
<span class="sd">    ...     constants = Constants(SOIL=1, WATER=2, GLACIER=3)</span>

<span class="sd">    Additionally, we make the constants available within the local namespace (which is</span>
<span class="sd">    usually done by importing the constants from the selected application model</span>
<span class="sd">    automatically):</span>

<span class="sd">    &gt;&gt;&gt; SOIL, WATER, GLACIER = 1, 2, 3</span>

<span class="sd">    For parameters of zero length, unprepared values, and identical required values,</span>
<span class="sd">    the string representations of |NameParameter| subclasses equal those of other</span>
<span class="sd">    |Parameter| subclasses:</span>

<span class="sd">    &gt;&gt;&gt; landtype = LandType(None)</span>
<span class="sd">    &gt;&gt;&gt; landtype.shape = 0</span>
<span class="sd">    &gt;&gt;&gt; landtype</span>
<span class="sd">    landtype([])</span>
<span class="sd">    &gt;&gt;&gt; landtype.shape = 5</span>
<span class="sd">    &gt;&gt;&gt; landtype</span>
<span class="sd">    landtype(?)</span>
<span class="sd">    &gt;&gt;&gt; landtype(SOIL)</span>
<span class="sd">    &gt;&gt;&gt; landtype</span>
<span class="sd">    landtype(SOIL)</span>

<span class="sd">    For non-identical required values, class |NameParameter| replaces the identity</span>
<span class="sd">    values with their names:</span>

<span class="sd">    &gt;&gt;&gt; landtype(SOIL, WATER, GLACIER, WATER, SOIL)</span>
<span class="sd">    &gt;&gt;&gt; landtype</span>
<span class="sd">    landtype(SOIL, WATER, GLACIER, WATER, SOIL)</span>

<span class="sd">    For high numbers of entries, string representations are wrapped:</span>

<span class="sd">    &gt;&gt;&gt; landtype.shape = 22</span>
<span class="sd">    &gt;&gt;&gt; landtype(SOIL)</span>
<span class="sd">    &gt;&gt;&gt; landtype.values[0] = WATER</span>
<span class="sd">    &gt;&gt;&gt; landtype.values[-1] = GLACIER</span>
<span class="sd">    &gt;&gt;&gt; landtype</span>
<span class="sd">    landtype(WATER, SOIL, SOIL, SOIL, SOIL, SOIL, SOIL, SOIL, SOIL, SOIL,</span>
<span class="sd">             SOIL, SOIL, SOIL, SOIL, SOIL, SOIL, SOIL, SOIL, SOIL, SOIL,</span>
<span class="sd">             SOIL, GLACIER)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">NDIM</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">TYPE</span> <span class="o">=</span> <span class="nb">int</span>
    <span class="n">TIME</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">SPAN</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">constants</span><span class="p">:</span> <span class="n">Constants</span>
    <span class="n">_possible_values</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subvars</span><span class="p">:</span> <span class="n">SubParameters</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">subvars</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">constants</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">constants</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_possible_values</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_possible_values</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">variabletools</span><span class="o">.</span><span class="n">INT_NAN</span><span class="p">)</span>

<div class="viewcode-block" id="NameParameter.modify_constants">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.NameParameter.modify_constants">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">modify_constants</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">constants</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Constants</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Modify the relevant constants temporarily.</span>

<span class="sd">        The constants for defining land-use types are fixed for typical &quot;main models&quot;</span>
<span class="sd">        like |hland|.  However, some submodels must take over the constants defined</span>
<span class="sd">        by their current main model, which are only known at runtime.  For example,</span>
<span class="sd">        consider the following simple `LandType` parameter that handles predefined</span>
<span class="sd">        constants as a class attribute:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.core.parametertools import Constants, NameParameter</span>
<span class="sd">        &gt;&gt;&gt; class LandType(NameParameter):</span>
<span class="sd">        ...     __name__ = &quot;temp.py&quot;</span>
<span class="sd">        ...     constants = Constants(SOIL=1, WATER=2, GLACIER=3)</span>
<span class="sd">        &gt;&gt;&gt; SOIL, WATER, GLACIER = 1, 2, 3</span>
<span class="sd">        &gt;&gt;&gt; landtype1 = LandType(None)</span>
<span class="sd">        &gt;&gt;&gt; landtype1.shape = 3</span>
<span class="sd">        &gt;&gt;&gt; landtype1(SOIL, WATER, SOIL)</span>
<span class="sd">        &gt;&gt;&gt; landtype1</span>
<span class="sd">        landtype(SOIL, WATER, SOIL)</span>

<span class="sd">        We can use |NameParameter.modify_constants| to temporarily change these</span>
<span class="sd">        constants:</span>

<span class="sd">        &gt;&gt;&gt; FIELD, FOREST = 1, 4</span>
<span class="sd">        &gt;&gt;&gt; with LandType.modify_constants(Constants(FIELD=1, FOREST=4)):</span>
<span class="sd">        ...     landtype2 = LandType(None)</span>
<span class="sd">        ...     landtype2.shape = 4</span>
<span class="sd">        ...     landtype2(FOREST, FOREST, FIELD, FIELD)</span>
<span class="sd">        ...     landtype2</span>
<span class="sd">        landtype(FOREST, FOREST, FIELD, FIELD)</span>

<span class="sd">        During initialisation, these constants become an instance attribute, so the</span>
<span class="sd">        parameter instance does not forget them after leaving the `with` block (when</span>
<span class="sd">        the class attribute is reset to its previous value):</span>

<span class="sd">        &gt;&gt;&gt; landtype1.constants</span>
<span class="sd">        {&#39;SOIL&#39;: 1, &#39;WATER&#39;: 2, &#39;GLACIER&#39;: 3}</span>
<span class="sd">        &gt;&gt;&gt; landtype2.constants</span>
<span class="sd">        {&#39;FIELD&#39;: 1, &#39;FOREST&#39;: 4}</span>
<span class="sd">        &gt;&gt;&gt; LandType.constants</span>
<span class="sd">        {&#39;SOIL&#39;: 1, &#39;WATER&#39;: 2, &#39;GLACIER&#39;: 3}</span>

<span class="sd">        One can now use both parameter instances with their specific constants without</span>
<span class="sd">        the risk of impacting the other:</span>

<span class="sd">        &gt;&gt;&gt; landtype1(SOIL, WATER, WATER)</span>
<span class="sd">        &gt;&gt;&gt; landtype1</span>
<span class="sd">        landtype(SOIL, WATER, WATER)</span>
<span class="sd">        &gt;&gt;&gt; landtype2</span>
<span class="sd">        landtype(FOREST, FOREST, FIELD, FIELD)</span>

<span class="sd">        &gt;&gt;&gt; landtype2(FIELD, FOREST, FOREST, FIELD)</span>
<span class="sd">        &gt;&gt;&gt; landtype2</span>
<span class="sd">        landtype(FIELD, FOREST, FOREST, FIELD)</span>
<span class="sd">        &gt;&gt;&gt; landtype1</span>
<span class="sd">        landtype(SOIL, WATER, WATER)</span>

<span class="sd">        Passing |None| does not overwrite the default or the previously set references:</span>

<span class="sd">        &gt;&gt;&gt; with LandType.modify_constants(None):</span>
<span class="sd">        ...     LandType.constants</span>
<span class="sd">        ...     landtype3 = LandType(None)</span>
<span class="sd">        ...     landtype3.shape = 4</span>
<span class="sd">        ...     landtype3(GLACIER, SOIL, GLACIER, WATER)</span>
<span class="sd">        ...     landtype3</span>
<span class="sd">        {&#39;SOIL&#39;: 1, &#39;WATER&#39;: 2, &#39;GLACIER&#39;: 3}</span>
<span class="sd">        landtype(GLACIER, SOIL, GLACIER, WATER)</span>
<span class="sd">        &gt;&gt;&gt; LandType.constants</span>
<span class="sd">        {&#39;SOIL&#39;: 1, &#39;WATER&#39;: 2, &#39;GLACIER&#39;: 3}</span>
<span class="sd">        &gt;&gt;&gt; landtype3</span>
<span class="sd">        landtype(GLACIER, SOIL, GLACIER, WATER)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">constants</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">yield</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">old</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;constants&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">constants</span> <span class="o">=</span> <span class="n">constants</span>
                <span class="k">yield</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">_reset_after_modification</span><span class="p">(</span><span class="s2">&quot;constants&quot;</span><span class="p">,</span> <span class="n">old</span><span class="p">)</span></div>


<div class="viewcode-block" id="NameParameter.trim">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.NameParameter.trim">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">trim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if all previously set values comply with the supported constants.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.core.parametertools import Constants, NameParameter</span>
<span class="sd">        &gt;&gt;&gt; class LandType(NameParameter):</span>
<span class="sd">        ...     __name__ = &quot;temp.py&quot;</span>
<span class="sd">        ...     constants = Constants(SOIL=1, WATER=2, GLACIER=4)</span>
<span class="sd">        &gt;&gt;&gt; SOIL, WATER, ROCK, GLACIER = 1, 2, 3, 4</span>
<span class="sd">        &gt;&gt;&gt; landtype = LandType(None)</span>
<span class="sd">        &gt;&gt;&gt; landtype.shape = 4</span>
<span class="sd">        &gt;&gt;&gt; landtype(SOIL, WATER, ROCK, GLACIER)</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ..</span>
<span class="sd">        ValueError: At least one value of parameter `landtype` of element `?` is not \</span>
<span class="sd">valid.</span>
<span class="sd">        &gt;&gt;&gt; landtype</span>
<span class="sd">        landtype(SOIL, WATER, 3, GLACIER)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">trimvariables</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_possible_values</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_value</span><span class="p">()):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;At least one value of parameter &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">elementphrase</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2"> is not valid.&quot;</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">string</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">compress_repr</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">string</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;?&quot;</span><span class="p">,</span> <span class="s2">&quot;[]&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="n">string</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">if</span> <span class="n">string</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">string</span><span class="p">)]</span>
        <span class="n">get</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">value2name</span><span class="o">.</span><span class="n">get</span>
        <span class="n">repr_</span> <span class="o">=</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">repr_</span>
        <span class="n">names</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">repr_</span><span class="p">(</span><span class="n">value</span><span class="p">))</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">)</span>
        <span class="n">string</span> <span class="o">=</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">assignrepr_values</span><span class="p">(</span>
            <span class="n">values</span><span class="o">=</span><span class="n">names</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">(&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">70</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">string</span><span class="si">}</span><span class="s2">)&quot;</span></div>



<div class="viewcode-block" id="ZipParameter">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.ZipParameter">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ZipParameter</span><span class="p">(</span><span class="n">_MixinModifiableParameter</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for 1-dimensional model parameters that offers an additional</span>
<span class="sd">    keyword-based zipping functionality.</span>

<span class="sd">    Many models implemented in the *HydPy* framework realise the concept of hydrological</span>
<span class="sd">    response units via 1-dimensional |Parameter| objects, each entry corresponding with</span>
<span class="sd">    an individual unit.  To allow for a maximum of flexibility, one can define their</span>
<span class="sd">    values independently, which allows, for example, for applying arbitrary</span>
<span class="sd">    relationships between the altitude of individual response units and a precipitation</span>
<span class="sd">    correction factor to be parameterised.</span>

<span class="sd">    However, very often, hydrological modellers set identical values for different</span>
<span class="sd">    hydrological response units of the same type. One could, for example, set the same</span>
<span class="sd">    leaf area index for all units of the same land-use type.  Class |ZipParameter|</span>
<span class="sd">    allows defining parameters, which conveniently support this parameterisation</span>
<span class="sd">    strategy.</span>

<span class="sd">    .. testsetup::</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; del pub.options.simulationstep</span>

<span class="sd">    To see how base class |ZipParameter| works, we need to create some additional</span>
<span class="sd">    subclasses.  First, we need a parameter defining the type of the individual</span>
<span class="sd">    hydrological response units, which can be done by subclassing from |NameParameter|.</span>
<span class="sd">    We do so by taking the example from the documentation of the |NameParameter| class:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy.core.parametertools import NameParameter</span>
<span class="sd">    &gt;&gt;&gt; SOIL, WATER, GLACIER = 1, 2, 3</span>
<span class="sd">    &gt;&gt;&gt; class LandType(NameParameter):</span>
<span class="sd">    ...     SPAN = (1, 3)</span>
<span class="sd">    ...     constants = {&quot;SOIL&quot;:  SOIL, &quot;WATER&quot;: WATER, &quot;GLACIER&quot;: GLACIER}</span>
<span class="sd">    &gt;&gt;&gt; landtype = LandType(None)</span>

<span class="sd">    Second, we need an |IndexMask| subclass.  Our subclass `Land` references the</span>
<span class="sd">    respective `LandType` parameter object (we do this in a simplified manner, see class</span>
<span class="sd">    |hland_parameters.ParameterComplete| for a &quot;real world&quot; example) but is supposed to</span>
<span class="sd">    focus on the response units of type `soil` or `glacier` only:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy.core.masktools import IndexMask</span>
<span class="sd">    &gt;&gt;&gt; class Land(IndexMask):</span>
<span class="sd">    ...     relevant = (SOIL, GLACIER)</span>
<span class="sd">    ...     @staticmethod</span>
<span class="sd">    ...     def get_refindices(variable):</span>
<span class="sd">    ...         return variable.landtype</span>

<span class="sd">    Third, we prepare the actual |ZipParameter| subclass, holding the same `constants`</span>
<span class="sd">    dictionary as the `LandType` parameter and the `Land` mask as attributes.  We assume</span>
<span class="sd">    that the values of our test class `Par` are time-dependent and set different</span>
<span class="sd">    parameter and simulation step sizes, to show that the related value adjustments</span>
<span class="sd">    work.  Also, we make the `LandType` object available via attribute access, which is</span>
<span class="sd">    a hack to make the above simplification work:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy.core.parametertools import ZipParameter</span>
<span class="sd">    &gt;&gt;&gt; class Par(ZipParameter):</span>
<span class="sd">    ...     TYPE = float</span>
<span class="sd">    ...     TIME = True</span>
<span class="sd">    ...     SPAN = (0.0, None)</span>
<span class="sd">    ...     constants = LandType.constants</span>
<span class="sd">    ...     mask = Land()</span>
<span class="sd">    ...     landtype = landtype</span>
<span class="sd">    &gt;&gt;&gt; par = Par(None)</span>
<span class="sd">    &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">    &gt;&gt;&gt; pub.options.parameterstep = &quot;1d&quot;</span>
<span class="sd">    &gt;&gt;&gt; pub.options.simulationstep = &quot;12h&quot;</span>

<span class="sd">    For parameters with zero-length or with unprepared or identical parameter values,</span>
<span class="sd">    the string representation looks as usual:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy import print_vector</span>
<span class="sd">    &gt;&gt;&gt; landtype.shape = 0</span>
<span class="sd">    &gt;&gt;&gt; par.shape = 0</span>
<span class="sd">    &gt;&gt;&gt; par</span>
<span class="sd">    par([])</span>
<span class="sd">    &gt;&gt;&gt; landtype.shape = 5</span>
<span class="sd">    &gt;&gt;&gt; landtype(SOIL, WATER, GLACIER, WATER, SOIL)</span>
<span class="sd">    &gt;&gt;&gt; par.shape = 5</span>
<span class="sd">    &gt;&gt;&gt; par</span>
<span class="sd">    par(?)</span>
<span class="sd">    &gt;&gt;&gt; par(2.0)</span>
<span class="sd">    &gt;&gt;&gt; par</span>
<span class="sd">    par(2.0)</span>
<span class="sd">    &gt;&gt;&gt; print_vector(par.values)</span>
<span class="sd">    1.0, 1.0, 1.0, 1.0, 1.0</span>

<span class="sd">    The extended feature of class |ZipParameter| is to allow passing values via</span>
<span class="sd">    keywords, each keyword corresponding to one of the relevant constants (in our</span>
<span class="sd">    example: `SOIL` and `GLACIER`) in lower case letters:</span>

<span class="sd">    &gt;&gt;&gt; par(soil=4.0, glacier=6.0)</span>
<span class="sd">    &gt;&gt;&gt; par</span>
<span class="sd">    par(glacier=6.0, soil=4.0)</span>
<span class="sd">    &gt;&gt;&gt; print_vector(par.values)</span>
<span class="sd">    2.0, nan, 3.0, nan, 2.0</span>

<span class="sd">    Use the `default` argument if you want to assign the same value to entries with</span>
<span class="sd">    different constants:</span>

<span class="sd">    &gt;&gt;&gt; par(soil=2.0, default=8.0)</span>
<span class="sd">    &gt;&gt;&gt; par</span>
<span class="sd">    par(glacier=8.0, soil=2.0)</span>
<span class="sd">    &gt;&gt;&gt; print_vector(par.values)</span>
<span class="sd">    1.0, nan, 4.0, nan, 1.0</span>

<span class="sd">    Using a keyword argument corresponding to an existing, but not relevant constant (in</span>
<span class="sd">    our example: `WATER`) is silently ignored:</span>

<span class="sd">    &gt;&gt;&gt; par(soil=4.0, glacier=6.0, water=8.0)</span>
<span class="sd">    &gt;&gt;&gt; par</span>
<span class="sd">    par(glacier=6.0, soil=4.0)</span>
<span class="sd">    &gt;&gt;&gt; print_vector(par.values)</span>
<span class="sd">    2.0, nan, 3.0, nan, 2.0</span>

<span class="sd">    However, using a keyword not corresponding to any constant raises an exception:</span>

<span class="sd">    &gt;&gt;&gt; par(soil=4.0, glacier=6.0, wrong=8.0)</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    TypeError: While trying to set the values of parameter `par` of element `?` based \</span>
<span class="sd">on keyword arguments `soil, glacier, and wrong`, the following error occurred: Keyword \</span>
<span class="sd">`wrong` is not among the available model constants.</span>

<span class="sd">    The same is true when passing incomplete information:</span>

<span class="sd">    &gt;&gt;&gt; par(soil=4.0)</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    TypeError: While trying to set the values of parameter `par` of element `?` based \</span>
<span class="sd">on keyword arguments `soil`, the following error occurred: The given keywords are \</span>
<span class="sd">incomplete and no default value is available.</span>

<span class="sd">    Values exceeding the bounds defined by class attribute `SPAN` are trimmed as usual:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">    &gt;&gt;&gt; with pub.options.warntrim(False):</span>
<span class="sd">    ...     par(soil=-10.0, glacier=10.0)</span>
<span class="sd">    &gt;&gt;&gt; par</span>
<span class="sd">    par(glacier=10.0, soil=0.0)</span>

<span class="sd">    For convenience, you can get or set all values related to a specific constant via</span>
<span class="sd">    attribute access:</span>

<span class="sd">    &gt;&gt;&gt; print_vector(par.soil)</span>
<span class="sd">    0.0, 0.0</span>
<span class="sd">    &gt;&gt;&gt; par.soil = 2.5</span>
<span class="sd">    &gt;&gt;&gt; par</span>
<span class="sd">    par(glacier=10.0, soil=5.0)</span>

<span class="sd">    Improper use of these &quot;special attributes&quot; results in errors like the following:</span>

<span class="sd">    &gt;&gt;&gt; par.Soil  # doctest: +ELLIPSIS</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    AttributeError: `Soil` is neither a normal attribute of parameter `par` of element \</span>
<span class="sd">`?` nor among the following special attributes: soil, water, and glacier...</span>

<span class="sd">    &gt;&gt;&gt; par.soil = &quot;test&quot;</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ValueError: While trying the set the value(s) of parameter `par` of element `?` \</span>
<span class="sd">related to the special attribute `soil`, the following error occurred: could not \</span>
<span class="sd">convert string to float: &#39;test&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">NDIM</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">constants</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Mapping of the constants&#39; names and values.&quot;&quot;&quot;</span>
    <span class="n">refindices</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NameParameter</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Optional reference to the relevant index parameter.&quot;&quot;&quot;</span>
    <span class="n">relevant</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The values of all (potentially) relevant constants.&quot;&quot;&quot;</span>
    <span class="n">mask</span><span class="p">:</span> <span class="n">masktools</span><span class="o">.</span><span class="n">IndexMask</span>

<div class="viewcode-block" id="ZipParameter.modify_refindices">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.ZipParameter.modify_refindices">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">modify_refindices</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">refindices</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NameParameter</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Eventually, set or modify the reference to the required index parameter.</span>

<span class="sd">        The following example demonstrates that changes affect the relevant class only</span>
<span class="sd">        temporarily, but its objects initialised within the &quot;with&quot; block persistently:</span>


<span class="sd">        &gt;&gt;&gt; from hydpy.core.variabletools import FastAccess, Variable</span>
<span class="sd">        &gt;&gt;&gt; GRASS, TREES, WATER = 0, 1, 2</span>
<span class="sd">        &gt;&gt;&gt; class RefPar(Variable):</span>
<span class="sd">        ...     NDIM = 1</span>
<span class="sd">        ...     TYPE = int</span>
<span class="sd">        ...     TIME = None</span>
<span class="sd">        ...     initinfo = 0, True</span>
<span class="sd">        ...     _CLS_FASTACCESS_PYTHON = FastAccess</span>
<span class="sd">        ...     constants = {&quot;GRASS&quot;: GRASS, &quot;TREES&quot;: TREES, &quot;WATER&quot;: WATER}</span>
<span class="sd">        ...     relevant = (0, 1, 2)</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.core.parametertools import ZipParameter</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.core.masktools import SubmodelIndexMask</span>
<span class="sd">        &gt;&gt;&gt; class ZipPar(ZipParameter):</span>
<span class="sd">        ...     NDIM = 1</span>
<span class="sd">        ...     TYPE = float</span>
<span class="sd">        ...     TIME = None</span>
<span class="sd">        ...     initinfo = 0.0, True</span>
<span class="sd">        ...     _CLS_FASTACCESS_PYTHON = FastAccess</span>
<span class="sd">        ...     constants = {&quot;FIELD&quot;: 1, &quot;FOREST&quot;: 3}</span>
<span class="sd">        ...     relevant = (1, 3)</span>
<span class="sd">        ...     mask = SubmodelIndexMask()</span>
<span class="sd">        &gt;&gt;&gt; refpar = RefPar(None)</span>
<span class="sd">        &gt;&gt;&gt; refpar.shape = 3</span>
<span class="sd">        &gt;&gt;&gt; refpar(1, 2, 1)</span>
<span class="sd">        &gt;&gt;&gt; with ZipPar.modify_refindices(refpar):</span>
<span class="sd">        ...     ZipPar.refindices.name</span>
<span class="sd">        ...     ZipPar.constants</span>
<span class="sd">        ...     ZipPar.relevant</span>
<span class="sd">        ...     zippar1 = ZipPar(None)</span>
<span class="sd">        ...     zippar1.shape = 3</span>
<span class="sd">        ...     zippar1(water=1.0, default=2.)</span>
<span class="sd">        ...     zippar1</span>
<span class="sd">        &#39;refpar&#39;</span>
<span class="sd">        {&#39;GRASS&#39;: 0, &#39;TREES&#39;: 1, &#39;WATER&#39;: 2}</span>
<span class="sd">        (0, 1, 2)</span>
<span class="sd">        zippar(trees=2.0, water=1.0)</span>

<span class="sd">        &gt;&gt;&gt; ZipPar.refindices</span>
<span class="sd">        &gt;&gt;&gt; ZipPar.constants</span>
<span class="sd">        {&#39;FIELD&#39;: 1, &#39;FOREST&#39;: 3}</span>
<span class="sd">        &gt;&gt;&gt; ZipPar.relevant</span>
<span class="sd">        (1, 3)</span>
<span class="sd">        &gt;&gt;&gt; zippar1</span>
<span class="sd">        zippar(trees=2.0, water=1.0)</span>

<span class="sd">        Passing |None| does not overwrite previously set references:</span>

<span class="sd">        &gt;&gt;&gt; with ZipPar.modify_refindices(None):</span>
<span class="sd">        ...     ZipPar.refindices</span>
<span class="sd">        ...     ZipPar.constants</span>
<span class="sd">        ...     ZipPar.relevant</span>
<span class="sd">        {&#39;FIELD&#39;: 1, &#39;FOREST&#39;: 3}</span>
<span class="sd">        (1, 3)</span>

<span class="sd">        &gt;&gt;&gt; with ZipPar.modify_refindices(None):</span>
<span class="sd">        ...     zippar2 = ZipPar(None)</span>
<span class="sd">        ...     zippar2.shape = 3</span>
<span class="sd">        ...     zippar2(water=1.0, default=2.)</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        RuntimeError: While trying to set the values of parameter `zippar` of element \</span>
<span class="sd">`?` based on keyword arguments `water and default`, the following error occurred: \</span>
<span class="sd">Variable `zippar` of element `?` does currently not reference an instance-specific \</span>
<span class="sd">index parameter.</span>

<span class="sd">        &gt;&gt;&gt; ZipPar.refindices</span>
<span class="sd">        &gt;&gt;&gt; ZipPar.constants</span>
<span class="sd">        {&#39;FIELD&#39;: 1, &#39;FOREST&#39;: 3}</span>
<span class="sd">        &gt;&gt;&gt; ZipPar.relevant</span>
<span class="sd">        (1, 3)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">refindices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">yield</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">get</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">get</span>
            <span class="n">old_refindices</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="s2">&quot;refindices&quot;</span><span class="p">)</span>
            <span class="n">old_constants</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="s2">&quot;constants&quot;</span><span class="p">)</span>
            <span class="n">old_relevant</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="s2">&quot;relevant&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">refindices</span> <span class="o">=</span> <span class="n">refindices</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">constants</span> <span class="o">=</span> <span class="n">refindices</span><span class="o">.</span><span class="n">constants</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">relevant</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">refindices</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                <span class="k">yield</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">_reset_after_modification</span><span class="p">(</span><span class="s2">&quot;refindices&quot;</span><span class="p">,</span> <span class="n">old_refindices</span><span class="p">)</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">_reset_after_modification</span><span class="p">(</span><span class="s2">&quot;constants&quot;</span><span class="p">,</span> <span class="n">old_constants</span><span class="p">)</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">_reset_after_modification</span><span class="p">(</span><span class="s2">&quot;relevant&quot;</span><span class="p">,</span> <span class="n">old_relevant</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subvars</span><span class="p">:</span> <span class="n">SubParameters</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">subvars</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refindices</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">refindices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">constants</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">constants</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relevant</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">relevant</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">NotImplementedError</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_own_call</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
                <span class="n">objecttools</span><span class="o">.</span><span class="n">augment_excmessage</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;While trying to set the values of parameter &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">elementphrase</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2"> based on keyword arguments &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">enumeration</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span><span class="si">}</span><span class="s2">`&quot;</span>
                <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_own_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_value</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_value</span><span class="p">()</span>
        <span class="n">allidxs</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">refindices</span><span class="o">.</span><span class="n">values</span>
        <span class="n">relidxs</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">narrow_relevant</span><span class="p">(</span><span class="n">relevant</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">relevant</span><span class="p">)</span>
        <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="s2">&quot;default&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">check</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">values</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;default&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">check</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">selidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">constants</span><span class="p">[</span><span class="n">key</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span>
                <span class="k">if</span> <span class="n">selidx</span> <span class="ow">in</span> <span class="n">relidxs</span><span class="p">:</span>
                    <span class="n">values</span><span class="p">[</span><span class="n">allidxs</span> <span class="o">==</span> <span class="n">selidx</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                    <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Keyword `</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">` is not among the &quot;</span> <span class="sa">f</span><span class="s2">&quot;available model constants.&quot;</span>
                <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="kc">None</span>
        <span class="k">if</span> <span class="n">check</span> <span class="ow">and</span> <span class="p">(</span><span class="n">counter</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">relidxs</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;The given keywords are incomplete and no default value is available.&quot;</span>
            <span class="p">)</span>
        <span class="n">values</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_timefactor</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trim</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">keywordarguments</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KeywordArguments</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A |KeywordArguments| object providing the currently valid keyword arguments.</span>

<span class="sd">        We take parameter |lland_control.TRefT| of application model |lland_dd| as an</span>
<span class="sd">        example and set its shape (the number of hydrological response units defined by</span>
<span class="sd">        parameter |lland_control.NHRU|) to four and prepare the land use types</span>
<span class="sd">        |lland_constants.ACKER| (acre), |lland_constants.LAUBW| (deciduous forest), and</span>
<span class="sd">        |lland_constants.WASSER| (water) via parameter |lland_control.Lnk|:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland_dd import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nhru(4)</span>
<span class="sd">        &gt;&gt;&gt; lnk(ACKER, LAUBW, WASSER, ACKER)</span>

<span class="sd">        After defining all required values via keyword arguments (note that parameter</span>
<span class="sd">        |lland_control.TRefT| does not need any values for response units of type</span>
<span class="sd">        |lland_constants.WASSER|), property |ZipParameter.keywordarguments| makes</span>
<span class="sd">        exactly these keywords arguments available:</span>

<span class="sd">        &gt;&gt;&gt; treft(acker=2.0, laubw=1.0)</span>
<span class="sd">        &gt;&gt;&gt; treft.keywordarguments</span>
<span class="sd">        KeywordArguments(acker=2.0, laubw=1.0)</span>
<span class="sd">        &gt;&gt;&gt; treft.keywordarguments.valid</span>
<span class="sd">        True</span>

<span class="sd">        In the following example, both the first and the fourth response unit are of</span>
<span class="sd">        type |lland_constants.ACKER| but have different |lland_control.TRefT| values,</span>
<span class="sd">        which cannot be the result of defining values via keyword arguments.  Hence, the</span>
<span class="sd">        returned |KeywordArguments| object is invalid:</span>

<span class="sd">        &gt;&gt;&gt; treft(1.0, 2.0, 3.0, 4.0)</span>
<span class="sd">        &gt;&gt;&gt; treft.keywordarguments</span>
<span class="sd">        KeywordArguments()</span>
<span class="sd">        &gt;&gt;&gt; treft.keywordarguments.valid</span>
<span class="sd">        False</span>

<span class="sd">        This is different from the situation where all response units are of type</span>
<span class="sd">        |lland_constants.WASSER|, where one does not need to define any values for</span>
<span class="sd">        parameter |lland_control.TRefT|.  Thus, the returned |KeywordArguments| object</span>
<span class="sd">        is also empty but valid:</span>

<span class="sd">        &gt;&gt;&gt; lnk(WASSER)</span>
<span class="sd">        &gt;&gt;&gt; treft.keywordarguments</span>
<span class="sd">        KeywordArguments()</span>
<span class="sd">        &gt;&gt;&gt; treft.keywordarguments.valid</span>
<span class="sd">        True</span>

<span class="sd">        ToDo: document &quot;refinement&quot; asa lland_dd uses the AETModel_V1 interface</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span>
        <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">KeywordArguments</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">refinement</span> <span class="o">:=</span> <span class="n">mask</span><span class="o">.</span><span class="n">refinement</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">refindices</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">refindices</span><span class="o">.</span><span class="n">values</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">refindices</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">refindices</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">refindices</span><span class="p">[</span><span class="o">~</span><span class="n">refinement</span><span class="o">.</span><span class="n">values</span><span class="p">]</span> <span class="o">=</span> <span class="n">variabletools</span><span class="o">.</span><span class="n">INT_NAN</span>
        <span class="n">name2unique</span> <span class="o">=</span> <span class="n">KeywordArguments</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">]]()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">relevant</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">relevant</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">relevant</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">relevant</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">relevant</span><span class="p">:</span>
                <span class="n">unique</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">refindices</span> <span class="o">==</span> <span class="n">value</span><span class="p">])</span>
                <span class="n">unique</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">revert_timefactor</span><span class="p">(</span><span class="n">unique</span><span class="p">)</span>
                <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">length</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">name2unique</span><span class="p">[</span><span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="n">unique</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">KeywordArguments</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">name2unique</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">name_</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">islower</span><span class="p">())</span> <span class="ow">or</span> <span class="p">(</span><span class="n">name_</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">constants</span><span class="p">):</span>
            <span class="n">names</span> <span class="o">=</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">enumeration</span><span class="p">(</span>
                <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">` is neither a normal attribute of parameter &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">elementphrase</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2"> nor among the following special &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;attributes: </span><span class="si">{</span><span class="n">names</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>
        <span class="n">sel_constant</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">constants</span><span class="p">[</span><span class="n">name_</span><span class="p">]</span>
        <span class="n">used_constants</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">refindices</span><span class="o">.</span><span class="n">values</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">used_constants</span> <span class="o">==</span> <span class="n">sel_constant</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">name_</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">islower</span><span class="p">()</span> <span class="ow">and</span> <span class="p">(</span><span class="n">name_</span> <span class="ow">in</span> <span class="p">(</span><span class="n">constants</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">constants</span><span class="p">)):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">sel_constant</span> <span class="o">=</span> <span class="n">constants</span><span class="p">[</span><span class="n">name_</span><span class="p">]</span>
                <span class="n">used_constants</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">refindices</span><span class="o">.</span><span class="n">values</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">used_constants</span> <span class="o">==</span> <span class="n">sel_constant</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
                <span class="n">objecttools</span><span class="o">.</span><span class="n">augment_excmessage</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;While trying the set the value(s) of parameter &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">elementphrase</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2"> related to the special &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;attribute `</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">`&quot;</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compress_repr</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">string</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="n">string</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="n">keywordarguments</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">keywordarguments</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">keywordarguments</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">repr_</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">keywordarguments</span>
        <span class="p">]</span>
        <span class="n">string</span> <span class="o">=</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">assignrepr_values</span><span class="p">(</span>
            <span class="n">values</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">results</span><span class="p">),</span> <span class="n">prefix</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">(&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">70</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">string</span><span class="si">}</span><span class="s2">)&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.lland_dd import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; sorted(set(dir(treft)) - set(object.__dir__(treft)))</span>
<span class="sd">        [&#39;acker&#39;, &#39;baumb&#39;, &#39;boden&#39;, &#39;feucht&#39;, &#39;fluss&#39;, &#39;glets&#39;, &#39;grue_e&#39;, &#39;grue_i&#39;, \</span>
<span class="sd">&#39;laubw&#39;, &#39;mischw&#39;, &#39;nadelw&#39;, &#39;obstb&#39;, &#39;see&#39;, &#39;sied_d&#39;, &#39;sied_l&#39;, &#39;vers&#39;, &#39;wasser&#39;, \</span>
<span class="sd">&#39;weinb&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">names</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span>
            <span class="n">cast</span><span class="p">(</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__dir__</span><span class="p">()),</span>
            <span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">names</span><span class="p">)</span></div>



<div class="viewcode-block" id="SeasonalParameter">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.SeasonalParameter">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">SeasonalParameter</span><span class="p">(</span><span class="n">Parameter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for parameters handling values showing a seasonal variation.</span>

<span class="sd">    Quite a lot of model parameter values change on an annual basis.  One example is</span>
<span class="sd">    the leaf area index.  For deciduous forests within temperate climatic regions, it</span>
<span class="sd">    shows a clear peak during the summer season.</span>

<span class="sd">    If you want to vary the parameter values on a fixed (for example, a monthly) basis,</span>
<span class="sd">    |KeywordParameter2D| might be the best starting point.  See the</span>
<span class="sd">    |lland_parameters.LanduseMonthParameter| class of the |lland| base model as an</span>
<span class="sd">    example, which is used to define parameter |lland_control.LAI|, handling monthly</span>
<span class="sd">    leaf area index values for different land-use classes.</span>

<span class="sd">    However, class |SeasonalParameter| offers more flexibility in defining seasonal</span>
<span class="sd">    patterns, which is often helpful for modelling technical control systems.  One</span>
<span class="sd">    example is the parameter |dam_control.TargetVolume| of base model |dam| for</span>
<span class="sd">    determining a dam&#39;s desired volume throughout the year.</span>

<span class="sd">    .. testsetup::</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; del pub.options.simulationstep</span>

<span class="sd">    For the following examples, we assume a simulation step size of one day:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">    &gt;&gt;&gt; pub.timegrids = &quot;2000-01-01&quot;, &quot;2001-01-01&quot;, &quot;1d&quot;</span>

<span class="sd">    Let us prepare an empty 1-dimensional |SeasonalParameter| instance:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy.core.parametertools import SeasonalParameter</span>
<span class="sd">    &gt;&gt;&gt; class Par(SeasonalParameter):</span>
<span class="sd">    ...     NDIM = 1</span>
<span class="sd">    ...     TIME = None</span>
<span class="sd">    &gt;&gt;&gt; par = Par(None)</span>
<span class="sd">    &gt;&gt;&gt; par.NDIM = 1</span>
<span class="sd">    &gt;&gt;&gt; par</span>
<span class="sd">    par()</span>

<span class="sd">    The shape is determined automatically, as described in the documentation on</span>
<span class="sd">    property |SeasonalParameter.shape| in more detail:</span>

<span class="sd">    &gt;&gt;&gt; par.shape = (None,)</span>
<span class="sd">    &gt;&gt;&gt; par.shape</span>
<span class="sd">    (366,)</span>

<span class="sd">    Pairs of |TOY| objects and |float| values define the seasonal pattern.  One can</span>
<span class="sd">    assign them all at once via keyword arguments:</span>

<span class="sd">    &gt;&gt;&gt; par(_1=2., _7_1=4., _3_1_0_0_0=5.)</span>

<span class="sd">    Note that all keywords in the call above are proper |TOY| initialisation arguments.</span>
<span class="sd">    Misspelt keywords result in error messages like the following:</span>

<span class="sd">    &gt;&gt;&gt; Par(None)(_a=1.)</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ValueError: While trying to define the seasonal parameter value `par` of element \</span>
<span class="sd">`?` for time of year `_a`, the following error occurred: While trying to initialise a \</span>
<span class="sd">TOY object based on argument value `_a` of type `str`, the following error occurred: \</span>
<span class="sd">While trying to retrieve the month, the following error occurred: For TOY (time of \</span>
<span class="sd">year) objects, all properties must be of type `int`, but the value `a` of type `str` \</span>
<span class="sd">given for property `month` cannot be converted to `int`.</span>

<span class="sd">    As the following string representation shows are the pairs of each</span>
<span class="sd">    |SeasonalParameter| instance automatically sorted:</span>

<span class="sd">    &gt;&gt;&gt; par</span>
<span class="sd">    par(toy_1_1_0_0_0=2.0,</span>
<span class="sd">        toy_3_1_0_0_0=5.0,</span>
<span class="sd">        toy_7_1_0_0_0=4.0)</span>

<span class="sd">    By default, `toy` is used as a prefix string.  Using this prefix string, one can</span>
<span class="sd">    change the toy-value pairs via attribute access:</span>

<span class="sd">    &gt;&gt;&gt; par.toy_1_1_0_0_0</span>
<span class="sd">    2.0</span>
<span class="sd">    &gt;&gt;&gt; del par.toy_1_1_0_0_0</span>
<span class="sd">    &gt;&gt;&gt; par.toy_2_1_0_0_0 = 2.</span>
<span class="sd">    &gt;&gt;&gt; par</span>
<span class="sd">    par(toy_2_1_0_0_0=2.0,</span>
<span class="sd">        toy_3_1_0_0_0=5.0,</span>
<span class="sd">        toy_7_1_0_0_0=4.0)</span>

<span class="sd">    For attribute access, zero hours, minutes, or seconds can be left out:</span>

<span class="sd">    &gt;&gt;&gt; par.toy_2_1</span>
<span class="sd">    2.0</span>

<span class="sd">    When using functions |getattr| and |delattr|, one can also omit the &quot;toy&quot; prefix:</span>

<span class="sd">    &gt;&gt;&gt; getattr(par, &quot;2_1&quot;)</span>
<span class="sd">    2.0</span>
<span class="sd">    &gt;&gt;&gt; delattr(par, &quot;2_1&quot;)</span>
<span class="sd">    &gt;&gt;&gt; getattr(par, &quot;2_1&quot;)</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    AttributeError: Seasonal parameter `par` of element `?` has neither a normal \</span>
<span class="sd">attribute nor does it handle a &quot;time of year&quot; named `2_1`.</span>
<span class="sd">    &gt;&gt;&gt; delattr(par, &quot;2_1&quot;)</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    AttributeError: Seasonal parameter `par` of element `?` has neither a normal \</span>
<span class="sd">attribute nor does it handle a &quot;time of year&quot; named `2_1`.</span>

<span class="sd">    Applying the |len| operator on |SeasonalParameter| objects returns the number of</span>
<span class="sd">    toy-value pairs.</span>

<span class="sd">    &gt;&gt;&gt; len(par)</span>
<span class="sd">    2</span>

<span class="sd">    New values are checked to be compatible with the predefined shape:</span>

<span class="sd">    &gt;&gt;&gt; par.toy_1_1_0_0_0 = [1., 2.]   # doctest: +ELLIPSIS</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    TypeError: While trying to add a new or change an existing toy-value pair for the \</span>
<span class="sd">seasonal parameter `par` of element `?`, the following error occurred: float() \</span>
<span class="sd">argument must be a string or a... number...</span>
<span class="sd">    &gt;&gt;&gt; par = Par(None)</span>
<span class="sd">    &gt;&gt;&gt; par.NDIM = 2</span>
<span class="sd">    &gt;&gt;&gt; par.shape = (None, 3)</span>
<span class="sd">    &gt;&gt;&gt; par.toy_1_1_0_0_0 = [1., 2.]</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ValueError: While trying to add a new or change an existing toy-value pair for \</span>
<span class="sd">the seasonal parameter `par` of element `?`, the following error occurred: could not \</span>
<span class="sd">broadcast input array from shape (2,) into shape (3,)</span>

<span class="sd">    If you do not require seasonally varying parameter values in a specific situation,</span>
<span class="sd">    you can pass a single positional argument:</span>

<span class="sd">    &gt;&gt;&gt; par(5.0)</span>
<span class="sd">    &gt;&gt;&gt; par</span>
<span class="sd">    par([5.0, 5.0, 5.0])</span>

<span class="sd">    Note that class |SeasonalParameter| associates the given value(s) to the &quot;first&quot;</span>
<span class="sd">    time of the year internally:</span>

<span class="sd">    &gt;&gt;&gt; par.toys</span>
<span class="sd">    (TOY(&quot;1_1_0_0_0&quot;),)</span>

<span class="sd">    Incompatible positional arguments result in errors like the following:</span>

<span class="sd">    &gt;&gt;&gt; par(1.0, 2.0)</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ValueError: While trying to set the value(s) of variable `par`, the following \</span>
<span class="sd">error occurred: While trying to convert the value(s) `[1. 2.]` to a numpy ndarray \</span>
<span class="sd">with shape `(366, 3)` and type `float`, the following error occurred: could not \</span>
<span class="sd">broadcast input array from shape (2,) into shape (366,3)</span>

<span class="sd">    .. testsetup::</span>

<span class="sd">        &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">TYPE</span> <span class="o">=</span> <span class="nb">float</span>

    <span class="n">strict_valuehandling</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">_toy2values_unprotected</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">timetools</span><span class="o">.</span><span class="n">TOY</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">NDArrayFloat</span><span class="p">]]]</span>
    <span class="n">_trimmed_insufficiently</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">_trimming_disabled</span><span class="p">:</span> <span class="nb">bool</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subvars</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">subvars</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_toy2values_unprotected</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_trimming_disabled</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_trimmed_insufficiently</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_toy2values_protected</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">timetools</span><span class="o">.</span><span class="n">TOY</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">NDArrayFloat</span><span class="p">]]]:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trimmed_insufficiently</span> <span class="ow">and</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">warntrim</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;The &quot;background values&quot; of parameter &#39;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">elementphrase</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2"> have been trimmed but not its &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;original time of year-specific values.  Using the latter without &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;modification might result in inconsistencies.&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toy2values_unprotected</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDIM</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_trimming_disabled</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_trimming_disabled</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_toy2values_unprotected</span> <span class="o">=</span> <span class="p">[(</span><span class="n">timetools</span><span class="o">.</span><span class="n">TOY</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trim</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_toy2values_unprotected</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">exc</span>
            <span class="k">for</span> <span class="n">toystr</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_add_toyvaluepair</span><span class="p">(</span><span class="n">toystr</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
                    <span class="n">objecttools</span><span class="o">.</span><span class="n">augment_excmessage</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;While trying to define the seasonal parameter value &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">elementphrase</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2"> for time of year `</span><span class="si">{</span><span class="n">toystr</span><span class="si">}</span><span class="s2">`&quot;</span>
                    <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_add_toyvaluepair</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">NDArrayFloat</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDIM</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">value</span><span class="p">)</span>
        <span class="n">toy_new</span> <span class="o">=</span> <span class="n">timetools</span><span class="o">.</span><span class="n">TOY</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">toy2values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toy2values_unprotected</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">toy2values</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">toy2values</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">toy_new</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
        <span class="n">secs_new</span> <span class="o">=</span> <span class="n">toy_new</span><span class="o">.</span><span class="n">seconds_passed</span>
        <span class="k">if</span> <span class="n">secs_new</span> <span class="o">&gt;</span> <span class="n">toy2values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">seconds_passed</span><span class="p">:</span>
            <span class="n">toy2values</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">toy_new</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">toy_old</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">toy2values</span><span class="p">[:]):</span>
                <span class="n">secs_old</span> <span class="o">=</span> <span class="n">toy_old</span><span class="o">.</span><span class="n">seconds_passed</span>
                <span class="k">if</span> <span class="n">secs_new</span> <span class="o">==</span> <span class="n">secs_old</span><span class="p">:</span>
                    <span class="n">toy2values</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">toy_new</span><span class="p">,</span> <span class="n">value</span>
                    <span class="k">break</span>
                <span class="k">if</span> <span class="n">secs_new</span> <span class="o">&lt;</span> <span class="n">secs_old</span><span class="p">:</span>
                    <span class="n">toy2values</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">toy_new</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
                    <span class="k">break</span>

<div class="viewcode-block" id="SeasonalParameter.refresh">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.SeasonalParameter.refresh">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">refresh</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the actual simulation values based on the toy-value pairs.</span>

<span class="sd">        Usually, one does not need to call refresh explicitly.  The &quot;magic&quot; methods</span>
<span class="sd">        `__call__`, `__setattr__`, and `__delattr__` invoke it automatically, when</span>
<span class="sd">        required.</span>

<span class="sd">        Method |SeasonalParameter.refresh| calculates only those time variable</span>
<span class="sd">        parameter values required for the defined initialisation period.  We start with</span>
<span class="sd">        an initialisation period covering a full year, making a complete calculation</span>
<span class="sd">        necessary:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-01&quot;, &quot;2001-01-01&quot;, &quot;1d&quot;</span>

<span class="sd">        Instantiate a 1-dimensional |SeasonalParameter| object:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.core.parametertools import SeasonalParameter</span>
<span class="sd">        &gt;&gt;&gt; class Par(SeasonalParameter):</span>
<span class="sd">        ...     NDIM = 1</span>
<span class="sd">        ...     TYPE = float</span>
<span class="sd">        ...     TIME = None</span>
<span class="sd">        &gt;&gt;&gt; par = Par(None)</span>
<span class="sd">        &gt;&gt;&gt; par.shape = (None,)</span>

<span class="sd">        When a |SeasonalParameter| object does not contain any toy-value pairs yet, the</span>
<span class="sd">        method |SeasonalParameter.refresh| sets all actual simulation values to zero:</span>

<span class="sd">        &gt;&gt;&gt; par.values = 1.0</span>
<span class="sd">        &gt;&gt;&gt; par.refresh()</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(par.values[0])</span>
<span class="sd">        0.0</span>

<span class="sd">        When there is only one toy-value pair, its values are relevant for all actual</span>
<span class="sd">        simulation values:</span>

<span class="sd">        &gt;&gt;&gt; par.toy_1 = 2.0  # calls refresh automatically</span>
<span class="sd">        &gt;&gt;&gt; round_(par.values[0])</span>
<span class="sd">        2.0</span>

<span class="sd">        Method |SeasonalParameter.refresh| performs a linear interpolation for the</span>
<span class="sd">        central time points of each simulation time step.  Hence, in the following</span>
<span class="sd">        example, the original values of the toy-value pairs do not show up:</span>

<span class="sd">        &gt;&gt;&gt; par.toy_12_31 = 4.0</span>
<span class="sd">        &gt;&gt;&gt; round_(par.values[0])</span>
<span class="sd">        2.00274</span>
<span class="sd">        &gt;&gt;&gt; round_(par.values[-2])</span>
<span class="sd">        3.99726</span>
<span class="sd">        &gt;&gt;&gt; round_(par.values[-1])</span>
<span class="sd">        3.0</span>

<span class="sd">        If one wants to preserve the original values in this example, one must set the</span>
<span class="sd">        corresponding toy instances in the middle of some simulation step intervals:</span>

<span class="sd">        &gt;&gt;&gt; del par.toy_1</span>
<span class="sd">        &gt;&gt;&gt; del par.toy_12_31</span>
<span class="sd">        &gt;&gt;&gt; par.toy_1_1_12 = 2</span>
<span class="sd">        &gt;&gt;&gt; par.toy_12_31_12 = 4.0</span>
<span class="sd">        &gt;&gt;&gt; round_(par.values[0])</span>
<span class="sd">        2.0</span>
<span class="sd">        &gt;&gt;&gt; round_(par.values[1])</span>
<span class="sd">        2.005479</span>
<span class="sd">        &gt;&gt;&gt; round_(par.values[-2])</span>
<span class="sd">        3.994521</span>
<span class="sd">        &gt;&gt;&gt; round_(par.values[-1])</span>
<span class="sd">        4.0</span>

<span class="sd">        For short initialisation periods, method |SeasonalParameter.refresh| performs</span>
<span class="sd">        only the required interpolations for efficiency:</span>

<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-02&quot;, &quot;2000-01-05&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; Par.NDIM = 2</span>
<span class="sd">        &gt;&gt;&gt; par = Par(None)</span>
<span class="sd">        &gt;&gt;&gt; par.shape = (None, 3)</span>
<span class="sd">        &gt;&gt;&gt; par.toy_1_2_12 = 2.0</span>
<span class="sd">        &gt;&gt;&gt; par.toy_1_6_12 = 0.0, 2.0, 4.0</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import print_matrix</span>
<span class="sd">        &gt;&gt;&gt; print_matrix(par.values[:6])</span>
<span class="sd">        | nan, nan, nan |</span>
<span class="sd">        | 2.0, 2.0, 2.0 |</span>
<span class="sd">        | 1.5, 2.0, 2.5 |</span>
<span class="sd">        | 1.0, 2.0, 3.0 |</span>
<span class="sd">        | nan, nan, nan |</span>
<span class="sd">        | nan, nan, nan |</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">toy2values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toy2values_unprotected</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">toy2values</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_value</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_timefactor</span><span class="p">(</span><span class="n">toy2values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">centred</span> <span class="o">=</span> <span class="n">timetools</span><span class="o">.</span><span class="n">TOY</span><span class="o">.</span><span class="n">centred_timegrid</span><span class="p">()</span>
            <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_value</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">rel</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">centred</span><span class="p">)):</span>
                <span class="n">values</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">date</span><span class="p">)</span> <span class="k">if</span> <span class="n">rel</span> <span class="k">else</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span>
            <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_timefactor</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_value</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trim</span><span class="p">()</span></div>


<div class="viewcode-block" id="SeasonalParameter.interp">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.SeasonalParameter.interp">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">interp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">date</span><span class="p">:</span> <span class="n">timetools</span><span class="o">.</span><span class="n">Date</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform a linear value interpolation for the given `date` and return the</span>
<span class="sd">        result.</span>

<span class="sd">        Instantiate a 1-dimensional |SeasonalParameter| object:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-01&quot;, &quot;2001-01-01&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.core.parametertools import SeasonalParameter</span>
<span class="sd">        &gt;&gt;&gt; class Par(SeasonalParameter):</span>
<span class="sd">        ...     NDIM = 1</span>
<span class="sd">        ...     TYPE = float</span>
<span class="sd">        ...     TIME = None</span>
<span class="sd">        &gt;&gt;&gt; par = Par(None)</span>
<span class="sd">        &gt;&gt;&gt; par.shape = (None,)</span>

<span class="sd">        Define three toy-value pairs:</span>

<span class="sd">        &gt;&gt;&gt; par(_1=2.0, _2=5.0, _12_31=4.0)</span>

<span class="sd">        Passing a |Date| object matching a |TOY| object exactly returns the</span>
<span class="sd">        corresponding |float| value:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import Date</span>
<span class="sd">        &gt;&gt;&gt; par.interp(Date(&quot;2000.01.01&quot;))</span>
<span class="sd">        2.0</span>
<span class="sd">        &gt;&gt;&gt; par.interp(Date(&quot;2000.02.01&quot;))</span>
<span class="sd">        5.0</span>
<span class="sd">        &gt;&gt;&gt; par.interp(Date(&quot;2000.12.31&quot;))</span>
<span class="sd">        4.0</span>

<span class="sd">        For all intermediate points, |SeasonalParameter.interp| performs a linear</span>
<span class="sd">        interpolation:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(par.interp(Date(&quot;2000.01.02&quot;)))</span>
<span class="sd">        2.096774</span>
<span class="sd">        &gt;&gt;&gt; round_(par.interp(Date(&quot;2000.01.31&quot;)))</span>
<span class="sd">        4.903226</span>
<span class="sd">        &gt;&gt;&gt; round_(par.interp(Date(&quot;2000.02.02&quot;)))</span>
<span class="sd">        4.997006</span>
<span class="sd">        &gt;&gt;&gt; round_(par.interp(Date(&quot;2000.12.30&quot;)))</span>
<span class="sd">        4.002994</span>

<span class="sd">        Linear interpolation is also allowed between the first and the last pair when</span>
<span class="sd">        they do not capture the endpoints of the year:</span>

<span class="sd">        &gt;&gt;&gt; par(_1_2=2.0, _12_30=4.0)</span>
<span class="sd">        &gt;&gt;&gt; round_(par.interp(Date(&quot;2000.12.29&quot;)))</span>
<span class="sd">        3.99449</span>
<span class="sd">        &gt;&gt;&gt; par.interp(Date(&quot;2000.12.30&quot;))</span>
<span class="sd">        4.0</span>
<span class="sd">        &gt;&gt;&gt; round_(par.interp(Date(&quot;2000.12.31&quot;)))</span>
<span class="sd">        3.333333</span>
<span class="sd">        &gt;&gt;&gt; round_(par.interp(Date(&quot;2000.01.01&quot;)))</span>
<span class="sd">        2.666667</span>
<span class="sd">        &gt;&gt;&gt; par.interp(Date(&quot;2000.01.02&quot;))</span>
<span class="sd">        2.0</span>
<span class="sd">        &gt;&gt;&gt; round_(par.interp(Date(&quot;2000.01.03&quot;)))</span>
<span class="sd">        2.00551</span>

<span class="sd">        The following example briefly shows interpolation performed for a 2-dimensional</span>
<span class="sd">        parameter:</span>

<span class="sd">        &gt;&gt;&gt; Par.NDIM = 2</span>
<span class="sd">        &gt;&gt;&gt; par = Par(None)</span>
<span class="sd">        &gt;&gt;&gt; par.shape = (None, 2)</span>
<span class="sd">        &gt;&gt;&gt; par(_1_1=[1., 2.], _1_3=[-3, 0.])</span>
<span class="sd">        &gt;&gt;&gt; result = par.interp(Date(&quot;2000.01.02&quot;))</span>
<span class="sd">        &gt;&gt;&gt; round_(result[0])</span>
<span class="sd">        -1.0</span>
<span class="sd">        &gt;&gt;&gt; round_(result[1])</span>
<span class="sd">        1.0</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">xnew</span> <span class="o">=</span> <span class="n">timetools</span><span class="o">.</span><span class="n">TOY</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>
        <span class="n">xys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">xys</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">x1</span> <span class="o">&gt;</span> <span class="n">xnew</span><span class="p">:</span>
                <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">xys</span><span class="p">[</span><span class="n">idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">xys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">xys</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">y0</span> <span class="o">+</span> <span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">y0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">xnew</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">toys</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">timetools</span><span class="o">.</span><span class="n">TOY</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A sorted |tuple| of all contained |TOY| objects.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">toy</span> <span class="k">for</span> <span class="n">toy</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toy2values_unprotected</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A tuple containing the actual lengths of all dimensions.</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">            &gt;&gt;&gt; del pub.options.simulationstep</span>

<span class="sd">        Setting the shape of |SeasonalParameter| objects differs from setting the shape</span>
<span class="sd">        of other |Variable| subclasses, due to handling time on the first axis.  The</span>
<span class="sd">        simulation step size determines the length of this axis.  Hence, trying to set</span>
<span class="sd">        the shape before the simulation step size is known does not work:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.core.parametertools import SeasonalParameter</span>
<span class="sd">        &gt;&gt;&gt; class Par(SeasonalParameter):</span>
<span class="sd">        ...     NDIM = 1</span>
<span class="sd">        ...     TYPE = float</span>
<span class="sd">        ...     TIME = None</span>
<span class="sd">        &gt;&gt;&gt; par = Par(None)</span>
<span class="sd">        &gt;&gt;&gt; par.shape = (None,)</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        RuntimeError: It is not possible the set the shape of the seasonal parameter \</span>
<span class="sd">`par` of element `?` at the moment.  You need to define the simulation step size \</span>
<span class="sd">first.  However, in complete HydPy projects this stepsize is indirectly defined via \</span>
<span class="sd">`pub.timegrids.stepsize` automatically.</span>

<span class="sd">        After preparing the simulation step size, you can pass a tuple with a single</span>
<span class="sd">        entry of any value to define the shape of the defined 1-dimensional test class.</span>
<span class="sd">        Property |SeasonalParameter.shape| replaces this arbitrary value by the number</span>
<span class="sd">        of simulation steps fitting into a leap year:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.options.simulationstep = &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; par.shape = (123,)</span>
<span class="sd">        &gt;&gt;&gt; par.shape</span>
<span class="sd">        (366,)</span>

<span class="sd">        Assigning a single, arbitrary value also works well:</span>

<span class="sd">        &gt;&gt;&gt; par.shape = None</span>
<span class="sd">        &gt;&gt;&gt; par.shape</span>
<span class="sd">        (366,)</span>

<span class="sd">        For higher-dimensional parameters, property |SeasonalParameter.shape| replaces</span>
<span class="sd">        the first entry of the assigned iterable, accordingly:</span>

<span class="sd">        &gt;&gt;&gt; Par.NDIM = 2</span>
<span class="sd">        &gt;&gt;&gt; par.shape = (None, 3)</span>
<span class="sd">        &gt;&gt;&gt; par.shape</span>
<span class="sd">        (366, 3)</span>

<span class="sd">        For simulation steps not cleanly fitting into a leap year, the ceil-operation</span>
<span class="sd">        determines the number of entries:</span>

<span class="sd">        &gt;&gt;&gt; pub.options.simulationstep = &quot;100d&quot;</span>
<span class="sd">        &gt;&gt;&gt; par.shape = (None, 3)</span>
<span class="sd">        &gt;&gt;&gt; par.shape</span>
<span class="sd">        (4, 3)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_get_shape</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_set_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">shape_</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">shape_</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">simulationstep</span> <span class="o">=</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">simulationstep</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">simulationstep</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;It is not possible the set the shape of the seasonal parameter &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">elementphrase</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2"> at the moment.  You need to &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;define the simulation step size first.  However, in complete HydPy &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;projects this stepsize is indirectly defined via &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;`pub.timegrids.stepsize` automatically.&quot;</span>
            <span class="p">)</span>
        <span class="n">shape_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">timetools</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="s2">&quot;366d&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="n">simulationstep</span><span class="p">))</span>
        <span class="n">shape_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">shape_</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">10</span><span class="p">)))</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_set_shape</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">shape_</span><span class="p">))</span>

    <span class="n">shape</span> <span class="o">=</span> <span class="n">propertytools</span><span class="o">.</span><span class="n">Property</span><span class="p">(</span><span class="n">fget</span><span class="o">=</span><span class="n">_get_shape</span><span class="p">,</span> <span class="n">fset</span><span class="o">=</span><span class="n">_set_shape</span><span class="p">)</span>

<div class="viewcode-block" id="SeasonalParameter.trim">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.SeasonalParameter.trim">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">trim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extend the usual trim logic with a warning mechanism to account for that</span>
<span class="sd">        trimming only affects &quot;background values&quot; and not the &quot;visible&quot; time of year /</span>
<span class="sd">        value pairs.</span>

<span class="sd">        The usual trimming process affects the simulation-relevant &quot;background values&quot;,</span>
<span class="sd">        not the &quot;visible&quot; original values supplied by the user.  Hence,</span>
<span class="sd">        |SeasonalParameter| tries to keep track of recent trimmings to warn if users</span>
<span class="sd">        try to used the unmodified &quot;visible&quot; values later:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub, round_</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-01&quot;, &quot;2000-01-04&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.sw1d import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; upperlowwaterthreshold.shape = 1</span>
<span class="sd">        &gt;&gt;&gt; upperlowwaterthreshold.values[:3] = 1.0, 2.0, 3.0</span>
<span class="sd">        &gt;&gt;&gt; bottomlowwaterthreshold(2.0)</span>
<span class="sd">        &gt;&gt;&gt; round_(bottomlowwaterthreshold.values[:3])</span>
<span class="sd">        1.0, 2.0, 2.0</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.core.testtools import warn_later</span>
<span class="sd">        &gt;&gt;&gt; with pub.options.warntrim(True), warn_later():</span>
<span class="sd">        ...     bottomlowwaterthreshold</span>
<span class="sd">        bottomlowwaterthreshold(2.0)</span>
<span class="sd">        UserWarning: The &quot;background values&quot; of parameter `bottomlowwaterthreshold` \</span>
<span class="sd">of element `?` have been trimmed but not its original time of year-specific values.  \</span>
<span class="sd">Using the latter without modification might result in inconsistencies.</span>

<span class="sd">        In such cases, modify the values of the affected parameter or its boundaries</span>
<span class="sd">        and call |SeasonalParameter.refresh| manually.  If successful, the warning</span>
<span class="sd">        disappears:</span>

<span class="sd">        &gt;&gt;&gt; upperlowwaterthreshold.values[0] = 2.0</span>
<span class="sd">        &gt;&gt;&gt; bottomlowwaterthreshold.refresh()</span>
<span class="sd">        &gt;&gt;&gt; with pub.options.warntrim(True):</span>
<span class="sd">        ...     bottomlowwaterthreshold</span>
<span class="sd">        bottomlowwaterthreshold(2.0)</span>

<span class="sd">        The explained mechanism equivalently works when defining seasonally varying</span>
<span class="sd">        parameter values and trying to access the unmodified &quot;visible&quot; values in other</span>
<span class="sd">        ways:</span>

<span class="sd">        &gt;&gt;&gt; bottomlowwaterthreshold(_1_1_12=3.0, _1_3_12=1.0)</span>
<span class="sd">        &gt;&gt;&gt; round_(bottomlowwaterthreshold.values[:3])</span>
<span class="sd">        2.0, 2.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; with pub.options.warntrim(True), warn_later():</span>
<span class="sd">        ...     round_(bottomlowwaterthreshold.toy_1_1_12)  # doctest: +ELLIPSIS</span>
<span class="sd">        3.0</span>
<span class="sd">        UserWarning: The &quot;background values&quot;...result in inconsistencies.</span>
<span class="sd">        &gt;&gt;&gt; with pub.options.warntrim(True), warn_later():</span>
<span class="sd">        ...     tuple(bottomlowwaterthreshold)  # doctest: +ELLIPSIS</span>
<span class="sd">        ((TOY(&quot;1_1_12_0_0&quot;), 3.0), (TOY(&quot;1_3_12_0_0&quot;), 1.0))</span>
<span class="sd">        UserWarning: The &quot;background values&quot;...result in inconsistencies.</span>
<span class="sd">        &gt;&gt;&gt; with pub.options.warntrim(True), warn_later():</span>
<span class="sd">        ...     len(bottomlowwaterthreshold)  # doctest: +ELLIPSIS</span>
<span class="sd">        2</span>
<span class="sd">        UserWarning: The &quot;background values&quot;...result in inconsistencies.</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trimming_disabled</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_trimmed_insufficiently</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">trim</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trimmed_insufficiently</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">timetools</span><span class="o">.</span><span class="n">TOY</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_toy2values_protected</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">NDArrayFloat</span><span class="p">]:</span>
        <span class="n">selected</span> <span class="o">=</span> <span class="n">timetools</span><span class="o">.</span><span class="n">TOY</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">available</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toy2values_protected</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">selected</span> <span class="o">==</span> <span class="n">available</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">value</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Seasonal parameter </span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">elementphrase</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2"> has neither a &quot;</span>
            <span class="sa">f</span><span class="s1">&#39;normal attribute nor does it handle a &quot;time of year&quot; named `</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">`.&#39;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">NDArrayFloat</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;toy_&quot;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_add_toyvaluepair</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
                <span class="n">objecttools</span><span class="o">.</span><span class="n">augment_excmessage</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;While trying to add a new or change an existing toy-value pair &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;for the seasonal parameter </span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">elementphrase</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__delattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__delattr__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">selected</span> <span class="o">=</span> <span class="n">timetools</span><span class="o">.</span><span class="n">TOY</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">available</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_toy2values_unprotected</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">selected</span> <span class="o">==</span> <span class="n">available</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Seasonal parameter </span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">elementphrase</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2"> has &quot;</span>
                    <span class="sa">f</span><span class="s1">&#39;neither a normal attribute nor does it handle a &quot;time of year&quot; &#39;</span>
                    <span class="sa">f</span><span class="s2">&quot;named `</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">`.&quot;</span>
                <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="kc">None</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toy2values_unprotected</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">_assignrepr</span><span class="p">(</span><span class="n">value_</span><span class="p">,</span> <span class="n">prefix_</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDIM</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">assignrepr_value</span><span class="p">(</span><span class="n">value_</span><span class="p">,</span> <span class="n">prefix_</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">assignrepr_list</span><span class="p">(</span><span class="n">value_</span><span class="p">,</span> <span class="n">prefix_</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">79</span><span class="p">)</span>

        <span class="n">toy2values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toy2values_protected</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">toy2values</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">()&quot;</span>
        <span class="n">toy0</span> <span class="o">=</span> <span class="n">timetools</span><span class="o">.</span><span class="n">TOY0</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">toy0</span> <span class="o">==</span> <span class="n">toy2values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">_assignrepr</span><span class="p">(</span><span class="n">toy2values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">(&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">)&#39;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">blanks</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">toy</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_assignrepr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="n">toy</span><span class="si">}</span><span class="s2">=&quot;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_assignrepr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}{</span><span class="n">toy</span><span class="si">}</span><span class="s2">=&quot;</span><span class="p">))</span>
        <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="s2">&quot;)&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_toy2values_protected</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-01&quot;, &quot;2001-01-01&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.core.parametertools import SeasonalParameter</span>
<span class="sd">        &gt;&gt;&gt; class Par(SeasonalParameter):</span>
<span class="sd">        ...     NDIM = 1</span>
<span class="sd">        ...     TIME = None</span>
<span class="sd">        &gt;&gt;&gt; par = Par(None)</span>
<span class="sd">        &gt;&gt;&gt; par.NDIM = 1</span>
<span class="sd">        &gt;&gt;&gt; par.shape = (None,)</span>
<span class="sd">        &gt;&gt;&gt; par(_1=2., _7_1=4., _3_1_0_0_0=5.)</span>
<span class="sd">        &gt;&gt;&gt; sorted(set(dir(par)) - set(object.__dir__(par)))</span>
<span class="sd">        [&#39;toy_1_1_0_0_0&#39;, &#39;toy_3_1_0_0_0&#39;, &#39;toy_7_1_0_0_0&#39;]</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__dir__</span><span class="p">())</span> <span class="o">+</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">toy</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">toy</span><span class="p">,</span> <span class="n">dummy</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span></div>



<div class="viewcode-block" id="KeywordParameter1D">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.KeywordParameter1D">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">KeywordParameter1D</span><span class="p">(</span><span class="n">_MixinModifiableParameter</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for 1-dimensional model parameters with values depending on one</span>
<span class="sd">    factor.</span>

<span class="sd">    When subclassing from |KeywordParameter1D|, one needs to define the class attribute</span>
<span class="sd">    `entrynames`.  A typical use case is that `entrynames` defines seasons like the</span>
<span class="sd">    months or, as in our example, half-years:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy.core.parametertools import KeywordParameter1D</span>
<span class="sd">    &gt;&gt;&gt; class IsHot(KeywordParameter1D):</span>
<span class="sd">    ...     TYPE = bool</span>
<span class="sd">    ...     TIME = None</span>
<span class="sd">    ...     entrynames = (&quot;winter&quot;, &quot;summer&quot;)</span>

<span class="sd">    Usually, |KeywordParameter1D| objects prepare their shape automatically.  However,</span>
<span class="sd">    to simplify this test case, we define it manually:</span>

<span class="sd">    &gt;&gt;&gt; ishot = IsHot(None)</span>
<span class="sd">    &gt;&gt;&gt; ishot.shape = 2</span>

<span class="sd">    You can pass all parameter values both via positional or keyword arguments:</span>

<span class="sd">    &gt;&gt;&gt; ishot(True)</span>
<span class="sd">    &gt;&gt;&gt; ishot</span>
<span class="sd">    ishot(True)</span>

<span class="sd">    &gt;&gt;&gt; ishot(False, True)</span>
<span class="sd">    &gt;&gt;&gt; ishot</span>
<span class="sd">    ishot(winter=False, summer=True)</span>

<span class="sd">    &gt;&gt;&gt; from hydpy import print_vector</span>
<span class="sd">    &gt;&gt;&gt; ishot(winter=True, summer=False)</span>
<span class="sd">    &gt;&gt;&gt; ishot</span>
<span class="sd">    ishot(winter=True, summer=False)</span>
<span class="sd">    &gt;&gt;&gt; print_vector(ishot.values)</span>
<span class="sd">    True, False</span>

<span class="sd">    We check the given keyword arguments for correctness and completeness:</span>

<span class="sd">    &gt;&gt;&gt; ishot(winter=True)</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ValueError: When setting parameter `ishot` of element `?` via keyword arguments, \</span>
<span class="sd">each string defined in `entrynames` must be used as a keyword, but the following \</span>
<span class="sd">keywords are not: `summer`.</span>

<span class="sd">    &gt;&gt;&gt; ishot(winter=True, summer=False, spring=True, autumn=False)</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ValueError: When setting parameter `ishot` of element `?` via keyword arguments, \</span>
<span class="sd">each keyword must be defined in `entrynames`, but the following keywords are not: \</span>
<span class="sd">`spring and autumn`.</span>

<span class="sd">    Class |KeywordParameter1D| implements attribute access, including specialised error</span>
<span class="sd">    messages:</span>

<span class="sd">    &gt;&gt;&gt; ishot.winter, ishot.summer = ishot.summer, ishot.winter</span>
<span class="sd">    &gt;&gt;&gt; ishot</span>
<span class="sd">    ishot(winter=False, summer=True)</span>

<span class="sd">    &gt;&gt;&gt; ishot.spring</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    AttributeError: Parameter `ishot` of element `?` does not handle an attribute \</span>
<span class="sd">named `spring`.</span>

<span class="sd">    &gt;&gt;&gt; ishot.shape = 1</span>
<span class="sd">    &gt;&gt;&gt; ishot.summer</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    IndexError: While trying to retrieve a value from parameter `ishot` of element \</span>
<span class="sd">`?` via the attribute `summer`, the following error occurred: index 1 is out of \</span>
<span class="sd">bounds for axis 0 with size 1</span>

<span class="sd">    &gt;&gt;&gt; ishot.summer = True</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    IndexError: While trying to assign a new value to parameter `ishot` of element \</span>
<span class="sd">`?` via attribute `summer`, the following error occurred: index 1 is out of bounds \</span>
<span class="sd">for axis 0 with size 1</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">NDIM</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">entrynames</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
    <span class="n">entrymin</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">strict_valuehandling</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subvars</span><span class="p">:</span> <span class="n">SubParameters</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">subvars</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entrynames</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">entrynames</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entrymin</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">entrymin</span>

<div class="viewcode-block" id="KeywordParameter1D.modify_entries">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.KeywordParameter1D.modify_entries">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">modify_entries</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">constants</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Constants</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Modify the relevant entry names temporarily.</span>

<span class="sd">        The entry names for defining properties like land-use types are fixed for</span>
<span class="sd">        typical &quot;main models&quot; like |hland|.  However, some submodels must take over the</span>
<span class="sd">        entry names defined by their current main model, which are only known at</span>
<span class="sd">        runtime.  For example, consider the following simple `LAI` parameter that</span>
<span class="sd">        handles predefined land use type names as a class attribute:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.core.parametertools import KeywordParameter1D</span>
<span class="sd">        &gt;&gt;&gt; class LAI(KeywordParameter1D):</span>
<span class="sd">        ...     TYPE = float</span>
<span class="sd">        ...     TIME = None</span>
<span class="sd">        ...     entrynames = (&quot;field&quot;, &quot;forest&quot;)</span>
<span class="sd">        &gt;&gt;&gt; lai1 = LAI(None)</span>
<span class="sd">        &gt;&gt;&gt; lai1.shape = 2</span>
<span class="sd">        &gt;&gt;&gt; lai1(field=1.0, forest=2.0)</span>
<span class="sd">        &gt;&gt;&gt; lai1</span>
<span class="sd">        lai(field=1.0, forest=2.0)</span>

<span class="sd">        We can use |KeywordParameter1D.modify_entries| to temporarily change these</span>
<span class="sd">        names:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.core.parametertools import Constants</span>
<span class="sd">        &gt;&gt;&gt; constants = Constants(GRASS=2, SOIL=1, TREES=3)</span>
<span class="sd">        &gt;&gt;&gt; with LAI.modify_entries(constants):</span>
<span class="sd">        ...     lai2 = LAI(None)</span>
<span class="sd">        ...     lai2.shape = 3</span>
<span class="sd">        ...     lai2(soil=0.0, grass=1.0, trees=2.0)</span>
<span class="sd">        ...     lai2</span>
<span class="sd">        lai(soil=0.0, grass=1.0, trees=2.0)</span>

<span class="sd">        During initialisation, the names and the lowest value of the given constants</span>
<span class="sd">        become instance attributes, so the parameter instance does not forget them</span>
<span class="sd">        after leaving the `with` block (when the class attribute is reset to its</span>
<span class="sd">        previous value):</span>

<span class="sd">        &gt;&gt;&gt; lai1.entrynames</span>
<span class="sd">        (&#39;field&#39;, &#39;forest&#39;)</span>
<span class="sd">        &gt;&gt;&gt; lai2.entrynames</span>
<span class="sd">        (&#39;soil&#39;, &#39;grass&#39;, &#39;trees&#39;)</span>
<span class="sd">        &gt;&gt;&gt; LAI.entrynames</span>
<span class="sd">        (&#39;field&#39;, &#39;forest&#39;)</span>

<span class="sd">        &gt;&gt;&gt; lai1.entrymin</span>
<span class="sd">        0</span>
<span class="sd">        &gt;&gt;&gt; lai2.entrymin</span>
<span class="sd">        1</span>
<span class="sd">        &gt;&gt;&gt; LAI.entrymin</span>
<span class="sd">        0</span>

<span class="sd">        Passing |None| does not overwrite the default or the previously set references:</span>

<span class="sd">        &gt;&gt;&gt; LAI.entrymin = 3</span>
<span class="sd">        &gt;&gt;&gt; with LAI.modify_entries(None):</span>
<span class="sd">        ...     LAI.entrynames</span>
<span class="sd">        ...     LAI.entrymin</span>
<span class="sd">        ...     lai3 = LAI(None)</span>
<span class="sd">        ...     lai3.shape = 2</span>
<span class="sd">        ...     lai3(field=2.0, forest=1.0)</span>
<span class="sd">        ...     lai3</span>
<span class="sd">        (&#39;field&#39;, &#39;forest&#39;)</span>
<span class="sd">        3</span>
<span class="sd">        lai(field=2.0, forest=1.0)</span>
<span class="sd">        &gt;&gt;&gt; LAI.entrynames</span>
<span class="sd">        (&#39;field&#39;, &#39;forest&#39;)</span>
<span class="sd">        &gt;&gt;&gt; LAI.entrymin</span>
<span class="sd">        3</span>
<span class="sd">        &gt;&gt;&gt; lai3</span>
<span class="sd">        lai(field=2.0, forest=1.0)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">constants</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">yield</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">get</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">get</span>
            <span class="n">old_names</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="s2">&quot;entrynames&quot;</span><span class="p">)</span>
            <span class="n">old_min</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="s2">&quot;entrymin&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">entrynames</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">sortednames</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">entrymin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                <span class="k">yield</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">_reset_after_modification</span><span class="p">(</span><span class="s2">&quot;entrynames&quot;</span><span class="p">,</span> <span class="n">old_names</span><span class="p">)</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">_reset_after_modification</span><span class="p">(</span><span class="s2">&quot;entrymin&quot;</span><span class="p">,</span> <span class="n">old_min</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">__hydpy__connect_variable2subgroup__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__hydpy__connect_variable2subgroup__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">entrynames</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_entrymin&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">entrymin</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">NotImplementedError</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">entrynames</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_timefactor</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="n">err</span> <span class="o">=</span> <span class="p">(</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entrynames</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;When setting parameter </span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">elementphrase</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2"> &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;via keyword arguments, each string defined in `entrynames` &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;must be used as a keyword, but the following keywords are &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;not: `</span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">enumeration</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="si">}</span><span class="s2">`.&quot;</span>
                    <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="kc">None</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">entrynames</span><span class="p">):</span>
                <span class="n">err</span> <span class="o">=</span> <span class="p">(</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entrynames</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;When setting parameter </span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">elementphrase</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2"> via &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;keyword arguments, each keyword must be defined in &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;`entrynames`, but the following keywords are not: &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">enumeration</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="si">}</span><span class="s2">`.&quot;</span>
                <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entrynames</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">TYPE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">entrynames</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">key</span><span class="p">)])</span>
            <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
                <span class="n">objecttools</span><span class="o">.</span><span class="n">augment_excmessage</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;While trying to retrieve a value from parameter &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">elementphrase</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2"> via the attribute `</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">`&quot;</span>
                <span class="p">)</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Parameter </span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">elementphrase</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2"> does not handle an &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;attribute named `</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">`.&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entrynames</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">entrynames</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span> <span class="o">=</span> <span class="n">values</span>
            <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
                <span class="n">objecttools</span><span class="o">.</span><span class="n">augment_excmessage</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;While trying to assign a new value to parameter &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">elementphrase</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2"> via attribute `</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">`&quot;</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">revert_timefactor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">(&quot;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">values</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">repr_</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">blanks</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
            <span class="n">string</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">repr_</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">entrynames</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">substring</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
                <span class="n">textwrap</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span>
                    <span class="n">text</span><span class="o">=</span><span class="n">string</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="mi">70</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">),</span> <span class="mi">30</span><span class="p">),</span> <span class="n">break_long_words</span><span class="o">=</span><span class="kc">False</span>
                <span class="p">)</span>
            <span class="p">):</span>
                <span class="k">if</span> <span class="n">idx</span><span class="p">:</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}{</span><span class="n">substring</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}{</span><span class="n">substring</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="s2">&quot;)&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.core.parametertools import KeywordParameter1D</span>
<span class="sd">        &gt;&gt;&gt; class Season(KeywordParameter1D):</span>
<span class="sd">        ...     TYPE = bool</span>
<span class="sd">        ...     TIME = None</span>
<span class="sd">        ...     entrynames = (&quot;winter&quot;, &quot;summer&quot;)</span>
<span class="sd">        &gt;&gt;&gt; season = Season(None)</span>
<span class="sd">        &gt;&gt;&gt; sorted(set(dir(season)) - set(object.__dir__(season)))</span>
<span class="sd">        [&#39;summer&#39;, &#39;winter&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__dir__</span><span class="p">())</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">entrynames</span><span class="p">)</span></div>



<div class="viewcode-block" id="MonthParameter">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.MonthParameter">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">MonthParameter</span><span class="p">(</span><span class="n">KeywordParameter1D</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for parameters whose values depend on the actual month.</span>

<span class="sd">    Please see the documentation on class |KeywordParameter1D| on how to use</span>
<span class="sd">    |MonthParameter| objects and class |lland_control.WG2Z| of base model |lland| as an</span>
<span class="sd">    example implementation:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy.models.lland import *</span>
<span class="sd">    &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">    &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">    &gt;&gt;&gt; wg2z(3.0, 2.0, 1.0, 0.0, -1.0, -2.0, -3.0, -2.0, -1.0, 0.0, 1.0, 2.0)</span>
<span class="sd">    &gt;&gt;&gt; wg2z</span>
<span class="sd">    wg2z(jan=3.0, feb=2.0, mar=1.0, apr=0.0, may=-1.0, jun=-2.0, jul=-3.0,</span>
<span class="sd">         aug=-2.0, sep=-1.0, oct=0.0, nov=1.0, dec=2.0)</span>

<span class="sd">    Note that attribute access provides access to the &quot;real&quot; values related to the</span>
<span class="sd">    current simulation time step:</span>

<span class="sd">    &gt;&gt;&gt; wg2z.feb</span>
<span class="sd">    2.0</span>
<span class="sd">    &gt;&gt;&gt; wg2z.feb = 4.0</span>
<span class="sd">    &gt;&gt;&gt; wg2z</span>
<span class="sd">    wg2z(jan=3.0, feb=4.0, mar=1.0, apr=0.0, may=-1.0, jun=-2.0, jul=-3.0,</span>
<span class="sd">         aug=-2.0, sep=-1.0, oct=0.0, nov=1.0, dec=2.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">entrynames</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;jan&quot;</span><span class="p">,</span>
        <span class="s2">&quot;feb&quot;</span><span class="p">,</span>
        <span class="s2">&quot;mar&quot;</span><span class="p">,</span>
        <span class="s2">&quot;apr&quot;</span><span class="p">,</span>
        <span class="s2">&quot;may&quot;</span><span class="p">,</span>
        <span class="s2">&quot;jun&quot;</span><span class="p">,</span>
        <span class="s2">&quot;jul&quot;</span><span class="p">,</span>
        <span class="s2">&quot;aug&quot;</span><span class="p">,</span>
        <span class="s2">&quot;sep&quot;</span><span class="p">,</span>
        <span class="s2">&quot;oct&quot;</span><span class="p">,</span>
        <span class="s2">&quot;nov&quot;</span><span class="p">,</span>
        <span class="s2">&quot;dec&quot;</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="KeywordParameter2D">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.KeywordParameter2D">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">KeywordParameter2D</span><span class="p">(</span><span class="n">_MixinModifiableParameter</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for 2-dimensional model parameters with values depending on two</span>
<span class="sd">    factors.</span>

<span class="sd">    When subclassing from |KeywordParameter2D| one needs to define the attributes</span>
<span class="sd">    `rownames` and `columnnames` (both of type |tuple|).  A typical use case is that</span>
<span class="sd">    `rownames` defines some land-use classes, and `columnnames` defines seasons,</span>
<span class="sd">    months, etc.  Here, we consider a simple corresponding example where the values of</span>
<span class="sd">    the boolean parameter `IsWarm` depend on the on the hemisphere and the half-year</span>
<span class="sd">    period:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy.core.parametertools import KeywordParameter2D</span>
<span class="sd">    &gt;&gt;&gt; class IsWarm(KeywordParameter2D):</span>
<span class="sd">    ...     TYPE = bool</span>
<span class="sd">    ...     TIME = None</span>
<span class="sd">    ...     rownames = (&quot;north&quot;, &quot;south&quot;)</span>
<span class="sd">    ...     columnnames = (&quot;apr2sep&quot;, &quot;oct2mar&quot;)</span>

<span class="sd">    Instantiate the defined parameter class and define its shape:</span>

<span class="sd">    &gt;&gt;&gt; iswarm = IsWarm(None)</span>
<span class="sd">    &gt;&gt;&gt; iswarm.shape = (2, 2)</span>

<span class="sd">    |KeywordParameter2D| allows us to set the values of all rows via keyword arguments:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy import print_matrix</span>
<span class="sd">    &gt;&gt;&gt; iswarm(north=[True, False],</span>
<span class="sd">    ...        south=[False, True])</span>
<span class="sd">    &gt;&gt;&gt; iswarm</span>
<span class="sd">    iswarm(north=[True, False],</span>
<span class="sd">           south=[False, True])</span>
<span class="sd">    &gt;&gt;&gt; print_matrix(iswarm.values)</span>
<span class="sd">    | True, False |</span>
<span class="sd">    | False, True |</span>

<span class="sd">    If a keyword is missing, it raises a |ValueError|:</span>

<span class="sd">    &gt;&gt;&gt; iswarm(north=[True, False])</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ValueError: While setting parameter `iswarm` of element `?` via row related \</span>
<span class="sd">keyword arguments, each string defined in `rownames` must be used as a keyword, but \</span>
<span class="sd">the following keywords are not: `south`.</span>

<span class="sd">    One can modify single rows via attribute access:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy import print_vector</span>
<span class="sd">    &gt;&gt;&gt; iswarm.north = False, False</span>
<span class="sd">    &gt;&gt;&gt; print_vector(iswarm.north)</span>
<span class="sd">    False, False</span>

<span class="sd">    The same holds for the columns:</span>

<span class="sd">    &gt;&gt;&gt; iswarm.apr2sep = True, False</span>
<span class="sd">    &gt;&gt;&gt; print_vector(iswarm.apr2sep)</span>
<span class="sd">    True, False</span>

<span class="sd">    Also, combined row-column access is possible:</span>

<span class="sd">    &gt;&gt;&gt; iswarm.north_apr2sep</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; iswarm.north_apr2sep = False</span>
<span class="sd">    &gt;&gt;&gt; iswarm.north_apr2sep</span>
<span class="sd">    False</span>

<span class="sd">    All three forms of attribute access define augmented exception messages in case</span>
<span class="sd">    anything goes wrong:</span>

<span class="sd">    &gt;&gt;&gt; iswarm.north = True, True, True</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ValueError: While trying to assign new values to parameter `iswarm` of element \</span>
<span class="sd">`?` via the row related attribute `north`, the following error occurred: could not \</span>
<span class="sd">broadcast input array from shape (3,) into shape (2,)</span>
<span class="sd">    &gt;&gt;&gt; iswarm.apr2sep = True, True, True</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ValueError: While trying to assign new values to parameter `iswarm` of element \</span>
<span class="sd">`?` via the column related attribute `apr2sep`, the following error occurred: could \</span>
<span class="sd">not broadcast input array from shape (3,) into shape (2,)</span>

<span class="sd">    &gt;&gt;&gt; iswarm.shape = (1, 1)</span>

<span class="sd">    &gt;&gt;&gt; iswarm.south_apr2sep = False</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    IndexError: While trying to assign new values to parameter `iswarm` of element \</span>
<span class="sd">`?` via the row and column related attribute `south_apr2sep`, the following error \</span>
<span class="sd">occurred: index 1 is out of bounds for axis 0 with size 1</span>

<span class="sd">    &gt;&gt;&gt; iswarm.south</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    IndexError: While trying to retrieve values from parameter `iswarm` of element \</span>
<span class="sd">`?` via the row related attribute `south`, the following error occurred: index 1 is \</span>
<span class="sd">out of bounds for axis 0 with size 1</span>
<span class="sd">    &gt;&gt;&gt; iswarm.oct2mar</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    IndexError: While trying to retrieve values from parameter `iswarm` of element \</span>
<span class="sd">`?` via the column related attribute `oct2mar`, the following error occurred: index 1 \</span>
<span class="sd">is out of bounds for axis 1 with size 1</span>
<span class="sd">    &gt;&gt;&gt; iswarm.south_oct2mar</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    IndexError: While trying to retrieve values from parameter `iswarm` of element \</span>
<span class="sd">`?` via the row and column related attribute `south_oct2mar`, the following error \</span>
<span class="sd">occurred: index 1 is out of bounds for axis 0 with size 1</span>

<span class="sd">    &gt;&gt;&gt; iswarm.shape = (2, 2)</span>

<span class="sd">    Unknown attribute names result in the following error:</span>

<span class="sd">    &gt;&gt;&gt; iswarm.wrong</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    AttributeError: Parameter `iswarm` of element `?` does neither handle a normal \</span>
<span class="sd">attribute nor a row or column related attribute named `wrong`.</span>

<span class="sd">    One can still define the parameter values  via positional arguments:</span>

<span class="sd">    &gt;&gt;&gt; iswarm(True)</span>
<span class="sd">    &gt;&gt;&gt; iswarm</span>
<span class="sd">    iswarm(north=[True, True],</span>
<span class="sd">           south=[True, True])</span>

<span class="sd">    For parameters with many columns, string representations are adequately wrapped:</span>

<span class="sd">    &gt;&gt;&gt; iswarm.shape = (2, 10)</span>
<span class="sd">    &gt;&gt;&gt; iswarm</span>
<span class="sd">    iswarm(north=[False, False, False, False, False, False, False, False,</span>
<span class="sd">                  False, False],</span>
<span class="sd">           south=[False, False, False, False, False, False, False, False,</span>
<span class="sd">                  False, False])</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">NDIM</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">rownames</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
    <span class="n">columnnames</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
    <span class="n">rowmin</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">columnmin</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">strict_valuehandling</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">_rowcolumnmappings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subvars</span><span class="p">:</span> <span class="n">SubParameters</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">subvars</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rownames</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">rownames</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">columnnames</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">columnnames</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rowcolumnmappings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_rowcolumnmappings</span><span class="p">(</span>
            <span class="n">rownames</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rownames</span><span class="p">,</span> <span class="n">columnnames</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">columnnames</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rowmin</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">rowmin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">columnmin</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">columnmin</span>

<div class="viewcode-block" id="KeywordParameter2D.modify_rows">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.KeywordParameter2D.modify_rows">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">modify_rows</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">constants</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Constants</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Modify the relevant row names temporarily.</span>

<span class="sd">        Methods |KeywordParameter2D.modify_rows| and |KeywordParameter2D.modify_columns|</span>
<span class="sd">        serve the same purpose and behave exactly on the respective axis</span>
<span class="sd">        |KeywordParameter2D| instances as method |KeywordParameter1D.modify_entries| on</span>
<span class="sd">        the single axis of |KeywordParameter1D| instances.  Hence, we only test their</span>
<span class="sd">        implementation here.  Please read the documentation on method</span>
<span class="sd">        |KeywordParameter1D.modify_entries| for more information:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import print_vector</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.core.parametertools import KeywordParameter2D</span>
<span class="sd">        &gt;&gt;&gt; class IsWarm(KeywordParameter2D):</span>
<span class="sd">        ...     TYPE = bool</span>
<span class="sd">        ...     TIME = None</span>
<span class="sd">        ...     rownames = (&quot;north&quot;, &quot;south&quot;)</span>
<span class="sd">        ...     columnnames = (&quot;apr2sep&quot;, &quot;oct2mar&quot;)</span>
<span class="sd">        &gt;&gt;&gt; iswarm1 = IsWarm(None)</span>
<span class="sd">        &gt;&gt;&gt; iswarm1.shape = (2, 2)</span>
<span class="sd">        &gt;&gt;&gt; iswarm1(north=[True, False],</span>
<span class="sd">        ...         south=[False, True])</span>
<span class="sd">        &gt;&gt;&gt; print_vector(iswarm1.north)</span>
<span class="sd">        True, False</span>
<span class="sd">        &gt;&gt;&gt; print_vector(iswarm1.apr2sep)</span>
<span class="sd">        True, False</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.core.parametertools import Constants</span>
<span class="sd">        &gt;&gt;&gt; consts_row = Constants(N=1, S=2)</span>
<span class="sd">        &gt;&gt;&gt; consts_column = Constants(APR2JUN=2, JUN2SEP=3, OCT2DEC=4, JAN2MAR=5)</span>
<span class="sd">        &gt;&gt;&gt; with IsWarm.modify_rows(consts_row), IsWarm.modify_columns(consts_column):</span>
<span class="sd">        ...     iswarm2 = IsWarm(None)</span>
<span class="sd">        ...     iswarm2.shape = (2, 4)</span>
<span class="sd">        ...     iswarm2(n=[True, True, False, False],</span>
<span class="sd">        ...             s=[False, False, True, True])</span>
<span class="sd">        ...     print_vector(iswarm2.n)</span>
<span class="sd">        ...     print_vector(iswarm2.apr2jun)</span>
<span class="sd">        True, True, False, False</span>
<span class="sd">        True, False</span>

<span class="sd">        &gt;&gt;&gt; iswarm1.rownames</span>
<span class="sd">        (&#39;north&#39;, &#39;south&#39;)</span>
<span class="sd">        &gt;&gt;&gt; iswarm1.columnnames</span>
<span class="sd">        (&#39;apr2sep&#39;, &#39;oct2mar&#39;)</span>
<span class="sd">        &gt;&gt;&gt; iswarm1.rowmin</span>
<span class="sd">        0</span>
<span class="sd">        &gt;&gt;&gt; iswarm1.columnmin</span>
<span class="sd">        0</span>

<span class="sd">        &gt;&gt;&gt; iswarm2.rownames</span>
<span class="sd">        (&#39;n&#39;, &#39;s&#39;)</span>
<span class="sd">        &gt;&gt;&gt; iswarm2.columnnames</span>
<span class="sd">        (&#39;apr2jun&#39;, &#39;jun2sep&#39;, &#39;oct2dec&#39;, &#39;jan2mar&#39;)</span>
<span class="sd">        &gt;&gt;&gt; iswarm2.rowmin</span>
<span class="sd">        1</span>
<span class="sd">        &gt;&gt;&gt; iswarm2.columnmin</span>
<span class="sd">        2</span>

<span class="sd">        &gt;&gt;&gt; IsWarm.rownames</span>
<span class="sd">        (&#39;north&#39;, &#39;south&#39;)</span>
<span class="sd">        &gt;&gt;&gt; IsWarm.columnnames</span>
<span class="sd">        (&#39;apr2sep&#39;, &#39;oct2mar&#39;)</span>
<span class="sd">        &gt;&gt;&gt; IsWarm.rowmin</span>
<span class="sd">        0</span>
<span class="sd">        &gt;&gt;&gt; IsWarm.columnmin</span>
<span class="sd">        0</span>

<span class="sd">        &gt;&gt;&gt; IsWarm.rowmin = 2</span>
<span class="sd">        &gt;&gt;&gt; IsWarm.columnmin = 3</span>
<span class="sd">        &gt;&gt;&gt; with IsWarm.modify_rows(None), IsWarm.modify_columns(None):</span>
<span class="sd">        ...     IsWarm.rownames</span>
<span class="sd">        ...     IsWarm.rowmin</span>
<span class="sd">        ...     IsWarm.columnnames</span>
<span class="sd">        ...     IsWarm.columnmin</span>
<span class="sd">        ...     iswarm3 = IsWarm(None)</span>
<span class="sd">        ...     iswarm3.shape = (2, 2)</span>
<span class="sd">        ...     iswarm3(north=[True, False],</span>
<span class="sd">        ...             south=[False, True])</span>
<span class="sd">        ...     iswarm3</span>
<span class="sd">        ...     print_vector(iswarm1.north)</span>
<span class="sd">        (&#39;north&#39;, &#39;south&#39;)</span>
<span class="sd">        2</span>
<span class="sd">        (&#39;apr2sep&#39;, &#39;oct2mar&#39;)</span>
<span class="sd">        3</span>
<span class="sd">        iswarm(north=[True, False],</span>
<span class="sd">               south=[False, True])</span>
<span class="sd">        True, False</span>
<span class="sd">        &gt;&gt;&gt; IsWarm.rownames</span>
<span class="sd">        (&#39;north&#39;, &#39;south&#39;)</span>
<span class="sd">        &gt;&gt;&gt; IsWarm.columnnames</span>
<span class="sd">        (&#39;apr2sep&#39;, &#39;oct2mar&#39;)</span>
<span class="sd">        &gt;&gt;&gt; IsWarm.rowmin</span>
<span class="sd">        2</span>
<span class="sd">        &gt;&gt;&gt; IsWarm.columnmin</span>
<span class="sd">        3</span>
<span class="sd">        &gt;&gt;&gt; iswarm3</span>
<span class="sd">        iswarm(north=[True, False],</span>
<span class="sd">               south=[False, True])</span>
<span class="sd">        &gt;&gt;&gt; print_vector(iswarm1.north)</span>
<span class="sd">        True, False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">constants</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">yield</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">get</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">get</span>
            <span class="n">old_names</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="s2">&quot;rownames&quot;</span><span class="p">)</span>
            <span class="n">old_min</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="s2">&quot;rowmin&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">rownames</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">sortednames</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">rowmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                <span class="k">yield</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">_reset_after_modification</span><span class="p">(</span><span class="s2">&quot;rownames&quot;</span><span class="p">,</span> <span class="n">old_names</span><span class="p">)</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">_reset_after_modification</span><span class="p">(</span><span class="s2">&quot;rowmin&quot;</span><span class="p">,</span> <span class="n">old_min</span><span class="p">)</span></div>


<div class="viewcode-block" id="KeywordParameter2D.modify_columns">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.KeywordParameter2D.modify_columns">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">modify_columns</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">constants</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Constants</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Modify the relevant column names temporarily.</span>

<span class="sd">        Please see the documentation on method |KeywordParameter2D.modify_rows| for</span>
<span class="sd">        further information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">constants</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">yield</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">get</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">get</span>
            <span class="n">old_names</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="s2">&quot;columnnames&quot;</span><span class="p">)</span>
            <span class="n">old_min</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="s2">&quot;columnmin&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">columnnames</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">sortednames</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">columnmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                <span class="k">yield</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">_reset_after_modification</span><span class="p">(</span><span class="s2">&quot;columnnames&quot;</span><span class="p">,</span> <span class="n">old_names</span><span class="p">)</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">_reset_after_modification</span><span class="p">(</span><span class="s2">&quot;columnmin&quot;</span><span class="p">,</span> <span class="n">old_min</span><span class="p">)</span></div>


    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_make_rowcolumnmappings</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">rownames</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">columnnames</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
        <span class="n">rowcolmappings</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">rowname</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rownames</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">jdx</span><span class="p">,</span> <span class="n">colname</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">columnnames</span><span class="p">):</span>
                <span class="n">rowcolmappings</span><span class="p">[</span><span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">rowname</span><span class="p">,</span> <span class="n">colname</span><span class="p">))]</span> <span class="o">=</span> <span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">jdx</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rowcolmappings</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__init_subclass__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init_subclass__</span><span class="p">()</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_rowcolumnmappings</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_make_rowcolumnmappings</span><span class="p">(</span>
            <span class="n">rownames</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">rownames</span><span class="p">,</span> <span class="n">columnnames</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">columnnames</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__hydpy__connect_variable2subgroup__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__hydpy__connect_variable2subgroup__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rownames</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">columnnames</span><span class="p">))</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_rowmin&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rowmin</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_columnmin&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">columnmin</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">NotImplementedError</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rownames</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_timefactor</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="n">miss</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rownames</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">]</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;While setting parameter &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">elementphrase</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2"> via row related keyword &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;arguments, each string defined in `rownames` must be used &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;as a keyword, but the following keywords are not: &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">enumeration</span><span class="p">(</span><span class="n">miss</span><span class="p">)</span><span class="si">}</span><span class="s2">`.&quot;</span>
                    <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rownames</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">rownames</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="p">:]</span>
            <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
                <span class="n">objecttools</span><span class="o">.</span><span class="n">augment_excmessage</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;While trying to retrieve values from parameter &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">elementphrase</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2"> via the row related attribute &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">`&quot;</span>
                <span class="p">)</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columnnames</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">columnnames</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span>
            <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
                <span class="n">objecttools</span><span class="o">.</span><span class="n">augment_excmessage</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;While trying to retrieve values from parameter &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">elementphrase</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2"> via the column related &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;attribute `</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">`&quot;</span>
                <span class="p">)</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rowcolumnmappings</span><span class="p">:</span>
            <span class="n">idx</span><span class="p">,</span> <span class="n">jdx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rowcolumnmappings</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">TYPE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">jdx</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
                <span class="n">objecttools</span><span class="o">.</span><span class="n">augment_excmessage</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;While trying to retrieve values from parameter &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">elementphrase</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2"> via the row and column &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;related attribute `</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">`&quot;</span>
                <span class="p">)</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Parameter </span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">elementphrase</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2"> does neither handle a &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;normal attribute nor a row or column related attribute named `</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">`.&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rownames</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">rownames</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">values</span>
            <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
                <span class="n">objecttools</span><span class="o">.</span><span class="n">augment_excmessage</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;While trying to assign new values to parameter &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">elementphrase</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2"> via the row related attribute &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">`&quot;</span>
                <span class="p">)</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columnnames</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">columnnames</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span> <span class="o">=</span> <span class="n">values</span>
            <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
                <span class="n">objecttools</span><span class="o">.</span><span class="n">augment_excmessage</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;While trying to assign new values to parameter &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">elementphrase</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2"> via the column related &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;attribute `</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">`&quot;</span>
                <span class="p">)</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rowcolumnmappings</span><span class="p">:</span>
            <span class="n">idx</span><span class="p">,</span> <span class="n">jdx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rowcolumnmappings</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">jdx</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span>
            <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
                <span class="n">objecttools</span><span class="o">.</span><span class="n">augment_excmessage</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;While trying to assign new values to parameter &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">elementphrase</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2"> via the row and column &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;related attribute `</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">`&quot;</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">revert_timefactor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">(&quot;</span>
        <span class="n">blanks</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rownames</span><span class="p">):</span>
            <span class="n">subprefix</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}{</span><span class="n">key</span><span class="si">}</span><span class="s2">=&quot;</span> <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}{</span><span class="n">key</span><span class="si">}</span><span class="s2">=&quot;</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">objecttools</span><span class="o">.</span><span class="n">assignrepr_list</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="p">:],</span> <span class="n">subprefix</span><span class="p">,</span> <span class="mi">75</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
            <span class="p">)</span>
        <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.core.parametertools import KeywordParameter2D</span>
<span class="sd">        &gt;&gt;&gt; class IsWarm(KeywordParameter2D):</span>
<span class="sd">        ...     TYPE = bool</span>
<span class="sd">        ...     TIME = None</span>
<span class="sd">        ...     rownames = (&quot;north&quot;, &quot;south&quot;)</span>
<span class="sd">        ...     columnnames = (&quot;apr2sep&quot;, &quot;oct2mar&quot;)</span>
<span class="sd">        &gt;&gt;&gt; iswarm = IsWarm(None)</span>
<span class="sd">        &gt;&gt;&gt; sorted(set(dir(iswarm)) - set(object.__dir__(iswarm)))</span>
<span class="sd">        [&#39;apr2sep&#39;, &#39;north&#39;, &#39;north_apr2sep&#39;, &#39;north_oct2mar&#39;, &#39;oct2mar&#39;, &#39;south&#39;, \</span>
<span class="sd">&#39;south_apr2sep&#39;, &#39;south_oct2mar&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">rowcolmappings</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rowcolumnmappings</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">cast</span><span class="p">(</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__dir__</span><span class="p">())</span>
            <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rownames</span><span class="p">)</span>
            <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">columnnames</span><span class="p">)</span>
            <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">rowcolmappings</span><span class="p">)</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="LeftRightParameter">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.LeftRightParameter">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">LeftRightParameter</span><span class="p">(</span><span class="n">variabletools</span><span class="o">.</span><span class="n">MixinFixedShape</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for handling two values, a left one and a right one.</span>

<span class="sd">    The original purpose of class |LeftRightParameter| is to make the</span>
<span class="sd">    handling of river channel related parameters with different values</span>
<span class="sd">    for both river banks a little more convenient.</span>

<span class="sd">    As an example, we define a parameter class describing the width</span>
<span class="sd">    both of the left and the right flood plain of a river segment:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy.core.parametertools import LeftRightParameter</span>
<span class="sd">    &gt;&gt;&gt; class FloodPlainWidth(LeftRightParameter):</span>
<span class="sd">    ...     TYPE = float</span>
<span class="sd">    ...     TIME = None</span>
<span class="sd">    &gt;&gt;&gt; floodplainwidth = FloodPlainWidth(None)</span>

<span class="sd">    Here, we need to set the shape of the parameter to 2, which is an</span>
<span class="sd">    automated procedure in full model setups:</span>

<span class="sd">    &gt;&gt;&gt; floodplainwidth.shape = 2</span>

<span class="sd">    Parameter values can be defined as usual:</span>

<span class="sd">    &gt;&gt;&gt; floodplainwidth(3.0)</span>
<span class="sd">    &gt;&gt;&gt; floodplainwidth</span>
<span class="sd">    floodplainwidth(3.0)</span>

<span class="sd">    Alternatively, use the keywords `left` or `l` and `right` or</span>
<span class="sd">    `r` to define both values individually:</span>

<span class="sd">    &gt;&gt;&gt; floodplainwidth(left=1.0, right=2.0)</span>
<span class="sd">    &gt;&gt;&gt; floodplainwidth</span>
<span class="sd">    floodplainwidth(left=1.0, right=2.0)</span>
<span class="sd">    &gt;&gt;&gt; floodplainwidth(l=2.0, r=1.0)</span>
<span class="sd">    &gt;&gt;&gt; floodplainwidth</span>
<span class="sd">    floodplainwidth(left=2.0, right=1.0)</span>

<span class="sd">    Incomplete information results in the following errors:</span>

<span class="sd">    &gt;&gt;&gt; floodplainwidth(left=2.0)</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ValueError: When setting the values of parameter `floodplainwidth` of \</span>
<span class="sd">element `?` via keyword arguments, either `right` or `r` for the &quot;right&quot; \</span>
<span class="sd">parameter value must be given, but is not.</span>
<span class="sd">    &gt;&gt;&gt; floodplainwidth(right=1.0)</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ValueError: When setting the values of parameter `floodplainwidth` of \</span>
<span class="sd">element `?` via keyword arguments, either `left` or `l` for the &quot;left&quot; \</span>
<span class="sd">parameter value must be given, but is not.</span>

<span class="sd">    Additionally, one can query and modify the individual values via the</span>
<span class="sd">    attribute names `left` and `right`:</span>

<span class="sd">    &gt;&gt;&gt; floodplainwidth.left</span>
<span class="sd">    2.0</span>
<span class="sd">    &gt;&gt;&gt; floodplainwidth.left = 3.0</span>
<span class="sd">    &gt;&gt;&gt; floodplainwidth.right</span>
<span class="sd">    1.0</span>
<span class="sd">    &gt;&gt;&gt; floodplainwidth.right = 4.0</span>
<span class="sd">    &gt;&gt;&gt; floodplainwidth</span>
<span class="sd">    floodplainwidth(left=3.0, right=4.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">NDIM</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">SHAPE</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,)</span>
    <span class="n">strict_valuehandling</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">NotImplementedError</span><span class="p">:</span>
            <span class="n">left</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;l&quot;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">left</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;When setting the values of parameter &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">elementphrase</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2"> via keyword &quot;</span>
                    <span class="sa">f</span><span class="s1">&#39;arguments, either `left` or `l` for the &quot;left&quot; &#39;</span>
                    <span class="sa">f</span><span class="s2">&quot;parameter value must be given, but is not.&quot;</span>
                <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">left</span>
            <span class="n">right</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">right</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;When setting the values of parameter &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">elementphrase</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2"> via keyword &quot;</span>
                    <span class="sa">f</span><span class="s1">&#39;arguments, either `right` or `r` for the &quot;right&quot; &#39;</span>
                    <span class="sa">f</span><span class="s2">&quot;parameter value must be given, but is not.&quot;</span>
                <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">right</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">left</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The &quot;left&quot; value of the actual parameter object.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">TYPE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="nd">@left</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">left</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">right</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The &quot;right&quot; value of the actual parameter object.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">TYPE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="nd">@right</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">right</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">objecttools</span><span class="o">.</span><span class="n">repr_</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">(left=</span><span class="si">{</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, right=</span><span class="si">{</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span></div>



<div class="viewcode-block" id="FixedParameter">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.FixedParameter">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">FixedParameter</span><span class="p">(</span><span class="n">Parameter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for defining parameters with fixed values.</span>

<span class="sd">    Model model-users usually do not modify the values of |FixedParameter|</span>
<span class="sd">    objects.  Hence, such objects prepare their &quot;initial&quot; values automatically</span>
<span class="sd">    whenever possible, even when option |Options.usedefaultvalues| is disabled.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">INIT</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">initinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">bool</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A |tuple| always containing the fixed value and |True|, except</span>
<span class="sd">        for time-dependent parameters and incomplete time-information.</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">            &gt;&gt;&gt; del pub.options.simulationstep</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.core.parametertools import FixedParameter</span>
<span class="sd">        &gt;&gt;&gt; class Par(FixedParameter):</span>
<span class="sd">        ...   NDIM, TYPE, TIME, SPAN = 0, float, True, (0., None)</span>
<span class="sd">        ...   INIT = 100.0</span>
<span class="sd">        &gt;&gt;&gt; par = Par(None)</span>
<span class="sd">        &gt;&gt;&gt; par.initinfo</span>
<span class="sd">        (nan, False)</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.options.parameterstep = &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; pub.options.simulationstep = &quot;12h&quot;</span>
<span class="sd">        &gt;&gt;&gt; par.initinfo</span>
<span class="sd">        (50.0, True)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">parameterstep</span><span class="p">(</span><span class="s2">&quot;1d&quot;</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_timefactor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">INIT</span><span class="p">),</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">RuntimeError</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">variabletools</span><span class="o">.</span><span class="n">TYPE2MISSINGVALUE</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">TYPE</span><span class="p">],</span> <span class="kc">False</span>

<div class="viewcode-block" id="FixedParameter.restore">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.FixedParameter.restore">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">restore</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Restore the original parameter value.</span>

<span class="sd">        Method |FixedParameter.restore| is relevant for testing mainly.  Note that it</span>
<span class="sd">        might be necessary to call it after changing the simulation step size, as shown</span>
<span class="sd">        in the following example using the parameter |evap_fixed.HeatOfCondensation| of</span>
<span class="sd">        base model |evap|:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.evap import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; fixed.heatofcondensation</span>
<span class="sd">        heatofcondensation(28.5)</span>
<span class="sd">        &gt;&gt;&gt; round_(fixed.heatofcondensation.value)</span>
<span class="sd">        28.5</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;12h&quot;)</span>
<span class="sd">        &gt;&gt;&gt; fixed.heatofcondensation</span>
<span class="sd">        heatofcondensation(14.25)</span>
<span class="sd">        &gt;&gt;&gt; round_(fixed.heatofcondensation.value)</span>
<span class="sd">        28.5</span>
<span class="sd">        &gt;&gt;&gt; fixed.heatofcondensation.restore()</span>
<span class="sd">        &gt;&gt;&gt; fixed.heatofcondensation</span>
<span class="sd">        heatofcondensation(28.5)</span>
<span class="sd">        &gt;&gt;&gt; round_(fixed.heatofcondensation.value)</span>
<span class="sd">        57.0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">parameterstep</span><span class="p">(</span><span class="s2">&quot;1d&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">INIT</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="SolverParameter">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.SolverParameter">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">SolverParameter</span><span class="p">(</span><span class="n">Parameter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for defining parameters controlling numerical algorithms</span>
<span class="sd">    for solving model equations.</span>

<span class="sd">    So far, the equation systems of most models implemented into *HydPy*</span>
<span class="sd">    are primarily coded as approximative solutions.  However, there are also</span>
<span class="sd">    some models stating the original equations only.  One example</span>
<span class="sd">    is the |dam| model. Its code consists of the original differential</span>
<span class="sd">    equations, which must be solved by a separate algorithm.  Such</span>
<span class="sd">    algorithms, like the Runge Kutta schema implemented in class</span>
<span class="sd">    |ELSModel|, often come with some degrees of freedom, for example,</span>
<span class="sd">    to control the striven numerical accuracy.</span>

<span class="sd">    On the one hand, the model developer should know best how to configure</span>
<span class="sd">    a numerical algorithm he selects for solving the model equations.  On the</span>
<span class="sd">    other hand, there might be situations when the model user has diverging</span>
<span class="sd">    preferences.  For example, he might favour higher numerical accuracies</span>
<span class="sd">    in one project and faster computation times in another one.  Therefore,</span>
<span class="sd">    the |SolverParameter.update| method of class |SolverParameter| relies</span>
<span class="sd">    on an `INIT` value defined by the model developer as long as the user</span>
<span class="sd">    does not define an alternative value in his control files.</span>

<span class="sd">    As an example, we derive the numerical tolerance parameter `Tol`:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy.core.parametertools import SolverParameter</span>
<span class="sd">    &gt;&gt;&gt; class Tol(SolverParameter):</span>
<span class="sd">    ...     NDIM = 0</span>
<span class="sd">    ...     TYPE = float</span>
<span class="sd">    ...     TIME = None</span>
<span class="sd">    ...     SPAN = (0.0, None)</span>
<span class="sd">    ...     INIT = 0.1</span>

<span class="sd">    Initially, the method |SolverParameter.update| applies the value of the</span>
<span class="sd">    class constant `INIT`:</span>

<span class="sd">    &gt;&gt;&gt; tol = Tol(None)</span>
<span class="sd">    &gt;&gt;&gt; tol.update()</span>
<span class="sd">    &gt;&gt;&gt; tol</span>
<span class="sd">    tol(0.1)</span>

<span class="sd">    One can define an alternative value via &quot;calling&quot; the parameter as usual:</span>

<span class="sd">    &gt;&gt;&gt; tol(0.01)</span>
<span class="sd">    &gt;&gt;&gt; tol</span>
<span class="sd">    tol(0.01)</span>

<span class="sd">    Afterwards, |SolverParameter.update| reuses the alternative value</span>
<span class="sd">    instead of the value of class constant `INIT`:</span>

<span class="sd">    &gt;&gt;&gt; tol.update()</span>
<span class="sd">    &gt;&gt;&gt; tol</span>
<span class="sd">    tol(0.01)</span>

<span class="sd">    This alternative value is accessible and changeable via property</span>
<span class="sd">    |SolverParameter.alternative_initvalue|:</span>

<span class="sd">    &gt;&gt;&gt; tol.alternative_initvalue</span>
<span class="sd">    0.01</span>

<span class="sd">    &gt;&gt;&gt; tol.alternative_initvalue = 0.001</span>
<span class="sd">    &gt;&gt;&gt; tol.update()</span>
<span class="sd">    &gt;&gt;&gt; tol</span>
<span class="sd">    tol(0.001)</span>

<span class="sd">    One must delete the alternative value to make `INIT` relevant again:</span>

<span class="sd">    &gt;&gt;&gt; del tol.alternative_initvalue</span>
<span class="sd">    &gt;&gt;&gt; tol.alternative_initvalue</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    hydpy.core.exceptiontools.AttributeNotReady: No alternative initial value for \</span>
<span class="sd">solver parameter `tol` of element `?` has been defined so far.</span>
<span class="sd">    &gt;&gt;&gt; tol.update()</span>
<span class="sd">    &gt;&gt;&gt; tol</span>
<span class="sd">    tol(0.1)</span>

<span class="sd">    Very often, solver parameters depend on other model settings as the</span>
<span class="sd">    simulation step size or the catchment size, but `INIT` is always</span>
<span class="sd">    constant.  To allow for more flexibility, model developers can</span>
<span class="sd">    override the method |SolverParameter.modify_init|, which allows</span>
<span class="sd">    adapting the effective parameter value to the actual project settings.</span>

<span class="sd">    As a most simple example, we extend our class `Tol` with a</span>
<span class="sd">    |SolverParameter.modify_init| method that doubles the original</span>
<span class="sd">    `INIT` value:</span>

<span class="sd">    &gt;&gt;&gt; class ModTol(Tol):</span>
<span class="sd">    ...     def modify_init(self):</span>
<span class="sd">    ...         return 2.0 * self.INIT</span>
<span class="sd">    &gt;&gt;&gt; modtol = ModTol(None)</span>
<span class="sd">    &gt;&gt;&gt; modtol.update()</span>
<span class="sd">    &gt;&gt;&gt; modtol</span>
<span class="sd">    modtol(0.2)</span>

<span class="sd">    Note that |SolverParameter.modify_init| changes the value of `INIT`</span>
<span class="sd">    only, not the value of |SolverParameter.alternative_initvalue|:</span>

<span class="sd">    &gt;&gt;&gt; modtol.alternative_initvalue = 0.01</span>
<span class="sd">    &gt;&gt;&gt; modtol.update()</span>
<span class="sd">    &gt;&gt;&gt; modtol</span>
<span class="sd">    modtol(0.01)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">INIT</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span>
    <span class="n">_alternative_initvalue</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subvars</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">subvars</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_alternative_initvalue</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alternative_initvalue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>

<div class="viewcode-block" id="SolverParameter.update">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.SolverParameter.update">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the actual parameter value based on `INIT` or, if</span>
<span class="sd">        available, on |SolverParameter.alternative_initvalue|.</span>

<span class="sd">        See the main documentation on class |SolverParameter| for more</span>
<span class="sd">        information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_alternative_initvalue</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alternative_initvalue</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modify_init</span><span class="p">()</span></div>


<div class="viewcode-block" id="SolverParameter.modify_init">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.SolverParameter.modify_init">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">modify_init</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the value of class constant `INIT`.</span>

<span class="sd">        Override this method to support project-specific solver parameters.</span>
<span class="sd">        See the main documentation on class |SolverParameter| for more</span>
<span class="sd">        information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">INIT</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">alternative_initvalue</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A user-defined value to be used instead of the value of class</span>
<span class="sd">        constant `INIT`.</span>

<span class="sd">        See the main documentation on class |SolverParameter| for more</span>
<span class="sd">        information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_alternative_initvalue</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">exceptiontools</span><span class="o">.</span><span class="n">AttributeNotReady</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;No alternative initial value for solver parameter &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">elementphrase</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2"> has been defined so far.&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_alternative_initvalue</span>

    <span class="nd">@alternative_initvalue</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">alternative_initvalue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_alternative_initvalue</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@alternative_initvalue</span><span class="o">.</span><span class="n">deleter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">alternative_initvalue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_alternative_initvalue</span> <span class="o">=</span> <span class="kc">None</span></div>



<div class="viewcode-block" id="SecondsParameter">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.SecondsParameter">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">SecondsParameter</span><span class="p">(</span><span class="n">Parameter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The length of the actual simulation step size in seconds [s].&quot;&quot;&quot;</span>

    <span class="n">NDIM</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">TYPE</span> <span class="o">=</span> <span class="nb">float</span>
    <span class="n">TIME</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">SPAN</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

<div class="viewcode-block" id="SecondsParameter.update">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.SecondsParameter.update">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Take the number of seconds from the current simulation time step.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.core.parametertools import SecondsParameter</span>
<span class="sd">        &gt;&gt;&gt; secondsparameter = SecondsParameter(None)</span>
<span class="sd">        &gt;&gt;&gt; with pub.options.parameterstep(&quot;1d&quot;):</span>
<span class="sd">        ...     with pub.options.simulationstep(&quot;12h&quot;):</span>
<span class="sd">        ...         secondsparameter.update()</span>
<span class="sd">        ...         secondsparameter</span>
<span class="sd">        secondsparameter(43200.0)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">simulationstep</span><span class="o">.</span><span class="n">seconds</span></div>
</div>



<div class="viewcode-block" id="HoursParameter">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.HoursParameter">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">HoursParameter</span><span class="p">(</span><span class="n">Parameter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The length of the actual simulation step size in hours [h].&quot;&quot;&quot;</span>

    <span class="n">NDIM</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">TYPE</span> <span class="o">=</span> <span class="nb">float</span>
    <span class="n">TIME</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">SPAN</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

<div class="viewcode-block" id="HoursParameter.update">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.HoursParameter.update">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Take the number of hours from the current simulation time step.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.core.parametertools import HoursParameter</span>
<span class="sd">        &gt;&gt;&gt; hoursparameter = HoursParameter(None)</span>
<span class="sd">        &gt;&gt;&gt; with pub.options.parameterstep(&quot;1d&quot;):</span>
<span class="sd">        ...     with pub.options.simulationstep(&quot;12h&quot;):</span>
<span class="sd">        ...         hoursparameter.update()</span>
<span class="sd">        &gt;&gt;&gt; hoursparameter</span>
<span class="sd">        hoursparameter(12.0)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">simulationstep</span><span class="o">.</span><span class="n">hours</span></div>
</div>



<div class="viewcode-block" id="DaysParameter">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.DaysParameter">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">DaysParameter</span><span class="p">(</span><span class="n">Parameter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The length of the actual simulation step size in days [d].&quot;&quot;&quot;</span>

    <span class="n">NDIM</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">TYPE</span> <span class="o">=</span> <span class="nb">float</span>
    <span class="n">TIME</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">SPAN</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

<div class="viewcode-block" id="DaysParameter.update">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.DaysParameter.update">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Take the number of days from the current simulation time step.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.core.parametertools import DaysParameter</span>
<span class="sd">        &gt;&gt;&gt; daysparameter = DaysParameter(None)</span>
<span class="sd">        &gt;&gt;&gt; with pub.options.parameterstep(&quot;1d&quot;):</span>
<span class="sd">        ...     with pub.options.simulationstep(&quot;12h&quot;):</span>
<span class="sd">        ...         daysparameter.update()</span>
<span class="sd">        &gt;&gt;&gt; daysparameter</span>
<span class="sd">        daysparameter(0.5)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">simulationstep</span><span class="o">.</span><span class="n">days</span></div>
</div>



<div class="viewcode-block" id="TOYParameter">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.TOYParameter">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TOYParameter</span><span class="p">(</span><span class="n">Parameter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;References the |Indexer.timeofyear| index array provided by the</span>
<span class="sd">    instance of class |Indexer| available in module |pub|. [-].&quot;&quot;&quot;</span>

    <span class="n">NDIM</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">TYPE</span> <span class="o">=</span> <span class="nb">int</span>
    <span class="n">TIME</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">SPAN</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

<div class="viewcode-block" id="TOYParameter.update">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.TOYParameter.update">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reference the actual |Indexer.timeofyear| array of the</span>
<span class="sd">        |Indexer| object available in module |pub|.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;27.02.2004&quot;, &quot;3.03.2004&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.core.parametertools import TOYParameter</span>
<span class="sd">        &gt;&gt;&gt; toyparameter = TOYParameter(None)</span>
<span class="sd">        &gt;&gt;&gt; toyparameter.update()</span>
<span class="sd">        &gt;&gt;&gt; toyparameter</span>
<span class="sd">        toyparameter(57, 58, 59, 60, 61)</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">indexarray</span> <span class="o">=</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">indexer</span><span class="o">.</span><span class="n">timeofyear</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_shape</span><span class="p">(</span><span class="n">indexarray</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_value</span><span class="p">(</span><span class="n">indexarray</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="MOYParameter">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.MOYParameter">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">MOYParameter</span><span class="p">(</span><span class="n">Parameter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;References the |Indexer.monthofyear| index array provided by the</span>
<span class="sd">    instance of class |Indexer| available in module |pub| [-].&quot;&quot;&quot;</span>

    <span class="n">NDIM</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">TYPE</span> <span class="o">=</span> <span class="nb">int</span>
    <span class="n">TIME</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">SPAN</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>

<div class="viewcode-block" id="MOYParameter.update">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.MOYParameter.update">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reference the actual |Indexer.monthofyear| array of the</span>
<span class="sd">        |Indexer| object available in module |pub|.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;27.02.2004&quot;, &quot;3.03.2004&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.core.parametertools import MOYParameter</span>
<span class="sd">        &gt;&gt;&gt; moyparameter = MOYParameter(None)</span>
<span class="sd">        &gt;&gt;&gt; moyparameter.update()</span>
<span class="sd">        &gt;&gt;&gt; moyparameter</span>
<span class="sd">        moyparameter(1, 1, 1, 2, 2)</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">indexarray</span> <span class="o">=</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">indexer</span><span class="o">.</span><span class="n">monthofyear</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_shape</span><span class="p">(</span><span class="n">indexarray</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_value</span><span class="p">(</span><span class="n">indexarray</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="DOYParameter">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.DOYParameter">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">DOYParameter</span><span class="p">(</span><span class="n">Parameter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;References the |Indexer.dayofyear| index array provided by the</span>
<span class="sd">    instance of class |Indexer| available in module |pub| [-].&quot;&quot;&quot;</span>

    <span class="n">NDIM</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">TYPE</span> <span class="o">=</span> <span class="nb">int</span>
    <span class="n">TIME</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">SPAN</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">365</span><span class="p">)</span>

<div class="viewcode-block" id="DOYParameter.update">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.DOYParameter.update">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reference the actual |Indexer.dayofyear| array of the</span>
<span class="sd">        |Indexer| object available in module |pub|.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;27.02.2004&quot;, &quot;3.03.2004&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.core.parametertools import DOYParameter</span>
<span class="sd">        &gt;&gt;&gt; doyparameter = DOYParameter(None)</span>
<span class="sd">        &gt;&gt;&gt; doyparameter.update()</span>
<span class="sd">        &gt;&gt;&gt; doyparameter</span>
<span class="sd">        doyparameter(57, 58, 59, 60, 61)</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">indexarray</span> <span class="o">=</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">indexer</span><span class="o">.</span><span class="n">dayofyear</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_shape</span><span class="p">(</span><span class="n">indexarray</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_value</span><span class="p">(</span><span class="n">indexarray</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="SCTParameter">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.SCTParameter">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">SCTParameter</span><span class="p">(</span><span class="n">Parameter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;References the |Indexer.standardclocktime| array provided by the</span>
<span class="sd">    instance of class |Indexer| available in module |pub| [h].&quot;&quot;&quot;</span>

    <span class="n">NDIM</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">TYPE</span> <span class="o">=</span> <span class="nb">float</span>
    <span class="n">TIME</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">SPAN</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">86400.0</span><span class="p">)</span>

<div class="viewcode-block" id="SCTParameter.update">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.SCTParameter.update">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reference the actual |Indexer.standardclocktime| array of the</span>
<span class="sd">        |Indexer| object available in module |pub|.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;27.02.2004 21:00&quot;, &quot;28.02.2004 03:00&quot;, &quot;1h&quot;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.core.parametertools import SCTParameter</span>
<span class="sd">        &gt;&gt;&gt; sctparameter = SCTParameter(None)</span>
<span class="sd">        &gt;&gt;&gt; sctparameter.update()</span>
<span class="sd">        &gt;&gt;&gt; sctparameter</span>
<span class="sd">        sctparameter(21.5, 22.5, 23.5, 0.5, 1.5, 2.5)</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">indexer</span><span class="o">.</span><span class="n">standardclocktime</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_shape</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_value</span><span class="p">(</span><span class="n">array</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="UTCLongitudeParameter">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.UTCLongitudeParameter">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">UTCLongitudeParameter</span><span class="p">(</span><span class="n">Parameter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;References the current &quot;UTC longitude&quot; defined by option</span>
<span class="sd">    |Options.utclongitude|.&quot;&quot;&quot;</span>

    <span class="n">NDIM</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">TYPE</span> <span class="o">=</span> <span class="nb">int</span>
    <span class="n">TIME</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">SPAN</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">)</span>

<div class="viewcode-block" id="UTCLongitudeParameter.update">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.UTCLongitudeParameter.update">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply the current value of option |Options.utclongitude|.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.options.utclongitude</span>
<span class="sd">        15</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.core.parametertools import UTCLongitudeParameter</span>
<span class="sd">        &gt;&gt;&gt; utclongitudeparameter = UTCLongitudeParameter(None)</span>
<span class="sd">        &gt;&gt;&gt; utclongitudeparameter.update()</span>
<span class="sd">        &gt;&gt;&gt; utclongitudeparameter</span>
<span class="sd">        utclongitudeparameter(15)</span>

<span class="sd">        Note that changing the value of option |Options.utclongitude|</span>
<span class="sd">        might makes re-calling method |UTCLongitudeParameter.update| necessary:</span>

<span class="sd">        &gt;&gt;&gt; pub.options.utclongitude = 0</span>
<span class="sd">        &gt;&gt;&gt; utclongitudeparameter</span>
<span class="sd">        utclongitudeparameter(15)</span>
<span class="sd">        &gt;&gt;&gt; utclongitudeparameter.update()</span>
<span class="sd">        &gt;&gt;&gt; utclongitudeparameter</span>
<span class="sd">        utclongitudeparameter(0)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="p">(</span><span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">utclongitude</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="do_nothing">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.do_nothing">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">do_nothing</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># pylint: disable=unused-argument</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The default Python version of the |CallbackParameter|</span>
<span class="sd">    |CallbackParameter.callback| function, which does nothing.&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="CallbackParameter">
<a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.CallbackParameter">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">CallbackParameter</span><span class="p">(</span><span class="n">Parameter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for parameters that support calculating their values via user-defined</span>
<span class="sd">    callback functions alternatively of sticking to the same values during a simulation</span>
<span class="sd">    run.</span>

<span class="sd">    We use the callback parameter |sw1d_control.GateHeight| of application model</span>
<span class="sd">    |sw1d_gate_out| for the following technical explanations (for a more</span>
<span class="sd">    application-oriented example, see the |sw1d_model.Calc_Discharge_V3|</span>
<span class="sd">    documentation):</span>

<span class="sd">    &gt;&gt;&gt; from hydpy.models.sw1d_gate_out import *</span>
<span class="sd">    &gt;&gt;&gt; parameterstep()</span>

<span class="sd">    You can define a fixed gate height as usual:</span>

<span class="sd">    &gt;&gt;&gt; gateheight</span>
<span class="sd">    gateheight(?)</span>
<span class="sd">    &gt;&gt;&gt; gateheight(3.0)</span>
<span class="sd">    &gt;&gt;&gt; gateheight</span>
<span class="sd">    gateheight(3.0)</span>

<span class="sd">    Alternatively, you can write an individual callback function.  Its only argument</span>
<span class="sd">    accepts the model under consideration (here, |sw1d_gate_out|).  Principally, you</span>
<span class="sd">    are free to modify the model in any way you like, but the expected behaviour is</span>
<span class="sd">    to set the considered parameter&#39;s value only:</span>

<span class="sd">    &gt;&gt;&gt; def adjust(model) -&gt; None:</span>
<span class="sd">    ...     con = model.parameters.control.fastaccess</span>
<span class="sd">    ...     my_gateheight: float = 2.0 + 3.0</span>
<span class="sd">    ...     con.gateheight = my_gateheight</span>

<span class="sd">    However, when working in Cython mode, *HydPy* converts the pure Python function to</span>
<span class="sd">    a Cython function and compiles it to C in the background, similar to how it handles</span>
<span class="sd">    &quot;normal&quot; model methods.  This background conversion is crucial for efficiency but</span>
<span class="sd">    restricts the allowed syntax and functionality.  Generally, you should work with</span>
<span class="sd">    the usual &quot;fast access shortcuts&quot;, be explicit about the |None| return type, and</span>
<span class="sd">    cannot import any Python library, but are free to use Cython-functionalities</span>
<span class="sd">    implemented for and used by other model methods instead. A trivial example is using</span>
<span class="sd">    |fabs| for calculating absolute values.</span>

<span class="sd">    Next, we hand the callback function over to the parameter.  Here, we do this a</span>
<span class="sd">    little strangely between the creation of two tuples for hiding potential</span>
<span class="sd">    information printed by Cython or the used C compiler:</span>

<span class="sd">    &gt;&gt;&gt; ();gateheight(callback=adjust);()  # doctest: +ELLIPSIS</span>
<span class="sd">    (...)</span>

<span class="sd">    The string representation now includes the callback&#39;s source code:</span>

<span class="sd">    &gt;&gt;&gt; gateheight</span>
<span class="sd">    def adjust(model) -&gt; None:</span>
<span class="sd">        con = model.parameters.control.fastaccess</span>
<span class="sd">        my_gateheight: float = 2.0 + 3.0</span>
<span class="sd">        con.gateheight = my_gateheight</span>
<span class="sd">    gateheight(callback=adjust)</span>

<span class="sd">    When interested in the parameter&#39;s value, request it via the</span>
<span class="sd">    |CallbackParameter.value| property.  Note that this property applies the callback</span>
<span class="sd">    automatically before returning the (then updated) value:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">    &gt;&gt;&gt; round_(gateheight.value)</span>
<span class="sd">    5.0</span>

<span class="sd">    You can return the parameter to &quot;normal behaviour&quot; by assigning a fixed value:</span>

<span class="sd">    &gt;&gt;&gt; gateheight(7.0)</span>
<span class="sd">    &gt;&gt;&gt; gateheight</span>
<span class="sd">    gateheight(7.0)</span>

<span class="sd">    Alternatively, one can assign a function via the |CallbackParameter.callback|</span>
<span class="sd">    property.  We do not need to hide potential compiler output this time because the</span>
<span class="sd">    Python function has already been converted to a reusable Cython function:</span>

<span class="sd">    &gt;&gt;&gt; gateheight.callback = adjust</span>
<span class="sd">    &gt;&gt;&gt; gateheight</span>
<span class="sd">    def adjust(model) -&gt; None:</span>
<span class="sd">        con = model.parameters.control.fastaccess</span>
<span class="sd">        my_gateheight: float = 2.0 + 3.0</span>
<span class="sd">        con.gateheight = my_gateheight</span>
<span class="sd">    gateheight(callback=adjust)</span>
<span class="sd">    &gt;&gt;&gt; round_(gateheight.value)</span>
<span class="sd">    5.0</span>

<span class="sd">    Note that *HydPy* stores the Cython callbacks persistently on disk, using the</span>
<span class="sd">    Python function name as a part of the Cython module name. Hence, you cannot use</span>
<span class="sd">    two equally named callback functions for the same parameter of the same application</span>
<span class="sd">    model within one project.</span>

<span class="sd">    Use the `del` statement to remove the callback function:</span>

<span class="sd">    &gt;&gt;&gt; assert gateheight.callback is not None</span>
<span class="sd">    &gt;&gt;&gt; del gateheight.callback</span>
<span class="sd">    &gt;&gt;&gt; assert gateheight.callback is None</span>
<span class="sd">    &gt;&gt;&gt; gateheight</span>
<span class="sd">    gateheight(5.0)</span>
<span class="sd">    &gt;&gt;&gt; round_(gateheight.value)</span>
<span class="sd">    5.0</span>

<span class="sd">    Failing attempts to pass a callback function might result in the following errors:</span>

<span class="sd">    &gt;&gt;&gt; gateheight(Callback=adjust)</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ValueError: When trying to prepare parameter `gateheight` of element `?` via a \</span>
<span class="sd">keyword argument, it must be `callback`, and you need to pass a callback function.</span>

<span class="sd">    &gt;&gt;&gt; gateheight(value=1.0, callback=adjust)</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ValueError: Parameter `gateheight` of element `?` does not allow to combine the \</span>
<span class="sd">`callback` argument with other arguments.</span>

<span class="sd">    The conversion from Python to Cython also works when defining the original function</span>
<span class="sd">    in an indentated block:</span>

<span class="sd">    &gt;&gt;&gt; try:</span>
<span class="sd">    ...     def adjust_2(model) -&gt; None:</span>
<span class="sd">    ...         con = model.parameters.control.fastaccess</span>
<span class="sd">    ...         my_gateheight: float = 2.0 * 3.0</span>
<span class="sd">    ...         con.gateheight = my_gateheight</span>
<span class="sd">    ... finally:</span>
<span class="sd">    ...     ();gateheight(callback=adjust_2);()  # doctest: +ELLIPSIS</span>
<span class="sd">    (...)</span>
<span class="sd">    &gt;&gt;&gt; gateheight.callback = adjust_2</span>
<span class="sd">    &gt;&gt;&gt; gateheight</span>
<span class="sd">    def adjust_2(model) -&gt; None:</span>
<span class="sd">        con = model.parameters.control.fastaccess</span>
<span class="sd">        my_gateheight: float = 2.0 * 3.0</span>
<span class="sd">        con.gateheight = my_gateheight</span>
<span class="sd">    gateheight(callback=adjust_2)</span>
<span class="sd">    &gt;&gt;&gt; round_(gateheight.value)</span>
<span class="sd">    6.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_has_callback</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">NotImplementedError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">callback</span> <span class="o">:=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;callback&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;When trying to prepare parameter &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">elementphrase</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2"> via a keyword argument, it &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;must be `callback`, and you need to pass a callback function.&quot;</span>
                <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Parameter </span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">elementphrase</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2"> does not allow to &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;combine the `callback` argument with other arguments.&quot;</span>
                <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">callback</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_init_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">init</span> <span class="o">:=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;init_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_callback&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">init</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_callback&quot;</span><span class="p">,</span> <span class="n">do_nothing</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__hydpy__connect_variable2subgroup__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__hydpy__connect_variable2subgroup__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_callback</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">callback</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The currently handled callback function for updating the parameter value.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_callback</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">get</span> <span class="o">:=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;get_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_callback&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">get</span><span class="p">()</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_callback&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@callback</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">],</span> <span class="kc">None</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.cythons</span><span class="w"> </span><span class="kn">import</span> <span class="n">modelutils</span>  <span class="c1"># pylint: disable=import-outside-toplevel</span>

        <span class="k">if</span> <span class="n">set_</span> <span class="o">:=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;set_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_callback&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">cymodule</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">get_callbackcymodule</span><span class="p">(</span>
                <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subpars</span><span class="o">.</span><span class="n">pars</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">parameter</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">callback</span>
            <span class="p">)</span>
            <span class="n">set_</span><span class="p">(</span><span class="n">cymodule</span><span class="o">.</span><span class="n">get_wrapper</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_callback&quot;</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_has_callback</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="nd">@callback</span><span class="o">.</span><span class="n">deleter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">callback</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_has_callback</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_callback</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The fixed value or the value last updated by the callback function.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_callback</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subpars</span><span class="o">.</span><span class="n">pars</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_valueready</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_get_value</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_set_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_callback</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_has_callback</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_set_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="n">value</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">fget</span><span class="o">=</span><span class="n">_get_value</span><span class="p">,</span> <span class="n">fset</span><span class="o">=</span><span class="n">_set_value</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_callback</span><span class="p">:</span>
            <span class="n">callback</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">callback</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">FunctionType</span><span class="p">):</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getsource</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">indent</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">())</span>
                <span class="n">pycode</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="n">indent</span><span class="p">:]</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
                <span class="n">funcname</span> <span class="o">=</span> <span class="n">callback</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pycode</span> <span class="o">=</span> <span class="n">callback</span><span class="o">.</span><span class="n">get_sourcecode</span><span class="p">()</span>
                <span class="n">funcname</span> <span class="o">=</span> <span class="n">callback</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
            <span class="n">varrepr</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">(callback=</span><span class="si">{</span><span class="n">funcname</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">pycode</span><span class="p">,</span> <span class="n">varrepr</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span></div>

</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">HydPy 6.1.5 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">hydpy.core.parametertools</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2013-2025, HydPy Developers.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.2.3.
    </div>
  </body>
</html>