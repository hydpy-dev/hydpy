
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>hydpy.models.lstream.lstream_model &#8212; HydPy 4.0.1 documentation</title>
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/graphviz.css" />
    
    <script id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
    <script src="../../../../_static/jquery.js"></script>
    <script src="../../../../_static/underscore.js"></script>
    <script src="../../../../_static/doctools.js"></script>
    
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">HydPy 4.0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">hydpy.models.lstream.lstream_model</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for hydpy.models.lstream.lstream_model</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># pylint: disable=missing-docstring</span>
<span class="c1"># pylint: enable=missing-docstring</span>

<span class="c1"># import...</span>
<span class="c1"># ...from standard library</span>
<span class="kn">import</span> <span class="nn">typing</span>

<span class="c1"># ...from site-packages</span>
<span class="kn">import</span> <span class="nn">numpy</span>

<span class="c1"># ...from HydPy</span>
<span class="kn">from</span> <span class="nn">hydpy.auxs</span> <span class="kn">import</span> <span class="n">roottools</span>
<span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="kn">import</span> <span class="n">exceptiontools</span>
<span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="kn">import</span> <span class="n">modeltools</span>
<span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="kn">import</span> <span class="n">objecttools</span>
<span class="kn">from</span> <span class="nn">hydpy.cythons</span> <span class="kn">import</span> <span class="n">smoothutils</span>
<span class="kn">from</span> <span class="nn">hydpy.models.lstream</span> <span class="kn">import</span> <span class="n">lstream_control</span>
<span class="kn">from</span> <span class="nn">hydpy.models.lstream</span> <span class="kn">import</span> <span class="n">lstream_derived</span>
<span class="kn">from</span> <span class="nn">hydpy.models.lstream</span> <span class="kn">import</span> <span class="n">lstream_fixed</span>
<span class="kn">from</span> <span class="nn">hydpy.models.lstream</span> <span class="kn">import</span> <span class="n">lstream_solver</span>
<span class="kn">from</span> <span class="nn">hydpy.models.lstream</span> <span class="kn">import</span> <span class="n">lstream_fluxes</span>
<span class="kn">from</span> <span class="nn">hydpy.models.lstream</span> <span class="kn">import</span> <span class="n">lstream_states</span>
<span class="kn">from</span> <span class="nn">hydpy.models.lstream</span> <span class="kn">import</span> <span class="n">lstream_aides</span>
<span class="kn">from</span> <span class="nn">hydpy.models.lstream</span> <span class="kn">import</span> <span class="n">lstream_inlets</span>
<span class="kn">from</span> <span class="nn">hydpy.models.lstream</span> <span class="kn">import</span> <span class="n">lstream_outlets</span>

<span class="k">if</span> <span class="n">typing</span><span class="o">.</span><span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">pyplot</span> <span class="o">=</span> <span class="n">exceptiontools</span><span class="o">.</span><span class="n">OptionalImport</span><span class="p">(</span><span class="s2">&quot;pyplot&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;matplotlib.pyplot&quot;</span><span class="p">],</span> <span class="nb">locals</span><span class="p">())</span>


<div class="viewcode-block" id="Pick_Q_V1"><a class="viewcode-back" href="../../../../lstream.html#hydpy.models.lstream.lstream_model.Pick_Q_V1">[docs]</a><span class="k">class</span> <span class="nc">Pick_Q_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Query the current inflow from all inlet nodes.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`QZ = \\sum Q`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_inlets</span><span class="o">.</span><span class="n">Q</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_fluxes</span><span class="o">.</span><span class="n">QZ</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">inl</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">inlets</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">qz</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">inl</span><span class="o">.</span><span class="n">len_q</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">qz</span> <span class="o">+=</span> <span class="n">inl</span><span class="o">.</span><span class="n">q</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span></div>


<div class="viewcode-block" id="Calc_QZA_V1"><a class="viewcode-back" href="../../../../lstream.html#hydpy.models.lstream.lstream_model.Calc_QZA_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_QZA_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the current inflow into the channel.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`QZA = QZ`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_fluxes</span><span class="o">.</span><span class="n">QZ</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_fluxes</span><span class="o">.</span><span class="n">QZA</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">qza</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">qz</span></div>


<div class="viewcode-block" id="Calc_RHM_V1"><a class="viewcode-back" href="../../../../lstream.html#hydpy.models.lstream.lstream_model.Calc_RHM_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_RHM_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Regularise the stage with respect to the channel bottom.</span>

<span class="sd">    Used auxiliary method:</span>
<span class="sd">      |smooth_logistic2|</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`RHM = smooth_{logistic2}(H, HRP)`</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lstream import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; gts(5)</span>
<span class="sd">        &gt;&gt;&gt; states.h = -1.0, -0.1, 0.0, 0.1, 1.0</span>

<span class="sd">        &gt;&gt;&gt; hr(0.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.hrp.update()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhm_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.rhm</span>
<span class="sd">        rhm(0.0, 0.0, 0.0, 0.1, 1.0)</span>

<span class="sd">        &gt;&gt;&gt; hr(0.1)</span>
<span class="sd">        &gt;&gt;&gt; derived.hrp.update()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhm_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.rhm</span>
<span class="sd">        rhm(0.0, 0.01, 0.040983, 0.11, 1.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_control</span><span class="o">.</span><span class="n">GTS</span><span class="p">,)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_derived</span><span class="o">.</span><span class="n">HRP</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_states</span><span class="o">.</span><span class="n">H</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHM</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">gts</span><span class="p">):</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">rhm</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">smoothutils</span><span class="o">.</span><span class="n">smooth_logistic2</span><span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">der</span><span class="o">.</span><span class="n">hrp</span><span class="p">)</span></div>


<div class="viewcode-block" id="Calc_RHMDH_V1"><a class="viewcode-back" href="../../../../lstream.html#hydpy.models.lstream.lstream_model.Calc_RHMDH_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_RHMDH_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the derivative of the stage regularised with respect</span>
<span class="sd">    to the channel bottom.</span>

<span class="sd">    Used auxiliary method:</span>
<span class="sd">      |smooth_logistic2_derivative2|</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`RHMDH = smooth_{logistic2&#39;}(H, HRP)`</span>

<span class="sd">    Examples:</span>

<span class="sd">        We apply the class |NumericalDifferentiator| to validate the</span>
<span class="sd">        calculated derivatives:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lstream import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; gts(5)</span>
<span class="sd">        &gt;&gt;&gt; states.h = -1.0, -0.1, 0.0, 0.1, 1.0</span>

<span class="sd">        &gt;&gt;&gt; hr(0.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.hrp.update()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhmdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.rhmdh</span>
<span class="sd">        rhmdh(0.0, 0.0, 1.0, 1.0, 1.0)</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import NumericalDifferentiator</span>
<span class="sd">        &gt;&gt;&gt; numdiff = NumericalDifferentiator(</span>
<span class="sd">        ...     xsequence=states.h,</span>
<span class="sd">        ...     ysequences=[aides.rhm],</span>
<span class="sd">        ...     methods=[model.calc_rhm_v1])</span>
<span class="sd">        &gt;&gt;&gt; numdiff()</span>
<span class="sd">        d_rhm/d_h: 0.0, 0.0, 1.0, 1.0, 1.0</span>

<span class="sd">        &gt;&gt;&gt; hr(0.1)</span>
<span class="sd">        &gt;&gt;&gt; derived.hrp.update()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhmdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.rhmdh</span>
<span class="sd">        rhmdh(0.0, 0.155602, 0.5, 0.844398, 1.0)</span>

<span class="sd">        &gt;&gt;&gt; numdiff()</span>
<span class="sd">        d_rhm/d_h: 0.0, 0.155602, 0.5, 0.844398, 1.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_control</span><span class="o">.</span><span class="n">GTS</span><span class="p">,)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_derived</span><span class="o">.</span><span class="n">HRP</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_states</span><span class="o">.</span><span class="n">H</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHMDH</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">gts</span><span class="p">):</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">rhmdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">smoothutils</span><span class="o">.</span><span class="n">smooth_logistic2_derivative2</span><span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">der</span><span class="o">.</span><span class="n">hrp</span><span class="p">)</span></div>


<div class="viewcode-block" id="Calc_RHV_V1"><a class="viewcode-back" href="../../../../lstream.html#hydpy.models.lstream.lstream_model.Calc_RHV_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_RHV_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Regularise the stage with respect to the transition from the</span>
<span class="sd">    main channel to both forelands.</span>

<span class="sd">    Used auxiliary method:</span>
<span class="sd">      |smooth_logistic2|</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`RHV = smooth_{logistic2}(H-HM, HRP)`</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lstream import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; gts(5)</span>
<span class="sd">        &gt;&gt;&gt; hm(1.0)</span>
<span class="sd">        &gt;&gt;&gt; hr(0.1)</span>
<span class="sd">        &gt;&gt;&gt; derived.hrp.update()</span>
<span class="sd">        &gt;&gt;&gt; states.h = 0.0, 0.9, 1.0, 1.1, 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhv_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.rhv</span>
<span class="sd">        rhv(0.0, 0.01, 0.040983, 0.11, 1.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_control</span><span class="o">.</span><span class="n">GTS</span><span class="p">,</span>
        <span class="n">lstream_control</span><span class="o">.</span><span class="n">HM</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_derived</span><span class="o">.</span><span class="n">HRP</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_states</span><span class="o">.</span><span class="n">H</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHV</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">gts</span><span class="p">):</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">rhv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">smoothutils</span><span class="o">.</span><span class="n">smooth_logistic2</span><span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">hm</span><span class="p">,</span> <span class="n">der</span><span class="o">.</span><span class="n">hrp</span><span class="p">)</span></div>


<div class="viewcode-block" id="Calc_RHVDH_V1"><a class="viewcode-back" href="../../../../lstream.html#hydpy.models.lstream.lstream_model.Calc_RHVDH_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_RHVDH_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the derivative of the stage regularised with respect</span>
<span class="sd">    to the transition from the main channel to both forelands.</span>

<span class="sd">    Used auxiliary method:</span>
<span class="sd">      |smooth_logistic2_derivative2|</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`RHVDH = smooth_{logistic2&#39;}(H-HM, HRP)`</span>

<span class="sd">    Examples:</span>

<span class="sd">        We apply the class |NumericalDifferentiator| to validate the</span>
<span class="sd">        calculated derivatives:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lstream import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; gts(5)</span>
<span class="sd">        &gt;&gt;&gt; hm(1.0)</span>
<span class="sd">        &gt;&gt;&gt; states.h = 0.0, 0.9, 1.0, 1.1, 2.0</span>

<span class="sd">        &gt;&gt;&gt; hr(0.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.hrp.update()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhvdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.rhvdh</span>
<span class="sd">        rhvdh(0.0, 0.0, 1.0, 1.0, 1.0)</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import NumericalDifferentiator</span>
<span class="sd">        &gt;&gt;&gt; numdiff = NumericalDifferentiator(</span>
<span class="sd">        ...     xsequence=states.h,</span>
<span class="sd">        ...     ysequences=[aides.rhv],</span>
<span class="sd">        ...     methods=[model.calc_rhv_v1])</span>
<span class="sd">        &gt;&gt;&gt; numdiff()</span>
<span class="sd">        d_rhv/d_h: 0.0, 0.0, 1.0, 1.0, 1.0</span>

<span class="sd">        &gt;&gt;&gt; hr(0.1)</span>
<span class="sd">        &gt;&gt;&gt; derived.hrp.update()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhvdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.rhvdh</span>
<span class="sd">        rhvdh(0.0, 0.155602, 0.5, 0.844398, 1.0)</span>

<span class="sd">        &gt;&gt;&gt; numdiff()</span>
<span class="sd">        d_rhv/d_h: 0.0, 0.155602, 0.5, 0.844398, 1.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_control</span><span class="o">.</span><span class="n">GTS</span><span class="p">,</span>
        <span class="n">lstream_control</span><span class="o">.</span><span class="n">HM</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_derived</span><span class="o">.</span><span class="n">HRP</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_states</span><span class="o">.</span><span class="n">H</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHVDH</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">gts</span><span class="p">):</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">rhvdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">smoothutils</span><span class="o">.</span><span class="n">smooth_logistic2_derivative2</span><span class="p">(</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">hm</span><span class="p">,</span> <span class="n">der</span><span class="o">.</span><span class="n">hrp</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="Calc_RHLVR_RHRVR_V1"><a class="viewcode-back" href="../../../../lstream.html#hydpy.models.lstream.lstream_model.Calc_RHLVR_RHRVR_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_RHLVR_RHRVR_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Regularise the stage with respect to the transitions from the</span>
<span class="sd">    forelands to the outer embankments.</span>

<span class="sd">    Used auxiliary method:</span>
<span class="sd">      |smooth_logistic2|</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`RHVR = smooth_{logistic2}(H-HM-HV, HRP)`</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lstream import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; gts(6)</span>
<span class="sd">        &gt;&gt;&gt; hm(1.0)</span>
<span class="sd">        &gt;&gt;&gt; hr(0.1)</span>
<span class="sd">        &gt;&gt;&gt; derived.hv(left=1.0, right=1.1)</span>
<span class="sd">        &gt;&gt;&gt; derived.hrp.update()</span>
<span class="sd">        &gt;&gt;&gt; states.h = 1.0, 1.9, 2.0, 2.1, 2.2, 3.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhlvr_rhrvr_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.rhlvr</span>
<span class="sd">        rhlvr(0.0, 0.01, 0.040983, 0.11, 0.201974, 1.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.rhrvr</span>
<span class="sd">        rhrvr(0.0, 0.001974, 0.01, 0.040983, 0.11, 0.9)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_control</span><span class="o">.</span><span class="n">GTS</span><span class="p">,</span>
        <span class="n">lstream_control</span><span class="o">.</span><span class="n">HM</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_derived</span><span class="o">.</span><span class="n">HV</span><span class="p">,</span>
        <span class="n">lstream_derived</span><span class="o">.</span><span class="n">HRP</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_states</span><span class="o">.</span><span class="n">H</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHLVR</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHRVR</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">gts</span><span class="p">):</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">rhlvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">smoothutils</span><span class="o">.</span><span class="n">smooth_logistic2</span><span class="p">(</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">hm</span> <span class="o">-</span> <span class="n">der</span><span class="o">.</span><span class="n">hv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">der</span><span class="o">.</span><span class="n">hrp</span>
            <span class="p">)</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">rhrvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">smoothutils</span><span class="o">.</span><span class="n">smooth_logistic2</span><span class="p">(</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">hm</span> <span class="o">-</span> <span class="n">der</span><span class="o">.</span><span class="n">hv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">der</span><span class="o">.</span><span class="n">hrp</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="Calc_RHLVRDH_RHRVRDH_V1"><a class="viewcode-back" href="../../../../lstream.html#hydpy.models.lstream.lstream_model.Calc_RHLVRDH_RHRVRDH_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_RHLVRDH_RHRVRDH_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the derivative of the stage regularised with respect</span>
<span class="sd">    to the transition from the forelands to the outer embankments.</span>

<span class="sd">    Used auxiliary method:</span>
<span class="sd">      |smooth_logistic2_derivative2|</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`RHVDH = smooth_{logistic2&#39;}(H-HM-HV, HRP)`</span>

<span class="sd">    Examples:</span>

<span class="sd">        We apply the class |NumericalDifferentiator| to validate the</span>
<span class="sd">        calculated derivatives:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lstream import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; gts(8)</span>
<span class="sd">        &gt;&gt;&gt; hm(1.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.hv(left=1.0, right=2.0)</span>
<span class="sd">        &gt;&gt;&gt; states.h = 1.0, 1.9, 2.0, 2.1, 2.9, 3.0, 3.1, 4.0</span>

<span class="sd">        &gt;&gt;&gt; hr(0.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.hrp.update()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhlvrdh_rhrvrdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.rhlvrdh</span>
<span class="sd">        rhlvrdh(0.0, 0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.rhrvrdh</span>
<span class="sd">        rhrvrdh(0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 1.0, 1.0)</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import NumericalDifferentiator</span>
<span class="sd">        &gt;&gt;&gt; numdiff = NumericalDifferentiator(</span>
<span class="sd">        ...     xsequence=states.h,</span>
<span class="sd">        ...     ysequences=[aides.rhlvr, aides.rhrvr],</span>
<span class="sd">        ...     methods=[model.calc_rhlvr_rhrvr_v1])</span>
<span class="sd">        &gt;&gt;&gt; numdiff()</span>
<span class="sd">        d_rhlvr/d_h: 0.0, 0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0</span>
<span class="sd">        d_rhrvr/d_h: 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 1.0, 1.0</span>

<span class="sd">        &gt;&gt;&gt; hr(0.1)</span>
<span class="sd">        &gt;&gt;&gt; derived.hrp.update()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhlvrdh_rhrvrdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.rhlvrdh</span>
<span class="sd">        rhlvrdh(0.0, 0.155602, 0.5, 0.844398, 1.0, 1.0, 1.0, 1.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.rhrvrdh</span>
<span class="sd">        rhrvrdh(0.0, 0.0, 0.0, 0.0, 0.155602, 0.5, 0.844398, 1.0)</span>

<span class="sd">        &gt;&gt;&gt; numdiff()</span>
<span class="sd">        d_rhlvr/d_h: 0.0, 0.155602, 0.5, 0.844398, 1.0, 1.0, 1.0, 1.0</span>
<span class="sd">        d_rhrvr/d_h: 0.0, 0.0, 0.0, 0.0, 0.155602, 0.5, 0.844398, 1.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_control</span><span class="o">.</span><span class="n">GTS</span><span class="p">,</span>
        <span class="n">lstream_control</span><span class="o">.</span><span class="n">HM</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_derived</span><span class="o">.</span><span class="n">HRP</span><span class="p">,</span>
        <span class="n">lstream_derived</span><span class="o">.</span><span class="n">HV</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_states</span><span class="o">.</span><span class="n">H</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHLVRDH</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHRVRDH</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">gts</span><span class="p">):</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">rhlvrdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">smoothutils</span><span class="o">.</span><span class="n">smooth_logistic2_derivative2</span><span class="p">(</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">hm</span> <span class="o">-</span> <span class="n">der</span><span class="o">.</span><span class="n">hv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">der</span><span class="o">.</span><span class="n">hrp</span>
            <span class="p">)</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">rhrvrdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">smoothutils</span><span class="o">.</span><span class="n">smooth_logistic2_derivative2</span><span class="p">(</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">hm</span> <span class="o">-</span> <span class="n">der</span><span class="o">.</span><span class="n">hv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">der</span><span class="o">.</span><span class="n">hrp</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="Calc_AM_UM_V1"><a class="viewcode-back" href="../../../../lstream.html#hydpy.models.lstream.lstream_model.Calc_AM_UM_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_AM_UM_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the wetted area and the wetted perimeter of the main channel.</span>

<span class="sd">    The main channel is assumed to have identical slopes on both sides.</span>
<span class="sd">    Water flowing exactly above the main channel is contributing to |AM|.</span>
<span class="sd">    Both theoretical surfaces separating the water above the main channel</span>
<span class="sd">    from the water above the forelands are contributing to |UM|.</span>

<span class="sd">    Examples:</span>

<span class="sd">        Generally, a trapezoid with reflection symmetry is assumed.  Here,</span>
<span class="sd">        we set its smaller base (bottom) to a length of 2 meters, its legs</span>
<span class="sd">        to an inclination of 1 meter per 4 meters, and its height (depths)</span>
<span class="sd">        to 1 meter:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lstream import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; gts(8)</span>
<span class="sd">        &gt;&gt;&gt; bm(2.0)</span>
<span class="sd">        &gt;&gt;&gt; bnm(4.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.bnmf.update()</span>

<span class="sd">        First, we show that all calculations agree with the unmodified</span>
<span class="sd">        triple trapezoid profile results when setting the smoothing</span>
<span class="sd">        parameter |HRP| to zero:</span>

<span class="sd">        &gt;&gt;&gt; derived.hrp(0)</span>

<span class="sd">        This example deals with normal flow conditions, where water flows</span>
<span class="sd">        within the main channel completely (|H| &lt; |HM|, the first five</span>
<span class="sd">        channel sections), and with high flow conditions, where water</span>
<span class="sd">        flows over the foreland also (|H| &gt; |HM|, the three last channel</span>
<span class="sd">        sections):</span>

<span class="sd">        &gt;&gt;&gt; hm(1.0)</span>
<span class="sd">        &gt;&gt;&gt; states.h = 0.0, 0.1, 0.5, 0.9, 1.0, 1.1, 1.5, 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhm_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhv_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_am_um_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.am</span>
<span class="sd">        am(0.0, 0.24, 2.0, 5.04, 6.0, 7.0, 11.0, 16.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.um</span>
<span class="sd">        um(2.0, 2.824621, 6.123106, 9.42159, 10.246211, 10.446211, 11.246211,</span>
<span class="sd">           12.246211)</span>

<span class="sd">        The next example checks the special case of a channel with zero height:</span>

<span class="sd">        &gt;&gt;&gt; hm(0.0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhm_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhv_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_am_um_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.am</span>
<span class="sd">        am(0.0, 0.2, 1.0, 1.8, 2.0, 2.2, 3.0, 4.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.um</span>
<span class="sd">        um(2.0, 2.2, 3.0, 3.8, 4.0, 4.2, 5.0, 6.0)</span>

<span class="sd">        Second, we repeat both examples with a reasonable smoothing</span>
<span class="sd">        parameterisation.  As to be expected, the primary deviations occur</span>
<span class="sd">        around the original discontinuities related the channel bottom</span>
<span class="sd">        and the transition from the main channel to both forelands:</span>

<span class="sd">        &gt;&gt;&gt; hr(0.1)</span>
<span class="sd">        &gt;&gt;&gt; derived.hrp.update()</span>

<span class="sd">        &gt;&gt;&gt; hm(1.0)</span>
<span class="sd">        &gt;&gt;&gt; states.h = 0.0, 0.1, 0.5, 0.9, 1.0, 1.1, 1.5, 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhm_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhv_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_am_um_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.am</span>
<span class="sd">        am(0.088684, 0.2684, 2.000075, 5.0396, 5.993282, 6.9916, 10.99995, 16.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.um</span>
<span class="sd">        um(2.337952, 2.907083, 6.123131, 9.359128, 9.990225, 10.383749,</span>
<span class="sd">           11.246133, 12.246211)</span>

<span class="sd">        &gt;&gt;&gt; hm(0.0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhm_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhv_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_am_um_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.am</span>
<span class="sd">        am(0.081965, 0.22, 1.000025, 1.8, 2.0, 2.2, 3.0, 4.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.um</span>
<span class="sd">        um(2.081965, 2.22, 3.000025, 3.8, 4.0, 4.2, 5.0, 6.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_control</span><span class="o">.</span><span class="n">GTS</span><span class="p">,</span>
        <span class="n">lstream_control</span><span class="o">.</span><span class="n">BM</span><span class="p">,</span>
        <span class="n">lstream_control</span><span class="o">.</span><span class="n">BNM</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_derived</span><span class="o">.</span><span class="n">BNMF</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHM</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHV</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">AM</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">UM</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">gts</span><span class="p">):</span>
            <span class="n">d_temp</span> <span class="o">=</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhm</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">am</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">d_temp</span> <span class="o">*</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">bm</span> <span class="o">+</span> <span class="n">d_temp</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">bnm</span><span class="p">)</span> <span class="o">+</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span>
                <span class="n">con</span><span class="o">.</span><span class="n">bm</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">d_temp</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">bnm</span>
            <span class="p">)</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">um</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">bm</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">d_temp</span> <span class="o">*</span> <span class="n">der</span><span class="o">.</span><span class="n">bnmf</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></div>


<div class="viewcode-block" id="Calc_AMDH_UMDH_V1"><a class="viewcode-back" href="../../../../lstream.html#hydpy.models.lstream.lstream_model.Calc_AMDH_UMDH_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_AMDH_UMDH_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the derivatives of the wetted area and  perimeter of</span>
<span class="sd">    the main channel.</span>

<span class="sd">    Examples:</span>

<span class="sd">        In the following, we repeat the examples of the documentation on</span>
<span class="sd">        method |Calc_AM_UM_V1| and check the correctness of the derivatives</span>
<span class="sd">        by comparing the results of class |NumericalDifferentiator|:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lstream import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; gts(8)</span>
<span class="sd">        &gt;&gt;&gt; bm(2.0)</span>
<span class="sd">        &gt;&gt;&gt; bnm(4.0)</span>

<span class="sd">        &gt;&gt;&gt; derived.bnmf.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.hrp(0)</span>

<span class="sd">        &gt;&gt;&gt; hm(1.0)</span>
<span class="sd">        &gt;&gt;&gt; states.h = 0.0, 0.1, 0.5, 0.9, 1.0, 1.1, 1.5, 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhm_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhmdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhv_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhvdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_amdh_umdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.amdh</span>
<span class="sd">        amdh(2.0, 2.8, 6.0, 9.2, 10.0, 10.0, 10.0, 10.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.umdh</span>
<span class="sd">        umdh(8.246211, 8.246211, 8.246211, 8.246211, 2.0, 2.0, 2.0, 2.0)</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import NumericalDifferentiator</span>
<span class="sd">        &gt;&gt;&gt; numdiff = NumericalDifferentiator(</span>
<span class="sd">        ...     xsequence=states.h,</span>
<span class="sd">        ...     ysequences=[aides.am, aides.um],</span>
<span class="sd">        ...     methods=[model.calc_rhm_v1,</span>
<span class="sd">        ...              model.calc_rhv_v1,</span>
<span class="sd">        ...              model.calc_am_um_v1])</span>
<span class="sd">        &gt;&gt;&gt; numdiff()</span>
<span class="sd">        d_am/d_h: 2.0, 2.8, 6.0, 9.2, 10.0, 10.0, 10.0, 10.0</span>
<span class="sd">        d_um/d_h: 8.246211, 8.246211, 8.246211, 8.246211, 2.0, 2.0, 2.0, 2.0</span>

<span class="sd">        &gt;&gt;&gt; hm(0.0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhm_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhmdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhv_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhvdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_amdh_umdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.amdh</span>
<span class="sd">        amdh(2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.umdh</span>
<span class="sd">        umdh(2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0)</span>
<span class="sd">        &gt;&gt;&gt; numdiff()</span>
<span class="sd">        d_am/d_h: 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0</span>
<span class="sd">        d_um/d_h: 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0</span>

<span class="sd">        &gt;&gt;&gt; hr(0.1)</span>
<span class="sd">        &gt;&gt;&gt; derived.hrp.update()</span>

<span class="sd">        &gt;&gt;&gt; hm(1.0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhm_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhmdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhv_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhvdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_amdh_umdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.amdh</span>
<span class="sd">        amdh(1.163931, 2.431865, 5.998826, 9.18755, 9.836069, 10.05693,</span>
<span class="sd">             10.000749, 10.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.umdh</span>
<span class="sd">        umdh(4.123105, 6.963079, 8.243132, 7.274283, 5.123105, 2.971926,</span>
<span class="sd">             2.001327, 2.0)</span>

<span class="sd">        &gt;&gt;&gt; numdiff()</span>
<span class="sd">        d_am/d_h: 1.163931, 2.431865, 5.998826, 9.18755, 9.836069, 10.05693, \</span>
<span class="sd">10.000749, 10.0</span>
<span class="sd">        d_um/d_h: 4.123105, 6.963079, 8.243132, 7.274283, 5.123105, 2.971926, \</span>
<span class="sd">2.001327, 2.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_control</span><span class="o">.</span><span class="n">GTS</span><span class="p">,</span>
        <span class="n">lstream_control</span><span class="o">.</span><span class="n">BM</span><span class="p">,</span>
        <span class="n">lstream_control</span><span class="o">.</span><span class="n">BNM</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_derived</span><span class="o">.</span><span class="n">BNMF</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHM</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHMDH</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHV</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHVDH</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">AMDH</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">UMDH</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">gts</span><span class="p">):</span>
            <span class="n">d_temp1</span> <span class="o">=</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhm</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">d_temp2</span> <span class="o">=</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhmdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhvdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">amdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">con</span><span class="o">.</span><span class="n">bnm</span> <span class="o">*</span> <span class="n">d_temp1</span> <span class="o">*</span> <span class="n">d_temp2</span>
                <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">bnm</span> <span class="o">*</span> <span class="n">d_temp2</span> <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="o">+</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">bm</span> <span class="o">+</span> <span class="n">con</span><span class="o">.</span><span class="n">bnm</span> <span class="o">*</span> <span class="n">d_temp1</span><span class="p">)</span> <span class="o">*</span> <span class="n">d_temp2</span>
                <span class="o">+</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">bm</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">bnm</span> <span class="o">*</span> <span class="n">d_temp1</span><span class="p">)</span> <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhvdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">umdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">d_temp2</span> <span class="o">*</span> <span class="n">der</span><span class="o">.</span><span class="n">bnmf</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhvdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></div>


<div class="viewcode-block" id="Calc_ALV_ARV_ULV_URV_V1"><a class="viewcode-back" href="../../../../lstream.html#hydpy.models.lstream.lstream_model.Calc_ALV_ARV_ULV_URV_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_ALV_ARV_ULV_URV_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the wetted area and wetted perimeter of both forelands.</span>

<span class="sd">    Each foreland lies between the main channel and one outer embankment.</span>
<span class="sd">    The water flowing exactly above a foreland is contributing to |ALV|</span>
<span class="sd">    or |ARV|.  The theoretical surface separating the water above the main</span>
<span class="sd">    channel from the water above the foreland is not contributing to |ULV|</span>
<span class="sd">    or |URV|, but the surface separating the water above the foreland from</span>
<span class="sd">    the water above its outer embankment is contributing to |ULV| and |URV|.</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lstream import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; gts(14)</span>
<span class="sd">        &gt;&gt;&gt; hm(1.0)</span>

<span class="sd">        First, we show that all calculations agree with the unmodified</span>
<span class="sd">        triple trapezoid profile results when setting the smoothing</span>
<span class="sd">        parameter |HRP| to zero:</span>

<span class="sd">        &gt;&gt;&gt; derived.hrp(0)</span>

<span class="sd">        This example deals with normal flow conditions, where water flows</span>
<span class="sd">        within the main channel completely (|H| &lt; |HM|, the first four channel</span>
<span class="sd">        sections); with moderate high flow conditions, where water flows over</span>
<span class="sd">        both forelands, but not over their embankments (|HM| &lt; |H| &lt; (|HM| +</span>
<span class="sd">        |HV|), channel sections six to eight or twelve for the left and the</span>
<span class="sd">        right foreland, respectively), and with extreme high flow conditions,</span>
<span class="sd">        where water flows over both forelands and their outer embankments</span>
<span class="sd">        ((|HM| + |HV|) &lt; |H|, the last six or two channel sections for the</span>
<span class="sd">        left and the right foreland, respectively):</span>

<span class="sd">        &gt;&gt;&gt; bv(left=2.0, right=3.0)</span>
<span class="sd">        &gt;&gt;&gt; bnv(left=4.0, right=5.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.bnvf.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.hv(left=1.0, right=2.0)</span>

<span class="sd">        &gt;&gt;&gt; states.h = (0.0, 0.5, 0.9, 1.0, 1.1, 1.5, 1.9,</span>
<span class="sd">        ...             2.0, 2.1, 2.5, 2.9, 3.0, 3.1, 4.0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhm_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhv_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhlvr_rhrvr_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_alv_arv_ulv_urv_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.alv</span>
<span class="sd">        alv(0.0, 0.0, 0.0, 0.0, 0.22, 1.5, 3.42, 4.0, 4.6, 7.0, 9.4, 10.0, 10.6,</span>
<span class="sd">            16.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.arv</span>
<span class="sd">        arv(0.0, 0.0, 0.0, 0.0, 0.325, 2.125, 4.725, 5.5, 6.325, 10.125, 14.725,</span>
<span class="sd">            16.0, 17.3, 29.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.ulv</span>
<span class="sd">        ulv(2.0, 2.0, 2.0, 2.0, 2.412311, 4.061553, 5.710795, 6.123106,</span>
<span class="sd">            6.223106, 6.623106, 7.023106, 7.123106, 7.223106, 8.123106)</span>
<span class="sd">        &gt;&gt;&gt; aides.urv</span>
<span class="sd">        urv(3.0, 3.0, 3.0, 3.0, 3.509902, 5.54951, 7.589118, 8.09902, 8.608921,</span>
<span class="sd">            10.648529, 12.688137, 13.198039, 13.298039, 14.198039)</span>

<span class="sd">        The next example proves the correct handling of forelands with zero</span>
<span class="sd">        widths and heights:</span>

<span class="sd">        &gt;&gt;&gt; bv(left=0.0, right=2.0)</span>
<span class="sd">        &gt;&gt;&gt; bnv(4.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.hv(left=1.0, right=0.0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhv_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhlvr_rhrvr_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_alv_arv_ulv_urv_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.alv</span>
<span class="sd">        alv(0.0, 0.0, 0.0, 0.0, 0.02, 0.5, 1.62, 2.0, 2.4, 4.0, 5.6, 6.0, 6.4,</span>
<span class="sd">            10.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.arv</span>
<span class="sd">        arv(0.0, 0.0, 0.0, 0.0, 0.2, 1.0, 1.8, 2.0, 2.2, 3.0, 3.8, 4.0, 4.2, \</span>
<span class="sd">6.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.ulv</span>
<span class="sd">        ulv(0.0, 0.0, 0.0, 0.0, 0.412311, 2.061553, 3.710795, 4.123106,</span>
<span class="sd">            4.223106, 4.623106, 5.023106, 5.123106, 5.223106, 6.123106)</span>
<span class="sd">        &gt;&gt;&gt; aides.urv</span>
<span class="sd">        urv(2.0, 2.0, 2.0, 2.0, 2.1, 2.5, 2.9, 3.0, 3.1, 3.5, 3.9, 4.0, 4.1, \</span>
<span class="sd">5.0)</span>

<span class="sd">        Second, we repeat both examples with a reasonable smoothing</span>
<span class="sd">        parameterisation.  As to be expected, the primary deviations occur</span>
<span class="sd">        around the original discontinuities related the channel bottom</span>
<span class="sd">        and the transition from the main channel to both forelands:</span>

<span class="sd">        &gt;&gt;&gt; hr(0.1)</span>
<span class="sd">        &gt;&gt;&gt; derived.hrp.update()</span>

<span class="sd">        &gt;&gt;&gt; bv(left=2.0, right=3.0)</span>
<span class="sd">        &gt;&gt;&gt; bnv(left=4.0, right=5.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.hv(left=1.0, right=2.0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhv_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhlvr_rhrvr_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_alv_arv_ulv_urv_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.alv</span>
<span class="sd">        alv(0.0, 0.000025, 0.0202, 0.085324, 0.2442, 1.50005, 3.4198, 3.996641,</span>
<span class="sd">            4.5958, 6.999975, 9.4, 10.0, 10.6, 16.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.arv</span>
<span class="sd">        arv(0.0, 0.000038, 0.03025, 0.127147, 0.36025, 2.125069, 4.725, 5.5,</span>
<span class="sd">            6.325, 10.125, 14.72475, 15.995801, 17.29475, 29.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.ulv</span>
<span class="sd">        ulv(2.0, 2.000052, 2.041231, 2.168976, 2.453542, 4.061565, 5.679564,</span>
<span class="sd">            5.995113, 6.191875, 6.623066, 7.023106, 7.123106, 7.223106, \</span>
<span class="sd">8.123106)</span>
<span class="sd">        &gt;&gt;&gt; aides.urv</span>
<span class="sd">        urv(3.0, 3.000064, 3.05099, 3.208971, 3.560892, 5.549574, 7.589118,</span>
<span class="sd">            8.09902, 8.608921, 10.648478, 12.647147, 13.03005, 13.257049,</span>
<span class="sd">            14.198039)</span>

<span class="sd">        &gt;&gt;&gt; bv(left=0.0, right=2.0)</span>
<span class="sd">        &gt;&gt;&gt; bnv(4.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.hv(left=1.0, right=0.0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhm_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhv_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhlvr_rhrvr_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_alv_arv_ulv_urv_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.alv</span>
<span class="sd">        alv(0.0, 0.0, 0.0002, 0.003359, 0.0242, 0.500025, 1.6198, 1.996641,</span>
<span class="sd">            2.3958, 3.999975, 5.6, 6.0, 6.4, 10.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.arv</span>
<span class="sd">        arv(0.0, 0.000025, 0.02, 0.081965, 0.22, 1.000025, 1.8, 2.0, 2.2, 3.0,</span>
<span class="sd">            3.8, 4.0, 4.2, 6.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.ulv</span>
<span class="sd">        ulv(0.0, 0.000052, 0.041231, 0.168976, 0.453542, 2.061565, 3.679564,</span>
<span class="sd">            3.995113, 4.191875, 4.623066, 5.023106, 5.123106, 5.223106, \</span>
<span class="sd">6.123106)</span>
<span class="sd">        &gt;&gt;&gt; aides.urv</span>
<span class="sd">        urv(2.0, 2.000013, 2.01, 2.040983, 2.11, 2.500013, 2.9, 3.0, 3.1, 3.5,</span>
<span class="sd">            3.9, 4.0, 4.1, 5.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_control</span><span class="o">.</span><span class="n">GTS</span><span class="p">,</span>
        <span class="n">lstream_control</span><span class="o">.</span><span class="n">BV</span><span class="p">,</span>
        <span class="n">lstream_control</span><span class="o">.</span><span class="n">BNV</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_derived</span><span class="o">.</span><span class="n">BNVF</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHV</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHLVR</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHRVR</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">ALV</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">ARV</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">ULV</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">URV</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">gts</span><span class="p">):</span>
            <span class="n">d_temp</span> <span class="o">=</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhlvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">alv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">d_temp</span> <span class="o">*</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">bv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">d_temp</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">bnv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">))</span> <span class="o">+</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhlvr</span><span class="p">[</span>
                <span class="n">i</span>
            <span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">bv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">d_temp</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">bnv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">ulv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">bv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">d_temp</span> <span class="o">*</span> <span class="n">der</span><span class="o">.</span><span class="n">bnvf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhlvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">d_temp</span> <span class="o">=</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhrvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">arv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">d_temp</span> <span class="o">*</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">bv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">d_temp</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">bnv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">))</span> <span class="o">+</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhrvr</span><span class="p">[</span>
                <span class="n">i</span>
            <span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">bv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">d_temp</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">bnv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">urv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">bv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">d_temp</span> <span class="o">*</span> <span class="n">der</span><span class="o">.</span><span class="n">bnvf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhrvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></div>


<div class="viewcode-block" id="Calc_ALVDH_ARVDH_ULVDH_URVDH_V1"><a class="viewcode-back" href="../../../../lstream.html#hydpy.models.lstream.lstream_model.Calc_ALVDH_ARVDH_ULVDH_URVDH_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_ALVDH_ARVDH_ULVDH_URVDH_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the derivatives of the wetted area and perimeter of</span>
<span class="sd">    both forelands.</span>

<span class="sd">    Examples:</span>

<span class="sd">        In the following, we repeat the examples of the documentation on</span>
<span class="sd">        method |Calc_ALV_ARV_ULV_URV_V1| and check the correctness of the</span>
<span class="sd">        derivatives by comparing the results of class |NumericalDifferentiator|:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lstream import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; gts(13)</span>
<span class="sd">        &gt;&gt;&gt; hm(1.0)</span>
<span class="sd">        &gt;&gt;&gt; bv(left=2.0, right=3.0)</span>
<span class="sd">        &gt;&gt;&gt; bnv(left=4.0, right=5.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.bnvf.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.hv(left=1.0, right=2.0)</span>

<span class="sd">        &gt;&gt;&gt; derived.hrp(0)</span>

<span class="sd">        &gt;&gt;&gt; states.h = (1.0, 1.5, 1.9, 2.0, 2.1, 2.5, 3.0,</span>
<span class="sd">        ...             3.5, 3.9, 4.0, 4.1, 4.5, 5.0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhv_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhvdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhlvr_rhrvr_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhlvrdh_rhrvrdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_alvdh_arvdh_ulvdh_urvdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.alvdh</span>
<span class="sd">        alvdh(2.0, 4.0, 5.6, 6.0, 6.0, 6.0, 6.0, 6.0, 6.0, 6.0, 6.0, 6.0, 6.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.arvdh</span>
<span class="sd">        arvdh(3.0, 5.5, 7.5, 8.0, 8.5, 10.5, 13.0, 13.0, 13.0, 13.0, 13.0, 13.0,</span>
<span class="sd">              13.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.ulvdh</span>
<span class="sd">        ulvdh(4.123106, 4.123106, 4.123106, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,</span>
<span class="sd">              1.0, 1.0, 1.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.urvdh</span>
<span class="sd">        urvdh(5.09902, 5.09902, 5.09902, 5.09902, 5.09902, 5.09902, 1.0, 1.0,</span>
<span class="sd">              1.0, 1.0, 1.0, 1.0, 1.0)</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import NumericalDifferentiator</span>
<span class="sd">        &gt;&gt;&gt; numdiff = NumericalDifferentiator(</span>
<span class="sd">        ...     xsequence=states.h,</span>
<span class="sd">        ...     ysequences=[aides.alv, aides.arv, aides.ulv, aides.urv],</span>
<span class="sd">        ...     methods=[model.calc_rhv_v1,</span>
<span class="sd">        ...              model.calc_rhlvr_rhrvr_v1,</span>
<span class="sd">        ...              model.calc_alv_arv_ulv_urv_v1])</span>
<span class="sd">        &gt;&gt;&gt; numdiff()</span>
<span class="sd">        d_alv/d_h: 2.0, 4.0, 5.6, 6.0, 6.0, 6.0, 6.0, 6.0, 6.0, 6.0, 6.0, 6.0, \</span>
<span class="sd">6.0</span>
<span class="sd">        d_arv/d_h: 3.0, 5.5, 7.5, 8.0, 8.5, 10.5, 13.0, 13.0, 13.0, 13.0, \</span>
<span class="sd">13.0, 13.0, 13.0</span>
<span class="sd">        d_ulv/d_h: 4.123106, 4.123106, 4.123106, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, \</span>
<span class="sd">1.0, 1.0, 1.0, 1.0</span>
<span class="sd">        d_urv/d_h: 5.09902, 5.09902, 5.09902, 5.09902, 5.09902, 5.09902, 1.0, \</span>
<span class="sd">1.0, 1.0, 1.0, 1.0, 1.0, 1.0</span>

<span class="sd">        &gt;&gt;&gt; bv(left=0.0, right=2.0)</span>
<span class="sd">        &gt;&gt;&gt; bnv(4.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.bnvf.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.hv(left=1.0, right=0.0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhv_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhvdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhlvr_rhrvr_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhlvrdh_rhrvrdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_alvdh_arvdh_ulvdh_urvdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.alvdh</span>
<span class="sd">        alvdh(0.0, 2.0, 3.6, 4.0, 4.0, 4.0, 4.0, 4.0, 4.0, 4.0, 4.0, 4.0, 4.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.arvdh</span>
<span class="sd">        arvdh(2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.ulvdh</span>
<span class="sd">        ulvdh(4.123106, 4.123106, 4.123106, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,</span>
<span class="sd">              1.0, 1.0, 1.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.urvdh</span>
<span class="sd">        urvdh(1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0)</span>
<span class="sd">        &gt;&gt;&gt; numdiff()</span>
<span class="sd">        d_alv/d_h: 0.0, 2.0, 3.6, 4.0, 4.0, 4.0, 4.0, 4.0, 4.0, 4.0, 4.0, 4.0, \</span>
<span class="sd">4.0</span>
<span class="sd">        d_arv/d_h: 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, \</span>
<span class="sd">2.0</span>
<span class="sd">        d_ulv/d_h: 4.123106, 4.123106, 4.123106, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, \</span>
<span class="sd">1.0, 1.0, 1.0, 1.0</span>
<span class="sd">        d_urv/d_h: 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, \</span>
<span class="sd">1.0</span>

<span class="sd">        &gt;&gt;&gt; hr(0.1)</span>
<span class="sd">        &gt;&gt;&gt; derived.hrp.update()</span>

<span class="sd">        &gt;&gt;&gt; bv(left=2.0, right=3.0)</span>
<span class="sd">        &gt;&gt;&gt; bnv(left=4.0, right=5.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.bnvf.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.hv(left=1.0, right=2.0)</span>

<span class="sd">        &gt;&gt;&gt; model.calc_rhv_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhvdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhlvr_rhrvr_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhlvrdh_rhrvrdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_alvdh_arvdh_ulvdh_urvdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.alvdh</span>
<span class="sd">        alvdh(1.081965, 3.9992, 5.593775, 5.918034, 6.028465, 6.000375, 6.0,</span>
<span class="sd">              6.0, 6.0, 6.0, 6.0, 6.0, 6.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.arvdh</span>
<span class="sd">        arvdh(1.602457, 5.498894, 7.499998, 8.0, 8.5, 10.5, 12.897543,</span>
<span class="sd">              13.000468, 13.000001, 13.0, 13.0, 13.0, 13.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.ulvdh</span>
<span class="sd">        ulvdh(2.061553, 4.121566, 3.637142, 2.561553, 1.485963, 1.000664, 1.0,</span>
<span class="sd">              1.0, 1.0, 1.0, 1.0, 1.0, 1.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.urvdh</span>
<span class="sd">        urvdh(2.54951, 5.097936, 5.099018, 5.099019, 5.099018, 5.098149,</span>
<span class="sd">              3.04951, 1.000871, 1.000001, 1.0, 1.0, 1.0, 1.0)</span>

<span class="sd">        &gt;&gt;&gt; numdiff()</span>
<span class="sd">        d_alv/d_h: 1.081965, 3.9992, 5.593775, 5.918034, 6.028465, 6.000375, \</span>
<span class="sd">6.0, 6.0, 6.0, 6.0, 6.0, 6.0, 6.0</span>
<span class="sd">        d_arv/d_h: 1.602457, 5.498894, 7.499998, 8.0, 8.5, 10.5, 12.897543, \</span>
<span class="sd">13.000468, 13.000001, 13.0, 13.0, 13.0, 13.0</span>
<span class="sd">        d_ulv/d_h: 2.061553, 4.121566, 3.637142, 2.561553, 1.485963, 1.000664, \</span>
<span class="sd">1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0</span>
<span class="sd">        d_urv/d_h: 2.54951, 5.097936, 5.099018, 5.099019, 5.099018, 5.098149, \</span>
<span class="sd">3.04951, 1.000871, 1.000001, 1.0, 1.0, 1.0, 1.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_control</span><span class="o">.</span><span class="n">GTS</span><span class="p">,</span>
        <span class="n">lstream_control</span><span class="o">.</span><span class="n">BV</span><span class="p">,</span>
        <span class="n">lstream_control</span><span class="o">.</span><span class="n">BNV</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_derived</span><span class="o">.</span><span class="n">BNVF</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHV</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHVDH</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHLVR</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHLVRDH</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHRVR</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHRVRDH</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">ALVDH</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">ARVDH</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">ULVDH</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">URVDH</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">gts</span><span class="p">):</span>
            <span class="n">d_temp1</span> <span class="o">=</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhlvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">d_temp2</span> <span class="o">=</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhvdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhlvrdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">alvdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">con</span><span class="o">.</span><span class="n">bnv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">d_temp1</span> <span class="o">*</span> <span class="n">d_temp2</span> <span class="o">/</span> <span class="mf">2.0</span>
                <span class="o">+</span> <span class="n">con</span><span class="o">.</span><span class="n">bnv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">d_temp2</span> <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhlvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="o">+</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">bnv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">d_temp1</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">con</span><span class="o">.</span><span class="n">bv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">d_temp2</span>
                <span class="o">+</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">bnv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">d_temp1</span> <span class="o">+</span> <span class="n">con</span><span class="o">.</span><span class="n">bv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhlvrdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">ulvdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">d_temp2</span> <span class="o">*</span> <span class="n">der</span><span class="o">.</span><span class="n">bnvf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhlvrdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">d_temp1</span> <span class="o">=</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhrvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">d_temp2</span> <span class="o">=</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhvdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhrvrdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">arvdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">con</span><span class="o">.</span><span class="n">bnv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">d_temp1</span> <span class="o">*</span> <span class="n">d_temp2</span> <span class="o">/</span> <span class="mf">2.0</span>
                <span class="o">+</span> <span class="n">con</span><span class="o">.</span><span class="n">bnv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">d_temp2</span> <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhrvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="o">+</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">bnv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">d_temp1</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">con</span><span class="o">.</span><span class="n">bv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">d_temp2</span>
                <span class="o">+</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">bnv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">d_temp1</span> <span class="o">+</span> <span class="n">con</span><span class="o">.</span><span class="n">bv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhrvrdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">urvdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">d_temp2</span> <span class="o">*</span> <span class="n">der</span><span class="o">.</span><span class="n">bnvf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhrvrdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></div>


<div class="viewcode-block" id="Calc_ALVR_ARVR_ULVR_URVR_V1"><a class="viewcode-back" href="../../../../lstream.html#hydpy.models.lstream.lstream_model.Calc_ALVR_ARVR_ULVR_URVR_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_ALVR_ARVR_ULVR_URVR_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the wetted area and perimeter of both outer embankments.</span>

<span class="sd">    Each outer embankment lies beyond its foreland.  The water flowing</span>
<span class="sd">    exactly above an embankment is added to |ALVR| and |ARVR|.  The</span>
<span class="sd">    theoretical surface separating water above the foreland from the</span>
<span class="sd">    water above its embankment is not contributing to |ULVR| and |URVR|.</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lstream import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; gts(11)</span>
<span class="sd">        &gt;&gt;&gt; hm(1.0)</span>

<span class="sd">        First, we show that all calculations agree with the unmodified</span>
<span class="sd">        triple trapezoid profile results when the setting the smoothing</span>
<span class="sd">        parameter |HRP| to zero:</span>

<span class="sd">        &gt;&gt;&gt; derived.hrp(0)</span>

<span class="sd">        This example deals with moderate high flow conditions, where</span>
<span class="sd">        water flows over the forelands, but not over their outer embankments</span>
<span class="sd">        (|HM| &lt; |H| &lt; (|HM| + |HV|), the first four or eight channel sections</span>
<span class="sd">        for the left and the right outer embankment, respectively); the second</span>
<span class="sd">        example deals with extreme high flow conditions, where water flows</span>
<span class="sd">        both over the foreland and their outer embankments ((|HM| + |HV|) &lt; |H|,</span>
<span class="sd">        the last seven or three channel sections for the left and the right</span>
<span class="sd">        outer embankment, respectively):</span>

<span class="sd">        &gt;&gt;&gt; states.h = 1.0, 1.5, 1.9, 2.0, 2.1, 2.5, 2.9, 3.0, 3.1, 3.5, 4.0</span>
<span class="sd">        &gt;&gt;&gt; bnvr(left=4.0, right=5.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.bnvrf.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.hv(left=1.0, right=2.0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhlvr_rhrvr_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_alvr_arvr_ulvr_urvr_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.alvr</span>
<span class="sd">        alvr(0.0, 0.0, 0.0, 0.0, 0.02, 0.5, 1.62, 2.0, 2.42, 4.5, 8.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.arvr</span>
<span class="sd">        arvr(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.025, 0.625, 2.5)</span>
<span class="sd">        &gt;&gt;&gt; aides.ulvr</span>
<span class="sd">        ulvr(0.0, 0.0, 0.0, 0.0, 0.412311, 2.061553, 3.710795, 4.123106,</span>
<span class="sd">             4.535416, 6.184658, 8.246211)</span>
<span class="sd">        &gt;&gt;&gt; aides.urvr</span>
<span class="sd">        urvr(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.509902, 2.54951, 5.09902)</span>

<span class="sd">        The next example checks the special cases of a vertical outer embankment</span>
<span class="sd">        (left side) and zero-height foreland (right side):</span>

<span class="sd">        &gt;&gt;&gt; bnvr(left=0.0, right=5.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.bnvrf.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.hv(left=1.0, right=0.0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhlvr_rhrvr_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_alvr_arvr_ulvr_urvr_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.alvr</span>
<span class="sd">        alvr(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.arvr</span>
<span class="sd">        arvr(0.0, 0.625, 2.025, 2.5, 3.025, 5.625, 9.025, 10.0, 11.025, 15.625,</span>
<span class="sd">             22.5)</span>
<span class="sd">        &gt;&gt;&gt; aides.ulvr</span>
<span class="sd">        ulvr(0.0, 0.0, 0.0, 0.0, 0.1, 0.5, 0.9, 1.0, 1.1, 1.5, 2.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.urvr</span>
<span class="sd">        urvr(0.0, 2.54951, 4.589118, 5.09902, 5.608921, 7.648529, 9.688137,</span>
<span class="sd">             10.198039, 10.707941, 12.747549, 15.297059)</span>

<span class="sd">        Second, we repeat both examples with a reasonable smoothing</span>
<span class="sd">        parameterisation.  As to be expected, the primary deviations occur</span>
<span class="sd">        around the original discontinuities related the channel bottom</span>
<span class="sd">        and the transition from the main channel to both forelands:</span>

<span class="sd">        &gt;&gt;&gt; hr(0.1)</span>
<span class="sd">        &gt;&gt;&gt; derived.hrp.update()</span>
<span class="sd">        &gt;&gt;&gt; bnvr(left=4.0, right=5.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.bnvrf.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.hv(left=1.0, right=2.0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhlvr_rhrvr_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_alvr_arvr_ulvr_urvr_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.alvr</span>
<span class="sd">        alvr(0.0, 0.0, 0.0002, 0.003359, 0.0242, 0.500025, 1.62, 2.0, 2.42, 4.5,</span>
<span class="sd">             8.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.arvr</span>
<span class="sd">        arvr(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.00025, 0.004199, 0.03025, 0.625031,</span>
<span class="sd">             2.5)</span>
<span class="sd">        &gt;&gt;&gt; aides.ulvr</span>
<span class="sd">        ulvr(0.0, 0.000052, 0.041231, 0.168976, 0.453542, 2.061605, 3.710795,</span>
<span class="sd">             4.123106, 4.535416, 6.184658, 8.246211)</span>
<span class="sd">        &gt;&gt;&gt; aides.urvr</span>
<span class="sd">        urvr(0.0, 0.0, 0.0, 0.0, 0.0, 0.000064, 0.05099, 0.208971, 0.560892,</span>
<span class="sd">             2.549574, 5.09902)</span>

<span class="sd">        &gt;&gt;&gt; bnvr(left=0.0, right=5.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.bnvrf.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.hv(left=1.0, right=0.0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhlvr_rhrvr_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_alvr_arvr_ulvr_urvr_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.alvr</span>
<span class="sd">        alvr(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.arvr</span>
<span class="sd">        arvr(0.004199, 0.625031, 2.025, 2.5, 3.025, 5.625, 9.025, 10.0, 11.025,</span>
<span class="sd">             15.625, 22.5)</span>
<span class="sd">        &gt;&gt;&gt; aides.ulvr</span>
<span class="sd">        ulvr(0.0, 0.000013, 0.01, 0.040983, 0.11, 0.500013, 0.9, 1.0, 1.1, 1.5,</span>
<span class="sd">             2.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.urvr</span>
<span class="sd">        urvr(0.208971, 2.549574, 4.589118, 5.09902, 5.608921, 7.648529,</span>
<span class="sd">             9.688137, 10.198039, 10.707941, 12.747549, 15.297059)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_control</span><span class="o">.</span><span class="n">GTS</span><span class="p">,</span>
        <span class="n">lstream_control</span><span class="o">.</span><span class="n">BNVR</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_derived</span><span class="o">.</span><span class="n">BNVRF</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHLVR</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHRVR</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">ALVR</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">ARVR</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">ULVR</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">URVR</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">gts</span><span class="p">):</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">alvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhlvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">bnvr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.0</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">ulvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhlvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">der</span><span class="o">.</span><span class="n">bnvrf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">arvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhrvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">bnvr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.0</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">urvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhrvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">der</span><span class="o">.</span><span class="n">bnvrf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></div>


<div class="viewcode-block" id="Calc_ALVRDH_ARVRDH_ULVRDH_URVRDH_V1"><a class="viewcode-back" href="../../../../lstream.html#hydpy.models.lstream.lstream_model.Calc_ALVRDH_ARVRDH_ULVRDH_URVRDH_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_ALVRDH_ARVRDH_ULVRDH_URVRDH_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the derivatives of the wetted area and perimeter of</span>
<span class="sd">    both outer embankments.</span>

<span class="sd">    Examples:</span>

<span class="sd">        In the following, we repeat the examples of the documentation on</span>
<span class="sd">        method |Calc_ALVR_ARVR_ULVR_URVR_V1| and check the correctness of the</span>
<span class="sd">        derivatives by comparing the results of class |NumericalDifferentiator|:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lstream import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; gts(11)</span>
<span class="sd">        &gt;&gt;&gt; hm(1.0)</span>

<span class="sd">        &gt;&gt;&gt; derived.hrp(0)</span>

<span class="sd">        &gt;&gt;&gt; states.h = 1.0, 1.5, 1.9, 2.0, 2.1, 2.5, 2.9, 3.0, 3.1, 3.5, 4.0</span>
<span class="sd">        &gt;&gt;&gt; bnvr(left=4.0, right=5.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.bnvrf.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.hv(left=1.0, right=2.0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhlvr_rhrvr_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhlvrdh_rhrvrdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_alvrdh_arvrdh_ulvrdh_urvrdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.alvrdh</span>
<span class="sd">        alvrdh(0.0, 0.0, 0.0, 0.0, 0.4, 2.0, 3.6, 4.0, 4.4, 6.0, 8.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.arvrdh</span>
<span class="sd">        arvrdh(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.5, 2.5, 5.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.ulvrdh</span>
<span class="sd">        ulvrdh(0.0, 0.0, 0.0, 4.123106, 4.123106, 4.123106, 4.123106, 4.123106,</span>
<span class="sd">               4.123106, 4.123106, 4.123106)</span>
<span class="sd">        &gt;&gt;&gt; aides.urvrdh</span>
<span class="sd">        urvrdh(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 5.09902, 5.09902, 5.09902,</span>
<span class="sd">               5.09902)</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import NumericalDifferentiator</span>
<span class="sd">        &gt;&gt;&gt; numdiff = NumericalDifferentiator(</span>
<span class="sd">        ...     xsequence=states.h,</span>
<span class="sd">        ...     ysequences=[aides.alvr, aides.arvr, aides.ulvr, aides.urvr],</span>
<span class="sd">        ...     methods=[model.calc_rhlvr_rhrvr_v1,</span>
<span class="sd">        ...              model.calc_alvr_arvr_ulvr_urvr_v1])</span>
<span class="sd">        &gt;&gt;&gt; numdiff()</span>
<span class="sd">        d_alvr/d_h: 0.0, 0.0, 0.0, 0.0, 0.4, 2.0, 3.6, 4.0, 4.4, 6.0, 8.0</span>
<span class="sd">        d_arvr/d_h: 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.5, 2.5, 5.0</span>
<span class="sd">        d_ulvr/d_h: 0.0, 0.0, 0.0, 4.123106, 4.123106, 4.123106, 4.123106, \</span>
<span class="sd">4.123106, 4.123106, 4.123106, 4.123106</span>
<span class="sd">        d_urvr/d_h: 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 5.09902, 5.09902, \</span>
<span class="sd">5.09902, 5.09902</span>

<span class="sd">        &gt;&gt;&gt; bnvr(left=0.0, right=5.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.bnvrf.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.hv(left=1.0, right=0.0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhlvr_rhrvr_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhlvrdh_rhrvrdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_alvrdh_arvrdh_ulvrdh_urvrdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.alvrdh</span>
<span class="sd">        alvrdh(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.arvrdh</span>
<span class="sd">        arvrdh(0.0, 2.5, 4.5, 5.0, 5.5, 7.5, 9.5, 10.0, 10.5, 12.5, 15.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.ulvrdh</span>
<span class="sd">        ulvrdh(0.0, 0.0, 0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.urvrdh</span>
<span class="sd">        urvrdh(5.09902, 5.09902, 5.09902, 5.09902, 5.09902, 5.09902, 5.09902,</span>
<span class="sd">               5.09902, 5.09902, 5.09902, 5.09902)</span>

<span class="sd">        &gt;&gt;&gt; numdiff()</span>
<span class="sd">        d_alvr/d_h: 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0</span>
<span class="sd">        d_arvr/d_h: 0.0, 2.5, 4.5, 5.0, 5.5, 7.5, 9.5, 10.0, 10.5, 12.5, 15.0</span>
<span class="sd">        d_ulvr/d_h: 0.0, 0.0, 0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0</span>
<span class="sd">        d_urvr/d_h: 5.09902, 5.09902, 5.09902, 5.09902, 5.09902, 5.09902, \</span>
<span class="sd">5.09902, 5.09902, 5.09902, 5.09902, 5.09902</span>

<span class="sd">        &gt;&gt;&gt; hr(0.1)</span>
<span class="sd">        &gt;&gt;&gt; derived.hrp.update()</span>
<span class="sd">        &gt;&gt;&gt; bnvr(left=4.0, right=5.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.bnvrf.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.hv(left=1.0, right=2.0)</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhlvr_rhrvr_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhlvrdh_rhrvrdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_alvrdh_arvrdh_ulvrdh_urvrdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.alvrdh</span>
<span class="sd">        alvrdh(0.0, 0.0, 0.006224, 0.081965, 0.371535, 1.999625, 3.599999, 4.0,</span>
<span class="sd">               4.4, 6.0, 8.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.arvrdh</span>
<span class="sd">        arvrdh(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.00778, 0.102457, 0.464419,</span>
<span class="sd">               2.499532, 5.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.ulvrdh</span>
<span class="sd">        ulvrdh(0.0, 0.000876, 0.641565, 2.061553, 3.48154, 4.12223, 4.123105,</span>
<span class="sd">               4.123105, 4.123106, 4.123106, 4.123106)</span>
<span class="sd">        &gt;&gt;&gt; aides.urvrdh</span>
<span class="sd">        urvrdh(0.0, 0.0, 0.0, 0.0, 0.000001, 0.001083, 0.79342, 2.54951,</span>
<span class="sd">               4.305599, 5.097936, 5.099019)</span>

<span class="sd">        &gt;&gt;&gt; numdiff()</span>
<span class="sd">        d_alvr/d_h: 0.0, 0.0, 0.006224, 0.081965, 0.371535, 1.999625, \</span>
<span class="sd">3.599999, 4.0, 4.4, 6.0, 8.0</span>
<span class="sd">        d_arvr/d_h: 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.00778, 0.102457, \</span>
<span class="sd">0.464419, 2.499532, 5.0</span>
<span class="sd">        d_ulvr/d_h: 0.0, 0.000876, 0.641565, 2.061553, 3.48154, 4.12223, \</span>
<span class="sd">4.123105, 4.123105, 4.123106, 4.123106, 4.123106</span>
<span class="sd">        d_urvr/d_h: 0.0, 0.0, 0.0, 0.0, 0.000001, 0.001083, 0.79342, \</span>
<span class="sd">2.54951, 4.305599, 5.097936, 5.099019</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_control</span><span class="o">.</span><span class="n">GTS</span><span class="p">,</span>
        <span class="n">lstream_control</span><span class="o">.</span><span class="n">BNVR</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_derived</span><span class="o">.</span><span class="n">BNVRF</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHLVR</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHLVRDH</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHRVR</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHRVRDH</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">ALVRDH</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">ARVRDH</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">ULVRDH</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">URVRDH</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">gts</span><span class="p">):</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">alvrdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">bnvr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhlvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhlvrdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">ulvrdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhlvrdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">der</span><span class="o">.</span><span class="n">bnvrf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">arvrdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">bnvr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhrvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhrvrdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">urvrdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhrvrdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">der</span><span class="o">.</span><span class="n">bnvrf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></div>


<div class="viewcode-block" id="Calc_QM_V1"><a class="viewcode-back" href="../../../../lstream.html#hydpy.models.lstream.lstream_model.Calc_QM_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_QM_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the discharge of the main channel after Manning-Strickler.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`QM = MFM \\cdot \\frac{AM^{5/3}}{UM^{2/3}}`</span>

<span class="sd">    Examples:</span>

<span class="sd">        Note the handling of zero values for |UM| (in the third subsection):</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lstream import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; gts(3)</span>
<span class="sd">        &gt;&gt;&gt; derived.mfm(10.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.am = 3.0, 0.0, 3.0</span>
<span class="sd">        &gt;&gt;&gt; aides.um = 7.0, 7.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qm_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.qm</span>
<span class="sd">        qm(17.053102, 0.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_control</span><span class="o">.</span><span class="n">GTS</span><span class="p">,)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_derived</span><span class="o">.</span><span class="n">MFM</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">AM</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">UM</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_aides</span><span class="o">.</span><span class="n">QM</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">gts</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">aid</span><span class="o">.</span><span class="n">um</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">aid</span><span class="o">.</span><span class="n">qm</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">der</span><span class="o">.</span><span class="n">mfm</span> <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">am</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="p">(</span><span class="mf">5.0</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span> <span class="o">/</span> <span class="n">aid</span><span class="o">.</span><span class="n">um</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">aid</span><span class="o">.</span><span class="n">qm</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>


<div class="viewcode-block" id="Calc_QM_V2"><a class="viewcode-back" href="../../../../lstream.html#hydpy.models.lstream.lstream_model.Calc_QM_V2">[docs]</a><span class="k">class</span> <span class="nc">Calc_QM_V2</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the discharge of the main channel following the kinematic</span>
<span class="sd">    wave approach.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`QM = \\frac{QMDH}{AMDH} \\cdot AM`</span>

<span class="sd">    Examples:</span>

<span class="sd">        Note the handling of zero values for |AMDH| (in the second subsection):</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lstream import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; gts(2)</span>
<span class="sd">        &gt;&gt;&gt; aides.am = 4.0, 4.0</span>
<span class="sd">        &gt;&gt;&gt; aides.qmdh = 3.0, 3.0</span>
<span class="sd">        &gt;&gt;&gt; aides.amdh = 2.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qm_v2()</span>
<span class="sd">        &gt;&gt;&gt; aides.qm</span>
<span class="sd">        qm(6.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_control</span><span class="o">.</span><span class="n">GTS</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">AM</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">QMDH</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">AMDH</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_aides</span><span class="o">.</span><span class="n">QM</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">gts</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">aid</span><span class="o">.</span><span class="n">amdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">aid</span><span class="o">.</span><span class="n">qm</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">aid</span><span class="o">.</span><span class="n">qmdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">aid</span><span class="o">.</span><span class="n">amdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">am</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">aid</span><span class="o">.</span><span class="n">qm</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>


<div class="viewcode-block" id="Calc_QMDH_V1"><a class="viewcode-back" href="../../../../lstream.html#hydpy.models.lstream.lstream_model.Calc_QMDH_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_QMDH_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the derivative of the discharge of the main channel</span>
<span class="sd">    following method |Calc_QM_V1|.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`QMDH = MFM \\cdot</span>
<span class="sd">      \\frac{5 \\cdot  AM^{2/3} \\cdot AMDH}{3 \\cdot UM^{2/3}} -</span>
<span class="sd">      \\frac{2 \\cdot  AM^{5/3} \\cdot UMDH}{3 \\cdot UM^{5/3}}`</span>

<span class="sd">    Examples:</span>

<span class="sd">        First, we apply the class |NumericalDifferentiator| to validate the</span>
<span class="sd">        calculated derivatives:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lstream import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; gts(2)</span>
<span class="sd">        &gt;&gt;&gt; bm(2.0)</span>
<span class="sd">        &gt;&gt;&gt; bnm(4.0)</span>
<span class="sd">        &gt;&gt;&gt; hm(2.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.mfm(10.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.hrp(0.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.bnmf.update()</span>
<span class="sd">        &gt;&gt;&gt; states.h = 0.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhm_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhmdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhv_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhvdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_am_um_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_amdh_umdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qmdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.qmdh</span>
<span class="sd">        qmdh(0.0, 94.12356)</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import NumericalDifferentiator,pub</span>
<span class="sd">        &gt;&gt;&gt; numdiff = NumericalDifferentiator(</span>
<span class="sd">        ...     xsequence=states.h,</span>
<span class="sd">        ...     ysequences=[aides.qm],</span>
<span class="sd">        ...     methods=[model.calc_rhm_v1,</span>
<span class="sd">        ...              model.calc_rhv_v1,</span>
<span class="sd">        ...              model.calc_am_um_v1,</span>
<span class="sd">        ...              model.calc_qm_v1],</span>
<span class="sd">        ...     dx=1e-8)</span>
<span class="sd">        &gt;&gt;&gt; with pub.options.reprdigits(5):</span>
<span class="sd">        ...     numdiff()</span>
<span class="sd">        d_qm/d_h: 0.00002, 94.12356</span>

<span class="sd">        Second, we show that zero values for |AM| or |UM| result in zero</span>
<span class="sd">        values for |QMDH|:</span>

<span class="sd">        &gt;&gt;&gt; aides.am = 1.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; aides.um = 0.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qmdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.qmdh</span>
<span class="sd">        qmdh(0.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_control</span><span class="o">.</span><span class="n">GTS</span><span class="p">,)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_derived</span><span class="o">.</span><span class="n">MFM</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">AM</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">AMDH</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">UM</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">UMDH</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_aides</span><span class="o">.</span><span class="n">QMDH</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">gts</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">aid</span><span class="o">.</span><span class="n">am</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">aid</span><span class="o">.</span><span class="n">um</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">):</span>
                <span class="n">aid</span><span class="o">.</span><span class="n">qmdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">mfm</span> <span class="o">*</span> <span class="p">(</span>
                    <span class="mf">5.0</span>
                    <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">am</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span>
                    <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">amdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="o">/</span> <span class="p">(</span><span class="mf">3.0</span> <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">um</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">))</span>
                    <span class="o">-</span> <span class="mf">2.0</span>
                    <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">am</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="p">(</span><span class="mf">5.0</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span>
                    <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">umdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="o">/</span> <span class="p">(</span><span class="mf">3.0</span> <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">um</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="p">(</span><span class="mf">5.0</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">))</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">aid</span><span class="o">.</span><span class="n">qmdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>


<div class="viewcode-block" id="Calc_QLV_QRV_V1"><a class="viewcode-back" href="../../../../lstream.html#hydpy.models.lstream.lstream_model.Calc_QLV_QRV_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_QLV_QRV_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the discharge of both forelands after Manning-Strickler.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`QV = MFV \\cdot \\frac{AV^{5/3}}{UV^{2/3}}`</span>

<span class="sd">    Examples:</span>

<span class="sd">        Note the handling of zero values for |ULV| and |URV| (in the second</span>
<span class="sd">        subsection):</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lstream import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; gts(2)</span>
<span class="sd">        &gt;&gt;&gt; derived.mfv(left=10.0, right=18.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.alv = 3.0, 3.0</span>
<span class="sd">        &gt;&gt;&gt; aides.arv = 4.0, 4.0</span>
<span class="sd">        &gt;&gt;&gt; aides.ulv = 7.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; aides.urv = 8.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qlv_qrv_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.qlv</span>
<span class="sd">        qlv(17.053102, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.qrv</span>
<span class="sd">        qrv(45.357158, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_control</span><span class="o">.</span><span class="n">GTS</span><span class="p">,)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_derived</span><span class="o">.</span><span class="n">MFV</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">ALV</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">ARV</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">ULV</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">URV</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">QLV</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">QRV</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">gts</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">aid</span><span class="o">.</span><span class="n">ulv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">aid</span><span class="o">.</span><span class="n">qlv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">der</span><span class="o">.</span><span class="n">mfv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">alv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="p">(</span><span class="mf">5.0</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span> <span class="o">/</span> <span class="n">aid</span><span class="o">.</span><span class="n">ulv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">aid</span><span class="o">.</span><span class="n">qlv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">if</span> <span class="n">aid</span><span class="o">.</span><span class="n">urv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">aid</span><span class="o">.</span><span class="n">qrv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">der</span><span class="o">.</span><span class="n">mfv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">arv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="p">(</span><span class="mf">5.0</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span> <span class="o">/</span> <span class="n">aid</span><span class="o">.</span><span class="n">urv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">aid</span><span class="o">.</span><span class="n">qrv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>


<div class="viewcode-block" id="Calc_QLV_QRV_V2"><a class="viewcode-back" href="../../../../lstream.html#hydpy.models.lstream.lstream_model.Calc_QLV_QRV_V2">[docs]</a><span class="k">class</span> <span class="nc">Calc_QLV_QRV_V2</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the discharge of both forelands following the kinematic</span>
<span class="sd">    wave approach.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`QV = \\frac{QVDH}{AVDH} \\cdot AV`</span>

<span class="sd">    Examples:</span>

<span class="sd">        Note the handling of zero values for |ALVDH| and |ARVDH| (in the</span>
<span class="sd">        second subsection):</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lstream import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; gts(2)</span>
<span class="sd">        &gt;&gt;&gt; aides.alv = 3.0, 3.0</span>
<span class="sd">        &gt;&gt;&gt; aides.arv = 5.0, 5.0</span>
<span class="sd">        &gt;&gt;&gt; aides.qlvdh = 4.0, 4.0</span>
<span class="sd">        &gt;&gt;&gt; aides.qrvdh = 6.0, 6.0</span>
<span class="sd">        &gt;&gt;&gt; aides.alvdh = 2.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; aides.arvdh = 4.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qlv_qrv_v2()</span>
<span class="sd">        &gt;&gt;&gt; aides.qlv</span>
<span class="sd">        qlv(6.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.qrv</span>
<span class="sd">        qrv(7.5, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_control</span><span class="o">.</span><span class="n">GTS</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">ALV</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">ARV</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">ALVDH</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">ARVDH</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">QLVDH</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">QRVDH</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">QLV</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">QRV</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">gts</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">aid</span><span class="o">.</span><span class="n">alvdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">aid</span><span class="o">.</span><span class="n">qlv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">aid</span><span class="o">.</span><span class="n">qlvdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">aid</span><span class="o">.</span><span class="n">alvdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">alv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">aid</span><span class="o">.</span><span class="n">qlv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">if</span> <span class="n">aid</span><span class="o">.</span><span class="n">arvdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">aid</span><span class="o">.</span><span class="n">qrv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">aid</span><span class="o">.</span><span class="n">qrvdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">aid</span><span class="o">.</span><span class="n">arvdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">arv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">aid</span><span class="o">.</span><span class="n">qrv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>


<div class="viewcode-block" id="Calc_QLVDH_QRVDH_V1"><a class="viewcode-back" href="../../../../lstream.html#hydpy.models.lstream.lstream_model.Calc_QLVDH_QRVDH_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_QLVDH_QRVDH_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the derivative of the discharge of both forelands with</span>
<span class="sd">    respect to the stage following method |Calc_QLV_QRV_V1|.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`QVDH = MFV \\cdot</span>
<span class="sd">      \\frac{5 \\cdot  AV^{2/3} \\cdot AVDH}{3 \\cdot UV^{2/3}} -</span>
<span class="sd">      \\frac{2 \\cdot  AV^{5/3} \\cdot UVDH}{3 \\cdot UV^{5/3}}`</span>

<span class="sd">    Examples:</span>

<span class="sd">        First, we apply the class |NumericalDifferentiator| to validate the</span>
<span class="sd">        calculated derivatives:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lstream import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; gts(2)</span>
<span class="sd">        &gt;&gt;&gt; hm(1.0)</span>
<span class="sd">        &gt;&gt;&gt; bv(left=2.0, right=3.0)</span>
<span class="sd">        &gt;&gt;&gt; bnv(left=4.0, right=5.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.bnvf.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.hv(left=1.0, right=2.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.mfv(left=10.0, right=18.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.hrp(0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.h = 0.5, 1.5</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhv_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhvdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhlvr_rhrvr_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhlvrdh_rhrvrdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_alv_arv_ulv_urv_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_alvdh_arvdh_ulvdh_urvdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qlvdh_qrvdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.qlvdh</span>
<span class="sd">        qlvdh(0.0, 29.091363)</span>
<span class="sd">        &gt;&gt;&gt; aides.qrvdh</span>
<span class="sd">        qrvdh(0.0, 74.651886)</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import NumericalDifferentiator</span>
<span class="sd">        &gt;&gt;&gt; numdiff = NumericalDifferentiator(</span>
<span class="sd">        ...     xsequence=states.h,</span>
<span class="sd">        ...     ysequences=[aides.qlv, aides.qrv],</span>
<span class="sd">        ...     methods=[model.calc_rhv_v1,</span>
<span class="sd">        ...              model.calc_rhlvr_rhrvr_v1,</span>
<span class="sd">        ...              model.calc_alv_arv_ulv_urv_v1,</span>
<span class="sd">        ...              model.calc_qlv_qrv_v1])()</span>
<span class="sd">        d_qlv/d_h: 0.0, 29.091363</span>
<span class="sd">        d_qrv/d_h: 0.0, 74.651886</span>

<span class="sd">        Second, we show that zero values for |ALV| or |ULV| as well as for</span>
<span class="sd">        |ARV| or |URV| result in zero values for |QLVDH| or |QRVDH|,</span>
<span class="sd">        respectively:</span>

<span class="sd">        &gt;&gt;&gt; aides.alv = 1.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; aides.ulv = 0.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; aides.arv = 1.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; aides.urv = 0.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qlvdh_qrvdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.qlvdh</span>
<span class="sd">        qlvdh(0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.qrvdh</span>
<span class="sd">        qrvdh(0.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_control</span><span class="o">.</span><span class="n">GTS</span><span class="p">,)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_derived</span><span class="o">.</span><span class="n">MFV</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">ALV</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">ALVDH</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">ARV</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">ARVDH</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">ULV</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">ULVDH</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">URV</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">URVDH</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">QLVDH</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">QRVDH</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">gts</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">aid</span><span class="o">.</span><span class="n">alv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">aid</span><span class="o">.</span><span class="n">ulv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">):</span>
                <span class="n">aid</span><span class="o">.</span><span class="n">qlvdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">mfv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span>
                    <span class="mf">5.0</span>
                    <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">alv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span>
                    <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">alvdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="o">/</span> <span class="p">(</span><span class="mf">3.0</span> <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">ulv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">))</span>
                    <span class="o">-</span> <span class="mf">2.0</span>
                    <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">alv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="p">(</span><span class="mf">5.0</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span>
                    <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">ulvdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="o">/</span> <span class="p">(</span><span class="mf">3.0</span> <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">ulv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="p">(</span><span class="mf">5.0</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">))</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">aid</span><span class="o">.</span><span class="n">qlvdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">aid</span><span class="o">.</span><span class="n">arv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">aid</span><span class="o">.</span><span class="n">urv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">):</span>
                <span class="n">aid</span><span class="o">.</span><span class="n">qrvdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">mfv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span>
                    <span class="mf">5.0</span>
                    <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">arv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span>
                    <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">arvdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="o">/</span> <span class="p">(</span><span class="mf">3.0</span> <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">urv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">))</span>
                    <span class="o">-</span> <span class="mf">2.0</span>
                    <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">arv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="p">(</span><span class="mf">5.0</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span>
                    <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">urvdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="o">/</span> <span class="p">(</span><span class="mf">3.0</span> <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">urv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="p">(</span><span class="mf">5.0</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">))</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">aid</span><span class="o">.</span><span class="n">qrvdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>


<div class="viewcode-block" id="Calc_QLVR_QRVR_V1"><a class="viewcode-back" href="../../../../lstream.html#hydpy.models.lstream.lstream_model.Calc_QLVR_QRVR_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_QLVR_QRVR_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the discharge of both outer embankments after</span>
<span class="sd">    Manning-Strickler.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`QVR = MFV \\cdot \\frac{AVR^{5/3}}{UVR^{2/3}}`</span>

<span class="sd">    Examples:</span>

<span class="sd">        Note the handling of zero values for |ULVR| and |URVR| (in the second</span>
<span class="sd">        subsection):</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lstream import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; gts(2)</span>
<span class="sd">        &gt;&gt;&gt; derived.mfv(left=10.0, right=1.2)</span>
<span class="sd">        &gt;&gt;&gt; aides.alvr = 3.0, 3.0</span>
<span class="sd">        &gt;&gt;&gt; aides.arvr = 4.0, 4.0</span>
<span class="sd">        &gt;&gt;&gt; aides.ulvr = 7.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; aides.urvr = 8.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qlvr_qrvr_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.qlvr</span>
<span class="sd">        qlvr(17.053102, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.qrvr</span>
<span class="sd">        qrvr(3.023811, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_control</span><span class="o">.</span><span class="n">GTS</span><span class="p">,)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_derived</span><span class="o">.</span><span class="n">MFV</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">ALVR</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">ARVR</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">ULVR</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">URVR</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">QLVR</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">QRVR</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">gts</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">aid</span><span class="o">.</span><span class="n">ulvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">aid</span><span class="o">.</span><span class="n">qlvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">der</span><span class="o">.</span><span class="n">mfv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">alvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="p">(</span><span class="mf">5.0</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span> <span class="o">/</span> <span class="n">aid</span><span class="o">.</span><span class="n">ulvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">aid</span><span class="o">.</span><span class="n">qlvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">if</span> <span class="n">aid</span><span class="o">.</span><span class="n">urvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">aid</span><span class="o">.</span><span class="n">qrvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">der</span><span class="o">.</span><span class="n">mfv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">arvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="p">(</span><span class="mf">5.0</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span> <span class="o">/</span> <span class="n">aid</span><span class="o">.</span><span class="n">urvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">aid</span><span class="o">.</span><span class="n">qrvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>


<div class="viewcode-block" id="Calc_QLVR_QRVR_V2"><a class="viewcode-back" href="../../../../lstream.html#hydpy.models.lstream.lstream_model.Calc_QLVR_QRVR_V2">[docs]</a><span class="k">class</span> <span class="nc">Calc_QLVR_QRVR_V2</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the discharge of both outer embankments following the</span>
<span class="sd">    kinematic wave approach.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`QVR = \\frac{QVRDH}{AVRDH} \\cdot AVR`</span>

<span class="sd">    Examples:</span>

<span class="sd">        Note the handling of zero values for |ALVRDH| and |ARVRDH| (in the</span>
<span class="sd">        second subsection):</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lstream import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; gts(2)</span>
<span class="sd">        &gt;&gt;&gt; aides.alvr = 3.0, 3.0</span>
<span class="sd">        &gt;&gt;&gt; aides.arvr = 5.0, 5.0</span>
<span class="sd">        &gt;&gt;&gt; aides.qlvrdh = 4.0, 4.0</span>
<span class="sd">        &gt;&gt;&gt; aides.qrvrdh = 6.0, 6.0</span>
<span class="sd">        &gt;&gt;&gt; aides.alvrdh = 2.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; aides.arvrdh = 4.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qlvr_qrvr_v2()</span>
<span class="sd">        &gt;&gt;&gt; aides.qlvr</span>
<span class="sd">        qlvr(6.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.qrvr</span>
<span class="sd">        qrvr(7.5, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_control</span><span class="o">.</span><span class="n">GTS</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">ALVR</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">ARVR</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">QLVRDH</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">QRVRDH</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">ALVRDH</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">ARVRDH</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">QLVR</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">QRVR</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">gts</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">aid</span><span class="o">.</span><span class="n">alvrdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">aid</span><span class="o">.</span><span class="n">qlvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">aid</span><span class="o">.</span><span class="n">qlvrdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">aid</span><span class="o">.</span><span class="n">alvrdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">alvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">aid</span><span class="o">.</span><span class="n">qlvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">if</span> <span class="n">aid</span><span class="o">.</span><span class="n">arvrdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">aid</span><span class="o">.</span><span class="n">qrvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">aid</span><span class="o">.</span><span class="n">qrvrdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">aid</span><span class="o">.</span><span class="n">arvrdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">arvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">aid</span><span class="o">.</span><span class="n">qrvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>


<div class="viewcode-block" id="Calc_QLVRDH_QRVRDH_V1"><a class="viewcode-back" href="../../../../lstream.html#hydpy.models.lstream.lstream_model.Calc_QLVRDH_QRVRDH_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_QLVRDH_QRVRDH_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the derivative of the discharge over the outer embankments</span>
<span class="sd">    with respect to the stage following method |Calc_QLVR_QRVR_V1|.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`QVRDH = MFVR \\cdot</span>
<span class="sd">      \\frac{5 \\cdot  AVR^{2/3} \\cdot AVRDH}{3 \\cdot UVR^{2/3}} -</span>
<span class="sd">      \\frac{2 \\cdot  AVR{5/3} \\cdot UVRDH}{3 \\cdot UVR^{5/3}}`</span>

<span class="sd">    Examples:</span>

<span class="sd">        First, we apply the class |NumericalDifferentiator| to validate the</span>
<span class="sd">        calculated derivatives:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lstream import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; gts(2)</span>
<span class="sd">        &gt;&gt;&gt; hm(1.0)</span>
<span class="sd">        &gt;&gt;&gt; bnvr(left=4.0, right=5.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.bnvrf.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.hv(left=1.0, right=2.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.mfv(left=10.0, right=18.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.hrp(0.0)</span>
<span class="sd">        &gt;&gt;&gt; states.h = 1.5, 3.5</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhlvr_rhrvr_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhlvrdh_rhrvrdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_alvr_arvr_ulvr_urvr_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_alvrdh_arvrdh_ulvrdh_urvrdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qlvrdh_qrvrdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.qlvrdh</span>
<span class="sd">        qlvrdh(0.0, 64.717418)</span>
<span class="sd">        &gt;&gt;&gt; aides.qrvrdh</span>
<span class="sd">        qrvrdh(0.0, 23.501747)</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import NumericalDifferentiator</span>
<span class="sd">        &gt;&gt;&gt; NumericalDifferentiator(</span>
<span class="sd">        ...     xsequence=states.h,</span>
<span class="sd">        ...     ysequences=[aides.qlvr, aides.qrvr],</span>
<span class="sd">        ...     methods=[model.calc_rhlvr_rhrvr_v1,</span>
<span class="sd">        ...              model.calc_alvr_arvr_ulvr_urvr_v1,</span>
<span class="sd">        ...              model.calc_qlvr_qrvr_v1])()</span>
<span class="sd">        d_qlvr/d_h: 0.0, 64.717418</span>
<span class="sd">        d_qrvr/d_h: 0.0, 23.501747</span>

<span class="sd">        Second, we show that zero values for |ALVR| or |ULVR| as well as for</span>
<span class="sd">        |ARVR| or |URVR| result in zero values for |QLVRDH| or |QRVRDH|,</span>
<span class="sd">        respectively:</span>

<span class="sd">        &gt;&gt;&gt; aides.alvr = 1.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; aides.ulvr = 0.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; aides.arvr = 1.0, 0.0</span>
<span class="sd">        &gt;&gt;&gt; aides.urvr = 0.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qlvrdh_qrvrdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.qlvrdh</span>
<span class="sd">        qlvrdh(0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.qrvrdh</span>
<span class="sd">        qrvrdh(0.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_control</span><span class="o">.</span><span class="n">GTS</span><span class="p">,)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_derived</span><span class="o">.</span><span class="n">MFV</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">ALVR</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">ALVRDH</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">ARVR</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">ARVRDH</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">ULVR</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">ULVRDH</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">URVR</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">URVRDH</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">QLVRDH</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">QRVRDH</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">gts</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">aid</span><span class="o">.</span><span class="n">alvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">aid</span><span class="o">.</span><span class="n">ulvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">):</span>
                <span class="n">aid</span><span class="o">.</span><span class="n">qlvrdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">mfv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span>
                    <span class="mf">5.0</span>
                    <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">alvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span>
                    <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">alvrdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="o">/</span> <span class="p">(</span><span class="mf">3.0</span> <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">ulvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">))</span>
                    <span class="o">-</span> <span class="mf">2.0</span>
                    <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">alvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="p">(</span><span class="mf">5.0</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span>
                    <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">ulvrdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="o">/</span> <span class="p">(</span><span class="mf">3.0</span> <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">ulvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="p">(</span><span class="mf">5.0</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">))</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">aid</span><span class="o">.</span><span class="n">qlvrdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">aid</span><span class="o">.</span><span class="n">arvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">aid</span><span class="o">.</span><span class="n">urvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">):</span>
                <span class="n">aid</span><span class="o">.</span><span class="n">qrvrdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">mfv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span>
                    <span class="mf">5.0</span>
                    <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">arvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span>
                    <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">arvrdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="o">/</span> <span class="p">(</span><span class="mf">3.0</span> <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">urvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">))</span>
                    <span class="o">-</span> <span class="mf">2.0</span>
                    <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">arvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="p">(</span><span class="mf">5.0</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span>
                    <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">urvrdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="o">/</span> <span class="p">(</span><span class="mf">3.0</span> <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">urvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="p">(</span><span class="mf">5.0</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">))</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">aid</span><span class="o">.</span><span class="n">qrvrdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>


<div class="viewcode-block" id="Calc_AG_V1"><a class="viewcode-back" href="../../../../lstream.html#hydpy.models.lstream.lstream_model.Calc_AG_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_AG_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the through wetted of the total cross-sections.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`AG = AM+ALV+ARV+ALVR+ARVR`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lstream import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; gts(2)</span>
<span class="sd">        &gt;&gt;&gt; aides.am = 0.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; aides.alv = 2.0, 4.0</span>
<span class="sd">        &gt;&gt;&gt; aides.arv = 3.0, 5.0</span>
<span class="sd">        &gt;&gt;&gt; aides.alvr = 6.0, 8.0</span>
<span class="sd">        &gt;&gt;&gt; aides.arvr = 7.0, 9.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_ag_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.ag</span>
<span class="sd">        ag(18.0, 27.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_control</span><span class="o">.</span><span class="n">GTS</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">AM</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">ALV</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">ARV</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">ALVR</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">ARVR</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_aides</span><span class="o">.</span><span class="n">AG</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">gts</span><span class="p">):</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">ag</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">aid</span><span class="o">.</span><span class="n">am</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">aid</span><span class="o">.</span><span class="n">alv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">aid</span><span class="o">.</span><span class="n">arv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">aid</span><span class="o">.</span><span class="n">alvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">aid</span><span class="o">.</span><span class="n">arvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></div>


<div class="viewcode-block" id="Calc_QG_V1"><a class="viewcode-back" href="../../../../lstream.html#hydpy.models.lstream.lstream_model.Calc_QG_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_QG_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the discharge of the total cross-section.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`QG = QM+QLV+QRV+QLVR+QRVR`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lstream import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; gts(2)</span>
<span class="sd">        &gt;&gt;&gt; aides.qm = 0.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; aides.qlv = 2.0, 4.0</span>
<span class="sd">        &gt;&gt;&gt; aides.qrv = 3.0, 5.0</span>
<span class="sd">        &gt;&gt;&gt; aides.qlvr = 6.0, 8.0</span>
<span class="sd">        &gt;&gt;&gt; aides.qrvr = 7.0, 9.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qg_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qg</span>
<span class="sd">        qg(18.0, 27.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_control</span><span class="o">.</span><span class="n">GTS</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">QM</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">QLV</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">QRV</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">QLVR</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">QRVR</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_fluxes</span><span class="o">.</span><span class="n">QG</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">gts</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">qg</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">aid</span><span class="o">.</span><span class="n">qm</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">aid</span><span class="o">.</span><span class="n">qlv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">aid</span><span class="o">.</span><span class="n">qrv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">aid</span><span class="o">.</span><span class="n">qlvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">aid</span><span class="o">.</span><span class="n">qrvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></div>


<div class="viewcode-block" id="Calc_QG_V2"><a class="viewcode-back" href="../../../../lstream.html#hydpy.models.lstream.lstream_model.Calc_QG_V2">[docs]</a><span class="k">class</span> <span class="nc">Calc_QG_V2</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Determine the discharge of each the total cross-section based on an</span>
<span class="sd">    artificial neural network describing the relationship between water</span>
<span class="sd">    storage in the total channel and discharge.</span>

<span class="sd">    Example:</span>

<span class="sd">        The following example applies a very simple relationship based</span>
<span class="sd">        on a single neuron:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lstream import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; gts(2)</span>
<span class="sd">        &gt;&gt;&gt; vg2qg(nmb_inputs=1, nmb_neurons=(1,), nmb_outputs=1,</span>
<span class="sd">        ...       weights_input=0.5, weights_output=1.0,</span>
<span class="sd">        ...       intercepts_hidden=0.0, intercepts_output=-0.5)</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import UnitTest</span>
<span class="sd">        &gt;&gt;&gt; test = UnitTest(model,</span>
<span class="sd">        ...                 model.calc_qg_v2,</span>
<span class="sd">        ...                 last_example=10,</span>
<span class="sd">        ...                 parseqs=(states.vg,</span>
<span class="sd">        ...                          fluxes.qg))</span>
<span class="sd">        &gt;&gt;&gt; test.nexts.vg = numpy.ones((10, 2))</span>
<span class="sd">        &gt;&gt;&gt; test.nexts.vg[:, 0] = numpy.arange(0.0, 10.0)</span>
<span class="sd">        &gt;&gt;&gt; test.nexts.vg[:, 1] = numpy.arange(10.0, 20.0)</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. |        vg |                 qg |</span>
<span class="sd">        ----------------------------------------</span>
<span class="sd">        |   1 | 0.0  10.0 |      0.0  0.493307 |</span>
<span class="sd">        |   2 | 1.0  11.0 | 0.122459   0.49593 |</span>
<span class="sd">        |   3 | 2.0  12.0 | 0.231059  0.497527 |</span>
<span class="sd">        |   4 | 3.0  13.0 | 0.317574  0.498499 |</span>
<span class="sd">        |   5 | 4.0  14.0 | 0.380797  0.499089 |</span>
<span class="sd">        |   6 | 5.0  15.0 | 0.424142  0.499447 |</span>
<span class="sd">        |   7 | 6.0  16.0 | 0.452574  0.499665 |</span>
<span class="sd">        |   8 | 7.0  17.0 | 0.470688  0.499797 |</span>
<span class="sd">        |   9 | 8.0  18.0 | 0.482014  0.499877 |</span>
<span class="sd">        |  10 | 9.0  19.0 | 0.489013  0.499925 |</span>

<span class="sd">        For more realistic approximations of measured relationships between</span>
<span class="sd">        storage and discharge, we require larger neural networks.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_control</span><span class="o">.</span><span class="n">GTS</span><span class="p">,</span>
        <span class="n">lstream_control</span><span class="o">.</span><span class="n">VG2QG</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_states</span><span class="o">.</span><span class="n">VG</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_fluxes</span><span class="o">.</span><span class="n">QG</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">gts</span><span class="p">):</span>
            <span class="n">con</span><span class="o">.</span><span class="n">vg2qg</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">sta</span><span class="o">.</span><span class="n">vg</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">con</span><span class="o">.</span><span class="n">vg2qg</span><span class="o">.</span><span class="n">calculate_values</span><span class="p">()</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">qg</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">vg2qg</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>


<div class="viewcode-block" id="Calc_WBM_V1"><a class="viewcode-back" href="../../../../lstream.html#hydpy.models.lstream.lstream_model.Calc_WBM_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_WBM_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the water table width above the main channel.</span>

<span class="sd">    Examples:</span>

<span class="sd">        Due to :math:`WBM = \\frac{dAM}{dh}`, we can apply the class</span>
<span class="sd">        |NumericalDifferentiator| to validate the calculated water</span>
<span class="sd">        table widths:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lstream import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; gts(5)</span>
<span class="sd">        &gt;&gt;&gt; bm(4.0)</span>
<span class="sd">        &gt;&gt;&gt; bnm(2.0)</span>
<span class="sd">        &gt;&gt;&gt; hm(1.0)</span>
<span class="sd">        &gt;&gt;&gt; hr(0.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.hrp.update()</span>
<span class="sd">        &gt;&gt;&gt; states.h = 0.0, 0.9, 1.0, 1.1, 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhm_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhmdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhv_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhvdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_wbm_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.wbm</span>
<span class="sd">        wbm(4.0, 7.6, 8.0, 8.0, 8.0)</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import NumericalDifferentiator</span>
<span class="sd">        &gt;&gt;&gt; numdiff = NumericalDifferentiator(</span>
<span class="sd">        ...     xsequence=states.h,</span>
<span class="sd">        ...     ysequences=[aides.am],</span>
<span class="sd">        ...     methods=[model.calc_rhm_v1,</span>
<span class="sd">        ...              model.calc_rhv_v1,</span>
<span class="sd">        ...              model.calc_am_um_v1])</span>
<span class="sd">        &gt;&gt;&gt; numdiff()</span>
<span class="sd">        d_am/d_h: 4.0, 7.6, 8.0, 8.0, 8.0</span>

<span class="sd">        &gt;&gt;&gt; hr(0.1)</span>
<span class="sd">        &gt;&gt;&gt; derived.hrp.update()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhm_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhmdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhv_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhvdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_wbm_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.wbm</span>
<span class="sd">        wbm(2.081965, 7.593774, 7.918034, 8.028465, 8.0)</span>

<span class="sd">        &gt;&gt;&gt; numdiff()</span>
<span class="sd">        d_am/d_h: 2.081965, 7.593774, 7.918034, 8.028465, 8.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_control</span><span class="o">.</span><span class="n">GTS</span><span class="p">,</span>
        <span class="n">lstream_control</span><span class="o">.</span><span class="n">BM</span><span class="p">,</span>
        <span class="n">lstream_control</span><span class="o">.</span><span class="n">BNM</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_fixed</span><span class="o">.</span><span class="n">WBMin</span><span class="p">,</span>
        <span class="n">lstream_fixed</span><span class="o">.</span><span class="n">WBReg</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHM</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHMDH</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHV</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHVDH</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_aides</span><span class="o">.</span><span class="n">WBM</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">gts</span><span class="p">):</span>
            <span class="n">d_temp1</span> <span class="o">=</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhm</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">d_temp2</span> <span class="o">=</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhmdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhvdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">wbm</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">con</span><span class="o">.</span><span class="n">bnm</span> <span class="o">*</span> <span class="n">d_temp1</span> <span class="o">*</span> <span class="n">d_temp2</span>
                <span class="o">+</span> <span class="n">con</span><span class="o">.</span><span class="n">bnm</span> <span class="o">*</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">d_temp2</span> <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="o">+</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">bm</span> <span class="o">+</span> <span class="n">con</span><span class="o">.</span><span class="n">bnm</span> <span class="o">*</span> <span class="n">d_temp1</span><span class="p">)</span> <span class="o">*</span> <span class="n">d_temp2</span>
                <span class="o">+</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">bm</span> <span class="o">+</span> <span class="n">con</span><span class="o">.</span><span class="n">bnm</span> <span class="o">*</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">d_temp1</span><span class="p">)</span> <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhvdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">wbm</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">smoothutils</span><span class="o">.</span><span class="n">smooth_max1</span><span class="p">(</span><span class="n">fix</span><span class="o">.</span><span class="n">wbmin</span><span class="p">,</span> <span class="n">aid</span><span class="o">.</span><span class="n">wbm</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">fix</span><span class="o">.</span><span class="n">wbreg</span><span class="p">)</span></div>


<div class="viewcode-block" id="Calc_WBLV_WBRV_V1"><a class="viewcode-back" href="../../../../lstream.html#hydpy.models.lstream.lstream_model.Calc_WBLV_WBRV_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_WBLV_WBRV_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the water table width above both forelands.</span>

<span class="sd">    Examples:</span>

<span class="sd">        Due to :math:`WBV = \\frac{dAV}{dh}`, we can apply the class</span>
<span class="sd">        |NumericalDifferentiator| to validate the calculated water</span>
<span class="sd">        table widths:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lstream import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; gts(11)</span>
<span class="sd">        &gt;&gt;&gt; bm(4.0)</span>
<span class="sd">        &gt;&gt;&gt; bnm(2.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.bnvf.update()</span>
<span class="sd">        &gt;&gt;&gt; hm(1.0)</span>
<span class="sd">        &gt;&gt;&gt; bv(left=2.0, right=3.0)</span>
<span class="sd">        &gt;&gt;&gt; bbv(left=10., right=40.)</span>
<span class="sd">        &gt;&gt;&gt; bnv(left=10., right=20.)</span>
<span class="sd">        &gt;&gt;&gt; derived.hv.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.hv</span>
<span class="sd">        hv(left=1.0, right=2.0)</span>
<span class="sd">        &gt;&gt;&gt; hr(0.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.hrp.update()</span>
<span class="sd">        &gt;&gt;&gt; states.h = 1.0, 1.5, 1.9, 2.0, 2.1, 2.5, 2.9, 3.0, 3.1, 3.5, 4.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhv_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhvdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhlvr_rhrvr_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhlvrdh_rhrvrdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_wblv_wbrv_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.wblv</span>
<span class="sd">        wblv(2.0, 7.0, 11.0, 12.0, 12.0, 12.0, 12.0, 12.0, 12.0, 12.0, 12.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.wbrv</span>
<span class="sd">        wbrv(3.0, 13.0, 21.0, 23.0, 25.0, 33.0, 41.0, 43.0, 43.0, 43.0, 43.0)</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import NumericalDifferentiator</span>
<span class="sd">        &gt;&gt;&gt; numdiff = NumericalDifferentiator(</span>
<span class="sd">        ...     xsequence=states.h,</span>
<span class="sd">        ...     ysequences=[aides.alv, aides.arv],</span>
<span class="sd">        ...     methods=[model.calc_rhv_v1,</span>
<span class="sd">        ...              model.calc_rhlvr_rhrvr_v1,</span>
<span class="sd">        ...              model.calc_alv_arv_ulv_urv_v1])</span>
<span class="sd">        &gt;&gt;&gt; numdiff()</span>
<span class="sd">        d_alv/d_h: 2.0, 7.0, 11.0, 12.0, 12.0, 12.0, 12.0, 12.0, 12.0, \</span>
<span class="sd">12.0, 12.0</span>
<span class="sd">        d_arv/d_h: 3.0, 13.0, 21.0, 23.0, 25.0, 33.0, 41.0, 43.0, 43.0, \</span>
<span class="sd">43.0, 43.0</span>

<span class="sd">        &gt;&gt;&gt; hr(0.1)</span>
<span class="sd">        &gt;&gt;&gt; derived.hrp.update()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhv_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhvdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhlvr_rhrvr_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhlvrdh_rhrvrdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_wblv_wbrv_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.wblv</span>
<span class="sd">        wblv(1.204913, 6.998638, 10.984437, 11.795086, 12.071163, 12.000937,</span>
<span class="sd">             12.000002, 12.0, 12.0, 12.0, 12.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.wbrv</span>
<span class="sd">        wbrv(1.909826, 12.997489, 20.999995, 22.999999, 25.0, 33.0, 40.96888,</span>
<span class="sd">             42.590174, 43.142325, 43.001873, 43.000001)</span>

<span class="sd">        &gt;&gt;&gt; numdiff()</span>
<span class="sd">        d_alv/d_h: 1.204913, 6.998638, 10.984437, 11.795086, 12.071163, \</span>
<span class="sd">12.000937, 12.000002, 12.0, 12.0, 12.0, 12.0</span>
<span class="sd">        d_arv/d_h: 1.909826, 12.997489, 20.999995, 22.999999, 25.0, 33.0, \</span>
<span class="sd">40.96888, 42.590174, 43.142325, 43.001873, 43.000001</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_control</span><span class="o">.</span><span class="n">GTS</span><span class="p">,</span>
        <span class="n">lstream_control</span><span class="o">.</span><span class="n">BV</span><span class="p">,</span>
        <span class="n">lstream_control</span><span class="o">.</span><span class="n">BNV</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHV</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHVDH</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHLVR</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHLVRDH</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHRVR</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHRVRDH</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">WBLV</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">WBRV</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">gts</span><span class="p">):</span>
            <span class="n">d_temp1</span> <span class="o">=</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhlvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">d_temp2</span> <span class="o">=</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhvdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhlvrdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">wblv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">con</span><span class="o">.</span><span class="n">bnv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">d_temp1</span> <span class="o">*</span> <span class="n">d_temp2</span> <span class="o">/</span> <span class="mf">2.0</span>
                <span class="o">+</span> <span class="n">con</span><span class="o">.</span><span class="n">bnv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">d_temp2</span> <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhlvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="o">+</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">bnv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">d_temp1</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">+</span> <span class="n">con</span><span class="o">.</span><span class="n">bv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">d_temp2</span>
                <span class="o">+</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">bnv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">d_temp1</span> <span class="o">+</span> <span class="n">con</span><span class="o">.</span><span class="n">bv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhlvrdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">d_temp1</span> <span class="o">=</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhrvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">d_temp2</span> <span class="o">=</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhvdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhrvrdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">wbrv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">con</span><span class="o">.</span><span class="n">bnv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">d_temp1</span> <span class="o">*</span> <span class="n">d_temp2</span> <span class="o">/</span> <span class="mf">2.0</span>
                <span class="o">+</span> <span class="n">con</span><span class="o">.</span><span class="n">bnv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">d_temp2</span> <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhrvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="o">+</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">bnv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">d_temp1</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">+</span> <span class="n">con</span><span class="o">.</span><span class="n">bv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">d_temp2</span>
                <span class="o">+</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">bnv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">d_temp1</span> <span class="o">+</span> <span class="n">con</span><span class="o">.</span><span class="n">bv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhrvrdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="Calc_WBLVR_WBRVR_V1"><a class="viewcode-back" href="../../../../lstream.html#hydpy.models.lstream.lstream_model.Calc_WBLVR_WBRVR_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_WBLVR_WBRVR_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the water table width above both outer embankments.</span>

<span class="sd">    Examples:</span>

<span class="sd">        Due to :math:`WBVR = \\frac{dAVR}{dh}`, we can apply the class</span>
<span class="sd">        |NumericalDifferentiator| to validate the calculated water</span>
<span class="sd">        table widths:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lstream import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; gts(11)</span>
<span class="sd">        &gt;&gt;&gt; hm(1.0)</span>
<span class="sd">        &gt;&gt;&gt; bnvr(left=4.0, right=5.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.bnvrf.update()</span>
<span class="sd">        &gt;&gt;&gt; derived.hv(left=1.0, right=2.0)</span>
<span class="sd">        &gt;&gt;&gt; hr(0.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.hrp.update()</span>
<span class="sd">        &gt;&gt;&gt; states.h = 1.0, 1.5, 1.9, 2.0, 2.1, 2.5, 2.9, 3.0, 3.1, 3.5, 4.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhlvr_rhrvr_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhlvrdh_rhrvrdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_wblvr_wbrvr_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.wblvr</span>
<span class="sd">        wblvr(0.0, 0.0, 0.0, 0.0, 0.4, 2.0, 3.6, 4.0, 4.4, 6.0, 8.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.wbrvr</span>
<span class="sd">        wbrvr(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.5, 2.5, 5.0)</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import NumericalDifferentiator</span>
<span class="sd">        &gt;&gt;&gt; numdiff = NumericalDifferentiator(</span>
<span class="sd">        ...     xsequence=states.h,</span>
<span class="sd">        ...     ysequences=[aides.alvr, aides.arvr],</span>
<span class="sd">        ...     methods=[model.calc_rhlvr_rhrvr_v1,</span>
<span class="sd">        ...              model.calc_alvr_arvr_ulvr_urvr_v1])</span>
<span class="sd">        &gt;&gt;&gt; numdiff()</span>
<span class="sd">        d_alvr/d_h: 0.0, 0.0, 0.0, 0.0, 0.4, 2.0, 3.6, 4.0, 4.4, 6.0, 8.0</span>
<span class="sd">        d_arvr/d_h: 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.5, 2.5, 5.0</span>

<span class="sd">        &gt;&gt;&gt; hr(0.1)</span>
<span class="sd">        &gt;&gt;&gt; derived.hrp.update()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhlvr_rhrvr_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhlvrdh_rhrvrdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_wblvr_wbrvr_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.wblvr</span>
<span class="sd">        wblvr(0.0, 0.0, 0.006224, 0.081965, 0.371535, 1.999625, 3.599999, 4.0,</span>
<span class="sd">              4.4, 6.0, 8.0)</span>
<span class="sd">        &gt;&gt;&gt; aides.wbrvr</span>
<span class="sd">        wbrvr(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.00778, 0.102457, 0.464419,</span>
<span class="sd">              2.499532, 5.0)</span>

<span class="sd">        &gt;&gt;&gt; numdiff()</span>
<span class="sd">        d_alvr/d_h: 0.0, 0.0, 0.006224, 0.081965, 0.371535, 1.999625, \</span>
<span class="sd">3.599999, 4.0, 4.4, 6.0, 8.0</span>
<span class="sd">        d_arvr/d_h: 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.00778, 0.102457, \</span>
<span class="sd">0.464419, 2.499532, 5.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_control</span><span class="o">.</span><span class="n">GTS</span><span class="p">,</span>
        <span class="n">lstream_control</span><span class="o">.</span><span class="n">BNVR</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHLVR</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHLVRDH</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHRVR</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHRVRDH</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">WBLVR</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">WBRVR</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">gts</span><span class="p">):</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">wblvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">bnvr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhlvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhlvrdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">wbrvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">bnvr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhrvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">rhrvrdh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></div>


<div class="viewcode-block" id="Calc_WBG_V1"><a class="viewcode-back" href="../../../../lstream.html#hydpy.models.lstream.lstream_model.Calc_WBG_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_WBG_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the water level width of the total cross-section.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`WBG = WBM+WLV+WRV+WLVR+WRVR`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lstream import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; gts(2)</span>
<span class="sd">        &gt;&gt;&gt; aides.wbm = 0.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; aides.wblv = 2.0, 4.0</span>
<span class="sd">        &gt;&gt;&gt; aides.wbrv = 3.0, 5.0</span>
<span class="sd">        &gt;&gt;&gt; aides.wblvr = 6.0, 8.0</span>
<span class="sd">        &gt;&gt;&gt; aides.wbrvr = 7.0, 9.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_wbg_v1()</span>
<span class="sd">        &gt;&gt;&gt; aides.wbg</span>
<span class="sd">        wbg(18.0, 27.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_control</span><span class="o">.</span><span class="n">GTS</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">WBM</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">WBLV</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">WBRV</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">WBLVR</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">WBRVR</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_aides</span><span class="o">.</span><span class="n">WBG</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">gts</span><span class="p">):</span>
            <span class="n">aid</span><span class="o">.</span><span class="n">wbg</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">aid</span><span class="o">.</span><span class="n">wbm</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">aid</span><span class="o">.</span><span class="n">wblv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">aid</span><span class="o">.</span><span class="n">wbrv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">aid</span><span class="o">.</span><span class="n">wblvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">aid</span><span class="o">.</span><span class="n">wbrvr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="Calc_DH_V1"><a class="viewcode-back" href="../../../../lstream.html#hydpy.models.lstream.lstream_model.Calc_DH_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_DH_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Determine the change in the stage.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`DH = \\frac{QG_{i-1}-QG_i}{WBG \\cdot 1000 \\cdot Laen / GTS}`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lstream import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; laen(10.0)</span>
<span class="sd">        &gt;&gt;&gt; gts(5)</span>
<span class="sd">        &gt;&gt;&gt; aides.wbg(3.0, 3.5, 4.0, 3.5, 3.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qz = 1.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qg = 2.0, 3.0, 4.0, 3.0, 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_dh_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dh</span>
<span class="sd">        dh(-0.000167, -0.000143, -0.000125, 0.000143, 0.000167)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_control</span><span class="o">.</span><span class="n">Laen</span><span class="p">,</span>
        <span class="n">lstream_control</span><span class="o">.</span><span class="n">GTS</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_fluxes</span><span class="o">.</span><span class="n">QZ</span><span class="p">,</span>
        <span class="n">lstream_fluxes</span><span class="o">.</span><span class="n">QG</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">WBG</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_fluxes</span><span class="o">.</span><span class="n">DH</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">gts</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span><span class="p">:</span>
                <span class="n">d_qz</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">qg</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">d_qz</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">qz</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">dh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">d_qz</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">qg</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1000.0</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">laen</span> <span class="o">/</span> <span class="n">con</span><span class="o">.</span><span class="n">gts</span> <span class="o">*</span> <span class="n">aid</span><span class="o">.</span><span class="n">wbg</span><span class="p">[</span><span class="n">i</span><span class="p">])</span></div>


<div class="viewcode-block" id="Update_H_V1"><a class="viewcode-back" href="../../../../lstream.html#hydpy.models.lstream.lstream_model.Update_H_V1">[docs]</a><span class="k">class</span> <span class="nc">Update_H_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Update the stage.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`\\frac{dH}{dt} = DH`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lstream import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; gts(5)</span>
<span class="sd">        &gt;&gt;&gt; derived.sek(60*60)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dh = -0.12, -0.1, -0.09, 0.1, 0.12</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dh /= 60*60</span>
<span class="sd">        &gt;&gt;&gt; states.h(1.0, 1.2, 1.3, 1.2, 1.0)</span>
<span class="sd">        &gt;&gt;&gt; model.update_h_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.h</span>
<span class="sd">        h(0.88, 1.1, 1.21, 1.3, 1.12)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_control</span><span class="o">.</span><span class="n">GTS</span><span class="p">,)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_derived</span><span class="o">.</span><span class="n">Sek</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_fluxes</span><span class="o">.</span><span class="n">DH</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_states</span><span class="o">.</span><span class="n">H</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">old</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess_old</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess_new</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">gts</span><span class="p">):</span>
            <span class="n">new</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">old</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">der</span><span class="o">.</span><span class="n">sek</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">dh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></div>


<div class="viewcode-block" id="Update_VG_V1"><a class="viewcode-back" href="../../../../lstream.html#hydpy.models.lstream.lstream_model.Update_VG_V1">[docs]</a><span class="k">class</span> <span class="nc">Update_VG_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Update the water volume.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`\\frac{dV}{dt} = QG_{i-1}-QG_i`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lstream import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; gts(5)</span>
<span class="sd">        &gt;&gt;&gt; derived.sek(60*60)</span>
<span class="sd">        &gt;&gt;&gt; states.vg(1.0, 1.2, 1.3, 1.2, 1.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qza = 1.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qg = 3.0, 2.0, 4.0, 3.0, 5.0</span>
<span class="sd">        &gt;&gt;&gt; model.update_vg_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.vg</span>
<span class="sd">        vg(0.9928, 1.2036, 1.2928, 1.2036, 0.9928)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_control</span><span class="o">.</span><span class="n">GTS</span><span class="p">,)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_derived</span><span class="o">.</span><span class="n">Sek</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_fluxes</span><span class="o">.</span><span class="n">QZA</span><span class="p">,</span>
        <span class="n">lstream_fluxes</span><span class="o">.</span><span class="n">QG</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_states</span><span class="o">.</span><span class="n">VG</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">old</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess_old</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess_new</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">gts</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span><span class="p">:</span>
                <span class="n">new</span><span class="o">.</span><span class="n">vg</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">old</span><span class="o">.</span><span class="n">vg</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">der</span><span class="o">.</span><span class="n">sek</span> <span class="o">*</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">qg</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">qg</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="mf">1e6</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new</span><span class="o">.</span><span class="n">vg</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">old</span><span class="o">.</span><span class="n">vg</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">der</span><span class="o">.</span><span class="n">sek</span> <span class="o">*</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">qza</span> <span class="o">-</span> <span class="n">flu</span><span class="o">.</span><span class="n">qg</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="mf">1e6</span></div>


<div class="viewcode-block" id="Calc_QA_V1"><a class="viewcode-back" href="../../../../lstream.html#hydpy.models.lstream.lstream_model.Calc_QA_V1">[docs]</a><span class="k">class</span> <span class="nc">Calc_QA_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Query the actual outflow.</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lstream import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; gts(3)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qg = 2.0, 3.0, 4.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qa_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qa</span>
<span class="sd">        qa(4.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_control</span><span class="o">.</span><span class="n">GTS</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_fluxes</span><span class="o">.</span><span class="n">QG</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_fluxes</span><span class="o">.</span><span class="n">QA</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">qa</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">qg</span><span class="p">[</span><span class="n">con</span><span class="o">.</span><span class="n">gts</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span></div>


<div class="viewcode-block" id="Pass_Q_V1"><a class="viewcode-back" href="../../../../lstream.html#hydpy.models.lstream.lstream_model.Pass_Q_V1">[docs]</a><span class="k">class</span> <span class="nc">Pass_Q_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Pass the outflow to the outlet node.&quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_fluxes</span><span class="o">.</span><span class="n">QA</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">lstream_outlets</span><span class="o">.</span><span class="n">Q</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">outlets</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">out</span><span class="o">.</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">qa</span></div>


<div class="viewcode-block" id="Return_QF_V1"><a class="viewcode-back" href="../../../../lstream.html#hydpy.models.lstream.lstream_model.Return_QF_V1">[docs]</a><span class="k">class</span> <span class="nc">Return_QF_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate and return the &quot;error&quot; between the actual discharge and the</span>
<span class="sd">    discharge corresponding to the given water stage.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`Q(H) - QG_0`</span>

<span class="sd">    Method |Return_QF_V1| is a helper function not intended for performing</span>
<span class="sd">    simulation runs but for easing the implementation of method</span>
<span class="sd">    |lstream_v001.Model.calculate_characteristiclength| of application model</span>
<span class="sd">    |lstream_v001| (and similar functionalities).  More specifically, it</span>
<span class="sd">    defines the target function for the iterative root search triggered by</span>
<span class="sd">    method |Return_H_V1|.</span>

<span class="sd">    While method |Return_QF_V1| performs discharge calculations for all</span>
<span class="sd">    stream subsections, it evaluates only those of the first subsection.</span>
<span class="sd">    Accordingly, to avoid wasting computation time, one should not initialise</span>
<span class="sd">    more than one subsection before calling method |Return_QF_V1| (or methods</span>
<span class="sd">    |Return_H_V1| or |lstream_v001.Model.calculate_characteristiclength|).</span>

<span class="sd">    Example:</span>

<span class="sd">        We reuse the example given in the main documentation on module</span>
<span class="sd">        |lstream_v001|:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lstream import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;30m&quot;)</span>

<span class="sd">        &gt;&gt;&gt; gts(1)</span>
<span class="sd">        &gt;&gt;&gt; laen(100.0)</span>
<span class="sd">        &gt;&gt;&gt; gef(0.00025)</span>
<span class="sd">        &gt;&gt;&gt; bm(15.0)</span>
<span class="sd">        &gt;&gt;&gt; bnm(5.0)</span>
<span class="sd">        &gt;&gt;&gt; skm(1.0/0.035)</span>
<span class="sd">        &gt;&gt;&gt; hm(6.0)</span>
<span class="sd">        &gt;&gt;&gt; bv(100.0)</span>
<span class="sd">        &gt;&gt;&gt; bbv(20.0)</span>
<span class="sd">        &gt;&gt;&gt; bnv(10.0)</span>
<span class="sd">        &gt;&gt;&gt; bnvr(100.0)</span>
<span class="sd">        &gt;&gt;&gt; skv(10.0)</span>
<span class="sd">        &gt;&gt;&gt; ekm(1.0)</span>
<span class="sd">        &gt;&gt;&gt; ekv(1.0)</span>
<span class="sd">        &gt;&gt;&gt; hr(0.1)</span>
<span class="sd">        &gt;&gt;&gt; parameters.update()</span>

<span class="sd">        A water stage of 1 m results in a discharge of 7.7 m³/s:</span>

<span class="sd">        &gt;&gt;&gt; states.h = 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhm_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhmdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhv_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhvdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhlvr_rhrvr_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_rhlvrdh_rhrvrdh_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_am_um_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_alv_arv_ulv_urv_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_alvr_arvr_ulvr_urvr_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qm_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qlv_qrv_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qlvr_qrvr_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_ag_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.calc_qg_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.qg</span>
<span class="sd">        qg(7.745345)</span>

<span class="sd">        The calculated |QG| value serves as the &quot;true&quot; value.  Now, when</span>
<span class="sd">        passing stage values of 0.5 and 1.0 m, method |Return_QF_V1|</span>
<span class="sd">        calculates the corresponding discharge values and returns the</span>
<span class="sd">        &quot;errors&quot; -5.5 m³/s (a stage of 0.5 m results in a too-small discharge</span>
<span class="sd">        value) and 0.0 m³/s  (1.0 m is the &quot;true&quot; stage), respectively:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_qf_v1(0.5))</span>
<span class="sd">        -5.474691</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_qf_v1(1.0))</span>
<span class="sd">        0.0</span>

<span class="sd">        Note that method |Return_QF_V1| does not overwrite the first</span>
<span class="sd">        entry of |QG|, which would complicate its application within</span>
<span class="sd">        an iterative approach.</span>

<span class="sd">    Technical checks:</span>

<span class="sd">        Note that method |Return_QF_V1| calculates the value of sequence |QG|</span>
<span class="sd">        temporarily and resets it afterwards and calculates all other values</span>
<span class="sd">        of the mentioned sequences without resetting:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.core.testtools import check_selectedvariables</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.lstream.lstream_model import Return_QF_V1</span>
<span class="sd">        &gt;&gt;&gt; print(check_selectedvariables(Return_QF_V1))</span>
<span class="sd">        Definitely missing: qg</span>
<span class="sd">        Possibly missing (REQUIREDSEQUENCES):</span>
<span class="sd">            Calc_RHM_V1: H</span>
<span class="sd">            Calc_RHMDH_V1: H</span>
<span class="sd">            Calc_RHV_V1: H</span>
<span class="sd">            Calc_RHVDH_V1: H</span>
<span class="sd">            Calc_RHLVR_RHRVR_V1: H</span>
<span class="sd">            Calc_RHLVRDH_RHRVRDH_V1: H</span>
<span class="sd">            Calc_AM_UM_V1: RHM and RHV</span>
<span class="sd">            Calc_ALV_ARV_ULV_URV_V1: RHV, RHLVR, and RHRVR</span>
<span class="sd">            Calc_ALVR_ARVR_ULVR_URVR_V1: RHLVR and RHRVR</span>
<span class="sd">            Calc_QM_V1: AM and UM</span>
<span class="sd">            Calc_QLV_QRV_V1: ALV, ARV, ULV, and URV</span>
<span class="sd">            Calc_QLVR_QRVR_V1: ALVR, ARVR, ULVR, and URVR</span>
<span class="sd">            Calc_AG_V1: AM, ALV, ARV, ALVR, and ARVR</span>
<span class="sd">            Calc_QG_V1: QM, QLV, QRV, QLVR, and QRVR</span>
<span class="sd">        Possibly missing (RESULTSEQUENCES):</span>
<span class="sd">            Calc_QG_V1: QG</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Calc_RHM_V1</span><span class="p">,</span>
        <span class="n">Calc_RHMDH_V1</span><span class="p">,</span>
        <span class="n">Calc_RHV_V1</span><span class="p">,</span>
        <span class="n">Calc_RHVDH_V1</span><span class="p">,</span>
        <span class="n">Calc_RHLVR_RHRVR_V1</span><span class="p">,</span>
        <span class="n">Calc_RHLVRDH_RHRVRDH_V1</span><span class="p">,</span>
        <span class="n">Calc_AM_UM_V1</span><span class="p">,</span>
        <span class="n">Calc_ALV_ARV_ULV_URV_V1</span><span class="p">,</span>
        <span class="n">Calc_ALVR_ARVR_ULVR_URVR_V1</span><span class="p">,</span>
        <span class="n">Calc_QM_V1</span><span class="p">,</span>
        <span class="n">Calc_QLV_QRV_V1</span><span class="p">,</span>
        <span class="n">Calc_QLVR_QRVR_V1</span><span class="p">,</span>
        <span class="n">Calc_AG_V1</span><span class="p">,</span>
        <span class="n">Calc_QG_V1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_control</span><span class="o">.</span><span class="n">GTS</span><span class="p">,</span>
        <span class="n">lstream_control</span><span class="o">.</span><span class="n">HM</span><span class="p">,</span>
        <span class="n">lstream_control</span><span class="o">.</span><span class="n">BM</span><span class="p">,</span>
        <span class="n">lstream_control</span><span class="o">.</span><span class="n">BNM</span><span class="p">,</span>
        <span class="n">lstream_control</span><span class="o">.</span><span class="n">BV</span><span class="p">,</span>
        <span class="n">lstream_control</span><span class="o">.</span><span class="n">BNV</span><span class="p">,</span>
        <span class="n">lstream_control</span><span class="o">.</span><span class="n">BNVR</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_derived</span><span class="o">.</span><span class="n">HV</span><span class="p">,</span>
        <span class="n">lstream_derived</span><span class="o">.</span><span class="n">HRP</span><span class="p">,</span>
        <span class="n">lstream_derived</span><span class="o">.</span><span class="n">BNMF</span><span class="p">,</span>
        <span class="n">lstream_derived</span><span class="o">.</span><span class="n">BNVF</span><span class="p">,</span>
        <span class="n">lstream_derived</span><span class="o">.</span><span class="n">BNVRF</span><span class="p">,</span>
        <span class="n">lstream_derived</span><span class="o">.</span><span class="n">MFM</span><span class="p">,</span>
        <span class="n">lstream_derived</span><span class="o">.</span><span class="n">MFV</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_states</span><span class="o">.</span><span class="n">H</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHM</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHMDH</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHV</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHVDH</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHLVR</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHRVR</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHLVRDH</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHRVRDH</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">AM</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">UM</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">ALV</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">ARV</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">ULV</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">URV</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">ALVR</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">ARVR</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">ULVR</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">URVR</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">QM</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">QLV</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">QRV</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">QLVR</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">QRVR</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">AG</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">h</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">d_qg</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">qg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">sta</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">h</span>
        <span class="n">model</span><span class="o">.</span><span class="n">calc_rhm_v1</span><span class="p">()</span>
        <span class="n">model</span><span class="o">.</span><span class="n">calc_rhmdh_v1</span><span class="p">()</span>
        <span class="n">model</span><span class="o">.</span><span class="n">calc_rhv_v1</span><span class="p">()</span>
        <span class="n">model</span><span class="o">.</span><span class="n">calc_rhvdh_v1</span><span class="p">()</span>
        <span class="n">model</span><span class="o">.</span><span class="n">calc_rhlvr_rhrvr_v1</span><span class="p">()</span>
        <span class="n">model</span><span class="o">.</span><span class="n">calc_rhlvrdh_rhrvrdh_v1</span><span class="p">()</span>
        <span class="n">model</span><span class="o">.</span><span class="n">calc_am_um_v1</span><span class="p">()</span>
        <span class="n">model</span><span class="o">.</span><span class="n">calc_alv_arv_ulv_urv_v1</span><span class="p">()</span>
        <span class="n">model</span><span class="o">.</span><span class="n">calc_alvr_arvr_ulvr_urvr_v1</span><span class="p">()</span>
        <span class="n">model</span><span class="o">.</span><span class="n">calc_qm_v1</span><span class="p">()</span>
        <span class="n">model</span><span class="o">.</span><span class="n">calc_qlv_qrv_v1</span><span class="p">()</span>
        <span class="n">model</span><span class="o">.</span><span class="n">calc_qlvr_qrvr_v1</span><span class="p">()</span>
        <span class="n">model</span><span class="o">.</span><span class="n">calc_ag_v1</span><span class="p">()</span>
        <span class="n">model</span><span class="o">.</span><span class="n">calc_qg_v1</span><span class="p">()</span>
        <span class="n">d_error</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">qg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">d_qg</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">qg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">d_qg</span>
        <span class="k">return</span> <span class="n">d_error</span></div>


<div class="viewcode-block" id="Return_H_V1"><a class="viewcode-back" href="../../../../lstream.html#hydpy.models.lstream.lstream_model.Return_H_V1">[docs]</a><span class="k">class</span> <span class="nc">Return_H_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate and return the water stage corresponding to the current</span>
<span class="sd">    discharge value.</span>

<span class="sd">    Method |Return_H_V1| is a helper function not for performing</span>
<span class="sd">    simulation runs but for easing the implementation of method</span>
<span class="sd">    |lstream_v001.Model.calculate_characteristiclength| of application model</span>
<span class="sd">    |lstream_v001| (or similar functionalities).  More specifically, it</span>
<span class="sd">    performs a root search by applying the |Pegasus| method implemented</span>
<span class="sd">    in module `rootutils` on the target method |Return_QF_V1|.  Hence, please</span>
<span class="sd">    see the additional application notes in the documentation on method</span>
<span class="sd">    |Return_QF_V1|.</span>

<span class="sd">    Example:</span>

<span class="sd">        We recreate the exact parameterisation as in the example of the</span>
<span class="sd">        documentation on method |Return_QF_V1|:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lstream import *</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;30m&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>

<span class="sd">        &gt;&gt;&gt; gts(1)</span>
<span class="sd">        &gt;&gt;&gt; laen(100.0)</span>
<span class="sd">        &gt;&gt;&gt; gef(0.00025)</span>
<span class="sd">        &gt;&gt;&gt; bm(15.0)</span>
<span class="sd">        &gt;&gt;&gt; bnm(5.0)</span>
<span class="sd">        &gt;&gt;&gt; skm(1.0/0.035)</span>
<span class="sd">        &gt;&gt;&gt; hm(6.0)</span>
<span class="sd">        &gt;&gt;&gt; bv(100.0)</span>
<span class="sd">        &gt;&gt;&gt; bbv(20.0)</span>
<span class="sd">        &gt;&gt;&gt; bnv(10.0)</span>
<span class="sd">        &gt;&gt;&gt; bnvr(100.0)</span>
<span class="sd">        &gt;&gt;&gt; skv(10.0)</span>
<span class="sd">        &gt;&gt;&gt; ekm(1.0)</span>
<span class="sd">        &gt;&gt;&gt; ekv(1.0)</span>
<span class="sd">        &gt;&gt;&gt; hr(0.1)</span>
<span class="sd">        &gt;&gt;&gt; parameters.update()</span>

<span class="sd">        For a given discharge value of 7.7 m³/s (discussed in the documentation</span>
<span class="sd">        on method |Return_QF_V1|), method |Return_H_V1| correctly determines</span>
<span class="sd">        the water stage of 1 m:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.qg = 7.745345</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import print_values, round_</span>
<span class="sd">        &gt;&gt;&gt; round_(model.return_h_v1())</span>
<span class="sd">        1.0</span>

<span class="sd">        To evaluate the reliability of our implementation, we search for</span>
<span class="sd">        water stages covering an extensive range of discharge values.</span>
<span class="sd">        The last printed column shows that method |Return_H_V1| finds the</span>
<span class="sd">        correct water stage in all cases:</span>

<span class="sd">        &gt;&gt;&gt; import numpy</span>
<span class="sd">        &gt;&gt;&gt; for q in [0.0]+list(numpy.logspace(-6, 6, 13)):</span>
<span class="sd">        ...     fluxes.qg = q</span>
<span class="sd">        ...     h = model.return_h_v1()</span>
<span class="sd">        ...     states.h = h</span>
<span class="sd">        ...     model.calc_rhm_v1()</span>
<span class="sd">        ...     model.calc_rhmdh_v1()</span>
<span class="sd">        ...     model.calc_rhv_v1()</span>
<span class="sd">        ...     model.calc_rhvdh_v1()</span>
<span class="sd">        ...     model.calc_rhlvr_rhrvr_v1()</span>
<span class="sd">        ...     model.calc_rhlvrdh_rhrvrdh_v1()</span>
<span class="sd">        ...     model.calc_am_um_v1()</span>
<span class="sd">        ...     model.calc_alv_arv_ulv_urv_v1()</span>
<span class="sd">        ...     model.calc_alvr_arvr_ulvr_urvr_v1()</span>
<span class="sd">        ...     model.calc_qm_v1()</span>
<span class="sd">        ...     model.calc_qlv_qrv_v1()</span>
<span class="sd">        ...     model.calc_qlvr_qrvr_v1()</span>
<span class="sd">        ...     model.calc_ag_v1()</span>
<span class="sd">        ...     model.calc_qg_v1()</span>
<span class="sd">        ...     error = fluxes.qg[0]-q</span>
<span class="sd">        ...     print_values([q, h, error])</span>
<span class="sd">        0.0, -10.0, 0.0</span>
<span class="sd">        0.000001, -0.390737, 0.0</span>
<span class="sd">        0.00001, -0.308934, 0.0</span>
<span class="sd">        0.0001, -0.226779, 0.0</span>
<span class="sd">        0.001, -0.143209, 0.0</span>
<span class="sd">        0.01, -0.053833, 0.0</span>
<span class="sd">        0.1, 0.061356, 0.0</span>
<span class="sd">        1.0, 0.310079, 0.0</span>
<span class="sd">        10.0, 1.150307, 0.0</span>
<span class="sd">        100.0, 3.717833, 0.0</span>
<span class="sd">        1000.0, 9.108276, 0.0</span>
<span class="sd">        10000.0, 18.246131, 0.0</span>
<span class="sd">        100000.0, 37.330632, 0.0</span>
<span class="sd">        1000000.0, 81.363979, 0.0</span>

<span class="sd">        Due to smoothing the water stage with respect to the channel bottom,</span>
<span class="sd">        small discharge values result in negative water stages.  The smallest</span>
<span class="sd">        allowed stage is -10 m.</span>

<span class="sd">        Through setting the regularisation parameter |HR| to zero (which</span>
<span class="sd">        we do not recommend), method |Return_H_V1| should return the</span>
<span class="sd">        non-negative water stages agreeing with the original, discontinuous</span>
<span class="sd">        Manning-Strickler equation:</span>

<span class="sd">        &gt;&gt;&gt; hr(0.0)</span>
<span class="sd">        &gt;&gt;&gt; parameters.update()</span>
<span class="sd">        &gt;&gt;&gt; for q in [0.0]+list(numpy.logspace(-6, 6, 13)):</span>
<span class="sd">        ...     fluxes.qg = q</span>
<span class="sd">        ...     h = model.return_h_v1()</span>
<span class="sd">        ...     states.h = h</span>
<span class="sd">        ...     model.calc_rhm_v1()</span>
<span class="sd">        ...     model.calc_rhmdh_v1()</span>
<span class="sd">        ...     model.calc_rhv_v1()</span>
<span class="sd">        ...     model.calc_rhvdh_v1()</span>
<span class="sd">        ...     model.calc_rhlvr_rhrvr_v1()</span>
<span class="sd">        ...     model.calc_rhlvrdh_rhrvrdh_v1()</span>
<span class="sd">        ...     model.calc_am_um_v1()</span>
<span class="sd">        ...     model.calc_alv_arv_ulv_urv_v1()</span>
<span class="sd">        ...     model.calc_alvr_arvr_ulvr_urvr_v1()</span>
<span class="sd">        ...     model.calc_qm_v1()</span>
<span class="sd">        ...     model.calc_qlv_qrv_v1()</span>
<span class="sd">        ...     model.calc_qlvr_qrvr_v1()</span>
<span class="sd">        ...     model.calc_ag_v1()</span>
<span class="sd">        ...     model.calc_qg_v1()</span>
<span class="sd">        ...     error = fluxes.qg[0]-q</span>
<span class="sd">        ...     print_values([q, h, error])</span>
<span class="sd">        0.0, 0.0, 0.0</span>
<span class="sd">        0.000001, 0.00008, 0.0</span>
<span class="sd">        0.00001, 0.000317, 0.0</span>
<span class="sd">        0.0001, 0.001263, 0.0</span>
<span class="sd">        0.001, 0.005027, 0.0</span>
<span class="sd">        0.01, 0.019992, 0.0</span>
<span class="sd">        0.1, 0.079286, 0.0</span>
<span class="sd">        1.0, 0.31039, 0.0</span>
<span class="sd">        10.0, 1.150307, 0.0</span>
<span class="sd">        100.0, 3.717833, 0.0</span>
<span class="sd">        1000.0, 9.108276, 0.0</span>
<span class="sd">        10000.0, 18.246131, 0.0</span>
<span class="sd">        100000.0, 37.330632, 0.0</span>
<span class="sd">        1000000.0, 81.363979, 0.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Return_QF_V1</span><span class="p">,)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_control</span><span class="o">.</span><span class="n">GTS</span><span class="p">,</span>
        <span class="n">lstream_control</span><span class="o">.</span><span class="n">HM</span><span class="p">,</span>
        <span class="n">lstream_control</span><span class="o">.</span><span class="n">BM</span><span class="p">,</span>
        <span class="n">lstream_control</span><span class="o">.</span><span class="n">BNM</span><span class="p">,</span>
        <span class="n">lstream_control</span><span class="o">.</span><span class="n">BV</span><span class="p">,</span>
        <span class="n">lstream_control</span><span class="o">.</span><span class="n">BNV</span><span class="p">,</span>
        <span class="n">lstream_control</span><span class="o">.</span><span class="n">BNVR</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_derived</span><span class="o">.</span><span class="n">HV</span><span class="p">,</span>
        <span class="n">lstream_derived</span><span class="o">.</span><span class="n">HRP</span><span class="p">,</span>
        <span class="n">lstream_derived</span><span class="o">.</span><span class="n">BNMF</span><span class="p">,</span>
        <span class="n">lstream_derived</span><span class="o">.</span><span class="n">BNVF</span><span class="p">,</span>
        <span class="n">lstream_derived</span><span class="o">.</span><span class="n">BNVRF</span><span class="p">,</span>
        <span class="n">lstream_derived</span><span class="o">.</span><span class="n">MFM</span><span class="p">,</span>
        <span class="n">lstream_derived</span><span class="o">.</span><span class="n">MFV</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_states</span><span class="o">.</span><span class="n">H</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHM</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHMDH</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHV</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHVDH</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHLVR</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHRVR</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHLVRDH</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">RHRVRDH</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">AM</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">UM</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">ALV</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">ARV</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">ULV</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">URV</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">ALVR</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">ARVR</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">ULVR</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">URVR</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">QM</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">QLV</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">QRV</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">QLVR</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">QRVR</span><span class="p">,</span>
        <span class="n">lstream_aides</span><span class="o">.</span><span class="n">AG</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">pegasush</span><span class="o">.</span><span class="n">find_x</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">hm</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1e-10</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span></div>


<div class="viewcode-block" id="PegasusH"><a class="viewcode-back" href="../../../../lstream.html#hydpy.models.lstream.lstream_model.PegasusH">[docs]</a><span class="k">class</span> <span class="nc">PegasusH</span><span class="p">(</span><span class="n">roottools</span><span class="o">.</span><span class="n">Pegasus</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Pegasus iterator for finding the correct water stage.&quot;&quot;&quot;</span>

    <span class="n">METHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Return_QF_V1</span><span class="p">,)</span></div>


<div class="viewcode-block" id="Model"><a class="viewcode-back" href="../../../../lstream.html#hydpy.models.lstream.lstream_model.Model">[docs]</a><span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">ELSModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The HydPy-L-Stream model.&quot;&quot;&quot;</span>

    <span class="n">SOLVERPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">lstream_solver</span><span class="o">.</span><span class="n">AbsErrorMax</span><span class="p">,</span>
        <span class="n">lstream_solver</span><span class="o">.</span><span class="n">RelErrorMax</span><span class="p">,</span>
        <span class="n">lstream_solver</span><span class="o">.</span><span class="n">RelDTMin</span><span class="p">,</span>
        <span class="n">lstream_solver</span><span class="o">.</span><span class="n">RelDTMax</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">SOLVERSEQUENCES</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">INLET_METHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Pick_Q_V1</span><span class="p">,)</span>
    <span class="n">RECEIVER_METHODS</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">ADD_METHODS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Return_QF_V1</span><span class="p">,</span>
        <span class="n">Return_H_V1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">PART_ODE_METHODS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Calc_RHM_V1</span><span class="p">,</span>
        <span class="n">Calc_RHMDH_V1</span><span class="p">,</span>
        <span class="n">Calc_RHV_V1</span><span class="p">,</span>
        <span class="n">Calc_RHVDH_V1</span><span class="p">,</span>
        <span class="n">Calc_RHLVR_RHRVR_V1</span><span class="p">,</span>
        <span class="n">Calc_RHLVRDH_RHRVRDH_V1</span><span class="p">,</span>
        <span class="n">Calc_AM_UM_V1</span><span class="p">,</span>
        <span class="n">Calc_AMDH_UMDH_V1</span><span class="p">,</span>
        <span class="n">Calc_ALV_ARV_ULV_URV_V1</span><span class="p">,</span>
        <span class="n">Calc_ALVDH_ARVDH_ULVDH_URVDH_V1</span><span class="p">,</span>
        <span class="n">Calc_ALVR_ARVR_ULVR_URVR_V1</span><span class="p">,</span>
        <span class="n">Calc_ALVRDH_ARVRDH_ULVRDH_URVRDH_V1</span><span class="p">,</span>
        <span class="n">Calc_QM_V1</span><span class="p">,</span>
        <span class="n">Calc_QMDH_V1</span><span class="p">,</span>
        <span class="n">Calc_QM_V2</span><span class="p">,</span>
        <span class="n">Calc_QLV_QRV_V1</span><span class="p">,</span>
        <span class="n">Calc_QLVDH_QRVDH_V1</span><span class="p">,</span>
        <span class="n">Calc_QLV_QRV_V2</span><span class="p">,</span>
        <span class="n">Calc_QLVR_QRVR_V1</span><span class="p">,</span>
        <span class="n">Calc_QLVRDH_QRVRDH_V1</span><span class="p">,</span>
        <span class="n">Calc_QLVR_QRVR_V2</span><span class="p">,</span>
        <span class="n">Calc_AG_V1</span><span class="p">,</span>
        <span class="n">Calc_QG_V1</span><span class="p">,</span>
        <span class="n">Calc_QG_V2</span><span class="p">,</span>
        <span class="n">Calc_QA_V1</span><span class="p">,</span>
        <span class="n">Calc_WBM_V1</span><span class="p">,</span>
        <span class="n">Calc_WBLV_WBRV_V1</span><span class="p">,</span>
        <span class="n">Calc_WBLVR_WBRVR_V1</span><span class="p">,</span>
        <span class="n">Calc_WBG_V1</span><span class="p">,</span>
        <span class="n">Calc_DH_V1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">FULL_ODE_METHODS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Update_H_V1</span><span class="p">,</span>
        <span class="n">Update_VG_V1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">OUTLET_METHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Pass_Q_V1</span><span class="p">,)</span>
    <span class="n">SENDER_METHODS</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">SUBMODELS</span> <span class="o">=</span> <span class="p">(</span><span class="n">PegasusH</span><span class="p">,)</span></div>


<div class="viewcode-block" id="ProfileMixin"><a class="viewcode-back" href="../../../../lstream.html#hydpy.models.lstream.lstream_model.ProfileMixin">[docs]</a><span class="k">class</span> <span class="nc">ProfileMixin</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Mixin class for L-Stream models performing discharge calculations</span>
<span class="sd">    based on a triple trapezoid profile.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="ProfileMixin.plot_profile"><a class="viewcode-back" href="../../../../lstream.html#hydpy.models.lstream.lstream_model.ProfileMixin.plot_profile">[docs]</a>    <span class="k">def</span> <span class="nf">plot_profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labelformat</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%.1f</span><span class="s2">&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot the triple trapezoid profile and insert the discharge values</span>
<span class="sd">        at some characteristic stages.</span>

<span class="sd">        We reuse the second example given in the main documentation on module</span>
<span class="sd">        |lstream_v001|:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lstream_v001 import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;30m&quot;)</span>
<span class="sd">        &gt;&gt;&gt; laen(100.0)</span>
<span class="sd">        &gt;&gt;&gt; gef(0.00025)</span>
<span class="sd">        &gt;&gt;&gt; bm(15.0)</span>
<span class="sd">        &gt;&gt;&gt; bnm(5.0)</span>
<span class="sd">        &gt;&gt;&gt; skm(1.0/0.035)</span>
<span class="sd">        &gt;&gt;&gt; hm(6.0)</span>
<span class="sd">        &gt;&gt;&gt; bv(100.0)</span>
<span class="sd">        &gt;&gt;&gt; bbv(20.0)</span>
<span class="sd">        &gt;&gt;&gt; bnv(10.0)</span>
<span class="sd">        &gt;&gt;&gt; bnvr(100.0)</span>
<span class="sd">        &gt;&gt;&gt; skv(10.0)</span>
<span class="sd">        &gt;&gt;&gt; ekm(1.0)</span>
<span class="sd">        &gt;&gt;&gt; ekv(1.0)</span>
<span class="sd">        &gt;&gt;&gt; hr(0.1)</span>
<span class="sd">        &gt;&gt;&gt; gts(1)</span>
<span class="sd">        &gt;&gt;&gt; parameters.update()</span>

<span class="sd">        Calling method |ProfileMixin.plot_profile| prepares the profile</span>
<span class="sd">        plot and, depending on you `matplotlib` configuration, eventually</span>
<span class="sd">        prints it directly on your screen:</span>

<span class="sd">        &gt;&gt;&gt; model.plot_profile()</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.core.testtools import save_autofig</span>
<span class="sd">        &gt;&gt;&gt; save_autofig(&quot;lstream_plot_profile.png&quot;)</span>

<span class="sd">        .. image:: lstream_plot_profile.png</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">class</span> <span class="nc">_XYs</span><span class="p">:</span>
            <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_xs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ys</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span>

            <span class="k">def</span> <span class="fm">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dxdy</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_xs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">dxdy</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">dxdy</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="k">return</span> <span class="bp">self</span>

            <span class="k">def</span> <span class="fm">__isub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dxdy</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_xs</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">dxdy</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ys</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ys</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">dxdy</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="k">return</span> <span class="bp">self</span>

            <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ys</span>

        <span class="n">con</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span>
        <span class="n">der</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span>
        <span class="n">hmax</span> <span class="o">=</span> <span class="mf">1.3</span> <span class="o">*</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">hm</span> <span class="o">+</span> <span class="nb">max</span><span class="p">(</span><span class="n">der</span><span class="o">.</span><span class="n">hv</span><span class="p">))</span>

        <span class="n">xys</span> <span class="o">=</span> <span class="n">_XYs</span><span class="p">()</span>
        <span class="n">xys</span> <span class="o">+=</span> <span class="n">con</span><span class="o">.</span><span class="n">bm</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">0.0</span>
        <span class="n">xys</span> <span class="o">-=</span> <span class="n">con</span><span class="o">.</span><span class="n">bm</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">0.0</span>
        <span class="n">xys</span> <span class="o">+=</span> <span class="n">con</span><span class="o">.</span><span class="n">hm</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">bnm</span><span class="p">,</span> <span class="n">con</span><span class="o">.</span><span class="n">hm</span>
        <span class="n">xys</span> <span class="o">-=</span> <span class="n">con</span><span class="o">.</span><span class="n">hm</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">bnm</span><span class="p">,</span> <span class="n">con</span><span class="o">.</span><span class="n">hm</span>
        <span class="n">xys</span> <span class="o">+=</span> <span class="n">con</span><span class="o">.</span><span class="n">bv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.0</span>
        <span class="n">xys</span> <span class="o">-=</span> <span class="n">con</span><span class="o">.</span><span class="n">bv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.0</span>
        <span class="n">xys</span> <span class="o">+=</span> <span class="n">der</span><span class="o">.</span><span class="n">hv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">bnv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">der</span><span class="o">.</span><span class="n">hv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">xys</span> <span class="o">-=</span> <span class="n">der</span><span class="o">.</span><span class="n">hv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">bnv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">der</span><span class="o">.</span><span class="n">hv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">dh</span> <span class="o">=</span> <span class="n">hmax</span> <span class="o">-</span> <span class="n">der</span><span class="o">.</span><span class="n">hv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">hm</span>
        <span class="n">xys</span> <span class="o">+=</span> <span class="n">dh</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">bnvr</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dh</span>
        <span class="n">dh</span> <span class="o">=</span> <span class="n">hmax</span> <span class="o">-</span> <span class="n">der</span><span class="o">.</span><span class="n">hv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">hm</span>
        <span class="n">xys</span> <span class="o">-=</span> <span class="n">dh</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">bnvr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dh</span>
        <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span> <span class="o">=</span> <span class="n">xys</span><span class="p">()</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>

        <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">xs</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span>
        <span class="n">y0</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">ys</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">ys</span><span class="p">)</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">y0</span><span class="p">)</span> <span class="o">/</span> <span class="mf">80.0</span>
        <span class="n">hs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="mf">0.0</span><span class="p">,</span>
            <span class="n">con</span><span class="o">.</span><span class="n">hm</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span>
            <span class="n">con</span><span class="o">.</span><span class="n">hm</span><span class="p">,</span>
            <span class="n">con</span><span class="o">.</span><span class="n">hm</span> <span class="o">+</span> <span class="n">der</span><span class="o">.</span><span class="n">hv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span>
            <span class="n">con</span><span class="o">.</span><span class="n">hm</span> <span class="o">+</span> <span class="n">der</span><span class="o">.</span><span class="n">hv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">con</span><span class="o">.</span><span class="n">hm</span> <span class="o">+</span> <span class="n">der</span><span class="o">.</span><span class="n">hv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span>
            <span class="n">con</span><span class="o">.</span><span class="n">hm</span> <span class="o">+</span> <span class="n">der</span><span class="o">.</span><span class="n">hv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">hm</span> <span class="o">+</span> <span class="n">der</span><span class="o">.</span><span class="n">hv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">hmax</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span>
            <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">hm</span> <span class="o">+</span> <span class="n">der</span><span class="o">.</span><span class="n">hv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">hmax</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span>
            <span class="n">hmax</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">hs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">h</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">temp</span><span class="p">:</span>
                <span class="n">temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
        <span class="n">hs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
        <span class="n">qs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_qgvector</span><span class="p">(</span><span class="n">hs</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">hs</span><span class="p">,</span> <span class="n">qs</span><span class="p">)):</span>
            <span class="n">pyplot</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">],</span> <span class="p">[</span><span class="n">h</span><span class="p">,</span> <span class="n">h</span><span class="p">],</span> <span class="s2">&quot;b:&quot;</span><span class="p">)</span>
            <span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">labelformat</span> <span class="o">%</span> <span class="n">q</span><span class="si">}</span><span class="s2"> m³/s&quot;</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">pyplot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">h</span> <span class="o">+</span> <span class="n">dy</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pyplot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">h</span> <span class="o">+</span> <span class="n">dy</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>

        <span class="n">pyplot</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Profile of model </span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">elementphrase</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;height above the channel bottom [m]&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProfileMixin.prepare_hvector"><a class="viewcode-back" href="../../../../lstream.html#hydpy.models.lstream.lstream_model.ProfileMixin.prepare_hvector">[docs]</a>    <span class="k">def</span> <span class="nf">prepare_hvector</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">nmb</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="n">exp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">,</span>
        <span class="n">hmin</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">hmax</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Prepare a vector of the stage values.</span>

<span class="sd">        The argument `nmb` defines the number of stage values, `exp` defines</span>
<span class="sd">        their spacing (1.0 results in equidistant values), and `hmin` and</span>
<span class="sd">        `hmax` the lowest and highest water stage, respectively:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lstream_v001 import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import print_values</span>
<span class="sd">        &gt;&gt;&gt; print_values(model.prepare_hvector(</span>
<span class="sd">        ...     nmb=10, hmin=-1.0, hmax=8, exp=1.0))</span>
<span class="sd">        -1.0, 0.0, 1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0</span>

<span class="sd">        When not specified by the user, method</span>
<span class="sd">        |lstream_model.ProfileMixin.prepare_hvector| determines `hmin`</span>
<span class="sd">        and `hmax` based on the current value of |HM| (-10 % and 300 %,</span>
<span class="sd">        respectively) and takes a higher sampling rate in the lower value</span>
<span class="sd">        range (by setting `exp` to two):</span>

<span class="sd">        &gt;&gt;&gt; hm(6.0)</span>
<span class="sd">        &gt;&gt;&gt; print_values(model.prepare_hvector(nmb=10))</span>
<span class="sd">        -0.6, -0.37037, 0.318519, 1.466667, 3.074074, 5.140741, 7.666667,</span>
<span class="sd">        10.651852, 14.096296, 18.0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">hmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">hmin</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">hm</span>
        <span class="k">if</span> <span class="n">hmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">hmax</span> <span class="o">=</span> <span class="mf">3.0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">hm</span>
        <span class="n">hs</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">nmb</span><span class="p">)</span> <span class="o">**</span> <span class="n">exp</span>
        <span class="n">hs</span> <span class="o">/=</span> <span class="n">hs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">hs</span> <span class="o">*=</span> <span class="n">hmax</span> <span class="o">-</span> <span class="n">hmin</span>
        <span class="n">hs</span> <span class="o">+=</span> <span class="n">hmin</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">hs</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProfileMixin.calculate_qgvector"><a class="viewcode-back" href="../../../../lstream.html#hydpy.models.lstream.lstream_model.ProfileMixin.calculate_qgvector">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_qgvector</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">hvector</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Calculate the discharge values (in m³/s) corresponding to the</span>
<span class="sd">        given stage vector.</span>

<span class="sd">        We reuse the second example given in the main documentation on module</span>
<span class="sd">        |lstream_v001| also show the results of the similar methods</span>
<span class="sd">        |lstream_model.ProfileMixin.calculate_agvector| and</span>
<span class="sd">        |lstream_model.ProfileMixin.calculate_vgvector|:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.lstream_v001 import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; simulationstep(&quot;30m&quot;)</span>
<span class="sd">        &gt;&gt;&gt; laen(100.0)</span>
<span class="sd">        &gt;&gt;&gt; gef(0.00025)</span>
<span class="sd">        &gt;&gt;&gt; bm(15.0)</span>
<span class="sd">        &gt;&gt;&gt; bnm(5.0)</span>
<span class="sd">        &gt;&gt;&gt; skm(1.0/0.035)</span>
<span class="sd">        &gt;&gt;&gt; hm(6.0)</span>
<span class="sd">        &gt;&gt;&gt; bv(100.0)</span>
<span class="sd">        &gt;&gt;&gt; bbv(20.0)</span>
<span class="sd">        &gt;&gt;&gt; bnv(10.0)</span>
<span class="sd">        &gt;&gt;&gt; bnvr(100.0)</span>
<span class="sd">        &gt;&gt;&gt; skv(10.0)</span>
<span class="sd">        &gt;&gt;&gt; ekm(1.0)</span>
<span class="sd">        &gt;&gt;&gt; ekv(1.0)</span>
<span class="sd">        &gt;&gt;&gt; hr(0.1)</span>
<span class="sd">        &gt;&gt;&gt; gts(2)</span>
<span class="sd">        &gt;&gt;&gt; parameters.update()</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import print_values</span>
<span class="sd">        &gt;&gt;&gt; print_values(model.calculate_qgvector([0.0, 1.0, 2.0]))</span>
<span class="sd">        0.033153, 7.745345, 28.436875</span>
<span class="sd">        &gt;&gt;&gt; print_values(model.calculate_agvector([0.0, 1.0, 2.0]))</span>
<span class="sd">        0.623138, 20.0, 50.0</span>
<span class="sd">        &gt;&gt;&gt; print_values(model.calculate_vgvector([0.0, 1.0, 2.0]))</span>
<span class="sd">        0.031157, 1.0, 2.5</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">h_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">qg</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">hvector</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="n">h</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">calculate_single_terms</span><span class="p">()</span>
                <span class="n">qg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">qg</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">qg</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">h_</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProfileMixin.calculate_agvector"><a class="viewcode-back" href="../../../../lstream.html#hydpy.models.lstream.lstream_model.ProfileMixin.calculate_agvector">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_agvector</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">hvector</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Calculate the wetted cross-section areas (in m²) corresponding</span>
<span class="sd">        to the given vector of stage values.</span>

<span class="sd">        See the documentation on method</span>
<span class="sd">        |lstream_model.ProfileMixin.calculate_qgvector| for an example.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">h_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">ag</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">aides</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">hvector</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="n">h</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">calculate_single_terms</span><span class="p">()</span>
                <span class="n">ag</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">aid</span><span class="o">.</span><span class="n">am</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">aid</span><span class="o">.</span><span class="n">alv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">aid</span><span class="o">.</span><span class="n">arv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">aid</span><span class="o">.</span><span class="n">alvr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">aid</span><span class="o">.</span><span class="n">arvr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">ag</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">h_</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProfileMixin.calculate_vgvector"><a class="viewcode-back" href="../../../../lstream.html#hydpy.models.lstream.lstream_model.ProfileMixin.calculate_vgvector">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_vgvector</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">hvector</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Calculate the water volume stored within a channel subsection (in</span>
<span class="sd">        Mio m³) corresponding to the given vector of stage values.</span>

<span class="sd">        See the documentation on method</span>
<span class="sd">        |lstream_model.ProfileMixin.calculate_qgvector| for an example.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">con</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span>
        <span class="n">ags</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calculate_agvector</span><span class="p">(</span><span class="n">hvector</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">laen</span> <span class="o">/</span> <span class="n">con</span><span class="o">.</span><span class="n">gts</span> <span class="o">*</span> <span class="mf">1000.0</span> <span class="o">*</span> <span class="n">ags</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">)</span></div></div>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../../index.html">
              <img class="logo" src="../../../../_static/HydPy_Logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="../../../../index.html">Table of Contents</a></h3>
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../install.html">Installation Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../how_to.html">How to…</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../framework.html">Framework Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../modelcollection.html">Model Collection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../development.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../examples.html">Example Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../zbibliography.html">Bibliography</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">HydPy 4.0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">hydpy.models.lstream.lstream_model</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2021, HydPy Developers.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.5.2.
    </div>
  </body>
</html>