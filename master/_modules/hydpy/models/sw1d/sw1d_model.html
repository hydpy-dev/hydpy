<!DOCTYPE html>

<html lang="en" data-content_root="../../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>hydpy.models.sw1d.sw1d_model &#8212; HydPy 6.3dev0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/classic.css?v=127cebf3" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/graphviz.css?v=4ae1632d" />
    
    <script src="../../../../_static/documentation_options.js?v=6fd2034b"></script>
    <script src="../../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">HydPy 6.3dev0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">hydpy.models.sw1d.sw1d_model</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../../index.html">
              <img class="logo" src="../../../../_static/HydPy_Logo.png" alt="Logo"/>
            </a></p>
  <div>
    <h3><a href="../../../../index.html">Table of Contents</a></h3>
    <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../example_projects.html">Example Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../user_guide.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer_guide.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference_manual.html">Reference Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../zbibliography.html">Bibliography</a></li>
</ul>

  </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for hydpy.models.sw1d.sw1d_model</h1><div class="highlight"><pre>
<span></span><span class="c1"># pylint: disable=missing-module-docstring</span>

<span class="c1"># import...</span>
<span class="c1"># ...from HydPy</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">importtools</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">modeltools</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.core.typingtools</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.cythons</span><span class="w"> </span><span class="kn">import</span> <span class="n">modelutils</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.cythons</span><span class="w"> </span><span class="kn">import</span> <span class="n">smoothutils</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.interfaces</span><span class="w"> </span><span class="kn">import</span> <span class="n">routinginterfaces</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.sw1d</span><span class="w"> </span><span class="kn">import</span> <span class="n">sw1d_control</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.sw1d</span><span class="w"> </span><span class="kn">import</span> <span class="n">sw1d_derived</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.sw1d</span><span class="w"> </span><span class="kn">import</span> <span class="n">sw1d_fixed</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.sw1d</span><span class="w"> </span><span class="kn">import</span> <span class="n">sw1d_inlets</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.sw1d</span><span class="w"> </span><span class="kn">import</span> <span class="n">sw1d_outlets</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.sw1d</span><span class="w"> </span><span class="kn">import</span> <span class="n">sw1d_factors</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.sw1d</span><span class="w"> </span><span class="kn">import</span> <span class="n">sw1d_fluxes</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.sw1d</span><span class="w"> </span><span class="kn">import</span> <span class="n">sw1d_states</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydpy.models.sw1d</span><span class="w"> </span><span class="kn">import</span> <span class="n">sw1d_senders</span>


<span class="c1"># pick data from and pass data to link sequences</span>

<span class="n">RoutingModels_V1_V2</span><span class="p">:</span> <span class="n">TypeAlias</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span>
    <span class="s2">&quot;routinginterfaces.RoutingModel_V1&quot;</span><span class="p">,</span> <span class="s2">&quot;routinginterfaces.RoutingModel_V2&quot;</span>
<span class="p">]</span>
<span class="n">RoutingModels_V1_V2_V3</span><span class="p">:</span> <span class="n">TypeAlias</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span>
    <span class="s2">&quot;routinginterfaces.RoutingModel_V1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;routinginterfaces.RoutingModel_V2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;routinginterfaces.RoutingModel_V3&quot;</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">RoutingModels_V2_V3</span><span class="p">:</span> <span class="n">TypeAlias</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span>
    <span class="s2">&quot;routinginterfaces.RoutingModel_V2&quot;</span><span class="p">,</span> <span class="s2">&quot;routinginterfaces.RoutingModel_V3&quot;</span>
<span class="p">]</span>


<div class="viewcode-block" id="Pick_Inflow_V1">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Pick_Inflow_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Pick_Inflow_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pick the longitudinal inflow from an arbitrary number of inlet sequences.</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.sw1d import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; inlets.longq.shape = 2</span>
<span class="sd">        &gt;&gt;&gt; inlets.longq = 2.0, 4.0</span>
<span class="sd">        &gt;&gt;&gt; model.pick_inflow_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.inflow</span>
<span class="sd">        inflow(6.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_inlets</span><span class="o">.</span><span class="n">LongQ</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_fluxes</span><span class="o">.</span><span class="n">Inflow</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">inl</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">inlets</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">inflow</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">inl</span><span class="o">.</span><span class="n">len_longq</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">inflow</span> <span class="o">+=</span> <span class="n">inl</span><span class="o">.</span><span class="n">longq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></div>



<div class="viewcode-block" id="Pick_Outflow_V1">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Pick_Outflow_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Pick_Outflow_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pick the longitudinal outflow from an arbitrary number of outlet sequences.</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.sw1d import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; inlets.longq.shape = 2</span>
<span class="sd">        &gt;&gt;&gt; inlets.longq = 2.0, 4.0</span>
<span class="sd">        &gt;&gt;&gt; model.pick_outflow_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.outflow</span>
<span class="sd">        outflow(6.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_inlets</span><span class="o">.</span><span class="n">LongQ</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_fluxes</span><span class="o">.</span><span class="n">Outflow</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">inl</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">inlets</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">outflow</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">inl</span><span class="o">.</span><span class="n">len_longq</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">outflow</span> <span class="o">+=</span> <span class="n">inl</span><span class="o">.</span><span class="n">longq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></div>



<div class="viewcode-block" id="Pick_LateralFlow_V1">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Pick_LateralFlow_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Pick_LateralFlow_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pick the lateral inflow from an arbitrary number of inlet sequences.</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.sw1d import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; inlets.latq.shape = 2</span>
<span class="sd">        &gt;&gt;&gt; inlets.latq = 2.0, 4.0</span>
<span class="sd">        &gt;&gt;&gt; model.pick_lateralflow_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.lateralflow</span>
<span class="sd">        lateralflow(6.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_inlets</span><span class="o">.</span><span class="n">LatQ</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_fluxes</span><span class="o">.</span><span class="n">LateralFlow</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SegmentModel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">inl</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">inlets</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">lateralflow</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">inl</span><span class="o">.</span><span class="n">len_latq</span><span class="p">):</span>
            <span class="n">flu</span><span class="o">.</span><span class="n">lateralflow</span> <span class="o">+=</span> <span class="n">inl</span><span class="o">.</span><span class="n">latq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></div>



<div class="viewcode-block" id="Pick_WaterLevelDownstream_V1">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Pick_WaterLevelDownstream_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Pick_WaterLevelDownstream_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pick the water level downstream from a receiver sequence.</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.sw1d import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; inlets.waterlevel = 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.pick_waterleveldownstream_v1()</span>
<span class="sd">        &gt;&gt;&gt; factors.waterleveldownstream</span>
<span class="sd">        waterleveldownstream(2.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_inlets</span><span class="o">.</span><span class="n">WaterLevel</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevelDownstream</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SegmentModel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">inl</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">inlets</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span><span class="o">.</span><span class="n">waterleveldownstream</span> <span class="o">=</span> <span class="n">inl</span><span class="o">.</span><span class="n">waterlevel</span></div>



<div class="viewcode-block" id="Pass_Discharge_V1">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Pass_Discharge_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Pass_Discharge_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pass the calculated average discharge of the current simulation step to an</span>
<span class="sd">    arbitrary number of outlet sequences.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`QLong = DischargeVolume / Seconds`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.sw1d import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; derived.seconds(60.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dischargevolume = 120.0</span>
<span class="sd">        &gt;&gt;&gt; outlets.longq.shape = 2</span>
<span class="sd">        &gt;&gt;&gt; model.pass_discharge_v1()</span>
<span class="sd">        &gt;&gt;&gt; outlets.longq</span>
<span class="sd">        longq(2.0, 2.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_derived</span><span class="o">.</span><span class="n">Seconds</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_fluxes</span><span class="o">.</span><span class="n">DischargeVolume</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_outlets</span><span class="o">.</span><span class="n">LongQ</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">outlets</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">discharge</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">dischargevolume</span> <span class="o">/</span> <span class="n">der</span><span class="o">.</span><span class="n">seconds</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">len_longq</span><span class="p">):</span>
            <span class="n">out</span><span class="o">.</span><span class="n">longq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">discharge</span></div>



<div class="viewcode-block" id="Pass_WaterLevel_V1">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Pass_WaterLevel_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Pass_WaterLevel_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pass the calculated water level to an arbitrary number of sender sequences.</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.sw1d import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; factors.waterlevel = 2.0</span>
<span class="sd">        &gt;&gt;&gt; senders.waterlevel.shape = 3</span>
<span class="sd">        &gt;&gt;&gt; model.pass_waterlevel_v1()</span>
<span class="sd">        &gt;&gt;&gt; senders.waterlevel</span>
<span class="sd">        waterlevel(2.0, 2.0, 2.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevel</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_senders</span><span class="o">.</span><span class="n">WaterLevel</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SegmentModel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sen</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">senders</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sen</span><span class="o">.</span><span class="n">len_waterlevel</span><span class="p">):</span>
            <span class="n">sen</span><span class="o">.</span><span class="n">waterlevel</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">fac</span><span class="o">.</span><span class="n">waterlevel</span></div>



<span class="c1"># calculation methods</span>


<div class="viewcode-block" id="Calc_MaxTimeStep_V1">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Calc_MaxTimeStep_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_MaxTimeStep_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Estimate the highest possible computation time step for which we can expect</span>
<span class="sd">    stability for a central LIAS-like routing model.</span>

<span class="sd">    Basic equation :cite:p:`ref-Bates2010`:</span>
<span class="sd">      :math:`MaxTimeStep = TimeStepFactor \cdot</span>
<span class="sd">      \frac{1000 \cdot LengthMin}{GravitationalAcceleration \cdot WaterDepth}`</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.sw1d import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; timestepfactor(0.5)</span>
<span class="sd">        &gt;&gt;&gt; derived.lengthmin(2.0)</span>
<span class="sd">        &gt;&gt;&gt; factors.waterdepth = 4.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_maxtimestep_v1()</span>
<span class="sd">        &gt;&gt;&gt; factors.maxtimestep</span>
<span class="sd">        maxtimestep(159.637714)</span>

<span class="sd">        |Calc_MaxTimeStep_V1| handles the case of zero water depth by setting the</span>
<span class="sd">        maximum time step to infinity:</span>

<span class="sd">        &gt;&gt;&gt; factors.waterdepth = 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_maxtimestep_v1()</span>
<span class="sd">        &gt;&gt;&gt; factors.maxtimestep</span>
<span class="sd">        maxtimestep(inf)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_control</span><span class="o">.</span><span class="n">TimeStepFactor</span><span class="p">,)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_derived</span><span class="o">.</span><span class="n">LengthMin</span><span class="p">,)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_fixed</span><span class="o">.</span><span class="n">GravitationalAcceleration</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterDepth</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_factors</span><span class="o">.</span><span class="n">MaxTimeStep</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">if</span> <span class="n">fac</span><span class="o">.</span><span class="n">waterdepth</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">fac</span><span class="o">.</span><span class="n">maxtimestep</span> <span class="o">=</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">timestepfactor</span> <span class="o">*</span> <span class="mf">1000.0</span> <span class="o">*</span> <span class="n">der</span><span class="o">.</span><span class="n">lengthmin</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
                <span class="n">fix</span><span class="o">.</span><span class="n">gravitationalacceleration</span> <span class="o">*</span> <span class="n">fac</span><span class="o">.</span><span class="n">waterdepth</span>
            <span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fac</span><span class="o">.</span><span class="n">maxtimestep</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">inf</span></div>



<div class="viewcode-block" id="Calc_MaxTimeStep_V2">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Calc_MaxTimeStep_V2">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_MaxTimeStep_V2</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Estimate the highest possible computation time step for which we can expect</span>
<span class="sd">    stability for an inflow-providing routing model.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`MaxTimeStep = TimeStepFactor \cdot</span>
<span class="sd">      \frac{1000 \cdot LengthDownstream}{5 / 3 \cdot |Inflow| \cdot WettedArea}`</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.sw1d import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; timestepfactor(0.5)</span>
<span class="sd">        &gt;&gt;&gt; lengthdownstream(2.0)</span>
<span class="sd">        &gt;&gt;&gt; factors.wettedarea = 5.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.inflow = 6.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_maxtimestep_v2()</span>
<span class="sd">        &gt;&gt;&gt; factors.maxtimestep</span>
<span class="sd">        maxtimestep(500.0)</span>

<span class="sd">        For zero inflow values, the computation time step needs no restriction:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.inflow = 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_maxtimestep_v2()</span>
<span class="sd">        &gt;&gt;&gt; factors.maxtimestep</span>
<span class="sd">        maxtimestep(inf)</span>

<span class="sd">        To prevent zero division, |Calc_MaxTimeStep_V2| also sets the maximum time step</span>
<span class="sd">        to infinity if there is no wetted area:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.inflow = 6.0</span>
<span class="sd">        &gt;&gt;&gt; factors.wettedarea = 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_maxtimestep_v2()</span>
<span class="sd">        &gt;&gt;&gt; factors.maxtimestep</span>
<span class="sd">        maxtimestep(inf)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_control</span><span class="o">.</span><span class="n">LengthDownstream</span><span class="p">,</span> <span class="n">sw1d_control</span><span class="o">.</span><span class="n">TimeStepFactor</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_fluxes</span><span class="o">.</span><span class="n">Inflow</span><span class="p">,</span> <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WettedArea</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_factors</span><span class="o">.</span><span class="n">MaxTimeStep</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">inflow</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">fac</span><span class="o">.</span><span class="n">wettedarea</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">):</span>
            <span class="n">cel</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="mf">5.0</span> <span class="o">/</span> <span class="mf">3.0</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">inflow</span> <span class="o">/</span> <span class="n">fac</span><span class="o">.</span><span class="n">wettedarea</span><span class="p">)</span>
            <span class="n">fac</span><span class="o">.</span><span class="n">maxtimestep</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">timestepfactor</span> <span class="o">*</span> <span class="mf">1000.0</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">lengthdownstream</span> <span class="o">/</span> <span class="n">cel</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fac</span><span class="o">.</span><span class="n">maxtimestep</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">inf</span></div>



<div class="viewcode-block" id="Calc_MaxTimeStep_V3">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Calc_MaxTimeStep_V3">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_MaxTimeStep_V3</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Estimate the highest possible computation time step for which we can expect</span>
<span class="sd">    stability for a weir-like routing model.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      .. math::</span>
<span class="sd">        MaxTimeStep = f \cdot \frac{1000 \cdot l}{c\cdot \sqrt{2 \cdot g \cdot h}}</span>
<span class="sd">        \\ \\</span>
<span class="sd">        f = TimeStepFactor \\</span>
<span class="sd">        l = LengthDownstream \\</span>
<span class="sd">        c = FlowCoefficient \\</span>
<span class="sd">        g = GravitationalAcceleration \\</span>
<span class="sd">        h = WaterLevel - CrestHeight</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.sw1d import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; crestheight(5.0)</span>
<span class="sd">        &gt;&gt;&gt; flowcoefficient(0.6)</span>
<span class="sd">        &gt;&gt;&gt; timestepfactor(0.5)</span>
<span class="sd">        &gt;&gt;&gt; lengthupstream(2.0)</span>
<span class="sd">        &gt;&gt;&gt; factors.waterlevel = 7.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_maxtimestep_v3()</span>
<span class="sd">        &gt;&gt;&gt; factors.maxtimestep</span>
<span class="sd">        maxtimestep(266.062857)</span>

<span class="sd">        For water levels equal to or below the crest height, the flow over the weir is</span>
<span class="sd">        zero and thus cannot cause instability.  Hence, |Calc_MaxTimeStep_V3| sets</span>
<span class="sd">        |MaxTimeStep| to infinity in such cases:</span>

<span class="sd">        &gt;&gt;&gt; factors.waterlevel = 5.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_maxtimestep_v3()</span>
<span class="sd">        &gt;&gt;&gt; factors.maxtimestep</span>
<span class="sd">        maxtimestep(inf)</span>
<span class="sd">        &gt;&gt;&gt; factors.waterlevel = 3.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_maxtimestep_v3()</span>
<span class="sd">        &gt;&gt;&gt; factors.maxtimestep</span>
<span class="sd">        maxtimestep(inf)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">sw1d_control</span><span class="o">.</span><span class="n">LengthUpstream</span><span class="p">,</span>
        <span class="n">sw1d_control</span><span class="o">.</span><span class="n">TimeStepFactor</span><span class="p">,</span>
        <span class="n">sw1d_control</span><span class="o">.</span><span class="n">FlowCoefficient</span><span class="p">,</span>
        <span class="n">sw1d_control</span><span class="o">.</span><span class="n">CrestHeight</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_fixed</span><span class="o">.</span><span class="n">GravitationalAcceleration</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevel</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_factors</span><span class="o">.</span><span class="n">MaxTimeStep</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">h</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">fac</span><span class="o">.</span><span class="n">waterlevel</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">crestheight</span>
        <span class="k">if</span> <span class="n">h</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">c</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">flowcoefficient</span>
            <span class="n">g</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">fix</span><span class="o">.</span><span class="n">gravitationalacceleration</span>
            <span class="n">cel</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">c</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">g</span> <span class="o">*</span> <span class="n">h</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span>
            <span class="n">fac</span><span class="o">.</span><span class="n">maxtimestep</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">timestepfactor</span> <span class="o">*</span> <span class="mf">1000.0</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">lengthupstream</span> <span class="o">/</span> <span class="n">cel</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fac</span><span class="o">.</span><span class="n">maxtimestep</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">inf</span></div>



<div class="viewcode-block" id="Calc_MaxTimeStep_V4">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Calc_MaxTimeStep_V4">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_MaxTimeStep_V4</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Estimate the highest possible computation time step for which we can expect</span>
<span class="sd">    stability for an outflow-providing routing model.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`MaxTimeStep = TimeStepFactor \cdot</span>
<span class="sd">      \frac{1000 \cdot LengthUpstream}{5 / 3 \cdot |Outflow| \cdot WettedArea}`</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.sw1d import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; timestepfactor(0.5)</span>
<span class="sd">        &gt;&gt;&gt; lengthupstream(2.0)</span>
<span class="sd">        &gt;&gt;&gt; factors.wettedarea = 5.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.outflow = 6.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_maxtimestep_v4()</span>
<span class="sd">        &gt;&gt;&gt; factors.maxtimestep</span>
<span class="sd">        maxtimestep(500.0)</span>

<span class="sd">        For zero outflow values, the computation time step needs no restriction:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.outflow = 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_maxtimestep_v4()</span>
<span class="sd">        &gt;&gt;&gt; factors.maxtimestep</span>
<span class="sd">        maxtimestep(inf)</span>

<span class="sd">        To prevent zero division, |Calc_MaxTimeStep_V4| also sets the maximum time step</span>
<span class="sd">        to infinity if there is no wetted area:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.outflow = 6.0</span>
<span class="sd">        &gt;&gt;&gt; factors.wettedarea = 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_maxtimestep_v4()</span>
<span class="sd">        &gt;&gt;&gt; factors.maxtimestep</span>
<span class="sd">        maxtimestep(inf)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_control</span><span class="o">.</span><span class="n">LengthUpstream</span><span class="p">,</span> <span class="n">sw1d_control</span><span class="o">.</span><span class="n">TimeStepFactor</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_fluxes</span><span class="o">.</span><span class="n">Outflow</span><span class="p">,</span> <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WettedArea</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_factors</span><span class="o">.</span><span class="n">MaxTimeStep</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">flu</span><span class="o">.</span><span class="n">outflow</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">fac</span><span class="o">.</span><span class="n">wettedarea</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">):</span>
            <span class="n">cel</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="mf">5.0</span> <span class="o">/</span> <span class="mf">3.0</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">outflow</span> <span class="o">/</span> <span class="n">fac</span><span class="o">.</span><span class="n">wettedarea</span><span class="p">)</span>
            <span class="n">fac</span><span class="o">.</span><span class="n">maxtimestep</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">timestepfactor</span> <span class="o">*</span> <span class="mf">1000.0</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">lengthupstream</span> <span class="o">/</span> <span class="n">cel</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fac</span><span class="o">.</span><span class="n">maxtimestep</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">inf</span></div>



<div class="viewcode-block" id="Calc_MaxTimeStep_V5">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Calc_MaxTimeStep_V5">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_MaxTimeStep_V5</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Estimate the highest possible computation time step for which we can expect</span>
<span class="sd">    stability for a gate-like routing model.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      .. math::</span>
<span class="sd">        MaxTimeStep = f \cdot \frac{1000 \cdot l}{c \cdot \big( min (h, \ l) - b \big)</span>
<span class="sd">        \cdot \sqrt{2 \cdot g  \cdot (l_u - l_d)}}</span>
<span class="sd">        \\ \\</span>
<span class="sd">        f = TimeStepFactor \\</span>
<span class="sd">        c = FlowCoefficient \\</span>
<span class="sd">        h = GateHeight \\</span>
<span class="sd">        l = WaterLevel \\</span>
<span class="sd">        l_u = WaterLevelUpstream \\</span>
<span class="sd">        l_d = WaterLevelDownstream\\</span>
<span class="sd">        b = BottomLevel \\</span>
<span class="sd">        g = GravitationalAcceleration</span>

<span class="sd">    Examples:</span>

<span class="sd">        The following examples all correspond to selected ones of |Calc_Discharge_V3|.</span>

<span class="sd">        The case of a submerged gate and downstream flow:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.sw1d import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; bottomlevel(4.0)</span>
<span class="sd">        &gt;&gt;&gt; gateheight(6.0)</span>
<span class="sd">        &gt;&gt;&gt; flowcoefficient(0.6)</span>
<span class="sd">        &gt;&gt;&gt; lengthupstream(4.0)</span>
<span class="sd">        &gt;&gt;&gt; timestepfactor(0.5)</span>
<span class="sd">        &gt;&gt;&gt; factors.waterlevel = 8.0</span>
<span class="sd">        &gt;&gt;&gt; factors.waterlevelupstream = 9.0</span>
<span class="sd">        &gt;&gt;&gt; factors.waterleveldownstream = 7.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_maxtimestep_v5()</span>
<span class="sd">        &gt;&gt;&gt; factors.maxtimestep</span>
<span class="sd">        maxtimestep(266.062857)</span>

<span class="sd">        The case of a non-submerged gate and upstream flow:</span>

<span class="sd">        &gt;&gt;&gt; gateheight(8.0)</span>
<span class="sd">        &gt;&gt;&gt; factors.waterlevelupstream = 7.0</span>
<span class="sd">        &gt;&gt;&gt; factors.waterleveldownstream = 9.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_maxtimestep_v5()</span>
<span class="sd">        &gt;&gt;&gt; factors.maxtimestep</span>
<span class="sd">        maxtimestep(133.031429)</span>

<span class="sd">        The case of a negative effective gate opening with zero discharge:</span>

<span class="sd">        &gt;&gt;&gt; gateheight(0.0)</span>
<span class="sd">        &gt;&gt;&gt; factors.waterlevelupstream = 7.0</span>
<span class="sd">        &gt;&gt;&gt; factors.waterleveldownstream = 9.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_maxtimestep_v5()</span>
<span class="sd">        &gt;&gt;&gt; factors.maxtimestep</span>
<span class="sd">        maxtimestep(inf)</span>

<span class="sd">        The case of identical water levels:</span>

<span class="sd">        &gt;&gt;&gt; gateheight(8.0)</span>
<span class="sd">        &gt;&gt;&gt; factors.waterlevelupstream = 6.0</span>
<span class="sd">        &gt;&gt;&gt; factors.waterleveldownstream = 6.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_maxtimestep_v5()</span>
<span class="sd">        &gt;&gt;&gt; factors.maxtimestep</span>
<span class="sd">        maxtimestep(inf)</span>

<span class="sd">        The case of a controlled gate opening:</span>

<span class="sd">        &gt;&gt;&gt; def sluice(model) -&gt; None:</span>
<span class="sd">        ...     con = model.parameters.control.fastaccess</span>
<span class="sd">        ...     fac = model.sequences.factors.fastaccess</span>
<span class="sd">        ...     if fac.waterlevelupstream &lt; fac.waterleveldownstream:</span>
<span class="sd">        ...         con.gateheight = 4.0</span>
<span class="sd">        ...     else:</span>
<span class="sd">        ...         con.gateheight = 10.0</span>
<span class="sd">        &gt;&gt;&gt; gateheight(callback=sluice)</span>
<span class="sd">        &gt;&gt;&gt; factors.waterlevelupstream = 9.0</span>
<span class="sd">        &gt;&gt;&gt; factors.waterleveldownstream = 7.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_maxtimestep_v5()</span>
<span class="sd">        &gt;&gt;&gt; factors.maxtimestep</span>
<span class="sd">        maxtimestep(133.031429)</span>
<span class="sd">        &gt;&gt;&gt; factors.waterlevelupstream = 7.0</span>
<span class="sd">        &gt;&gt;&gt; factors.waterleveldownstream = 9.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_maxtimestep_v5()</span>
<span class="sd">        &gt;&gt;&gt; factors.maxtimestep</span>
<span class="sd">        maxtimestep(inf)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">sw1d_control</span><span class="o">.</span><span class="n">LengthUpstream</span><span class="p">,</span>
        <span class="n">sw1d_control</span><span class="o">.</span><span class="n">BottomLevel</span><span class="p">,</span>
        <span class="n">sw1d_control</span><span class="o">.</span><span class="n">GateHeight</span><span class="p">,</span>
        <span class="n">sw1d_control</span><span class="o">.</span><span class="n">FlowCoefficient</span><span class="p">,</span>
        <span class="n">sw1d_control</span><span class="o">.</span><span class="n">TimeStepFactor</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_fixed</span><span class="o">.</span><span class="n">GravitationalAcceleration</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevel</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevelUpstream</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevelDownstream</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_factors</span><span class="o">.</span><span class="n">MaxTimeStep</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">con</span><span class="o">.</span><span class="n">gateheight_callback</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="n">h</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">gateheight</span><span class="p">,</span> <span class="n">fac</span><span class="o">.</span><span class="n">waterlevel</span><span class="p">)</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">bottomlevel</span>
        <span class="k">if</span> <span class="n">h</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">c</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">flowcoefficient</span>
            <span class="n">g</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">fix</span><span class="o">.</span><span class="n">gravitationalacceleration</span>
            <span class="n">lu</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">fac</span><span class="o">.</span><span class="n">waterlevelupstream</span>
            <span class="n">ld</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">fac</span><span class="o">.</span><span class="n">waterleveldownstream</span>
            <span class="n">cel</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">c</span> <span class="o">*</span> <span class="n">h</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">g</span> <span class="o">*</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">lu</span> <span class="o">-</span> <span class="n">ld</span><span class="p">))</span> <span class="o">**</span> <span class="mf">0.5</span>
            <span class="k">if</span> <span class="n">cel</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">fac</span><span class="o">.</span><span class="n">maxtimestep</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">inf</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fac</span><span class="o">.</span><span class="n">maxtimestep</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">timestepfactor</span> <span class="o">*</span> <span class="mf">1000.0</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">lengthupstream</span> <span class="o">/</span> <span class="n">cel</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fac</span><span class="o">.</span><span class="n">maxtimestep</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">inf</span></div>



<div class="viewcode-block" id="Calc_MaxTimeStep_V6">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Calc_MaxTimeStep_V6">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_MaxTimeStep_V6</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Estimate the highest possible computation time step for which we can expect</span>
<span class="sd">    stability for an inflow- and outflow-providing routing model.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`MaxTimeStep = TimeStepFactor \cdot</span>
<span class="sd">      \frac{1000 \cdot LengthMin}{5 / 3 \cdot |Discharge| \cdot WettedArea}`</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.sw1d import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; timestepfactor(0.5)</span>
<span class="sd">        &gt;&gt;&gt; derived.lengthmin(2.0)</span>
<span class="sd">        &gt;&gt;&gt; factors.wettedarea = 5.0</span>
<span class="sd">        &gt;&gt;&gt; states.discharge = -6.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_maxtimestep_v6()</span>
<span class="sd">        &gt;&gt;&gt; factors.maxtimestep</span>
<span class="sd">        maxtimestep(500.0)</span>

<span class="sd">        For zero outflow values, the computation time step needs no restriction:</span>

<span class="sd">        &gt;&gt;&gt; states.discharge = 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_maxtimestep_v6()</span>
<span class="sd">        &gt;&gt;&gt; factors.maxtimestep</span>
<span class="sd">        maxtimestep(inf)</span>

<span class="sd">        To prevent zero division, |Calc_MaxTimeStep_V4| also sets the maximum time step</span>
<span class="sd">        to infinity if there is no wetted area:</span>

<span class="sd">        &gt;&gt;&gt; states.discharge = 6.0</span>
<span class="sd">        &gt;&gt;&gt; factors.wettedarea = 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_maxtimestep_v6()</span>
<span class="sd">        &gt;&gt;&gt; factors.maxtimestep</span>
<span class="sd">        maxtimestep(inf)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_control</span><span class="o">.</span><span class="n">TimeStepFactor</span><span class="p">,)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_derived</span><span class="o">.</span><span class="n">LengthMin</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_states</span><span class="o">.</span><span class="n">Discharge</span><span class="p">,</span> <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WettedArea</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_factors</span><span class="o">.</span><span class="n">MaxTimeStep</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">discharge</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">fac</span><span class="o">.</span><span class="n">wettedarea</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">):</span>
            <span class="n">cel</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="mf">5.0</span> <span class="o">/</span> <span class="mf">3.0</span> <span class="o">*</span> <span class="n">sta</span><span class="o">.</span><span class="n">discharge</span> <span class="o">/</span> <span class="n">fac</span><span class="o">.</span><span class="n">wettedarea</span><span class="p">)</span>
            <span class="n">fac</span><span class="o">.</span><span class="n">maxtimestep</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">timestepfactor</span> <span class="o">*</span> <span class="mf">1000.0</span> <span class="o">*</span> <span class="n">der</span><span class="o">.</span><span class="n">lengthmin</span> <span class="o">/</span> <span class="n">cel</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fac</span><span class="o">.</span><span class="n">maxtimestep</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">inf</span></div>



<div class="viewcode-block" id="Calc_MaxTimeSteps_V1">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Calc_MaxTimeSteps_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_MaxTimeSteps_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Order all submodels that follow the |RoutingModel_V1|, |RoutingModel_V2|, or</span>
<span class="sd">    |RoutingModel_V3| interface to estimate the highest possible computation time step.</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.sw1d_channel import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nmbsegments(2)</span>
<span class="sd">        &gt;&gt;&gt; with model.add_storagemodel_v1(&quot;sw1d_storage&quot;, position=0, update=False):</span>
<span class="sd">        ...     factors.waterlevel = 6.0</span>
<span class="sd">        &gt;&gt;&gt; with model.add_routingmodel_v2(&quot;sw1d_lias&quot;, position=1, update=False):</span>
<span class="sd">        ...     timestepfactor(0.5)</span>
<span class="sd">        ...     derived.weightupstream(0.5)</span>
<span class="sd">        ...     derived.lengthmin(2.0)</span>
<span class="sd">        ...     factors.waterdepth = 4.0</span>
<span class="sd">        &gt;&gt;&gt; with model.add_storagemodel_v1(&quot;sw1d_storage&quot;, position=1, update=False):</span>
<span class="sd">        ...     factors.waterlevel = 4.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_maxtimesteps_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.routingmodels[1].sequences.factors.maxtimestep</span>
<span class="sd">        maxtimestep(159.637714)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMODELINTERFACES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">routinginterfaces</span><span class="o">.</span><span class="n">RoutingModel_V1</span><span class="p">,</span>
        <span class="n">routinginterfaces</span><span class="o">.</span><span class="n">RoutingModel_V2</span><span class="p">,</span>
        <span class="n">routinginterfaces</span><span class="o">.</span><span class="n">RoutingModel_V3</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">routingmodels</span><span class="o">.</span><span class="n">number</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">routingmodels</span><span class="o">.</span><span class="n">typeids</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
                <span class="n">cast</span><span class="p">(</span>
                    <span class="n">RoutingModels_V1_V2_V3</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">routingmodels</span><span class="o">.</span><span class="n">submodels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="p">)</span><span class="o">.</span><span class="n">determine_maxtimestep</span><span class="p">()</span></div>



<div class="viewcode-block" id="Calc_TimeStep_V1">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Calc_TimeStep_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_TimeStep_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Determine the computation time step for which we can expect stability for a</span>
<span class="sd">    complete channel network.</span>

<span class="sd">    Examples:</span>

<span class="sd">        Usually, |Calc_TimeStep_V1| takes the minimum of the individual routing models&#39;</span>
<span class="sd">        |MaxTimeStep| estimates:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.sw1d_channel import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nmbsegments(2)</span>
<span class="sd">        &gt;&gt;&gt; with model.add_routingmodel_v2(&quot;sw1d_lias&quot;, position=0, update=False):</span>
<span class="sd">        ...     factors.maxtimestep = 6.0</span>
<span class="sd">        &gt;&gt;&gt; with model.add_routingmodel_v2(&quot;sw1d_lias&quot;, position=1, update=False):</span>
<span class="sd">        ...     factors.maxtimestep = 7.0</span>
<span class="sd">        &gt;&gt;&gt; model.timeleft = 7.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_timestep_v1()</span>
<span class="sd">        &gt;&gt;&gt; factors.timestep</span>
<span class="sd">        timestep(6.0)</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(model.timeleft)</span>
<span class="sd">        1.0</span>

<span class="sd">        When appropriate, the `timeleft` argument synchronises the end of the next</span>
<span class="sd">        internal computation step with the end of the current external simulation step:</span>

<span class="sd">        &gt;&gt;&gt; model.timeleft = 5.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_timestep_v1()</span>
<span class="sd">        &gt;&gt;&gt; factors.timestep</span>
<span class="sd">        timestep(5.0)</span>
<span class="sd">        &gt;&gt;&gt; round_(model.timeleft)</span>
<span class="sd">        0.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMODELINTERFACES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">routinginterfaces</span><span class="o">.</span><span class="n">RoutingModel_V1</span><span class="p">,</span>
        <span class="n">routinginterfaces</span><span class="o">.</span><span class="n">RoutingModel_V2</span><span class="p">,</span>
        <span class="n">routinginterfaces</span><span class="o">.</span><span class="n">RoutingModel_V3</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_factors</span><span class="o">.</span><span class="n">TimeStep</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubstepModel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>

        <span class="n">fac</span><span class="o">.</span><span class="n">timestep</span> <span class="o">=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">inf</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">routingmodels</span><span class="o">.</span><span class="n">number</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">routingmodels</span><span class="o">.</span><span class="n">typeids</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
                <span class="n">timestep</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
                    <span class="n">RoutingModels_V1_V2_V3</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">routingmodels</span><span class="o">.</span><span class="n">submodels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="p">)</span><span class="o">.</span><span class="n">get_maxtimestep</span><span class="p">()</span>
                <span class="n">fac</span><span class="o">.</span><span class="n">timestep</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">fac</span><span class="o">.</span><span class="n">timestep</span><span class="p">,</span> <span class="n">timestep</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fac</span><span class="o">.</span><span class="n">timestep</span> <span class="o">&lt;</span> <span class="n">model</span><span class="o">.</span><span class="n">timeleft</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">timeleft</span> <span class="o">-=</span> <span class="n">fac</span><span class="o">.</span><span class="n">timestep</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fac</span><span class="o">.</span><span class="n">timestep</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">timeleft</span>
            <span class="n">model</span><span class="o">.</span><span class="n">timeleft</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Send_TimeStep_V1">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Send_TimeStep_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Send_TimeStep_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Send the actual computation time step to all submodels following the</span>
<span class="sd">    |StorageModel_V1|, |RoutingModel_V1|, |RoutingModel_V2|, or |RoutingModel_V3|</span>
<span class="sd">    interface.</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.sw1d_channel import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nmbsegments(1)</span>
<span class="sd">        &gt;&gt;&gt; with model.add_routingmodel_v2(&quot;sw1d_lias&quot;, position=0, update=False):</span>
<span class="sd">        ...     factors.maxtimestep = 6.0</span>
<span class="sd">        &gt;&gt;&gt; with model.add_storagemodel_v1(&quot;sw1d_storage&quot;, position=0, update=False):</span>
<span class="sd">        ...     factors.maxtimestep = 6.0</span>
<span class="sd">        &gt;&gt;&gt; factors.timestep = 5.0</span>
<span class="sd">        &gt;&gt;&gt; model.send_timestep_v1()</span>
<span class="sd">        &gt;&gt;&gt; model.routingmodels[0].sequences.factors.timestep</span>
<span class="sd">        timestep(5.0)</span>
<span class="sd">        &gt;&gt;&gt; model.storagemodels[0].sequences.factors.timestep</span>
<span class="sd">        timestep(5.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMODELINTERFACES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">routinginterfaces</span><span class="o">.</span><span class="n">RoutingModel_V1</span><span class="p">,</span>
        <span class="n">routinginterfaces</span><span class="o">.</span><span class="n">RoutingModel_V2</span><span class="p">,</span>
        <span class="n">routinginterfaces</span><span class="o">.</span><span class="n">RoutingModel_V3</span><span class="p">,</span>
        <span class="n">routinginterfaces</span><span class="o">.</span><span class="n">StorageModel_V1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_factors</span><span class="o">.</span><span class="n">TimeStep</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">routingmodels</span><span class="o">.</span><span class="n">number</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">routingmodels</span><span class="o">.</span><span class="n">typeids</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
                <span class="n">cast</span><span class="p">(</span>
                    <span class="n">RoutingModels_V1_V2_V3</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">routingmodels</span><span class="o">.</span><span class="n">submodels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="p">)</span><span class="o">.</span><span class="n">set_timestep</span><span class="p">(</span><span class="n">fac</span><span class="o">.</span><span class="n">timestep</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">storagemodels</span><span class="o">.</span><span class="n">number</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">storagemodels</span><span class="o">.</span><span class="n">typeids</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">cast</span><span class="p">(</span>
                    <span class="n">routinginterfaces</span><span class="o">.</span><span class="n">StorageModel_V1</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">storagemodels</span><span class="o">.</span><span class="n">submodels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="p">)</span><span class="o">.</span><span class="n">set_timestep</span><span class="p">(</span><span class="n">fac</span><span class="o">.</span><span class="n">timestep</span><span class="p">)</span></div>



<div class="viewcode-block" id="Calc_WaterLevelUpstream_V1">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Calc_WaterLevelUpstream_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_WaterLevelUpstream_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Query the water level from an upstream submodel that follows the</span>
<span class="sd">    |StorageModel_V1| interface.</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import prepare_model</span>
<span class="sd">        &gt;&gt;&gt; main, sub = prepare_model(&quot;sw1d&quot;), prepare_model(&quot;sw1d_storage&quot;)</span>
<span class="sd">        &gt;&gt;&gt; sub.sequences.factors.waterlevel = 2.0</span>
<span class="sd">        &gt;&gt;&gt; main.storagemodelupstream = sub</span>
<span class="sd">        &gt;&gt;&gt; main.storagemodelupstream_typeid = 1</span>
<span class="sd">        &gt;&gt;&gt; main.calc_waterlevelupstream_v1()</span>
<span class="sd">        &gt;&gt;&gt; main.sequences.factors.waterlevelupstream</span>
<span class="sd">        waterlevelupstream(2.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMODELINTERFACES</span> <span class="o">=</span> <span class="p">(</span><span class="n">routinginterfaces</span><span class="o">.</span><span class="n">StorageModel_V1</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevelUpstream</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">storagemodelupstream_typeid</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">fac</span><span class="o">.</span><span class="n">waterlevelupstream</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
                <span class="n">routinginterfaces</span><span class="o">.</span><span class="n">StorageModel_V1</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">storagemodelupstream</span>
            <span class="p">)</span><span class="o">.</span><span class="n">get_waterlevel</span><span class="p">()</span></div>



<div class="viewcode-block" id="Calc_WaterLevelDownstream_V1">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Calc_WaterLevelDownstream_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_WaterLevelDownstream_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Query the water level from a downstream submodel that follows the</span>
<span class="sd">    |StorageModel_V1| interface.</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import prepare_model</span>
<span class="sd">        &gt;&gt;&gt; main, sub = prepare_model(&quot;sw1d&quot;), prepare_model(&quot;sw1d_storage&quot;)</span>
<span class="sd">        &gt;&gt;&gt; sub.sequences.factors.waterlevel = 2.0</span>
<span class="sd">        &gt;&gt;&gt; main.storagemodeldownstream = sub</span>
<span class="sd">        &gt;&gt;&gt; main.storagemodeldownstream_typeid = 1</span>
<span class="sd">        &gt;&gt;&gt; main.calc_waterleveldownstream_v1()</span>
<span class="sd">        &gt;&gt;&gt; main.sequences.factors.waterleveldownstream</span>
<span class="sd">        waterleveldownstream(2.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMODELINTERFACES</span> <span class="o">=</span> <span class="p">(</span><span class="n">routinginterfaces</span><span class="o">.</span><span class="n">StorageModel_V1</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevelDownstream</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">storagemodeldownstream_typeid</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">fac</span><span class="o">.</span><span class="n">waterleveldownstream</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
                <span class="n">routinginterfaces</span><span class="o">.</span><span class="n">StorageModel_V1</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">storagemodeldownstream</span>
            <span class="p">)</span><span class="o">.</span><span class="n">get_waterlevel</span><span class="p">()</span></div>



<div class="viewcode-block" id="Calc_WaterVolumeUpstream_V1">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Calc_WaterVolumeUpstream_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_WaterVolumeUpstream_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Query the water volume from an upstream submodel that follows the</span>
<span class="sd">    |StorageModel_V1| interface.</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import prepare_model</span>
<span class="sd">        &gt;&gt;&gt; main, sub = prepare_model(&quot;sw1d&quot;), prepare_model(&quot;sw1d_storage&quot;)</span>
<span class="sd">        &gt;&gt;&gt; sub.sequences.states.watervolume = 2.0</span>
<span class="sd">        &gt;&gt;&gt; main.storagemodelupstream = sub</span>
<span class="sd">        &gt;&gt;&gt; main.storagemodelupstream_typeid = 1</span>
<span class="sd">        &gt;&gt;&gt; main.calc_watervolumeupstream_v1()</span>
<span class="sd">        &gt;&gt;&gt; main.sequences.factors.watervolumeupstream</span>
<span class="sd">        watervolumeupstream(2.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMODELINTERFACES</span> <span class="o">=</span> <span class="p">(</span><span class="n">routinginterfaces</span><span class="o">.</span><span class="n">StorageModel_V1</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterVolumeUpstream</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">storagemodelupstream_typeid</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">fac</span><span class="o">.</span><span class="n">watervolumeupstream</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
                <span class="n">routinginterfaces</span><span class="o">.</span><span class="n">StorageModel_V1</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">storagemodelupstream</span>
            <span class="p">)</span><span class="o">.</span><span class="n">get_watervolume</span><span class="p">()</span></div>



<div class="viewcode-block" id="Calc_WaterVolumeDownstream_V1">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Calc_WaterVolumeDownstream_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_WaterVolumeDownstream_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Query the water volume from a downstream submodel that follows the</span>
<span class="sd">    |StorageModel_V1| interface.</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import prepare_model</span>
<span class="sd">        &gt;&gt;&gt; main, sub = prepare_model(&quot;sw1d&quot;), prepare_model(&quot;sw1d_storage&quot;)</span>
<span class="sd">        &gt;&gt;&gt; sub.sequences.states.watervolume = 2.0</span>
<span class="sd">        &gt;&gt;&gt; main.storagemodeldownstream = sub</span>
<span class="sd">        &gt;&gt;&gt; main.storagemodeldownstream_typeid = 1</span>
<span class="sd">        &gt;&gt;&gt; main.calc_watervolumedownstream_v1()</span>
<span class="sd">        &gt;&gt;&gt; main.sequences.factors.watervolumedownstream</span>
<span class="sd">        watervolumedownstream(2.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMODELINTERFACES</span> <span class="o">=</span> <span class="p">(</span><span class="n">routinginterfaces</span><span class="o">.</span><span class="n">StorageModel_V1</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterVolumeDownstream</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">storagemodeldownstream_typeid</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">fac</span><span class="o">.</span><span class="n">watervolumedownstream</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
                <span class="n">routinginterfaces</span><span class="o">.</span><span class="n">StorageModel_V1</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">storagemodeldownstream</span>
            <span class="p">)</span><span class="o">.</span><span class="n">get_watervolume</span><span class="p">()</span></div>



<div class="viewcode-block" id="Calc_WaterLevel_V1">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Calc_WaterLevel_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_WaterLevel_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Interpolate the water level based on the water levels of the adjacent channel</span>
<span class="sd">    segments.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      .. math::</span>
<span class="sd">        WaterLevel =</span>
<span class="sd">        \omega \cdot WaterLevelUpstream + (1 - \omega) \cdot WaterLevelDownstream</span>
<span class="sd">        \\ \\</span>
<span class="sd">        \omega = WeightUpstream</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.sw1d import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; derived.weightupstream(0.8)</span>
<span class="sd">        &gt;&gt;&gt; factors.waterlevelupstream = 3.0</span>
<span class="sd">        &gt;&gt;&gt; factors.waterleveldownstream = 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_waterlevel_v1()</span>
<span class="sd">        &gt;&gt;&gt; factors.waterlevel</span>
<span class="sd">        waterlevel(2.6)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_derived</span><span class="o">.</span><span class="n">WeightUpstream</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevelUpstream</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevelDownstream</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevel</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">w</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">weightupstream</span>
        <span class="n">fac</span><span class="o">.</span><span class="n">waterlevel</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">w</span> <span class="o">*</span> <span class="n">fac</span><span class="o">.</span><span class="n">waterlevelupstream</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">w</span><span class="p">)</span> <span class="o">*</span> <span class="n">fac</span><span class="o">.</span><span class="n">waterleveldownstream</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="Calc_WaterLevel_V2">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Calc_WaterLevel_V2">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_WaterLevel_V2</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Take the water level from the downstream channel segment.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`WaterLevel = WaterLevelDownstream`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.sw1d import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; factors.waterleveldownstream = 3.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_waterlevel_v2()</span>
<span class="sd">        &gt;&gt;&gt; factors.waterlevel</span>
<span class="sd">        waterlevel(3.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevelDownstream</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevel</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span><span class="o">.</span><span class="n">waterlevel</span> <span class="o">=</span> <span class="n">fac</span><span class="o">.</span><span class="n">waterleveldownstream</span></div>



<div class="viewcode-block" id="Calc_WaterLevel_V3">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Calc_WaterLevel_V3">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_WaterLevel_V3</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Take the water level from the upstream channel segment.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`WaterLevel = WaterLevelUpstream`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.sw1d import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; factors.waterlevelupstream = 3.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_waterlevel_v3()</span>
<span class="sd">        &gt;&gt;&gt; factors.waterlevel</span>
<span class="sd">        waterlevel(3.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevelUpstream</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevel</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span><span class="o">.</span><span class="n">waterlevel</span> <span class="o">=</span> <span class="n">fac</span><span class="o">.</span><span class="n">waterlevelupstream</span></div>



<div class="viewcode-block" id="Calc_WaterLevel_V4">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Calc_WaterLevel_V4">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_WaterLevel_V4</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Average the upstream and the downstream water level.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`WaterLevel = (WaterLevelUpstream + WaterLevelUpstream) / 2`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.sw1d import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; factors.waterlevelupstream = 3.0</span>
<span class="sd">        &gt;&gt;&gt; factors.waterleveldownstream = 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_waterlevel_v4()</span>
<span class="sd">        &gt;&gt;&gt; factors.waterlevel</span>
<span class="sd">        waterlevel(2.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevelUpstream</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevelDownstream</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevel</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span><span class="o">.</span><span class="n">waterlevel</span> <span class="o">=</span> <span class="p">(</span><span class="n">fac</span><span class="o">.</span><span class="n">waterlevelupstream</span> <span class="o">+</span> <span class="n">fac</span><span class="o">.</span><span class="n">waterleveldownstream</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span></div>



<div class="viewcode-block" id="Calc_WaterDepth_WaterLevel_CrossSectionModel_V2">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Calc_WaterDepth_WaterLevel_CrossSectionModel_V2">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_WaterDepth_WaterLevel_CrossSectionModel_V2</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Let a submodel that follows the |CrossSectionModel_V2| submodel interface</span>
<span class="sd">    calculate the water depth and level based on the current water volume.&quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_control</span><span class="o">.</span><span class="n">Length</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_states</span><span class="o">.</span><span class="n">WaterVolume</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterDepth</span><span class="p">,</span> <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevel</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">submodel</span><span class="p">:</span> <span class="n">routinginterfaces</span><span class="o">.</span><span class="n">CrossSectionModel_V2</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">submodel</span><span class="o">.</span><span class="n">use_wettedarea</span><span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">watervolume</span> <span class="o">/</span> <span class="n">con</span><span class="o">.</span><span class="n">length</span><span class="p">)</span>
        <span class="n">fac</span><span class="o">.</span><span class="n">waterdepth</span> <span class="o">=</span> <span class="n">submodel</span><span class="o">.</span><span class="n">get_waterdepth</span><span class="p">()</span>
        <span class="n">fac</span><span class="o">.</span><span class="n">waterlevel</span> <span class="o">=</span> <span class="n">submodel</span><span class="o">.</span><span class="n">get_waterlevel</span><span class="p">()</span></div>



<div class="viewcode-block" id="Calc_WaterDepth_WaterLevel_V1">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Calc_WaterDepth_WaterLevel_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_WaterDepth_WaterLevel_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Let a submodel that follows the |CrossSectionModel_V2| submodel interface</span>
<span class="sd">    calculate the water depth and level based on the current water volume.</span>

<span class="sd">    Example:</span>

<span class="sd">        We use |wq_trapeze| as an example submodel and configure it so that a wetted</span>
<span class="sd">        area of 18 m corresponds to water depth of 4 m and a water level of 5 m:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.sw1d_storage import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; length(2.0)</span>
<span class="sd">        &gt;&gt;&gt; with model.add_crosssection_v2(&quot;wq_trapeze&quot;):</span>
<span class="sd">        ...     nmbtrapezes(3)</span>
<span class="sd">        ...     bottomlevels(1.0, 3.0, 4.0)</span>
<span class="sd">        ...     bottomwidths(2.0, 0.0, 2.0)</span>
<span class="sd">        ...     sideslopes(0.0, 2.0, 2.0)</span>
<span class="sd">        &gt;&gt;&gt; states.watervolume = 36.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_waterdepth_waterlevel_v1()</span>
<span class="sd">        &gt;&gt;&gt; factors.waterdepth</span>
<span class="sd">        waterdepth(4.0)</span>
<span class="sd">        &gt;&gt;&gt; factors.waterlevel</span>
<span class="sd">        waterlevel(5.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Calc_WaterDepth_WaterLevel_CrossSectionModel_V2</span><span class="p">,)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_control</span><span class="o">.</span><span class="n">Length</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_states</span><span class="o">.</span><span class="n">WaterVolume</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterDepth</span><span class="p">,</span> <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevel</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">crosssection_typeid</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">calc_waterdepth_waterlevel_crosssectionmodel_v2</span><span class="p">(</span>
                <span class="n">cast</span><span class="p">(</span><span class="n">routinginterfaces</span><span class="o">.</span><span class="n">CrossSectionModel_V2</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">crosssection</span><span class="p">)</span>
            <span class="p">)</span></div>



<div class="viewcode-block" id="Calc_WaterDepth_WettedArea_CrossSectionModel_V2">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Calc_WaterDepth_WettedArea_CrossSectionModel_V2">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_WaterDepth_WettedArea_CrossSectionModel_V2</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Let a submodel that follows the |CrossSectionModel_V2| submodel interface</span>
<span class="sd">    calculate the water depth and the wetted area based on the current water level.&quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevel</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterDepth</span><span class="p">,</span> <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WettedArea</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">submodel</span><span class="p">:</span> <span class="n">routinginterfaces</span><span class="o">.</span><span class="n">CrossSectionModel_V2</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">submodel</span><span class="o">.</span><span class="n">use_waterlevel</span><span class="p">(</span><span class="n">fac</span><span class="o">.</span><span class="n">waterlevel</span><span class="p">)</span>
        <span class="n">fac</span><span class="o">.</span><span class="n">waterdepth</span> <span class="o">=</span> <span class="n">submodel</span><span class="o">.</span><span class="n">get_waterdepth</span><span class="p">()</span>
        <span class="n">fac</span><span class="o">.</span><span class="n">wettedarea</span> <span class="o">=</span> <span class="n">submodel</span><span class="o">.</span><span class="n">get_wettedarea</span><span class="p">()</span></div>



<div class="viewcode-block" id="Calc_WaterDepth_WettedArea_V1">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Calc_WaterDepth_WettedArea_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_WaterDepth_WettedArea_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Let a submodel that follows the |CrossSectionModel_V2| submodel interface</span>
<span class="sd">    calculate the water depth and the wetted area based on the current water level.</span>

<span class="sd">    Example:</span>

<span class="sd">        We use |wq_trapeze| as an example submodel and configure it so that a water</span>
<span class="sd">        level of 5 m corresponds to a water depth of 4 m and a wetted area of 18 m:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.sw1d_pump import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; with model.add_crosssection_v2(&quot;wq_trapeze&quot;):</span>
<span class="sd">        ...     nmbtrapezes(3)</span>
<span class="sd">        ...     bottomlevels(1.0, 3.0, 4.0)</span>
<span class="sd">        ...     bottomwidths(2.0, 0.0, 2.0)</span>
<span class="sd">        ...     sideslopes(0.0, 2.0, 2.0)</span>
<span class="sd">        &gt;&gt;&gt; factors.waterlevel = 5.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_waterdepth_wettedarea_v1()</span>
<span class="sd">        &gt;&gt;&gt; factors.waterdepth</span>
<span class="sd">        waterdepth(4.0)</span>
<span class="sd">        &gt;&gt;&gt; factors.wettedarea</span>
<span class="sd">        wettedarea(18.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Calc_WaterDepth_WettedArea_CrossSectionModel_V2</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevel</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterDepth</span><span class="p">,</span> <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WettedArea</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">crosssection_typeid</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">calc_waterdepth_wettedarea_crosssectionmodel_v2</span><span class="p">(</span>
                <span class="n">cast</span><span class="p">(</span><span class="n">routinginterfaces</span><span class="o">.</span><span class="n">CrossSectionModel_V2</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">crosssection</span><span class="p">)</span>
            <span class="p">)</span></div>



<div class="viewcode-block" id="Calc_WaterDepth_WettedArea_WettedPerimeter_CrossSectionModel_V2">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Calc_WaterDepth_WettedArea_WettedPerimeter_CrossSectionModel_V2">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_WaterDepth_WettedArea_WettedPerimeter_CrossSectionModel_V2</span><span class="p">(</span>
    <span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Let a submodel that follows the |CrossSectionModel_V2| submodel interface</span>
<span class="sd">    calculate the water depth, the wetted area, and the wetted perimeter based on the</span>
<span class="sd">    current water level.&quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevel</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterDepth</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WettedArea</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WettedPerimeter</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">submodel</span><span class="p">:</span> <span class="n">routinginterfaces</span><span class="o">.</span><span class="n">CrossSectionModel_V2</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">submodel</span><span class="o">.</span><span class="n">use_waterlevel</span><span class="p">(</span><span class="n">fac</span><span class="o">.</span><span class="n">waterlevel</span><span class="p">)</span>
        <span class="n">fac</span><span class="o">.</span><span class="n">waterdepth</span> <span class="o">=</span> <span class="n">submodel</span><span class="o">.</span><span class="n">get_waterdepth</span><span class="p">()</span>
        <span class="n">fac</span><span class="o">.</span><span class="n">wettedarea</span> <span class="o">=</span> <span class="n">submodel</span><span class="o">.</span><span class="n">get_wettedarea</span><span class="p">()</span>
        <span class="n">fac</span><span class="o">.</span><span class="n">wettedperimeter</span> <span class="o">=</span> <span class="n">submodel</span><span class="o">.</span><span class="n">get_wettedperimeter</span><span class="p">()</span></div>



<div class="viewcode-block" id="Calc_WaterDepth_WettedArea_WettedPerimeter_V1">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Calc_WaterDepth_WettedArea_WettedPerimeter_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_WaterDepth_WettedArea_WettedPerimeter_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Let a submodel that follows the |CrossSectionModel_V2| submodel interface</span>
<span class="sd">    calculate the water depth, the wetted area, and the wetted perimeter based on the</span>
<span class="sd">    current water level.</span>

<span class="sd">    Example:</span>

<span class="sd">        We use |wq_trapeze| as an example submodel and configure it so that a water</span>
<span class="sd">        level of 5 m corresponds to a water depth of 4 m, a wetted area of 18 m, and</span>
<span class="sd">        a wetted perimeter of nearly 23 m:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.sw1d_lias import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; with model.add_crosssection_v2(&quot;wq_trapeze&quot;):</span>
<span class="sd">        ...     nmbtrapezes(3)</span>
<span class="sd">        ...     bottomlevels(1.0, 3.0, 4.0)</span>
<span class="sd">        ...     bottomwidths(2.0, 0.0, 2.0)</span>
<span class="sd">        ...     sideslopes(0.0, 2.0, 2.0)</span>
<span class="sd">        &gt;&gt;&gt; factors.waterlevel = 5.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_waterdepth_wettedarea_wettedperimeter_v1()</span>
<span class="sd">        &gt;&gt;&gt; factors.waterdepth</span>
<span class="sd">        waterdepth(4.0)</span>
<span class="sd">        &gt;&gt;&gt; factors.wettedarea</span>
<span class="sd">        wettedarea(18.0)</span>
<span class="sd">        &gt;&gt;&gt; factors.wettedperimeter</span>
<span class="sd">        wettedperimeter(22.944272)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Calc_WaterDepth_WettedArea_WettedPerimeter_CrossSectionModel_V2</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevel</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterDepth</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WettedArea</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WettedPerimeter</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">crosssection_typeid</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">calc_waterdepth_wettedarea_wettedperimeter_crosssectionmodel_v2</span><span class="p">(</span>
                <span class="n">cast</span><span class="p">(</span><span class="n">routinginterfaces</span><span class="o">.</span><span class="n">CrossSectionModel_V2</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">crosssection</span><span class="p">)</span>
            <span class="p">)</span></div>



<div class="viewcode-block" id="Calc_DischargeUpstream_V1">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Calc_DischargeUpstream_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_DischargeUpstream_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sum the (partial) discharge of all upstream routing submodels following the</span>
<span class="sd">    |RoutingModel_V1| or |RoutingModel_V2| interface.</span>

<span class="sd">    Examples:</span>

<span class="sd">        If there is no upstream model, |DischargeUpstream| is zero:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import prepare_model</span>
<span class="sd">        &gt;&gt;&gt; c2 = prepare_model(&quot;sw1d_channel&quot;)</span>
<span class="sd">        &gt;&gt;&gt; c2.parameters.control.nmbsegments(1)</span>
<span class="sd">        &gt;&gt;&gt; with c2.add_storagemodel_v1(&quot;sw1d_storage&quot;, position=0, update=False):</span>
<span class="sd">        ...     pass</span>
<span class="sd">        &gt;&gt;&gt; with c2.add_routingmodel_v2(&quot;sw1d_lias&quot;, position=1, update=False) as r2:</span>
<span class="sd">        ...     states.discharge = 5.0</span>
<span class="sd">        &gt;&gt;&gt; r2.calc_dischargeupstream_v1()</span>
<span class="sd">        &gt;&gt;&gt; r2.sequences.fluxes.dischargeupstream</span>
<span class="sd">        dischargeupstream(0.0)</span>

<span class="sd">        Otherwise, |Calc_DischargeUpstream_V1| totals the individual (partial)</span>
<span class="sd">        discharge values:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import Element, Node</span>
<span class="sd">        &gt;&gt;&gt; n012 = Node(&quot;n012&quot;, variable=&quot;LongQ&quot;)</span>
<span class="sd">        &gt;&gt;&gt; e2 = Element(&quot;e2&quot;, inlets=n012)</span>
<span class="sd">        &gt;&gt;&gt; e2.model = c2</span>
<span class="sd">        &gt;&gt;&gt; e0, e1 = Element(&quot;e0&quot;, outlets=n012), Element(&quot;e1&quot;, outlets=n012)</span>
<span class="sd">        &gt;&gt;&gt; for element, discharge in ((e0, 1.0), (e1, 3.0)):</span>
<span class="sd">        ...     c = prepare_model(&quot;sw1d_channel&quot;)</span>
<span class="sd">        ...     c.parameters.control.nmbsegments(1)</span>
<span class="sd">        ...     with c.add_storagemodel_v1(&quot;sw1d_storage&quot;, position=0, update=False):</span>
<span class="sd">        ...         pass</span>
<span class="sd">        ...     with c.add_routingmodel_v2(&quot;sw1d_lias&quot;, position=1, update=False):</span>
<span class="sd">        ...         states.discharge = discharge</span>
<span class="sd">        ...     element.model = c</span>
<span class="sd">        &gt;&gt;&gt; network = c2.couple_models(nodes=(n012,), elements=(e0, e1, e2))</span>
<span class="sd">        &gt;&gt;&gt; r2.calc_dischargeupstream_v1()</span>
<span class="sd">        &gt;&gt;&gt; r2.sequences.fluxes.dischargeupstream</span>
<span class="sd">        dischargeupstream(4.0)</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; Node.clear_all()</span>
<span class="sd">            &gt;&gt;&gt; Element.clear_all()</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMODELINTERFACES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">routinginterfaces</span><span class="o">.</span><span class="n">RoutingModel_V1</span><span class="p">,</span>
        <span class="n">routinginterfaces</span><span class="o">.</span><span class="n">RoutingModel_V2</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_states</span><span class="o">.</span><span class="n">Discharge</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_fluxes</span><span class="o">.</span><span class="n">DischargeUpstream</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>

        <span class="n">flu</span><span class="o">.</span><span class="n">dischargeupstream</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">routingmodelsupstream</span><span class="o">.</span><span class="n">number</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">routingmodelsupstream</span><span class="o">.</span><span class="n">typeids</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">dischargeupstream</span> <span class="o">+=</span> <span class="n">cast</span><span class="p">(</span>
                    <span class="n">RoutingModels_V1_V2</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">routingmodelsupstream</span><span class="o">.</span><span class="n">submodels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="p">)</span><span class="o">.</span><span class="n">get_partialdischargeupstream</span><span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">discharge</span><span class="p">)</span></div>



<div class="viewcode-block" id="Calc_DischargeDownstream_V1">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Calc_DischargeDownstream_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_DischargeDownstream_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sum the (partial) discharge of all downstream routing submodels following the</span>
<span class="sd">    |RoutingModel_V2| or |RoutingModel_V3| interface.</span>

<span class="sd">    Examples:</span>

<span class="sd">        If there is no downstream model, |DischargeDownstream| is zero:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import prepare_model</span>
<span class="sd">        &gt;&gt;&gt; c0 = prepare_model(&quot;sw1d_channel&quot;)</span>
<span class="sd">        &gt;&gt;&gt; c0.parameters.control.nmbsegments(1)</span>
<span class="sd">        &gt;&gt;&gt; with c0.add_routingmodel_v2(&quot;sw1d_lias&quot;, position=0, update=False) as r0:</span>
<span class="sd">        ...     states.discharge = 5.0</span>
<span class="sd">        &gt;&gt;&gt; with c0.add_storagemodel_v1(&quot;sw1d_storage&quot;, position=0, update=False):</span>
<span class="sd">        ...     pass</span>
<span class="sd">        &gt;&gt;&gt; r0.calc_dischargedownstream_v1()</span>
<span class="sd">        &gt;&gt;&gt; r0.sequences.fluxes.dischargedownstream</span>
<span class="sd">        dischargedownstream(0.0)</span>

<span class="sd">        Otherwise, |Calc_DischargeDownstream_V1| totals the individual (partial)</span>
<span class="sd">        discharge values:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import Element, Node</span>
<span class="sd">        &gt;&gt;&gt; n012 = Node(&quot;n012&quot;, variable=&quot;LongQ&quot;)</span>
<span class="sd">        &gt;&gt;&gt; e0 = Element(&quot;e0&quot;, outlets=n012)</span>
<span class="sd">        &gt;&gt;&gt; e0.model = c0</span>
<span class="sd">        &gt;&gt;&gt; e1, e2 = Element(&quot;e1&quot;, inlets=n012), Element(&quot;e2&quot;, inlets=n012)</span>
<span class="sd">        &gt;&gt;&gt; for element, discharge in ((e1, 1.0), (e2, 3.0)):</span>
<span class="sd">        ...     c = prepare_model(&quot;sw1d_channel&quot;)</span>
<span class="sd">        ...     c.parameters.control.nmbsegments(1)</span>
<span class="sd">        ...     with c.add_routingmodel_v2(&quot;sw1d_lias&quot;, position=0, update=False):</span>
<span class="sd">        ...         states.discharge = discharge</span>
<span class="sd">        ...     with c.add_storagemodel_v1(&quot;sw1d_storage&quot;, position=0, update=False):</span>
<span class="sd">        ...         pass</span>
<span class="sd">        ...     element.model = c</span>
<span class="sd">        &gt;&gt;&gt; network = c0.couple_models(nodes=(n012,), elements=(e0, e1, e2))</span>
<span class="sd">        &gt;&gt;&gt; r0.calc_dischargedownstream_v1()</span>
<span class="sd">        &gt;&gt;&gt; r0.sequences.fluxes.dischargedownstream</span>
<span class="sd">        dischargedownstream(4.0)</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; Node.clear_all()</span>
<span class="sd">            &gt;&gt;&gt; Element.clear_all()</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMODELINTERFACES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">routinginterfaces</span><span class="o">.</span><span class="n">RoutingModel_V2</span><span class="p">,</span>
        <span class="n">routinginterfaces</span><span class="o">.</span><span class="n">RoutingModel_V3</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_states</span><span class="o">.</span><span class="n">Discharge</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_fluxes</span><span class="o">.</span><span class="n">DischargeDownstream</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>

        <span class="n">flu</span><span class="o">.</span><span class="n">dischargedownstream</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">routingmodelsdownstream</span><span class="o">.</span><span class="n">number</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">routingmodelsdownstream</span><span class="o">.</span><span class="n">typeids</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">dischargedownstream</span> <span class="o">+=</span> <span class="n">cast</span><span class="p">(</span>
                    <span class="n">RoutingModels_V2_V3</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">routingmodelsdownstream</span><span class="o">.</span><span class="n">submodels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="p">)</span><span class="o">.</span><span class="n">get_partialdischargedownstream</span><span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">discharge</span><span class="p">)</span></div>



<div class="viewcode-block" id="Calc_Discharge_V1">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Calc_Discharge_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_Discharge_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the discharge according to :cite:t:`ref-Bates2010` and</span>
<span class="sd">    :cite:t:`ref-Almeida2012`.</span>

<span class="sd">    Basic equation :cite:p:`ref-Almeida2012`:</span>
<span class="sd">      .. math::</span>
<span class="sd">        Q_{i-1/2}^{n+1} = \frac{\left[ (1-\theta) \cdot Q_{i-1/2}^n +</span>
<span class="sd">        \frac{\theta}{2} \cdot \left( Q_{i-3/2}^n + Q_{i+1/2}^n\right) \right] +</span>
<span class="sd">        g \cdot A_f \cdot \Delta t^n \cdot (y_{i-1}^n - y_i^n) / \Delta x}</span>
<span class="sd">        {1 + g \cdot \Delta t \cdot k_{st}^{-2} \cdot \left| Q_{i-1/2}^n \right|</span>
<span class="sd">        \cdot {P_f^n}^{\frac{4}{3}} \cdot {A_f^n}^{-\frac{7}{3}}}</span>
<span class="sd">        \\ \\</span>
<span class="sd">        Q = Discharge \\</span>
<span class="sd">        \theta = DiffusionFactor \\</span>
<span class="sd">        g = GravitationalAcceleration \\</span>
<span class="sd">        A_f = WettedArea \\</span>
<span class="sd">        \Delta t = TimeStep \\</span>
<span class="sd">        \Delta x = Length \\</span>
<span class="sd">        y = WaterLevel \\</span>
<span class="sd">        k_{st} = StricklerCoefficient \\</span>
<span class="sd">        P_f = WettedPerimeter</span>

<span class="sd">    Examples:</span>

<span class="sd">        The following channel configuration corresponds to a rectangular profile and</span>
<span class="sd">        a water surface slope of one meter per kilometre:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.sw1d import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; diffusionfactor(0.2)</span>
<span class="sd">        &gt;&gt;&gt; stricklercoefficient(50.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.lengthmean(2.0)</span>
<span class="sd">        &gt;&gt;&gt; factors.timestep = 100.0</span>
<span class="sd">        &gt;&gt;&gt; factors.wettedarea = 6.0</span>
<span class="sd">        &gt;&gt;&gt; factors.wettedperimeter = 8.0</span>
<span class="sd">        &gt;&gt;&gt; factors.waterlevelupstream = 5.0</span>
<span class="sd">        &gt;&gt;&gt; factors.waterleveldownstream = 3.0</span>

<span class="sd">        According to the Manning-Strickler equation, this configuration corresponds to</span>
<span class="sd">        a discharge of about 8 m/s:</span>

<span class="sd">        &gt;&gt;&gt; dh = factors.waterlevelupstream - factors.waterleveldownstream</span>
<span class="sd">        &gt;&gt;&gt; i = dh/ (1000.0 * derived.lengthmean)</span>
<span class="sd">        &gt;&gt;&gt; r = factors.wettedarea / factors.wettedperimeter</span>
<span class="sd">        &gt;&gt;&gt; v = stricklercoefficient * r**(2.0/3.0) * i**0.5</span>
<span class="sd">        &gt;&gt;&gt; q = factors.wettedarea * v</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(q)</span>
<span class="sd">        7.831208</span>

<span class="sd">        If we use this value as the &quot;old&quot; discharge, relevant for the local inertial</span>
<span class="sd">        term, |Calc_Discharge_V1| calculates the same value as the &quot;new&quot; discharge,</span>
<span class="sd">        demonstrating its agreement with Manning-Stricker for stationary conditions:</span>

<span class="sd">        &gt;&gt;&gt; fluxes.dischargeupstream = q</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dischargedownstream = q</span>
<span class="sd">        &gt;&gt;&gt; states.discharge = q</span>
<span class="sd">        &gt;&gt;&gt; model.calc_discharge_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.discharge</span>
<span class="sd">        discharge(7.831208)</span>

<span class="sd">        Reversing the surface water slope and the &quot;old&quot; discharge reverses the &quot;new&quot;</span>
<span class="sd">        discharge:</span>

<span class="sd">        &gt;&gt;&gt; factors.waterlevelupstream = -5.0</span>
<span class="sd">        &gt;&gt;&gt; factors.waterleveldownstream = -3.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dischargeupstream = -q</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dischargedownstream = -q</span>
<span class="sd">        &gt;&gt;&gt; states.discharge = -q</span>
<span class="sd">        &gt;&gt;&gt; model.calc_discharge_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.discharge</span>
<span class="sd">        discharge(-7.831208)</span>

<span class="sd">        With zero initial discharge, the estimated discharge becomes smaller:</span>

<span class="sd">        &gt;&gt;&gt; factors.waterlevelupstream = 5.0</span>
<span class="sd">        &gt;&gt;&gt; factors.waterleveldownstream = 3.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dischargeupstream = 0.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dischargedownstream = 0.0</span>
<span class="sd">        &gt;&gt;&gt; states.discharge = 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_discharge_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.discharge</span>
<span class="sd">        discharge(5.886)</span>

<span class="sd">        For differences between the initial discharge at the upstream, the actual, and</span>
<span class="sd">        the downstream position, the extension introduced by :cite:t:`ref-Almeida2012`</span>
<span class="sd">        to increase computational stability via numerical diffusion becomes relevant:</span>

<span class="sd">        &gt;&gt;&gt; states.discharge = q</span>
<span class="sd">        &gt;&gt;&gt; model.calc_discharge_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.discharge</span>
<span class="sd">        discharge(6.937035)</span>

<span class="sd">        |Calc_Discharge_V1| sets the discharge directly to zero for zero wetted</span>
<span class="sd">        cross-section areas to prevent zero division errors:</span>

<span class="sd">        &gt;&gt;&gt; factors.wettedarea = 0.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_discharge_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.discharge</span>
<span class="sd">        discharge(0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">sw1d_control</span><span class="o">.</span><span class="n">DiffusionFactor</span><span class="p">,</span>
        <span class="n">sw1d_control</span><span class="o">.</span><span class="n">StricklerCoefficient</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_derived</span><span class="o">.</span><span class="n">LengthMean</span><span class="p">,)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_fixed</span><span class="o">.</span><span class="n">GravitationalAcceleration</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">TimeStep</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WettedArea</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WettedPerimeter</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevelUpstream</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevelDownstream</span><span class="p">,</span>
        <span class="n">sw1d_fluxes</span><span class="o">.</span><span class="n">DischargeUpstream</span><span class="p">,</span>
        <span class="n">sw1d_fluxes</span><span class="o">.</span><span class="n">DischargeDownstream</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_states</span><span class="o">.</span><span class="n">Discharge</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>

        <span class="k">if</span> <span class="n">fac</span><span class="o">.</span><span class="n">wettedarea</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">w</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">diffusionfactor</span>  <span class="c1"># * fac.timestep / der.seconds</span>
            <span class="n">nominator1</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">w</span><span class="p">)</span> <span class="o">*</span> <span class="n">sta</span><span class="o">.</span><span class="n">discharge</span> <span class="o">+</span> <span class="n">w</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="p">(</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">dischargeupstream</span> <span class="o">+</span> <span class="n">flu</span><span class="o">.</span><span class="n">dischargedownstream</span>
            <span class="p">)</span>
            <span class="n">nominator2</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">fix</span><span class="o">.</span><span class="n">gravitationalacceleration</span>
                <span class="o">*</span> <span class="n">fac</span><span class="o">.</span><span class="n">wettedarea</span>
                <span class="o">*</span> <span class="n">fac</span><span class="o">.</span><span class="n">timestep</span>
                <span class="o">*</span> <span class="p">(</span><span class="n">fac</span><span class="o">.</span><span class="n">waterlevelupstream</span> <span class="o">-</span> <span class="n">fac</span><span class="o">.</span><span class="n">waterleveldownstream</span><span class="p">)</span>
                <span class="o">/</span> <span class="p">(</span><span class="mf">1000.0</span> <span class="o">*</span> <span class="n">der</span><span class="o">.</span><span class="n">lengthmean</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">denominator</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="p">(</span>
                <span class="n">fix</span><span class="o">.</span><span class="n">gravitationalacceleration</span>
                <span class="o">*</span> <span class="n">fac</span><span class="o">.</span><span class="n">timestep</span>
                <span class="o">/</span> <span class="n">con</span><span class="o">.</span><span class="n">stricklercoefficient</span><span class="o">**</span><span class="mf">2.0</span>
                <span class="o">*</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">discharge</span><span class="p">)</span>
                <span class="o">*</span> <span class="n">fac</span><span class="o">.</span><span class="n">wettedperimeter</span> <span class="o">**</span> <span class="p">(</span><span class="mf">4.0</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span>
                <span class="o">/</span> <span class="n">fac</span><span class="o">.</span><span class="n">wettedarea</span> <span class="o">**</span> <span class="p">(</span><span class="mf">7.0</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">sta</span><span class="o">.</span><span class="n">discharge</span> <span class="o">=</span> <span class="p">(</span><span class="n">nominator1</span> <span class="o">+</span> <span class="n">nominator2</span><span class="p">)</span> <span class="o">/</span> <span class="n">denominator</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sta</span><span class="o">.</span><span class="n">discharge</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_Discharge_V2">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Calc_Discharge_V2">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_Discharge_V2</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the free weir flow after Poleni.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      .. math::</span>
<span class="sd">        Q = w \cdot 2 / 3 \cdot c \cdot  \sqrt{2 \cdot g} \cdot h^{3/2}</span>
<span class="sd">        \\ \\</span>
<span class="sd">        w = CrestWidth \\</span>
<span class="sd">        c = FlowCoefficient \\</span>
<span class="sd">        g = GravitationalAcceleration \\</span>
<span class="sd">        h = max(WaterLevel - CrestHeight, \ 0)</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.sw1d import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; crestwidth(10.0)</span>
<span class="sd">        &gt;&gt;&gt; crestheight(5.0)</span>
<span class="sd">        &gt;&gt;&gt; flowcoefficient(0.6)</span>
<span class="sd">        &gt;&gt;&gt; factors.waterlevel = 7.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_discharge_v2()</span>
<span class="sd">        &gt;&gt;&gt; states.discharge</span>
<span class="sd">        discharge(50.113471)</span>

<span class="sd">        &gt;&gt;&gt; factors.waterlevel = 4.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_discharge_v2()</span>
<span class="sd">        &gt;&gt;&gt; states.discharge</span>
<span class="sd">        discharge(0.0)</span>

<span class="sd">        &gt;&gt;&gt; factors.waterlevel = 5.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_discharge_v2()</span>
<span class="sd">        &gt;&gt;&gt; states.discharge</span>
<span class="sd">        discharge(0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">sw1d_control</span><span class="o">.</span><span class="n">CrestHeight</span><span class="p">,</span>
        <span class="n">sw1d_control</span><span class="o">.</span><span class="n">CrestWidth</span><span class="p">,</span>
        <span class="n">sw1d_control</span><span class="o">.</span><span class="n">FlowCoefficient</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_fixed</span><span class="o">.</span><span class="n">GravitationalAcceleration</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevel</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_states</span><span class="o">.</span><span class="n">Discharge</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">h</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">fac</span><span class="o">.</span><span class="n">waterlevel</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">crestheight</span>
        <span class="k">if</span> <span class="n">h</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">w</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">crestwidth</span>
            <span class="n">c</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">flowcoefficient</span>
            <span class="n">g</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">fix</span><span class="o">.</span><span class="n">gravitationalacceleration</span>
            <span class="n">sta</span><span class="o">.</span><span class="n">discharge</span> <span class="o">=</span> <span class="n">w</span> <span class="o">*</span> <span class="mf">2.0</span> <span class="o">/</span> <span class="mf">3.0</span> <span class="o">*</span> <span class="n">c</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">g</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">h</span> <span class="o">**</span> <span class="p">(</span><span class="mf">3.0</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sta</span><span class="o">.</span><span class="n">discharge</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_Discharge_V3">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Calc_Discharge_V3">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_Discharge_V3</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the flow under a gate.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      .. math::</span>
<span class="sd">        Q = d \cdot w \cdot c \cdot \big( min (h, \ l) - b \big)</span>
<span class="sd">        \cdot \sqrt{2 \cdot g  \cdot (l_u - l_d)}</span>
<span class="sd">        \\ \\</span>
<span class="sd">        d = f_{filter\_norm}(l_u, \ l_d, \ DampingRadius) \\</span>
<span class="sd">        w = GateWidth \\</span>
<span class="sd">        c = FlowCoefficient \\</span>
<span class="sd">        h = GateHeight \\</span>
<span class="sd">        l = WaterLevel \\</span>
<span class="sd">        l_u = WaterLevelUpstream \\</span>
<span class="sd">        l_d = WaterLevelDownstream\\</span>
<span class="sd">        b = BottomLevel \\</span>
<span class="sd">        g = GravitationalAcceleration</span>

<span class="sd">    Examples:</span>

<span class="sd">        The first two examples deal with flow under a submerged gate:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.sw1d import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; bottomlevel(4.0)</span>
<span class="sd">        &gt;&gt;&gt; gateheight(6.0)</span>
<span class="sd">        &gt;&gt;&gt; gatewidth(3.0)</span>
<span class="sd">        &gt;&gt;&gt; flowcoefficient(0.6)</span>
<span class="sd">        &gt;&gt;&gt; dampingradius(0.0)</span>
<span class="sd">        &gt;&gt;&gt; factors.waterlevel = 8.0</span>
<span class="sd">        &gt;&gt;&gt; factors.waterlevelupstream = 9.0</span>
<span class="sd">        &gt;&gt;&gt; factors.waterleveldownstream = 7.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_discharge_v3()</span>
<span class="sd">        &gt;&gt;&gt; states.discharge</span>
<span class="sd">        discharge(22.551062)</span>
<span class="sd">        &gt;&gt;&gt; factors.waterlevelupstream = 7.0</span>
<span class="sd">        &gt;&gt;&gt; factors.waterleveldownstream = 9.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_discharge_v3()</span>
<span class="sd">        &gt;&gt;&gt; states.discharge</span>
<span class="sd">        discharge(-22.551062)</span>

<span class="sd">        The next two examples deal with a gate submerge &quot;on one side&quot;:</span>

<span class="sd">        &gt;&gt;&gt; gateheight(8.0)</span>
<span class="sd">        &gt;&gt;&gt; factors.waterlevelupstream = 9.0</span>
<span class="sd">        &gt;&gt;&gt; factors.waterleveldownstream = 7.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_discharge_v3()</span>
<span class="sd">        &gt;&gt;&gt; states.discharge</span>
<span class="sd">        discharge(45.102124)</span>
<span class="sd">        &gt;&gt;&gt; factors.waterlevelupstream = 7.0</span>
<span class="sd">        &gt;&gt;&gt; factors.waterleveldownstream = 9.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_discharge_v3()</span>
<span class="sd">        &gt;&gt;&gt; states.discharge</span>
<span class="sd">        discharge(-45.102124)</span>

<span class="sd">        For non-submerged gates, the water level becomes the effective gate opening:</span>

<span class="sd">        &gt;&gt;&gt; gateheight(10.0)</span>
<span class="sd">        &gt;&gt;&gt; factors.waterlevelupstream = 9.0</span>
<span class="sd">        &gt;&gt;&gt; factors.waterleveldownstream = 7.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_discharge_v3()</span>
<span class="sd">        &gt;&gt;&gt; states.discharge</span>
<span class="sd">        discharge(45.102124)</span>
<span class="sd">        &gt;&gt;&gt; factors.waterlevelupstream = 7.0</span>
<span class="sd">        &gt;&gt;&gt; factors.waterleveldownstream = 9.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_discharge_v3()</span>
<span class="sd">        &gt;&gt;&gt; states.discharge</span>
<span class="sd">        discharge(-45.102124)</span>

<span class="sd">        Negative effective gate openings result in zero discharge values:</span>

<span class="sd">        &gt;&gt;&gt; gateheight(0.0)</span>
<span class="sd">        &gt;&gt;&gt; factors.waterlevelupstream = 9.0</span>
<span class="sd">        &gt;&gt;&gt; factors.waterleveldownstream = 7.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_discharge_v3()</span>
<span class="sd">        &gt;&gt;&gt; states.discharge</span>
<span class="sd">        discharge(0.0)</span>
<span class="sd">        &gt;&gt;&gt; factors.waterlevelupstream = 7.0</span>
<span class="sd">        &gt;&gt;&gt; factors.waterleveldownstream = 9.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_discharge_v3()</span>
<span class="sd">        &gt;&gt;&gt; states.discharge</span>
<span class="sd">        discharge(0.0)</span>

<span class="sd">        According to the given base equation, the change in flow rate with respect to</span>
<span class="sd">        changes in the water level gradient is highest for little water level</span>
<span class="sd">        gradients.  For nearly zero gradients, these changes are so extreme that</span>
<span class="sd">        numerically solving this ordinary differential equation in combination with the</span>
<span class="sd">        ones of other routing models may introduce considerable artificial</span>
<span class="sd">        oscillations.</span>

<span class="sd">        In the following example, a water level gradient of 1 mm corresponds to a</span>
<span class="sd">        discharge of only 0.3 m/s, but also to a discharge increase of nearly</span>
<span class="sd">        1600 m/s per meter rise of the upstream water level:</span>

<span class="sd">        &gt;&gt;&gt; gateheight(10.0)</span>
<span class="sd">        &gt;&gt;&gt; factors.waterlevelupstream = 8.0001</span>
<span class="sd">        &gt;&gt;&gt; factors.waterleveldownstream = 8.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_discharge_v3()</span>
<span class="sd">        &gt;&gt;&gt; states.discharge</span>
<span class="sd">        discharge(0.31892)</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import NumericalDifferentiator, round_</span>
<span class="sd">        &gt;&gt;&gt; numdiff = NumericalDifferentiator(</span>
<span class="sd">        ...     xsequence=factors.waterlevelupstream,</span>
<span class="sd">        ...     ysequences=[states.discharge],</span>
<span class="sd">        ...     methods=[model.calc_discharge_v3])</span>
<span class="sd">        &gt;&gt;&gt; numdiff()</span>
<span class="sd">        d_discharge/d_waterlevelupstream: 1594.591021</span>

<span class="sd">        Principally, one could reduce the resulting oscillations by decreasing the</span>
<span class="sd">        internal calculation step size.  However, this alone sometimes results in</span>
<span class="sd">        unacceptable increases in computation time.  Hence, we suggest using the</span>
<span class="sd">        |DampingRadius| parameter to prevent such oscillations.  Setting it, for</span>
<span class="sd">        example, to 1 mm reduces the change in discharge to 40 m/s per meter:</span>

<span class="sd">        &gt;&gt;&gt; dampingradius(0.001)</span>
<span class="sd">        &gt;&gt;&gt; numdiff()</span>
<span class="sd">        d_discharge/d_waterlevelupstream: 39.685825</span>

<span class="sd">        Be careful not to set larger values than necessary, as this stabilisation trick</span>
<span class="sd">        does not only reduce the discharge derivative but also the discharge itself:</span>

<span class="sd">        &gt;&gt;&gt; model.calc_discharge_v3()</span>
<span class="sd">        &gt;&gt;&gt; states.discharge</span>
<span class="sd">        discharge(0.001591)</span>

<span class="sd">        All of the above examples deal with fixed gate openings.  However, in reality,</span>
<span class="sd">        gates are often controlled, so their opening degree depends on other</span>
<span class="sd">        properties.  Therefore, parameter |GateHeight| alternatively accepts a callback</span>
<span class="sd">        function for adjusting its values based on the current model state.  One can,</span>
<span class="sd">        for example, define a &quot;sluice&quot; function that prevents any flow for reversed</span>
<span class="sd">        water level gradients:</span>

<span class="sd">        &gt;&gt;&gt; def sluice(model) -&gt; None:</span>
<span class="sd">        ...     con = model.parameters.control.fastaccess</span>
<span class="sd">        ...     fac = model.sequences.factors.fastaccess</span>
<span class="sd">        ...     if fac.waterlevelupstream &lt; fac.waterleveldownstream:</span>
<span class="sd">        ...         con.gateheight = 4.0</span>
<span class="sd">        ...     else:</span>
<span class="sd">        ...         con.gateheight = 10.0</span>
<span class="sd">        &gt;&gt;&gt; ();gateheight(callback=sluice);()  # doctest: +ELLIPSIS</span>
<span class="sd">        (...)</span>

<span class="sd">        Method |Calc_Discharge_V3| applies this callback function before performing its</span>
<span class="sd">        further calculations.  Hence, the following results agree with the</span>
<span class="sd">        &quot;non-submerged gates&quot; example for a positive water level gradient and the</span>
<span class="sd">        &quot;negative effective gate opening&quot; example for a negative one:</span>

<span class="sd">        &gt;&gt;&gt; factors.waterlevelupstream = 9.0</span>
<span class="sd">        &gt;&gt;&gt; factors.waterleveldownstream = 7.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_discharge_v3()</span>
<span class="sd">        &gt;&gt;&gt; states.discharge</span>
<span class="sd">        discharge(45.102124)</span>
<span class="sd">        &gt;&gt;&gt; factors.waterlevelupstream = 7.0</span>
<span class="sd">        &gt;&gt;&gt; factors.waterleveldownstream = 9.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_discharge_v3()</span>
<span class="sd">        &gt;&gt;&gt; states.discharge</span>
<span class="sd">        discharge(0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">sw1d_control</span><span class="o">.</span><span class="n">BottomLevel</span><span class="p">,</span>
        <span class="n">sw1d_control</span><span class="o">.</span><span class="n">GateWidth</span><span class="p">,</span>
        <span class="n">sw1d_control</span><span class="o">.</span><span class="n">GateHeight</span><span class="p">,</span>
        <span class="n">sw1d_control</span><span class="o">.</span><span class="n">FlowCoefficient</span><span class="p">,</span>
        <span class="n">sw1d_control</span><span class="o">.</span><span class="n">DampingRadius</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_fixed</span><span class="o">.</span><span class="n">GravitationalAcceleration</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevel</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevelUpstream</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevelDownstream</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_states</span><span class="o">.</span><span class="n">Discharge</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fixed</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>

        <span class="n">con</span><span class="o">.</span><span class="n">gateheight_callback</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="n">h</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">gateheight</span><span class="p">,</span> <span class="n">fac</span><span class="o">.</span><span class="n">waterlevel</span><span class="p">)</span> <span class="o">-</span> <span class="n">con</span><span class="o">.</span><span class="n">bottomlevel</span>
        <span class="k">if</span> <span class="n">h</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">w</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">gatewidth</span>
            <span class="n">c</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">flowcoefficient</span>
            <span class="n">g</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">fix</span><span class="o">.</span><span class="n">gravitationalacceleration</span>
            <span class="n">lu</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">fac</span><span class="o">.</span><span class="n">waterlevelupstream</span>
            <span class="n">ld</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">fac</span><span class="o">.</span><span class="n">waterleveldownstream</span>
            <span class="k">if</span> <span class="n">ld</span> <span class="o">&lt;</span> <span class="n">lu</span><span class="p">:</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">discharge</span> <span class="o">=</span> <span class="n">w</span> <span class="o">*</span> <span class="n">c</span> <span class="o">*</span> <span class="n">h</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">g</span> <span class="o">*</span> <span class="p">(</span><span class="n">lu</span> <span class="o">-</span> <span class="n">ld</span><span class="p">))</span> <span class="o">**</span> <span class="mf">0.5</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">discharge</span> <span class="o">=</span> <span class="o">-</span><span class="n">w</span> <span class="o">*</span> <span class="n">c</span> <span class="o">*</span> <span class="n">h</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">g</span> <span class="o">*</span> <span class="p">(</span><span class="n">ld</span> <span class="o">-</span> <span class="n">lu</span><span class="p">))</span> <span class="o">**</span> <span class="mf">0.5</span>
            <span class="n">sta</span><span class="o">.</span><span class="n">discharge</span> <span class="o">*=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">smoothutils</span><span class="o">.</span><span class="n">filter_norm</span><span class="p">(</span><span class="n">lu</span><span class="p">,</span> <span class="n">ld</span><span class="p">,</span> <span class="n">con</span><span class="o">.</span><span class="n">dampingradius</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sta</span><span class="o">.</span><span class="n">discharge</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_Discharge_V4">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Calc_Discharge_V4">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_Discharge_V4</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the pumping rate.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      .. math::</span>
<span class="sd">    Basic equations:</span>
<span class="sd">      .. math::</span>
<span class="sd">        Discharge = \begin{cases}</span>
<span class="sd">        0 &amp;|\  h_u &lt; t_1 \\</span>
<span class="sd">        Q^* \cdot \frac{h_u - t_1}{t_2 - t_1}</span>
<span class="sd">         &amp;|\  t_1 \leq h_u &lt; t_2 \\</span>
<span class="sd">        Q^* &amp;|\  t_2 \leq h_u</span>
<span class="sd">        \end{cases}</span>
<span class="sd">        \\ \\ \\</span>
<span class="sd">        Q^* = max \big( f_{gradient2pumpingrate}(h_d - h_u), \ 0 \big) \\</span>
<span class="sd">        h_u = WaterLevelUpstream \\</span>
<span class="sd">        h_d = WaterLevelDownstream \\</span>
<span class="sd">        t_1 = TargetWaterLevel1 \\</span>
<span class="sd">        t_2 = TargetWaterLevel2</span>

<span class="sd">    Examples:</span>

<span class="sd">        The maximum pumping rate is 1 m/s for equal water levels and decreases</span>
<span class="sd">        linearly with rising downstream water levels until it reaches 0 m/s:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.sw1d import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; gradient2pumpingrate(PPoly(Poly(x0=0.0, cs=[1.0, -0.1]),</span>
<span class="sd">        ...                            Poly(x0=10.0, cs=[0.0])))</span>

<span class="sd">        We prepare a |UnitTest| object to demonstrate how |Calc_Discharge_V4| behaves</span>
<span class="sd">        when the upstream water level changes:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import UnitTest</span>
<span class="sd">        &gt;&gt;&gt; test = UnitTest(</span>
<span class="sd">        ...     model, model.calc_discharge_v4,</span>
<span class="sd">        ...     last_example=7,</span>
<span class="sd">        ...     parseqs=(factors.waterlevelupstream, states.discharge))</span>

<span class="sd">        We fix the downstream water level to 2 m and vary the upstream water level</span>
<span class="sd">        between 1.5 m to 4.5 m:</span>

<span class="sd">        &gt;&gt;&gt; factors.waterleveldownstream = 2.0</span>
<span class="sd">        &gt;&gt;&gt; test.nexts.waterlevelupstream = 1.5, 2.0, 2.5, 3.0, 3.5, 4.0, 4.5</span>

<span class="sd">        If we set both target water levels to the same value, the pump becomes fully</span>
<span class="sd">        activated or deactivated when the upstream water level exceeds or falls below</span>
<span class="sd">        this threshold:</span>

<span class="sd">        &gt;&gt;&gt; targetwaterlevel1(2.0)</span>
<span class="sd">        &gt;&gt;&gt; targetwaterlevel2(2.0)</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. | waterlevelupstream | discharge |</span>
<span class="sd">        ----------------------------------------</span>
<span class="sd">        |   1 |                1.5 |       0.0 |</span>
<span class="sd">        |   2 |                2.0 |       1.0 |</span>
<span class="sd">        |   3 |                2.5 |      0.95 |</span>
<span class="sd">        |   4 |                3.0 |       0.9 |</span>
<span class="sd">        |   5 |                3.5 |      0.85 |</span>
<span class="sd">        |   6 |                4.0 |       0.8 |</span>
<span class="sd">        |   7 |                4.5 |      0.75 |</span>

<span class="sd">        Setting |TargetWaterLevel1| and |TargetWaterLevel2| to the same value might</span>
<span class="sd">        result in situations with frequent &quot;on-off switching&quot;, which may eventually</span>
<span class="sd">        have adverse effects on computational efficiency or simulation accuracy.  After</span>
<span class="sd">        setting |TargetWaterLevel2| to 4 m, the pump&#39;s transition between on and off</span>
<span class="sd">        becomes smoother:</span>

<span class="sd">        &gt;&gt;&gt; targetwaterlevel2(4.0)</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. | waterlevelupstream | discharge |</span>
<span class="sd">        ----------------------------------------</span>
<span class="sd">        |   1 |                1.5 |       0.0 |</span>
<span class="sd">        |   2 |                2.0 |       0.0 |</span>
<span class="sd">        |   3 |                2.5 |    0.2375 |</span>
<span class="sd">        |   4 |                3.0 |      0.45 |</span>
<span class="sd">        |   5 |                3.5 |    0.6375 |</span>
<span class="sd">        |   6 |                4.0 |       0.8 |</span>
<span class="sd">        |   7 |                4.5 |      0.75 |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">sw1d_control</span><span class="o">.</span><span class="n">Gradient2PumpingRate</span><span class="p">,</span>
        <span class="n">sw1d_control</span><span class="o">.</span><span class="n">TargetWaterLevel1</span><span class="p">,</span>
        <span class="n">sw1d_control</span><span class="o">.</span><span class="n">TargetWaterLevel2</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevelUpstream</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevelDownstream</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_states</span><span class="o">.</span><span class="n">Discharge</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>

        <span class="n">hu</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">fac</span><span class="o">.</span><span class="n">waterlevelupstream</span>
        <span class="n">hd</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">fac</span><span class="o">.</span><span class="n">waterleveldownstream</span>
        <span class="n">t1</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">targetwaterlevel1</span>
        <span class="n">t2</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">targetwaterlevel2</span>

        <span class="k">if</span> <span class="n">hu</span> <span class="o">&lt;</span> <span class="n">t1</span><span class="p">:</span>
            <span class="n">sta</span><span class="o">.</span><span class="n">discharge</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">con</span><span class="o">.</span><span class="n">gradient2pumpingrate</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">hu</span> <span class="o">-</span> <span class="n">hd</span>
            <span class="n">con</span><span class="o">.</span><span class="n">gradient2pumpingrate</span><span class="o">.</span><span class="n">calculate_values</span><span class="p">()</span>
            <span class="n">sta</span><span class="o">.</span><span class="n">discharge</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">gradient2pumpingrate</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">hu</span> <span class="o">&lt;</span> <span class="n">t2</span><span class="p">:</span>
                <span class="n">sta</span><span class="o">.</span><span class="n">discharge</span> <span class="o">*=</span> <span class="p">(</span><span class="n">hu</span> <span class="o">-</span> <span class="n">t1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">t2</span> <span class="o">-</span> <span class="n">t1</span><span class="p">)</span></div>



<div class="viewcode-block" id="Update_Discharge_V1">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Update_Discharge_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Update_Discharge_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Reduce the already calculated discharge due to limited water availability in</span>
<span class="sd">    one of the adjacent channel segments.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      .. math::</span>
<span class="sd">        Q_{new} = \begin{cases}</span>
<span class="sd">        max(Q_{old}, \ 1000 \cdot max(V_u, \ 0) / \Delta  &amp;|\  Q_{old} &gt; 0 \\</span>
<span class="sd">        min(Q_{old}, \ -1000 \cdot max(V_d, \ 0) / \Delta  &amp;|\  Q_{old} &lt; 0</span>
<span class="sd">        \end{cases} \\</span>
<span class="sd">        \\ \\</span>
<span class="sd">        Q = Discharge \\</span>
<span class="sd">        V_u = WaterVolumeUpstream \\</span>
<span class="sd">        V_d = WaterVolumeDownstream \\</span>
<span class="sd">        \Delta = TimeStep</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.sw1d import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; factors.timestep = 100.0</span>
<span class="sd">        &gt;&gt;&gt; factors.watervolumeupstream = 0.1</span>
<span class="sd">        &gt;&gt;&gt; factors.watervolumedownstream = 0.2</span>

<span class="sd">        |Update_Discharge_V1| must consider the upstream segment&#39;s water volume for</span>
<span class="sd">        positive discharge values:</span>

<span class="sd">        &gt;&gt;&gt; states.discharge = 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.update_discharge_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.discharge</span>
<span class="sd">        discharge(1.0)</span>
<span class="sd">        &gt;&gt;&gt; states.discharge = 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.update_discharge_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.discharge</span>
<span class="sd">        discharge(1.0)</span>

<span class="sd">        Instead, it must consider the downstream segment&#39;s water volume for negative</span>
<span class="sd">        discharge values:</span>

<span class="sd">        &gt;&gt;&gt; states.discharge = -2.0</span>
<span class="sd">        &gt;&gt;&gt; model.update_discharge_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.discharge</span>
<span class="sd">        discharge(-2.0)</span>
<span class="sd">        &gt;&gt;&gt; states.discharge = -3.0</span>
<span class="sd">        &gt;&gt;&gt; model.update_discharge_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.discharge</span>
<span class="sd">        discharge(-2.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">TimeStep</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterVolumeUpstream</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterVolumeDownstream</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_states</span><span class="o">.</span><span class="n">Discharge</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">discharge</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">q_max</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1000.0</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="n">fac</span><span class="o">.</span><span class="n">watervolumeupstream</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">/</span> <span class="n">fac</span><span class="o">.</span><span class="n">timestep</span>
            <span class="n">sta</span><span class="o">.</span><span class="n">discharge</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">discharge</span><span class="p">,</span> <span class="n">q_max</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">sta</span><span class="o">.</span><span class="n">discharge</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">q_min</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1000.0</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="n">fac</span><span class="o">.</span><span class="n">watervolumedownstream</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">/</span> <span class="n">fac</span><span class="o">.</span><span class="n">timestep</span>
            <span class="n">sta</span><span class="o">.</span><span class="n">discharge</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">discharge</span><span class="p">,</span> <span class="n">q_min</span><span class="p">)</span></div>



<div class="viewcode-block" id="Update_Discharge_V2">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Update_Discharge_V2">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Update_Discharge_V2</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Sluice-like discharge reduction with separate control for low and high flow</span>
<span class="sd">    protection.</span>

<span class="sd">    Basic equations:</span>
<span class="sd">      .. math::</span>
<span class="sd">        Q_{new} = Q_{new} \cdot \begin{cases}</span>
<span class="sd">        free  &amp;|\  h_u \leq h_d \\</span>
<span class="sd">        free + sluice &amp;|\  h_d &lt; h_u \\</span>
<span class="sd">        \end{cases} \\</span>
<span class="sd">        \\ \\</span>
<span class="sd">        closed = \begin{cases}</span>
<span class="sd">        1 &amp;|\  h_u \leq t_{bl} \\</span>
<span class="sd">        1 - \frac{h_u - t_{bl}}{t_{ul} - t_{bl}} &amp;|\  t_{bl} &lt; h_u &lt; t_{ul} \\</span>
<span class="sd">        0 &amp;|\  t_{ul} \leq h_u</span>
<span class="sd">        \end{cases} \\</span>
<span class="sd">        \\</span>
<span class="sd">        sluice = \begin{cases}</span>
<span class="sd">        0 &amp;|\  h_u \leq t_{bh} \\</span>
<span class="sd">        \frac{h_u - t_{bh}}{t_{uh} - t_{bh}} &amp;|\  t_{bh} &lt; h_u &lt; t_{uh} \\</span>
<span class="sd">        1 &amp;|\  t_{uh} \leq h_u</span>
<span class="sd">        \end{cases} \\</span>
<span class="sd">        \\</span>
<span class="sd">        free = 1 - closed - sluice \\</span>
<span class="sd">        \\</span>
<span class="sd">        Q = Discharge \\</span>
<span class="sd">        h_u = WaterLevelUpstream \\</span>
<span class="sd">        h_d = WaterLevelDownstream \\</span>
<span class="sd">        t_{bl} = BottomLowWaterThreshold \\</span>
<span class="sd">        t_{ul} = UpperLowWaterThreshold \\</span>
<span class="sd">        t_{bh} = BottomHighWaterThreshold \\</span>
<span class="sd">        t_{uh} = UpperHighWaterThreshold</span>

<span class="sd">    Examples:</span>

<span class="sd">        All involved control parameters are subclasses of |SeasonalParameter|, which</span>
<span class="sd">        allows the simulation of seasonal sluice control schemes.  To show how this</span>
<span class="sd">        works, we first define a simulation period of four days:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-01&quot;, &quot;2000-01-05&quot;, &quot;1d&quot;</span>

<span class="sd">        We prepare a model and define different control schemes for four consecutive</span>
<span class="sd">        days:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.sw1d import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; bottomlowwaterthreshold(_1_1_12=5.0, _1_2_12=2.0, _1_3_12=2.0, _1_4_12=2.0)</span>
<span class="sd">        &gt;&gt;&gt; upperlowwaterthreshold(_1_1_12=5.0, _1_2_12=8.0, _1_3_12=5.0, _1_4_12=6.0)</span>
<span class="sd">        &gt;&gt;&gt; bottomhighwaterthreshold(_1_1_12=5.0, _1_2_12=2.0, _1_3_12=5.0, _1_4_12=4.0)</span>
<span class="sd">        &gt;&gt;&gt; upperhighwaterthreshold(_1_1_12=5.0, _1_2_12=8.0, _1_3_12=8.0, _1_4_12=8.0)</span>
<span class="sd">        &gt;&gt;&gt; derived.toy.update()</span>

<span class="sd">        We prepare a |UnitTest| object to demonstrate the dependency of</span>
<span class="sd">        |Update_Discharge_V2| on the downstream water level:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import UnitTest</span>
<span class="sd">        &gt;&gt;&gt; test = UnitTest(model, model.update_discharge_v2, last_example=9,</span>
<span class="sd">        ...                 parseqs=(factors.waterlevelupstream, states.discharge))</span>
<span class="sd">        &gt;&gt;&gt; test.nexts.waterlevelupstream = 1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0</span>

<span class="sd">        We will discuss each day&#39;s control scheme for a normal flow situation with a</span>
<span class="sd">        relatively low downstream water level and a reversed flow situation with a</span>
<span class="sd">        relatively high downstream water level.</span>

<span class="sd">        For April 1, all threshold parameters have the same value of 5 m.  So, gates</span>
<span class="sd">        are generally closed below an upstream water level of 5 m to prevent</span>
<span class="sd">        the source catchment from running dry during low flow periods (&quot;closed gate&quot;)</span>
<span class="sd">        and only allow normal flow above 5 m to maximise drainage during high flow</span>
<span class="sd">        periods (&quot;sluice mode&quot;):</span>

<span class="sd">        &gt;&gt;&gt; model.idx_sim = pub.timegrids.init[&quot;2000-01-01&quot;]</span>
<span class="sd">        &gt;&gt;&gt; factors.waterleveldownstream = 0.0</span>
<span class="sd">        &gt;&gt;&gt; test.inits.discharge = 1.0</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. | waterlevelupstream | discharge |</span>
<span class="sd">        ----------------------------------------</span>
<span class="sd">        |   1 |                1.0 |       0.0 |</span>
<span class="sd">        |   2 |                2.0 |       0.0 |</span>
<span class="sd">        |   3 |                3.0 |       0.0 |</span>
<span class="sd">        |   4 |                4.0 |       0.0 |</span>
<span class="sd">        |   5 |                5.0 |       1.0 |</span>
<span class="sd">        |   6 |                6.0 |       1.0 |</span>
<span class="sd">        |   7 |                7.0 |       1.0 |</span>
<span class="sd">        |   8 |                8.0 |       1.0 |</span>
<span class="sd">        |   9 |                9.0 |       1.0 |</span>

<span class="sd">        &gt;&gt;&gt; factors.waterleveldownstream = 10.0</span>
<span class="sd">        &gt;&gt;&gt; test.inits.discharge = -1.0</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. | waterlevelupstream | discharge |</span>
<span class="sd">        ----------------------------------------</span>
<span class="sd">        |   1 |                1.0 |       0.0 |</span>
<span class="sd">        |   2 |                2.0 |       0.0 |</span>
<span class="sd">        |   3 |                3.0 |       0.0 |</span>
<span class="sd">        |   4 |                4.0 |       0.0 |</span>
<span class="sd">        |   5 |                5.0 |       0.0 |</span>
<span class="sd">        |   6 |                6.0 |       0.0 |</span>
<span class="sd">        |   7 |                7.0 |       0.0 |</span>
<span class="sd">        |   8 |                8.0 |       0.0 |</span>
<span class="sd">        |   9 |                9.0 |       0.0 |</span>

<span class="sd">        In the following examples, he transitions between the low and high water</span>
<span class="sd">        control schemes are not sharp but gradual, which is often more realistic and</span>
<span class="sd">        numerically favourable.  For April 2, the values of |BottomLowWaterThreshold|</span>
<span class="sd">        and |BottomHighWaterThreshold| and the values of |UpperLowWaterThreshold| and</span>
<span class="sd">        |UpperHighWaterThreshold| are equal.  Hence, we see a linear-interpolation-like</span>
<span class="sd">        transition from the &quot;closed gate&quot; to the &quot;sluice mode&quot; control schemes:</span>

<span class="sd">        &gt;&gt;&gt; model.idx_sim = pub.timegrids.init[&quot;2000-01-02&quot;]</span>
<span class="sd">        &gt;&gt;&gt; factors.waterleveldownstream = 0.0</span>
<span class="sd">        &gt;&gt;&gt; test.inits.discharge = 1.0</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. | waterlevelupstream | discharge |</span>
<span class="sd">        ----------------------------------------</span>
<span class="sd">        |   1 |                1.0 |       0.0 |</span>
<span class="sd">        |   2 |                2.0 |       0.0 |</span>
<span class="sd">        |   3 |                3.0 |  0.166667 |</span>
<span class="sd">        |   4 |                4.0 |  0.333333 |</span>
<span class="sd">        |   5 |                5.0 |       0.5 |</span>
<span class="sd">        |   6 |                6.0 |  0.666667 |</span>
<span class="sd">        |   7 |                7.0 |  0.833333 |</span>
<span class="sd">        |   8 |                8.0 |       1.0 |</span>
<span class="sd">        |   9 |                9.0 |       1.0 |</span>

<span class="sd">        &gt;&gt;&gt; factors.waterleveldownstream = 10.0</span>
<span class="sd">        &gt;&gt;&gt; test.inits.discharge = -1.0</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. | waterlevelupstream | discharge |</span>
<span class="sd">        ----------------------------------------</span>
<span class="sd">        |   1 |                1.0 |       0.0 |</span>
<span class="sd">        |   2 |                2.0 |       0.0 |</span>
<span class="sd">        |   3 |                3.0 |       0.0 |</span>
<span class="sd">        |   4 |                4.0 |       0.0 |</span>
<span class="sd">        |   5 |                5.0 |       0.0 |</span>
<span class="sd">        |   6 |                6.0 |       0.0 |</span>
<span class="sd">        |   7 |                7.0 |       0.0 |</span>
<span class="sd">        |   8 |                8.0 |       0.0 |</span>
<span class="sd">        |   9 |                9.0 |       0.0 |</span>

<span class="sd">        For April 3, the values of |UpperLowWaterThreshold| and</span>
<span class="sd">        |BottomHighWaterThreshold| are equal.  So, at this point, neither the &quot;closed</span>
<span class="sd">        gate&quot; nor the &quot;sluice mode&quot; control schemes apply, and the water can flow</span>
<span class="sd">        freely in both directions (&quot;free discharge&quot;):</span>

<span class="sd">        &gt;&gt;&gt; model.idx_sim = pub.timegrids.init[&quot;2000-01-03&quot;]</span>
<span class="sd">        &gt;&gt;&gt; factors.waterleveldownstream = 0.0</span>
<span class="sd">        &gt;&gt;&gt; test.inits.discharge = 1.0</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. | waterlevelupstream | discharge |</span>
<span class="sd">        ----------------------------------------</span>
<span class="sd">        |   1 |                1.0 |       0.0 |</span>
<span class="sd">        |   2 |                2.0 |       0.0 |</span>
<span class="sd">        |   3 |                3.0 |  0.333333 |</span>
<span class="sd">        |   4 |                4.0 |  0.666667 |</span>
<span class="sd">        |   5 |                5.0 |       1.0 |</span>
<span class="sd">        |   6 |                6.0 |       1.0 |</span>
<span class="sd">        |   7 |                7.0 |       1.0 |</span>
<span class="sd">        |   8 |                8.0 |       1.0 |</span>
<span class="sd">        |   9 |                9.0 |       1.0 |</span>

<span class="sd">        &gt;&gt;&gt; factors.waterleveldownstream = 10.0</span>
<span class="sd">        &gt;&gt;&gt; test.inits.discharge = -1.0</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. | waterlevelupstream | discharge |</span>
<span class="sd">        ----------------------------------------</span>
<span class="sd">        |   1 |                1.0 |       0.0 |</span>
<span class="sd">        |   2 |                2.0 |       0.0 |</span>
<span class="sd">        |   3 |                3.0 | -0.333333 |</span>
<span class="sd">        |   4 |                4.0 | -0.666667 |</span>
<span class="sd">        |   5 |                5.0 |      -1.0 |</span>
<span class="sd">        |   6 |                6.0 | -0.666667 |</span>
<span class="sd">        |   7 |                7.0 | -0.333333 |</span>
<span class="sd">        |   8 |                8.0 |       0.0 |</span>
<span class="sd">        |   9 |                9.0 |       0.0 |</span>


<span class="sd">        For April 4, the &quot;closed gate&quot; and &quot;sluice mode&quot; parameter ranges are partly</span>
<span class="sd">        overlapping, so reversed flow can occur but only with reduced intensity:</span>

<span class="sd">        &gt;&gt;&gt; model.idx_sim = pub.timegrids.init[&quot;2000-01-04&quot;]</span>
<span class="sd">        &gt;&gt;&gt; factors.waterleveldownstream = 0.0</span>
<span class="sd">        &gt;&gt;&gt; test.inits.discharge = 1.0</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. | waterlevelupstream | discharge |</span>
<span class="sd">        ----------------------------------------</span>
<span class="sd">        |   1 |                1.0 |       0.0 |</span>
<span class="sd">        |   2 |                2.0 |       0.0 |</span>
<span class="sd">        |   3 |                3.0 |      0.25 |</span>
<span class="sd">        |   4 |                4.0 |       0.5 |</span>
<span class="sd">        |   5 |                5.0 |      0.75 |</span>
<span class="sd">        |   6 |                6.0 |       1.0 |</span>
<span class="sd">        |   7 |                7.0 |       1.0 |</span>
<span class="sd">        |   8 |                8.0 |       1.0 |</span>
<span class="sd">        |   9 |                9.0 |       1.0 |</span>

<span class="sd">        &gt;&gt;&gt; factors.waterleveldownstream = 10.0</span>
<span class="sd">        &gt;&gt;&gt; test.inits.discharge = -1.0</span>
<span class="sd">        &gt;&gt;&gt; test()</span>
<span class="sd">        | ex. | waterlevelupstream | discharge |</span>
<span class="sd">        ----------------------------------------</span>
<span class="sd">        |   1 |                1.0 |       0.0 |</span>
<span class="sd">        |   2 |                2.0 |       0.0 |</span>
<span class="sd">        |   3 |                3.0 |     -0.25 |</span>
<span class="sd">        |   4 |                4.0 |      -0.5 |</span>
<span class="sd">        |   5 |                5.0 |      -0.5 |</span>
<span class="sd">        |   6 |                6.0 |      -0.5 |</span>
<span class="sd">        |   7 |                7.0 |     -0.25 |</span>
<span class="sd">        |   8 |                8.0 |       0.0 |</span>
<span class="sd">        |   9 |                9.0 |       0.0 |</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">sw1d_control</span><span class="o">.</span><span class="n">BottomLowWaterThreshold</span><span class="p">,</span>
        <span class="n">sw1d_control</span><span class="o">.</span><span class="n">UpperLowWaterThreshold</span><span class="p">,</span>
        <span class="n">sw1d_control</span><span class="o">.</span><span class="n">BottomHighWaterThreshold</span><span class="p">,</span>
        <span class="n">sw1d_control</span><span class="o">.</span><span class="n">UpperHighWaterThreshold</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_derived</span><span class="o">.</span><span class="n">TOY</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevelUpstream</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevelDownstream</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_states</span><span class="o">.</span><span class="n">Discharge</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>

        <span class="n">hu</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">fac</span><span class="o">.</span><span class="n">waterlevelupstream</span>
        <span class="n">hd</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">fac</span><span class="o">.</span><span class="n">waterleveldownstream</span>
        <span class="n">toy</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">toy</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">idx_sim</span><span class="p">]</span>
        <span class="n">lt1</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">bottomlowwaterthreshold</span><span class="p">[</span><span class="n">toy</span><span class="p">]</span>
        <span class="n">lt2</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">upperlowwaterthreshold</span><span class="p">[</span><span class="n">toy</span><span class="p">]</span>
        <span class="n">ht1</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">bottomhighwaterthreshold</span><span class="p">[</span><span class="n">toy</span><span class="p">]</span>
        <span class="n">ht2</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">upperhighwaterthreshold</span><span class="p">[</span><span class="n">toy</span><span class="p">]</span>

        <span class="c1"># Is the sluice generally closed? (low water protection)</span>
        <span class="k">if</span> <span class="n">hu</span> <span class="o">&lt;</span> <span class="n">lt1</span><span class="p">:</span>
            <span class="n">state_closed</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">elif</span> <span class="n">hu</span> <span class="o">&lt;</span> <span class="n">lt2</span><span class="p">:</span>
            <span class="n">state_closed</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span><span class="n">hu</span> <span class="o">-</span> <span class="n">lt1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">lt2</span> <span class="o">-</span> <span class="n">lt1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">state_closed</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="c1"># Is the sluice in real sluice mode? (high water protection)</span>
        <span class="k">if</span> <span class="n">hu</span> <span class="o">&lt;</span> <span class="n">ht1</span><span class="p">:</span>
            <span class="n">state_sluice</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">elif</span> <span class="n">hu</span> <span class="o">&lt;</span> <span class="n">ht2</span><span class="p">:</span>
            <span class="n">state_sluice</span> <span class="o">=</span> <span class="p">(</span><span class="n">hu</span> <span class="o">-</span> <span class="n">ht1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">ht2</span> <span class="o">-</span> <span class="n">ht1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">state_sluice</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="c1"># Is the sluice generally open? (no protection measures necessary)</span>
        <span class="n">state_free</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">state_closed</span> <span class="o">-</span> <span class="n">state_sluice</span>

        <span class="n">sta</span><span class="o">.</span><span class="n">discharge</span> <span class="o">*=</span> <span class="n">state_free</span> <span class="o">+</span> <span class="p">(</span><span class="n">state_sluice</span> <span class="k">if</span> <span class="n">hu</span> <span class="o">&gt;</span> <span class="n">hd</span> <span class="k">else</span> <span class="mf">0.0</span><span class="p">)</span></div>



<div class="viewcode-block" id="Reset_DischargeVolume_V1">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Reset_DischargeVolume_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Reset_DischargeVolume_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reset the discharge volume to zero (at the beginning of an external simulation</span>
<span class="sd">    step).</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.sw1d import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dischargevolume = 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.reset_dischargevolume_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dischargevolume</span>
<span class="sd">        dischargevolume(0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_fluxes</span><span class="o">.</span><span class="n">DischargeVolume</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">dischargevolume</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Update_DischargeVolume_V1">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Update_DischargeVolume_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Update_DischargeVolume_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Update the total discharge volume of the current external simulation step.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`DischargeVolume_{new} = DischargeVolume_{old} + TimeStep \cdot Discharge`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.sw1d import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dischargevolume = 6.0</span>
<span class="sd">        &gt;&gt;&gt; factors.timestep = 60.0</span>
<span class="sd">        &gt;&gt;&gt; states.discharge = 0.2</span>
<span class="sd">        &gt;&gt;&gt; model.update_dischargevolume_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dischargevolume</span>
<span class="sd">        dischargevolume(18.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_factors</span><span class="o">.</span><span class="n">TimeStep</span><span class="p">,</span> <span class="n">sw1d_states</span><span class="o">.</span><span class="n">Discharge</span><span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_fluxes</span><span class="o">.</span><span class="n">DischargeVolume</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">dischargevolume</span> <span class="o">+=</span> <span class="n">fac</span><span class="o">.</span><span class="n">timestep</span> <span class="o">*</span> <span class="n">sta</span><span class="o">.</span><span class="n">discharge</span></div>



<div class="viewcode-block" id="Calc_DischargeVolume_V1">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Calc_DischargeVolume_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_DischargeVolume_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the total discharge volume of a complete external simulation step at</span>
<span class="sd">    once.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`DischargeVolume = Seconds \cdot Inflow`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.sw1d import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; derived.seconds(60.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.inflow = 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_dischargevolume_v1()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dischargevolume</span>
<span class="sd">        dischargevolume(120.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_derived</span><span class="o">.</span><span class="n">Seconds</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_fluxes</span><span class="o">.</span><span class="n">Inflow</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_fluxes</span><span class="o">.</span><span class="n">DischargeVolume</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">dischargevolume</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">seconds</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">inflow</span></div>



<div class="viewcode-block" id="Calc_DischargeVolume_V2">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Calc_DischargeVolume_V2">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_DischargeVolume_V2</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the total discharge volume of a complete external simulation step at</span>
<span class="sd">    once.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`DischargeVolume = Seconds \cdot Outflow`</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.sw1d import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; derived.seconds(60.0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.outflow = 2.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_dischargevolume_v2()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.dischargevolume</span>
<span class="sd">        dischargevolume(120.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_derived</span><span class="o">.</span><span class="n">Seconds</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_fluxes</span><span class="o">.</span><span class="n">Outflow</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_fluxes</span><span class="o">.</span><span class="n">DischargeVolume</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">dischargevolume</span> <span class="o">=</span> <span class="n">der</span><span class="o">.</span><span class="n">seconds</span> <span class="o">*</span> <span class="n">flu</span><span class="o">.</span><span class="n">outflow</span></div>



<div class="viewcode-block" id="Calc_Discharges_V1">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Calc_Discharges_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_Discharges_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Let a network model order all routing submodels following the |RoutingModel_V1|,</span>
<span class="sd">    |RoutingModel_V2|, or |RoutingModel_V3| interface to determine their individual</span>
<span class="sd">    discharge values.</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.sw1d_channel import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nmbsegments(2)</span>
<span class="sd">        &gt;&gt;&gt; with model.add_routingmodel_v2(&quot;sw1d_lias&quot;, position=1, update=False) as r:</span>
<span class="sd">        ...     diffusionfactor(0.2)</span>
<span class="sd">        ...     stricklercoefficient(50.0)</span>
<span class="sd">        ...     derived.lengthmean(2.0)</span>
<span class="sd">        ...     factors.timestep = 100.0</span>
<span class="sd">        ...     factors.wettedarea = 6.0</span>
<span class="sd">        ...     factors.wettedperimeter = 8.0</span>
<span class="sd">        ...     factors.waterlevelupstream = 5.0</span>
<span class="sd">        ...     factors.waterleveldownstream = 3.0</span>
<span class="sd">        ...     states.discharge = 7.831208</span>
<span class="sd">        ...     fluxes.dischargeupstream = 7.831208</span>
<span class="sd">        ...     fluxes.dischargedownstream = 7.831208</span>
<span class="sd">        &gt;&gt;&gt; model.calc_discharges_v1()</span>
<span class="sd">        &gt;&gt;&gt; r.sequences.states.discharge</span>
<span class="sd">        discharge(7.831208)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMODELINTERFACES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">routinginterfaces</span><span class="o">.</span><span class="n">RoutingModel_V1</span><span class="p">,</span>
        <span class="n">routinginterfaces</span><span class="o">.</span><span class="n">RoutingModel_V2</span><span class="p">,</span>
        <span class="n">routinginterfaces</span><span class="o">.</span><span class="n">RoutingModel_V3</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">routingmodels</span><span class="o">.</span><span class="n">number</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">routingmodels</span><span class="o">.</span><span class="n">typeids</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
                <span class="n">cast</span><span class="p">(</span>
                    <span class="n">RoutingModels_V1_V2_V3</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">routingmodels</span><span class="o">.</span><span class="n">submodels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="p">)</span><span class="o">.</span><span class="n">determine_discharge</span><span class="p">()</span></div>



<div class="viewcode-block" id="Calc_Discharges_V2">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Calc_Discharges_V2">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_Discharges_V2</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Query the discharge volume of the complete external simulation step from all</span>
<span class="sd">    submodels following the |RoutingModel_V1|, |RoutingModel_V2|, or |RoutingModel_V3|</span>
<span class="sd">    interface and calculate the corresponding average discharges.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`Discharges_i = DischargeVolume / Seconds`</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.sw1d_channel import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nmbsegments(2)</span>
<span class="sd">        &gt;&gt;&gt; derived.seconds(60.0)</span>
<span class="sd">        &gt;&gt;&gt; with model.add_routingmodel_v2(&quot;sw1d_lias&quot;, position=1, update=False):</span>
<span class="sd">        ...     fluxes.dischargevolume = 120.0</span>
<span class="sd">        &gt;&gt;&gt; model.calc_discharges_v2()</span>
<span class="sd">        &gt;&gt;&gt; fluxes.discharges</span>
<span class="sd">        discharges(0.0, 2.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMODELINTERFACES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">routinginterfaces</span><span class="o">.</span><span class="n">RoutingModel_V1</span><span class="p">,</span>
        <span class="n">routinginterfaces</span><span class="o">.</span><span class="n">RoutingModel_V2</span><span class="p">,</span>
        <span class="n">routinginterfaces</span><span class="o">.</span><span class="n">RoutingModel_V3</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_derived</span><span class="o">.</span><span class="n">Seconds</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_fluxes</span><span class="o">.</span><span class="n">Discharges</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">der</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">derived</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">routingmodels</span><span class="o">.</span><span class="n">number</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">routingmodels</span><span class="o">.</span><span class="n">typeids</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">discharges</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">cast</span><span class="p">(</span>
                        <span class="n">RoutingModels_V1_V2_V3</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">routingmodels</span><span class="o">.</span><span class="n">submodels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">get_dischargevolume</span><span class="p">()</span>
                    <span class="o">/</span> <span class="n">der</span><span class="o">.</span><span class="n">seconds</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">discharges</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>



<div class="viewcode-block" id="Calc_NetInflow_V1">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Calc_NetInflow_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Calc_NetInflow_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the net flow into a channel segment.</span>

<span class="sd">    Examples:</span>

<span class="sd">        Without adjacent routing models, net inflow equals lateral inflow:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import Element, Node, prepare_model</span>
<span class="sd">        &gt;&gt;&gt; c = prepare_model(&quot;sw1d_channel&quot;)</span>
<span class="sd">        &gt;&gt;&gt; c.parameters.control.nmbsegments(1)</span>
<span class="sd">        &gt;&gt;&gt; with c.add_storagemodel_v1(&quot;sw1d_storage&quot;, position=0, update=False) as s:</span>
<span class="sd">        ...     factors.timestep = 100.0</span>
<span class="sd">        ...     fluxes.lateralflow = 1.0</span>
<span class="sd">        &gt;&gt;&gt; s.calc_netinflow_v1()</span>
<span class="sd">        &gt;&gt;&gt; s.sequences.fluxes.netinflow</span>
<span class="sd">        netinflow(0.1)</span>

<span class="sd">        With adjacent routing models, |Calc_NetInflow_V1| adds the discharge from the</span>
<span class="sd">        upper one and subtracts the discharge from the lower one:</span>

<span class="sd">        &gt;&gt;&gt; n01, n12 = Node(&quot;n01&quot;, variable=&quot;LongQ&quot;), Node(&quot;n12&quot;, variable=&quot;LongQ&quot;)</span>
<span class="sd">        &gt;&gt;&gt; e1 = Element(&quot;e1&quot;, inlets=n01, outlets=n12)</span>
<span class="sd">        &gt;&gt;&gt; e1.model = c</span>
<span class="sd">        &gt;&gt;&gt; e0a, e0b = Element(&quot;e0a&quot;, outlets=n01), Element(&quot;e0b&quot;, outlets=n01)</span>
<span class="sd">        &gt;&gt;&gt; e2a, e2b = Element(&quot;e2a&quot;, inlets=n12), Element(&quot;e2b&quot;, inlets=n12)</span>
<span class="sd">        &gt;&gt;&gt; for element, position, discharge in ((e0a, 1, 1.0), (e0b, 1, 2.0),</span>
<span class="sd">        ...                                      (e2a, 0, 2.0), (e2b, 0, 3.0)):</span>
<span class="sd">        ...     c = prepare_model(&quot;sw1d_channel&quot;)</span>
<span class="sd">        ...     c.parameters.control.nmbsegments(1)</span>
<span class="sd">        ...     with c.add_routingmodel_v2(</span>
<span class="sd">        ...             &quot;sw1d_lias&quot;, position=position, update=False):</span>
<span class="sd">        ...         states.discharge = discharge</span>
<span class="sd">        ...     with c.add_storagemodel_v1(&quot;sw1d_storage&quot;, position=0, update=False):</span>
<span class="sd">        ...         pass</span>
<span class="sd">        ...     element.model = c</span>
<span class="sd">        &gt;&gt;&gt; network = c.couple_models(</span>
<span class="sd">        ...     nodes=(n01, n12), elements=(e0a, e0b, e1, e2a, e2b))</span>
<span class="sd">        &gt;&gt;&gt; s.calc_netinflow_v1()</span>
<span class="sd">        &gt;&gt;&gt; s.sequences.fluxes.netinflow</span>
<span class="sd">        netinflow(-0.1)</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; Node.clear_all()</span>
<span class="sd">            &gt;&gt;&gt; Element.clear_all()</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMODELINTERFACES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">routinginterfaces</span><span class="o">.</span><span class="n">RoutingModel_V1</span><span class="p">,</span>
        <span class="n">routinginterfaces</span><span class="o">.</span><span class="n">RoutingModel_V2</span><span class="p">,</span>
        <span class="n">routinginterfaces</span><span class="o">.</span><span class="n">StorageModel_V1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_factors</span><span class="o">.</span><span class="n">TimeStep</span><span class="p">,</span> <span class="n">sw1d_fluxes</span><span class="o">.</span><span class="n">LateralFlow</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_fluxes</span><span class="o">.</span><span class="n">NetInflow</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">netinflow</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">lateralflow</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">routingmodelsupstream</span><span class="o">.</span><span class="n">number</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">routingmodelsupstream</span><span class="o">.</span><span class="n">typeids</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">netinflow</span> <span class="o">+=</span> <span class="n">cast</span><span class="p">(</span>
                    <span class="n">RoutingModels_V1_V2</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">routingmodelsupstream</span><span class="o">.</span><span class="n">submodels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="p">)</span><span class="o">.</span><span class="n">get_discharge</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">routingmodelsdownstream</span><span class="o">.</span><span class="n">number</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">routingmodelsdownstream</span><span class="o">.</span><span class="n">typeids</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
                <span class="n">flu</span><span class="o">.</span><span class="n">netinflow</span> <span class="o">-=</span> <span class="n">cast</span><span class="p">(</span>
                    <span class="n">RoutingModels_V2_V3</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">routingmodelsdownstream</span><span class="o">.</span><span class="n">submodels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="p">)</span><span class="o">.</span><span class="n">get_discharge</span><span class="p">()</span>
        <span class="n">flu</span><span class="o">.</span><span class="n">netinflow</span> <span class="o">*=</span> <span class="n">fac</span><span class="o">.</span><span class="n">timestep</span> <span class="o">/</span> <span class="mf">1e3</span></div>



<div class="viewcode-block" id="Update_WaterVolume_V1">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Update_WaterVolume_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Update_WaterVolume_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update the current water content of a channel segment.</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.sw1d import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; states.watervolume = 2.0</span>
<span class="sd">        &gt;&gt;&gt; fluxes.netinflow = 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.update_watervolume_v1()</span>
<span class="sd">        &gt;&gt;&gt; states.watervolume</span>
<span class="sd">        watervolume(3.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_fluxes</span><span class="o">.</span><span class="n">NetInflow</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_states</span><span class="o">.</span><span class="n">WaterVolume</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span><span class="o">.</span><span class="n">watervolume</span> <span class="o">+=</span> <span class="n">flu</span><span class="o">.</span><span class="n">netinflow</span></div>



<div class="viewcode-block" id="Update_Storages_V1">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Update_Storages_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Update_Storages_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Let a network model order all storage submodels to update their storage contents</span>
<span class="sd">    and their dependent factors.</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.sw1d_channel import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nmbsegments(1)</span>
<span class="sd">        &gt;&gt;&gt; with model.add_routingmodel_v2(&quot;sw1d_lias&quot;, position=0, update=False):</span>
<span class="sd">        ...     states.discharge = 50.0</span>
<span class="sd">        &gt;&gt;&gt; with model.add_storagemodel_v1(&quot;sw1d_storage&quot;, position=0, update=False):</span>
<span class="sd">        ...     length(2.0)</span>
<span class="sd">        ...     states.watervolume = 2.0</span>
<span class="sd">        ...     factors.timestep = 100.0</span>
<span class="sd">        ...     fluxes.lateralflow = 1.0</span>
<span class="sd">        &gt;&gt;&gt; with model.add_routingmodel_v2(&quot;sw1d_lias&quot;, position=1, update=False):</span>
<span class="sd">        ...     states.discharge = 60.0</span>
<span class="sd">        &gt;&gt;&gt; model.update_storages()</span>
<span class="sd">        &gt;&gt;&gt; model.storagemodels[0].sequences.states.watervolume</span>
<span class="sd">        watervolume(1.1)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMODELINTERFACES</span> <span class="o">=</span> <span class="p">(</span><span class="n">routinginterfaces</span><span class="o">.</span><span class="n">StorageModel_V1</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">storagemodels</span><span class="o">.</span><span class="n">number</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">storagemodels</span><span class="o">.</span><span class="n">typeids</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">cast</span><span class="p">(</span>
                    <span class="n">routinginterfaces</span><span class="o">.</span><span class="n">StorageModel_V1</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">storagemodels</span><span class="o">.</span><span class="n">submodels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="p">)</span><span class="o">.</span><span class="n">update_storage</span><span class="p">()</span></div>



<div class="viewcode-block" id="Query_WaterLevels_V1">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Query_WaterLevels_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Query_WaterLevels_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Query the water levels from all submodels following the |StorageModel_V1|</span>
<span class="sd">    interface.</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.sw1d_channel import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; nmbsegments(2)</span>
<span class="sd">        &gt;&gt;&gt; with model.add_storagemodel_v1(&quot;sw1d_storage&quot;, position=0, update=False):</span>
<span class="sd">        ...     factors.waterlevel = 1.0</span>
<span class="sd">        &gt;&gt;&gt; with model.add_storagemodel_v1(&quot;sw1d_storage&quot;, position=1, update=False):</span>
<span class="sd">        ...     factors.waterlevel = -1.0</span>
<span class="sd">        &gt;&gt;&gt; model.query_waterlevels_v1()</span>
<span class="sd">        &gt;&gt;&gt; factors.waterlevels</span>
<span class="sd">        waterlevels(1.0, -1.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMODELINTERFACES</span> <span class="o">=</span> <span class="p">(</span><span class="n">routinginterfaces</span><span class="o">.</span><span class="n">StorageModel_V1</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevels</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">storagemodels</span><span class="o">.</span><span class="n">number</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">storagemodels</span><span class="o">.</span><span class="n">typeids</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">fac</span><span class="o">.</span><span class="n">waterlevels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
                    <span class="n">routinginterfaces</span><span class="o">.</span><span class="n">StorageModel_V1</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">storagemodels</span><span class="o">.</span><span class="n">submodels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="p">)</span><span class="o">.</span><span class="n">get_waterlevel</span><span class="p">()</span></div>



<span class="c1"># interface methods</span>


<div class="viewcode-block" id="Determine_MaxTimeStep_V1">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Determine_MaxTimeStep_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Determine_MaxTimeStep_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">AutoMethod</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Interface method for determining the highest possible computation time step at a</span>
<span class="sd">    central location.&quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Calc_WaterLevelUpstream_V1</span><span class="p">,</span>
        <span class="n">Calc_WaterLevelDownstream_V1</span><span class="p">,</span>
        <span class="n">Calc_WaterLevel_V1</span><span class="p">,</span>
        <span class="n">Calc_WaterDepth_WettedArea_WettedPerimeter_V1</span><span class="p">,</span>
        <span class="n">Calc_DischargeUpstream_V1</span><span class="p">,</span>
        <span class="n">Calc_DischargeDownstream_V1</span><span class="p">,</span>
        <span class="n">Calc_MaxTimeStep_V1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_control</span><span class="o">.</span><span class="n">TimeStepFactor</span><span class="p">,)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_derived</span><span class="o">.</span><span class="n">WeightUpstream</span><span class="p">,</span> <span class="n">sw1d_derived</span><span class="o">.</span><span class="n">LengthMin</span><span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_fixed</span><span class="o">.</span><span class="n">GravitationalAcceleration</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_states</span><span class="o">.</span><span class="n">Discharge</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevelUpstream</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevelDownstream</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevel</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterDepth</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WettedArea</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WettedPerimeter</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">MaxTimeStep</span><span class="p">,</span>
        <span class="n">sw1d_fluxes</span><span class="o">.</span><span class="n">DischargeUpstream</span><span class="p">,</span>
        <span class="n">sw1d_fluxes</span><span class="o">.</span><span class="n">DischargeDownstream</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="Determine_MaxTimeStep_V2">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Determine_MaxTimeStep_V2">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Determine_MaxTimeStep_V2</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">AutoMethod</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Interface method for determining the highest possible computation time step at</span>
<span class="sd">    an inflow location.&quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Calc_WaterLevelDownstream_V1</span><span class="p">,</span>
        <span class="n">Calc_WaterLevel_V2</span><span class="p">,</span>
        <span class="n">Calc_WaterDepth_WettedArea_V1</span><span class="p">,</span>
        <span class="n">Calc_MaxTimeStep_V2</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_control</span><span class="o">.</span><span class="n">LengthDownstream</span><span class="p">,</span> <span class="n">sw1d_control</span><span class="o">.</span><span class="n">TimeStepFactor</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_fluxes</span><span class="o">.</span><span class="n">Inflow</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevelDownstream</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevel</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterDepth</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WettedArea</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">MaxTimeStep</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="Determine_MaxTimeStep_V3">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Determine_MaxTimeStep_V3">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Determine_MaxTimeStep_V3</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">AutoMethod</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Interface method for determining the highest possible computation time step at</span>
<span class="sd">    an outflow weir.&quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Calc_WaterLevelUpstream_V1</span><span class="p">,</span> <span class="n">Calc_WaterLevel_V3</span><span class="p">,</span> <span class="n">Calc_MaxTimeStep_V3</span><span class="p">)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">sw1d_control</span><span class="o">.</span><span class="n">CrestHeight</span><span class="p">,</span>
        <span class="n">sw1d_control</span><span class="o">.</span><span class="n">FlowCoefficient</span><span class="p">,</span>
        <span class="n">sw1d_control</span><span class="o">.</span><span class="n">TimeStepFactor</span><span class="p">,</span>
        <span class="n">sw1d_control</span><span class="o">.</span><span class="n">LengthUpstream</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_fixed</span><span class="o">.</span><span class="n">GravitationalAcceleration</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevelUpstream</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevel</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">MaxTimeStep</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="Determine_MaxTimeStep_V4">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Determine_MaxTimeStep_V4">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Determine_MaxTimeStep_V4</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">AutoMethod</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Interface method for determining the highest possible computation time step at</span>
<span class="sd">    an outflow location.&quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Calc_WaterLevelUpstream_V1</span><span class="p">,</span>
        <span class="n">Calc_WaterLevel_V3</span><span class="p">,</span>
        <span class="n">Calc_WaterDepth_WettedArea_V1</span><span class="p">,</span>
        <span class="n">Calc_MaxTimeStep_V4</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_control</span><span class="o">.</span><span class="n">LengthUpstream</span><span class="p">,</span> <span class="n">sw1d_control</span><span class="o">.</span><span class="n">TimeStepFactor</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_fluxes</span><span class="o">.</span><span class="n">Outflow</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevelUpstream</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevel</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterDepth</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WettedArea</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">MaxTimeStep</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="Determine_MaxTimeStep_V5">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Determine_MaxTimeStep_V5">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Determine_MaxTimeStep_V5</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">AutoMethod</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Interface method for determining the highest possible computation time step at</span>
<span class="sd">    an outflow gate.&quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Calc_WaterLevelUpstream_V1</span><span class="p">,</span> <span class="n">Calc_WaterLevel_V4</span><span class="p">,</span> <span class="n">Calc_MaxTimeStep_V5</span><span class="p">)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">sw1d_control</span><span class="o">.</span><span class="n">BottomLevel</span><span class="p">,</span>
        <span class="n">sw1d_control</span><span class="o">.</span><span class="n">GateHeight</span><span class="p">,</span>
        <span class="n">sw1d_control</span><span class="o">.</span><span class="n">FlowCoefficient</span><span class="p">,</span>
        <span class="n">sw1d_control</span><span class="o">.</span><span class="n">LengthUpstream</span><span class="p">,</span>
        <span class="n">sw1d_control</span><span class="o">.</span><span class="n">TimeStepFactor</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_fixed</span><span class="o">.</span><span class="n">GravitationalAcceleration</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevelDownstream</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevelUpstream</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevel</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">MaxTimeStep</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="Determine_MaxTimeStep_V6">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Determine_MaxTimeStep_V6">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Determine_MaxTimeStep_V6</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">AutoMethod</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Interface method for determining the highest possible computation time step at</span>
<span class="sd">    an inflow and outflow location.&quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Calc_WaterLevelUpstream_V1</span><span class="p">,</span>
        <span class="n">Calc_WaterLevelDownstream_V1</span><span class="p">,</span>
        <span class="n">Calc_WaterLevel_V1</span><span class="p">,</span>
        <span class="n">Calc_WaterDepth_WettedArea_V1</span><span class="p">,</span>
        <span class="n">Calc_MaxTimeStep_V6</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_control</span><span class="o">.</span><span class="n">TimeStepFactor</span><span class="p">,)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_derived</span><span class="o">.</span><span class="n">LengthMin</span><span class="p">,</span> <span class="n">sw1d_derived</span><span class="o">.</span><span class="n">WeightUpstream</span><span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_states</span><span class="o">.</span><span class="n">Discharge</span><span class="p">,)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevelDownstream</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevelUpstream</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevel</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterDepth</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WettedArea</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">MaxTimeStep</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="Determine_Discharge_V1">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Determine_Discharge_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Determine_Discharge_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">AutoMethod</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Interface method for determining the discharge at a central location.&quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Calc_WaterVolumeUpstream_V1</span><span class="p">,</span>
        <span class="n">Calc_WaterVolumeDownstream_V1</span><span class="p">,</span>
        <span class="n">Calc_Discharge_V1</span><span class="p">,</span>
        <span class="n">Update_Discharge_V1</span><span class="p">,</span>
        <span class="n">Update_DischargeVolume_V1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">sw1d_control</span><span class="o">.</span><span class="n">StricklerCoefficient</span><span class="p">,</span>
        <span class="n">sw1d_control</span><span class="o">.</span><span class="n">DiffusionFactor</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_derived</span><span class="o">.</span><span class="n">LengthMean</span><span class="p">,)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_fixed</span><span class="o">.</span><span class="n">GravitationalAcceleration</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevelUpstream</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevelDownstream</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WettedArea</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WettedPerimeter</span><span class="p">,</span>
        <span class="n">sw1d_fluxes</span><span class="o">.</span><span class="n">DischargeUpstream</span><span class="p">,</span>
        <span class="n">sw1d_fluxes</span><span class="o">.</span><span class="n">DischargeDownstream</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">TimeStep</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterVolumeUpstream</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterVolumeDownstream</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_states</span><span class="o">.</span><span class="n">Discharge</span><span class="p">,</span> <span class="n">sw1d_fluxes</span><span class="o">.</span><span class="n">DischargeVolume</span><span class="p">)</span></div>



<div class="viewcode-block" id="Determine_Discharge_V2">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Determine_Discharge_V2">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Determine_Discharge_V2</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Interface method for determining the discharge at an inflow location.&quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_fluxes</span><span class="o">.</span><span class="n">Inflow</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_states</span><span class="o">.</span><span class="n">Discharge</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span><span class="o">.</span><span class="n">discharge</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">inflow</span></div>



<div class="viewcode-block" id="Determine_Discharge_V3">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Determine_Discharge_V3">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Determine_Discharge_V3</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">AutoMethod</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Interface method for determining the discharge at an outflow weir.&quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Calc_Discharge_V2</span><span class="p">,</span> <span class="n">Update_DischargeVolume_V1</span><span class="p">)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">sw1d_control</span><span class="o">.</span><span class="n">CrestHeight</span><span class="p">,</span>
        <span class="n">sw1d_control</span><span class="o">.</span><span class="n">CrestWidth</span><span class="p">,</span>
        <span class="n">sw1d_control</span><span class="o">.</span><span class="n">FlowCoefficient</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_fixed</span><span class="o">.</span><span class="n">GravitationalAcceleration</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevel</span><span class="p">,</span> <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">TimeStep</span><span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_states</span><span class="o">.</span><span class="n">Discharge</span><span class="p">,</span> <span class="n">sw1d_fluxes</span><span class="o">.</span><span class="n">DischargeVolume</span><span class="p">)</span></div>



<div class="viewcode-block" id="Determine_Discharge_V4">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Determine_Discharge_V4">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Determine_Discharge_V4</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Interface method for determining the discharge at an outflow location.&quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_fluxes</span><span class="o">.</span><span class="n">Outflow</span><span class="p">,)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_states</span><span class="o">.</span><span class="n">Discharge</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">sta</span><span class="o">.</span><span class="n">discharge</span> <span class="o">=</span> <span class="n">flu</span><span class="o">.</span><span class="n">outflow</span></div>



<div class="viewcode-block" id="Determine_Discharge_V5">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Determine_Discharge_V5">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Determine_Discharge_V5</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">AutoMethod</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Interface method for determining the sluice-modified discharge at a central</span>
<span class="sd">    location considering.&quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Calc_WaterVolumeUpstream_V1</span><span class="p">,</span>
        <span class="n">Calc_WaterVolumeDownstream_V1</span><span class="p">,</span>
        <span class="n">Calc_Discharge_V1</span><span class="p">,</span>
        <span class="n">Update_Discharge_V1</span><span class="p">,</span>
        <span class="n">Update_Discharge_V2</span><span class="p">,</span>
        <span class="n">Update_DischargeVolume_V1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">sw1d_control</span><span class="o">.</span><span class="n">StricklerCoefficient</span><span class="p">,</span>
        <span class="n">sw1d_control</span><span class="o">.</span><span class="n">DiffusionFactor</span><span class="p">,</span>
        <span class="n">sw1d_control</span><span class="o">.</span><span class="n">BottomLowWaterThreshold</span><span class="p">,</span>
        <span class="n">sw1d_control</span><span class="o">.</span><span class="n">UpperLowWaterThreshold</span><span class="p">,</span>
        <span class="n">sw1d_control</span><span class="o">.</span><span class="n">BottomHighWaterThreshold</span><span class="p">,</span>
        <span class="n">sw1d_control</span><span class="o">.</span><span class="n">UpperHighWaterThreshold</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">DERIVEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_derived</span><span class="o">.</span><span class="n">TOY</span><span class="p">,</span> <span class="n">sw1d_derived</span><span class="o">.</span><span class="n">LengthMean</span><span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_fixed</span><span class="o">.</span><span class="n">GravitationalAcceleration</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevelUpstream</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevelDownstream</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WettedArea</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WettedPerimeter</span><span class="p">,</span>
        <span class="n">sw1d_fluxes</span><span class="o">.</span><span class="n">DischargeUpstream</span><span class="p">,</span>
        <span class="n">sw1d_fluxes</span><span class="o">.</span><span class="n">DischargeDownstream</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">TimeStep</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterVolumeUpstream</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterVolumeDownstream</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_states</span><span class="o">.</span><span class="n">Discharge</span><span class="p">,</span> <span class="n">sw1d_fluxes</span><span class="o">.</span><span class="n">DischargeVolume</span><span class="p">)</span></div>



<div class="viewcode-block" id="Determine_Discharge_V6">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Determine_Discharge_V6">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Determine_Discharge_V6</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">AutoMethod</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Interface method for determining the discharge at an outflow gate.&quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Calc_Discharge_V3</span><span class="p">,</span> <span class="n">Update_DischargeVolume_V1</span><span class="p">)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">sw1d_control</span><span class="o">.</span><span class="n">BottomLevel</span><span class="p">,</span>
        <span class="n">sw1d_control</span><span class="o">.</span><span class="n">GateHeight</span><span class="p">,</span>
        <span class="n">sw1d_control</span><span class="o">.</span><span class="n">GateWidth</span><span class="p">,</span>
        <span class="n">sw1d_control</span><span class="o">.</span><span class="n">FlowCoefficient</span><span class="p">,</span>
        <span class="n">sw1d_control</span><span class="o">.</span><span class="n">DampingRadius</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">FIXEDPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_fixed</span><span class="o">.</span><span class="n">GravitationalAcceleration</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevel</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevelUpstream</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevelDownstream</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">TimeStep</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_states</span><span class="o">.</span><span class="n">Discharge</span><span class="p">,</span> <span class="n">sw1d_fluxes</span><span class="o">.</span><span class="n">DischargeVolume</span><span class="p">)</span></div>



<div class="viewcode-block" id="Determine_Discharge_V7">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Determine_Discharge_V7">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Determine_Discharge_V7</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">AutoMethod</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Interface method for determining the discharge at a pumping station.&quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Calc_WaterLevel_V3</span><span class="p">,</span> <span class="n">Calc_Discharge_V4</span><span class="p">,</span> <span class="n">Update_DischargeVolume_V1</span><span class="p">)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">sw1d_control</span><span class="o">.</span><span class="n">Gradient2PumpingRate</span><span class="p">,</span>
        <span class="n">sw1d_control</span><span class="o">.</span><span class="n">TargetWaterLevel1</span><span class="p">,</span>
        <span class="n">sw1d_control</span><span class="o">.</span><span class="n">TargetWaterLevel2</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevelUpstream</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevelDownstream</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">TimeStep</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_states</span><span class="o">.</span><span class="n">Discharge</span><span class="p">,</span> <span class="n">sw1d_fluxes</span><span class="o">.</span><span class="n">DischargeVolume</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevel</span><span class="p">,)</span></div>



<div class="viewcode-block" id="Get_WaterVolume_V1">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Get_WaterVolume_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Get_WaterVolume_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Interface method for querying the water volume in 1000 m.&quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_states</span><span class="o">.</span><span class="n">WaterVolume</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">return</span> <span class="n">sta</span><span class="o">.</span><span class="n">watervolume</span></div>



<div class="viewcode-block" id="Get_WaterLevel_V1">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Get_WaterLevel_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Get_WaterLevel_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Interface method for querying the water level in m.&quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevel</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">return</span> <span class="n">fac</span><span class="o">.</span><span class="n">waterlevel</span></div>



<div class="viewcode-block" id="Get_Discharge_V1">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Get_Discharge_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Get_Discharge_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Interface method for querying the discharge in m/s.&quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_states</span><span class="o">.</span><span class="n">Discharge</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">return</span> <span class="n">sta</span><span class="o">.</span><span class="n">discharge</span></div>



<div class="viewcode-block" id="Get_DischargeVolume_V1">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Get_DischargeVolume_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Get_DischargeVolume_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Interface method for querying the discharge in m.&quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_fluxes</span><span class="o">.</span><span class="n">DischargeVolume</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">flu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">return</span> <span class="n">flu</span><span class="o">.</span><span class="n">dischargevolume</span></div>



<div class="viewcode-block" id="Get_MaxTimeStep_V1">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Get_MaxTimeStep_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Get_MaxTimeStep_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Interface method for querying the highest possible computation time step in</span>
<span class="sd">    s.&quot;&quot;&quot;</span>

    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_factors</span><span class="o">.</span><span class="n">MaxTimeStep</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">return</span> <span class="n">fac</span><span class="o">.</span><span class="n">maxtimestep</span></div>



<div class="viewcode-block" id="Set_TimeStep_V1">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Set_TimeStep_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Set_TimeStep_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Interface method for setting the actual computation time step in s.&quot;&quot;&quot;</span>

    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_factors</span><span class="o">.</span><span class="n">TimeStep</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">timestep</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="n">fac</span><span class="o">.</span><span class="n">timestep</span> <span class="o">=</span> <span class="n">timestep</span></div>



<div class="viewcode-block" id="Get_PartialDischargeUpstream_V1">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Get_PartialDischargeUpstream_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Get_PartialDischargeUpstream_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Return a partial discharge estimate suitable for a downstream model.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`PartialDischargeUpstream = Discharge_{server} \cdot</span>
<span class="sd">      \frac{|Discharge_{client}|}{\Sigma_{i=1}^{n_{downstream}} |Discharge_i|}`</span>

<span class="sd">    Examples:</span>

<span class="sd">        If the client model (which is currently asking for the partial discharge) is</span>
<span class="sd">        the only downstream model, |Get_PartialDischargeUpstream_V1| returns the total</span>
<span class="sd">        discharge without modification:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import Element, Node, prepare_model, round_</span>
<span class="sd">        &gt;&gt;&gt; n01 = Node(&quot;n01&quot;, variable=&quot;LongQ&quot;)</span>
<span class="sd">        &gt;&gt;&gt; e0 = Element(&quot;e0&quot;, outlets=n01)</span>
<span class="sd">        &gt;&gt;&gt; e1a = Element(&quot;e1a&quot;, inlets=n01)</span>

<span class="sd">        &gt;&gt;&gt; c0 = prepare_model(&quot;sw1d_channel&quot;)</span>
<span class="sd">        &gt;&gt;&gt; c0.parameters.control.nmbsegments(1)</span>
<span class="sd">        &gt;&gt;&gt; with c0.add_routingmodel_v2(&quot;sw1d_lias&quot;, position=0, update=False) as r0:</span>
<span class="sd">        ...     states.discharge = 5.0</span>
<span class="sd">        &gt;&gt;&gt; with c0.add_storagemodel_v1(&quot;sw1d_storage&quot;, position=0, update=False):</span>
<span class="sd">        ...     pass</span>
<span class="sd">        &gt;&gt;&gt; e0.model = c0</span>

<span class="sd">        &gt;&gt;&gt; c1a = prepare_model(&quot;sw1d_channel&quot;)</span>
<span class="sd">        &gt;&gt;&gt; c1a.parameters.control.nmbsegments(1)</span>
<span class="sd">        &gt;&gt;&gt; with c1a.add_routingmodel_v2(&quot;sw1d_lias&quot;, position=0, update=False) as r1a:</span>
<span class="sd">        ...     states.discharge = 3.0</span>
<span class="sd">        &gt;&gt;&gt; with c1a.add_storagemodel_v1(&quot;sw1d_storage&quot;, position=0, update=False):</span>
<span class="sd">        ...     pass</span>
<span class="sd">        &gt;&gt;&gt; e1a.model = c1a</span>

<span class="sd">        &gt;&gt;&gt; network = c0.couple_models(nodes=[n01], elements=[e0, e1a])</span>
<span class="sd">        &gt;&gt;&gt; round_(r0.get_partialdischargeupstream_v1(3.0))</span>
<span class="sd">        5.0</span>

<span class="sd">        For multiple downstream models, it returns the discharge portion that it</span>
<span class="sd">        attributes to the current client model:</span>

<span class="sd">        &gt;&gt;&gt; e1b = Element(&quot;e1b&quot;, inlets=n01)</span>
<span class="sd">        &gt;&gt;&gt; c1b = prepare_model(&quot;sw1d_channel&quot;)</span>
<span class="sd">        &gt;&gt;&gt; c1b.parameters.control.nmbsegments(1)</span>
<span class="sd">        &gt;&gt;&gt; with c1b.add_routingmodel_v2(&quot;sw1d_lias&quot;, position=0, update=False) as r1b:</span>
<span class="sd">        ...     states.discharge = 1.0</span>
<span class="sd">        &gt;&gt;&gt; with c1b.add_storagemodel_v1(&quot;sw1d_storage&quot;, position=0, update=False):</span>
<span class="sd">        ...     pass</span>
<span class="sd">        &gt;&gt;&gt; e1b.model = c1b</span>

<span class="sd">        &gt;&gt;&gt; network = c0.couple_models(nodes=[n01], elements=[e0, e1a, e1b])</span>
<span class="sd">        &gt;&gt;&gt; round_(r0.get_partialdischargeupstream_v1(3.0))</span>
<span class="sd">        3.75</span>
<span class="sd">        &gt;&gt;&gt; round_(r0.get_partialdischargeupstream_v1(1.0))</span>
<span class="sd">        1.25</span>

<span class="sd">        To prevent zero divisions, |Get_PartialDischargeUpstream_V1| returns zero if</span>
<span class="sd">        all downstream models&#39; (total) discharge is also zero:</span>

<span class="sd">        &gt;&gt;&gt; r1a.sequences.states.discharge = 0.0</span>
<span class="sd">        &gt;&gt;&gt; r1b.sequences.states.discharge = 0.0</span>
<span class="sd">        &gt;&gt;&gt; round_(r0.get_partialdischargeupstream_v1(0.0))</span>
<span class="sd">        0.0</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; Node.clear_all()</span>
<span class="sd">            &gt;&gt;&gt; Element.clear_all()</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMODELINTERFACES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">routinginterfaces</span><span class="o">.</span><span class="n">RoutingModel_V2</span><span class="p">,</span>
        <span class="n">routinginterfaces</span><span class="o">.</span><span class="n">RoutingModel_V3</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_states</span><span class="o">.</span><span class="n">Discharge</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">clientdischarge</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>

        <span class="n">dischargedownstream</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">routingmodelsdownstream</span><span class="o">.</span><span class="n">number</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">routingmodelsdownstream</span><span class="o">.</span><span class="n">typeids</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
                <span class="n">dischargedownstream</span> <span class="o">+=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span>
                    <span class="n">cast</span><span class="p">(</span>
                        <span class="n">RoutingModels_V2_V3</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">routingmodelsdownstream</span><span class="o">.</span><span class="n">submodels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">get_discharge</span><span class="p">()</span>
                <span class="p">)</span>
        <span class="k">if</span> <span class="n">dischargedownstream</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span>
        <span class="k">return</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">discharge</span><span class="p">)</span> <span class="o">*</span> <span class="n">clientdischarge</span> <span class="o">/</span> <span class="n">dischargedownstream</span></div>



<div class="viewcode-block" id="Get_PartialDischargeDownstream_V1">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Get_PartialDischargeDownstream_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Get_PartialDischargeDownstream_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Return a partial discharge estimate suitable for an upstream model.</span>

<span class="sd">    Basic equation:</span>
<span class="sd">      :math:`PartialDischargeDownstream = Discharge_{server} \cdot</span>
<span class="sd">      \frac{|Discharge_{client}|}{\Sigma_{i=1}^{n_{upstream}} |Discharge_i|}`</span>

<span class="sd">    Examples:</span>

<span class="sd">        If the client model (which is currently asking for the partial discharge) is</span>
<span class="sd">        the only upstream model, |Get_PartialDischargeDownstream_V1| returns the total</span>
<span class="sd">        discharge without modification:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import Element, Node, prepare_model, round_</span>
<span class="sd">        &gt;&gt;&gt; n01 = Node(&quot;n01&quot;, variable=&quot;LongQ&quot;)</span>
<span class="sd">        &gt;&gt;&gt; e1 = Element(&quot;e1&quot;, inlets=n01)</span>
<span class="sd">        &gt;&gt;&gt; e0a = Element(&quot;e0a&quot;, outlets=n01)</span>

<span class="sd">        &gt;&gt;&gt; c1 = prepare_model(&quot;sw1d_channel&quot;)</span>
<span class="sd">        &gt;&gt;&gt; c1.parameters.control.nmbsegments(1)</span>
<span class="sd">        &gt;&gt;&gt; with c1.add_storagemodel_v1(&quot;sw1d_storage&quot;, position=0, update=False):</span>
<span class="sd">        ...     pass</span>
<span class="sd">        &gt;&gt;&gt; with c1.add_routingmodel_v2(&quot;sw1d_lias&quot;, position=1, update=False) as r1:</span>
<span class="sd">        ...     states.discharge = 5.0</span>
<span class="sd">        &gt;&gt;&gt; e1.model = c1</span>

<span class="sd">        &gt;&gt;&gt; c0a = prepare_model(&quot;sw1d_channel&quot;)</span>
<span class="sd">        &gt;&gt;&gt; c0a.parameters.control.nmbsegments(1)</span>
<span class="sd">        &gt;&gt;&gt; with c0a.add_storagemodel_v1(&quot;sw1d_storage&quot;, position=0, update=False):</span>
<span class="sd">        ...     pass</span>
<span class="sd">        &gt;&gt;&gt; with c0a.add_routingmodel_v2(&quot;sw1d_lias&quot;, position=1, update=False) as r0a:</span>
<span class="sd">        ...     states.discharge = 3.0</span>
<span class="sd">        &gt;&gt;&gt; e0a.model = c0a</span>

<span class="sd">        &gt;&gt;&gt; network = c1.couple_models(nodes=[n01], elements=[e1, e0a])</span>
<span class="sd">        &gt;&gt;&gt; round_(r1.get_partialdischargedownstream_v1(3.0))</span>
<span class="sd">        5.0</span>

<span class="sd">        For multiple upstream models, it returns the discharge portion that it</span>
<span class="sd">        attributes to the current client model:</span>

<span class="sd">        &gt;&gt;&gt; e0b = Element(&quot;e0b&quot;, outlets=n01)</span>
<span class="sd">        &gt;&gt;&gt; c0b = prepare_model(&quot;sw1d_channel&quot;)</span>
<span class="sd">        &gt;&gt;&gt; c0b.parameters.control.nmbsegments(1)</span>
<span class="sd">        &gt;&gt;&gt; with c0b.add_storagemodel_v1(&quot;sw1d_storage&quot;, position=0, update=False):</span>
<span class="sd">        ...     pass</span>
<span class="sd">        &gt;&gt;&gt; with c0b.add_routingmodel_v2(&quot;sw1d_lias&quot;, position=1, update=False) as r0b:</span>
<span class="sd">        ...     states.discharge = 1.0</span>
<span class="sd">        &gt;&gt;&gt; e0b.model = c0b</span>

<span class="sd">        &gt;&gt;&gt; network = c1.couple_models(nodes=[n01], elements=[e1, e0a, e0b])</span>
<span class="sd">        &gt;&gt;&gt; round_(r1.get_partialdischargedownstream_v1(3.0))</span>
<span class="sd">        3.75</span>
<span class="sd">        &gt;&gt;&gt; round_(r1.get_partialdischargedownstream_v1(1.0))</span>
<span class="sd">        1.25</span>

<span class="sd">        To prevent zero divisions, |Get_PartialDischargeDownstream_V1| returns zero if</span>
<span class="sd">        all upstream models&#39; (total) discharge is also zero:</span>

<span class="sd">        &gt;&gt;&gt; r0a.sequences.states.discharge = 0.0</span>
<span class="sd">        &gt;&gt;&gt; r0b.sequences.states.discharge = 0.0</span>
<span class="sd">        &gt;&gt;&gt; round_(r1.get_partialdischargedownstream_v1(0.0))</span>
<span class="sd">        0.0</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; Node.clear_all()</span>
<span class="sd">            &gt;&gt;&gt; Element.clear_all()</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUBMODELINTERFACES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">routinginterfaces</span><span class="o">.</span><span class="n">RoutingModel_V1</span><span class="p">,</span>
        <span class="n">routinginterfaces</span><span class="o">.</span><span class="n">RoutingModel_V2</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_states</span><span class="o">.</span><span class="n">Discharge</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">clientdischarge</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">fastaccess</span>

        <span class="n">dischargeupstream</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">routingmodelsupstream</span><span class="o">.</span><span class="n">number</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">routingmodelsupstream</span><span class="o">.</span><span class="n">typeids</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
                <span class="n">dischargeupstream</span> <span class="o">+=</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span>
                    <span class="n">cast</span><span class="p">(</span>
                        <span class="n">RoutingModels_V1_V2</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">routingmodelsupstream</span><span class="o">.</span><span class="n">submodels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">get_discharge</span><span class="p">()</span>
                <span class="p">)</span>
        <span class="k">if</span> <span class="n">dischargeupstream</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span>
        <span class="k">return</span> <span class="n">modelutils</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">discharge</span><span class="p">)</span> <span class="o">*</span> <span class="n">clientdischarge</span> <span class="o">/</span> <span class="n">dischargeupstream</span></div>



<div class="viewcode-block" id="Update_Storage_V1">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Update_Storage_V1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Update_Storage_V1</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">AutoMethod</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Interface method for updating the storage water content.&quot;&quot;&quot;</span>

    <span class="n">SUBMETHODS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Calc_NetInflow_V1</span><span class="p">,</span>
        <span class="n">Update_WaterVolume_V1</span><span class="p">,</span>
        <span class="n">Calc_WaterDepth_WaterLevel_V1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">CONTROLPARAMETERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_control</span><span class="o">.</span><span class="n">Length</span><span class="p">,)</span>
    <span class="n">REQUIREDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_factors</span><span class="o">.</span><span class="n">TimeStep</span><span class="p">,</span> <span class="n">sw1d_fluxes</span><span class="o">.</span><span class="n">LateralFlow</span><span class="p">)</span>
    <span class="n">RESULTSEQUENCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">sw1d_fluxes</span><span class="o">.</span><span class="n">NetInflow</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterDepth</span><span class="p">,</span>
        <span class="n">sw1d_factors</span><span class="o">.</span><span class="n">WaterLevel</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">UPDATEDSEQUENCES</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw1d_states</span><span class="o">.</span><span class="n">WaterVolume</span><span class="p">,)</span></div>



<div class="viewcode-block" id="Model">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Model">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Model</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">SubstepModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;|sw1d.DOCNAME.complete|.&quot;&quot;&quot;</span>

    <span class="n">DOCNAME</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">DocName</span><span class="p">(</span><span class="n">short</span><span class="o">=</span><span class="s2">&quot;SW1D&quot;</span><span class="p">)</span>
    <span class="n">__HYDPY_ROOTMODEL__</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">INLET_METHODS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Pick_Inflow_V1</span><span class="p">,</span>
        <span class="n">Pick_Outflow_V1</span><span class="p">,</span>
        <span class="n">Pick_LateralFlow_V1</span><span class="p">,</span>
        <span class="n">Pick_WaterLevelDownstream_V1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">OBSERVER_METHODS</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">RECEIVER_METHODS</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">RUN_METHODS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Calc_MaxTimeSteps_V1</span><span class="p">,</span>
        <span class="n">Calc_TimeStep_V1</span><span class="p">,</span>
        <span class="n">Send_TimeStep_V1</span><span class="p">,</span>
        <span class="n">Calc_Discharges_V1</span><span class="p">,</span>
        <span class="n">Update_Storages_V1</span><span class="p">,</span>
        <span class="n">Query_WaterLevels_V1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">INTERFACE_METHODS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Determine_MaxTimeStep_V1</span><span class="p">,</span>
        <span class="n">Determine_MaxTimeStep_V2</span><span class="p">,</span>
        <span class="n">Determine_MaxTimeStep_V3</span><span class="p">,</span>
        <span class="n">Determine_MaxTimeStep_V4</span><span class="p">,</span>
        <span class="n">Determine_MaxTimeStep_V5</span><span class="p">,</span>
        <span class="n">Determine_MaxTimeStep_V6</span><span class="p">,</span>
        <span class="n">Determine_Discharge_V1</span><span class="p">,</span>
        <span class="n">Determine_Discharge_V2</span><span class="p">,</span>
        <span class="n">Determine_Discharge_V3</span><span class="p">,</span>
        <span class="n">Determine_Discharge_V4</span><span class="p">,</span>
        <span class="n">Determine_Discharge_V5</span><span class="p">,</span>
        <span class="n">Determine_Discharge_V6</span><span class="p">,</span>
        <span class="n">Determine_Discharge_V7</span><span class="p">,</span>
        <span class="n">Get_WaterVolume_V1</span><span class="p">,</span>
        <span class="n">Get_WaterLevel_V1</span><span class="p">,</span>
        <span class="n">Get_Discharge_V1</span><span class="p">,</span>
        <span class="n">Get_DischargeVolume_V1</span><span class="p">,</span>
        <span class="n">Get_MaxTimeStep_V1</span><span class="p">,</span>
        <span class="n">Set_TimeStep_V1</span><span class="p">,</span>
        <span class="n">Get_PartialDischargeUpstream_V1</span><span class="p">,</span>
        <span class="n">Get_PartialDischargeDownstream_V1</span><span class="p">,</span>
        <span class="n">Update_Storage_V1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ADD_METHODS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Calc_MaxTimeStep_V1</span><span class="p">,</span>
        <span class="n">Calc_MaxTimeStep_V2</span><span class="p">,</span>
        <span class="n">Calc_MaxTimeStep_V3</span><span class="p">,</span>
        <span class="n">Calc_MaxTimeStep_V4</span><span class="p">,</span>
        <span class="n">Calc_MaxTimeStep_V5</span><span class="p">,</span>
        <span class="n">Calc_MaxTimeStep_V6</span><span class="p">,</span>
        <span class="n">Calc_WaterVolumeUpstream_V1</span><span class="p">,</span>
        <span class="n">Calc_WaterVolumeDownstream_V1</span><span class="p">,</span>
        <span class="n">Calc_WaterLevelUpstream_V1</span><span class="p">,</span>
        <span class="n">Calc_WaterLevelDownstream_V1</span><span class="p">,</span>
        <span class="n">Calc_WaterLevel_V1</span><span class="p">,</span>
        <span class="n">Calc_WaterLevel_V2</span><span class="p">,</span>
        <span class="n">Calc_WaterLevel_V3</span><span class="p">,</span>
        <span class="n">Calc_WaterLevel_V4</span><span class="p">,</span>
        <span class="n">Calc_WaterDepth_WaterLevel_CrossSectionModel_V2</span><span class="p">,</span>
        <span class="n">Calc_WaterDepth_WaterLevel_V1</span><span class="p">,</span>
        <span class="n">Calc_WaterDepth_WettedArea_CrossSectionModel_V2</span><span class="p">,</span>
        <span class="n">Calc_WaterDepth_WettedArea_V1</span><span class="p">,</span>
        <span class="n">Calc_WaterDepth_WettedArea_WettedPerimeter_CrossSectionModel_V2</span><span class="p">,</span>
        <span class="n">Calc_WaterDepth_WettedArea_WettedPerimeter_V1</span><span class="p">,</span>
        <span class="n">Calc_DischargeUpstream_V1</span><span class="p">,</span>
        <span class="n">Calc_DischargeDownstream_V1</span><span class="p">,</span>
        <span class="n">Calc_Discharge_V1</span><span class="p">,</span>
        <span class="n">Calc_Discharge_V2</span><span class="p">,</span>
        <span class="n">Calc_Discharge_V3</span><span class="p">,</span>
        <span class="n">Calc_Discharge_V4</span><span class="p">,</span>
        <span class="n">Update_Discharge_V1</span><span class="p">,</span>
        <span class="n">Update_Discharge_V2</span><span class="p">,</span>
        <span class="n">Reset_DischargeVolume_V1</span><span class="p">,</span>
        <span class="n">Update_DischargeVolume_V1</span><span class="p">,</span>
        <span class="n">Calc_DischargeVolume_V1</span><span class="p">,</span>
        <span class="n">Calc_DischargeVolume_V2</span><span class="p">,</span>
        <span class="n">Calc_NetInflow_V1</span><span class="p">,</span>
        <span class="n">Update_WaterVolume_V1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">OUTLET_METHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Pass_Discharge_V1</span><span class="p">,</span> <span class="n">Pass_WaterLevel_V1</span><span class="p">,</span> <span class="n">Calc_Discharges_V2</span><span class="p">)</span>
    <span class="n">SENDER_METHODS</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">SUBMODELINTERFACES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">routinginterfaces</span><span class="o">.</span><span class="n">CrossSectionModel_V2</span><span class="p">,</span>
        <span class="n">routinginterfaces</span><span class="o">.</span><span class="n">ChannelModel_V1</span><span class="p">,</span>
        <span class="n">routinginterfaces</span><span class="o">.</span><span class="n">StorageModel_V1</span><span class="p">,</span>
        <span class="n">routinginterfaces</span><span class="o">.</span><span class="n">RoutingModel_V1</span><span class="p">,</span>
        <span class="n">routinginterfaces</span><span class="o">.</span><span class="n">RoutingModel_V2</span><span class="p">,</span>
        <span class="n">routinginterfaces</span><span class="o">.</span><span class="n">RoutingModel_V3</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">SUBMODELS</span> <span class="o">=</span> <span class="p">()</span>

    <span class="n">crosssection</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelProperty</span><span class="p">(</span><span class="n">routinginterfaces</span><span class="o">.</span><span class="n">CrossSectionModel_V2</span><span class="p">)</span>
    <span class="n">crosssection_is_mainmodel</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelIsMainmodelProperty</span><span class="p">()</span>
    <span class="n">crosssection_typeid</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelTypeIDProperty</span><span class="p">()</span>

    <span class="n">channelmodels</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelsProperty</span><span class="p">(</span><span class="n">routinginterfaces</span><span class="o">.</span><span class="n">ChannelModel_V1</span><span class="p">)</span>
    <span class="n">storagemodels</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelsProperty</span><span class="p">(</span><span class="n">routinginterfaces</span><span class="o">.</span><span class="n">StorageModel_V1</span><span class="p">)</span>
    <span class="n">routingmodels</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelsProperty</span><span class="p">(</span><span class="n">routinginterfaces</span><span class="o">.</span><span class="n">RoutingModel_V1</span><span class="p">)</span>

    <span class="n">storagemodelupstream</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelProperty</span><span class="p">(</span>
        <span class="n">routinginterfaces</span><span class="o">.</span><span class="n">StorageModel_V1</span>
    <span class="p">)</span>
    <span class="n">storagemodelupstream_is_mainmodel</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelIsMainmodelProperty</span><span class="p">()</span>
    <span class="n">storagemodelupstream_typeid</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelTypeIDProperty</span><span class="p">()</span>

    <span class="n">storagemodeldownstream</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelProperty</span><span class="p">(</span>
        <span class="n">routinginterfaces</span><span class="o">.</span><span class="n">StorageModel_V1</span>
    <span class="p">)</span>
    <span class="n">storagemodeldownstream_is_mainmodel</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelIsMainmodelProperty</span><span class="p">()</span>
    <span class="n">storagemodeldownstream_typeid</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelTypeIDProperty</span><span class="p">()</span>

    <span class="n">routingmodelsupstream</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelsProperty</span><span class="p">(</span>
        <span class="n">routinginterfaces</span><span class="o">.</span><span class="n">RoutingModel_V1</span><span class="p">,</span>
        <span class="n">routinginterfaces</span><span class="o">.</span><span class="n">RoutingModel_V2</span><span class="p">,</span>
        <span class="n">routinginterfaces</span><span class="o">.</span><span class="n">RoutingModel_V3</span><span class="p">,</span>
        <span class="n">sidemodels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">routingmodelsdownstream</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelsProperty</span><span class="p">(</span>
        <span class="n">routinginterfaces</span><span class="o">.</span><span class="n">RoutingModel_V2</span><span class="p">,</span>
        <span class="n">routinginterfaces</span><span class="o">.</span><span class="n">RoutingModel_V3</span><span class="p">,</span>
        <span class="n">routinginterfaces</span><span class="o">.</span><span class="n">RoutingModel_V3</span><span class="p">,</span>
        <span class="n">sidemodels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="Main_CrossSectionModel_V2">
<a class="viewcode-back" href="../../../../sw1d.html#hydpy.models.sw1d.sw1d_model.Main_CrossSectionModel_V2">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Main_CrossSectionModel_V2</span><span class="p">(</span><span class="n">modeltools</span><span class="o">.</span><span class="n">AdHocModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for |sw1d.DOCNAME.long| models that use submodels named</span>
<span class="sd">    `crosssection` and comply with the |CrossSectionModel_V2| interface.&quot;&quot;&quot;</span>

    <span class="n">crosssection</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelProperty</span><span class="p">[</span><span class="n">routinginterfaces</span><span class="o">.</span><span class="n">CrossSectionModel_V2</span><span class="p">]</span>
    <span class="n">crosssection_is_mainmodel</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelIsMainmodelProperty</span><span class="p">()</span>
    <span class="n">crosssection_typeid</span> <span class="o">=</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">SubmodelTypeIDProperty</span><span class="p">()</span>

    <span class="nd">@importtools</span><span class="o">.</span><span class="n">prepare_submodel</span><span class="p">(</span>
        <span class="s2">&quot;crosssection&quot;</span><span class="p">,</span> <span class="n">routinginterfaces</span><span class="o">.</span><span class="n">CrossSectionModel_V2</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_crosssection_v2</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">crosssection</span><span class="p">:</span> <span class="n">routinginterfaces</span><span class="o">.</span><span class="n">CrossSectionModel_V2</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">refresh</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialise the given submodel that follows the |CrossSectionModel_V1|</span>
<span class="sd">        interface and is responsible for calculating discharge and related properties.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.sw1d_storage import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; with model.add_crosssection_v2(&quot;wq_trapeze&quot;):</span>
<span class="sd">        ...     nmbtrapezes(2)</span>
<span class="sd">        ...     bottomlevels(1.0, 3.0)</span>
<span class="sd">        ...     bottomwidths(2.0)</span>
<span class="sd">        ...     sideslopes(2.0, 4.0)</span>

<span class="sd">        &gt;&gt;&gt; model.crosssection.parameters.control.nmbtrapezes</span>
<span class="sd">        nmbtrapezes(2)</span>
<span class="sd">        &gt;&gt;&gt; model.crosssection.parameters.control.bottomlevels</span>
<span class="sd">        bottomlevels(1.0, 3.0)</span>
<span class="sd">        &quot;&quot;&quot;</span></div>

</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">HydPy 6.3dev0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">hydpy.models.sw1d.sw1d_model</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2013-2026, HydPy Developers.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 9.1.0.
    </div>
  </body>
</html>