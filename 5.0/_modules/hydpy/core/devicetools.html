<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>hydpy.core.devicetools &#8212; HydPy 5.0.3 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../../_static/classic.css?v=127cebf3" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=eafc0fe6" />
    
    <script src="../../../_static/documentation_options.js?v=f98c4cc8"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">HydPy 5.0.3 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">hydpy.core.devicetools</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/HydPy_Logo.png" alt="Logo"/>
            </a></p>
  <div>
    <h3><a href="../../../index.html">Table of Contents</a></h3>
    <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installation Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../how_to.html">How toâ€¦</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../framework.html">Framework Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modelcollection.html">Model Collection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../development.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples.html">Example Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../zbibliography.html">Bibliography</a></li>
</ul>

  </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for hydpy.core.devicetools</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;This modules implements the fundamental features for structuring *HydPy* projects.</span>

<span class="sd">Module |devicetools| provides two |Device| subclasses, |Node| and |Element|.  In this</span>
<span class="sd">documentation, &quot;node&quot; stands for an object of class |Node|, &quot;element&quot; for an object of</span>
<span class="sd">class |Element|, and &quot;device&quot; for either of them (you cannot initialise objects of</span>
<span class="sd">class |Device| directly).  On the other hand, &quot;nodes&quot;, for example, does not</span>
<span class="sd">necessarily mean an object of class |Nodes|, but any other group of |Node| objects as</span>
<span class="sd">well.</span>

<span class="sd">Each element handles a single |Model| object and represents, for example, a subbasin or</span>
<span class="sd">a channel segment.  The purpose of a node is to connect different elements and, for</span>
<span class="sd">example, to pass the discharge calculated for a subbasin outlet (from a first element)</span>
<span class="sd">to the top of a channel segment (to second element).  Class |Node| and |Element| come</span>
<span class="sd">with specialised container classes (|Nodes| and |Elements|).  The names of individual</span>
<span class="sd">nodes and elements serve as identity values, so duplicate names are not permitted.</span>

<span class="sd">Note that module |devicetools| implements a registry mechanism both for nodes and</span>
<span class="sd">elements, preventing instantiating an object with an already assigned name.  This</span>
<span class="sd">mechanism allows to address the same node or element in different network files (see</span>
<span class="sd">module |selectiontools|).</span>

<span class="sd">Let us take class |Node| as an example.  One can call its constructor with the same</span>
<span class="sd">name multiple times, but it returns already existing nodes when available:</span>

<span class="sd">&gt;&gt;&gt; from hydpy import Node</span>
<span class="sd">&gt;&gt;&gt; node1 = Node(&quot;test1&quot;)</span>
<span class="sd">&gt;&gt;&gt; node2a = Node(&quot;test2&quot;)</span>
<span class="sd">&gt;&gt;&gt; node2b = Node(&quot;test2&quot;)</span>
<span class="sd">&gt;&gt;&gt; node1 is node2a</span>
<span class="sd">False</span>
<span class="sd">&gt;&gt;&gt; node2a is node2b</span>
<span class="sd">True</span>

<span class="sd">To get information on all currently registered nodes, call method</span>
<span class="sd">|Device.extract_new|:</span>

<span class="sd">&gt;&gt;&gt; Node.extract_new()</span>
<span class="sd">Nodes(&quot;test1&quot;, &quot;test2&quot;)</span>

<span class="sd">Method |Device.extract_new| returns only those nodes prepared or</span>
<span class="sd">recovered after its last invocation:</span>

<span class="sd">&gt;&gt;&gt; node1 = Node(&quot;test1&quot;)</span>
<span class="sd">&gt;&gt;&gt; node3a = Node(&quot;test3&quot;)</span>

<span class="sd">&gt;&gt;&gt; Node.extract_new()</span>
<span class="sd">Nodes(&quot;test1&quot;, &quot;test3&quot;)</span>

<span class="sd">For a complete list of all available nodes, use the method |Device.query_all|:</span>

<span class="sd">&gt;&gt;&gt; Node.query_all()</span>
<span class="sd">Nodes(&quot;test1&quot;, &quot;test2&quot;, &quot;test3&quot;)</span>

<span class="sd">When working interactively in the Python interpreter, it might be useful to clear the</span>
<span class="sd">registry completely, sometimes.  Do this with care because defining nodes with already</span>
<span class="sd">assigned names might result in surprises due to using their names for identification:</span>

<span class="sd">&gt;&gt;&gt; nodes = Node.query_all()</span>
<span class="sd">&gt;&gt;&gt; Node.clear_all()</span>
<span class="sd">&gt;&gt;&gt; Node.query_all()</span>
<span class="sd">Nodes()</span>
<span class="sd">&gt;&gt;&gt; node3b = Node(&quot;test3&quot;)</span>
<span class="sd">&gt;&gt;&gt; node3b in nodes</span>
<span class="sd">True</span>
<span class="sd">&gt;&gt;&gt; nodes.test3.name == node3b.name</span>
<span class="sd">True</span>
<span class="sd">&gt;&gt;&gt; nodes.test3 is node3b</span>
<span class="sd">False</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1"># import...</span>
<span class="c1"># ...from standard library</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
<span class="kn">import</span> <span class="nn">abc</span>
<span class="kn">import</span> <span class="nn">contextlib</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">operator</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1"># ...from site-packages</span>
<span class="kn">import</span> <span class="nn">numpy</span>

<span class="c1"># ...from HydPy</span>
<span class="kn">import</span> <span class="nn">hydpy</span>
<span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="kn">import</span> <span class="n">exceptiontools</span>
<span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="kn">import</span> <span class="n">masktools</span>
<span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="kn">import</span> <span class="n">objecttools</span>
<span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="kn">import</span> <span class="n">printtools</span>
<span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="kn">import</span> <span class="n">sequencetools</span>
<span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="kn">import</span> <span class="n">seriestools</span>
<span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="kn">import</span> <span class="n">timetools</span>
<span class="kn">from</span> <span class="nn">hydpy.core.typingtools</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span>
    <span class="kn">import</span> <span class="nn">pandas</span>
    <span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="kn">import</span> <span class="n">auxfiletools</span>
    <span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="kn">import</span> <span class="n">hydpytools</span>
    <span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="kn">import</span> <span class="n">modeltools</span>
    <span class="kn">from</span> <span class="nn">hydpy.cythons</span> <span class="kn">import</span> <span class="n">pointerutils</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">pandas</span> <span class="o">=</span> <span class="n">exceptiontools</span><span class="o">.</span><span class="n">OptionalImport</span><span class="p">(</span><span class="s2">&quot;pandas&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;pandas&quot;</span><span class="p">],</span> <span class="nb">locals</span><span class="p">())</span>
    <span class="n">pyplot</span> <span class="o">=</span> <span class="n">exceptiontools</span><span class="o">.</span><span class="n">OptionalImport</span><span class="p">(</span><span class="s2">&quot;pyplot&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;matplotlib.pyplot&quot;</span><span class="p">],</span> <span class="nb">locals</span><span class="p">())</span>
    <span class="kn">from</span> <span class="nn">hydpy.cythons.autogen</span> <span class="kn">import</span> <span class="n">pointerutils</span>

<span class="n">TypeDevice</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;TypeDevice&quot;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="s2">&quot;Device&quot;</span><span class="p">)</span>
<span class="n">TypeDevices</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;TypeDevices&quot;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="s2">&quot;Devices[Any]&quot;</span><span class="p">)</span>

<span class="n">NodesConstrArg</span> <span class="o">=</span> <span class="n">MayNonerable2</span><span class="p">[</span><span class="s2">&quot;Node&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
<span class="n">ElementsConstrArg</span> <span class="o">=</span> <span class="n">MayNonerable2</span><span class="p">[</span><span class="s2">&quot;Element&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
<span class="n">NodeConstrArg</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;Node&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
<span class="n">ElementConstrArg</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;Element&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>

<span class="n">NodeVariableType</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">sequencetools</span><span class="o">.</span><span class="n">InOutSequenceTypes</span><span class="p">,</span> <span class="s2">&quot;FusedVariable&quot;</span><span class="p">]</span>

<span class="n">_default_variable</span><span class="p">:</span> <span class="n">NodeVariableType</span> <span class="o">=</span> <span class="s2">&quot;Q&quot;</span>


<div class="viewcode-block" id="Keywords">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Keywords">[docs]</a>
<span class="k">class</span> <span class="nc">Keywords</span><span class="p">(</span><span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set of keyword arguments used to describe and search for |Element| and |Node|</span>
<span class="sd">    objects.&quot;&quot;&quot;</span>

    <span class="n">device</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Device</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">names</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_keywords</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>

<div class="viewcode-block" id="Keywords.startswith">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Keywords.startswith">[docs]</a>
    <span class="k">def</span> <span class="nf">startswith</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a list of all keywords, starting with the given string.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.core.devicetools import Keywords</span>
<span class="sd">        &gt;&gt;&gt; keywords = Keywords(&quot;first_keyword&quot;, &quot;second_keyword&quot;,</span>
<span class="sd">        ...                     &quot;keyword_3&quot;, &quot;keyword_4&quot;,</span>
<span class="sd">        ...                     &quot;keyboard&quot;)</span>
<span class="sd">        &gt;&gt;&gt; keywords.startswith(&quot;keyword&quot;)</span>
<span class="sd">        [&#39;keyword_3&#39;, &#39;keyword_4&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">keyword</span> <span class="k">for</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">keyword</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">name</span><span class="p">))</span></div>


<div class="viewcode-block" id="Keywords.endswith">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Keywords.endswith">[docs]</a>
    <span class="k">def</span> <span class="nf">endswith</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a list of all keywords ending with the given string.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.core.devicetools import Keywords</span>
<span class="sd">        &gt;&gt;&gt; keywords = Keywords(&quot;first_keyword&quot;, &quot;second_keyword&quot;,</span>
<span class="sd">        ...                     &quot;keyword_3&quot;, &quot;keyword_4&quot;,</span>
<span class="sd">        ...                     &quot;keyboard&quot;)</span>
<span class="sd">        &gt;&gt;&gt; keywords.endswith(&quot;keyword&quot;)</span>
<span class="sd">        [&#39;first_keyword&#39;, &#39;second_keyword&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">keyword</span> <span class="k">for</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">keyword</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">name</span><span class="p">))</span></div>


<div class="viewcode-block" id="Keywords.contains">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Keywords.contains">[docs]</a>
    <span class="k">def</span> <span class="nf">contains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a list of all keywords containing the given string.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.core.devicetools import Keywords</span>
<span class="sd">        &gt;&gt;&gt; keywords = Keywords(&quot;first_keyword&quot;, &quot;second_keyword&quot;,</span>
<span class="sd">        ...                     &quot;keyword_3&quot;, &quot;keyword_4&quot;,</span>
<span class="sd">        ...                     &quot;keyboard&quot;)</span>
<span class="sd">        &gt;&gt;&gt; keywords.contains(&quot;keyword&quot;)</span>
<span class="sd">        [&#39;first_keyword&#39;, &#39;keyword_3&#39;, &#39;keyword_4&#39;, &#39;second_keyword&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">keyword</span> <span class="k">for</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">_check_keywords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">objecttools</span><span class="o">.</span><span class="n">valid_variable_identifier</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">objecttools</span><span class="o">.</span><span class="n">augment_excmessage</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;While trying to add the keyword `</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">` to device &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">devicename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

<div class="viewcode-block" id="Keywords.update">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Keywords.update">[docs]</a>
    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">names</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># type: ignore[override]</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Before updating, the given names are checked to be valid variable</span>
<span class="sd">        identifiers.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.core.devicetools import Keywords</span>
<span class="sd">        &gt;&gt;&gt; keywords = Keywords(&quot;first_keyword&quot;, &quot;second_keyword&quot;,</span>
<span class="sd">        ...                     &quot;keyword_3&quot;, &quot;keyword_4&quot;,</span>
<span class="sd">        ...                     &quot;keyboard&quot;)</span>
<span class="sd">        &gt;&gt;&gt; keywords.update(&quot;test_1&quot;, &quot;test 2&quot;)   # doctest: +ELLIPSIS</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        ValueError: While trying to add the keyword `test 2` to device ?, the \</span>
<span class="sd">following error occurred: The given name string `test 2` does not define a valid \</span>
<span class="sd">variable identifier.  ...</span>

<span class="sd">        Note that even the first string (`test1`) is not added due to the second one</span>
<span class="sd">        (`test 2`) being invalid.</span>

<span class="sd">        &gt;&gt;&gt; keywords</span>
<span class="sd">        Keywords(&quot;first_keyword&quot;, &quot;keyboard&quot;, &quot;keyword_3&quot;, &quot;keyword_4&quot;,</span>
<span class="sd">                 &quot;second_keyword&quot;)</span>

<span class="sd">        After correcting the second string, everything works fine:</span>

<span class="sd">        &gt;&gt;&gt; keywords.update(&quot;test_1&quot;, &quot;test_2&quot;)</span>
<span class="sd">        &gt;&gt;&gt; keywords</span>
<span class="sd">        Keywords(&quot;first_keyword&quot;, &quot;keyboard&quot;, &quot;keyword_3&quot;, &quot;keyword_4&quot;,</span>
<span class="sd">                 &quot;second_keyword&quot;, &quot;test_1&quot;, &quot;test_2&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_names</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_keywords</span><span class="p">(</span><span class="n">_names</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">_names</span><span class="p">)</span></div>


<div class="viewcode-block" id="Keywords.add">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Keywords.add">[docs]</a>
    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Before adding a new name, it is checked to be valid variable</span>
<span class="sd">        identifiers.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.core.devicetools import Keywords</span>
<span class="sd">        &gt;&gt;&gt; keywords = Keywords(&quot;first_keyword&quot;, &quot;second_keyword&quot;,</span>
<span class="sd">        ...                     &quot;keyword_3&quot;, &quot;keyword_4&quot;,</span>
<span class="sd">        ...                     &quot;keyboard&quot;)</span>
<span class="sd">        &gt;&gt;&gt; keywords.add(&quot;1_test&quot;)   # doctest: +ELLIPSIS</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        ValueError: While trying to add the keyword `1_test` to device ?, the \</span>
<span class="sd">following error occurred: The given name string `1_test` does not define a valid \</span>
<span class="sd">variable identifier.  ...</span>

<span class="sd">        &gt;&gt;&gt; keywords</span>
<span class="sd">        Keywords(&quot;first_keyword&quot;, &quot;keyboard&quot;, &quot;keyword_3&quot;, &quot;keyword_4&quot;,</span>
<span class="sd">                 &quot;second_keyword&quot;)</span>

<span class="sd">        After correcting the string, everything works fine:</span>

<span class="sd">        &gt;&gt;&gt; keywords.add(&quot;one_test&quot;)</span>
<span class="sd">        &gt;&gt;&gt; keywords</span>
<span class="sd">        Keywords(&quot;first_keyword&quot;, &quot;keyboard&quot;, &quot;keyword_3&quot;, &quot;keyword_4&quot;,</span>
<span class="sd">                 &quot;one_test&quot;, &quot;second_keyword&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_keywords</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">)])</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">))</span></div>


    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">repr_</span><span class="o">.</span><span class="n">preserve_strings</span><span class="p">(</span><span class="kc">True</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="n">objecttools</span><span class="o">.</span><span class="n">assignrepr_values</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="s2">&quot;Keywords(&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">70</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>
            <span class="p">)</span></div>



<span class="n">_registry_fusedvariable</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">FusedVariable</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>


<div class="viewcode-block" id="FusedVariable">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.FusedVariable">[docs]</a>
<span class="k">class</span> <span class="nc">FusedVariable</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Combines |InputSequence| and |OutputSequence| subclasses of different models</span>
<span class="sd">    dealing with the same property into a single variable.</span>

<span class="sd">    Class |FusedVariable| is one possible type of the property |Node.variable| of class</span>
<span class="sd">    |Node|.  We need it in some *HydPy* projects where the involved models do not only</span>
<span class="sd">    pass runoff to each other but share other types of data as well.  Each</span>
<span class="sd">    project-specific |FusedVariable| object serves as a &quot;meta-type&quot;, indicating which</span>
<span class="sd">    input and output sequences of the different models correlate and are thus</span>
<span class="sd">    connectable with each other.</span>

<span class="sd">    Using class |FusedVariable| is easiest to explain by a concrete example.  Assume we</span>
<span class="sd">    use |conv_v001| to interpolate the air temperature for a specific location.  We use</span>
<span class="sd">    this temperature as input to the |evap_v001| model, which requires this and other</span>
<span class="sd">    meteorological data to calculate potential evapotranspiration.  Further, we pass</span>
<span class="sd">    the calculated potential evapotranspiration as input to |lland_v2| for calculating</span>
<span class="sd">    the actual evapotranspiration.  Hence, we need to connect the output sequence</span>
<span class="sd">    |evap_fluxes.ReferenceEvapotranspiration| of |evap_v001| with the input sequence</span>
<span class="sd">    |lland_inputs.PET| of |lland_v2|.</span>

<span class="sd">    Additionally, |lland_v2| requires temperature data itself for modelling snow</span>
<span class="sd">    processes, introducing the problem that we need to use the same data (the output of</span>
<span class="sd">    |conv_v001|) as the input of two differently named input sequences</span>
<span class="sd">    (|evap_inputs.AirTemperature| and |lland_inputs.TemL| for |evap_v001| and</span>
<span class="sd">    |lland_v2|, respectively).</span>

<span class="sd">    For our concrete example, we need to create two |FusedVariable| objects.  `E`</span>
<span class="sd">    combines |evap_fluxes.ReferenceEvapotranspiration| and |lland_inputs.PET| and `T`</span>
<span class="sd">    combines |evap_inputs.AirTemperature| and |lland_inputs.TemL| (for convenience, we</span>
<span class="sd">    import their globally available aliases):</span>

<span class="sd">    &gt;&gt;&gt; from hydpy import FusedVariable</span>
<span class="sd">    &gt;&gt;&gt; from hydpy.inputs import lland_PET, evap_AirTemperature, lland_TemL</span>
<span class="sd">    &gt;&gt;&gt; from hydpy.outputs import evap_ReferenceEvapotranspiration</span>
<span class="sd">    &gt;&gt;&gt; E = FusedVariable(&quot;E&quot;, evap_ReferenceEvapotranspiration, lland_PET)</span>
<span class="sd">    &gt;&gt;&gt; T = FusedVariable(&quot;T&quot;, evap_AirTemperature, lland_TemL)</span>

<span class="sd">    Now we can construct the network:</span>

<span class="sd">     * Node `t1` handles the original temperature and serves as the input node to</span>
<span class="sd">       element `conv`. We define the (arbitrarily selected) string `Temp` to be its</span>
<span class="sd">       variable.</span>
<span class="sd">     * Node `e` receives the potential evapotranspiration calculated by element `evap`</span>
<span class="sd">       and passes it to element `lland`.  Node `e` thus receives the fused variable `E`.</span>
<span class="sd">     * Node `t2` handles the interpolated temperature and serves as the outlet node of</span>
<span class="sd">       element `conv` and the input node to elements `evap` and `lland`.  Node `t2`</span>
<span class="sd">       thus receives the fused variable `T`.</span>

<span class="sd">    &gt;&gt;&gt; from hydpy import Node, Element</span>
<span class="sd">    &gt;&gt;&gt; t1 = Node(&quot;t1&quot;, variable=&quot;Temp&quot;)</span>
<span class="sd">    &gt;&gt;&gt; t2 = Node(&quot;t2&quot;, variable=T)</span>
<span class="sd">    &gt;&gt;&gt; e = Node(&quot;e&quot;, variable=E)</span>
<span class="sd">    &gt;&gt;&gt; conv = Element(&quot;element_conv&quot;,</span>
<span class="sd">    ...                inlets=t1,</span>
<span class="sd">    ...                outlets=t2)</span>
<span class="sd">    &gt;&gt;&gt; evap = Element(&quot;element_evap&quot;,</span>
<span class="sd">    ...                inputs=t2,</span>
<span class="sd">    ...                outputs=e)</span>
<span class="sd">    &gt;&gt;&gt; lland = Element(&quot;element_lland&quot;,</span>
<span class="sd">    ...                 inputs=(t2, e),</span>
<span class="sd">    ...                 outlets=&quot;node_q&quot;)</span>

<span class="sd">    Now we can prepare the different model objects and assign them to their</span>
<span class="sd">    corresponding elements (note that parameters |conv_control.InputCoordinates| and</span>
<span class="sd">    |conv_control.OutputCoordinates| of |conv_v001| first require information on the</span>
<span class="sd">    location of the relevant nodes):</span>

<span class="sd">    &gt;&gt;&gt; from hydpy import prepare_model</span>
<span class="sd">    &gt;&gt;&gt; model_conv = prepare_model(&quot;conv_v001&quot;)</span>
<span class="sd">    &gt;&gt;&gt; model_conv.parameters.control.inputcoordinates(t1=(0, 0))</span>
<span class="sd">    &gt;&gt;&gt; model_conv.parameters.control.outputcoordinates(t2=(1, 1))</span>
<span class="sd">    &gt;&gt;&gt; model_conv.parameters.control.maxnmbinputs(1)</span>
<span class="sd">    &gt;&gt;&gt; model_conv.parameters.update()</span>
<span class="sd">    &gt;&gt;&gt; conv.model = model_conv</span>
<span class="sd">    &gt;&gt;&gt; evap.model = prepare_model(&quot;evap_v001&quot;)</span>
<span class="sd">    &gt;&gt;&gt; lland.model = prepare_model(&quot;lland_v2&quot;)</span>

<span class="sd">    We assign a temperature value to node `t1`:</span>

<span class="sd">    &gt;&gt;&gt; t1.sequences.sim = -273.15</span>

<span class="sd">    Model |conv_v001| now can perform a simulation step and pass its output to node</span>
<span class="sd">    `t2`:</span>

<span class="sd">    &gt;&gt;&gt; conv.model.simulate(0)</span>
<span class="sd">    &gt;&gt;&gt; t2.sequences.sim</span>
<span class="sd">    sim(-273.15)</span>

<span class="sd">    Without further configuration, |evap_v001| cannot perform any simulation steps.</span>
<span class="sd">    Hence, we just call its |Model.load_data| method to show that its input sequence</span>
<span class="sd">    |evap_inputs.AirTemperature| is well connected to the |Sim| sequence of node `t2`</span>
<span class="sd">    and receives the correct data:</span>

<span class="sd">    &gt;&gt;&gt; evap.model.load_data()</span>
<span class="sd">    &gt;&gt;&gt; evap.model.sequences.inputs.airtemperature</span>
<span class="sd">    airtemperature(-273.15)</span>

<span class="sd">    The output sequence |evap_fluxes.ReferenceEvapotranspiration| is also well</span>
<span class="sd">    connected.  A call to method |Model.update_outputs| passes its (manually set) value</span>
<span class="sd">    to node `e`, respectively:</span>

<span class="sd">    &gt;&gt;&gt; evap.model.sequences.fluxes.referenceevapotranspiration = 999.9</span>
<span class="sd">    &gt;&gt;&gt; evap.model.update_outputs()</span>
<span class="sd">    &gt;&gt;&gt; e.sequences.sim</span>
<span class="sd">    sim(999.9)</span>

<span class="sd">    Finally, both input sequences |lland_inputs.TemL| and |lland_inputs.PET| receive</span>
<span class="sd">    the current values of nodes `t2` and `e`:</span>

<span class="sd">    &gt;&gt;&gt; lland.model.load_data()</span>
<span class="sd">    &gt;&gt;&gt; lland.model.sequences.inputs.teml</span>
<span class="sd">    teml(-273.15)</span>
<span class="sd">    &gt;&gt;&gt; lland.model.sequences.inputs.pet</span>
<span class="sd">    pet(999.9)</span>

<span class="sd">    When defining fused variables, class |FusedVariable| performs some registration</span>
<span class="sd">    behind the scenes, similar to classes |Node| and |Element| do.  Again, the name</span>
<span class="sd">    works as the identifier, and we force the same fused variable to exist only once,</span>
<span class="sd">    even when defined in different selection files repeatedly.  Hence, when we repeat</span>
<span class="sd">    the definition from above, we get the same object:</span>

<span class="sd">    &gt;&gt;&gt; Test = FusedVariable(&quot;T&quot;, evap_AirTemperature, lland_TemL)</span>
<span class="sd">    &gt;&gt;&gt; T is Test</span>
<span class="sd">    True</span>

<span class="sd">    Changing the member sequences of an existing fused variable is not allowed:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy.inputs import hland_T</span>
<span class="sd">    &gt;&gt;&gt; FusedVariable(&quot;T&quot;, hland_T, lland_TemL)</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ValueError: The sequences combined by a FusedVariable object cannot be changed.  \</span>
<span class="sd">The already defined sequences of the fused variable `T` are `evap_AirTemperature and \</span>
<span class="sd">lland_TemL` instead of `hland_T and lland_TemL`.  Keep in mind, that `name` is the \</span>
<span class="sd">unique identifier for fused variable instances.</span>


<span class="sd">    Defining additional fused variables with the same member sequences does not seem</span>
<span class="sd">    advisable but is allowed:</span>

<span class="sd">    &gt;&gt;&gt; Temp = FusedVariable(&quot;Temp&quot;, evap_AirTemperature, lland_TemL)</span>
<span class="sd">    &gt;&gt;&gt; T is Temp</span>
<span class="sd">    False</span>

<span class="sd">    To get an overview of the already existing fused variables, call method</span>
<span class="sd">    |FusedVariable.get_registry|:</span>

<span class="sd">    &gt;&gt;&gt; len(FusedVariable.get_registry())</span>
<span class="sd">    3</span>

<span class="sd">    Principally, you can clear the registry via method |FusedVariable.clear_registry|,</span>
<span class="sd">    but remember it does not remove |FusedVariable| objects from the running process</span>
<span class="sd">    being otherwise referenced:</span>

<span class="sd">    &gt;&gt;&gt; FusedVariable.clear_registry()</span>
<span class="sd">    &gt;&gt;&gt; FusedVariable.get_registry()</span>
<span class="sd">    ()</span>
<span class="sd">    &gt;&gt;&gt; t2.variable</span>
<span class="sd">    FusedVariable(&quot;T&quot;, evap_AirTemperature, lland_TemL)</span>

<span class="sd">    .. testsetup::</span>

<span class="sd">        &gt;&gt;&gt; Node.clear_all()</span>
<span class="sd">        &gt;&gt;&gt; Element.clear_all()</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">_aliases</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
    <span class="n">_variables</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">sequencetools</span><span class="o">.</span><span class="n">InOutSequenceTypes</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
    <span class="n">_alias2variable</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">sequencetools</span><span class="o">.</span><span class="n">InOutSequenceTypes</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="n">sequences</span><span class="p">:</span> <span class="n">sequencetools</span><span class="o">.</span><span class="n">InOutSequenceTypes</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FusedVariable</span><span class="p">:</span>
        <span class="bp">self</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="n">aliases</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">hydpy</span><span class="o">.</span><span class="n">sequence2alias</span><span class="p">[</span><span class="n">seq</span><span class="p">]</span> <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="n">sequences</span><span class="p">)</span>
        <span class="n">idxs</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">aliases</span><span class="p">)</span>
        <span class="n">aliases</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">aliases</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">idxs</span><span class="p">)</span>
        <span class="n">variables</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">sequences</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">idxs</span><span class="p">)</span>
        <span class="n">fusedvariable</span> <span class="o">=</span> <span class="n">_registry_fusedvariable</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fusedvariable</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">variables</span> <span class="o">==</span> <span class="n">fusedvariable</span><span class="o">.</span><span class="n">_variables</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">fusedvariable</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The sequences combined by a </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> object cannot be &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;changed.  The already defined sequences of the fused variable &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">` are `</span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">enumeration</span><span class="p">(</span><span class="n">fusedvariable</span><span class="o">.</span><span class="n">_aliases</span><span class="p">)</span><span class="si">}</span><span class="s2">` &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;instead of `</span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">enumeration</span><span class="p">(</span><span class="n">aliases</span><span class="p">)</span><span class="si">}</span><span class="s2">`.  Keep in mind, &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;that `name` is the unique identifier for fused variable instances.&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_aliases</span> <span class="o">=</span> <span class="n">aliases</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span> <span class="o">=</span> <span class="n">variables</span>
        <span class="n">_registry_fusedvariable</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_alias2variable</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_aliases</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span>

<div class="viewcode-block" id="FusedVariable.get_registry">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.FusedVariable.get_registry">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_registry</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="s2">&quot;FusedVariable&quot;</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all |FusedVariable| objects initialised so far.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">_registry_fusedvariable</span><span class="o">.</span><span class="n">values</span><span class="p">())</span></div>


<div class="viewcode-block" id="FusedVariable.clear_registry">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.FusedVariable.clear_registry">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">clear_registry</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Clear the registry from all |FusedVariable| objects initialised so far.</span>

<span class="sd">        Use this method only for good reasons!</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_registry_fusedvariable</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span></div>


    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">sequencetools</span><span class="o">.</span><span class="n">InOutSequenceTypes</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">variable</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">item</span><span class="p">,</span>
            <span class="p">(</span><span class="n">sequencetools</span><span class="o">.</span><span class="n">InputSequence</span><span class="p">,</span> <span class="n">sequencetools</span><span class="o">.</span><span class="n">OutputSequence</span><span class="p">),</span>
        <span class="p">):</span>
            <span class="n">item</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;FusedVariable(&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="si">}</span><span class="s1">&quot;, </span><span class="si">{</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_aliases</span><span class="p">)</span><span class="si">}</span><span class="s1">)&#39;</span></div>



<div class="viewcode-block" id="Devices">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Devices">[docs]</a>
<span class="k">class</span> <span class="nc">Devices</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">TypeDevice</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for class |Elements| and class |Nodes|.</span>

<span class="sd">    The following features are common to class |Nodes| and class |Elements|.  We</span>
<span class="sd">    arbitrarily select class |Nodes| for all examples.</span>

<span class="sd">    To initialise a |Nodes| collection class, pass a variable number of |str| or |Node|</span>
<span class="sd">    objects.  Strings are used to create new or query already existing nodes</span>
<span class="sd">    automatically:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy import Node, Nodes</span>
<span class="sd">    &gt;&gt;&gt; nodes = Nodes(&quot;na&quot;,</span>
<span class="sd">    ...               Node(&quot;nb&quot;, variable=&quot;W&quot;),</span>
<span class="sd">    ...               Node(&quot;nc&quot;, keywords=(&quot;group_a&quot;, &quot;group_1&quot;)),</span>
<span class="sd">    ...               Node(&quot;nd&quot;, keywords=(&quot;group_a&quot;, &quot;group_2&quot;)),</span>
<span class="sd">    ...               Node(&quot;ne&quot;, keywords=(&quot;group_b&quot;, &quot;group_1&quot;)))</span>

<span class="sd">    |Nodes| and |Elements| objects are containers supporting attribute access. You can</span>
<span class="sd">    access each node or element directly by its name:</span>

<span class="sd">    &gt;&gt;&gt; nodes.na</span>
<span class="sd">    Node(&quot;na&quot;, variable=&quot;Q&quot;)</span>

<span class="sd">    Wrong node names result in the following error message:</span>

<span class="sd">    &gt;&gt;&gt; nodes.wrong</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    AttributeError: The selected Nodes object has neither a `wrong` attribute nor \</span>
<span class="sd">does it handle a Node object with name or keyword `wrong`, which could be returned.</span>

<span class="sd">    As explained in more detail in the documentation on property |Device.keywords|, you</span>
<span class="sd">    can also use the keywords of the individual nodes to query the relevant ones:</span>

<span class="sd">    &gt;&gt;&gt; nodes.group_a</span>
<span class="sd">    Nodes(&quot;nc&quot;, &quot;nd&quot;)</span>

<span class="sd">    Especially in this context, you might find it useful to also get an iterable object</span>
<span class="sd">    in case no node or only a single node is available:</span>

<span class="sd">    &gt;&gt;&gt; Nodes.forceiterable = True</span>
<span class="sd">    &gt;&gt;&gt; nodes.wrong</span>
<span class="sd">    Nodes()</span>
<span class="sd">    &gt;&gt;&gt; nodes.na</span>
<span class="sd">    Nodes(&quot;na&quot;)</span>
<span class="sd">    &gt;&gt;&gt; Nodes.forceiterable = False</span>

<span class="sd">    Attribute deleting is supported:</span>

<span class="sd">    &gt;&gt;&gt; &quot;na&quot; in nodes</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; del nodes.na</span>
<span class="sd">    &gt;&gt;&gt; &quot;na&quot; in nodes</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; del nodes.na</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    AttributeError: The actual Nodes object does not handle a Node object named `na` \</span>
<span class="sd">which could be removed, and deleting other attributes is not supported.</span>

<span class="sd">    However, shown  by the next example, setting devices via attribute access could</span>
<span class="sd">    result in inconsistencies and is not allowed (see method |Devices.add_device|</span>
<span class="sd">    instead):</span>

<span class="sd">    &gt;&gt;&gt; nodes.NF = Node(&quot;nf&quot;)</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    AttributeError: Setting attributes of Nodes objects could result in confusion \</span>
<span class="sd">whether a new attribute should be handled as a Node object or as a &quot;normal&quot; attribute \</span>
<span class="sd">and is thus not support, hence `NF` is rejected.</span>

<span class="sd">    |Nodes| and |Elements| instances support iteration:</span>

<span class="sd">    &gt;&gt;&gt; len(nodes)</span>
<span class="sd">    4</span>
<span class="sd">    &gt;&gt;&gt; for node in nodes:</span>
<span class="sd">    ...     print(node.name, end=&quot;,&quot;)</span>
<span class="sd">    nb,nc,nd,ne,</span>

<span class="sd">    The binary operators `+`, `+=`, `-` and `-=` support adding and removing single</span>
<span class="sd">    devices or groups of devices:</span>

<span class="sd">    &gt;&gt;&gt; nodes</span>
<span class="sd">    Nodes(&quot;nb&quot;, &quot;nc&quot;, &quot;nd&quot;, &quot;ne&quot;)</span>
<span class="sd">    &gt;&gt;&gt; nodes - Node(&quot;nc&quot;)</span>
<span class="sd">    Nodes(&quot;nb&quot;, &quot;nd&quot;, &quot;ne&quot;)</span>

<span class="sd">    Nodes(&quot;nb&quot;, &quot;nc&quot;, &quot;nd&quot;, &quot;ne&quot;)</span>
<span class="sd">    &gt;&gt;&gt; nodes -= Nodes(&quot;nc&quot;, &quot;ne&quot;)</span>
<span class="sd">    &gt;&gt;&gt; nodes</span>
<span class="sd">    Nodes(&quot;nb&quot;, &quot;nd&quot;)</span>

<span class="sd">    &gt;&gt;&gt; nodes + &quot;nc&quot;</span>
<span class="sd">    Nodes(&quot;nb&quot;, &quot;nc&quot;, &quot;nd&quot;)</span>
<span class="sd">    &gt;&gt;&gt; nodes</span>
<span class="sd">    Nodes(&quot;nb&quot;, &quot;nd&quot;)</span>
<span class="sd">    &gt;&gt;&gt; nodes += (&quot;nc&quot;, Node(&quot;ne&quot;))</span>
<span class="sd">    &gt;&gt;&gt; nodes</span>
<span class="sd">    Nodes(&quot;nb&quot;, &quot;nc&quot;, &quot;nd&quot;, &quot;ne&quot;)</span>

<span class="sd">    Attempts to add already existing or to remove non-existing devices do no harm:</span>

<span class="sd">    &gt;&gt;&gt; nodes</span>
<span class="sd">    Nodes(&quot;nb&quot;, &quot;nc&quot;, &quot;nd&quot;, &quot;ne&quot;)</span>
<span class="sd">    &gt;&gt;&gt; nodes + (&quot;nc&quot;, &quot;ne&quot;)</span>
<span class="sd">    Nodes(&quot;nb&quot;, &quot;nc&quot;, &quot;nd&quot;, &quot;ne&quot;)</span>
<span class="sd">    &gt;&gt;&gt; nodes - Node(&quot;na&quot;)</span>
<span class="sd">    Nodes(&quot;nb&quot;, &quot;nc&quot;, &quot;nd&quot;, &quot;ne&quot;)</span>

<span class="sd">    Comparisons are supported, with &quot;x &lt; y&quot; being |True| if &quot;x&quot; is a subset of &quot;y&quot;:</span>

<span class="sd">    &gt;&gt;&gt; subgroup = Nodes(&quot;nc&quot;, &quot;ne&quot;)</span>
<span class="sd">    &gt;&gt;&gt; subgroup &lt; nodes, nodes &lt; subgroup, nodes &lt; nodes</span>
<span class="sd">    (True, False, False)</span>
<span class="sd">    &gt;&gt;&gt; subgroup &lt;= nodes, nodes &lt;= subgroup, nodes &lt;= nodes</span>
<span class="sd">    (True, False, True)</span>
<span class="sd">    &gt;&gt;&gt; subgroup == nodes, nodes == subgroup, nodes == nodes, nodes == &quot;nodes&quot;</span>
<span class="sd">    (False, False, True, False)</span>
<span class="sd">    &gt;&gt;&gt; subgroup != nodes, nodes != subgroup, nodes != nodes, nodes != &quot;nodes&quot;</span>
<span class="sd">    (True, True, False, True)</span>
<span class="sd">    &gt;&gt;&gt; subgroup &gt;= nodes, nodes &gt;= subgroup, nodes &gt;= nodes</span>
<span class="sd">    (False, True, True)</span>
<span class="sd">    &gt;&gt;&gt; subgroup &gt; nodes, nodes &gt; subgroup, nodes &gt; nodes</span>
<span class="sd">    (False, True, False)</span>

<span class="sd">    Class |Nodes| supports the `in` operator both for |str| and |Node| objects and</span>
<span class="sd">    generally returns |False| for other types:</span>

<span class="sd">    &gt;&gt;&gt; &quot;na&quot; in nodes</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; &quot;nb&quot; in nodes</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; Node(&quot;na&quot;) in nodes</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; Node(&quot;nb&quot;) in nodes</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; 1 in nodes</span>
<span class="sd">    False</span>

<span class="sd">    Passing wrong arguments to the constructor of class |Node| results in errors like</span>
<span class="sd">    the following:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy import Element</span>
<span class="sd">    &gt;&gt;&gt; Nodes(&quot;na&quot;, Element(&quot;ea&quot;))</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    TypeError: While trying to initialise a `Nodes` object, the following error \</span>
<span class="sd">occurred: The given (sub)value `Element(&quot;ea&quot;)` is not an instance of the following \</span>
<span class="sd">classes: Node and str.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">mutable</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">forceiterable</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">_name2device</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">TypeDevice</span><span class="p">]</span>
    <span class="n">_shadowed_keywords</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">values</span><span class="p">:</span> <span class="n">MayNonerable2</span><span class="p">[</span><span class="n">TypeDevice</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">mutable</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Devices</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Devices</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="n">setattr_</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span>
        <span class="n">setattr_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;mutable&quot;</span><span class="p">,</span> <span class="n">mutable</span><span class="p">)</span>
        <span class="n">setattr_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_name2device&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">setattr_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_shadowed_keywords&quot;</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span>
        <span class="n">contentclass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_contentclass</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span>
                <span class="n">values</span><span class="p">,</span> <span class="n">types_</span><span class="o">=</span><span class="p">(</span><span class="n">contentclass</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span> <span class="n">skip</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_device</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
            <span class="n">objecttools</span><span class="o">.</span><span class="n">augment_excmessage</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;While trying to initialise a `</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">` object&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

<div class="viewcode-block" id="Devices.get_contentclass">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Devices.get_contentclass">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">get_contentclass</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Type</span><span class="p">[</span><span class="n">TypeDevice</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;To be overridden.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="Devices.add_device">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Devices.add_device">[docs]</a>
    <span class="k">def</span> <span class="nf">add_device</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">TypeDevice</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add the given |Node| or |Element| object to the actual |Nodes| or |Elements|</span>
<span class="sd">        object.</span>

<span class="sd">        You can pass either a string or a device:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import Nodes</span>
<span class="sd">        &gt;&gt;&gt; nodes = Nodes()</span>
<span class="sd">        &gt;&gt;&gt; nodes.add_device(&quot;old_node&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nodes</span>
<span class="sd">        Nodes(&quot;old_node&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nodes.add_device(&quot;new_node&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nodes</span>
<span class="sd">        Nodes(&quot;new_node&quot;, &quot;old_node&quot;)</span>

<span class="sd">        Method |Devices.add_device| is disabled for immutable |Nodes| and |Elements|</span>
<span class="sd">        objects:</span>

<span class="sd">        &gt;&gt;&gt; nodes.mutable = False</span>
<span class="sd">        &gt;&gt;&gt; nodes.add_device(&quot;newest_node&quot;)</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        RuntimeError: While trying to add the device `newest_node` to a Nodes object, \</span>
<span class="sd">the following error occurred: Adding devices to immutable Nodes objects is not allowed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutable</span><span class="p">:</span>
                <span class="n">_device</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_contentclass</span><span class="p">()(</span><span class="n">device</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_name2device</span><span class="p">[</span><span class="n">_device</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">_device</span>
                <span class="n">_id2devices</span><span class="p">[</span><span class="n">_device</span><span class="p">][</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)]</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">Devices</span><span class="p">[</span><span class="n">Device</span><span class="p">],</span> <span class="bp">self</span><span class="p">)</span>  <span class="c1"># ToDo</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Adding devices to immutable </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> objects is &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;not allowed.&quot;</span>
                <span class="p">)</span>
        <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
            <span class="n">objecttools</span><span class="o">.</span><span class="n">augment_excmessage</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;While trying to add the device `</span><span class="si">{</span><span class="n">device</span><span class="si">}</span><span class="s2">` to a &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> object&quot;</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="Devices.remove_device">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Devices.remove_device">[docs]</a>
    <span class="k">def</span> <span class="nf">remove_device</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">TypeDevice</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove the given |Node| or |Element| object from the actual |Nodes| or</span>
<span class="sd">        |Elements| object.</span>

<span class="sd">        You can pass either a string or a device:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import Node, Nodes</span>
<span class="sd">        &gt;&gt;&gt; nodes = Nodes(&quot;node_x&quot;, &quot;node_y&quot;)</span>
<span class="sd">        &gt;&gt;&gt; node_x, node_y = nodes</span>
<span class="sd">        &gt;&gt;&gt; nodes.remove_device(Node(&quot;node_y&quot;))</span>
<span class="sd">        &gt;&gt;&gt; nodes</span>
<span class="sd">        Nodes(&quot;node_x&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nodes.remove_device(Node(&quot;node_x&quot;))</span>
<span class="sd">        &gt;&gt;&gt; nodes</span>
<span class="sd">        Nodes()</span>
<span class="sd">        &gt;&gt;&gt; nodes.remove_device(Node(&quot;node_z&quot;))</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        ValueError: While trying to remove the device `node_z` from a Nodes object, \</span>
<span class="sd">the following error occurred: The actual Nodes object does not handle such a device.</span>

<span class="sd">        Method |Devices.remove_device| is disabled for immutable |Nodes| and |Elements|</span>
<span class="sd">        objects:</span>

<span class="sd">        &gt;&gt;&gt; nodes.mutable = False</span>
<span class="sd">        &gt;&gt;&gt; nodes.remove_device(&quot;node_z&quot;)</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        RuntimeError: While trying to remove the device `node_z` from a Nodes object, \</span>
<span class="sd">the following error occurred: Removing devices from immutable Nodes objects is not \</span>
<span class="sd">allowed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutable</span><span class="p">:</span>
                <span class="n">_device</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_contentclass</span><span class="p">()(</span><span class="n">device</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name2device</span><span class="p">[</span><span class="n">_device</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;The actual </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;object does not handle such a device.&quot;</span>
                    <span class="p">)</span> <span class="kn">from</span> <span class="kc">None</span>
                <span class="k">del</span> <span class="n">_id2devices</span><span class="p">[</span><span class="n">_device</span><span class="p">][</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Removing devices from immutable &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> objects is not allowed.&quot;</span>
                <span class="p">)</span>
        <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
            <span class="n">objecttools</span><span class="o">.</span><span class="n">augment_excmessage</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;While trying to remove the device `</span><span class="si">{</span><span class="n">device</span><span class="si">}</span><span class="s2">` from a &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> object&quot;</span>
            <span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A sorted tuple of the names of the handled devices.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import Nodes</span>
<span class="sd">        &gt;&gt;&gt; Nodes(&quot;a&quot;, &quot;c&quot;, &quot;b&quot;).names</span>
<span class="sd">        (&#39;a&#39;, &#39;b&#39;, &#39;c&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">devices</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">TypeDevice</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A tuple of the handled devices sorted by the device names.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import Nodes</span>
<span class="sd">        &gt;&gt;&gt; for node in Nodes(&quot;a&quot;, &quot;c&quot;, &quot;b&quot;).devices:</span>
<span class="sd">        ...     print(repr(node))</span>
<span class="sd">        Node(&quot;a&quot;, variable=&quot;Q&quot;)</span>
<span class="sd">        Node(&quot;b&quot;, variable=&quot;Q&quot;)</span>
<span class="sd">        Node(&quot;c&quot;, variable=&quot;Q&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">device</span> <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">keywords</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A set of all keywords of all handled devices.</span>

<span class="sd">        In addition to attribute access via device names, |Nodes| and |Elements|</span>
<span class="sd">        objects allow for attribute access via keywords, allowing for an efficient</span>
<span class="sd">        search of certain groups of devices.  Let us use the example from above, where</span>
<span class="sd">        the nodes `na` and `nb` have no keywords, but each of the other three nodes</span>
<span class="sd">        both belongs to either `group_a` or `group_b` and `group_1` or `group_2`:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import Node, Nodes</span>
<span class="sd">        &gt;&gt;&gt; nodes = Nodes(&quot;na&quot;,</span>
<span class="sd">        ...               Node(&quot;nb&quot;, variable=&quot;W&quot;),</span>
<span class="sd">        ...               Node(&quot;nc&quot;, keywords=(&quot;group_a&quot;, &quot;group_1&quot;)),</span>
<span class="sd">        ...               Node(&quot;nd&quot;, keywords=(&quot;group_a&quot;, &quot;group_2&quot;)),</span>
<span class="sd">        ...               Node(&quot;ne&quot;, keywords=(&quot;group_b&quot;, &quot;group_1&quot;)))</span>
<span class="sd">        &gt;&gt;&gt; nodes</span>
<span class="sd">        Nodes(&quot;na&quot;, &quot;nb&quot;, &quot;nc&quot;, &quot;nd&quot;, &quot;ne&quot;)</span>
<span class="sd">        &gt;&gt;&gt; sorted(nodes.keywords)</span>
<span class="sd">        [&#39;group_1&#39;, &#39;group_2&#39;, &#39;group_a&#39;, &#39;group_b&#39;]</span>

<span class="sd">        If you are interested in inspecting all devices belonging to `group_a`, select</span>
<span class="sd">        them via this keyword:</span>

<span class="sd">        &gt;&gt;&gt; subgroup = nodes.group_1</span>
<span class="sd">        &gt;&gt;&gt; subgroup</span>
<span class="sd">        Nodes(&quot;nc&quot;, &quot;ne&quot;)</span>

<span class="sd">        You can further restrict the search by also selecting the devices belonging to</span>
<span class="sd">        `group_b`, which holds only for node &quot;e&quot;, in the discussed example:</span>

<span class="sd">        &gt;&gt;&gt; subsubgroup = subgroup.group_b</span>
<span class="sd">        &gt;&gt;&gt; subsubgroup</span>
<span class="sd">        Node(&quot;ne&quot;, variable=&quot;Q&quot;,</span>
<span class="sd">             keywords=[&quot;group_1&quot;, &quot;group_b&quot;])</span>

<span class="sd">        Note that the keywords already used for building a device subgroup are not</span>
<span class="sd">        informative anymore (as they hold for each device) and are thus not shown</span>
<span class="sd">        anymore:</span>

<span class="sd">        &gt;&gt;&gt; sorted(subgroup.keywords)</span>
<span class="sd">        [&#39;group_a&#39;, &#39;group_b&#39;]</span>

<span class="sd">        The latter might be confusing if you intend to work with a device subgroup for</span>
<span class="sd">        a longer time.  After copying the subgroup, all keywords of the contained</span>
<span class="sd">        devices are available again:</span>

<span class="sd">        &gt;&gt;&gt; from copy import copy</span>
<span class="sd">        &gt;&gt;&gt; newgroup = copy(subgroup)</span>
<span class="sd">        &gt;&gt;&gt; sorted(newgroup.keywords)</span>
<span class="sd">        [&#39;group_1&#39;, &#39;group_a&#39;, &#39;group_b&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">(</span>
            <span class="n">keyword</span>
            <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="bp">self</span>
            <span class="k">for</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="n">device</span><span class="o">.</span><span class="n">keywords</span>
            <span class="k">if</span> <span class="n">keyword</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shadowed_keywords</span>
        <span class="p">)</span>

<div class="viewcode-block" id="Devices.search_keywords">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Devices.search_keywords">[docs]</a>
    <span class="k">def</span> <span class="nf">search_keywords</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">TypeDevices</span><span class="p">,</span> <span class="o">*</span><span class="n">keywords</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TypeDevices</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Search for all devices handling at least one of the given keywords and</span>
<span class="sd">        return them.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import Node, Nodes</span>
<span class="sd">        &gt;&gt;&gt; nodes = Nodes(&quot;na&quot;,</span>
<span class="sd">        ...               Node(&quot;nb&quot;, variable=&quot;W&quot;),</span>
<span class="sd">        ...               Node(&quot;nc&quot;, keywords=(&quot;group_a&quot;, &quot;group_1&quot;)),</span>
<span class="sd">        ...               Node(&quot;nd&quot;, keywords=(&quot;group_a&quot;, &quot;group_2&quot;)),</span>
<span class="sd">        ...               Node(&quot;ne&quot;, keywords=(&quot;group_b&quot;, &quot;group_1&quot;)))</span>
<span class="sd">        &gt;&gt;&gt; nodes.search_keywords(&quot;group_c&quot;)</span>
<span class="sd">        Nodes()</span>
<span class="sd">        &gt;&gt;&gt; nodes.search_keywords(&quot;group_a&quot;)</span>
<span class="sd">        Nodes(&quot;nc&quot;, &quot;nd&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nodes.search_keywords(&quot;group_a&quot;, &quot;group_1&quot;)</span>
<span class="sd">        Nodes(&quot;nc&quot;, &quot;nd&quot;, &quot;ne&quot;)</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; Node.clear_all()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">keywords_</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">keywords</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span>
            <span class="o">*</span><span class="p">(</span><span class="n">device</span> <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">keywords_</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">keywords</span><span class="p">))</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Devices.copy">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Devices.copy">[docs]</a>
    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">TypeDevices</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TypeDevices</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a shallow copy of the actual |Nodes| or |Elements| object.</span>

<span class="sd">        Method |Devices.copy| returns a semi-flat copy of |Nodes| or |Elements| objects</span>
<span class="sd">        due to their devices being not copyable:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import Nodes</span>
<span class="sd">        &gt;&gt;&gt; old = Nodes(&quot;x&quot;, &quot;y&quot;)</span>
<span class="sd">        &gt;&gt;&gt; import copy</span>
<span class="sd">        &gt;&gt;&gt; new = copy.copy(old)</span>
<span class="sd">        &gt;&gt;&gt; new == old</span>
<span class="sd">        True</span>
<span class="sd">        &gt;&gt;&gt; new is old</span>
<span class="sd">        False</span>
<span class="sd">        &gt;&gt;&gt; new.devices is old.devices</span>
<span class="sd">        False</span>
<span class="sd">        &gt;&gt;&gt; new.x is new.x</span>
<span class="sd">        True</span>

<span class="sd">        Changing the |Device.name| of a device is recognised both by the original and</span>
<span class="sd">        the copied collection objects:</span>

<span class="sd">        &gt;&gt;&gt; new.x.name = &quot;z&quot;</span>
<span class="sd">        &gt;&gt;&gt; old.z</span>
<span class="sd">        Node(&quot;z&quot;, variable=&quot;Q&quot;)</span>
<span class="sd">        &gt;&gt;&gt; new.z</span>
<span class="sd">        Node(&quot;z&quot;, variable=&quot;Q&quot;)</span>

<span class="sd">        Deep copying is permitted due to the above reason:</span>

<span class="sd">        &gt;&gt;&gt; copy.deepcopy(old)</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        NotImplementedError: Deep copying of Nodes objects is not supported, as it \</span>
<span class="sd">would require to make deep copies of the Node objects themselves, which is in \</span>
<span class="sd">conflict with using their names as identifiers.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># pylint: disable=protected-access</span>
        <span class="n">new</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)()</span>
        <span class="nb">vars</span><span class="p">(</span><span class="n">new</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="n">new</span><span class="o">.</span><span class="n">_name2device</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_name2device</span><span class="p">)</span>
        <span class="n">new</span><span class="o">.</span><span class="n">_shadowed_keywords</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">_id2devices</span><span class="p">[</span><span class="n">device</span><span class="p">][</span><span class="nb">id</span><span class="p">(</span><span class="n">new</span><span class="p">)]</span> <span class="o">=</span> <span class="n">new</span>
        <span class="k">return</span> <span class="n">new</span></div>


<div class="viewcode-block" id="Devices.intersection">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Devices.intersection">[docs]</a>
    <span class="k">def</span> <span class="nf">intersection</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">TypeDevices</span><span class="p">,</span> <span class="o">*</span><span class="n">other</span><span class="p">:</span> <span class="n">TypeDevices</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TypeDevices</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the intersection with the given |Devices| object.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import Node, Nodes</span>
<span class="sd">        &gt;&gt;&gt; nodes1 = Nodes(&quot;na&quot;, &quot;nb&quot;, &quot;nc&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nodes2 = Nodes(&quot;na&quot;, &quot;nc&quot;, &quot;nd&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nodes1.intersection(*nodes2)</span>
<span class="sd">        Nodes(&quot;na&quot;, &quot;nc&quot;)</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; Node.clear_all()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="o">*</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">other</span><span class="p">)))</span></div>


    <span class="n">__copy__</span> <span class="o">=</span> <span class="n">copy</span>

    <span class="k">def</span> <span class="nf">__deepcopy__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dict_</span><span class="p">:</span> <span class="n">NoReturn</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NoReturn</span><span class="p">:</span>
        <span class="n">classname</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Deep copying of </span><span class="si">{</span><span class="n">classname</span><span class="si">}</span><span class="s2"> objects is not supported, as it would &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;require to make deep copies of the </span><span class="si">{</span><span class="n">classname</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> objects themselves, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;which is in conflict with using their names as identifiers.&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__select_devices_by_keyword</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">TypeDevices</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TypeDevices</span><span class="p">:</span>
        <span class="c1"># pylint: disable=protected-access</span>
        <span class="n">devices</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="o">*</span><span class="p">(</span><span class="n">device</span> <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">device</span><span class="o">.</span><span class="n">keywords</span><span class="p">))</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">_shadowed_keywords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shadowed_keywords</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">_shadowed_keywords</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">devices</span>

    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">TypeDevices</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">TypeDevice</span><span class="p">,</span> <span class="n">TypeDevices</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name2device</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">forceiterable</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="bp">self</span><span class="o">.</span><span class="n">_name2device</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="n">TypeDevice</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name2device</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>  <span class="c1"># ToDo</span>
        <span class="n">_devices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__select_devices_by_keyword</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">forceiterable</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">_devices</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_devices</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_devices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="n">TypeDevice</span><span class="p">,</span> <span class="n">_devices</span><span class="o">.</span><span class="n">devices</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># ToDo</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;The selected </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> object has neither a `</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">` &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;attribute nor does it handle a </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_contentclass</span><span class="p">()</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;object with name or keyword `</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">`, which could be returned.&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">classname</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Setting attributes of </span><span class="si">{</span><span class="n">classname</span><span class="si">}</span><span class="s2"> objects could result in confusion &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;whether a new attribute should be handled as a </span><span class="si">{</span><span class="n">classname</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="sa">f</span><span class="s1">&#39;object or as a &quot;normal&quot; attribute and is thus not support, hence &#39;</span>
                <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">` is rejected.&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__delattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remove_device</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The actual </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> object does not handle a &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_contentclass</span><span class="p">()</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> object named `</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">` which &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;could be removed, and deleting other attributes is not supported.&quot;</span>
            <span class="p">)</span> <span class="kn">from</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TypeDevice</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name2device</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No device named `</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">` available.&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">TypeDevice</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name2device</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name2device</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">TypeDevice</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">device</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_name2device</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">yield</span> <span class="n">device</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_contentclass</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">cls</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name2device</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name2device</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_name2device</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">TypeDevices</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Mayberable2</span><span class="p">[</span><span class="n">TypeDevice</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">TypeDevices</span><span class="p">:</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">new</span><span class="o">.</span><span class="n">mutable</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">other</span><span class="p">):</span>
            <span class="n">new</span><span class="o">.</span><span class="n">add_device</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new</span>

    <span class="k">def</span> <span class="fm">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">TypeDevices</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Mayberable2</span><span class="p">[</span><span class="n">TypeDevice</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">TypeDevices</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">other</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_device</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">TypeDevices</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Mayberable2</span><span class="p">[</span><span class="n">TypeDevice</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">TypeDevices</span><span class="p">:</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">new</span><span class="o">.</span><span class="n">mutable</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">other</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">new</span><span class="o">.</span><span class="n">remove_device</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">return</span> <span class="n">new</span>

    <span class="k">def</span> <span class="fm">__isub__</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">TypeDevices</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Mayberable2</span><span class="p">[</span><span class="n">TypeDevice</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">TypeDevices</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">other</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">remove_device</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__compare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">object</span><span class="p">,</span> <span class="nb">object</span><span class="p">],</span> <span class="nb">bool</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="nb">set</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>

    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">TypeDevices</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">TypeDevices</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__compare</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">lt</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">TypeDevices</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">TypeDevices</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__compare</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">le</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__compare</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">eq</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__compare</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">ne</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">TypeDevices</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">TypeDevices</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__compare</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">ge</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">TypeDevices</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">TypeDevices</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__compare</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">gt</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">assignrepr</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="Devices.assignrepr">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Devices.assignrepr">[docs]</a>
    <span class="k">def</span> <span class="nf">assignrepr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a |repr| string with a prefixed assignment.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">repr_</span><span class="o">.</span><span class="n">preserve_strings</span><span class="p">(</span><span class="kc">True</span><span class="p">):</span>
            <span class="n">options</span> <span class="o">=</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">options</span>
            <span class="k">with</span> <span class="n">options</span><span class="o">.</span><span class="n">ellipsis</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                <span class="n">prefix</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(&quot;</span>
                <span class="n">repr_</span> <span class="o">=</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">assignrepr_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">70</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">repr_</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span></div>


    <span class="k">def</span> <span class="fm">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import Node, Nodes</span>
<span class="sd">        &gt;&gt;&gt; nodes = Nodes(Node(&quot;name1&quot;, keywords=&quot;keyword1&quot;),</span>
<span class="sd">        ...               Node(&quot;name2&quot;, keywords=(&quot;keyword2a&quot;, &quot;keyword2a&quot;)))</span>
<span class="sd">        &gt;&gt;&gt; sorted(set(dir(nodes)) - set(object.__dir__(nodes)))</span>
<span class="sd">        [&#39;keyword1&#39;, &#39;keyword2a&#39;, &#39;name1&#39;, &#39;name2&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">cast</span><span class="p">(</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__dir__</span><span class="p">())</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keywords</span><span class="p">)</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="Nodes">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Nodes">[docs]</a>
<span class="k">class</span> <span class="nc">Nodes</span><span class="p">(</span><span class="n">Devices</span><span class="p">[</span><span class="s2">&quot;Node&quot;</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A container class for handling |Node| objects.</span>

<span class="sd">    For the general usage of |Nodes| objects, please see the documentation on its base</span>
<span class="sd">    class |Devices|.</span>

<span class="sd">    Class |Nodes| provides the additional keyword argument `defaultvariable`.  Use it</span>
<span class="sd">    to temporarily change the default variable &quot;Q&quot; to another value during the</span>
<span class="sd">    initialisation of new |Node| objects:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy import Nodes</span>
<span class="sd">    &gt;&gt;&gt; a1, t2 = Nodes(&quot;a1&quot;, &quot;a2&quot;, defaultvariable=&quot;A&quot;)</span>
<span class="sd">    &gt;&gt;&gt; a1</span>
<span class="sd">    Node(&quot;a1&quot;, variable=&quot;A&quot;)</span>

<span class="sd">    Be aware that changing the default variable does not affect already existing nodes:</span>

<span class="sd">    &gt;&gt;&gt; a1, b1 = Nodes(&quot;a1&quot;, &quot;b1&quot;, defaultvariable=&quot;B&quot;)</span>
<span class="sd">    &gt;&gt;&gt; a1</span>
<span class="sd">    Node(&quot;a1&quot;, variable=&quot;A&quot;)</span>
<span class="sd">    &gt;&gt;&gt; b1</span>
<span class="sd">    Node(&quot;b1&quot;, variable=&quot;B&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="o">*</span><span class="n">values</span><span class="p">:</span> <span class="n">MayNonerable2</span><span class="p">[</span><span class="n">Node</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">mutable</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">defaultvariable</span><span class="p">:</span> <span class="n">NodeVariableType</span> <span class="o">=</span> <span class="s2">&quot;Q&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Nodes</span><span class="p">:</span>
        <span class="k">global</span> <span class="n">_default_variable</span>
        <span class="n">_default_variable_copy</span> <span class="o">=</span> <span class="n">_default_variable</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_default_variable</span> <span class="o">=</span> <span class="n">defaultvariable</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">values</span><span class="p">,</span> <span class="n">mutable</span><span class="o">=</span><span class="n">mutable</span><span class="p">)</span>  <span class="c1"># type: ignore[return-value, arg-type]  # pylint: disable=line-too-long</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">_default_variable</span> <span class="o">=</span> <span class="n">_default_variable_copy</span>

<div class="viewcode-block" id="Nodes.get_contentclass">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Nodes.get_contentclass">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_contentclass</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Type</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return class |Node|.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Node</span></div>


<div class="viewcode-block" id="Nodes.prepare_allseries">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Nodes.prepare_allseries">[docs]</a>
    <span class="nd">@printtools</span><span class="o">.</span><span class="n">print_progress</span>
    <span class="k">def</span> <span class="nf">prepare_allseries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">allocate_ram</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">jit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call method |Node.prepare_allseries| of all handled |Node| objects.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">printtools</span><span class="o">.</span><span class="n">progressbar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">node</span><span class="o">.</span><span class="n">prepare_allseries</span><span class="p">(</span><span class="n">allocate_ram</span><span class="o">=</span><span class="n">allocate_ram</span><span class="p">,</span> <span class="n">jit</span><span class="o">=</span><span class="n">jit</span><span class="p">)</span></div>


<div class="viewcode-block" id="Nodes.prepare_simseries">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Nodes.prepare_simseries">[docs]</a>
    <span class="nd">@printtools</span><span class="o">.</span><span class="n">print_progress</span>
    <span class="k">def</span> <span class="nf">prepare_simseries</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">allocate_ram</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">read_jit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">write_jit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call method |Node.prepare_simseries| of all handled |Node| objects.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">printtools</span><span class="o">.</span><span class="n">progressbar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">node</span><span class="o">.</span><span class="n">prepare_simseries</span><span class="p">(</span>
                <span class="n">allocate_ram</span><span class="o">=</span><span class="n">allocate_ram</span><span class="p">,</span> <span class="n">read_jit</span><span class="o">=</span><span class="n">read_jit</span><span class="p">,</span> <span class="n">write_jit</span><span class="o">=</span><span class="n">write_jit</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="Nodes.prepare_obsseries">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Nodes.prepare_obsseries">[docs]</a>
    <span class="nd">@printtools</span><span class="o">.</span><span class="n">print_progress</span>
    <span class="k">def</span> <span class="nf">prepare_obsseries</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">allocate_ram</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">read_jit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">write_jit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call method |Node.prepare_obsseries| of all handled |Node| objects.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">printtools</span><span class="o">.</span><span class="n">progressbar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">node</span><span class="o">.</span><span class="n">prepare_obsseries</span><span class="p">(</span>
                <span class="n">allocate_ram</span><span class="o">=</span><span class="n">allocate_ram</span><span class="p">,</span> <span class="n">read_jit</span><span class="o">=</span><span class="n">read_jit</span><span class="p">,</span> <span class="n">write_jit</span><span class="o">=</span><span class="n">write_jit</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="Nodes.load_allseries">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Nodes.load_allseries">[docs]</a>
    <span class="nd">@printtools</span><span class="o">.</span><span class="n">print_progress</span>
    <span class="k">def</span> <span class="nf">load_allseries</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call methods |Nodes.load_simseries| and |Nodes.load_obsseries|.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_simseries</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_obsseries</span><span class="p">()</span></div>


<div class="viewcode-block" id="Nodes.load_simseries">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Nodes.load_simseries">[docs]</a>
    <span class="nd">@printtools</span><span class="o">.</span><span class="n">print_progress</span>
    <span class="k">def</span> <span class="nf">load_simseries</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call method |IOSequence.load_series| of all |Sim| objects with an activated</span>
<span class="sd">        |IOSequence.memoryflag|.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__load_nodeseries</span><span class="p">(</span><span class="s2">&quot;sim&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Nodes.load_obsseries">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Nodes.load_obsseries">[docs]</a>
    <span class="nd">@printtools</span><span class="o">.</span><span class="n">print_progress</span>
    <span class="k">def</span> <span class="nf">load_obsseries</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call method |IOSequence.load_series| of all |Obs| objects with an activated</span>
<span class="sd">        |IOSequence.memoryflag|.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__load_nodeseries</span><span class="p">(</span><span class="s2">&quot;obs&quot;</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">__load_nodeseries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seqname</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">printtools</span><span class="o">.</span><span class="n">progressbar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">node</span><span class="o">.</span><span class="n">sequences</span><span class="p">[</span><span class="n">seqname</span><span class="p">]</span><span class="o">.</span><span class="n">load_series</span><span class="p">()</span>

<div class="viewcode-block" id="Nodes.save_allseries">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Nodes.save_allseries">[docs]</a>
    <span class="nd">@printtools</span><span class="o">.</span><span class="n">print_progress</span>
    <span class="k">def</span> <span class="nf">save_allseries</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call methods |Nodes.save_simseries| and |Nodes.save_obsseries|.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_simseries</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_obsseries</span><span class="p">()</span></div>


<div class="viewcode-block" id="Nodes.save_simseries">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Nodes.save_simseries">[docs]</a>
    <span class="nd">@printtools</span><span class="o">.</span><span class="n">print_progress</span>
    <span class="k">def</span> <span class="nf">save_simseries</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call method |IOSequence.save_series| of all |Sim| objects with an activated</span>
<span class="sd">        |IOSequence.memoryflag|.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__save_nodeseries</span><span class="p">(</span><span class="s2">&quot;sim&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Nodes.save_obsseries">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Nodes.save_obsseries">[docs]</a>
    <span class="nd">@printtools</span><span class="o">.</span><span class="n">print_progress</span>
    <span class="k">def</span> <span class="nf">save_obsseries</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call method |IOSequence.save_series| of all |Obs| objects with an activated</span>
<span class="sd">        |IOSequence.memoryflag|.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__save_nodeseries</span><span class="p">(</span><span class="s2">&quot;obs&quot;</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">__save_nodeseries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seqname</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">printtools</span><span class="o">.</span><span class="n">progressbar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">seq</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">sequences</span><span class="p">[</span><span class="n">seqname</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">seq</span><span class="o">.</span><span class="n">ramflag</span><span class="p">:</span>
                <span class="n">seq</span><span class="o">.</span><span class="n">save_series</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">variables</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="n">NodeVariableType</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a set of the variables of all handled |Node| objects.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import Node, Nodes</span>
<span class="sd">        &gt;&gt;&gt; nodes = Nodes(Node(&quot;x1&quot;),</span>
<span class="sd">        ...               Node(&quot;x2&quot;, variable=&quot;Q&quot;),</span>
<span class="sd">        ...               Node(&quot;x3&quot;, variable=&quot;H&quot;))</span>
<span class="sd">        &gt;&gt;&gt; sorted(nodes.variables)</span>
<span class="sd">        [&#39;H&#39;, &#39;Q&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">node</span><span class="o">.</span><span class="n">variable</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">}</span></div>



<div class="viewcode-block" id="Elements">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Elements">[docs]</a>
<span class="k">class</span> <span class="nc">Elements</span><span class="p">(</span><span class="n">Devices</span><span class="p">[</span><span class="s2">&quot;Element&quot;</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A container for handling |Element| objects.</span>

<span class="sd">    For the general usage of |Elements| objects, please see the documentation on its</span>
<span class="sd">    base class |Devices|.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Elements.get_contentclass">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Elements.get_contentclass">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_contentclass</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Type</span><span class="p">[</span><span class="n">Element</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return class |Element|.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Element</span></div>


<div class="viewcode-block" id="Elements.prepare_models">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Elements.prepare_models">[docs]</a>
    <span class="nd">@printtools</span><span class="o">.</span><span class="n">print_progress</span>
    <span class="k">def</span> <span class="nf">prepare_models</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call method |Element.prepare_model| of all handle |Element| objects.</span>

<span class="sd">        We show, based on the `LahnH` example project, that method |Element.init_model|</span>
<span class="sd">        prepares the |Model| objects of all elements, including building the required</span>
<span class="sd">        connections and updating the derived parameters:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.examples import prepare_full_example_1</span>
<span class="sd">        &gt;&gt;&gt; prepare_full_example_1()</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import attrready, HydPy, pub, TestIO</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     hp = HydPy(&quot;LahnH&quot;)</span>
<span class="sd">        ...     pub.timegrids = &quot;1996-01-01&quot;, &quot;1996-02-01&quot;, &quot;1d&quot;</span>
<span class="sd">        ...     hp.prepare_network()</span>
<span class="sd">        ...     hp.prepare_models()</span>
<span class="sd">        &gt;&gt;&gt; hp.elements.land_dill.model.parameters.derived.dt</span>
<span class="sd">        dt(0.000833)</span>

<span class="sd">        Wrong control files result in error messages like the following:</span>

<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     with open(&quot;LahnH/control/default/land_dill.py&quot;, &quot;a&quot;) as file_:</span>
<span class="sd">        ...         _ = file_.write(&quot;zonetype(-1)&quot;)</span>
<span class="sd">        ...     hp.prepare_models()   # doctest: +ELLIPSIS</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        ValueError: While trying to initialise the model object of element \</span>
<span class="sd">`land_dill`, the following error occurred: While trying to load the control file \</span>
<span class="sd">`...land_dill.py`, the following error occurred: At least one value of parameter \</span>
<span class="sd">`zonetype` of element `?` is not valid.</span>

<span class="sd">        By default, missing control files result in exceptions:</span>

<span class="sd">        &gt;&gt;&gt; del hp.elements.land_dill.model</span>
<span class="sd">        &gt;&gt;&gt; import os</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     os.remove(&quot;LahnH/control/default/land_dill.py&quot;)</span>
<span class="sd">        ...     hp.prepare_models()   # doctest: +ELLIPSIS</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        FileNotFoundError: While trying to initialise the model object of element \</span>
<span class="sd">`land_dill`, the following error occurred: While trying to load the control file \</span>
<span class="sd">`...land_dill.py`, the following error occurred: ...</span>
<span class="sd">        &gt;&gt;&gt; attrready(hp.elements.land_dill, &quot;model&quot;)</span>
<span class="sd">        False</span>

<span class="sd">        When building new, still incomplete *HydPy* projects, this behaviour can be</span>
<span class="sd">        annoying.  After setting the option |Options.warnmissingcontrolfile| to |False|,</span>
<span class="sd">        missing control files result in a warning only:</span>

<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     with pub.options.warnmissingcontrolfile(True):</span>
<span class="sd">        ...         hp.prepare_models()</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        UserWarning: Due to a missing or no accessible control file, no model could \</span>
<span class="sd">be initialised for element `land_dill`</span>
<span class="sd">        &gt;&gt;&gt; attrready(hp.elements.land_dill, &quot;model&quot;)</span>
<span class="sd">        False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">printtools</span><span class="o">.</span><span class="n">progressbar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="n">element</span><span class="o">.</span><span class="n">prepare_model</span><span class="p">(</span><span class="n">clear_registry</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">controlmanager</span><span class="o">.</span><span class="n">clear_registry</span><span class="p">()</span></div>


<div class="viewcode-block" id="Elements.init_models">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Elements.init_models">[docs]</a>
    <span class="k">def</span> <span class="nf">init_models</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Deprecated: use method |Elements.prepare_models| instead.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import Elements</span>
<span class="sd">        &gt;&gt;&gt; from unittest import mock</span>
<span class="sd">        &gt;&gt;&gt; with mock.patch.object(Elements, &quot;prepare_models&quot;) as mocked:</span>
<span class="sd">        ...     elements = Elements()</span>
<span class="sd">        ...     elements.init_models()</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        hydpy.core.exceptiontools.HydPyDeprecationWarning: Method `init_models` of \</span>
<span class="sd">class `Elements` is deprecated.  Use method `prepare_models` instead.</span>
<span class="sd">        &gt;&gt;&gt; mocked.call_args_list</span>
<span class="sd">        [call()]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prepare_models</span><span class="p">()</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;Method `init_models` of class `Elements` is deprecated.  Use method &quot;</span>
            <span class="s2">&quot;`prepare_models` instead.&quot;</span><span class="p">,</span>
            <span class="n">exceptiontools</span><span class="o">.</span><span class="n">HydPyDeprecationWarning</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Elements.save_controls">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Elements.save_controls">[docs]</a>
    <span class="nd">@printtools</span><span class="o">.</span><span class="n">print_progress</span>
    <span class="k">def</span> <span class="nf">save_controls</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">parameterstep</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">timetools</span><span class="o">.</span><span class="n">PeriodConstrArg</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">simulationstep</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">timetools</span><span class="o">.</span><span class="n">PeriodConstrArg</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">auxfiler</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">auxfiletools</span><span class="o">.</span><span class="n">Auxfiler</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save the control parameters of the |Model| object handled by each |Element|</span>
<span class="sd">        object and eventually the ones handled by the given |Auxfiler| object.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">auxfiler</span><span class="p">:</span>
            <span class="n">auxfiler</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">parameterstep</span><span class="o">=</span><span class="n">parameterstep</span><span class="p">,</span> <span class="n">simulationstep</span><span class="o">=</span><span class="n">simulationstep</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">printtools</span><span class="o">.</span><span class="n">progressbar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">element</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">save_controls</span><span class="p">(</span>
                <span class="n">parameterstep</span><span class="o">=</span><span class="n">parameterstep</span><span class="p">,</span>
                <span class="n">simulationstep</span><span class="o">=</span><span class="n">simulationstep</span><span class="p">,</span>
                <span class="n">auxfiler</span><span class="o">=</span><span class="n">auxfiler</span><span class="p">,</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="Elements.load_conditions">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Elements.load_conditions">[docs]</a>
    <span class="nd">@printtools</span><span class="o">.</span><span class="n">print_progress</span>
    <span class="k">def</span> <span class="nf">load_conditions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save the initial conditions of the |Model| object handled by each |Element|</span>
<span class="sd">        object.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">printtools</span><span class="o">.</span><span class="n">progressbar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">element</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">load_conditions</span><span class="p">()</span></div>


<div class="viewcode-block" id="Elements.save_conditions">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Elements.save_conditions">[docs]</a>
    <span class="nd">@printtools</span><span class="o">.</span><span class="n">print_progress</span>
    <span class="k">def</span> <span class="nf">save_conditions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save the calculated conditions of the |Model| object handled by each</span>
<span class="sd">        |Element| object.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">printtools</span><span class="o">.</span><span class="n">progressbar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">element</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">save_conditions</span><span class="p">()</span></div>


<div class="viewcode-block" id="Elements.trim_conditions">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Elements.trim_conditions">[docs]</a>
    <span class="k">def</span> <span class="nf">trim_conditions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call method |Sequences.trim_conditions| of the |Sequences| object handled</span>
<span class="sd">        (indirectly) by each |Element| object.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">element</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">trim_conditions</span><span class="p">()</span></div>


<div class="viewcode-block" id="Elements.reset_conditions">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Elements.reset_conditions">[docs]</a>
    <span class="k">def</span> <span class="nf">reset_conditions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call method |Sequences.reset| of the |Sequences| object handled (indirectly)</span>
<span class="sd">        by each |Element| object.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">element</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">conditions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">hydpytools</span><span class="o">.</span><span class="n">ConditionsType</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A nested dictionary that contains the values of all |ConditionSequence|</span>
<span class="sd">        objects of all currently handled models.</span>

<span class="sd">        See the documentation on property |HydPy.conditions| for further information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">element</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">element</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">conditions</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">}</span>

    <span class="nd">@conditions</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">conditions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conditions</span><span class="p">:</span> <span class="n">hydpytools</span><span class="o">.</span><span class="n">ConditionsType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">subconditions</span> <span class="ow">in</span> <span class="n">conditions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">element</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="n">element</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">conditions</span> <span class="o">=</span> <span class="n">subconditions</span>

<div class="viewcode-block" id="Elements.prepare_allseries">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Elements.prepare_allseries">[docs]</a>
    <span class="nd">@printtools</span><span class="o">.</span><span class="n">print_progress</span>
    <span class="k">def</span> <span class="nf">prepare_allseries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">allocate_ram</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">jit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call method |Element.prepare_allseries| of all handled |Element| objects.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">printtools</span><span class="o">.</span><span class="n">progressbar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">element</span><span class="o">.</span><span class="n">prepare_allseries</span><span class="p">(</span><span class="n">allocate_ram</span><span class="o">=</span><span class="n">allocate_ram</span><span class="p">,</span> <span class="n">jit</span><span class="o">=</span><span class="n">jit</span><span class="p">)</span></div>


<div class="viewcode-block" id="Elements.prepare_inputseries">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Elements.prepare_inputseries">[docs]</a>
    <span class="nd">@printtools</span><span class="o">.</span><span class="n">print_progress</span>
    <span class="k">def</span> <span class="nf">prepare_inputseries</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">allocate_ram</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">read_jit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">write_jit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call method |Element.prepare_inputseries| of all handled |Element|</span>
<span class="sd">        objects.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">printtools</span><span class="o">.</span><span class="n">progressbar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">element</span><span class="o">.</span><span class="n">prepare_inputseries</span><span class="p">(</span>
                <span class="n">allocate_ram</span><span class="o">=</span><span class="n">allocate_ram</span><span class="p">,</span> <span class="n">read_jit</span><span class="o">=</span><span class="n">read_jit</span><span class="p">,</span> <span class="n">write_jit</span><span class="o">=</span><span class="n">write_jit</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="Elements.prepare_factorseries">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Elements.prepare_factorseries">[docs]</a>
    <span class="nd">@printtools</span><span class="o">.</span><span class="n">print_progress</span>
    <span class="k">def</span> <span class="nf">prepare_factorseries</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">allocate_ram</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">write_jit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call method |Element.prepare_factorseries| of all handled |Element|</span>
<span class="sd">        objects.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">printtools</span><span class="o">.</span><span class="n">progressbar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">element</span><span class="o">.</span><span class="n">prepare_factorseries</span><span class="p">(</span><span class="n">allocate_ram</span><span class="o">=</span><span class="n">allocate_ram</span><span class="p">,</span> <span class="n">write_jit</span><span class="o">=</span><span class="n">write_jit</span><span class="p">)</span></div>


<div class="viewcode-block" id="Elements.prepare_fluxseries">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Elements.prepare_fluxseries">[docs]</a>
    <span class="nd">@printtools</span><span class="o">.</span><span class="n">print_progress</span>
    <span class="k">def</span> <span class="nf">prepare_fluxseries</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">allocate_ram</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">write_jit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call method |Element.prepare_fluxseries| of all handled |Element| objects.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">printtools</span><span class="o">.</span><span class="n">progressbar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">element</span><span class="o">.</span><span class="n">prepare_fluxseries</span><span class="p">(</span><span class="n">allocate_ram</span><span class="o">=</span><span class="n">allocate_ram</span><span class="p">,</span> <span class="n">write_jit</span><span class="o">=</span><span class="n">write_jit</span><span class="p">)</span></div>


<div class="viewcode-block" id="Elements.prepare_stateseries">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Elements.prepare_stateseries">[docs]</a>
    <span class="nd">@printtools</span><span class="o">.</span><span class="n">print_progress</span>
    <span class="k">def</span> <span class="nf">prepare_stateseries</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">allocate_ram</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">write_jit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call method |Element.prepare_stateseries| of all handled |Element|</span>
<span class="sd">        objects.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">printtools</span><span class="o">.</span><span class="n">progressbar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">element</span><span class="o">.</span><span class="n">prepare_stateseries</span><span class="p">(</span><span class="n">allocate_ram</span><span class="o">=</span><span class="n">allocate_ram</span><span class="p">,</span> <span class="n">write_jit</span><span class="o">=</span><span class="n">write_jit</span><span class="p">)</span></div>


<div class="viewcode-block" id="Elements.load_allseries">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Elements.load_allseries">[docs]</a>
    <span class="nd">@printtools</span><span class="o">.</span><span class="n">print_progress</span>
    <span class="k">def</span> <span class="nf">load_allseries</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call methods |Elements.load_inputseries|, |Elements.load_factorseries|,</span>
<span class="sd">        |Elements.load_fluxseries|, and |Elements.load_stateseries|.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_inputseries</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_factorseries</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_fluxseries</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_stateseries</span><span class="p">()</span></div>


<div class="viewcode-block" id="Elements.load_inputseries">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Elements.load_inputseries">[docs]</a>
    <span class="nd">@printtools</span><span class="o">.</span><span class="n">print_progress</span>
    <span class="k">def</span> <span class="nf">load_inputseries</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call method |IOSequence.load_series| of all |InputSequence| objects with an</span>
<span class="sd">        activated |IOSequence.memoryflag|.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__load_modelseries</span><span class="p">(</span><span class="s2">&quot;inputs&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Elements.load_factorseries">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Elements.load_factorseries">[docs]</a>
    <span class="nd">@printtools</span><span class="o">.</span><span class="n">print_progress</span>
    <span class="k">def</span> <span class="nf">load_factorseries</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call method |IOSequence.load_series| of all |FactorSequence| objects with an</span>
<span class="sd">        activated |IOSequence.memoryflag|.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__load_modelseries</span><span class="p">(</span><span class="s2">&quot;factors&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Elements.load_fluxseries">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Elements.load_fluxseries">[docs]</a>
    <span class="nd">@printtools</span><span class="o">.</span><span class="n">print_progress</span>
    <span class="k">def</span> <span class="nf">load_fluxseries</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call method |IOSequence.load_series| of all |FluxSequence| objects with an</span>
<span class="sd">        activated |IOSequence.memoryflag|.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__load_modelseries</span><span class="p">(</span><span class="s2">&quot;fluxes&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Elements.load_stateseries">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Elements.load_stateseries">[docs]</a>
    <span class="nd">@printtools</span><span class="o">.</span><span class="n">print_progress</span>
    <span class="k">def</span> <span class="nf">load_stateseries</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call method |IOSequence.load_series| of all |StateSequence| objects with an</span>
<span class="sd">        activated |IOSequence.memoryflag|.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__load_modelseries</span><span class="p">(</span><span class="s2">&quot;states&quot;</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">__load_modelseries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name_subseqs</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">printtools</span><span class="o">.</span><span class="n">progressbar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">element</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="p">[</span><span class="n">name_subseqs</span><span class="p">]</span><span class="o">.</span><span class="n">load_series</span><span class="p">()</span>

<div class="viewcode-block" id="Elements.save_allseries">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Elements.save_allseries">[docs]</a>
    <span class="nd">@printtools</span><span class="o">.</span><span class="n">print_progress</span>
    <span class="k">def</span> <span class="nf">save_allseries</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call methods |Elements.save_inputseries|, |Elements.save_factorseries|,</span>
<span class="sd">        |Elements.save_fluxseries|, and |Elements.save_stateseries|.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_inputseries</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_factorseries</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_fluxseries</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_stateseries</span><span class="p">()</span></div>


<div class="viewcode-block" id="Elements.save_inputseries">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Elements.save_inputseries">[docs]</a>
    <span class="nd">@printtools</span><span class="o">.</span><span class="n">print_progress</span>
    <span class="k">def</span> <span class="nf">save_inputseries</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call method |IOSequence.save_series| of all |InputSequence| objects with an</span>
<span class="sd">        activated |IOSequence.memoryflag|.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__save_modelseries</span><span class="p">(</span><span class="s2">&quot;inputs&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Elements.save_factorseries">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Elements.save_factorseries">[docs]</a>
    <span class="nd">@printtools</span><span class="o">.</span><span class="n">print_progress</span>
    <span class="k">def</span> <span class="nf">save_factorseries</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call method |IOSequence.save_series| of all |FactorSequence| objects with an</span>
<span class="sd">        activated |IOSequence.memoryflag|.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__save_modelseries</span><span class="p">(</span><span class="s2">&quot;factors&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Elements.save_fluxseries">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Elements.save_fluxseries">[docs]</a>
    <span class="nd">@printtools</span><span class="o">.</span><span class="n">print_progress</span>
    <span class="k">def</span> <span class="nf">save_fluxseries</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call method |IOSequence.save_series| of all |FluxSequence| objects with an</span>
<span class="sd">        activated |IOSequence.memoryflag|.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__save_modelseries</span><span class="p">(</span><span class="s2">&quot;fluxes&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Elements.save_stateseries">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Elements.save_stateseries">[docs]</a>
    <span class="nd">@printtools</span><span class="o">.</span><span class="n">print_progress</span>
    <span class="k">def</span> <span class="nf">save_stateseries</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call method |IOSequence.save_series| of all |StateSequence| objects with an</span>
<span class="sd">        activated |IOSequence.memoryflag|.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__save_modelseries</span><span class="p">(</span><span class="s2">&quot;states&quot;</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">__save_modelseries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name_subseqs</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">printtools</span><span class="o">.</span><span class="n">progressbar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">element</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="p">[</span><span class="n">name_subseqs</span><span class="p">]</span><span class="o">.</span><span class="n">save_series</span><span class="p">()</span></div>



<div class="viewcode-block" id="Device">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Device">[docs]</a>
<span class="k">class</span> <span class="nc">Device</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for class |Element| and class |Node|.&quot;&quot;&quot;</span>

    <span class="n">_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">_keywords</span><span class="p">:</span> <span class="n">Keywords</span>

    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Device</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="nb">object</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Device</span><span class="p">:</span>
        <span class="c1"># pylint: disable=unused-argument</span>
        <span class="c1"># required for consistincy with __init__</span>
        <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">__check_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span> <span class="o">=</span> <span class="n">_registry</span><span class="p">[</span><span class="bp">cls</span><span class="p">][</span><span class="n">name</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="bp">self</span> <span class="o">=</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;new_instance&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_keywords</span> <span class="o">=</span> <span class="n">Keywords</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_keywords</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="bp">self</span>
            <span class="n">_id2devices</span><span class="p">[</span><span class="bp">self</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">_registry</span><span class="p">[</span><span class="bp">cls</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">_selection</span><span class="p">[</span><span class="bp">cls</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">_registry</span><span class="p">[</span><span class="bp">cls</span><span class="p">][</span><span class="n">name</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span>

<div class="viewcode-block" id="Device.get_handlerclass">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Device.get_handlerclass">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">get_handlerclass</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Type</span><span class="p">[</span><span class="n">Devices</span><span class="p">[</span><span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;To be overridden.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="Device.query_all">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Device.query_all">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">query_all</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Devices</span><span class="p">[</span><span class="n">Device</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all |Node| or |Element| objects initialised so far.</span>

<span class="sd">        See the main documentation on module |devicetools| for further information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_handlerclass</span><span class="p">()(</span><span class="o">*</span><span class="n">_registry</span><span class="p">[</span><span class="bp">cls</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span></div>


<div class="viewcode-block" id="Device.extract_new">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Device.extract_new">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">extract_new</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Devices</span><span class="p">[</span><span class="n">Device</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gather all &quot;new&quot; |Node| or |Element| objects.</span>

<span class="sd">        See the main documentation on module |devicetools| for further information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">devices</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_handlerclass</span><span class="p">()(</span><span class="o">*</span><span class="n">_selection</span><span class="p">[</span><span class="bp">cls</span><span class="p">])</span>
        <span class="n">_selection</span><span class="p">[</span><span class="bp">cls</span><span class="p">]</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">devices</span></div>


<div class="viewcode-block" id="Device.clear_all">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Device.clear_all">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">clear_all</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Clear the registry from all initialised |Node| or |Element| objects.</span>

<span class="sd">        See the main documentation on module |devicetools| for further information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_selection</span><span class="p">[</span><span class="bp">cls</span><span class="p">]</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">_registry</span><span class="p">[</span><span class="bp">cls</span><span class="p">]</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Name of the actual |Node| or |Element| object.</span>

<span class="sd">        Device names serve as identifiers, as explained in the main documentation on</span>
<span class="sd">        module |devicetools|. Hence, define them carefully:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import Node</span>
<span class="sd">        &gt;&gt;&gt; Node.clear_all()</span>
<span class="sd">        &gt;&gt;&gt; node1, node2 = Node(&quot;n1&quot;), Node(&quot;n2&quot;)</span>
<span class="sd">        &gt;&gt;&gt; node1 is Node(&quot;n1&quot;)</span>
<span class="sd">        True</span>
<span class="sd">        &gt;&gt;&gt; node1 is Node(&quot;n2&quot;)</span>
<span class="sd">        False</span>

<span class="sd">        Each device name must be a valid variable identifier (see function</span>
<span class="sd">        |valid_variable_identifier|) to allow for attribute access:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import Nodes</span>
<span class="sd">        &gt;&gt;&gt; nodes = Nodes(node1, &quot;n2&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nodes.n1</span>
<span class="sd">        Node(&quot;n1&quot;, variable=&quot;Q&quot;)</span>

<span class="sd">        Invalid variable identifiers result in errors like the following:</span>

<span class="sd">        &gt;&gt;&gt; node3 = Node(&quot;n 3&quot;)   # doctest: +ELLIPSIS</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        ValueError: While trying to initialize a `Node` object with value `n 3` of \</span>
<span class="sd">type `str`, the following error occurred: The given name string `n 3` does not define \</span>
<span class="sd">a valid variable identifier.  ...</span>

<span class="sd">        When you change the name of a device (only do this for a good reason), the</span>
<span class="sd">        corresponding keys of all related |Nodes| and |Elements| objects (as well as of</span>
<span class="sd">        the internal registry) change automatically:</span>

<span class="sd">        &gt;&gt;&gt; Node.query_all()</span>
<span class="sd">        Nodes(&quot;n1&quot;, &quot;n2&quot;)</span>
<span class="sd">        &gt;&gt;&gt; node1.name = &quot;n1a&quot;</span>
<span class="sd">        &gt;&gt;&gt; nodes</span>
<span class="sd">        Nodes(&quot;n1a&quot;, &quot;n2&quot;)</span>
<span class="sd">        &gt;&gt;&gt; Node.query_all()</span>
<span class="sd">        Nodes(&quot;n1a&quot;, &quot;n2&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>

    <span class="nd">@name</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__check_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">devices</span> <span class="ow">in</span> <span class="n">_id2devices</span><span class="p">[</span><span class="bp">self</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">devices</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
                <span class="k">del</span> <span class="n">devices</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">_registry</span><span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)][</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">_registry</span><span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)][</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">for</span> <span class="n">devices</span> <span class="ow">in</span> <span class="n">_id2devices</span><span class="p">[</span><span class="bp">self</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">devices</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">__check_name</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">objecttools</span><span class="o">.</span><span class="n">valid_variable_identifier</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">objecttools</span><span class="o">.</span><span class="n">augment_excmessage</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;While trying to initialize a `</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">` object with value &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">` of type `</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">`&quot;</span>
            <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">keywords</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Keywords</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Keywords describing the actual |Node| or |Element| object.</span>

<span class="sd">        The keywords are contained within a |Keywords| object:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import Node</span>
<span class="sd">        &gt;&gt;&gt; node = Node(&quot;n&quot;, keywords=&quot;word0&quot;)</span>
<span class="sd">        &gt;&gt;&gt; node.keywords</span>
<span class="sd">        Keywords(&quot;word0&quot;)</span>

<span class="sd">        Assigning new words does not overwrite already existing ones.  You are allowed</span>
<span class="sd">        to add them individually or within iterable objects:</span>

<span class="sd">        &gt;&gt;&gt; node.keywords = &quot;word1&quot;</span>
<span class="sd">        &gt;&gt;&gt; node.keywords = &quot;word2&quot;, &quot;word3&quot;</span>
<span class="sd">        &gt;&gt;&gt; node.keywords</span>
<span class="sd">        Keywords(&quot;word0&quot;, &quot;word1&quot;, &quot;word2&quot;, &quot;word3&quot;)</span>

<span class="sd">        Additionally, passing additional keywords to the constructor of class |Node| or</span>
<span class="sd">        |Element| works also fine:</span>

<span class="sd">        &gt;&gt;&gt; Node(&quot;n&quot;, keywords=(&quot;word3&quot;, &quot;word4&quot;, &quot;word5&quot;))</span>
<span class="sd">        Node(&quot;n&quot;, variable=&quot;Q&quot;,</span>
<span class="sd">             keywords=[&quot;word0&quot;, &quot;word1&quot;, &quot;word2&quot;, &quot;word3&quot;, &quot;word4&quot;, &quot;word5&quot;])</span>

<span class="sd">        You can delete all keywords at once:</span>

<span class="sd">        &gt;&gt;&gt; del node.keywords</span>
<span class="sd">        &gt;&gt;&gt; node.keywords</span>
<span class="sd">        Keywords()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_keywords</span>

    <span class="nd">@keywords</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">keywords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keywords</span><span class="p">:</span> <span class="n">Mayberable1</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">keywords</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">objecttools</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">keywords</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,),</span> <span class="kc">True</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_keywords</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">*</span><span class="n">keywords</span><span class="p">)</span>

    <span class="nd">@keywords</span><span class="o">.</span><span class="n">deleter</span>
    <span class="k">def</span> <span class="nf">keywords</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_keywords</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span></div>



<div class="viewcode-block" id="Node">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Node">[docs]</a>
<span class="k">class</span> <span class="nc">Node</span><span class="p">(</span><span class="n">Device</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;Handles the data flow between |Element| objects.</span>

<span class="sd">    |Node| objects always handle two sequences, a |Sim| object for simulated values and</span>
<span class="sd">    an |Obs| object for measured values:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy import Node</span>
<span class="sd">    &gt;&gt;&gt; node = Node(&quot;test&quot;)</span>
<span class="sd">    &gt;&gt;&gt; for sequence in node.sequences:</span>
<span class="sd">    ...     print(sequence)</span>
<span class="sd">    sim(0.0)</span>
<span class="sd">    obs(0.0)</span>

<span class="sd">    Each node can handle an arbitrary number of &quot;input&quot; and &quot;output&quot; elements,</span>
<span class="sd">    available as instance attributes `entries` and `exits`, respectively:</span>

<span class="sd">    &gt;&gt;&gt; node.entries</span>
<span class="sd">    Elements()</span>
<span class="sd">    &gt;&gt;&gt; node.exits</span>
<span class="sd">    Elements()</span>

<span class="sd">    You cannot (or at least should not) add new elements manually:</span>

<span class="sd">    &gt;&gt;&gt; node.entries = &quot;element&quot;  # doctest: +ELLIPSIS</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    AttributeError: ...</span>
<span class="sd">    &gt;&gt;&gt; node.exits.add_device(&quot;element&quot;)</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    RuntimeError: While trying to add the device `element` to a Elements object, the \</span>
<span class="sd">following error occurred: Adding devices to immutable Elements objects is not allowed.</span>

<span class="sd">    Instead, see the documentation on class |Element| on how to connect |Node| and</span>
<span class="sd">    |Element| objects properly.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">masks</span> <span class="o">=</span> <span class="n">masktools</span><span class="o">.</span><span class="n">NodeMasks</span><span class="p">()</span>
    <span class="n">sequences</span><span class="p">:</span> <span class="n">sequencetools</span><span class="o">.</span><span class="n">NodeSequences</span>

    <span class="n">_entries</span><span class="p">:</span> <span class="n">Elements</span>
    <span class="n">_exits</span><span class="p">:</span> <span class="n">Elements</span>
    <span class="n">_variable</span><span class="p">:</span> <span class="n">NodeVariableType</span>
    <span class="n">_deploymode</span><span class="p">:</span> <span class="n">DeployMode</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">value</span><span class="p">:</span> <span class="n">NodeConstrArg</span><span class="p">,</span>
        <span class="n">variable</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NodeVariableType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">keywords</span><span class="p">:</span> <span class="n">MayNonerable1</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># pylint: disable=unused-argument</span>
        <span class="c1"># required for consistincy with Device.__new__</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;new_instance&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">variable</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_variable</span> <span class="o">=</span> <span class="n">_default_variable</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_variable</span> <span class="o">=</span> <span class="n">variable</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span> <span class="o">=</span> <span class="n">Elements</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">mutable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_exits</span> <span class="o">=</span> <span class="n">Elements</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">mutable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sequences</span> <span class="o">=</span> <span class="n">sequencetools</span><span class="o">.</span><span class="n">NodeSequences</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_deploymode</span> <span class="o">=</span> <span class="s2">&quot;newsim&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__blackhole</span> <span class="o">=</span> <span class="n">pointerutils</span><span class="o">.</span><span class="n">Double</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="nb">delattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;new_instance&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">variable</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">variable</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variable</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The variable to be represented by a </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> instance &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;cannot be changed.  The variable of node `</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">` is &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">variable</span><span class="si">}</span><span class="s2">` instead of `</span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2">`.  Keep in mind, that &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;`name` is the unique identifier of node objects.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">keywords</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">keywords</span> <span class="o">=</span> <span class="n">keywords</span>  <span class="c1"># type: ignore</span>
            <span class="c1"># due to internal type conversion</span>
            <span class="c1"># see issue https://github.com/python/mypy/issues/3004</span>

<div class="viewcode-block" id="Node.get_handlerclass">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Node.get_handlerclass">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_handlerclass</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Type</span><span class="p">[</span><span class="n">Nodes</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return class |Nodes|.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Nodes</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">entries</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Elements</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Group of |Element| objects which set the the simulated value of the |Node|</span>
<span class="sd">        object.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">exits</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Elements</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Group of |Element| objects which query the simulated or observed value of</span>
<span class="sd">        the actual |Node| object.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exits</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">variable</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NodeVariableType</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The variable handled by the actual |Node| object.</span>

<span class="sd">        By default, we suppose that nodes route discharge:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import Node</span>
<span class="sd">        &gt;&gt;&gt; node = Node(&quot;test1&quot;)</span>
<span class="sd">        &gt;&gt;&gt; node.variable</span>
<span class="sd">        &#39;Q&#39;</span>

<span class="sd">        Each other string, as well as each |InputSequence| subclass, is acceptable (for</span>
<span class="sd">        further information, see the documentation on method |Model.connect|):</span>

<span class="sd">        &gt;&gt;&gt; Node(&quot;test2&quot;, variable=&quot;H&quot;)</span>
<span class="sd">        Node(&quot;test2&quot;, variable=&quot;H&quot;)</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland.hland_inputs import T</span>
<span class="sd">        &gt;&gt;&gt; Node(&quot;test3&quot;, variable=T)</span>
<span class="sd">        Node(&quot;test3&quot;, variable=hland_T)</span>

<span class="sd">        The last above example shows that the string representations of nodes handling</span>
<span class="sd">        &quot;class variables&quot; use the aliases importable from the top-level of the *HydPy*</span>
<span class="sd">        package:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.inputs import hland_P</span>
<span class="sd">        &gt;&gt;&gt; Node(&quot;test4&quot;, variable=hland_P)</span>
<span class="sd">        Node(&quot;test4&quot;, variable=hland_P)</span>

<span class="sd">        For some complex *HydPy* projects, one may need to fall back on |FusedVariable|</span>
<span class="sd">        objects.  The string representation then relies on the name of the fused</span>
<span class="sd">        variable:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import FusedVariable</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.inputs import lland_Nied</span>
<span class="sd">        &gt;&gt;&gt; Precipitation = FusedVariable(&quot;Precip&quot;, hland_P, lland_Nied)</span>
<span class="sd">        &gt;&gt;&gt; Node(&quot;test5&quot;, variable=Precipitation)</span>
<span class="sd">        Node(&quot;test5&quot;, variable=Precip)</span>

<span class="sd">        To avoid confusion, one cannot change |Node.variable|:</span>

<span class="sd">        &gt;&gt;&gt; node.variable = &quot;H&quot;  # doctest: +ELLIPSIS</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        AttributeError: ...</span>
<span class="sd">        &gt;&gt;&gt; Node(&quot;test1&quot;, variable=&quot;H&quot;)</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        ValueError: The variable to be represented by a Node instance cannot be \</span>
<span class="sd">changed.  The variable of node `test1` is `Q` instead of `H`.  Keep in mind, that \</span>
<span class="sd">`name` is the unique identifier of node objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_variable</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">deploymode</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DeployMode</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Defines the kind of information a node offers its exit elements.</span>

<span class="sd">        *HydPy* supports the following modes:</span>

<span class="sd">          * newsim: Deploy the simulated values calculated just recently.  `newsim` is</span>
<span class="sd">            the default mode, used, for example, when a node receives a discharge value</span>
<span class="sd">            from an upstream element and passes it to the downstream element directly.</span>
<span class="sd">          * obs: Deploy observed values instead of simulated values.  The node still</span>
<span class="sd">            receives the simulated values from its upstream element(s).  However, it</span>
<span class="sd">            deploys values to its downstream element(s), which are defined externally.</span>
<span class="sd">            Usually, these values are observations made available within a time-series</span>
<span class="sd">            file. See the documentation on module |sequencetools| for further</span>
<span class="sd">            information on file specifications.</span>
<span class="sd">          * oldsim: Similar to mode `obs`.  However, it is usually applied when a node</span>
<span class="sd">            is supposed to deploy simulated values that have been calculated in a</span>
<span class="sd">            previous simulation run and stored in a sequence file.</span>
<span class="sd">          * obs_newsim: Combination of mode `obs` and `newsim`.  Mode `obs_newsim`</span>
<span class="sd">            gives priority to the provision of observation values.  New simulation</span>
<span class="sd">            values serve as a replacement for missing observed values.</span>
<span class="sd">          * obs_oldsim: Combination of mode `obs` and `oldsim`.  Mode `obs_oldsim`</span>
<span class="sd">            gives priority to the provision of observation values.  Old simulation</span>
<span class="sd">            values serve as a replacement for missing observed values.</span>

<span class="sd">        One relevant difference between modes `obs` and `oldsim` is that the external</span>
<span class="sd">        values are either handled by the `obs` or the `sim` sequence object.  Hence,</span>
<span class="sd">        if you select the `oldsim` mode, the values of the upstream elements calculated</span>
<span class="sd">        within the current simulation are not available (e.g. for parameter calibration)</span>
<span class="sd">        after the simulation finishes.</span>

<span class="sd">        Please refer to the documentation on method |HydPy.simulate| of class |HydPy|,</span>
<span class="sd">        which provides some application examples.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import Node</span>
<span class="sd">        &gt;&gt;&gt; node = Node(&quot;test&quot;)</span>
<span class="sd">        &gt;&gt;&gt; node.deploymode</span>
<span class="sd">        &#39;newsim&#39;</span>
<span class="sd">        &gt;&gt;&gt; node.deploymode = &quot;obs&quot;</span>
<span class="sd">        &gt;&gt;&gt; node.deploymode</span>
<span class="sd">        &#39;obs&#39;</span>
<span class="sd">        &gt;&gt;&gt; node.deploymode = &quot;oldsim&quot;</span>
<span class="sd">        &gt;&gt;&gt; node.deploymode</span>
<span class="sd">        &#39;oldsim&#39;</span>
<span class="sd">        &gt;&gt;&gt; node.deploymode = &quot;obs_newsim&quot;</span>
<span class="sd">        &gt;&gt;&gt; node.deploymode</span>
<span class="sd">        &#39;obs_newsim&#39;</span>
<span class="sd">        &gt;&gt;&gt; node.deploymode = &quot;obs_oldsim&quot;</span>
<span class="sd">        &gt;&gt;&gt; node.deploymode</span>
<span class="sd">        &#39;obs_oldsim&#39;</span>
<span class="sd">        &gt;&gt;&gt; node.deploymode = &quot;newsim&quot;</span>
<span class="sd">        &gt;&gt;&gt; node.deploymode</span>
<span class="sd">        &#39;newsim&#39;</span>
<span class="sd">        &gt;&gt;&gt; node.deploymode = &quot;oldobs&quot;</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        ValueError: When trying to set the routing mode of node `test`, the value \</span>
<span class="sd">`oldobs` was given, but only the following values are allowed: `newsim`, `oldsim`, \</span>
<span class="sd">`obs`, `obs_newsim`, and `obs_oldsim`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deploymode</span>

    <span class="nd">@deploymode</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">deploymode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">DeployMode</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;oldsim&quot;</span><span class="p">,</span> <span class="s2">&quot;obs_oldsim&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__blackhole</span> <span class="o">=</span> <span class="n">pointerutils</span><span class="o">.</span><span class="n">Double</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;newsim&quot;</span><span class="p">,</span> <span class="s2">&quot;obs&quot;</span><span class="p">,</span> <span class="s2">&quot;obs_newsim&quot;</span><span class="p">,</span> <span class="s2">&quot;obs_oldsim&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;When trying to set the routing mode of node `</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">`, the &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;value `</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">` was given, but only the following values are &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;allowed: `newsim`, `oldsim`, `obs`, `obs_newsim`, and `obs_oldsim`.&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_deploymode</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">exits</span><span class="p">):</span>
            <span class="n">model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">]</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">exceptiontools</span><span class="o">.</span><span class="n">getattr_</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">model</span><span class="p">:</span>
                <span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>

<div class="viewcode-block" id="Node.get_double">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Node.get_double">[docs]</a>
    <span class="k">def</span> <span class="nf">get_double</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pointerutils</span><span class="o">.</span><span class="n">Double</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the |Double| object appropriate for the given |Element| input or</span>
<span class="sd">        output group and the actual |Node.deploymode|.</span>

<span class="sd">        Method |Node.get_double| should be of interest for framework developers only</span>
<span class="sd">        (and eventually for model developers).</span>

<span class="sd">        Let |Node| object `node1` handle different simulation and observation values:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import Node</span>
<span class="sd">        &gt;&gt;&gt; node = Node(&quot;node1&quot;)</span>
<span class="sd">        &gt;&gt;&gt; node.sequences.sim = 1.0</span>
<span class="sd">        &gt;&gt;&gt; node.sequences.obs = 2.0</span>

<span class="sd">        The following `test` function shows for a given |Node.deploymode| if method</span>
<span class="sd">        |Node.get_double| either returns the |Double| object handling the simulated</span>
<span class="sd">        value (1.0) or the |Double| object handling the observed value (2.0):</span>

<span class="sd">        &gt;&gt;&gt; def test(deploymode):</span>
<span class="sd">        ...     node.deploymode = deploymode</span>
<span class="sd">        ...     for group in (&quot;inlets&quot;, &quot;receivers&quot;, &quot;outlets&quot;, &quot;senders&quot;):</span>
<span class="sd">        ...         print(group, node.get_double(group))</span>

<span class="sd">        In the default mode, nodes (passively) route simulated values by offering the</span>
<span class="sd">        |Double| object of sequence |Sim| to all |Element| input and output groups:</span>

<span class="sd">        &gt;&gt;&gt; test(&quot;newsim&quot;)</span>
<span class="sd">        inlets 1.0</span>
<span class="sd">        receivers 1.0</span>
<span class="sd">        outlets 1.0</span>
<span class="sd">        senders 1.0</span>

<span class="sd">        Setting |Node.deploymode| to `obs` means that a node receives simulated values</span>
<span class="sd">        (from group `outlets` or `senders`) but provides observed values (to group</span>
<span class="sd">        `inlets` or `receivers`):</span>

<span class="sd">        &gt;&gt;&gt; test(&quot;obs&quot;)</span>
<span class="sd">        inlets 2.0</span>
<span class="sd">        receivers 2.0</span>
<span class="sd">        outlets 1.0</span>
<span class="sd">        senders 1.0</span>

<span class="sd">        With |Node.deploymode| set to `oldsim`, the node provides (previously)</span>
<span class="sd">        simulated values (to group `inlets` or `receivers`) but does not receive any</span>
<span class="sd">        values.  Method |Node.get_double| just returns a dummy |Double| object</span>
<span class="sd">        initialised to 0.0 in this case (for group `outlets` or `senders`):</span>

<span class="sd">        &gt;&gt;&gt; test(&quot;oldsim&quot;)</span>
<span class="sd">        inlets 1.0</span>
<span class="sd">        receivers 1.0</span>
<span class="sd">        outlets 0.0</span>
<span class="sd">        senders 0.0</span>

<span class="sd">        Other |Element| input or output groups are not supported:</span>

<span class="sd">        &gt;&gt;&gt; node.get_double(&quot;test&quot;)</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        ValueError: Function `get_double` of class `Node` does not support the given \</span>
<span class="sd">group name `test`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">group</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;inlets&quot;</span><span class="p">,</span> <span class="s2">&quot;receivers&quot;</span><span class="p">,</span> <span class="s2">&quot;inputs&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">deploymode</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;obs&quot;</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fastaccess</span><span class="o">.</span><span class="n">sim</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fastaccess</span><span class="o">.</span><span class="n">obs</span>
        <span class="k">if</span> <span class="n">group</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;outlets&quot;</span><span class="p">,</span> <span class="s2">&quot;senders&quot;</span><span class="p">,</span> <span class="s2">&quot;outputs&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">deploymode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;oldsim&quot;</span><span class="p">,</span> <span class="s2">&quot;obs_oldsim&quot;</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fastaccess</span><span class="o">.</span><span class="n">sim</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__blackhole</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Function `get_double` of class `Node` does not &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;support the given group name `</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">`.&quot;</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Node.reset">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Node.reset">[docs]</a>
    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reset the actual value of the simulation sequence to zero.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import Node</span>
<span class="sd">        &gt;&gt;&gt; node = Node(&quot;node1&quot;)</span>
<span class="sd">        &gt;&gt;&gt; node.sequences.sim = 1.0</span>
<span class="sd">        &gt;&gt;&gt; node.reset()</span>
<span class="sd">        &gt;&gt;&gt; node.sequences.sim</span>
<span class="sd">        sim(0.0)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fastaccess</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span></div>


<div class="viewcode-block" id="Node.prepare_allseries">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Node.prepare_allseries">[docs]</a>
    <span class="k">def</span> <span class="nf">prepare_allseries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">allocate_ram</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">jit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call method |Node.prepare_simseries| with `write_jit=jit` and method</span>
<span class="sd">        |Node.prepare_obsseries| with `read_jit=jit`.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prepare_simseries</span><span class="p">(</span><span class="n">allocate_ram</span><span class="o">=</span><span class="n">allocate_ram</span><span class="p">,</span> <span class="n">write_jit</span><span class="o">=</span><span class="n">jit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prepare_obsseries</span><span class="p">(</span><span class="n">allocate_ram</span><span class="o">=</span><span class="n">allocate_ram</span><span class="p">,</span> <span class="n">read_jit</span><span class="o">=</span><span class="n">jit</span><span class="p">)</span></div>


<div class="viewcode-block" id="Node.prepare_simseries">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Node.prepare_simseries">[docs]</a>
    <span class="k">def</span> <span class="nf">prepare_simseries</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">allocate_ram</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">read_jit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">write_jit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call method |IOSequence.prepare_series| of the |Sim| sequence object.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">prepare_series</span><span class="p">(</span>
            <span class="n">allocate_ram</span><span class="o">=</span><span class="n">allocate_ram</span><span class="p">,</span> <span class="n">read_jit</span><span class="o">=</span><span class="n">read_jit</span><span class="p">,</span> <span class="n">write_jit</span><span class="o">=</span><span class="n">write_jit</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Node.prepare_obsseries">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Node.prepare_obsseries">[docs]</a>
    <span class="k">def</span> <span class="nf">prepare_obsseries</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">allocate_ram</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">read_jit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">write_jit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call method |IOSequence.prepare_series| of the |Obs| sequence object.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">prepare_series</span><span class="p">(</span>
            <span class="n">allocate_ram</span><span class="o">=</span><span class="n">allocate_ram</span><span class="p">,</span> <span class="n">read_jit</span><span class="o">=</span><span class="n">read_jit</span><span class="p">,</span> <span class="n">write_jit</span><span class="o">=</span><span class="n">write_jit</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Node.plot_allseries">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Node.plot_allseries">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_allseries</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">labels</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">colors</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">linestyles</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">LineStyle</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">LineStyle</span><span class="p">,</span> <span class="n">LineStyle</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">linewidths</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">focus</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">stepsize</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">StepSize</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot the |IOSequence.series| data of both the |Sim| and the |Obs| sequence</span>
<span class="sd">        object.</span>

<span class="sd">        We demonstrate the functionalities of method |Node.plot_allseries| based on the</span>
<span class="sd">        `Lahn` example project:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.examples import prepare_full_example_2</span>
<span class="sd">        &gt;&gt;&gt; hp, pub, _ = prepare_full_example_2(lastdate=&quot;1997-01-01&quot;)</span>

<span class="sd">        We perform a simulation run and calculate &quot;observed&quot; values for node `dill`:</span>

<span class="sd">        &gt;&gt;&gt; hp.simulate()</span>
<span class="sd">        &gt;&gt;&gt; dill = hp.nodes.dill</span>
<span class="sd">        &gt;&gt;&gt; dill.sequences.obs.series = dill.sequences.sim.series + 10.0</span>

<span class="sd">        A call to method |Node.plot_allseries| prints the time-series of both sequences</span>
<span class="sd">        to the screen immediately (if not, you need to activate the interactive mode of</span>
<span class="sd">        `matplotlib` first):</span>

<span class="sd">        &gt;&gt;&gt; figure = dill.plot_allseries()</span>

<span class="sd">        Subsequent calls to |Node.plot_allseries| or the related methods</span>
<span class="sd">        |Node.plot_simseries| and |Node.plot_obsseries| of nodes add further</span>
<span class="sd">        time-series data to the existing plot:</span>

<span class="sd">        &gt;&gt;&gt; lahn_1 = hp.nodes.lahn_1</span>
<span class="sd">        &gt;&gt;&gt; figure = lahn_1.plot_simseries()</span>

<span class="sd">        You can modify the appearance of the lines by passing different arguments:</span>

<span class="sd">        &gt;&gt;&gt; lahn_1.sequences.obs.series = lahn_1.sequences.sim.series + 10.0</span>
<span class="sd">        &gt;&gt;&gt; figure = lahn_1.plot_obsseries(color=&quot;black&quot;, linestyle=&quot;dashed&quot;)</span>

<span class="sd">        All mentioned plotting functions return a |matplotlib| |figure.Figure| object.</span>
<span class="sd">        Use it for further plot handling, e.g. adding a title and saving the current</span>
<span class="sd">        figure to disk:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.core.testtools import save_autofig</span>
<span class="sd">        &gt;&gt;&gt; text = figure.axes[0].set_title(&#39;daily&#39;)</span>
<span class="sd">        &gt;&gt;&gt; save_autofig(&quot;Node_plot_allseries_1.png&quot;, figure)</span>

<span class="sd">        .. image:: Node_plot_allseries_1.png</span>

<span class="sd">        You can plot the data in an aggregated manner (see the documentation on the</span>
<span class="sd">        function |aggregate_series| for the supported step sizes and further details):</span>

<span class="sd">        &gt;&gt;&gt; figure = dill.plot_allseries(stepsize=&quot;monthly&quot;)</span>
<span class="sd">        &gt;&gt;&gt; text = figure.axes[0].set_title(&#39;monthly&#39;)</span>
<span class="sd">        &gt;&gt;&gt; save_autofig(&quot;Node_plot_allseries_2.png&quot;, figure)</span>

<span class="sd">        .. image:: Node_plot_allseries_2.png</span>

<span class="sd">        You can restrict the plotted period via the |Timegrids.eval_| |Timegrid| and</span>
<span class="sd">        overwrite the time-series label and other defaults via keyword arguments.</span>
<span class="sd">        For tuples passed to method |Node.plot_allseries|, the first entry corresponds</span>
<span class="sd">        to the observation and the second one to the simulation results:</span>

<span class="sd">        &gt;&gt;&gt; pub.timegrids.eval_.dates = &quot;1996-10-01&quot;, &quot;1996-11-01&quot;</span>
<span class="sd">        &gt;&gt;&gt; figure = lahn_1.plot_allseries(labels=(&quot;measured&quot;, &quot;calculated&quot;),</span>
<span class="sd">        ...                                colors=(&quot;blue&quot;, &quot;red&quot;),</span>
<span class="sd">        ...                                linewidths=2,</span>
<span class="sd">        ...                                linestyles=(&quot;--&quot;, &quot;:&quot;),</span>
<span class="sd">        ...                                focus=True,)</span>
<span class="sd">        &gt;&gt;&gt; save_autofig(&quot;Node_plot_allseries_3.png&quot;, figure)</span>

<span class="sd">        .. image:: Node_plot_allseries_3.png</span>

<span class="sd">        When necessary, all plotting methods raise errors like the following:</span>

<span class="sd">        &gt;&gt;&gt; figure = lahn_1.plot_allseries(stepsize=&quot;quaterly&quot;)</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        ValueError: While trying to plot the time series of sequence(s) obs and sim \</span>
<span class="sd">of node `lahn_1` for the period `1996-10-01 00:00:00` to `1996-11-01 00:00:00`, the \</span>
<span class="sd">following error occurred: While trying to aggregate the given series, the following \</span>
<span class="sd">error occurred: Argument `stepsize` received value `quaterly`, but only the following \</span>
<span class="sd">ones are supported: `monthly` (default) and `daily`.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">        &gt;&gt;&gt; figure = lahn_1.plot_allseries()</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        hydpy.core.exceptiontools.AttributeNotReady: While trying to plot the time \</span>
<span class="sd">series of sequence(s) obs and sim of node `lahn_1` , the following error occurred: \</span>
<span class="sd">Attribute timegrids of module `pub` is not defined at the moment.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">t</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">_make_tuple</span><span class="p">(</span>
            <span class="n">x</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="n">t</span><span class="p">]]],</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="n">t</span><span class="p">]]:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="p">((</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">)))</span> <span class="k">else</span> <span class="n">x</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_series</span><span class="p">(</span>
            <span class="n">sequences</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">obs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">sim</span><span class="p">),</span>
            <span class="n">labels</span><span class="o">=</span><span class="n">_make_tuple</span><span class="p">(</span><span class="n">labels</span><span class="p">),</span>
            <span class="n">colors</span><span class="o">=</span><span class="n">_make_tuple</span><span class="p">(</span><span class="n">colors</span><span class="p">),</span>
            <span class="n">linestyles</span><span class="o">=</span><span class="n">_make_tuple</span><span class="p">(</span><span class="n">linestyles</span><span class="p">),</span>
            <span class="n">linewidths</span><span class="o">=</span><span class="n">_make_tuple</span><span class="p">(</span><span class="n">linewidths</span><span class="p">),</span>
            <span class="n">focus</span><span class="o">=</span><span class="n">focus</span><span class="p">,</span>
            <span class="n">stepsize</span><span class="o">=</span><span class="n">stepsize</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Node.plot_simseries">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Node.plot_simseries">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_simseries</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">label</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">color</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">linestyle</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">LineStyle</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">focus</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">stepsize</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">StepSize</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot the |IOSequence.series| of the |Sim| sequence object.</span>

<span class="sd">        See method |Node.plot_allseries| for further information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_series</span><span class="p">(</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">sim</span><span class="p">],</span>
            <span class="n">labels</span><span class="o">=</span><span class="p">(</span><span class="n">label</span><span class="p">,),</span>
            <span class="n">colors</span><span class="o">=</span><span class="p">(</span><span class="n">color</span><span class="p">,),</span>
            <span class="n">linestyles</span><span class="o">=</span><span class="p">(</span><span class="n">linestyle</span><span class="p">,),</span>
            <span class="n">linewidths</span><span class="o">=</span><span class="p">(</span><span class="n">linewidth</span><span class="p">,),</span>
            <span class="n">focus</span><span class="o">=</span><span class="n">focus</span><span class="p">,</span>
            <span class="n">stepsize</span><span class="o">=</span><span class="n">stepsize</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Node.plot_obsseries">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Node.plot_obsseries">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_obsseries</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">label</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">color</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">linestyle</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">LineStyle</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">focus</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">stepsize</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">StepSize</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot the |IOSequence.series| of the |Obs| sequence object.</span>

<span class="sd">        See method |Node.plot_allseries| for further information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_series</span><span class="p">(</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">obs</span><span class="p">],</span>
            <span class="n">labels</span><span class="o">=</span><span class="p">(</span><span class="n">label</span><span class="p">,),</span>
            <span class="n">colors</span><span class="o">=</span><span class="p">(</span><span class="n">color</span><span class="p">,),</span>
            <span class="n">linestyles</span><span class="o">=</span><span class="p">(</span><span class="n">linestyle</span><span class="p">,),</span>
            <span class="n">linewidths</span><span class="o">=</span><span class="p">(</span><span class="n">linewidth</span><span class="p">,),</span>
            <span class="n">focus</span><span class="o">=</span><span class="n">focus</span><span class="p">,</span>
            <span class="n">stepsize</span><span class="o">=</span><span class="n">stepsize</span><span class="p">,</span>
        <span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">_plot_series</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">sequences</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">sequencetools</span><span class="o">.</span><span class="n">IOSequence</span><span class="p">],</span>
        <span class="n">labels</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
        <span class="n">colors</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
        <span class="n">linestyles</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
        <span class="n">linewidths</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span>
        <span class="n">focus</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">stepsize</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">StepSize</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">idx0</span><span class="p">,</span> <span class="n">idx1</span> <span class="o">=</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">timegrids</span><span class="o">.</span><span class="n">evalindices</span>
            <span class="k">for</span> <span class="n">sequence</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">linestyle</span><span class="p">,</span> <span class="n">linewidth</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                <span class="n">sequences</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">linestyles</span><span class="p">,</span> <span class="n">linewidths</span>
            <span class="p">):</span>
                <span class="n">label_</span> <span class="o">=</span> <span class="n">label</span> <span class="k">if</span> <span class="n">label</span> <span class="k">else</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">sequence</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">stepsize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="n">_get_pandasindex</span><span class="p">()</span>
                    <span class="n">ps</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">sequence</span><span class="o">.</span><span class="n">evalseries</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">[</span><span class="n">idx0</span><span class="p">:</span><span class="n">idx1</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ps</span> <span class="o">=</span> <span class="n">seriestools</span><span class="o">.</span><span class="n">aggregate_series</span><span class="p">(</span>
                        <span class="n">series</span><span class="o">=</span><span class="n">sequence</span><span class="o">.</span><span class="n">series</span><span class="p">,</span> <span class="n">stepsize</span><span class="o">=</span><span class="n">stepsize</span><span class="p">,</span> <span class="n">aggregator</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">mean</span>
                    <span class="p">)</span>
                    <span class="n">period</span> <span class="o">=</span> <span class="s2">&quot;15d&quot;</span> <span class="k">if</span> <span class="n">stepsize</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;m&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;12h&quot;</span>
                    <span class="n">ps</span><span class="o">.</span><span class="n">index</span> <span class="o">+=</span> <span class="n">timetools</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="n">period</span><span class="p">)</span><span class="o">.</span><span class="n">timedelta</span>
                    <span class="n">ps</span> <span class="o">=</span> <span class="n">ps</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;series&quot;</span><span class="p">:</span> <span class="n">label_</span><span class="p">})</span>
                <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">label_</span><span class="p">,</span> <span class="s2">&quot;ax&quot;</span><span class="p">:</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">gca</span><span class="p">()}</span>
                <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">color</span>
                <span class="k">if</span> <span class="n">linestyle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;linestyle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">linestyle</span>
                <span class="k">if</span> <span class="n">linewidth</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;linewidth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">linewidth</span>
                <span class="n">ps</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">pyplot</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">focus</span><span class="p">:</span>
                <span class="n">pyplot</span><span class="o">.</span><span class="n">ylim</span><span class="p">((</span><span class="mf">0.0</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">get_fignums</span><span class="p">():</span>
                <span class="n">variable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variable</span>
                <span class="k">if</span> <span class="n">variable</span> <span class="o">==</span> <span class="s2">&quot;Q&quot;</span><span class="p">:</span>
                    <span class="n">variable</span> <span class="o">=</span> <span class="s2">&quot;Q [mÂ³/s]&quot;</span>
                <span class="n">pyplot</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">variable</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">exceptiontools</span><span class="o">.</span><span class="n">attrready</span><span class="p">(</span><span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="p">,</span> <span class="s2">&quot;timegrids&quot;</span><span class="p">):</span>
                <span class="n">tg</span> <span class="o">=</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">timegrids</span><span class="o">.</span><span class="n">eval_</span>
                <span class="n">periodstring</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;for the period `</span><span class="si">{</span><span class="n">tg</span><span class="o">.</span><span class="n">firstdate</span><span class="si">}</span><span class="s2">` to `</span><span class="si">{</span><span class="n">tg</span><span class="o">.</span><span class="n">lastdate</span><span class="si">}</span><span class="s2">`&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">periodstring</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">objecttools</span><span class="o">.</span><span class="n">augment_excmessage</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;While trying to plot the time series of sequence(s) &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">enumeration</span><span class="p">(</span><span class="n">sequence</span><span class="o">.</span><span class="n">name</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">sequence</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">sequences</span><span class="p">)</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;of node `</span><span class="si">{</span><span class="n">objecttools</span><span class="o">.</span><span class="n">devicename</span><span class="p">(</span><span class="n">sequences</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="si">}</span><span class="s2">` </span><span class="si">{</span><span class="n">periodstring</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

<div class="viewcode-block" id="Node.assignrepr">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Node.assignrepr">[docs]</a>
    <span class="k">def</span> <span class="nf">assignrepr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a |repr| string with a prefixed assignment.&quot;&quot;&quot;</span>
        <span class="n">variable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variable</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">variable</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="n">FusedVariable</span><span class="p">):</span>
            <span class="n">variable</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">variable</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">variable</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">variable</span><span class="o">.</span><span class="vm">__module__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">variable</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s1">Node(&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&quot;, variable=</span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s1">,&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">keywords</span><span class="p">:</span>
            <span class="n">subprefix</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="s2">&quot; &quot;</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span><span class="o">+</span><span class="mi">5</span><span class="p">)</span><span class="si">}</span><span class="s1">keywords=&#39;</span>
            <span class="k">with</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">repr_</span><span class="o">.</span><span class="n">preserve_strings</span><span class="p">(</span><span class="kc">True</span><span class="p">):</span>
                <span class="k">with</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">assignrepr_tuple</span><span class="o">.</span><span class="n">always_bracketed</span><span class="p">(</span><span class="kc">False</span><span class="p">):</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">assignrepr_list</span><span class="p">(</span>
                        <span class="n">values</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keywords</span><span class="p">),</span> <span class="n">prefix</span><span class="o">=</span><span class="n">subprefix</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">70</span>
                    <span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">assignrepr</span><span class="p">()</span></div>



<div class="viewcode-block" id="Element">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Element">[docs]</a>
<span class="k">class</span> <span class="nc">Element</span><span class="p">(</span><span class="n">Device</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Handles a |Model| object and connects it to other models via</span>
<span class="sd">    |Node| objects.</span>

<span class="sd">    When preparing |Element| objects, one links them to nodes of different &quot;groups&quot;,</span>
<span class="sd">    each group of nodes implemented as an immutable |Nodes| object:</span>

<span class="sd">     * |Element.inlets| and |Element.outlets| nodes handle, for example, the inflow to</span>
<span class="sd">       and the outflow from the respective element.</span>
<span class="sd">     * |Element.receivers| and |Element.senders| nodes are thought for information flow</span>
<span class="sd">       between arbitrary elements, for example, to inform a |dam| model about the</span>
<span class="sd">       discharge at a gauge downstream.</span>
<span class="sd">     * |Element.inputs| nodes provide optional input information, for example,</span>
<span class="sd">       interpolated precipitation that could alternatively be read from files as well.</span>
<span class="sd">     * |Element.outputs| nodes query optional output information, for example, the</span>
<span class="sd">       water level of a dam.</span>

<span class="sd">    You can select the relevant nodes either by passing them explicitly or passing</span>
<span class="sd">    their name both as single objects or as objects contained within an iterable object:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy import Element, Node</span>
<span class="sd">    &gt;&gt;&gt; Element(&quot;test&quot;,</span>
<span class="sd">    ...         inlets=&quot;inl1&quot;,</span>
<span class="sd">    ...         outlets=Node(&quot;outl1&quot;),</span>
<span class="sd">    ...         receivers=(&quot;rec1&quot;, Node(&quot;rec2&quot;)))</span>
<span class="sd">    Element(&quot;test&quot;,</span>
<span class="sd">            inlets=&quot;inl1&quot;,</span>
<span class="sd">            outlets=&quot;outl1&quot;,</span>
<span class="sd">            receivers=[&quot;rec1&quot;, &quot;rec2&quot;])</span>

<span class="sd">    Repeating such a statement with different nodes adds them to the existing ones</span>
<span class="sd">    without any conflict in case of repeated specifications:</span>

<span class="sd">    &gt;&gt;&gt; Element(&quot;test&quot;,</span>
<span class="sd">    ...         inlets=&quot;inl1&quot;,</span>
<span class="sd">    ...         receivers=(&quot;rec2&quot;, &quot;rec3&quot;),</span>
<span class="sd">    ...         senders=&quot;sen1&quot;,</span>
<span class="sd">    ...         inputs=&quot;inp1&quot;,</span>
<span class="sd">    ...         outputs=&quot;outp1&quot;)</span>
<span class="sd">    Element(&quot;test&quot;,</span>
<span class="sd">            inlets=&quot;inl1&quot;,</span>
<span class="sd">            outlets=&quot;outl1&quot;,</span>
<span class="sd">            receivers=[&quot;rec1&quot;, &quot;rec2&quot;, &quot;rec3&quot;],</span>
<span class="sd">            senders=&quot;sen1&quot;,</span>
<span class="sd">            inputs=&quot;inp1&quot;,</span>
<span class="sd">            outputs=&quot;outp1&quot;)</span>

<span class="sd">    Subsequent adding of nodes also works via property access:</span>

<span class="sd">    &gt;&gt;&gt; test = Element(&quot;test&quot;)</span>
<span class="sd">    &gt;&gt;&gt; test.inlets = &quot;inl2&quot;</span>
<span class="sd">    &gt;&gt;&gt; test.outlets = None</span>
<span class="sd">    &gt;&gt;&gt; test.receivers = ()</span>
<span class="sd">    &gt;&gt;&gt; test.senders = &quot;sen2&quot;, Node(&quot;sen3&quot;)</span>
<span class="sd">    &gt;&gt;&gt; test.inputs = []</span>
<span class="sd">    &gt;&gt;&gt; test.outputs = Node(&quot;outp2&quot;)</span>
<span class="sd">    &gt;&gt;&gt; test</span>
<span class="sd">    Element(&quot;test&quot;,</span>
<span class="sd">            inlets=[&quot;inl1&quot;, &quot;inl2&quot;],</span>
<span class="sd">            outlets=&quot;outl1&quot;,</span>
<span class="sd">            receivers=[&quot;rec1&quot;, &quot;rec2&quot;, &quot;rec3&quot;],</span>
<span class="sd">            senders=[&quot;sen1&quot;, &quot;sen2&quot;, &quot;sen3&quot;],</span>
<span class="sd">            inputs=&quot;inp1&quot;,</span>
<span class="sd">            outputs=[&quot;outp1&quot;, &quot;outp2&quot;])</span>

<span class="sd">    The properties try to verify that all connections make sense.  For example, an</span>
<span class="sd">    element should never handle an `inlet` node that it also handles as an `outlet`,</span>
<span class="sd">    `input`, or `output` node:</span>

<span class="sd">    &gt;&gt;&gt; test.inlets = &quot;outl1&quot;</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ValueError: For element `test`, the given inlet node `outl1` is already defined \</span>
<span class="sd">as a(n) outlet node, which is not allowed.</span>

<span class="sd">    &gt;&gt;&gt; test.inlets = &quot;inp1&quot;</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ValueError: For element `test`, the given inlet node `inp1` is already defined as \</span>
<span class="sd">a(n) input node, which is not allowed.</span>

<span class="sd">    &gt;&gt;&gt; test.inlets = &quot;outp1&quot;</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ValueError: For element `test`, the given inlet node `outp1` is already defined \</span>
<span class="sd">as a(n) output node, which is not allowed.</span>

<span class="sd">    Similar holds for the `outlet` nodes:</span>

<span class="sd">    &gt;&gt;&gt; test.outlets = &quot;inl1&quot;</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ValueError: For element `test`, the given outlet node `inl1` is already defined \</span>
<span class="sd">as a(n) inlet node, which is not allowed.</span>

<span class="sd">    &gt;&gt;&gt; test.outlets = &quot;inp1&quot;</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ValueError: For element `test`, the given outlet node `inp1` is already defined \</span>
<span class="sd">as a(n) input node, which is not allowed.</span>

<span class="sd">    &gt;&gt;&gt; test.outlets = &quot;outp1&quot;</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ValueError: For element `test`, the given outlet node `outp1` is already defined \</span>
<span class="sd">as a(n) output node, which is not allowed.</span>

<span class="sd">    The following restrictions hold for the `sender` nodes:</span>

<span class="sd">    &gt;&gt;&gt; test.senders = &quot;rec1&quot;</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ValueError: For element `test`, the given sender node `rec1` is already defined \</span>
<span class="sd">as a(n) receiver node, which is not allowed.</span>

<span class="sd">    &gt;&gt;&gt; test.senders = &quot;inp1&quot;</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ValueError: For element `test`, the given sender node `inp1` is already defined \</span>
<span class="sd">as a(n) input node, which is not allowed.</span>

<span class="sd">    &gt;&gt;&gt; test.senders = &quot;outp1&quot;</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ValueError: For element `test`, the given sender node `outp1` is already defined \</span>
<span class="sd">as a(n) output node, which is not allowed.</span>

<span class="sd">    The following restrictions hold for the `receiver` nodes:</span>

<span class="sd">    &gt;&gt;&gt; test.receivers = &quot;sen1&quot;</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ValueError: For element `test`, the given receiver node `sen1` is already defined \</span>
<span class="sd">as a(n) sender node, which is not allowed.</span>

<span class="sd">    &gt;&gt;&gt; test.receivers = &quot;inp1&quot;</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ValueError: For element `test`, the given receiver node `inp1` is already defined \</span>
<span class="sd">as a(n) input node, which is not allowed.</span>

<span class="sd">    &gt;&gt;&gt; test.receivers = &quot;outp1&quot;</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ValueError: For element `test`, the given receiver node `outp1` is already \</span>
<span class="sd">defined as a(n) output node, which is not allowed.</span>

<span class="sd">    The following restrictions hold for the `input` nodes:</span>

<span class="sd">    &gt;&gt;&gt; test.inputs = &quot;outp1&quot;</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ValueError: For element `test`, the given input node `outp1` is already defined \</span>
<span class="sd">as a(n) output node, which is not allowed.</span>

<span class="sd">    &gt;&gt;&gt; test.inputs = &quot;inl1&quot;</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ValueError: For element `test`, the given input node `inl1` is already defined as \</span>
<span class="sd">a(n) inlet node, which is not allowed.</span>

<span class="sd">    &gt;&gt;&gt; test.inputs = &quot;outl1&quot;</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ValueError: For element `test`, the given input node `outl1` is already defined \</span>
<span class="sd">as a(n) outlet node, which is not allowed.</span>

<span class="sd">    &gt;&gt;&gt; test.inputs = &quot;sen1&quot;</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ValueError: For element `test`, the given input node `sen1` is already defined as \</span>
<span class="sd">a(n) sender node, which is not allowed.</span>

<span class="sd">    &gt;&gt;&gt; test.inputs = &quot;rec1&quot;</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ValueError: For element `test`, the given input node `rec1` is already defined as \</span>
<span class="sd">a(n) receiver node, which is not allowed.</span>

<span class="sd">   The following restrictions hold for the `output` nodes:</span>

<span class="sd">    &gt;&gt;&gt; test.outputs = &quot;inp1&quot;</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ValueError: For element `test`, the given output node `inp1` is already defined \</span>
<span class="sd">as a(n) input node, which is not allowed.</span>

<span class="sd">    &gt;&gt;&gt; test.outputs = &quot;inl1&quot;</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ValueError: For element `test`, the given output node `inl1` is already defined \</span>
<span class="sd">as a(n) inlet node, which is not allowed.</span>

<span class="sd">    &gt;&gt;&gt; test.outputs = &quot;outl1&quot;</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ValueError: For element `test`, the given output node `outl1` is already defined \</span>
<span class="sd">as a(n) outlet node, which is not allowed.</span>

<span class="sd">    &gt;&gt;&gt; test.outputs = &quot;sen1&quot;</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ValueError: For element `test`, the given output node `sen1` is already defined \</span>
<span class="sd">as a(n) sender node, which is not allowed.</span>

<span class="sd">    &gt;&gt;&gt; test.outputs = &quot;rec1&quot;</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ValueError: For element `test`, the given output node `rec1` is already defined \</span>
<span class="sd">as a(n) receiver node, which is not allowed.</span>

<span class="sd">    Note that the discussed |Nodes| objects are immutable by default, disallowing to</span>
<span class="sd">    change them in other ways as described above:</span>

<span class="sd">    &gt;&gt;&gt; test.inlets += &quot;inl3&quot;</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    RuntimeError: While trying to add the device `inl3` to a Nodes object, the \</span>
<span class="sd">following error occurred: Adding devices to immutable Nodes objects is not allowed.</span>

<span class="sd">    Setting their `mutable` flag to |True| changes this behaviour:</span>

<span class="sd">    &gt;&gt;&gt; test.inlets.mutable = True</span>
<span class="sd">    &gt;&gt;&gt; test.inlets.add_device(&quot;inl3&quot;)</span>

<span class="sd">    However, it is up to you to make sure that the added node also handles the relevant</span>
<span class="sd">    element in the suitable group.  In the discussed example, only node `inl2` has been</span>
<span class="sd">    added properly but not node `inl3`:</span>

<span class="sd">    &gt;&gt;&gt; test.inlets.inl2.exits</span>
<span class="sd">    Elements(&quot;test&quot;)</span>
<span class="sd">    &gt;&gt;&gt; test.inlets.inl3.exits</span>
<span class="sd">    Elements()</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_inlets</span><span class="p">:</span> <span class="n">Nodes</span>
    <span class="n">_outlets</span><span class="p">:</span> <span class="n">Nodes</span>
    <span class="n">_receivers</span><span class="p">:</span> <span class="n">Nodes</span>
    <span class="n">_senders</span><span class="p">:</span> <span class="n">Nodes</span>
    <span class="n">_inputs</span><span class="p">:</span> <span class="n">Nodes</span>
    <span class="n">_outputs</span><span class="p">:</span> <span class="n">Nodes</span>
    <span class="n">_model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">value</span><span class="p">:</span> <span class="n">ElementConstrArg</span><span class="p">,</span>
        <span class="n">inlets</span><span class="p">:</span> <span class="n">NodesConstrArg</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">outlets</span><span class="p">:</span> <span class="n">NodesConstrArg</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">receivers</span><span class="p">:</span> <span class="n">NodesConstrArg</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">senders</span><span class="p">:</span> <span class="n">NodesConstrArg</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">inputs</span><span class="p">:</span> <span class="n">NodesConstrArg</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">outputs</span><span class="p">:</span> <span class="n">NodesConstrArg</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">keywords</span><span class="p">:</span> <span class="n">MayNonerable1</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># pylint: disable=unused-argument</span>
        <span class="c1"># required for consistincy with Device.__new__</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;new_instance&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_inlets</span> <span class="o">=</span> <span class="n">Nodes</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_outlets</span> <span class="o">=</span> <span class="n">Nodes</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_receivers</span> <span class="o">=</span> <span class="n">Nodes</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_senders</span> <span class="o">=</span> <span class="n">Nodes</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_inputs</span> <span class="o">=</span> <span class="n">Nodes</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_outputs</span> <span class="o">=</span> <span class="n">Nodes</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__connections</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">inlets</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outlets</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">receivers</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">senders</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="nb">delattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;new_instance&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keywords</span> <span class="o">=</span> <span class="n">keywords</span>  <span class="c1"># type: ignore</span>
        <span class="k">if</span> <span class="n">inlets</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inlets</span> <span class="o">=</span> <span class="n">inlets</span>  <span class="c1"># type: ignore</span>
        <span class="k">if</span> <span class="n">outlets</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">outlets</span> <span class="o">=</span> <span class="n">outlets</span>  <span class="c1"># type: ignore</span>
        <span class="k">if</span> <span class="n">receivers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">receivers</span> <span class="o">=</span> <span class="n">receivers</span>  <span class="c1"># type: ignore</span>
        <span class="k">if</span> <span class="n">senders</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">senders</span> <span class="o">=</span> <span class="n">senders</span>  <span class="c1"># type: ignore</span>
        <span class="k">if</span> <span class="n">inputs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="o">=</span> <span class="n">inputs</span>  <span class="c1"># type: ignore</span>
        <span class="k">if</span> <span class="n">outputs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span> <span class="o">=</span> <span class="n">outputs</span>  <span class="c1"># type: ignore</span>
        <span class="c1"># due to internal type conversion</span>
        <span class="c1"># see issue https://github.com/python/mypy/issues/3004</span>

    <span class="k">def</span> <span class="nf">__update_group</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">values</span><span class="p">:</span> <span class="n">NodesConstrArg</span><span class="p">,</span>
        <span class="n">targetnodes</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">targetelements</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">incompatiblenodes</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">elementgroup</span><span class="p">:</span> <span class="n">Nodes</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">targetnodes</span><span class="p">)</span>
        <span class="n">elementtargetmutable</span> <span class="o">=</span> <span class="n">elementgroup</span><span class="o">.</span><span class="n">mutable</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">elementgroup</span><span class="o">.</span><span class="n">mutable</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">Nodes</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">incomp</span> <span class="ow">in</span> <span class="n">incompatiblenodes</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">incomp</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;For element `</span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">`, the given </span><span class="si">{</span><span class="n">targetnodes</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> node &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">` is already defined as a(n) </span><span class="si">{</span><span class="n">incomp</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> node, &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;which is not allowed.&quot;</span>
                        <span class="p">)</span>
                <span class="n">elementgroup</span><span class="o">.</span><span class="n">add_device</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                <span class="n">nodegroup</span><span class="p">:</span> <span class="n">Elements</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">targetelements</span><span class="p">)</span>
                <span class="n">nodegroupmutable</span> <span class="o">=</span> <span class="n">nodegroup</span><span class="o">.</span><span class="n">mutable</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">nodegroup</span><span class="o">.</span><span class="n">mutable</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">nodegroup</span><span class="o">.</span><span class="n">add_device</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="k">finally</span><span class="p">:</span>
                    <span class="n">nodegroup</span><span class="o">.</span><span class="n">mutable</span> <span class="o">=</span> <span class="n">nodegroupmutable</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">elementgroup</span><span class="o">.</span><span class="n">mutable</span> <span class="o">=</span> <span class="n">elementtargetmutable</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">inlets</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Nodes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Group of |Node| objects from which the handled |Model| object queries its</span>
<span class="sd">        &quot;upstream&quot; input values (e.g. inflow).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inlets</span>

    <span class="nd">@inlets</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">inlets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">NodesConstrArg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__update_group</span><span class="p">(</span>
            <span class="n">values</span><span class="p">,</span>
            <span class="n">targetnodes</span><span class="o">=</span><span class="s2">&quot;_inlets&quot;</span><span class="p">,</span>
            <span class="n">targetelements</span><span class="o">=</span><span class="s2">&quot;_exits&quot;</span><span class="p">,</span>
            <span class="n">incompatiblenodes</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;_outlets&quot;</span><span class="p">,</span> <span class="s2">&quot;_inputs&quot;</span><span class="p">,</span> <span class="s2">&quot;_outputs&quot;</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">outlets</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Nodes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Group of |Node| objects to which the handled |Model| object passes its</span>
<span class="sd">        &quot;downstream&quot; output values (e.g. outflow).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outlets</span>

    <span class="nd">@outlets</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">outlets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">NodesConstrArg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__update_group</span><span class="p">(</span>
            <span class="n">values</span><span class="p">,</span>
            <span class="n">targetnodes</span><span class="o">=</span><span class="s2">&quot;_outlets&quot;</span><span class="p">,</span>
            <span class="n">targetelements</span><span class="o">=</span><span class="s2">&quot;_entries&quot;</span><span class="p">,</span>
            <span class="n">incompatiblenodes</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;_inlets&quot;</span><span class="p">,</span> <span class="s2">&quot;_inputs&quot;</span><span class="p">,</span> <span class="s2">&quot;_outputs&quot;</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">receivers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Nodes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Group of |Node| objects from which the handled |Model| object queries its</span>
<span class="sd">        &quot;remote&quot; information values (e.g. discharge at a remote downstream).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_receivers</span>

    <span class="nd">@receivers</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">receivers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">NodesConstrArg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__update_group</span><span class="p">(</span>
            <span class="n">values</span><span class="p">,</span>
            <span class="n">targetnodes</span><span class="o">=</span><span class="s2">&quot;_receivers&quot;</span><span class="p">,</span>
            <span class="n">targetelements</span><span class="o">=</span><span class="s2">&quot;_exits&quot;</span><span class="p">,</span>
            <span class="n">incompatiblenodes</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;_senders&quot;</span><span class="p">,</span> <span class="s2">&quot;_inputs&quot;</span><span class="p">,</span> <span class="s2">&quot;_outputs&quot;</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">senders</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Nodes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Group of |Node| objects to which the handled |Model| object passes its</span>
<span class="sd">        &quot;remote&quot; information values (e.g. water level of a |dam| model).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_senders</span>

    <span class="nd">@senders</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">senders</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">NodesConstrArg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__update_group</span><span class="p">(</span>
            <span class="n">values</span><span class="p">,</span>
            <span class="n">targetnodes</span><span class="o">=</span><span class="s2">&quot;_senders&quot;</span><span class="p">,</span>
            <span class="n">targetelements</span><span class="o">=</span><span class="s2">&quot;_entries&quot;</span><span class="p">,</span>
            <span class="n">incompatiblenodes</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;_receivers&quot;</span><span class="p">,</span> <span class="s2">&quot;_inputs&quot;</span><span class="p">,</span> <span class="s2">&quot;_outputs&quot;</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Nodes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Group of |Node| objects from which the handled |Model| object queries its</span>
<span class="sd">        &quot;external&quot; input values, instead of reading them from files (e.g. interpolated</span>
<span class="sd">        precipitation).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inputs</span>

    <span class="nd">@inputs</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">NodesConstrArg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__update_group</span><span class="p">(</span>
            <span class="n">values</span><span class="p">,</span>
            <span class="n">targetnodes</span><span class="o">=</span><span class="s2">&quot;_inputs&quot;</span><span class="p">,</span>
            <span class="n">targetelements</span><span class="o">=</span><span class="s2">&quot;_exits&quot;</span><span class="p">,</span>
            <span class="n">incompatiblenodes</span><span class="o">=</span><span class="p">(</span>
                <span class="s2">&quot;_inlets&quot;</span><span class="p">,</span>
                <span class="s2">&quot;_outlets&quot;</span><span class="p">,</span>
                <span class="s2">&quot;_senders&quot;</span><span class="p">,</span>
                <span class="s2">&quot;_receivers&quot;</span><span class="p">,</span>
                <span class="s2">&quot;_outputs&quot;</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Nodes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Group of |Node| objects to which the handled |Model| object passes its</span>
<span class="sd">        &quot;internal&quot; output values, available via sequences of type |FluxSequence| or</span>
<span class="sd">        |StateSequence| (e.g. potential evaporation).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outputs</span>

    <span class="nd">@outputs</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">NodesConstrArg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__update_group</span><span class="p">(</span>
            <span class="n">values</span><span class="p">,</span>
            <span class="n">targetnodes</span><span class="o">=</span><span class="s2">&quot;_outputs&quot;</span><span class="p">,</span>
            <span class="n">targetelements</span><span class="o">=</span><span class="s2">&quot;_entries&quot;</span><span class="p">,</span>
            <span class="n">incompatiblenodes</span><span class="o">=</span><span class="p">(</span>
                <span class="s2">&quot;_inlets&quot;</span><span class="p">,</span>
                <span class="s2">&quot;_outlets&quot;</span><span class="p">,</span>
                <span class="s2">&quot;_senders&quot;</span><span class="p">,</span>
                <span class="s2">&quot;_receivers&quot;</span><span class="p">,</span>
                <span class="s2">&quot;_inputs&quot;</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

<div class="viewcode-block" id="Element.get_handlerclass">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Element.get_handlerclass">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_handlerclass</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Type</span><span class="p">[</span><span class="n">Elements</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return class |Elements|.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Elements</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The |Model| object handled by the actual |Element| object.</span>

<span class="sd">        Directly after their initialisation, elements do not know which model they</span>
<span class="sd">        require:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import attrready, Element</span>
<span class="sd">        &gt;&gt;&gt; hland = Element(&quot;hland&quot;, outlets=&quot;outlet&quot;)</span>
<span class="sd">        &gt;&gt;&gt; hland.model</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        hydpy.core.exceptiontools.AttributeNotReady: The model object of element \</span>
<span class="sd">`hland` has been requested but not been prepared so far.</span>

<span class="sd">        During scripting and when working interactively in the Python shell, it is</span>
<span class="sd">        often convenient to assign a |model| directly.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.hland_v1 import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep(&quot;1d&quot;)</span>
<span class="sd">        &gt;&gt;&gt; hland.model = model</span>
<span class="sd">        &gt;&gt;&gt; hland.model.name</span>
<span class="sd">        &#39;hland_v1&#39;</span>

<span class="sd">        &gt;&gt;&gt; del hland.model</span>
<span class="sd">        &gt;&gt;&gt; attrready(hland, &quot;model&quot;)</span>
<span class="sd">        False</span>

<span class="sd">        For the &quot;usual&quot; approach to prepare models, please see the method</span>
<span class="sd">        |Element.prepare_model|.</span>

<span class="sd">        The following examples show that assigning |Model| objects to property</span>
<span class="sd">        |Element.model| creates some connection required by the respective model type</span>
<span class="sd">        automatically.  These examples should be relevant for developers only.</span>

<span class="sd">        The following |hbranch| model branches a single input value (from to node</span>
<span class="sd">        `inp`) to multiple outputs (nodes `out1` and `out2`):</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import Element, Node, reverse_model_wildcard_import, pub</span>
<span class="sd">        &gt;&gt;&gt; reverse_model_wildcard_import()</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &quot;2000-01-01&quot;, &quot;2000-01-02&quot;, &quot;1d&quot;</span>
<span class="sd">        &gt;&gt;&gt; element = Element(&quot;a_branch&quot;,</span>
<span class="sd">        ...                   inlets=&quot;branch_input&quot;,</span>
<span class="sd">        ...                   outlets=(&quot;branch_output_1&quot;, &quot;branch_output_2&quot;))</span>
<span class="sd">        &gt;&gt;&gt; inp = element.inlets.branch_input</span>
<span class="sd">        &gt;&gt;&gt; out1, out2 = element.outlets</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models.hbranch import *</span>
<span class="sd">        &gt;&gt;&gt; parameterstep()</span>
<span class="sd">        &gt;&gt;&gt; delta(0.0)</span>
<span class="sd">        &gt;&gt;&gt; minimum(0.0)</span>
<span class="sd">        &gt;&gt;&gt; xpoints(0.0, 3.0)</span>
<span class="sd">        &gt;&gt;&gt; ypoints(branch_output_1=[0.0, 1.0], branch_output_2=[0.0, 2.0])</span>
<span class="sd">        &gt;&gt;&gt; parameters.update()</span>
<span class="sd">        &gt;&gt;&gt; element.model = model</span>

<span class="sd">        To show that the inlet and outlet connections are built properly, we assign a</span>
<span class="sd">        new value to the inlet node `inp` and verify that the suitable fractions of</span>
<span class="sd">        this value are passed to the outlet nodes out1` and `out2` by calling the</span>
<span class="sd">        method |Model.simulate|:</span>

<span class="sd">        &gt;&gt;&gt; inp.sequences.sim = 999.0</span>
<span class="sd">        &gt;&gt;&gt; model.simulate(0)</span>
<span class="sd">        &gt;&gt;&gt; fluxes.originalinput</span>
<span class="sd">        originalinput(999.0)</span>
<span class="sd">        &gt;&gt;&gt; out1.sequences.sim</span>
<span class="sd">        sim(333.0)</span>
<span class="sd">        &gt;&gt;&gt; out2.sequences.sim</span>
<span class="sd">        sim(666.0)</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; del pub.timegrids</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span>
        <span class="k">if</span> <span class="n">model</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">model</span>
        <span class="k">raise</span> <span class="n">exceptiontools</span><span class="o">.</span><span class="n">AttributeNotReady</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;The model object of element `</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">` has &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;been requested but not been prepared so far.&quot;</span>
        <span class="p">)</span>

    <span class="nd">@model</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">modeltools</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">model</span>
        <span class="n">model</span><span class="o">.</span><span class="n">element</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>

    <span class="nd">@model</span><span class="o">.</span><span class="n">deleter</span>
    <span class="k">def</span> <span class="nf">model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="Element.prepare_model">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Element.prepare_model">[docs]</a>
    <span class="k">def</span> <span class="nf">prepare_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clear_registry</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load the control file of the actual |Element| object, initialise its |Model|</span>
<span class="sd">        object, build the required connections via (an eventually overridden version</span>
<span class="sd">        of) method |Model.connect| of class |Model|, and update its  derived parameter</span>
<span class="sd">        values via calling (an eventually overridden version) of method</span>
<span class="sd">        |Parameters.update| of class |Parameters|.</span>

<span class="sd">        See method |HydPy.prepare_models| of class |HydPy| and property |model| of</span>
<span class="sd">        class |Element| fur further information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">options</span> <span class="o">=</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">options</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">timegrids</span>
            <span class="k">except</span> <span class="n">exceptiontools</span><span class="o">.</span><span class="n">AttributeNotReady</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">exceptiontools</span><span class="o">.</span><span class="n">AttributeNotReady</span><span class="p">(</span>
                    <span class="s2">&quot;The initialisation period has not been defined via attribute &quot;</span>
                    <span class="s2">&quot;`timegrids` of module `pub` yet but might be required to prepare &quot;</span>
                    <span class="s2">&quot;the model properly.&quot;</span>
                <span class="p">)</span> <span class="kn">from</span> <span class="kc">None</span>
            <span class="k">with</span> <span class="n">options</span><span class="o">.</span><span class="n">warnsimulationstep</span><span class="p">(</span><span class="kc">False</span><span class="p">):</span>
                <span class="n">info</span> <span class="o">=</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">controlmanager</span><span class="o">.</span><span class="n">load_file</span><span class="p">(</span>
                    <span class="n">element</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">clear_registry</span><span class="o">=</span><span class="n">clear_registry</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">warnmissingcontrolfile</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Due to a missing or no accessible control file, no model could &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;be initialised for element `</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">`&quot;</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">objecttools</span><span class="o">.</span><span class="n">augment_excmessage</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;While trying to initialise the model object of element &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">`&quot;</span>
                <span class="p">)</span>
        <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
            <span class="n">objecttools</span><span class="o">.</span><span class="n">augment_excmessage</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;While trying to initialise the model object of element `</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">`&quot;</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="Element.init_model">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Element.init_model">[docs]</a>
    <span class="k">def</span> <span class="nf">init_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clear_registry</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Deprecated: use method |Element.prepare_model| instead.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import Element</span>
<span class="sd">        &gt;&gt;&gt; from unittest import mock</span>
<span class="sd">        &gt;&gt;&gt; with mock.patch.object(Element, &quot;prepare_model&quot;) as mocked:</span>
<span class="sd">        ...     element = Element(&quot;test&quot;)</span>
<span class="sd">        ...     element.init_model(False)</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        hydpy.core.exceptiontools.HydPyDeprecationWarning: Method `init_model` of \</span>
<span class="sd">class `Element` is deprecated.  Use method `prepare_model` instead.</span>
<span class="sd">        &gt;&gt;&gt; mocked.call_args_list</span>
<span class="sd">        [call(False)]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prepare_model</span><span class="p">(</span><span class="n">clear_registry</span><span class="p">)</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;Method `init_model` of class `Element` is deprecated.  Use method &quot;</span>
            <span class="s2">&quot;`prepare_model` instead.&quot;</span><span class="p">,</span>
            <span class="n">exceptiontools</span><span class="o">.</span><span class="n">HydPyDeprecationWarning</span><span class="p">,</span>
        <span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">variables</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="n">NodeVariableType</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A set of all different |Node.variable| values of the |Node| objects directly</span>
<span class="sd">        connected to the actual |Element| object.</span>

<span class="sd">        Suppose there is an element connected to five nodes, which (partly) represent</span>
<span class="sd">        different variables:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import Element, Node</span>
<span class="sd">        &gt;&gt;&gt; element = Element(&quot;Test&quot;,</span>
<span class="sd">        ...                   inlets=(Node(&quot;N1&quot;, &quot;X&quot;), Node(&quot;N2&quot;, &quot;Y1&quot;)),</span>
<span class="sd">        ...                   outlets=(Node(&quot;N3&quot;, &quot;X&quot;), Node(&quot;N4&quot;, &quot;Y2&quot;)),</span>
<span class="sd">        ...                   receivers=(Node(&quot;N5&quot;, &quot;X&quot;), Node(&quot;N6&quot;, &quot;Y3&quot;)),</span>
<span class="sd">        ...                   senders=(Node(&quot;N7&quot;, &quot;X&quot;), Node(&quot;N8&quot;, &quot;Y4&quot;)))</span>

<span class="sd">        Property |Element.variables| puts all the different variables of these nodes</span>
<span class="sd">        together:</span>

<span class="sd">        &gt;&gt;&gt; sorted(element.variables)</span>
<span class="sd">        [&#39;X&#39;, &#39;Y1&#39;, &#39;Y2&#39;, &#39;Y3&#39;, &#39;Y4&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">variables</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">connection</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__connections</span><span class="p">:</span>
            <span class="n">variables</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">connection</span><span class="o">.</span><span class="n">variables</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">variables</span>

<div class="viewcode-block" id="Element.prepare_allseries">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Element.prepare_allseries">[docs]</a>
    <span class="k">def</span> <span class="nf">prepare_allseries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">allocate_ram</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">jit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call method |Element.prepare_inputseries| with `read_jit=jit` and methods</span>
<span class="sd">        |Element.prepare_factorseries|, |Element.prepare_fluxseries|, and</span>
<span class="sd">        |Element.prepare_stateseries| with `write_jit=jit`.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prepare_inputseries</span><span class="p">(</span><span class="n">allocate_ram</span><span class="o">=</span><span class="n">allocate_ram</span><span class="p">,</span> <span class="n">read_jit</span><span class="o">=</span><span class="n">jit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prepare_factorseries</span><span class="p">(</span><span class="n">allocate_ram</span><span class="o">=</span><span class="n">allocate_ram</span><span class="p">,</span> <span class="n">write_jit</span><span class="o">=</span><span class="n">jit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prepare_fluxseries</span><span class="p">(</span><span class="n">allocate_ram</span><span class="o">=</span><span class="n">allocate_ram</span><span class="p">,</span> <span class="n">write_jit</span><span class="o">=</span><span class="n">jit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prepare_stateseries</span><span class="p">(</span><span class="n">allocate_ram</span><span class="o">=</span><span class="n">allocate_ram</span><span class="p">,</span> <span class="n">write_jit</span><span class="o">=</span><span class="n">jit</span><span class="p">)</span></div>


<div class="viewcode-block" id="Element.prepare_inputseries">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Element.prepare_inputseries">[docs]</a>
    <span class="k">def</span> <span class="nf">prepare_inputseries</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">allocate_ram</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">read_jit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">write_jit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call method |IOSequence.prepare_series| of all |InputSequence| objects of</span>
<span class="sd">        the currently handled |Model| instance.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">prepare_series</span><span class="p">(</span>
            <span class="n">allocate_ram</span><span class="o">=</span><span class="n">allocate_ram</span><span class="p">,</span> <span class="n">read_jit</span><span class="o">=</span><span class="n">read_jit</span><span class="p">,</span> <span class="n">write_jit</span><span class="o">=</span><span class="n">write_jit</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Element.prepare_factorseries">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Element.prepare_factorseries">[docs]</a>
    <span class="k">def</span> <span class="nf">prepare_factorseries</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">allocate_ram</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">write_jit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call method |IOSequence.prepare_series| of all |FactorSequence| objects of</span>
<span class="sd">        the currently handled |Model| instance.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">prepare_series</span><span class="p">(</span>
            <span class="n">allocate_ram</span><span class="o">=</span><span class="n">allocate_ram</span><span class="p">,</span> <span class="n">write_jit</span><span class="o">=</span><span class="n">write_jit</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Element.prepare_fluxseries">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Element.prepare_fluxseries">[docs]</a>
    <span class="k">def</span> <span class="nf">prepare_fluxseries</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">allocate_ram</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">write_jit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call method |IOSequence.prepare_series| of all |FluxSequence| objects of</span>
<span class="sd">        the currently handled |Model| instance.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">prepare_series</span><span class="p">(</span>
            <span class="n">allocate_ram</span><span class="o">=</span><span class="n">allocate_ram</span><span class="p">,</span> <span class="n">write_jit</span><span class="o">=</span><span class="n">write_jit</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Element.prepare_stateseries">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Element.prepare_stateseries">[docs]</a>
    <span class="k">def</span> <span class="nf">prepare_stateseries</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">allocate_ram</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">write_jit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call method |IOSequence.prepare_series| of all |StateSequence| objects of</span>
<span class="sd">        the currently handled |Model| instance.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">prepare_series</span><span class="p">(</span>
            <span class="n">allocate_ram</span><span class="o">=</span><span class="n">allocate_ram</span><span class="p">,</span> <span class="n">write_jit</span><span class="o">=</span><span class="n">write_jit</span>
        <span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">_plot_series</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">subseqs</span><span class="p">:</span> <span class="n">sequencetools</span><span class="o">.</span><span class="n">IOSequences</span><span class="p">[</span>
            <span class="n">sequencetools</span><span class="o">.</span><span class="n">Sequences</span><span class="p">,</span>
            <span class="n">sequencetools</span><span class="o">.</span><span class="n">IOSequence</span><span class="p">,</span>
            <span class="n">sequencetools</span><span class="o">.</span><span class="n">FastAccessIOSequence</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="n">names</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
        <span class="n">average</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">labels</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]],</span>
        <span class="n">colors</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]]],</span>
        <span class="n">linestyles</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">LineStyle</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">LineStyle</span><span class="p">,</span> <span class="o">...</span><span class="p">]]],</span>
        <span class="n">linewidths</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]]],</span>
        <span class="n">focus</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">_prepare_tuple</span><span class="p">(</span>
            <span class="n">input_</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="o">...</span><span class="p">]]],</span> <span class="n">nmb_entries</span><span class="p">:</span> <span class="nb">int</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">T</span><span class="p">],</span> <span class="o">...</span><span class="p">]:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">input_</span>
            <span class="k">return</span> <span class="n">nmb_entries</span> <span class="o">*</span> <span class="p">(</span><span class="n">input_</span><span class="p">,)</span>

        <span class="k">def</span> <span class="nf">_make_vectors</span><span class="p">(</span><span class="n">array</span><span class="p">:</span> <span class="n">NDArrayFloat</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">NDArrayFloat</span><span class="p">]:</span>
            <span class="n">vectors</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">idxs</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">shp</span><span class="p">)</span> <span class="k">for</span> <span class="n">shp</span> <span class="ow">in</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:])):</span>
                <span class="n">vector</span> <span class="o">=</span> <span class="n">array</span>
                <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">idxs</span><span class="p">:</span>
                    <span class="n">vector</span> <span class="o">=</span> <span class="n">vector</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">]</span>
                <span class="n">vectors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">vectors</span>

        <span class="n">idx0</span><span class="p">,</span> <span class="n">idx1</span> <span class="o">=</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">timegrids</span><span class="o">.</span><span class="n">evalindices</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">_get_pandasindex</span><span class="p">()[</span><span class="n">idx0</span><span class="p">:</span><span class="n">idx1</span><span class="p">]</span>
        <span class="n">selseqs</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">sequencetools</span><span class="o">.</span><span class="n">IOSequence</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">names</span><span class="p">:</span>
            <span class="n">selseqs</span> <span class="o">=</span> <span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">subseqs</span><span class="p">,</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">selseqs</span> <span class="o">=</span> <span class="n">subseqs</span>
        <span class="n">nmb_sequences</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">subseqs</span><span class="p">)</span>
        <span class="n">labels_</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="o">...</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">labels_</span> <span class="o">=</span> <span class="n">labels</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">labels_</span> <span class="o">=</span> <span class="n">nmb_sequences</span> <span class="o">*</span> <span class="p">(</span><span class="n">labels</span><span class="p">,)</span>
        <span class="k">for</span> <span class="n">sequence</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">linestyle</span><span class="p">,</span> <span class="n">linewidth</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
            <span class="n">selseqs</span><span class="p">,</span>
            <span class="n">labels_</span><span class="p">,</span>
            <span class="n">_prepare_tuple</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">nmb_sequences</span><span class="p">),</span>
            <span class="n">_prepare_tuple</span><span class="p">(</span><span class="n">linestyles</span><span class="p">,</span> <span class="n">nmb_sequences</span><span class="p">),</span>
            <span class="n">_prepare_tuple</span><span class="p">(</span><span class="n">linewidths</span><span class="p">,</span> <span class="n">nmb_sequences</span><span class="p">),</span>
        <span class="p">):</span>
            <span class="n">label_</span> <span class="o">=</span> <span class="n">label</span> <span class="k">if</span> <span class="n">label</span> <span class="k">else</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">average</span><span class="p">:</span>
                <span class="n">series</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">average_series</span><span class="p">()[</span><span class="n">idx0</span><span class="p">:</span><span class="n">idx1</span><span class="p">]</span>
                <span class="n">label_</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">label_</span><span class="si">}</span><span class="s2">, averaged&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">series</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">evalseries</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">label_</span><span class="p">,</span> <span class="s2">&quot;ax&quot;</span><span class="p">:</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">gca</span><span class="p">()}</span>
            <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">color</span>
            <span class="k">if</span> <span class="n">linestyle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;linestyle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">linestyle</span>
            <span class="k">if</span> <span class="n">linewidth</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;linewidth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">linewidth</span>
            <span class="k">if</span> <span class="n">series</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">ps</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
                <span class="n">ps</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">all</span><span class="p">(</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">length</span> <span class="ow">in</span> <span class="n">series</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
                <span class="n">vectors</span> <span class="o">=</span> <span class="n">_make_vectors</span><span class="p">(</span><span class="n">series</span><span class="p">)</span>
                <span class="n">ps</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">vectors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
                <span class="n">axessubplot</span> <span class="o">=</span> <span class="n">ps</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;None&quot;</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">axessubplot</span><span class="o">.</span><span class="n">get_lines</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_color</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">vector</span> <span class="ow">in</span> <span class="n">vectors</span><span class="p">:</span>
                    <span class="n">ps</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
                    <span class="n">ps</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">color</span><span class="p">:</span>
                    <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">color</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span><span class="o">.</span><span class="n">get_lines</span><span class="p">()</span> <span class="k">if</span> <span class="n">l</span><span class="o">.</span><span class="n">get_label</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;None&quot;</span><span class="p">]</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">lines</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">focus</span><span class="p">:</span>
            <span class="n">pyplot</span><span class="o">.</span><span class="n">ylim</span><span class="p">((</span><span class="mf">0.0</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>

<div class="viewcode-block" id="Element.plot_inputseries">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Element.plot_inputseries">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_inputseries</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">names</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">average</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">labels</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">colors</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">linestyles</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">LineStyle</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">LineStyle</span><span class="p">,</span> <span class="o">...</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">linewidths</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">focus</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot (the selected) |InputSequence| |IOSequence.series| values.</span>

<span class="sd">        We demonstrate the functionalities of method |Element.plot_inputseries| based</span>
<span class="sd">        on the `Lahn` example project:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.examples import prepare_full_example_2</span>
<span class="sd">        &gt;&gt;&gt; hp, pub, _ = prepare_full_example_2(lastdate=&quot;1997-01-01&quot;)</span>

<span class="sd">        Without any arguments, |Element.plot_inputseries| prints the time-series of all</span>
<span class="sd">        input sequences handled by its |Model| object directly to the screen (in our</span>
<span class="sd">        example |hland_inputs.P|, |hland_inputs.T|, |hland_inputs.TN|, and</span>
<span class="sd">        |hland_inputs.EPN| of application model |hland_v1|):</span>

<span class="sd">        &gt;&gt;&gt; land = hp.elements.land_dill</span>
<span class="sd">        &gt;&gt;&gt; figure = land.plot_inputseries()</span>

<span class="sd">        You can use the `pyplot` API of `matplotlib` to modify the returned figure or</span>
<span class="sd">        to save it to disk (or print it to the screen, in case the interactive mode of</span>
<span class="sd">        `matplotlib` is disabled):</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.core.testtools import save_autofig</span>
<span class="sd">        &gt;&gt;&gt; save_autofig(&quot;Element_plot_inputseries.png&quot;, figure)</span>

<span class="sd">        .. image:: Element_plot_inputseries.png</span>

<span class="sd">        Methods |Element.plot_factorseries|, |Element.plot_fluxseries|, and</span>
<span class="sd">        |Element.plot_stateseries| work in the same manner.  Before applying them, one</span>
<span class="sd">        has to calculate the time-series of the |FactorSequence|, |FluxSequence|, and</span>
<span class="sd">        |StateSequence| objects:</span>

<span class="sd">        &gt;&gt;&gt; hp.simulate()</span>

<span class="sd">        All three methods allow selecting specific sequences by passing their names</span>
<span class="sd">        (here, flux sequences |hland_fluxes.Q0| and |hland_fluxes.Q1| of |hland_v1|).</span>
<span class="sd">        Additionally, you can pass general or individual values to the arguments</span>
<span class="sd">        `labels`, `colors`, `linestyles`, and `linewidths`:</span>

<span class="sd">        &gt;&gt;&gt; figure = land.plot_fluxseries(</span>
<span class="sd">        ...     [&quot;q0&quot;, &quot;q1&quot;], labels=(&quot;direct runoff&quot;, &quot;base flow&quot;),</span>
<span class="sd">        ...     colors=(&quot;red&quot;, &quot;green&quot;), linestyles=&quot;--&quot;, linewidths=2)</span>
<span class="sd">        &gt;&gt;&gt; save_autofig(&quot;Element_plot_fluxseries.png&quot;, figure)</span>

<span class="sd">        .. image:: Element_plot_fluxseries.png</span>

<span class="sd">        For 1- and 2-dimensional |IOSequence| objects, all three methods plot the</span>
<span class="sd">        individual time-series in the same colour.  We demonstrate this for the frozen</span>
<span class="sd">        (|hland_states.SP|) and the liquid (|hland_states.WC|) water equivalent of the</span>
<span class="sd">        snow cover of different hydrological response units.  Therefore, we restrict</span>
<span class="sd">        the shown period to February and March via the |Timegrids.eval_| time-grid:</span>

<span class="sd">        &gt;&gt;&gt; with pub.timegrids.eval_(firstdate=&quot;1996-02-01&quot;, lastdate=&quot;1996-04-01&quot;):</span>
<span class="sd">        ...     figure = land.plot_stateseries([&quot;sp&quot;, &quot;wc&quot;])</span>
<span class="sd">        &gt;&gt;&gt; save_autofig(&quot;Element_plot_stateseries.png&quot;, figure)</span>

<span class="sd">        .. image:: Element_plot_stateseries.png</span>

<span class="sd">        Alternatively, you can print the averaged time-series by assigning |True| to the</span>
<span class="sd">        argument `average`.  We demonstrate this functionality for the factor sequence</span>
<span class="sd">        |hland_factors.TC| (this time, without focusing on the time-series y-extent):</span>

<span class="sd">        &gt;&gt;&gt; figure = land.plot_factorseries([&quot;tc&quot;], colors=(&quot;grey&quot;,))</span>
<span class="sd">        &gt;&gt;&gt; figure = land.plot_factorseries(</span>
<span class="sd">        ...     [&quot;tc&quot;], average=True, focus=False, colors=&quot;black&quot;, linewidths=3)</span>
<span class="sd">        &gt;&gt;&gt; save_autofig(&quot;Element_plot_factorseries.png&quot;, figure)</span>

<span class="sd">        .. image:: Element_plot_factorseries.png</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_series</span><span class="p">(</span>
            <span class="n">subseqs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">inputs</span><span class="p">,</span>
            <span class="n">names</span><span class="o">=</span><span class="n">names</span><span class="p">,</span>
            <span class="n">average</span><span class="o">=</span><span class="n">average</span><span class="p">,</span>
            <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
            <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
            <span class="n">linestyles</span><span class="o">=</span><span class="n">linestyles</span><span class="p">,</span>
            <span class="n">linewidths</span><span class="o">=</span><span class="n">linewidths</span><span class="p">,</span>
            <span class="n">focus</span><span class="o">=</span><span class="n">focus</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Element.plot_factorseries">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Element.plot_factorseries">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_factorseries</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">names</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">average</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">labels</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">colors</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">linestyles</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">LineStyle</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">LineStyle</span><span class="p">,</span> <span class="o">...</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">linewidths</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">focus</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot the `factor` series of the handled model.</span>

<span class="sd">        See the documentation on method |Element.plot_inputseries| for additional</span>
<span class="sd">        information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_series</span><span class="p">(</span>
            <span class="n">subseqs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">factors</span><span class="p">,</span>
            <span class="n">names</span><span class="o">=</span><span class="n">names</span><span class="p">,</span>
            <span class="n">average</span><span class="o">=</span><span class="n">average</span><span class="p">,</span>
            <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
            <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
            <span class="n">linestyles</span><span class="o">=</span><span class="n">linestyles</span><span class="p">,</span>
            <span class="n">linewidths</span><span class="o">=</span><span class="n">linewidths</span><span class="p">,</span>
            <span class="n">focus</span><span class="o">=</span><span class="n">focus</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Element.plot_fluxseries">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Element.plot_fluxseries">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_fluxseries</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">names</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">average</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">labels</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">colors</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">linestyles</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">LineStyle</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">LineStyle</span><span class="p">,</span> <span class="o">...</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">linewidths</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">focus</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot the `flux` series of the handled model.</span>

<span class="sd">        See the documentation on method |Element.plot_inputseries| for additional</span>
<span class="sd">        information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_series</span><span class="p">(</span>
            <span class="n">subseqs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">fluxes</span><span class="p">,</span>
            <span class="n">names</span><span class="o">=</span><span class="n">names</span><span class="p">,</span>
            <span class="n">average</span><span class="o">=</span><span class="n">average</span><span class="p">,</span>
            <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
            <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
            <span class="n">linestyles</span><span class="o">=</span><span class="n">linestyles</span><span class="p">,</span>
            <span class="n">linewidths</span><span class="o">=</span><span class="n">linewidths</span><span class="p">,</span>
            <span class="n">focus</span><span class="o">=</span><span class="n">focus</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Element.plot_stateseries">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Element.plot_stateseries">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_stateseries</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">names</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">average</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">labels</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">colors</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">linestyles</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">LineStyle</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">LineStyle</span><span class="p">,</span> <span class="o">...</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">linewidths</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">focus</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot the `state` series of the handled model.</span>

<span class="sd">        See the documentation on method |Element.plot_inputseries| for additional</span>
<span class="sd">        information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_series</span><span class="p">(</span>
            <span class="n">subseqs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">states</span><span class="p">,</span>
            <span class="n">names</span><span class="o">=</span><span class="n">names</span><span class="p">,</span>
            <span class="n">average</span><span class="o">=</span><span class="n">average</span><span class="p">,</span>
            <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
            <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
            <span class="n">linestyles</span><span class="o">=</span><span class="n">linestyles</span><span class="p">,</span>
            <span class="n">linewidths</span><span class="o">=</span><span class="n">linewidths</span><span class="p">,</span>
            <span class="n">focus</span><span class="o">=</span><span class="n">focus</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Element.assignrepr">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.Element.assignrepr">[docs]</a>
    <span class="k">def</span> <span class="nf">assignrepr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a |repr| string with a prefixed assignment.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">repr_</span><span class="o">.</span><span class="n">preserve_strings</span><span class="p">(</span><span class="kc">True</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">assignrepr_tuple</span><span class="o">.</span><span class="n">always_bracketed</span><span class="p">(</span><span class="kc">False</span><span class="p">):</span>
                <span class="n">blanks</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span> <span class="o">+</span> <span class="mi">8</span><span class="p">)</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s1">Element(&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&quot;,&#39;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">groupname</span> <span class="ow">in</span> <span class="p">(</span>
                    <span class="s2">&quot;inlets&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;outlets&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;receivers&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;senders&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;inputs&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;outputs&quot;</span><span class="p">,</span>
                <span class="p">):</span>
                    <span class="n">group</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">groupname</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">group</span><span class="p">:</span>
                        <span class="n">subprefix</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}{</span><span class="n">groupname</span><span class="si">}</span><span class="s2">=&quot;</span>
                        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">group</span><span class="p">]</span>
                        <span class="n">line</span> <span class="o">=</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">assignrepr_list</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">subprefix</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">70</span><span class="p">)</span>
                        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">keywords</span><span class="p">:</span>
                    <span class="n">subprefix</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">blanks</span><span class="si">}</span><span class="s2">keywords=&quot;</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">assignrepr_list</span><span class="p">(</span>
                        <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keywords</span><span class="p">),</span> <span class="n">subprefix</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">70</span>
                    <span class="p">)</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>
                <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>
                <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">assignrepr</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span></div>



<span class="n">_id2devices</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Device</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Devices</span><span class="p">[</span><span class="n">Device</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">_registry</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">Device</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Device</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="n">Node</span><span class="p">:</span> <span class="p">{},</span> <span class="n">Element</span><span class="p">:</span> <span class="p">{}}</span>
<span class="n">_selection</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">Device</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Device</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="n">Node</span><span class="p">:</span> <span class="p">{},</span> <span class="n">Element</span><span class="p">:</span> <span class="p">{}}</span>


<div class="viewcode-block" id="clear_registries_temporarily">
<a class="viewcode-back" href="../../../devicetools.html#hydpy.core.devicetools.clear_registries_temporarily">[docs]</a>
<span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
<span class="k">def</span> <span class="nf">clear_registries_temporarily</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Context manager for clearing the current |Node|, |Element|, and |FusedVariable|</span>
<span class="sd">    registries.</span>

<span class="sd">    Function |clear_registries_temporarily| is only available for testing purposes.</span>

<span class="sd">    These are the relevant registries for the currently initialised |Node|, |Element|,</span>
<span class="sd">    and |FusedVariable| objects:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy.core import devicetools</span>
<span class="sd">    &gt;&gt;&gt; registries = (devicetools._id2devices,</span>
<span class="sd">    ...               devicetools._registry[devicetools.Node],</span>
<span class="sd">    ...               devicetools._registry[devicetools.Element],</span>
<span class="sd">    ...               devicetools._selection[devicetools.Node],</span>
<span class="sd">    ...               devicetools._selection[devicetools.Element],</span>
<span class="sd">    ...               devicetools._registry_fusedvariable)</span>

<span class="sd">    We first clear them and, just for testing, insert some numbers:</span>

<span class="sd">    &gt;&gt;&gt; for idx, registry in enumerate(registries):</span>
<span class="sd">    ...     registry.clear()</span>
<span class="sd">    ...     registry[idx] = idx+1</span>

<span class="sd">    Within the `with` block, all registries are empty:</span>

<span class="sd">    &gt;&gt;&gt; with devicetools.clear_registries_temporarily():</span>
<span class="sd">    ...     for registry in registries:</span>
<span class="sd">    ...         print(registry)</span>
<span class="sd">    {}</span>
<span class="sd">    {}</span>
<span class="sd">    {}</span>
<span class="sd">    {}</span>
<span class="sd">    {}</span>
<span class="sd">    {}</span>

<span class="sd">    Before leaving the `with` block, the |clear_registries_temporarily| method restores</span>
<span class="sd">    the contents of each dictionary:</span>

<span class="sd">    &gt;&gt;&gt; for registry in registries:</span>
<span class="sd">    ...     print(registry)</span>
<span class="sd">    ...     registry.clear()</span>
<span class="sd">    {0: 1}</span>
<span class="sd">    {1: 2}</span>
<span class="sd">    {2: 3}</span>
<span class="sd">    {3: 4}</span>
<span class="sd">    {4: 5}</span>
<span class="sd">    {5: 6}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">registries</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">_id2devices</span><span class="p">,</span>
        <span class="n">_registry</span><span class="p">[</span><span class="n">Node</span><span class="p">],</span>
        <span class="n">_registry</span><span class="p">[</span><span class="n">Element</span><span class="p">],</span>
        <span class="n">_selection</span><span class="p">[</span><span class="n">Node</span><span class="p">],</span>
        <span class="n">_selection</span><span class="p">[</span><span class="n">Element</span><span class="p">],</span>
        <span class="n">_registry_fusedvariable</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">copies</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">registry</span><span class="p">)</span> <span class="k">for</span> <span class="n">registry</span> <span class="ow">in</span> <span class="n">registries</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">registry</span> <span class="ow">in</span> <span class="n">registries</span><span class="p">:</span>
            <span class="n">registry</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">yield</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">registry</span><span class="p">,</span> <span class="n">copy_</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">registries</span><span class="p">,</span> <span class="n">copies</span><span class="p">):</span>
            <span class="n">registry</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">copy_</span><span class="p">)</span></div>



<span class="k">def</span> <span class="nf">_get_pandasindex</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">pandas</span><span class="o">.</span><span class="n">Index</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">    &gt;&gt;&gt; pub.timegrids = &quot;2004.01.01&quot;, &quot;2005.01.01&quot;, &quot;1d&quot;</span>
<span class="sd">    &gt;&gt;&gt; from hydpy.core.devicetools import _get_pandasindex</span>
<span class="sd">    &gt;&gt;&gt; _get_pandasindex()   # doctest: +ELLIPSIS</span>
<span class="sd">    DatetimeIndex([&#39;2004-01-01 12:00:00&#39;, &#39;2004-01-02 12:00:00&#39;,</span>
<span class="sd">    ...</span>
<span class="sd">                   &#39;2004-12-30 12:00:00&#39;, &#39;2004-12-31 12:00:00&#39;],</span>
<span class="sd">                  dtype=&#39;datetime64[ns]&#39;, length=366, freq=None)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tg</span> <span class="o">=</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">timegrids</span><span class="o">.</span><span class="n">init</span>
    <span class="n">shift</span> <span class="o">=</span> <span class="n">tg</span><span class="o">.</span><span class="n">stepsize</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span>
        <span class="p">(</span><span class="n">tg</span><span class="o">.</span><span class="n">firstdate</span> <span class="o">+</span> <span class="n">shift</span><span class="p">)</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span>
        <span class="p">(</span><span class="n">tg</span><span class="o">.</span><span class="n">lastdate</span> <span class="o">-</span> <span class="n">shift</span><span class="p">)</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span>
        <span class="p">(</span><span class="n">tg</span><span class="o">.</span><span class="n">lastdate</span> <span class="o">-</span> <span class="n">tg</span><span class="o">.</span><span class="n">firstdate</span> <span class="o">-</span> <span class="n">tg</span><span class="o">.</span><span class="n">stepsize</span><span class="p">)</span> <span class="o">/</span> <span class="n">tg</span><span class="o">.</span><span class="n">stepsize</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">index</span>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">HydPy 5.0.3 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">hydpy.core.devicetools</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2023, HydPy Developers.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    </div>
  </body>
</html>